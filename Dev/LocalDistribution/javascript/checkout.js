//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.
(function () {
    // Baseline setup
    // --------------
    // Establish the root object, `window` in the browser, or `exports` on the server.
    var root = this;
    // Save the previous value of the `_` variable.
    var previousUnderscore = root._;
    // Save bytes in the minified (but not gzipped) version:
    var ArrayProto = Array.prototype, ObjProto = Object.prototype, FuncProto = Function.prototype;
    // Create quick reference variables for speed access to core prototypes.
    var push = ArrayProto.push, slice = ArrayProto.slice, toString = ObjProto.toString, hasOwnProperty = ObjProto.hasOwnProperty;
    // All **ECMAScript 5** native function implementations that we hope to use
    // are declared here.
    var nativeIsArray = Array.isArray, nativeKeys = Object.keys, nativeBind = FuncProto.bind, nativeCreate = Object.create;
    // Naked function reference for surrogate-prototype-swapping.
    var Ctor = function () {
    };
    // Create a safe reference to the Underscore object for use below.
    var _ = function (obj) {
        if (obj instanceof _)
            return obj;
        if (!(this instanceof _))
            return new _(obj);
        this._wrapped = obj;
    };
    // Export the Underscore object for **Node.js**, with
    // backwards-compatibility for the old `require()` API. If we're in
    // the browser, add `_` as a global object.
    if (typeof exports !== 'undefined') {
        if (typeof module !== 'undefined' && module.exports) {
            exports = module.exports = _;
        }
        exports._ = _;
    } else {
        root._ = _;
    }
    // Current version.
    _.VERSION = '1.8.3';
    // Internal function that returns an efficient (for current engines) version
    // of the passed-in callback, to be repeatedly applied in other Underscore
    // functions.
    var optimizeCb = function (func, context, argCount) {
        if (context === void 0)
            return func;
        switch (argCount == null ? 3 : argCount) {
        case 1:
            return function (value) {
                return func.call(context, value);
            };
        case 2:
            return function (value, other) {
                return func.call(context, value, other);
            };
        case 3:
            return function (value, index, collection) {
                return func.call(context, value, index, collection);
            };
        case 4:
            return function (accumulator, value, index, collection) {
                return func.call(context, accumulator, value, index, collection);
            };
        }
        return function () {
            return func.apply(context, arguments);
        };
    };
    // A mostly-internal function to generate callbacks that can be applied
    // to each element in a collection, returning the desired result — either
    // identity, an arbitrary callback, a property matcher, or a property accessor.
    var cb = function (value, context, argCount) {
        if (value == null)
            return _.identity;
        if (_.isFunction(value))
            return optimizeCb(value, context, argCount);
        if (_.isObject(value))
            return _.matcher(value);
        return _.property(value);
    };
    _.iteratee = function (value, context) {
        return cb(value, context, Infinity);
    };
    // An internal function for creating assigner functions.
    var createAssigner = function (keysFunc, undefinedOnly) {
        return function (obj) {
            var length = arguments.length;
            if (length < 2 || obj == null)
                return obj;
            for (var index = 1; index < length; index++) {
                var source = arguments[index], keys = keysFunc(source), l = keys.length;
                for (var i = 0; i < l; i++) {
                    var key = keys[i];
                    if (!undefinedOnly || obj[key] === void 0)
                        obj[key] = source[key];
                }
            }
            return obj;
        };
    };
    // An internal function for creating a new object that inherits from another.
    var baseCreate = function (prototype) {
        if (!_.isObject(prototype))
            return {};
        if (nativeCreate)
            return nativeCreate(prototype);
        Ctor.prototype = prototype;
        var result = new Ctor();
        Ctor.prototype = null;
        return result;
    };
    var property = function (key) {
        return function (obj) {
            return obj == null ? void 0 : obj[key];
        };
    };
    // Helper for collection methods to determine whether a collection
    // should be iterated as an array or as an object
    // Related: http://people.mozilla.org/~jorendorff/es6-draft.html#sec-tolength
    // Avoids a very nasty iOS 8 JIT bug on ARM-64. #2094
    var MAX_ARRAY_INDEX = Math.pow(2, 53) - 1;
    var getLength = property('length');
    var isArrayLike = function (collection) {
        var length = getLength(collection);
        return typeof length == 'number' && length >= 0 && length <= MAX_ARRAY_INDEX;
    };
    // Collection Functions
    // --------------------
    // The cornerstone, an `each` implementation, aka `forEach`.
    // Handles raw objects in addition to array-likes. Treats all
    // sparse array-likes as if they were dense.
    _.each = _.forEach = function (obj, iteratee, context) {
        iteratee = optimizeCb(iteratee, context);
        var i, length;
        if (isArrayLike(obj)) {
            for (i = 0, length = obj.length; i < length; i++) {
                iteratee(obj[i], i, obj);
            }
        } else {
            var keys = _.keys(obj);
            for (i = 0, length = keys.length; i < length; i++) {
                iteratee(obj[keys[i]], keys[i], obj);
            }
        }
        return obj;
    };
    // Return the results of applying the iteratee to each element.
    _.map = _.collect = function (obj, iteratee, context) {
        iteratee = cb(iteratee, context);
        var keys = !isArrayLike(obj) && _.keys(obj), length = (keys || obj).length, results = Array(length);
        for (var index = 0; index < length; index++) {
            var currentKey = keys ? keys[index] : index;
            results[index] = iteratee(obj[currentKey], currentKey, obj);
        }
        return results;
    };
    // Create a reducing function iterating left or right.
    function createReduce(dir) {
        // Optimized iterator function as using arguments.length
        // in the main function will deoptimize the, see #1991.
        function iterator(obj, iteratee, memo, keys, index, length) {
            for (; index >= 0 && index < length; index += dir) {
                var currentKey = keys ? keys[index] : index;
                memo = iteratee(memo, obj[currentKey], currentKey, obj);
            }
            return memo;
        }
        return function (obj, iteratee, memo, context) {
            iteratee = optimizeCb(iteratee, context, 4);
            var keys = !isArrayLike(obj) && _.keys(obj), length = (keys || obj).length, index = dir > 0 ? 0 : length - 1;
            // Determine the initial value if none is provided.
            if (arguments.length < 3) {
                memo = obj[keys ? keys[index] : index];
                index += dir;
            }
            return iterator(obj, iteratee, memo, keys, index, length);
        };
    }
    // **Reduce** builds up a single result from a list of values, aka `inject`,
    // or `foldl`.
    _.reduce = _.foldl = _.inject = createReduce(1);
    // The right-associative version of reduce, also known as `foldr`.
    _.reduceRight = _.foldr = createReduce(-1);
    // Return the first value which passes a truth test. Aliased as `detect`.
    _.find = _.detect = function (obj, predicate, context) {
        var key;
        if (isArrayLike(obj)) {
            key = _.findIndex(obj, predicate, context);
        } else {
            key = _.findKey(obj, predicate, context);
        }
        if (key !== void 0 && key !== -1)
            return obj[key];
    };
    // Return all the elements that pass a truth test.
    // Aliased as `select`.
    _.filter = _.select = function (obj, predicate, context) {
        var results = [];
        predicate = cb(predicate, context);
        _.each(obj, function (value, index, list) {
            if (predicate(value, index, list))
                results.push(value);
        });
        return results;
    };
    // Return all the elements for which a truth test fails.
    _.reject = function (obj, predicate, context) {
        return _.filter(obj, _.negate(cb(predicate)), context);
    };
    // Determine whether all of the elements match a truth test.
    // Aliased as `all`.
    _.every = _.all = function (obj, predicate, context) {
        predicate = cb(predicate, context);
        var keys = !isArrayLike(obj) && _.keys(obj), length = (keys || obj).length;
        for (var index = 0; index < length; index++) {
            var currentKey = keys ? keys[index] : index;
            if (!predicate(obj[currentKey], currentKey, obj))
                return false;
        }
        return true;
    };
    // Determine if at least one element in the object matches a truth test.
    // Aliased as `any`.
    _.some = _.any = function (obj, predicate, context) {
        predicate = cb(predicate, context);
        var keys = !isArrayLike(obj) && _.keys(obj), length = (keys || obj).length;
        for (var index = 0; index < length; index++) {
            var currentKey = keys ? keys[index] : index;
            if (predicate(obj[currentKey], currentKey, obj))
                return true;
        }
        return false;
    };
    // Determine if the array or object contains a given item (using `===`).
    // Aliased as `includes` and `include`.
    _.contains = _.includes = _.include = function (obj, item, fromIndex, guard) {
        if (!isArrayLike(obj))
            obj = _.values(obj);
        if (typeof fromIndex != 'number' || guard)
            fromIndex = 0;
        return _.indexOf(obj, item, fromIndex) >= 0;
    };
    // Invoke a method (with arguments) on every item in a collection.
    _.invoke = function (obj, method) {
        var args = slice.call(arguments, 2);
        var isFunc = _.isFunction(method);
        return _.map(obj, function (value) {
            var func = isFunc ? method : value[method];
            return func == null ? func : func.apply(value, args);
        });
    };
    // Convenience version of a common use case of `map`: fetching a property.
    _.pluck = function (obj, key) {
        return _.map(obj, _.property(key));
    };
    // Convenience version of a common use case of `filter`: selecting only objects
    // containing specific `key:value` pairs.
    _.where = function (obj, attrs) {
        return _.filter(obj, _.matcher(attrs));
    };
    // Convenience version of a common use case of `find`: getting the first object
    // containing specific `key:value` pairs.
    _.findWhere = function (obj, attrs) {
        return _.find(obj, _.matcher(attrs));
    };
    // Return the maximum element (or element-based computation).
    _.max = function (obj, iteratee, context) {
        var result = -Infinity, lastComputed = -Infinity, value, computed;
        if (iteratee == null && obj != null) {
            obj = isArrayLike(obj) ? obj : _.values(obj);
            for (var i = 0, length = obj.length; i < length; i++) {
                value = obj[i];
                if (value > result) {
                    result = value;
                }
            }
        } else {
            iteratee = cb(iteratee, context);
            _.each(obj, function (value, index, list) {
                computed = iteratee(value, index, list);
                if (computed > lastComputed || computed === -Infinity && result === -Infinity) {
                    result = value;
                    lastComputed = computed;
                }
            });
        }
        return result;
    };
    // Return the minimum element (or element-based computation).
    _.min = function (obj, iteratee, context) {
        var result = Infinity, lastComputed = Infinity, value, computed;
        if (iteratee == null && obj != null) {
            obj = isArrayLike(obj) ? obj : _.values(obj);
            for (var i = 0, length = obj.length; i < length; i++) {
                value = obj[i];
                if (value < result) {
                    result = value;
                }
            }
        } else {
            iteratee = cb(iteratee, context);
            _.each(obj, function (value, index, list) {
                computed = iteratee(value, index, list);
                if (computed < lastComputed || computed === Infinity && result === Infinity) {
                    result = value;
                    lastComputed = computed;
                }
            });
        }
        return result;
    };
    // Shuffle a collection, using the modern version of the
    // [Fisher-Yates shuffle](http://en.wikipedia.org/wiki/Fisher–Yates_shuffle).
    _.shuffle = function (obj) {
        var set = isArrayLike(obj) ? obj : _.values(obj);
        var length = set.length;
        var shuffled = Array(length);
        for (var index = 0, rand; index < length; index++) {
            rand = _.random(0, index);
            if (rand !== index)
                shuffled[index] = shuffled[rand];
            shuffled[rand] = set[index];
        }
        return shuffled;
    };
    // Sample **n** random values from a collection.
    // If **n** is not specified, returns a single random element.
    // The internal `guard` argument allows it to work with `map`.
    _.sample = function (obj, n, guard) {
        if (n == null || guard) {
            if (!isArrayLike(obj))
                obj = _.values(obj);
            return obj[_.random(obj.length - 1)];
        }
        return _.shuffle(obj).slice(0, Math.max(0, n));
    };
    // Sort the object's values by a criterion produced by an iteratee.
    _.sortBy = function (obj, iteratee, context) {
        iteratee = cb(iteratee, context);
        return _.pluck(_.map(obj, function (value, index, list) {
            return {
                value: value,
                index: index,
                criteria: iteratee(value, index, list)
            };
        }).sort(function (left, right) {
            var a = left.criteria;
            var b = right.criteria;
            if (a !== b) {
                if (a > b || a === void 0)
                    return 1;
                if (a < b || b === void 0)
                    return -1;
            }
            return left.index - right.index;
        }), 'value');
    };
    // An internal function used for aggregate "group by" operations.
    var group = function (behavior) {
        return function (obj, iteratee, context) {
            var result = {};
            iteratee = cb(iteratee, context);
            _.each(obj, function (value, index) {
                var key = iteratee(value, index, obj);
                behavior(result, value, key);
            });
            return result;
        };
    };
    // Groups the object's values by a criterion. Pass either a string attribute
    // to group by, or a function that returns the criterion.
    _.groupBy = group(function (result, value, key) {
        if (_.has(result, key))
            result[key].push(value);
        else
            result[key] = [value];
    });
    // Indexes the object's values by a criterion, similar to `groupBy`, but for
    // when you know that your index values will be unique.
    _.indexBy = group(function (result, value, key) {
        result[key] = value;
    });
    // Counts instances of an object that group by a certain criterion. Pass
    // either a string attribute to count by, or a function that returns the
    // criterion.
    _.countBy = group(function (result, value, key) {
        if (_.has(result, key))
            result[key]++;
        else
            result[key] = 1;
    });
    // Safely create a real, live array from anything iterable.
    _.toArray = function (obj) {
        if (!obj)
            return [];
        if (_.isArray(obj))
            return slice.call(obj);
        if (isArrayLike(obj))
            return _.map(obj, _.identity);
        return _.values(obj);
    };
    // Return the number of elements in an object.
    _.size = function (obj) {
        if (obj == null)
            return 0;
        return isArrayLike(obj) ? obj.length : _.keys(obj).length;
    };
    // Split a collection into two arrays: one whose elements all satisfy the given
    // predicate, and one whose elements all do not satisfy the predicate.
    _.partition = function (obj, predicate, context) {
        predicate = cb(predicate, context);
        var pass = [], fail = [];
        _.each(obj, function (value, key, obj) {
            (predicate(value, key, obj) ? pass : fail).push(value);
        });
        return [
            pass,
            fail
        ];
    };
    // Array Functions
    // ---------------
    // Get the first element of an array. Passing **n** will return the first N
    // values in the array. Aliased as `head` and `take`. The **guard** check
    // allows it to work with `_.map`.
    _.first = _.head = _.take = function (array, n, guard) {
        if (array == null)
            return void 0;
        if (n == null || guard)
            return array[0];
        return _.initial(array, array.length - n);
    };
    // Returns everything but the last entry of the array. Especially useful on
    // the arguments object. Passing **n** will return all the values in
    // the array, excluding the last N.
    _.initial = function (array, n, guard) {
        return slice.call(array, 0, Math.max(0, array.length - (n == null || guard ? 1 : n)));
    };
    // Get the last element of an array. Passing **n** will return the last N
    // values in the array.
    _.last = function (array, n, guard) {
        if (array == null)
            return void 0;
        if (n == null || guard)
            return array[array.length - 1];
        return _.rest(array, Math.max(0, array.length - n));
    };
    // Returns everything but the first entry of the array. Aliased as `tail` and `drop`.
    // Especially useful on the arguments object. Passing an **n** will return
    // the rest N values in the array.
    _.rest = _.tail = _.drop = function (array, n, guard) {
        return slice.call(array, n == null || guard ? 1 : n);
    };
    // Trim out all falsy values from an array.
    _.compact = function (array) {
        return _.filter(array, _.identity);
    };
    // Internal implementation of a recursive `flatten` function.
    var flatten = function (input, shallow, strict, startIndex) {
        var output = [], idx = 0;
        for (var i = startIndex || 0, length = getLength(input); i < length; i++) {
            var value = input[i];
            if (isArrayLike(value) && (_.isArray(value) || _.isArguments(value))) {
                //flatten current level of array or arguments object
                if (!shallow)
                    value = flatten(value, shallow, strict);
                var j = 0, len = value.length;
                output.length += len;
                while (j < len) {
                    output[idx++] = value[j++];
                }
            } else if (!strict) {
                output[idx++] = value;
            }
        }
        return output;
    };
    // Flatten out an array, either recursively (by default), or just one level.
    _.flatten = function (array, shallow) {
        return flatten(array, shallow, false);
    };
    // Return a version of the array that does not contain the specified value(s).
    _.without = function (array) {
        return _.difference(array, slice.call(arguments, 1));
    };
    // Produce a duplicate-free version of the array. If the array has already
    // been sorted, you have the option of using a faster algorithm.
    // Aliased as `unique`.
    _.uniq = _.unique = function (array, isSorted, iteratee, context) {
        if (!_.isBoolean(isSorted)) {
            context = iteratee;
            iteratee = isSorted;
            isSorted = false;
        }
        if (iteratee != null)
            iteratee = cb(iteratee, context);
        var result = [];
        var seen = [];
        for (var i = 0, length = getLength(array); i < length; i++) {
            var value = array[i], computed = iteratee ? iteratee(value, i, array) : value;
            if (isSorted) {
                if (!i || seen !== computed)
                    result.push(value);
                seen = computed;
            } else if (iteratee) {
                if (!_.contains(seen, computed)) {
                    seen.push(computed);
                    result.push(value);
                }
            } else if (!_.contains(result, value)) {
                result.push(value);
            }
        }
        return result;
    };
    // Produce an array that contains the union: each distinct element from all of
    // the passed-in arrays.
    _.union = function () {
        return _.uniq(flatten(arguments, true, true));
    };
    // Produce an array that contains every item shared between all the
    // passed-in arrays.
    _.intersection = function (array) {
        var result = [];
        var argsLength = arguments.length;
        for (var i = 0, length = getLength(array); i < length; i++) {
            var item = array[i];
            if (_.contains(result, item))
                continue;
            for (var j = 1; j < argsLength; j++) {
                if (!_.contains(arguments[j], item))
                    break;
            }
            if (j === argsLength)
                result.push(item);
        }
        return result;
    };
    // Take the difference between one array and a number of other arrays.
    // Only the elements present in just the first array will remain.
    _.difference = function (array) {
        var rest = flatten(arguments, true, true, 1);
        return _.filter(array, function (value) {
            return !_.contains(rest, value);
        });
    };
    // Zip together multiple lists into a single array -- elements that share
    // an index go together.
    _.zip = function () {
        return _.unzip(arguments);
    };
    // Complement of _.zip. Unzip accepts an array of arrays and groups
    // each array's elements on shared indices
    _.unzip = function (array) {
        var length = array && _.max(array, getLength).length || 0;
        var result = Array(length);
        for (var index = 0; index < length; index++) {
            result[index] = _.pluck(array, index);
        }
        return result;
    };
    // Converts lists into objects. Pass either a single array of `[key, value]`
    // pairs, or two parallel arrays of the same length -- one of keys, and one of
    // the corresponding values.
    _.object = function (list, values) {
        var result = {};
        for (var i = 0, length = getLength(list); i < length; i++) {
            if (values) {
                result[list[i]] = values[i];
            } else {
                result[list[i][0]] = list[i][1];
            }
        }
        return result;
    };
    // Generator function to create the findIndex and findLastIndex functions
    function createPredicateIndexFinder(dir) {
        return function (array, predicate, context) {
            predicate = cb(predicate, context);
            var length = getLength(array);
            var index = dir > 0 ? 0 : length - 1;
            for (; index >= 0 && index < length; index += dir) {
                if (predicate(array[index], index, array))
                    return index;
            }
            return -1;
        };
    }
    // Returns the first index on an array-like that passes a predicate test
    _.findIndex = createPredicateIndexFinder(1);
    _.findLastIndex = createPredicateIndexFinder(-1);
    // Use a comparator function to figure out the smallest index at which
    // an object should be inserted so as to maintain order. Uses binary search.
    _.sortedIndex = function (array, obj, iteratee, context) {
        iteratee = cb(iteratee, context, 1);
        var value = iteratee(obj);
        var low = 0, high = getLength(array);
        while (low < high) {
            var mid = Math.floor((low + high) / 2);
            if (iteratee(array[mid]) < value)
                low = mid + 1;
            else
                high = mid;
        }
        return low;
    };
    // Generator function to create the indexOf and lastIndexOf functions
    function createIndexFinder(dir, predicateFind, sortedIndex) {
        return function (array, item, idx) {
            var i = 0, length = getLength(array);
            if (typeof idx == 'number') {
                if (dir > 0) {
                    i = idx >= 0 ? idx : Math.max(idx + length, i);
                } else {
                    length = idx >= 0 ? Math.min(idx + 1, length) : idx + length + 1;
                }
            } else if (sortedIndex && idx && length) {
                idx = sortedIndex(array, item);
                return array[idx] === item ? idx : -1;
            }
            if (item !== item) {
                idx = predicateFind(slice.call(array, i, length), _.isNaN);
                return idx >= 0 ? idx + i : -1;
            }
            for (idx = dir > 0 ? i : length - 1; idx >= 0 && idx < length; idx += dir) {
                if (array[idx] === item)
                    return idx;
            }
            return -1;
        };
    }
    // Return the position of the first occurrence of an item in an array,
    // or -1 if the item is not included in the array.
    // If the array is large and already in sort order, pass `true`
    // for **isSorted** to use binary search.
    _.indexOf = createIndexFinder(1, _.findIndex, _.sortedIndex);
    _.lastIndexOf = createIndexFinder(-1, _.findLastIndex);
    // Generate an integer Array containing an arithmetic progression. A port of
    // the native Python `range()` function. See
    // [the Python documentation](http://docs.python.org/library/functions.html#range).
    _.range = function (start, stop, step) {
        if (stop == null) {
            stop = start || 0;
            start = 0;
        }
        step = step || 1;
        var length = Math.max(Math.ceil((stop - start) / step), 0);
        var range = Array(length);
        for (var idx = 0; idx < length; idx++, start += step) {
            range[idx] = start;
        }
        return range;
    };
    // Function (ahem) Functions
    // ------------------
    // Determines whether to execute a function as a constructor
    // or a normal function with the provided arguments
    var executeBound = function (sourceFunc, boundFunc, context, callingContext, args) {
        if (!(callingContext instanceof boundFunc))
            return sourceFunc.apply(context, args);
        var self = baseCreate(sourceFunc.prototype);
        var result = sourceFunc.apply(self, args);
        if (_.isObject(result))
            return result;
        return self;
    };
    // Create a function bound to a given object (assigning `this`, and arguments,
    // optionally). Delegates to **ECMAScript 5**'s native `Function.bind` if
    // available.
    _.bind = function (func, context) {
        if (nativeBind && func.bind === nativeBind)
            return nativeBind.apply(func, slice.call(arguments, 1));
        if (!_.isFunction(func))
            throw new TypeError('Bind must be called on a function');
        var args = slice.call(arguments, 2);
        var bound = function () {
            return executeBound(func, bound, context, this, args.concat(slice.call(arguments)));
        };
        return bound;
    };
    // Partially apply a function by creating a version that has had some of its
    // arguments pre-filled, without changing its dynamic `this` context. _ acts
    // as a placeholder, allowing any combination of arguments to be pre-filled.
    _.partial = function (func) {
        var boundArgs = slice.call(arguments, 1);
        var bound = function () {
            var position = 0, length = boundArgs.length;
            var args = Array(length);
            for (var i = 0; i < length; i++) {
                args[i] = boundArgs[i] === _ ? arguments[position++] : boundArgs[i];
            }
            while (position < arguments.length)
                args.push(arguments[position++]);
            return executeBound(func, bound, this, this, args);
        };
        return bound;
    };
    // Bind a number of an object's methods to that object. Remaining arguments
    // are the method names to be bound. Useful for ensuring that all callbacks
    // defined on an object belong to it.
    _.bindAll = function (obj) {
        var i, length = arguments.length, key;
        if (length <= 1)
            throw new Error('bindAll must be passed function names');
        for (i = 1; i < length; i++) {
            key = arguments[i];
            obj[key] = _.bind(obj[key], obj);
        }
        return obj;
    };
    // Memoize an expensive function by storing its results.
    _.memoize = function (func, hasher) {
        var memoize = function (key) {
            var cache = memoize.cache;
            var address = '' + (hasher ? hasher.apply(this, arguments) : key);
            if (!_.has(cache, address))
                cache[address] = func.apply(this, arguments);
            return cache[address];
        };
        memoize.cache = {};
        return memoize;
    };
    // Delays a function for the given number of milliseconds, and then calls
    // it with the arguments supplied.
    _.delay = function (func, wait) {
        var args = slice.call(arguments, 2);
        return setTimeout(function () {
            return func.apply(null, args);
        }, wait);
    };
    // Defers a function, scheduling it to run after the current call stack has
    // cleared.
    _.defer = _.partial(_.delay, _, 1);
    // Returns a function, that, when invoked, will only be triggered at most once
    // during a given window of time. Normally, the throttled function will run
    // as much as it can, without ever going more than once per `wait` duration;
    // but if you'd like to disable the execution on the leading edge, pass
    // `{leading: false}`. To disable execution on the trailing edge, ditto.
    _.throttle = function (func, wait, options) {
        var context, args, result;
        var timeout = null;
        var previous = 0;
        if (!options)
            options = {};
        var later = function () {
            previous = options.leading === false ? 0 : _.now();
            timeout = null;
            result = func.apply(context, args);
            if (!timeout)
                context = args = null;
        };
        return function () {
            var now = _.now();
            if (!previous && options.leading === false)
                previous = now;
            var remaining = wait - (now - previous);
            context = this;
            args = arguments;
            if (remaining <= 0 || remaining > wait) {
                if (timeout) {
                    clearTimeout(timeout);
                    timeout = null;
                }
                previous = now;
                result = func.apply(context, args);
                if (!timeout)
                    context = args = null;
            } else if (!timeout && options.trailing !== false) {
                timeout = setTimeout(later, remaining);
            }
            return result;
        };
    };
    // Returns a function, that, as long as it continues to be invoked, will not
    // be triggered. The function will be called after it stops being called for
    // N milliseconds. If `immediate` is passed, trigger the function on the
    // leading edge, instead of the trailing.
    _.debounce = function (func, wait, immediate) {
        var timeout, args, context, timestamp, result;
        var later = function () {
            var last = _.now() - timestamp;
            if (last < wait && last >= 0) {
                timeout = setTimeout(later, wait - last);
            } else {
                timeout = null;
                if (!immediate) {
                    result = func.apply(context, args);
                    if (!timeout)
                        context = args = null;
                }
            }
        };
        return function () {
            context = this;
            args = arguments;
            timestamp = _.now();
            var callNow = immediate && !timeout;
            if (!timeout)
                timeout = setTimeout(later, wait);
            if (callNow) {
                result = func.apply(context, args);
                context = args = null;
            }
            return result;
        };
    };
    // Returns the first function passed as an argument to the second,
    // allowing you to adjust arguments, run code before and after, and
    // conditionally execute the original function.
    _.wrap = function (func, wrapper) {
        return _.partial(wrapper, func);
    };
    // Returns a negated version of the passed-in predicate.
    _.negate = function (predicate) {
        return function () {
            return !predicate.apply(this, arguments);
        };
    };
    // Returns a function that is the composition of a list of functions, each
    // consuming the return value of the function that follows.
    _.compose = function () {
        var args = arguments;
        var start = args.length - 1;
        return function () {
            var i = start;
            var result = args[start].apply(this, arguments);
            while (i--)
                result = args[i].call(this, result);
            return result;
        };
    };
    // Returns a function that will only be executed on and after the Nth call.
    _.after = function (times, func) {
        return function () {
            if (--times < 1) {
                return func.apply(this, arguments);
            }
        };
    };
    // Returns a function that will only be executed up to (but not including) the Nth call.
    _.before = function (times, func) {
        var memo;
        return function () {
            if (--times > 0) {
                memo = func.apply(this, arguments);
            }
            if (times <= 1)
                func = null;
            return memo;
        };
    };
    // Returns a function that will be executed at most one time, no matter how
    // often you call it. Useful for lazy initialization.
    _.once = _.partial(_.before, 2);
    // Object Functions
    // ----------------
    // Keys in IE < 9 that won't be iterated by `for key in ...` and thus missed.
    var hasEnumBug = !{ toString: null }.propertyIsEnumerable('toString');
    var nonEnumerableProps = [
        'valueOf',
        'isPrototypeOf',
        'toString',
        'propertyIsEnumerable',
        'hasOwnProperty',
        'toLocaleString'
    ];
    function collectNonEnumProps(obj, keys) {
        var nonEnumIdx = nonEnumerableProps.length;
        var constructor = obj.constructor;
        var proto = _.isFunction(constructor) && constructor.prototype || ObjProto;
        // Constructor is a special case.
        var prop = 'constructor';
        if (_.has(obj, prop) && !_.contains(keys, prop))
            keys.push(prop);
        while (nonEnumIdx--) {
            prop = nonEnumerableProps[nonEnumIdx];
            if (prop in obj && obj[prop] !== proto[prop] && !_.contains(keys, prop)) {
                keys.push(prop);
            }
        }
    }
    // Retrieve the names of an object's own properties.
    // Delegates to **ECMAScript 5**'s native `Object.keys`
    _.keys = function (obj) {
        if (!_.isObject(obj))
            return [];
        if (nativeKeys)
            return nativeKeys(obj);
        var keys = [];
        for (var key in obj)
            if (_.has(obj, key))
                keys.push(key);
        // Ahem, IE < 9.
        if (hasEnumBug)
            collectNonEnumProps(obj, keys);
        return keys;
    };
    // Retrieve all the property names of an object.
    _.allKeys = function (obj) {
        if (!_.isObject(obj))
            return [];
        var keys = [];
        for (var key in obj)
            keys.push(key);
        // Ahem, IE < 9.
        if (hasEnumBug)
            collectNonEnumProps(obj, keys);
        return keys;
    };
    // Retrieve the values of an object's properties.
    _.values = function (obj) {
        var keys = _.keys(obj);
        var length = keys.length;
        var values = Array(length);
        for (var i = 0; i < length; i++) {
            values[i] = obj[keys[i]];
        }
        return values;
    };
    // Returns the results of applying the iteratee to each element of the object
    // In contrast to _.map it returns an object
    _.mapObject = function (obj, iteratee, context) {
        iteratee = cb(iteratee, context);
        var keys = _.keys(obj), length = keys.length, results = {}, currentKey;
        for (var index = 0; index < length; index++) {
            currentKey = keys[index];
            results[currentKey] = iteratee(obj[currentKey], currentKey, obj);
        }
        return results;
    };
    // Convert an object into a list of `[key, value]` pairs.
    _.pairs = function (obj) {
        var keys = _.keys(obj);
        var length = keys.length;
        var pairs = Array(length);
        for (var i = 0; i < length; i++) {
            pairs[i] = [
                keys[i],
                obj[keys[i]]
            ];
        }
        return pairs;
    };
    // Invert the keys and values of an object. The values must be serializable.
    _.invert = function (obj) {
        var result = {};
        var keys = _.keys(obj);
        for (var i = 0, length = keys.length; i < length; i++) {
            result[obj[keys[i]]] = keys[i];
        }
        return result;
    };
    // Return a sorted list of the function names available on the object.
    // Aliased as `methods`
    _.functions = _.methods = function (obj) {
        var names = [];
        for (var key in obj) {
            if (_.isFunction(obj[key]))
                names.push(key);
        }
        return names.sort();
    };
    // Extend a given object with all the properties in passed-in object(s).
    _.extend = createAssigner(_.allKeys);
    // Assigns a given object with all the own properties in the passed-in object(s)
    // (https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)
    _.extendOwn = _.assign = createAssigner(_.keys);
    // Returns the first key on an object that passes a predicate test
    _.findKey = function (obj, predicate, context) {
        predicate = cb(predicate, context);
        var keys = _.keys(obj), key;
        for (var i = 0, length = keys.length; i < length; i++) {
            key = keys[i];
            if (predicate(obj[key], key, obj))
                return key;
        }
    };
    // Return a copy of the object only containing the whitelisted properties.
    _.pick = function (object, oiteratee, context) {
        var result = {}, obj = object, iteratee, keys;
        if (obj == null)
            return result;
        if (_.isFunction(oiteratee)) {
            keys = _.allKeys(obj);
            iteratee = optimizeCb(oiteratee, context);
        } else {
            keys = flatten(arguments, false, false, 1);
            iteratee = function (value, key, obj) {
                return key in obj;
            };
            obj = Object(obj);
        }
        for (var i = 0, length = keys.length; i < length; i++) {
            var key = keys[i];
            var value = obj[key];
            if (iteratee(value, key, obj))
                result[key] = value;
        }
        return result;
    };
    // Return a copy of the object without the blacklisted properties.
    _.omit = function (obj, iteratee, context) {
        if (_.isFunction(iteratee)) {
            iteratee = _.negate(iteratee);
        } else {
            var keys = _.map(flatten(arguments, false, false, 1), String);
            iteratee = function (value, key) {
                return !_.contains(keys, key);
            };
        }
        return _.pick(obj, iteratee, context);
    };
    // Fill in a given object with default properties.
    _.defaults = createAssigner(_.allKeys, true);
    // Creates an object that inherits from the given prototype object.
    // If additional properties are provided then they will be added to the
    // created object.
    _.create = function (prototype, props) {
        var result = baseCreate(prototype);
        if (props)
            _.extendOwn(result, props);
        return result;
    };
    // Create a (shallow-cloned) duplicate of an object.
    _.clone = function (obj) {
        if (!_.isObject(obj))
            return obj;
        return _.isArray(obj) ? obj.slice() : _.extend({}, obj);
    };
    // Invokes interceptor with the obj, and then returns obj.
    // The primary purpose of this method is to "tap into" a method chain, in
    // order to perform operations on intermediate results within the chain.
    _.tap = function (obj, interceptor) {
        interceptor(obj);
        return obj;
    };
    // Returns whether an object has a given set of `key:value` pairs.
    _.isMatch = function (object, attrs) {
        var keys = _.keys(attrs), length = keys.length;
        if (object == null)
            return !length;
        var obj = Object(object);
        for (var i = 0; i < length; i++) {
            var key = keys[i];
            if (attrs[key] !== obj[key] || !(key in obj))
                return false;
        }
        return true;
    };
    // Internal recursive comparison function for `isEqual`.
    var eq = function (a, b, aStack, bStack) {
        // Identical objects are equal. `0 === -0`, but they aren't identical.
        // See the [Harmony `egal` proposal](http://wiki.ecmascript.org/doku.php?id=harmony:egal).
        if (a === b)
            return a !== 0 || 1 / a === 1 / b;
        // A strict comparison is necessary because `null == undefined`.
        if (a == null || b == null)
            return a === b;
        // Unwrap any wrapped objects.
        if (a instanceof _)
            a = a._wrapped;
        if (b instanceof _)
            b = b._wrapped;
        // Compare `[[Class]]` names.
        var className = toString.call(a);
        if (className !== toString.call(b))
            return false;
        switch (className) {
        // Strings, numbers, regular expressions, dates, and booleans are compared by value.
        case '[object RegExp]':
        // RegExps are coerced to strings for comparison (Note: '' + /a/i === '/a/i')
        case '[object String]':
            // Primitives and their corresponding object wrappers are equivalent; thus, `"5"` is
            // equivalent to `new String("5")`.
            return '' + a === '' + b;
        case '[object Number]':
            // `NaN`s are equivalent, but non-reflexive.
            // Object(NaN) is equivalent to NaN
            if (+a !== +a)
                return +b !== +b;
            // An `egal` comparison is performed for other numeric values.
            return +a === 0 ? 1 / +a === 1 / b : +a === +b;
        case '[object Date]':
        case '[object Boolean]':
            // Coerce dates and booleans to numeric primitive values. Dates are compared by their
            // millisecond representations. Note that invalid dates with millisecond representations
            // of `NaN` are not equivalent.
            return +a === +b;
        }
        var areArrays = className === '[object Array]';
        if (!areArrays) {
            if (typeof a != 'object' || typeof b != 'object')
                return false;
            // Objects with different constructors are not equivalent, but `Object`s or `Array`s
            // from different frames are.
            var aCtor = a.constructor, bCtor = b.constructor;
            if (aCtor !== bCtor && !(_.isFunction(aCtor) && aCtor instanceof aCtor && _.isFunction(bCtor) && bCtor instanceof bCtor) && ('constructor' in a && 'constructor' in b)) {
                return false;
            }
        }
        // Assume equality for cyclic structures. The algorithm for detecting cyclic
        // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.
        // Initializing stack of traversed objects.
        // It's done here since we only need them for objects and arrays comparison.
        aStack = aStack || [];
        bStack = bStack || [];
        var length = aStack.length;
        while (length--) {
            // Linear search. Performance is inversely proportional to the number of
            // unique nested structures.
            if (aStack[length] === a)
                return bStack[length] === b;
        }
        // Add the first object to the stack of traversed objects.
        aStack.push(a);
        bStack.push(b);
        // Recursively compare objects and arrays.
        if (areArrays) {
            // Compare array lengths to determine if a deep comparison is necessary.
            length = a.length;
            if (length !== b.length)
                return false;
            // Deep compare the contents, ignoring non-numeric properties.
            while (length--) {
                if (!eq(a[length], b[length], aStack, bStack))
                    return false;
            }
        } else {
            // Deep compare objects.
            var keys = _.keys(a), key;
            length = keys.length;
            // Ensure that both objects contain the same number of properties before comparing deep equality.
            if (_.keys(b).length !== length)
                return false;
            while (length--) {
                // Deep compare each member
                key = keys[length];
                if (!(_.has(b, key) && eq(a[key], b[key], aStack, bStack)))
                    return false;
            }
        }
        // Remove the first object from the stack of traversed objects.
        aStack.pop();
        bStack.pop();
        return true;
    };
    // Perform a deep comparison to check if two objects are equal.
    _.isEqual = function (a, b) {
        return eq(a, b);
    };
    // Is a given array, string, or object empty?
    // An "empty" object has no enumerable own-properties.
    _.isEmpty = function (obj) {
        if (obj == null)
            return true;
        if (isArrayLike(obj) && (_.isArray(obj) || _.isString(obj) || _.isArguments(obj)))
            return obj.length === 0;
        return _.keys(obj).length === 0;
    };
    // Is a given value a DOM element?
    _.isElement = function (obj) {
        return !!(obj && obj.nodeType === 1);
    };
    // Is a given value an array?
    // Delegates to ECMA5's native Array.isArray
    _.isArray = nativeIsArray || function (obj) {
        return toString.call(obj) === '[object Array]';
    };
    // Is a given variable an object?
    _.isObject = function (obj) {
        var type = typeof obj;
        return type === 'function' || type === 'object' && !!obj;
    };
    // Add some isType methods: isArguments, isFunction, isString, isNumber, isDate, isRegExp, isError.
    _.each([
        'Arguments',
        'Function',
        'String',
        'Number',
        'Date',
        'RegExp',
        'Error'
    ], function (name) {
        _['is' + name] = function (obj) {
            return toString.call(obj) === '[object ' + name + ']';
        };
    });
    // Define a fallback version of the method in browsers (ahem, IE < 9), where
    // there isn't any inspectable "Arguments" type.
    if (!_.isArguments(arguments)) {
        _.isArguments = function (obj) {
            return _.has(obj, 'callee');
        };
    }
    // Optimize `isFunction` if appropriate. Work around some typeof bugs in old v8,
    // IE 11 (#1621), and in Safari 8 (#1929).
    if (typeof /./ != 'function' && typeof Int8Array != 'object') {
        _.isFunction = function (obj) {
            return typeof obj == 'function' || false;
        };
    }
    // Is a given object a finite number?
    _.isFinite = function (obj) {
        return isFinite(obj) && !isNaN(parseFloat(obj));
    };
    // Is the given value `NaN`? (NaN is the only number which does not equal itself).
    _.isNaN = function (obj) {
        return _.isNumber(obj) && obj !== +obj;
    };
    // Is a given value a boolean?
    _.isBoolean = function (obj) {
        return obj === true || obj === false || toString.call(obj) === '[object Boolean]';
    };
    // Is a given value equal to null?
    _.isNull = function (obj) {
        return obj === null;
    };
    // Is a given variable undefined?
    _.isUndefined = function (obj) {
        return obj === void 0;
    };
    // Shortcut function for checking if an object has a given property directly
    // on itself (in other words, not on a prototype).
    _.has = function (obj, key) {
        return obj != null && hasOwnProperty.call(obj, key);
    };
    // Utility Functions
    // -----------------
    // Run Underscore.js in *noConflict* mode, returning the `_` variable to its
    // previous owner. Returns a reference to the Underscore object.
    _.noConflict = function () {
        root._ = previousUnderscore;
        return this;
    };
    // Keep the identity function around for default iteratees.
    _.identity = function (value) {
        return value;
    };
    // Predicate-generating functions. Often useful outside of Underscore.
    _.constant = function (value) {
        return function () {
            return value;
        };
    };
    _.noop = function () {
    };
    _.property = property;
    // Generates a function for a given object that returns a given property.
    _.propertyOf = function (obj) {
        return obj == null ? function () {
        } : function (key) {
            return obj[key];
        };
    };
    // Returns a predicate for checking whether an object has a given set of
    // `key:value` pairs.
    _.matcher = _.matches = function (attrs) {
        attrs = _.extendOwn({}, attrs);
        return function (obj) {
            return _.isMatch(obj, attrs);
        };
    };
    // Run a function **n** times.
    _.times = function (n, iteratee, context) {
        var accum = Array(Math.max(0, n));
        iteratee = optimizeCb(iteratee, context, 1);
        for (var i = 0; i < n; i++)
            accum[i] = iteratee(i);
        return accum;
    };
    // Return a random integer between min and max (inclusive).
    _.random = function (min, max) {
        if (max == null) {
            max = min;
            min = 0;
        }
        return min + Math.floor(Math.random() * (max - min + 1));
    };
    // A (possibly faster) way to get the current timestamp as an integer.
    _.now = Date.now || function () {
        return new Date().getTime();
    };
    // List of HTML entities for escaping.
    var escapeMap = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        '\'': '&#x27;',
        '`': '&#x60;'
    };
    var unescapeMap = _.invert(escapeMap);
    // Functions for escaping and unescaping strings to/from HTML interpolation.
    var createEscaper = function (map) {
        var escaper = function (match) {
            return map[match];
        };
        // Regexes for identifying a key that needs to be escaped
        var source = '(?:' + _.keys(map).join('|') + ')';
        var testRegexp = RegExp(source);
        var replaceRegexp = RegExp(source, 'g');
        return function (string) {
            string = string == null ? '' : '' + string;
            return testRegexp.test(string) ? string.replace(replaceRegexp, escaper) : string;
        };
    };
    _.escape = createEscaper(escapeMap);
    _.unescape = createEscaper(unescapeMap);
    // If the value of the named `property` is a function then invoke it with the
    // `object` as context; otherwise, return it.
    _.result = function (object, property, fallback) {
        var value = object == null ? void 0 : object[property];
        if (value === void 0) {
            value = fallback;
        }
        return _.isFunction(value) ? value.call(object) : value;
    };
    // Generate a unique integer id (unique within the entire client session).
    // Useful for temporary DOM ids.
    var idCounter = 0;
    _.uniqueId = function (prefix) {
        var id = ++idCounter + '';
        return prefix ? prefix + id : id;
    };
    // By default, Underscore uses ERB-style template delimiters, change the
    // following template settings to use alternative delimiters.
    _.templateSettings = {
        evaluate: /<%([\s\S]+?)%>/g,
        interpolate: /<%=([\s\S]+?)%>/g,
        escape: /<%-([\s\S]+?)%>/g
    };
    // When customizing `templateSettings`, if you don't want to define an
    // interpolation, evaluation or escaping regex, we need one that is
    // guaranteed not to match.
    var noMatch = /(.)^/;
    // Certain characters need to be escaped so that they can be put into a
    // string literal.
    var escapes = {
        '\'': '\'',
        '\\': '\\',
        '\r': 'r',
        '\n': 'n',
        '\u2028': 'u2028',
        '\u2029': 'u2029'
    };
    var escaper = /\\|'|\r|\n|\u2028|\u2029/g;
    var escapeChar = function (match) {
        return '\\' + escapes[match];
    };
    // JavaScript micro-templating, similar to John Resig's implementation.
    // Underscore templating handles arbitrary delimiters, preserves whitespace,
    // and correctly escapes quotes within interpolated code.
    // NB: `oldSettings` only exists for backwards compatibility.
    _.template = function (text, settings, oldSettings) {
        if (!settings && oldSettings)
            settings = oldSettings;
        settings = _.defaults({}, settings, _.templateSettings);
        // Combine delimiters into one regular expression via alternation.
        var matcher = RegExp([
            (settings.escape || noMatch).source,
            (settings.interpolate || noMatch).source,
            (settings.evaluate || noMatch).source
        ].join('|') + '|$', 'g');
        // Compile the template source, escaping string literals appropriately.
        var index = 0;
        var source = '__p+=\'';
        text.replace(matcher, function (match, escape, interpolate, evaluate, offset) {
            source += text.slice(index, offset).replace(escaper, escapeChar);
            index = offset + match.length;
            if (escape) {
                source += '\'+\n((__t=(' + escape + '))==null?\'\':_.escape(__t))+\n\'';
            } else if (interpolate) {
                source += '\'+\n((__t=(' + interpolate + '))==null?\'\':__t)+\n\'';
            } else if (evaluate) {
                source += '\';\n' + evaluate + '\n__p+=\'';
            }
            // Adobe VMs need the match returned to produce the correct offest.
            return match;
        });
        source += '\';\n';
        // If a variable is not specified, place data values in local scope.
        if (!settings.variable)
            source = 'with(obj||{}){\n' + source + '}\n';
        source = 'var __t,__p=\'\',__j=Array.prototype.join,' + 'print=function(){__p+=__j.call(arguments,\'\');};\n' + source + 'return __p;\n';
        try {
            var render = new Function(settings.variable || 'obj', '_', source);
        } catch (e) {
            e.source = source;
            throw e;
        }
        var template = function (data) {
            return render.call(this, data, _);
        };
        // Provide the compiled source as a convenience for precompilation.
        var argument = settings.variable || 'obj';
        template.source = 'function(' + argument + '){\n' + source + '}';
        return template;
    };
    // Add a "chain" function. Start chaining a wrapped Underscore object.
    _.chain = function (obj) {
        var instance = _(obj);
        instance._chain = true;
        return instance;
    };
    // OOP
    // ---------------
    // If Underscore is called as a function, it returns a wrapped object that
    // can be used OO-style. This wrapper holds altered versions of all the
    // underscore functions. Wrapped objects may be chained.
    // Helper function to continue chaining intermediate results.
    var result = function (instance, obj) {
        return instance._chain ? _(obj).chain() : obj;
    };
    // Add your own custom functions to the Underscore object.
    _.mixin = function (obj) {
        _.each(_.functions(obj), function (name) {
            var func = _[name] = obj[name];
            _.prototype[name] = function () {
                var args = [this._wrapped];
                push.apply(args, arguments);
                return result(this, func.apply(_, args));
            };
        });
    };
    // Add all of the Underscore functions to the wrapper object.
    _.mixin(_);
    // Add all mutator Array functions to the wrapper.
    _.each([
        'pop',
        'push',
        'reverse',
        'shift',
        'sort',
        'splice',
        'unshift'
    ], function (name) {
        var method = ArrayProto[name];
        _.prototype[name] = function () {
            var obj = this._wrapped;
            method.apply(obj, arguments);
            if ((name === 'shift' || name === 'splice') && obj.length === 0)
                delete obj[0];
            return result(this, obj);
        };
    });
    // Add all accessor Array functions to the wrapper.
    _.each([
        'concat',
        'join',
        'slice'
    ], function (name) {
        var method = ArrayProto[name];
        _.prototype[name] = function () {
            return result(this, method.apply(this._wrapped, arguments));
        };
    });
    // Extracts the result from a wrapped and chained object.
    _.prototype.value = function () {
        return this._wrapped;
    };
    // Provide unwrapping proxy for some methods used in engine operations
    // such as arithmetic and JSON stringification.
    _.prototype.valueOf = _.prototype.toJSON = _.prototype.value;
    _.prototype.toString = function () {
        return '' + this._wrapped;
    };
    // AMD registration happens at the end for compatibility with AMD loaders
    // that may not enforce next-turn semantics on modules. Even though general
    // practice for AMD registration is to be anonymous, underscore registers
    // as a named module because, like jQuery, it is a base library that is
    // popular enough to be bundled in a third party lib, but not be part of
    // an AMD load request. Those cases could generate an error when an
    // anonymous define() is called outside of a loader request.
    if (typeof define === 'function' && define.amd) {
        define('underscore', [], function () {
            return _;
        });
    }
}.call(this));
/*!
 * jQuery JavaScript Library v1.11.1
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-05-01T17:42Z
 */
define('jQuery', [], function () {
    (function (global, factory) {
        if (typeof module === 'object' && typeof module.exports === 'object') {
            // For CommonJS and CommonJS-like environments where a proper window is present,
            // execute the factory and get jQuery
            // For environments that do not inherently posses a window with a document
            // (such as Node.js), expose a jQuery-making factory as module.exports
            // This accentuates the need for the creation of a real window
            // e.g. var jQuery = require("jquery")(window);
            // See ticket #14549 for more info
            module.exports = global.document ? factory(global, true) : function (w) {
                if (!w.document) {
                    throw new Error('jQuery requires a window with a document');
                }
                return factory(w);
            };
        } else {
            factory(global);
        }    // Pass this if window is not defined yet
    }(typeof window !== 'undefined' ? window : this, function (window, noGlobal) {
        // Can't do this because several apps including ASP.NET trace
        // the stack via arguments.caller.callee and Firefox dies if
        // you try to trace through "use strict" call chains. (#13335)
        // Support: Firefox 18+
        //
        var deletedIds = [];
        var slice = deletedIds.slice;
        var concat = deletedIds.concat;
        var push = deletedIds.push;
        var indexOf = deletedIds.indexOf;
        var class2type = {};
        var toString = class2type.toString;
        var hasOwn = class2type.hasOwnProperty;
        var support = {};
        var version = '1.11.1',
            // Define a local copy of jQuery
            jQuery = function (selector, context) {
                // The jQuery object is actually just the init constructor 'enhanced'
                // Need init if jQuery is called (just allow error to be thrown if not included)
                return new jQuery.fn.init(selector, context);
            },
            // Support: Android<4.1, IE<9
            // Make sure we trim BOM and NBSP
            rtrim = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,
            // Matches dashed string for camelizing
            rmsPrefix = /^-ms-/, rdashAlpha = /-([\da-z])/gi,
            // Used by jQuery.camelCase as callback to replace()
            fcamelCase = function (all, letter) {
                return letter.toUpperCase();
            };
        jQuery.fn = jQuery.prototype = {
            // The current version of jQuery being used
            jquery: version,
            constructor: jQuery,
            // Start with an empty selector
            selector: '',
            // The default length of a jQuery object is 0
            length: 0,
            toArray: function () {
                return slice.call(this);
            },
            // Get the Nth element in the matched element set OR
            // Get the whole matched element set as a clean array
            get: function (num) {
                return num != null ? // Return just the one element from the set
                num < 0 ? this[num + this.length] : this[num] : // Return all the elements in a clean array
                slice.call(this);
            },
            // Take an array of elements and push it onto the stack
            // (returning the new matched element set)
            pushStack: function (elems) {
                // Build a new jQuery matched element set
                var ret = jQuery.merge(this.constructor(), elems);
                // Add the old object onto the stack (as a reference)
                ret.prevObject = this;
                ret.context = this.context;
                // Return the newly-formed element set
                return ret;
            },
            // Execute a callback for every element in the matched set.
            // (You can seed the arguments with an array of args, but this is
            // only used internally.)
            each: function (callback, args) {
                return jQuery.each(this, callback, args);
            },
            map: function (callback) {
                return this.pushStack(jQuery.map(this, function (elem, i) {
                    return callback.call(elem, i, elem);
                }));
            },
            slice: function () {
                return this.pushStack(slice.apply(this, arguments));
            },
            first: function () {
                return this.eq(0);
            },
            last: function () {
                return this.eq(-1);
            },
            eq: function (i) {
                var len = this.length, j = +i + (i < 0 ? len : 0);
                return this.pushStack(j >= 0 && j < len ? [this[j]] : []);
            },
            end: function () {
                return this.prevObject || this.constructor(null);
            },
            // For internal use only.
            // Behaves like an Array's method, not like a jQuery method.
            push: push,
            sort: deletedIds.sort,
            splice: deletedIds.splice
        };
        jQuery.extend = jQuery.fn.extend = function () {
            var src, copyIsArray, copy, name, options, clone, target = arguments[0] || {}, i = 1, length = arguments.length, deep = false;
            // Handle a deep copy situation
            if (typeof target === 'boolean') {
                deep = target;
                // skip the boolean and the target
                target = arguments[i] || {};
                i++;
            }
            // Handle case when target is a string or something (possible in deep copy)
            if (typeof target !== 'object' && !jQuery.isFunction(target)) {
                target = {};
            }
            // extend jQuery itself if only one argument is passed
            if (i === length) {
                target = this;
                i--;
            }
            for (; i < length; i++) {
                // Only deal with non-null/undefined values
                if ((options = arguments[i]) != null) {
                    // Extend the base object
                    for (name in options) {
                        src = target[name];
                        copy = options[name];
                        // Prevent never-ending loop
                        if (target === copy) {
                            continue;
                        }
                        // Recurse if we're merging plain objects or arrays
                        if (deep && copy && (jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)))) {
                            if (copyIsArray) {
                                copyIsArray = false;
                                clone = src && jQuery.isArray(src) ? src : [];
                            } else {
                                clone = src && jQuery.isPlainObject(src) ? src : {};
                            }
                            // Never move original objects, clone them
                            target[name] = jQuery.extend(deep, clone, copy);    // Don't bring in undefined values
                        } else if (copy !== undefined) {
                            target[name] = copy;
                        }
                    }
                }
            }
            // Return the modified object
            return target;
        };
        jQuery.extend({
            // Unique for each copy of jQuery on the page
            expando: 'jQuery' + (version + Math.random()).replace(/\D/g, ''),
            // Assume jQuery is ready without the ready module
            isReady: true,
            error: function (msg) {
                throw new Error(msg);
            },
            noop: function () {
            },
            // See test/unit/core.js for details concerning isFunction.
            // Since version 1.3, DOM methods and functions like alert
            // aren't supported. They return false on IE (#2968).
            isFunction: function (obj) {
                return jQuery.type(obj) === 'function';
            },
            isArray: Array.isArray || function (obj) {
                return jQuery.type(obj) === 'array';
            },
            isWindow: function (obj) {
                /* jshint eqeqeq: false */
                return obj != null && obj == obj.window;
            },
            isNumeric: function (obj) {
                // parseFloat NaNs numeric-cast false positives (null|true|false|"")
                // ...but misinterprets leading-number strings, particularly hex literals ("0x...")
                // subtraction forces infinities to NaN
                return !jQuery.isArray(obj) && obj - parseFloat(obj) >= 0;
            },
            isEmptyObject: function (obj) {
                var name;
                for (name in obj) {
                    return false;
                }
                return true;
            },
            isPlainObject: function (obj) {
                var key;
                // Must be an Object.
                // Because of IE, we also have to check the presence of the constructor property.
                // Make sure that DOM nodes and window objects don't pass through, as well
                if (!obj || jQuery.type(obj) !== 'object' || obj.nodeType || jQuery.isWindow(obj)) {
                    return false;
                }
                try {
                    // Not own constructor property must be Object
                    if (obj.constructor && !hasOwn.call(obj, 'constructor') && !hasOwn.call(obj.constructor.prototype, 'isPrototypeOf')) {
                        return false;
                    }
                } catch (e) {
                    // IE8,9 Will throw exceptions on certain host objects #9897
                    return false;
                }
                // Support: IE<9
                // Handle iteration over inherited properties before own properties.
                if (support.ownLast) {
                    for (key in obj) {
                        return hasOwn.call(obj, key);
                    }
                }
                // Own properties are enumerated firstly, so to speed up,
                // if last one is own, then all properties are own.
                for (key in obj) {
                }
                return key === undefined || hasOwn.call(obj, key);
            },
            type: function (obj) {
                if (obj == null) {
                    return obj + '';
                }
                return typeof obj === 'object' || typeof obj === 'function' ? class2type[toString.call(obj)] || 'object' : typeof obj;
            },
            // Evaluates a script in a global context
            // Workarounds based on findings by Jim Driscoll
            // http://weblogs.java.net/blog/driscoll/archive/2009/09/08/eval-javascript-global-context
            globalEval: function (data) {
                if (data && jQuery.trim(data)) {
                    // We use execScript on Internet Explorer
                    // We use an anonymous function so that context is window
                    // rather than jQuery in Firefox
                    (window.execScript || function (data) {
                        window['eval'].call(window, data);
                    })(data);
                }
            },
            // Convert dashed to camelCase; used by the css and data modules
            // Microsoft forgot to hump their vendor prefix (#9572)
            camelCase: function (string) {
                return string.replace(rmsPrefix, 'ms-').replace(rdashAlpha, fcamelCase);
            },
            nodeName: function (elem, name) {
                return elem.nodeName && elem.nodeName.toLowerCase() === name.toLowerCase();
            },
            // args is for internal usage only
            each: function (obj, callback, args) {
                var value, i = 0, length = obj.length, isArray = isArraylike(obj);
                if (args) {
                    if (isArray) {
                        for (; i < length; i++) {
                            value = callback.apply(obj[i], args);
                            if (value === false) {
                                break;
                            }
                        }
                    } else {
                        for (i in obj) {
                            value = callback.apply(obj[i], args);
                            if (value === false) {
                                break;
                            }
                        }
                    }    // A special, fast, case for the most common use of each
                } else {
                    if (isArray) {
                        for (; i < length; i++) {
                            value = callback.call(obj[i], i, obj[i]);
                            if (value === false) {
                                break;
                            }
                        }
                    } else {
                        for (i in obj) {
                            value = callback.call(obj[i], i, obj[i]);
                            if (value === false) {
                                break;
                            }
                        }
                    }
                }
                return obj;
            },
            // Support: Android<4.1, IE<9
            trim: function (text) {
                return text == null ? '' : (text + '').replace(rtrim, '');
            },
            // results is for internal usage only
            makeArray: function (arr, results) {
                var ret = results || [];
                if (arr != null) {
                    if (isArraylike(Object(arr))) {
                        jQuery.merge(ret, typeof arr === 'string' ? [arr] : arr);
                    } else {
                        push.call(ret, arr);
                    }
                }
                return ret;
            },
            inArray: function (elem, arr, i) {
                var len;
                if (arr) {
                    if (indexOf) {
                        return indexOf.call(arr, elem, i);
                    }
                    len = arr.length;
                    i = i ? i < 0 ? Math.max(0, len + i) : i : 0;
                    for (; i < len; i++) {
                        // Skip accessing in sparse arrays
                        if (i in arr && arr[i] === elem) {
                            return i;
                        }
                    }
                }
                return -1;
            },
            merge: function (first, second) {
                var len = +second.length, j = 0, i = first.length;
                while (j < len) {
                    first[i++] = second[j++];
                }
                // Support: IE<9
                // Workaround casting of .length to NaN on otherwise arraylike objects (e.g., NodeLists)
                if (len !== len) {
                    while (second[j] !== undefined) {
                        first[i++] = second[j++];
                    }
                }
                first.length = i;
                return first;
            },
            grep: function (elems, callback, invert) {
                var callbackInverse, matches = [], i = 0, length = elems.length, callbackExpect = !invert;
                // Go through the array, only saving the items
                // that pass the validator function
                for (; i < length; i++) {
                    callbackInverse = !callback(elems[i], i);
                    if (callbackInverse !== callbackExpect) {
                        matches.push(elems[i]);
                    }
                }
                return matches;
            },
            // arg is for internal usage only
            map: function (elems, callback, arg) {
                var value, i = 0, length = elems.length, isArray = isArraylike(elems), ret = [];
                // Go through the array, translating each of the items to their new values
                if (isArray) {
                    for (; i < length; i++) {
                        value = callback(elems[i], i, arg);
                        if (value != null) {
                            ret.push(value);
                        }
                    }    // Go through every key on the object,
                } else {
                    for (i in elems) {
                        value = callback(elems[i], i, arg);
                        if (value != null) {
                            ret.push(value);
                        }
                    }
                }
                // Flatten any nested arrays
                return concat.apply([], ret);
            },
            // A global GUID counter for objects
            guid: 1,
            // Bind a function to a context, optionally partially applying any
            // arguments.
            proxy: function (fn, context) {
                var args, proxy, tmp;
                if (typeof context === 'string') {
                    tmp = fn[context];
                    context = fn;
                    fn = tmp;
                }
                // Quick check to determine if target is callable, in the spec
                // this throws a TypeError, but we will just return undefined.
                if (!jQuery.isFunction(fn)) {
                    return undefined;
                }
                // Simulated bind
                args = slice.call(arguments, 2);
                proxy = function () {
                    return fn.apply(context || this, args.concat(slice.call(arguments)));
                };
                // Set the guid of unique handler to the same of original handler, so it can be removed
                proxy.guid = fn.guid = fn.guid || jQuery.guid++;
                return proxy;
            },
            now: function () {
                return +new Date();
            },
            // jQuery.support is not used in Core but other projects attach their
            // properties to it so it needs to exist.
            support: support
        });
        // Populate the class2type map
        jQuery.each('Boolean Number String Function Array Date RegExp Object Error'.split(' '), function (i, name) {
            class2type['[object ' + name + ']'] = name.toLowerCase();
        });
        function isArraylike(obj) {
            var length = obj.length, type = jQuery.type(obj);
            if (type === 'function' || jQuery.isWindow(obj)) {
                return false;
            }
            if (obj.nodeType === 1 && length) {
                return true;
            }
            return type === 'array' || length === 0 || typeof length === 'number' && length > 0 && length - 1 in obj;
        }
        var Sizzle = /*!
 * Sizzle CSS Selector Engine v1.10.19
 * http://sizzlejs.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-04-18
 */
        function (window) {
            var i, support, Expr, getText, isXML, tokenize, compile, select, outermostContext, sortInput, hasDuplicate,
                // Local document vars
                setDocument, document, docElem, documentIsHTML, rbuggyQSA, rbuggyMatches, matches, contains,
                // Instance-specific data
                expando = 'sizzle' + -new Date(), preferredDoc = window.document, dirruns = 0, done = 0, classCache = createCache(), tokenCache = createCache(), compilerCache = createCache(), sortOrder = function (a, b) {
                    if (a === b) {
                        hasDuplicate = true;
                    }
                    return 0;
                },
                // General-purpose constants
                strundefined = typeof undefined, MAX_NEGATIVE = 1 << 31,
                // Instance methods
                hasOwn = {}.hasOwnProperty, arr = [], pop = arr.pop, push_native = arr.push, push = arr.push, slice = arr.slice,
                // Use a stripped-down indexOf if we can't use a native one
                indexOf = arr.indexOf || function (elem) {
                    var i = 0, len = this.length;
                    for (; i < len; i++) {
                        if (this[i] === elem) {
                            return i;
                        }
                    }
                    return -1;
                }, booleans = 'checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped',
                // Regular expressions
                // Whitespace characters http://www.w3.org/TR/css3-selectors/#whitespace
                whitespace = '[\\x20\\t\\r\\n\\f]',
                // http://www.w3.org/TR/css3-syntax/#characters
                characterEncoding = '(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+',
                // Loosely modeled on CSS identifier characters
                // An unquoted value should be a CSS identifier http://www.w3.org/TR/css3-selectors/#attribute-selectors
                // Proper syntax: http://www.w3.org/TR/CSS21/syndata.html#value-def-identifier
                identifier = characterEncoding.replace('w', 'w#'),
                // Attribute selectors: http://www.w3.org/TR/selectors/#attribute-selectors
                attributes = '\\[' + whitespace + '*(' + characterEncoding + ')(?:' + whitespace + // Operator (capture 2)
                '*([*^$|!~]?=)' + whitespace + // "Attribute values must be CSS identifiers [capture 5] or strings [capture 3 or capture 4]"
                '*(?:\'((?:\\\\.|[^\\\\\'])*)\'|"((?:\\\\.|[^\\\\"])*)"|(' + identifier + '))|)' + whitespace + '*\\]', pseudos = ':(' + characterEncoding + ')(?:\\((' + // To reduce the number of selectors needing tokenize in the preFilter, prefer arguments:
                // 1. quoted (capture 3; capture 4 or capture 5)
                '(\'((?:\\\\.|[^\\\\\'])*)\'|"((?:\\\\.|[^\\\\"])*)")|' + // 2. simple (capture 6)
                '((?:\\\\.|[^\\\\()[\\]]|' + attributes + ')*)|' + // 3. anything else (capture 2)
                '.*' + ')\\)|)',
                // Leading and non-escaped trailing whitespace, capturing some non-whitespace characters preceding the latter
                rtrim = new RegExp('^' + whitespace + '+|((?:^|[^\\\\])(?:\\\\.)*)' + whitespace + '+$', 'g'), rcomma = new RegExp('^' + whitespace + '*,' + whitespace + '*'), rcombinators = new RegExp('^' + whitespace + '*([>+~]|' + whitespace + ')' + whitespace + '*'), rattributeQuotes = new RegExp('=' + whitespace + '*([^\\]\'"]*?)' + whitespace + '*\\]', 'g'), rpseudo = new RegExp(pseudos), ridentifier = new RegExp('^' + identifier + '$'), matchExpr = {
                    'ID': new RegExp('^#(' + characterEncoding + ')'),
                    'CLASS': new RegExp('^\\.(' + characterEncoding + ')'),
                    'TAG': new RegExp('^(' + characterEncoding.replace('w', 'w*') + ')'),
                    'ATTR': new RegExp('^' + attributes),
                    'PSEUDO': new RegExp('^' + pseudos),
                    'CHILD': new RegExp('^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(' + whitespace + '*(even|odd|(([+-]|)(\\d*)n|)' + whitespace + '*(?:([+-]|)' + whitespace + '*(\\d+)|))' + whitespace + '*\\)|)', 'i'),
                    'bool': new RegExp('^(?:' + booleans + ')$', 'i'),
                    // For use in libraries implementing .is()
                    // We use this for POS matching in `select`
                    'needsContext': new RegExp('^' + whitespace + '*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(' + whitespace + '*((?:-\\d)?\\d*)' + whitespace + '*\\)|)(?=[^-]|$)', 'i')
                }, rinputs = /^(?:input|select|textarea|button)$/i, rheader = /^h\d$/i, rnative = /^[^{]+\{\s*\[native \w/,
                // Easily-parseable/retrievable ID or TAG or CLASS selectors
                rquickExpr = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, rsibling = /[+~]/, rescape = /'|\\/g,
                // CSS escapes http://www.w3.org/TR/CSS21/syndata.html#escaped-characters
                runescape = new RegExp('\\\\([\\da-f]{1,6}' + whitespace + '?|(' + whitespace + ')|.)', 'ig'), funescape = function (_, escaped, escapedWhitespace) {
                    var high = '0x' + escaped - 65536;
                    // NaN means non-codepoint
                    // Support: Firefox<24
                    // Workaround erroneous numeric interpretation of +"0x"
                    return high !== high || escapedWhitespace ? escaped : high < 0 ? // BMP codepoint
                    String.fromCharCode(high + 65536) : // Supplemental Plane codepoint (surrogate pair)
                    String.fromCharCode(high >> 10 | 55296, high & 1023 | 56320);
                };
            // Optimize for push.apply( _, NodeList )
            try {
                push.apply(arr = slice.call(preferredDoc.childNodes), preferredDoc.childNodes);
                // Support: Android<4.0
                // Detect silently failing push.apply
                arr[preferredDoc.childNodes.length].nodeType;
            } catch (e) {
                push = {
                    apply: arr.length ? // Leverage slice if possible
                    function (target, els) {
                        push_native.apply(target, slice.call(els));
                    } : // Support: IE<9
                    // Otherwise append directly
                    function (target, els) {
                        var j = target.length, i = 0;
                        // Can't trust NodeList.length
                        while (target[j++] = els[i++]) {
                        }
                        target.length = j - 1;
                    }
                };
            }
            function Sizzle(selector, context, results, seed) {
                var match, elem, m, nodeType,
                    // QSA vars
                    i, groups, old, nid, newContext, newSelector;
                if ((context ? context.ownerDocument || context : preferredDoc) !== document) {
                    setDocument(context);
                }
                context = context || document;
                results = results || [];
                if (!selector || typeof selector !== 'string') {
                    return results;
                }
                if ((nodeType = context.nodeType) !== 1 && nodeType !== 9) {
                    return [];
                }
                if (documentIsHTML && !seed) {
                    // Shortcuts
                    if (match = rquickExpr.exec(selector)) {
                        // Speed-up: Sizzle("#ID")
                        if (m = match[1]) {
                            if (nodeType === 9) {
                                elem = context.getElementById(m);
                                // Check parentNode to catch when Blackberry 4.6 returns
                                // nodes that are no longer in the document (jQuery #6963)
                                if (elem && elem.parentNode) {
                                    // Handle the case where IE, Opera, and Webkit return items
                                    // by name instead of ID
                                    if (elem.id === m) {
                                        results.push(elem);
                                        return results;
                                    }
                                } else {
                                    return results;
                                }
                            } else {
                                // Context is not a document
                                if (context.ownerDocument && (elem = context.ownerDocument.getElementById(m)) && contains(context, elem) && elem.id === m) {
                                    results.push(elem);
                                    return results;
                                }
                            }    // Speed-up: Sizzle("TAG")
                        } else if (match[2]) {
                            push.apply(results, context.getElementsByTagName(selector));
                            return results;    // Speed-up: Sizzle(".CLASS")
                        } else if ((m = match[3]) && support.getElementsByClassName && context.getElementsByClassName) {
                            push.apply(results, context.getElementsByClassName(m));
                            return results;
                        }
                    }
                    // QSA path
                    if (support.qsa && (!rbuggyQSA || !rbuggyQSA.test(selector))) {
                        nid = old = expando;
                        newContext = context;
                        newSelector = nodeType === 9 && selector;
                        // qSA works strangely on Element-rooted queries
                        // We can work around this by specifying an extra ID on the root
                        // and working up from there (Thanks to Andrew Dupont for the technique)
                        // IE 8 doesn't work on object elements
                        if (nodeType === 1 && context.nodeName.toLowerCase() !== 'object') {
                            groups = tokenize(selector);
                            if (old = context.getAttribute('id')) {
                                nid = old.replace(rescape, '\\$&');
                            } else {
                                context.setAttribute('id', nid);
                            }
                            nid = '[id=\'' + nid + '\'] ';
                            i = groups.length;
                            while (i--) {
                                groups[i] = nid + toSelector(groups[i]);
                            }
                            newContext = rsibling.test(selector) && testContext(context.parentNode) || context;
                            newSelector = groups.join(',');
                        }
                        if (newSelector) {
                            try {
                                push.apply(results, newContext.querySelectorAll(newSelector));
                                return results;
                            } catch (qsaError) {
                            } finally {
                                if (!old) {
                                    context.removeAttribute('id');
                                }
                            }
                        }
                    }
                }
                // All others
                return select(selector.replace(rtrim, '$1'), context, results, seed);
            }
            /**
 * Create key-value caches of limited size
 * @returns {Function(string, Object)} Returns the Object data after storing it on itself with
 *	property name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)
 *	deleting the oldest entry
 */
            function createCache() {
                var keys = [];
                function cache(key, value) {
                    // Use (key + " ") to avoid collision with native prototype properties (see Issue #157)
                    if (keys.push(key + ' ') > Expr.cacheLength) {
                        // Only keep the most recent entries
                        delete cache[keys.shift()];
                    }
                    return cache[key + ' '] = value;
                }
                return cache;
            }
            /**
 * Mark a function for special use by Sizzle
 * @param {Function} fn The function to mark
 */
            function markFunction(fn) {
                fn[expando] = true;
                return fn;
            }
            /**
 * Support testing using an element
 * @param {Function} fn Passed the created div and expects a boolean result
 */
            function assert(fn) {
                var div = document.createElement('div');
                try {
                    return !!fn(div);
                } catch (e) {
                    return false;
                } finally {
                    // Remove from its parent by default
                    if (div.parentNode) {
                        div.parentNode.removeChild(div);
                    }
                    // release memory in IE
                    div = null;
                }
            }
            /**
 * Adds the same handler for all of the specified attrs
 * @param {String} attrs Pipe-separated list of attributes
 * @param {Function} handler The method that will be applied
 */
            function addHandle(attrs, handler) {
                var arr = attrs.split('|'), i = attrs.length;
                while (i--) {
                    Expr.attrHandle[arr[i]] = handler;
                }
            }
            /**
 * Checks document order of two siblings
 * @param {Element} a
 * @param {Element} b
 * @returns {Number} Returns less than 0 if a precedes b, greater than 0 if a follows b
 */
            function siblingCheck(a, b) {
                var cur = b && a, diff = cur && a.nodeType === 1 && b.nodeType === 1 && (~b.sourceIndex || MAX_NEGATIVE) - (~a.sourceIndex || MAX_NEGATIVE);
                // Use IE sourceIndex if available on both nodes
                if (diff) {
                    return diff;
                }
                // Check if b follows a
                if (cur) {
                    while (cur = cur.nextSibling) {
                        if (cur === b) {
                            return -1;
                        }
                    }
                }
                return a ? 1 : -1;
            }
            /**
 * Returns a function to use in pseudos for input types
 * @param {String} type
 */
            function createInputPseudo(type) {
                return function (elem) {
                    var name = elem.nodeName.toLowerCase();
                    return name === 'input' && elem.type === type;
                };
            }
            /**
 * Returns a function to use in pseudos for buttons
 * @param {String} type
 */
            function createButtonPseudo(type) {
                return function (elem) {
                    var name = elem.nodeName.toLowerCase();
                    return (name === 'input' || name === 'button') && elem.type === type;
                };
            }
            /**
 * Returns a function to use in pseudos for positionals
 * @param {Function} fn
 */
            function createPositionalPseudo(fn) {
                return markFunction(function (argument) {
                    argument = +argument;
                    return markFunction(function (seed, matches) {
                        var j, matchIndexes = fn([], seed.length, argument), i = matchIndexes.length;
                        // Match elements found at the specified indexes
                        while (i--) {
                            if (seed[j = matchIndexes[i]]) {
                                seed[j] = !(matches[j] = seed[j]);
                            }
                        }
                    });
                });
            }
            /**
 * Checks a node for validity as a Sizzle context
 * @param {Element|Object=} context
 * @returns {Element|Object|Boolean} The input node if acceptable, otherwise a falsy value
 */
            function testContext(context) {
                return context && typeof context.getElementsByTagName !== strundefined && context;
            }
            // Expose support vars for convenience
            support = Sizzle.support = {};
            /**
 * Detects XML nodes
 * @param {Element|Object} elem An element or a document
 * @returns {Boolean} True iff elem is a non-HTML XML node
 */
            isXML = Sizzle.isXML = function (elem) {
                // documentElement is verified for cases where it doesn't yet exist
                // (such as loading iframes in IE - #4833)
                var documentElement = elem && (elem.ownerDocument || elem).documentElement;
                return documentElement ? documentElement.nodeName !== 'HTML' : false;
            };
            /**
 * Sets document-related variables once based on the current document
 * @param {Element|Object} [doc] An element or document object to use to set the document
 * @returns {Object} Returns the current document
 */
            setDocument = Sizzle.setDocument = function (node) {
                var hasCompare, doc = node ? node.ownerDocument || node : preferredDoc, parent = doc.defaultView;
                // If no document and documentElement is available, return
                if (doc === document || doc.nodeType !== 9 || !doc.documentElement) {
                    return document;
                }
                // Set our document
                document = doc;
                docElem = doc.documentElement;
                // Support tests
                documentIsHTML = !isXML(doc);
                // Support: IE>8
                // If iframe document is assigned to "document" variable and if iframe has been reloaded,
                // IE will throw "permission denied" error when accessing "document" variable, see jQuery #13936
                // IE6-8 do not support the defaultView property so parent will be undefined
                if (parent && parent !== parent.top) {
                    // IE11 does not have attachEvent, so all must suffer
                    if (parent.addEventListener) {
                        parent.addEventListener('unload', function () {
                            setDocument();
                        }, false);
                    } else if (parent.attachEvent) {
                        parent.attachEvent('onunload', function () {
                            setDocument();
                        });
                    }
                }
                /* Attributes
	---------------------------------------------------------------------- */
                // Support: IE<8
                // Verify that getAttribute really returns attributes and not properties (excepting IE8 booleans)
                support.attributes = assert(function (div) {
                    div.className = 'i';
                    return !div.getAttribute('className');
                });
                /* getElement(s)By*
	---------------------------------------------------------------------- */
                // Check if getElementsByTagName("*") returns only elements
                support.getElementsByTagName = assert(function (div) {
                    div.appendChild(doc.createComment(''));
                    return !div.getElementsByTagName('*').length;
                });
                // Check if getElementsByClassName can be trusted
                support.getElementsByClassName = rnative.test(doc.getElementsByClassName) && assert(function (div) {
                    div.innerHTML = '<div class=\'a\'></div><div class=\'a i\'></div>';
                    // Support: Safari<4
                    // Catch class over-caching
                    div.firstChild.className = 'i';
                    // Support: Opera<10
                    // Catch gEBCN failure to find non-leading classes
                    return div.getElementsByClassName('i').length === 2;
                });
                // Support: IE<10
                // Check if getElementById returns elements by name
                // The broken getElementById methods don't pick up programatically-set names,
                // so use a roundabout getElementsByName test
                support.getById = assert(function (div) {
                    docElem.appendChild(div).id = expando;
                    return !doc.getElementsByName || !doc.getElementsByName(expando).length;
                });
                // ID find and filter
                if (support.getById) {
                    Expr.find['ID'] = function (id, context) {
                        if (typeof context.getElementById !== strundefined && documentIsHTML) {
                            var m = context.getElementById(id);
                            // Check parentNode to catch when Blackberry 4.6 returns
                            // nodes that are no longer in the document #6963
                            return m && m.parentNode ? [m] : [];
                        }
                    };
                    Expr.filter['ID'] = function (id) {
                        var attrId = id.replace(runescape, funescape);
                        return function (elem) {
                            return elem.getAttribute('id') === attrId;
                        };
                    };
                } else {
                    // Support: IE6/7
                    // getElementById is not reliable as a find shortcut
                    delete Expr.find['ID'];
                    Expr.filter['ID'] = function (id) {
                        var attrId = id.replace(runescape, funescape);
                        return function (elem) {
                            var node = typeof elem.getAttributeNode !== strundefined && elem.getAttributeNode('id');
                            return node && node.value === attrId;
                        };
                    };
                }
                // Tag
                Expr.find['TAG'] = support.getElementsByTagName ? function (tag, context) {
                    if (typeof context.getElementsByTagName !== strundefined) {
                        return context.getElementsByTagName(tag);
                    }
                } : function (tag, context) {
                    var elem, tmp = [], i = 0, results = context.getElementsByTagName(tag);
                    // Filter out possible comments
                    if (tag === '*') {
                        while (elem = results[i++]) {
                            if (elem.nodeType === 1) {
                                tmp.push(elem);
                            }
                        }
                        return tmp;
                    }
                    return results;
                };
                // Class
                Expr.find['CLASS'] = support.getElementsByClassName && function (className, context) {
                    if (typeof context.getElementsByClassName !== strundefined && documentIsHTML) {
                        return context.getElementsByClassName(className);
                    }
                };
                /* QSA/matchesSelector
	---------------------------------------------------------------------- */
                // QSA and matchesSelector support
                // matchesSelector(:active) reports false when true (IE9/Opera 11.5)
                rbuggyMatches = [];
                // qSa(:focus) reports false when true (Chrome 21)
                // We allow this because of a bug in IE8/9 that throws an error
                // whenever `document.activeElement` is accessed on an iframe
                // So, we allow :focus to pass through QSA all the time to avoid the IE error
                // See http://bugs.jquery.com/ticket/13378
                rbuggyQSA = [];
                if (support.qsa = rnative.test(doc.querySelectorAll)) {
                    // Build QSA regex
                    // Regex strategy adopted from Diego Perini
                    assert(function (div) {
                        // Select is set to empty string on purpose
                        // This is to test IE's treatment of not explicitly
                        // setting a boolean content attribute,
                        // since its presence should be enough
                        // http://bugs.jquery.com/ticket/12359
                        div.innerHTML = '<select msallowclip=\'\'><option selected=\'\'></option></select>';
                        // Support: IE8, Opera 11-12.16
                        // Nothing should be selected when empty strings follow ^= or $= or *=
                        // The test attribute must be unknown in Opera but "safe" for WinRT
                        // http://msdn.microsoft.com/en-us/library/ie/hh465388.aspx#attribute_section
                        if (div.querySelectorAll('[msallowclip^=\'\']').length) {
                            rbuggyQSA.push('[*^$]=' + whitespace + '*(?:\'\'|"")');
                        }
                        // Support: IE8
                        // Boolean attributes and "value" are not treated correctly
                        if (!div.querySelectorAll('[selected]').length) {
                            rbuggyQSA.push('\\[' + whitespace + '*(?:value|' + booleans + ')');
                        }
                        // Webkit/Opera - :checked should return selected option elements
                        // http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked
                        // IE8 throws error here and will not see later tests
                        if (!div.querySelectorAll(':checked').length) {
                            rbuggyQSA.push(':checked');
                        }
                    });
                    assert(function (div) {
                        // Support: Windows 8 Native Apps
                        // The type and name attributes are restricted during .innerHTML assignment
                        var input = doc.createElement('input');
                        input.setAttribute('type', 'hidden');
                        div.appendChild(input).setAttribute('name', 'D');
                        // Support: IE8
                        // Enforce case-sensitivity of name attribute
                        if (div.querySelectorAll('[name=d]').length) {
                            rbuggyQSA.push('name' + whitespace + '*[*^$|!~]?=');
                        }
                        // FF 3.5 - :enabled/:disabled and hidden elements (hidden elements are still enabled)
                        // IE8 throws error here and will not see later tests
                        if (!div.querySelectorAll(':enabled').length) {
                            rbuggyQSA.push(':enabled', ':disabled');
                        }
                        // Opera 10-11 does not throw on post-comma invalid pseudos
                        div.querySelectorAll('*,:x');
                        rbuggyQSA.push(',.*:');
                    });
                }
                if (support.matchesSelector = rnative.test(matches = docElem.matches || docElem.webkitMatchesSelector || docElem.mozMatchesSelector || docElem.oMatchesSelector || docElem.msMatchesSelector)) {
                    assert(function (div) {
                        // Check to see if it's possible to do matchesSelector
                        // on a disconnected node (IE 9)
                        support.disconnectedMatch = matches.call(div, 'div');
                        // This should fail with an exception
                        // Gecko does not error, returns false instead
                        matches.call(div, '[s!=\'\']:x');
                        rbuggyMatches.push('!=', pseudos);
                    });
                }
                rbuggyQSA = rbuggyQSA.length && new RegExp(rbuggyQSA.join('|'));
                rbuggyMatches = rbuggyMatches.length && new RegExp(rbuggyMatches.join('|'));
                /* Contains
	---------------------------------------------------------------------- */
                hasCompare = rnative.test(docElem.compareDocumentPosition);
                // Element contains another
                // Purposefully does not implement inclusive descendent
                // As in, an element does not contain itself
                contains = hasCompare || rnative.test(docElem.contains) ? function (a, b) {
                    var adown = a.nodeType === 9 ? a.documentElement : a, bup = b && b.parentNode;
                    return a === bup || !!(bup && bup.nodeType === 1 && (adown.contains ? adown.contains(bup) : a.compareDocumentPosition && a.compareDocumentPosition(bup) & 16));
                } : function (a, b) {
                    if (b) {
                        while (b = b.parentNode) {
                            if (b === a) {
                                return true;
                            }
                        }
                    }
                    return false;
                };
                /* Sorting
	---------------------------------------------------------------------- */
                // Document order sorting
                sortOrder = hasCompare ? function (a, b) {
                    // Flag for duplicate removal
                    if (a === b) {
                        hasDuplicate = true;
                        return 0;
                    }
                    // Sort on method existence if only one input has compareDocumentPosition
                    var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;
                    if (compare) {
                        return compare;
                    }
                    // Calculate position if both inputs belong to the same document
                    compare = (a.ownerDocument || a) === (b.ownerDocument || b) ? a.compareDocumentPosition(b) : // Otherwise we know they are disconnected
                    1;
                    // Disconnected nodes
                    if (compare & 1 || !support.sortDetached && b.compareDocumentPosition(a) === compare) {
                        // Choose the first element that is related to our preferred document
                        if (a === doc || a.ownerDocument === preferredDoc && contains(preferredDoc, a)) {
                            return -1;
                        }
                        if (b === doc || b.ownerDocument === preferredDoc && contains(preferredDoc, b)) {
                            return 1;
                        }
                        // Maintain original order
                        return sortInput ? indexOf.call(sortInput, a) - indexOf.call(sortInput, b) : 0;
                    }
                    return compare & 4 ? -1 : 1;
                } : function (a, b) {
                    // Exit early if the nodes are identical
                    if (a === b) {
                        hasDuplicate = true;
                        return 0;
                    }
                    var cur, i = 0, aup = a.parentNode, bup = b.parentNode, ap = [a], bp = [b];
                    // Parentless nodes are either documents or disconnected
                    if (!aup || !bup) {
                        return a === doc ? -1 : b === doc ? 1 : aup ? -1 : bup ? 1 : sortInput ? indexOf.call(sortInput, a) - indexOf.call(sortInput, b) : 0;    // If the nodes are siblings, we can do a quick check
                    } else if (aup === bup) {
                        return siblingCheck(a, b);
                    }
                    // Otherwise we need full lists of their ancestors for comparison
                    cur = a;
                    while (cur = cur.parentNode) {
                        ap.unshift(cur);
                    }
                    cur = b;
                    while (cur = cur.parentNode) {
                        bp.unshift(cur);
                    }
                    // Walk down the tree looking for a discrepancy
                    while (ap[i] === bp[i]) {
                        i++;
                    }
                    return i ? // Do a sibling check if the nodes have a common ancestor
                    siblingCheck(ap[i], bp[i]) : // Otherwise nodes in our document sort first
                    ap[i] === preferredDoc ? -1 : bp[i] === preferredDoc ? 1 : 0;
                };
                return doc;
            };
            Sizzle.matches = function (expr, elements) {
                return Sizzle(expr, null, null, elements);
            };
            Sizzle.matchesSelector = function (elem, expr) {
                // Set document vars if needed
                if ((elem.ownerDocument || elem) !== document) {
                    setDocument(elem);
                }
                // Make sure that attribute selectors are quoted
                expr = expr.replace(rattributeQuotes, '=\'$1\']');
                if (support.matchesSelector && documentIsHTML && (!rbuggyMatches || !rbuggyMatches.test(expr)) && (!rbuggyQSA || !rbuggyQSA.test(expr))) {
                    try {
                        var ret = matches.call(elem, expr);
                        // IE 9's matchesSelector returns false on disconnected nodes
                        if (ret || support.disconnectedMatch || // As well, disconnected nodes are said to be in a document
                            // fragment in IE 9
                            elem.document && elem.document.nodeType !== 11) {
                            return ret;
                        }
                    } catch (e) {
                    }
                }
                return Sizzle(expr, document, null, [elem]).length > 0;
            };
            Sizzle.contains = function (context, elem) {
                // Set document vars if needed
                if ((context.ownerDocument || context) !== document) {
                    setDocument(context);
                }
                return contains(context, elem);
            };
            Sizzle.attr = function (elem, name) {
                // Set document vars if needed
                if ((elem.ownerDocument || elem) !== document) {
                    setDocument(elem);
                }
                var fn = Expr.attrHandle[name.toLowerCase()],
                    // Don't get fooled by Object.prototype properties (jQuery #13807)
                    val = fn && hasOwn.call(Expr.attrHandle, name.toLowerCase()) ? fn(elem, name, !documentIsHTML) : undefined;
                return val !== undefined ? val : support.attributes || !documentIsHTML ? elem.getAttribute(name) : (val = elem.getAttributeNode(name)) && val.specified ? val.value : null;
            };
            Sizzle.error = function (msg) {
                throw new Error('Syntax error, unrecognized expression: ' + msg);
            };
            /**
 * Document sorting and removing duplicates
 * @param {ArrayLike} results
 */
            Sizzle.uniqueSort = function (results) {
                var elem, duplicates = [], j = 0, i = 0;
                // Unless we *know* we can detect duplicates, assume their presence
                hasDuplicate = !support.detectDuplicates;
                sortInput = !support.sortStable && results.slice(0);
                results.sort(sortOrder);
                if (hasDuplicate) {
                    while (elem = results[i++]) {
                        if (elem === results[i]) {
                            j = duplicates.push(i);
                        }
                    }
                    while (j--) {
                        results.splice(duplicates[j], 1);
                    }
                }
                // Clear input after sorting to release objects
                // See https://github.com/jquery/sizzle/pull/225
                sortInput = null;
                return results;
            };
            /**
 * Utility function for retrieving the text value of an array of DOM nodes
 * @param {Array|Element} elem
 */
            getText = Sizzle.getText = function (elem) {
                var node, ret = '', i = 0, nodeType = elem.nodeType;
                if (!nodeType) {
                    // If no nodeType, this is expected to be an array
                    while (node = elem[i++]) {
                        // Do not traverse comment nodes
                        ret += getText(node);
                    }
                } else if (nodeType === 1 || nodeType === 9 || nodeType === 11) {
                    // Use textContent for elements
                    // innerText usage removed for consistency of new lines (jQuery #11153)
                    if (typeof elem.textContent === 'string') {
                        return elem.textContent;
                    } else {
                        // Traverse its children
                        for (elem = elem.firstChild; elem; elem = elem.nextSibling) {
                            ret += getText(elem);
                        }
                    }
                } else if (nodeType === 3 || nodeType === 4) {
                    return elem.nodeValue;
                }
                // Do not include comment or processing instruction nodes
                return ret;
            };
            Expr = Sizzle.selectors = {
                // Can be adjusted by the user
                cacheLength: 50,
                createPseudo: markFunction,
                match: matchExpr,
                attrHandle: {},
                find: {},
                relative: {
                    '>': {
                        dir: 'parentNode',
                        first: true
                    },
                    ' ': { dir: 'parentNode' },
                    '+': {
                        dir: 'previousSibling',
                        first: true
                    },
                    '~': { dir: 'previousSibling' }
                },
                preFilter: {
                    'ATTR': function (match) {
                        match[1] = match[1].replace(runescape, funescape);
                        // Move the given value to match[3] whether quoted or unquoted
                        match[3] = (match[3] || match[4] || match[5] || '').replace(runescape, funescape);
                        if (match[2] === '~=') {
                            match[3] = ' ' + match[3] + ' ';
                        }
                        return match.slice(0, 4);
                    },
                    'CHILD': function (match) {
                        /* matches from matchExpr["CHILD"]
				1 type (only|nth|...)
				2 what (child|of-type)
				3 argument (even|odd|\d*|\d*n([+-]\d+)?|...)
				4 xn-component of xn+y argument ([+-]?\d*n|)
				5 sign of xn-component
				6 x of xn-component
				7 sign of y-component
				8 y of y-component
			*/
                        match[1] = match[1].toLowerCase();
                        if (match[1].slice(0, 3) === 'nth') {
                            // nth-* requires argument
                            if (!match[3]) {
                                Sizzle.error(match[0]);
                            }
                            // numeric x and y parameters for Expr.filter.CHILD
                            // remember that false/true cast respectively to 0/1
                            match[4] = +(match[4] ? match[5] + (match[6] || 1) : 2 * (match[3] === 'even' || match[3] === 'odd'));
                            match[5] = +(match[7] + match[8] || match[3] === 'odd');    // other types prohibit arguments
                        } else if (match[3]) {
                            Sizzle.error(match[0]);
                        }
                        return match;
                    },
                    'PSEUDO': function (match) {
                        var excess, unquoted = !match[6] && match[2];
                        if (matchExpr['CHILD'].test(match[0])) {
                            return null;
                        }
                        // Accept quoted arguments as-is
                        if (match[3]) {
                            match[2] = match[4] || match[5] || '';    // Strip excess characters from unquoted arguments
                        } else if (unquoted && rpseudo.test(unquoted) && // Get excess from tokenize (recursively)
                            (excess = tokenize(unquoted, true)) && // advance to the next closing parenthesis
                            (excess = unquoted.indexOf(')', unquoted.length - excess) - unquoted.length)) {
                            // excess is a negative index
                            match[0] = match[0].slice(0, excess);
                            match[2] = unquoted.slice(0, excess);
                        }
                        // Return only captures needed by the pseudo filter method (type and argument)
                        return match.slice(0, 3);
                    }
                },
                filter: {
                    'TAG': function (nodeNameSelector) {
                        var nodeName = nodeNameSelector.replace(runescape, funescape).toLowerCase();
                        return nodeNameSelector === '*' ? function () {
                            return true;
                        } : function (elem) {
                            return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;
                        };
                    },
                    'CLASS': function (className) {
                        var pattern = classCache[className + ' '];
                        return pattern || (pattern = new RegExp('(^|' + whitespace + ')' + className + '(' + whitespace + '|$)')) && classCache(className, function (elem) {
                            return pattern.test(typeof elem.className === 'string' && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute('class') || '');
                        });
                    },
                    'ATTR': function (name, operator, check) {
                        return function (elem) {
                            var result = Sizzle.attr(elem, name);
                            if (result == null) {
                                return operator === '!=';
                            }
                            if (!operator) {
                                return true;
                            }
                            result += '';
                            return operator === '=' ? result === check : operator === '!=' ? result !== check : operator === '^=' ? check && result.indexOf(check) === 0 : operator === '*=' ? check && result.indexOf(check) > -1 : operator === '$=' ? check && result.slice(-check.length) === check : operator === '~=' ? (' ' + result + ' ').indexOf(check) > -1 : operator === '|=' ? result === check || result.slice(0, check.length + 1) === check + '-' : false;
                        };
                    },
                    'CHILD': function (type, what, argument, first, last) {
                        var simple = type.slice(0, 3) !== 'nth', forward = type.slice(-4) !== 'last', ofType = what === 'of-type';
                        return first === 1 && last === 0 ? // Shortcut for :nth-*(n)
                        function (elem) {
                            return !!elem.parentNode;
                        } : function (elem, context, xml) {
                            var cache, outerCache, node, diff, nodeIndex, start, dir = simple !== forward ? 'nextSibling' : 'previousSibling', parent = elem.parentNode, name = ofType && elem.nodeName.toLowerCase(), useCache = !xml && !ofType;
                            if (parent) {
                                // :(first|last|only)-(child|of-type)
                                if (simple) {
                                    while (dir) {
                                        node = elem;
                                        while (node = node[dir]) {
                                            if (ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) {
                                                return false;
                                            }
                                        }
                                        // Reverse direction for :only-* (if we haven't yet done so)
                                        start = dir = type === 'only' && !start && 'nextSibling';
                                    }
                                    return true;
                                }
                                start = [forward ? parent.firstChild : parent.lastChild];
                                // non-xml :nth-child(...) stores cache data on `parent`
                                if (forward && useCache) {
                                    // Seek `elem` from a previously-cached index
                                    outerCache = parent[expando] || (parent[expando] = {});
                                    cache = outerCache[type] || [];
                                    nodeIndex = cache[0] === dirruns && cache[1];
                                    diff = cache[0] === dirruns && cache[2];
                                    node = nodeIndex && parent.childNodes[nodeIndex];
                                    while (node = ++nodeIndex && node && node[dir] || // Fallback to seeking `elem` from the start
                                        (diff = nodeIndex = 0) || start.pop()) {
                                        // When found, cache indexes on `parent` and break
                                        if (node.nodeType === 1 && ++diff && node === elem) {
                                            outerCache[type] = [
                                                dirruns,
                                                nodeIndex,
                                                diff
                                            ];
                                            break;
                                        }
                                    }    // Use previously-cached element index if available
                                } else if (useCache && (cache = (elem[expando] || (elem[expando] = {}))[type]) && cache[0] === dirruns) {
                                    diff = cache[1];    // xml :nth-child(...) or :nth-last-child(...) or :nth(-last)?-of-type(...)
                                } else {
                                    // Use the same loop as above to seek `elem` from the start
                                    while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {
                                        if ((ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) && ++diff) {
                                            // Cache the index of each encountered element
                                            if (useCache) {
                                                (node[expando] || (node[expando] = {}))[type] = [
                                                    dirruns,
                                                    diff
                                                ];
                                            }
                                            if (node === elem) {
                                                break;
                                            }
                                        }
                                    }
                                }
                                // Incorporate the offset, then check against cycle size
                                diff -= last;
                                return diff === first || diff % first === 0 && diff / first >= 0;
                            }
                        };
                    },
                    'PSEUDO': function (pseudo, argument) {
                        // pseudo-class names are case-insensitive
                        // http://www.w3.org/TR/selectors/#pseudo-classes
                        // Prioritize by case sensitivity in case custom pseudos are added with uppercase letters
                        // Remember that setFilters inherits from pseudos
                        var args, fn = Expr.pseudos[pseudo] || Expr.setFilters[pseudo.toLowerCase()] || Sizzle.error('unsupported pseudo: ' + pseudo);
                        // The user may use createPseudo to indicate that
                        // arguments are needed to create the filter function
                        // just as Sizzle does
                        if (fn[expando]) {
                            return fn(argument);
                        }
                        // But maintain support for old signatures
                        if (fn.length > 1) {
                            args = [
                                pseudo,
                                pseudo,
                                '',
                                argument
                            ];
                            return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase()) ? markFunction(function (seed, matches) {
                                var idx, matched = fn(seed, argument), i = matched.length;
                                while (i--) {
                                    idx = indexOf.call(seed, matched[i]);
                                    seed[idx] = !(matches[idx] = matched[i]);
                                }
                            }) : function (elem) {
                                return fn(elem, 0, args);
                            };
                        }
                        return fn;
                    }
                },
                pseudos: {
                    // Potentially complex pseudos
                    'not': markFunction(function (selector) {
                        // Trim the selector passed to compile
                        // to avoid treating leading and trailing
                        // spaces as combinators
                        var input = [], results = [], matcher = compile(selector.replace(rtrim, '$1'));
                        return matcher[expando] ? markFunction(function (seed, matches, context, xml) {
                            var elem, unmatched = matcher(seed, null, xml, []), i = seed.length;
                            // Match elements unmatched by `matcher`
                            while (i--) {
                                if (elem = unmatched[i]) {
                                    seed[i] = !(matches[i] = elem);
                                }
                            }
                        }) : function (elem, context, xml) {
                            input[0] = elem;
                            matcher(input, null, xml, results);
                            return !results.pop();
                        };
                    }),
                    'has': markFunction(function (selector) {
                        return function (elem) {
                            return Sizzle(selector, elem).length > 0;
                        };
                    }),
                    'contains': markFunction(function (text) {
                        return function (elem) {
                            return (elem.textContent || elem.innerText || getText(elem)).indexOf(text) > -1;
                        };
                    }),
                    // "Whether an element is represented by a :lang() selector
                    // is based solely on the element's language value
                    // being equal to the identifier C,
                    // or beginning with the identifier C immediately followed by "-".
                    // The matching of C against the element's language value is performed case-insensitively.
                    // The identifier C does not have to be a valid language name."
                    // http://www.w3.org/TR/selectors/#lang-pseudo
                    'lang': markFunction(function (lang) {
                        // lang value must be a valid identifier
                        if (!ridentifier.test(lang || '')) {
                            Sizzle.error('unsupported lang: ' + lang);
                        }
                        lang = lang.replace(runescape, funescape).toLowerCase();
                        return function (elem) {
                            var elemLang;
                            do {
                                if (elemLang = documentIsHTML ? elem.lang : elem.getAttribute('xml:lang') || elem.getAttribute('lang')) {
                                    elemLang = elemLang.toLowerCase();
                                    return elemLang === lang || elemLang.indexOf(lang + '-') === 0;
                                }
                            } while ((elem = elem.parentNode) && elem.nodeType === 1);
                            return false;
                        };
                    }),
                    // Miscellaneous
                    'target': function (elem) {
                        var hash = window.location && window.location.hash;
                        return hash && hash.slice(1) === elem.id;
                    },
                    'root': function (elem) {
                        return elem === docElem;
                    },
                    'focus': function (elem) {
                        return elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);
                    },
                    // Boolean properties
                    'enabled': function (elem) {
                        return elem.disabled === false;
                    },
                    'disabled': function (elem) {
                        return elem.disabled === true;
                    },
                    'checked': function (elem) {
                        // In CSS3, :checked should return both checked and selected elements
                        // http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked
                        var nodeName = elem.nodeName.toLowerCase();
                        return nodeName === 'input' && !!elem.checked || nodeName === 'option' && !!elem.selected;
                    },
                    'selected': function (elem) {
                        // Accessing this property makes selected-by-default
                        // options in Safari work properly
                        if (elem.parentNode) {
                            elem.parentNode.selectedIndex;
                        }
                        return elem.selected === true;
                    },
                    // Contents
                    'empty': function (elem) {
                        // http://www.w3.org/TR/selectors/#empty-pseudo
                        // :empty is negated by element (1) or content nodes (text: 3; cdata: 4; entity ref: 5),
                        //   but not by others (comment: 8; processing instruction: 7; etc.)
                        // nodeType < 6 works because attributes (2) do not appear as children
                        for (elem = elem.firstChild; elem; elem = elem.nextSibling) {
                            if (elem.nodeType < 6) {
                                return false;
                            }
                        }
                        return true;
                    },
                    'parent': function (elem) {
                        return !Expr.pseudos['empty'](elem);
                    },
                    // Element/input types
                    'header': function (elem) {
                        return rheader.test(elem.nodeName);
                    },
                    'input': function (elem) {
                        return rinputs.test(elem.nodeName);
                    },
                    'button': function (elem) {
                        var name = elem.nodeName.toLowerCase();
                        return name === 'input' && elem.type === 'button' || name === 'button';
                    },
                    'text': function (elem) {
                        var attr;
                        return elem.nodeName.toLowerCase() === 'input' && elem.type === 'text' && // Support: IE<8
                        // New HTML5 attribute values (e.g., "search") appear with elem.type === "text"
                        ((attr = elem.getAttribute('type')) == null || attr.toLowerCase() === 'text');
                    },
                    // Position-in-collection
                    'first': createPositionalPseudo(function () {
                        return [0];
                    }),
                    'last': createPositionalPseudo(function (matchIndexes, length) {
                        return [length - 1];
                    }),
                    'eq': createPositionalPseudo(function (matchIndexes, length, argument) {
                        return [argument < 0 ? argument + length : argument];
                    }),
                    'even': createPositionalPseudo(function (matchIndexes, length) {
                        var i = 0;
                        for (; i < length; i += 2) {
                            matchIndexes.push(i);
                        }
                        return matchIndexes;
                    }),
                    'odd': createPositionalPseudo(function (matchIndexes, length) {
                        var i = 1;
                        for (; i < length; i += 2) {
                            matchIndexes.push(i);
                        }
                        return matchIndexes;
                    }),
                    'lt': createPositionalPseudo(function (matchIndexes, length, argument) {
                        var i = argument < 0 ? argument + length : argument;
                        for (; --i >= 0;) {
                            matchIndexes.push(i);
                        }
                        return matchIndexes;
                    }),
                    'gt': createPositionalPseudo(function (matchIndexes, length, argument) {
                        var i = argument < 0 ? argument + length : argument;
                        for (; ++i < length;) {
                            matchIndexes.push(i);
                        }
                        return matchIndexes;
                    })
                }
            };
            Expr.pseudos['nth'] = Expr.pseudos['eq'];
            // Add button/input type pseudos
            for (i in {
                    radio: true,
                    checkbox: true,
                    file: true,
                    password: true,
                    image: true
                }) {
                Expr.pseudos[i] = createInputPseudo(i);
            }
            for (i in {
                    submit: true,
                    reset: true
                }) {
                Expr.pseudos[i] = createButtonPseudo(i);
            }
            // Easy API for creating new setFilters
            function setFilters() {
            }
            setFilters.prototype = Expr.filters = Expr.pseudos;
            Expr.setFilters = new setFilters();
            tokenize = Sizzle.tokenize = function (selector, parseOnly) {
                var matched, match, tokens, type, soFar, groups, preFilters, cached = tokenCache[selector + ' '];
                if (cached) {
                    return parseOnly ? 0 : cached.slice(0);
                }
                soFar = selector;
                groups = [];
                preFilters = Expr.preFilter;
                while (soFar) {
                    // Comma and first run
                    if (!matched || (match = rcomma.exec(soFar))) {
                        if (match) {
                            // Don't consume trailing commas as valid
                            soFar = soFar.slice(match[0].length) || soFar;
                        }
                        groups.push(tokens = []);
                    }
                    matched = false;
                    // Combinators
                    if (match = rcombinators.exec(soFar)) {
                        matched = match.shift();
                        tokens.push({
                            value: matched,
                            // Cast descendant combinators to space
                            type: match[0].replace(rtrim, ' ')
                        });
                        soFar = soFar.slice(matched.length);
                    }
                    // Filters
                    for (type in Expr.filter) {
                        if ((match = matchExpr[type].exec(soFar)) && (!preFilters[type] || (match = preFilters[type](match)))) {
                            matched = match.shift();
                            tokens.push({
                                value: matched,
                                type: type,
                                matches: match
                            });
                            soFar = soFar.slice(matched.length);
                        }
                    }
                    if (!matched) {
                        break;
                    }
                }
                // Return the length of the invalid excess
                // if we're just parsing
                // Otherwise, throw an error or return tokens
                return parseOnly ? soFar.length : soFar ? Sizzle.error(selector) : // Cache the tokens
                tokenCache(selector, groups).slice(0);
            };
            function toSelector(tokens) {
                var i = 0, len = tokens.length, selector = '';
                for (; i < len; i++) {
                    selector += tokens[i].value;
                }
                return selector;
            }
            function addCombinator(matcher, combinator, base) {
                var dir = combinator.dir, checkNonElements = base && dir === 'parentNode', doneName = done++;
                return combinator.first ? // Check against closest ancestor/preceding element
                function (elem, context, xml) {
                    while (elem = elem[dir]) {
                        if (elem.nodeType === 1 || checkNonElements) {
                            return matcher(elem, context, xml);
                        }
                    }
                } : // Check against all ancestor/preceding elements
                function (elem, context, xml) {
                    var oldCache, outerCache, newCache = [
                            dirruns,
                            doneName
                        ];
                    // We can't set arbitrary data on XML nodes, so they don't benefit from dir caching
                    if (xml) {
                        while (elem = elem[dir]) {
                            if (elem.nodeType === 1 || checkNonElements) {
                                if (matcher(elem, context, xml)) {
                                    return true;
                                }
                            }
                        }
                    } else {
                        while (elem = elem[dir]) {
                            if (elem.nodeType === 1 || checkNonElements) {
                                outerCache = elem[expando] || (elem[expando] = {});
                                if ((oldCache = outerCache[dir]) && oldCache[0] === dirruns && oldCache[1] === doneName) {
                                    // Assign to newCache so results back-propagate to previous elements
                                    return newCache[2] = oldCache[2];
                                } else {
                                    // Reuse newcache so results back-propagate to previous elements
                                    outerCache[dir] = newCache;
                                    // A match means we're done; a fail means we have to keep checking
                                    if (newCache[2] = matcher(elem, context, xml)) {
                                        return true;
                                    }
                                }
                            }
                        }
                    }
                };
            }
            function elementMatcher(matchers) {
                return matchers.length > 1 ? function (elem, context, xml) {
                    var i = matchers.length;
                    while (i--) {
                        if (!matchers[i](elem, context, xml)) {
                            return false;
                        }
                    }
                    return true;
                } : matchers[0];
            }
            function multipleContexts(selector, contexts, results) {
                var i = 0, len = contexts.length;
                for (; i < len; i++) {
                    Sizzle(selector, contexts[i], results);
                }
                return results;
            }
            function condense(unmatched, map, filter, context, xml) {
                var elem, newUnmatched = [], i = 0, len = unmatched.length, mapped = map != null;
                for (; i < len; i++) {
                    if (elem = unmatched[i]) {
                        if (!filter || filter(elem, context, xml)) {
                            newUnmatched.push(elem);
                            if (mapped) {
                                map.push(i);
                            }
                        }
                    }
                }
                return newUnmatched;
            }
            function setMatcher(preFilter, selector, matcher, postFilter, postFinder, postSelector) {
                if (postFilter && !postFilter[expando]) {
                    postFilter = setMatcher(postFilter);
                }
                if (postFinder && !postFinder[expando]) {
                    postFinder = setMatcher(postFinder, postSelector);
                }
                return markFunction(function (seed, results, context, xml) {
                    var temp, i, elem, preMap = [], postMap = [], preexisting = results.length,
                        // Get initial elements from seed or context
                        elems = seed || multipleContexts(selector || '*', context.nodeType ? [context] : context, []),
                        // Prefilter to get matcher input, preserving a map for seed-results synchronization
                        matcherIn = preFilter && (seed || !selector) ? condense(elems, preMap, preFilter, context, xml) : elems, matcherOut = matcher ? // If we have a postFinder, or filtered seed, or non-seed postFilter or preexisting results,
                        postFinder || (seed ? preFilter : preexisting || postFilter) ? // ...intermediate processing is necessary
                        [] : // ...otherwise use results directly
                        results : matcherIn;
                    // Find primary matches
                    if (matcher) {
                        matcher(matcherIn, matcherOut, context, xml);
                    }
                    // Apply postFilter
                    if (postFilter) {
                        temp = condense(matcherOut, postMap);
                        postFilter(temp, [], context, xml);
                        // Un-match failing elements by moving them back to matcherIn
                        i = temp.length;
                        while (i--) {
                            if (elem = temp[i]) {
                                matcherOut[postMap[i]] = !(matcherIn[postMap[i]] = elem);
                            }
                        }
                    }
                    if (seed) {
                        if (postFinder || preFilter) {
                            if (postFinder) {
                                // Get the final matcherOut by condensing this intermediate into postFinder contexts
                                temp = [];
                                i = matcherOut.length;
                                while (i--) {
                                    if (elem = matcherOut[i]) {
                                        // Restore matcherIn since elem is not yet a final match
                                        temp.push(matcherIn[i] = elem);
                                    }
                                }
                                postFinder(null, matcherOut = [], temp, xml);
                            }
                            // Move matched elements from seed to results to keep them synchronized
                            i = matcherOut.length;
                            while (i--) {
                                if ((elem = matcherOut[i]) && (temp = postFinder ? indexOf.call(seed, elem) : preMap[i]) > -1) {
                                    seed[temp] = !(results[temp] = elem);
                                }
                            }
                        }    // Add elements to results, through postFinder if defined
                    } else {
                        matcherOut = condense(matcherOut === results ? matcherOut.splice(preexisting, matcherOut.length) : matcherOut);
                        if (postFinder) {
                            postFinder(null, results, matcherOut, xml);
                        } else {
                            push.apply(results, matcherOut);
                        }
                    }
                });
            }
            function matcherFromTokens(tokens) {
                var checkContext, matcher, j, len = tokens.length, leadingRelative = Expr.relative[tokens[0].type], implicitRelative = leadingRelative || Expr.relative[' '], i = leadingRelative ? 1 : 0,
                    // The foundational matcher ensures that elements are reachable from top-level context(s)
                    matchContext = addCombinator(function (elem) {
                        return elem === checkContext;
                    }, implicitRelative, true), matchAnyContext = addCombinator(function (elem) {
                        return indexOf.call(checkContext, elem) > -1;
                    }, implicitRelative, true), matchers = [function (elem, context, xml) {
                            return !leadingRelative && (xml || context !== outermostContext) || ((checkContext = context).nodeType ? matchContext(elem, context, xml) : matchAnyContext(elem, context, xml));
                        }];
                for (; i < len; i++) {
                    if (matcher = Expr.relative[tokens[i].type]) {
                        matchers = [addCombinator(elementMatcher(matchers), matcher)];
                    } else {
                        matcher = Expr.filter[tokens[i].type].apply(null, tokens[i].matches);
                        // Return special upon seeing a positional matcher
                        if (matcher[expando]) {
                            // Find the next relative operator (if any) for proper handling
                            j = ++i;
                            for (; j < len; j++) {
                                if (Expr.relative[tokens[j].type]) {
                                    break;
                                }
                            }
                            return setMatcher(i > 1 && elementMatcher(matchers), i > 1 && toSelector(// If the preceding token was a descendant combinator, insert an implicit any-element `*`
                            tokens.slice(0, i - 1).concat({ value: tokens[i - 2].type === ' ' ? '*' : '' })).replace(rtrim, '$1'), matcher, i < j && matcherFromTokens(tokens.slice(i, j)), j < len && matcherFromTokens(tokens = tokens.slice(j)), j < len && toSelector(tokens));
                        }
                        matchers.push(matcher);
                    }
                }
                return elementMatcher(matchers);
            }
            function matcherFromGroupMatchers(elementMatchers, setMatchers) {
                var bySet = setMatchers.length > 0, byElement = elementMatchers.length > 0, superMatcher = function (seed, context, xml, results, outermost) {
                        var elem, j, matcher, matchedCount = 0, i = '0', unmatched = seed && [], setMatched = [], contextBackup = outermostContext,
                            // We must always have either seed elements or outermost context
                            elems = seed || byElement && Expr.find['TAG']('*', outermost),
                            // Use integer dirruns iff this is the outermost matcher
                            dirrunsUnique = dirruns += contextBackup == null ? 1 : Math.random() || 0.1, len = elems.length;
                        if (outermost) {
                            outermostContext = context !== document && context;
                        }
                        // Add elements passing elementMatchers directly to results
                        // Keep `i` a string if there are no elements so `matchedCount` will be "00" below
                        // Support: IE<9, Safari
                        // Tolerate NodeList properties (IE: "length"; Safari: <number>) matching elements by id
                        for (; i !== len && (elem = elems[i]) != null; i++) {
                            if (byElement && elem) {
                                j = 0;
                                while (matcher = elementMatchers[j++]) {
                                    if (matcher(elem, context, xml)) {
                                        results.push(elem);
                                        break;
                                    }
                                }
                                if (outermost) {
                                    dirruns = dirrunsUnique;
                                }
                            }
                            // Track unmatched elements for set filters
                            if (bySet) {
                                // They will have gone through all possible matchers
                                if (elem = !matcher && elem) {
                                    matchedCount--;
                                }
                                // Lengthen the array for every element, matched or not
                                if (seed) {
                                    unmatched.push(elem);
                                }
                            }
                        }
                        // Apply set filters to unmatched elements
                        matchedCount += i;
                        if (bySet && i !== matchedCount) {
                            j = 0;
                            while (matcher = setMatchers[j++]) {
                                matcher(unmatched, setMatched, context, xml);
                            }
                            if (seed) {
                                // Reintegrate element matches to eliminate the need for sorting
                                if (matchedCount > 0) {
                                    while (i--) {
                                        if (!(unmatched[i] || setMatched[i])) {
                                            setMatched[i] = pop.call(results);
                                        }
                                    }
                                }
                                // Discard index placeholder values to get only actual matches
                                setMatched = condense(setMatched);
                            }
                            // Add matches to results
                            push.apply(results, setMatched);
                            // Seedless set matches succeeding multiple successful matchers stipulate sorting
                            if (outermost && !seed && setMatched.length > 0 && matchedCount + setMatchers.length > 1) {
                                Sizzle.uniqueSort(results);
                            }
                        }
                        // Override manipulation of globals by nested matchers
                        if (outermost) {
                            dirruns = dirrunsUnique;
                            outermostContext = contextBackup;
                        }
                        return unmatched;
                    };
                return bySet ? markFunction(superMatcher) : superMatcher;
            }
            compile = Sizzle.compile = function (selector, match) {
                var i, setMatchers = [], elementMatchers = [], cached = compilerCache[selector + ' '];
                if (!cached) {
                    // Generate a function of recursive functions that can be used to check each element
                    if (!match) {
                        match = tokenize(selector);
                    }
                    i = match.length;
                    while (i--) {
                        cached = matcherFromTokens(match[i]);
                        if (cached[expando]) {
                            setMatchers.push(cached);
                        } else {
                            elementMatchers.push(cached);
                        }
                    }
                    // Cache the compiled function
                    cached = compilerCache(selector, matcherFromGroupMatchers(elementMatchers, setMatchers));
                    // Save selector and tokenization
                    cached.selector = selector;
                }
                return cached;
            };
            /**
 * A low-level selection function that works with Sizzle's compiled
 *  selector functions
 * @param {String|Function} selector A selector or a pre-compiled
 *  selector function built with Sizzle.compile
 * @param {Element} context
 * @param {Array} [results]
 * @param {Array} [seed] A set of elements to match against
 */
            select = Sizzle.select = function (selector, context, results, seed) {
                var i, tokens, token, type, find, compiled = typeof selector === 'function' && selector, match = !seed && tokenize(selector = compiled.selector || selector);
                results = results || [];
                // Try to minimize operations if there is no seed and only one group
                if (match.length === 1) {
                    // Take a shortcut and set the context if the root selector is an ID
                    tokens = match[0] = match[0].slice(0);
                    if (tokens.length > 2 && (token = tokens[0]).type === 'ID' && support.getById && context.nodeType === 9 && documentIsHTML && Expr.relative[tokens[1].type]) {
                        context = (Expr.find['ID'](token.matches[0].replace(runescape, funescape), context) || [])[0];
                        if (!context) {
                            return results;    // Precompiled matchers will still verify ancestry, so step up a level
                        } else if (compiled) {
                            context = context.parentNode;
                        }
                        selector = selector.slice(tokens.shift().value.length);
                    }
                    // Fetch a seed set for right-to-left matching
                    i = matchExpr['needsContext'].test(selector) ? 0 : tokens.length;
                    while (i--) {
                        token = tokens[i];
                        // Abort if we hit a combinator
                        if (Expr.relative[type = token.type]) {
                            break;
                        }
                        if (find = Expr.find[type]) {
                            // Search, expanding context for leading sibling combinators
                            if (seed = find(token.matches[0].replace(runescape, funescape), rsibling.test(tokens[0].type) && testContext(context.parentNode) || context)) {
                                // If seed is empty or no tokens remain, we can return early
                                tokens.splice(i, 1);
                                selector = seed.length && toSelector(tokens);
                                if (!selector) {
                                    push.apply(results, seed);
                                    return results;
                                }
                                break;
                            }
                        }
                    }
                }
                // Compile and execute a filtering function if one is not provided
                // Provide `match` to avoid retokenization if we modified the selector above
                (compiled || compile(selector, match))(seed, context, !documentIsHTML, results, rsibling.test(selector) && testContext(context.parentNode) || context);
                return results;
            };
            // One-time assignments
            // Sort stability
            support.sortStable = expando.split('').sort(sortOrder).join('') === expando;
            // Support: Chrome<14
            // Always assume duplicates if they aren't passed to the comparison function
            support.detectDuplicates = !!hasDuplicate;
            // Initialize against the default document
            setDocument();
            // Support: Webkit<537.32 - Safari 6.0.3/Chrome 25 (fixed in Chrome 27)
            // Detached nodes confoundingly follow *each other*
            support.sortDetached = assert(function (div1) {
                // Should return 1, but returns 4 (following)
                return div1.compareDocumentPosition(document.createElement('div')) & 1;
            });
            // Support: IE<8
            // Prevent attribute/property "interpolation"
            // http://msdn.microsoft.com/en-us/library/ms536429%28VS.85%29.aspx
            if (!assert(function (div) {
                    div.innerHTML = '<a href=\'#\'></a>';
                    return div.firstChild.getAttribute('href') === '#';
                })) {
                addHandle('type|href|height|width', function (elem, name, isXML) {
                    if (!isXML) {
                        return elem.getAttribute(name, name.toLowerCase() === 'type' ? 1 : 2);
                    }
                });
            }
            // Support: IE<9
            // Use defaultValue in place of getAttribute("value")
            if (!support.attributes || !assert(function (div) {
                    div.innerHTML = '<input/>';
                    div.firstChild.setAttribute('value', '');
                    return div.firstChild.getAttribute('value') === '';
                })) {
                addHandle('value', function (elem, name, isXML) {
                    if (!isXML && elem.nodeName.toLowerCase() === 'input') {
                        return elem.defaultValue;
                    }
                });
            }
            // Support: IE<9
            // Use getAttributeNode to fetch booleans when getAttribute lies
            if (!assert(function (div) {
                    return div.getAttribute('disabled') == null;
                })) {
                addHandle(booleans, function (elem, name, isXML) {
                    var val;
                    if (!isXML) {
                        return elem[name] === true ? name.toLowerCase() : (val = elem.getAttributeNode(name)) && val.specified ? val.value : null;
                    }
                });
            }
            return Sizzle;
        }(window);
        jQuery.find = Sizzle;
        jQuery.expr = Sizzle.selectors;
        jQuery.expr[':'] = jQuery.expr.pseudos;
        jQuery.unique = Sizzle.uniqueSort;
        jQuery.text = Sizzle.getText;
        jQuery.isXMLDoc = Sizzle.isXML;
        jQuery.contains = Sizzle.contains;
        var rneedsContext = jQuery.expr.match.needsContext;
        var rsingleTag = /^<(\w+)\s*\/?>(?:<\/\1>|)$/;
        var risSimple = /^.[^:#\[\.,]*$/;
        // Implement the identical functionality for filter and not
        function winnow(elements, qualifier, not) {
            if (jQuery.isFunction(qualifier)) {
                return jQuery.grep(elements, function (elem, i) {
                    /* jshint -W018 */
                    return !!qualifier.call(elem, i, elem) !== not;
                });
            }
            if (qualifier.nodeType) {
                return jQuery.grep(elements, function (elem) {
                    return elem === qualifier !== not;
                });
            }
            if (typeof qualifier === 'string') {
                if (risSimple.test(qualifier)) {
                    return jQuery.filter(qualifier, elements, not);
                }
                qualifier = jQuery.filter(qualifier, elements);
            }
            return jQuery.grep(elements, function (elem) {
                return jQuery.inArray(elem, qualifier) >= 0 !== not;
            });
        }
        jQuery.filter = function (expr, elems, not) {
            var elem = elems[0];
            if (not) {
                expr = ':not(' + expr + ')';
            }
            return elems.length === 1 && elem.nodeType === 1 ? jQuery.find.matchesSelector(elem, expr) ? [elem] : [] : jQuery.find.matches(expr, jQuery.grep(elems, function (elem) {
                return elem.nodeType === 1;
            }));
        };
        jQuery.fn.extend({
            find: function (selector) {
                var i, ret = [], self = this, len = self.length;
                if (typeof selector !== 'string') {
                    return this.pushStack(jQuery(selector).filter(function () {
                        for (i = 0; i < len; i++) {
                            if (jQuery.contains(self[i], this)) {
                                return true;
                            }
                        }
                    }));
                }
                for (i = 0; i < len; i++) {
                    jQuery.find(selector, self[i], ret);
                }
                // Needed because $( selector, context ) becomes $( context ).find( selector )
                ret = this.pushStack(len > 1 ? jQuery.unique(ret) : ret);
                ret.selector = this.selector ? this.selector + ' ' + selector : selector;
                return ret;
            },
            filter: function (selector) {
                return this.pushStack(winnow(this, selector || [], false));
            },
            not: function (selector) {
                return this.pushStack(winnow(this, selector || [], true));
            },
            is: function (selector) {
                return !!winnow(this, // If this is a positional/relative selector, check membership in the returned set
                // so $("p:first").is("p:last") won't return true for a doc with two "p".
                typeof selector === 'string' && rneedsContext.test(selector) ? jQuery(selector) : selector || [], false).length;
            }
        });
        // Initialize a jQuery object
        // A central reference to the root jQuery(document)
        var rootjQuery,
            // Use the correct document accordingly with window argument (sandbox)
            document = window.document,
            // A simple way to check for HTML strings
            // Prioritize #id over <tag> to avoid XSS via location.hash (#9521)
            // Strict HTML recognition (#11290: must start with <)
            rquickExpr = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/, init = jQuery.fn.init = function (selector, context) {
                var match, elem;
                // HANDLE: $(""), $(null), $(undefined), $(false)
                if (!selector) {
                    return this;
                }
                // Handle HTML strings
                if (typeof selector === 'string') {
                    if (selector.charAt(0) === '<' && selector.charAt(selector.length - 1) === '>' && selector.length >= 3) {
                        // Assume that strings that start and end with <> are HTML and skip the regex check
                        match = [
                            null,
                            selector,
                            null
                        ];
                    } else {
                        match = rquickExpr.exec(selector);
                    }
                    // Match html or make sure no context is specified for #id
                    if (match && (match[1] || !context)) {
                        // HANDLE: $(html) -> $(array)
                        if (match[1]) {
                            context = context instanceof jQuery ? context[0] : context;
                            // scripts is true for back-compat
                            // Intentionally let the error be thrown if parseHTML is not present
                            jQuery.merge(this, jQuery.parseHTML(match[1], context && context.nodeType ? context.ownerDocument || context : document, true));
                            // HANDLE: $(html, props)
                            if (rsingleTag.test(match[1]) && jQuery.isPlainObject(context)) {
                                for (match in context) {
                                    // Properties of context are called as methods if possible
                                    if (jQuery.isFunction(this[match])) {
                                        this[match](context[match]);    // ...and otherwise set as attributes
                                    } else {
                                        this.attr(match, context[match]);
                                    }
                                }
                            }
                            return this;    // HANDLE: $(#id)
                        } else {
                            elem = document.getElementById(match[2]);
                            // Check parentNode to catch when Blackberry 4.6 returns
                            // nodes that are no longer in the document #6963
                            if (elem && elem.parentNode) {
                                // Handle the case where IE and Opera return items
                                // by name instead of ID
                                if (elem.id !== match[2]) {
                                    return rootjQuery.find(selector);
                                }
                                // Otherwise, we inject the element directly into the jQuery object
                                this.length = 1;
                                this[0] = elem;
                            }
                            this.context = document;
                            this.selector = selector;
                            return this;
                        }    // HANDLE: $(expr, $(...))
                    } else if (!context || context.jquery) {
                        return (context || rootjQuery).find(selector);    // HANDLE: $(expr, context)
                                                                          // (which is just equivalent to: $(context).find(expr)
                    } else {
                        return this.constructor(context).find(selector);
                    }    // HANDLE: $(DOMElement)
                } else if (selector.nodeType) {
                    this.context = this[0] = selector;
                    this.length = 1;
                    return this;    // HANDLE: $(function)
                                    // Shortcut for document ready
                } else if (jQuery.isFunction(selector)) {
                    return typeof rootjQuery.ready !== 'undefined' ? rootjQuery.ready(selector) : // Execute immediately if ready is not present
                    selector(jQuery);
                }
                if (selector.selector !== undefined) {
                    this.selector = selector.selector;
                    this.context = selector.context;
                }
                return jQuery.makeArray(selector, this);
            };
        // Give the init function the jQuery prototype for later instantiation
        init.prototype = jQuery.fn;
        // Initialize central reference
        rootjQuery = jQuery(document);
        var rparentsprev = /^(?:parents|prev(?:Until|All))/,
            // methods guaranteed to produce a unique set when starting from a unique set
            guaranteedUnique = {
                children: true,
                contents: true,
                next: true,
                prev: true
            };
        jQuery.extend({
            dir: function (elem, dir, until) {
                var matched = [], cur = elem[dir];
                while (cur && cur.nodeType !== 9 && (until === undefined || cur.nodeType !== 1 || !jQuery(cur).is(until))) {
                    if (cur.nodeType === 1) {
                        matched.push(cur);
                    }
                    cur = cur[dir];
                }
                return matched;
            },
            sibling: function (n, elem) {
                var r = [];
                for (; n; n = n.nextSibling) {
                    if (n.nodeType === 1 && n !== elem) {
                        r.push(n);
                    }
                }
                return r;
            }
        });
        jQuery.fn.extend({
            has: function (target) {
                var i, targets = jQuery(target, this), len = targets.length;
                return this.filter(function () {
                    for (i = 0; i < len; i++) {
                        if (jQuery.contains(this, targets[i])) {
                            return true;
                        }
                    }
                });
            },
            closest: function (selectors, context) {
                var cur, i = 0, l = this.length, matched = [], pos = rneedsContext.test(selectors) || typeof selectors !== 'string' ? jQuery(selectors, context || this.context) : 0;
                for (; i < l; i++) {
                    for (cur = this[i]; cur && cur !== context; cur = cur.parentNode) {
                        // Always skip document fragments
                        if (cur.nodeType < 11 && (pos ? pos.index(cur) > -1 : // Don't pass non-elements to Sizzle
                            cur.nodeType === 1 && jQuery.find.matchesSelector(cur, selectors))) {
                            matched.push(cur);
                            break;
                        }
                    }
                }
                return this.pushStack(matched.length > 1 ? jQuery.unique(matched) : matched);
            },
            // Determine the position of an element within
            // the matched set of elements
            index: function (elem) {
                // No argument, return index in parent
                if (!elem) {
                    return this[0] && this[0].parentNode ? this.first().prevAll().length : -1;
                }
                // index in selector
                if (typeof elem === 'string') {
                    return jQuery.inArray(this[0], jQuery(elem));
                }
                // Locate the position of the desired element
                return jQuery.inArray(// If it receives a jQuery object, the first element is used
                elem.jquery ? elem[0] : elem, this);
            },
            add: function (selector, context) {
                return this.pushStack(jQuery.unique(jQuery.merge(this.get(), jQuery(selector, context))));
            },
            addBack: function (selector) {
                return this.add(selector == null ? this.prevObject : this.prevObject.filter(selector));
            }
        });
        function sibling(cur, dir) {
            do {
                cur = cur[dir];
            } while (cur && cur.nodeType !== 1);
            return cur;
        }
        jQuery.each({
            parent: function (elem) {
                var parent = elem.parentNode;
                return parent && parent.nodeType !== 11 ? parent : null;
            },
            parents: function (elem) {
                return jQuery.dir(elem, 'parentNode');
            },
            parentsUntil: function (elem, i, until) {
                return jQuery.dir(elem, 'parentNode', until);
            },
            next: function (elem) {
                return sibling(elem, 'nextSibling');
            },
            prev: function (elem) {
                return sibling(elem, 'previousSibling');
            },
            nextAll: function (elem) {
                return jQuery.dir(elem, 'nextSibling');
            },
            prevAll: function (elem) {
                return jQuery.dir(elem, 'previousSibling');
            },
            nextUntil: function (elem, i, until) {
                return jQuery.dir(elem, 'nextSibling', until);
            },
            prevUntil: function (elem, i, until) {
                return jQuery.dir(elem, 'previousSibling', until);
            },
            siblings: function (elem) {
                return jQuery.sibling((elem.parentNode || {}).firstChild, elem);
            },
            children: function (elem) {
                return jQuery.sibling(elem.firstChild);
            },
            contents: function (elem) {
                return jQuery.nodeName(elem, 'iframe') ? elem.contentDocument || elem.contentWindow.document : jQuery.merge([], elem.childNodes);
            }
        }, function (name, fn) {
            jQuery.fn[name] = function (until, selector) {
                var ret = jQuery.map(this, fn, until);
                if (name.slice(-5) !== 'Until') {
                    selector = until;
                }
                if (selector && typeof selector === 'string') {
                    ret = jQuery.filter(selector, ret);
                }
                if (this.length > 1) {
                    // Remove duplicates
                    if (!guaranteedUnique[name]) {
                        ret = jQuery.unique(ret);
                    }
                    // Reverse order for parents* and prev-derivatives
                    if (rparentsprev.test(name)) {
                        ret = ret.reverse();
                    }
                }
                return this.pushStack(ret);
            };
        });
        var rnotwhite = /\S+/g;
        // String to Object options format cache
        var optionsCache = {};
        // Convert String-formatted options into Object-formatted ones and store in cache
        function createOptions(options) {
            var object = optionsCache[options] = {};
            jQuery.each(options.match(rnotwhite) || [], function (_, flag) {
                object[flag] = true;
            });
            return object;
        }
        /*
 * Create a callback list using the following parameters:
 *
 *	options: an optional list of space-separated options that will change how
 *			the callback list behaves or a more traditional option object
 *
 * By default a callback list will act like an event callback list and can be
 * "fired" multiple times.
 *
 * Possible options:
 *
 *	once:			will ensure the callback list can only be fired once (like a Deferred)
 *
 *	memory:			will keep track of previous values and will call any callback added
 *					after the list has been fired right away with the latest "memorized"
 *					values (like a Deferred)
 *
 *	unique:			will ensure a callback can only be added once (no duplicate in the list)
 *
 *	stopOnFalse:	interrupt callings when a callback returns false
 *
 */
        jQuery.Callbacks = function (options) {
            // Convert options from String-formatted to Object-formatted if needed
            // (we check in cache first)
            options = typeof options === 'string' ? optionsCache[options] || createOptions(options) : jQuery.extend({}, options);
            var
                // Flag to know if list is currently firing
                firing,
                // Last fire value (for non-forgettable lists)
                memory,
                // Flag to know if list was already fired
                fired,
                // End of the loop when firing
                firingLength,
                // Index of currently firing callback (modified by remove if needed)
                firingIndex,
                // First callback to fire (used internally by add and fireWith)
                firingStart,
                // Actual callback list
                list = [],
                // Stack of fire calls for repeatable lists
                stack = !options.once && [],
                // Fire callbacks
                fire = function (data) {
                    memory = options.memory && data;
                    fired = true;
                    firingIndex = firingStart || 0;
                    firingStart = 0;
                    firingLength = list.length;
                    firing = true;
                    for (; list && firingIndex < firingLength; firingIndex++) {
                        if (list[firingIndex].apply(data[0], data[1]) === false && options.stopOnFalse) {
                            memory = false;
                            // To prevent further calls using add
                            break;
                        }
                    }
                    firing = false;
                    if (list) {
                        if (stack) {
                            if (stack.length) {
                                fire(stack.shift());
                            }
                        } else if (memory) {
                            list = [];
                        } else {
                            self.disable();
                        }
                    }
                },
                // Actual Callbacks object
                self = {
                    // Add a callback or a collection of callbacks to the list
                    add: function () {
                        if (list) {
                            // First, we save the current length
                            var start = list.length;
                            (function add(args) {
                                jQuery.each(args, function (_, arg) {
                                    var type = jQuery.type(arg);
                                    if (type === 'function') {
                                        if (!options.unique || !self.has(arg)) {
                                            list.push(arg);
                                        }
                                    } else if (arg && arg.length && type !== 'string') {
                                        // Inspect recursively
                                        add(arg);
                                    }
                                });
                            }(arguments));
                            // Do we need to add the callbacks to the
                            // current firing batch?
                            if (firing) {
                                firingLength = list.length;    // With memory, if we're not firing then
                                                               // we should call right away
                            } else if (memory) {
                                firingStart = start;
                                fire(memory);
                            }
                        }
                        return this;
                    },
                    // Remove a callback from the list
                    remove: function () {
                        if (list) {
                            jQuery.each(arguments, function (_, arg) {
                                var index;
                                while ((index = jQuery.inArray(arg, list, index)) > -1) {
                                    list.splice(index, 1);
                                    // Handle firing indexes
                                    if (firing) {
                                        if (index <= firingLength) {
                                            firingLength--;
                                        }
                                        if (index <= firingIndex) {
                                            firingIndex--;
                                        }
                                    }
                                }
                            });
                        }
                        return this;
                    },
                    // Check if a given callback is in the list.
                    // If no argument is given, return whether or not list has callbacks attached.
                    has: function (fn) {
                        return fn ? jQuery.inArray(fn, list) > -1 : !!(list && list.length);
                    },
                    // Remove all callbacks from the list
                    empty: function () {
                        list = [];
                        firingLength = 0;
                        return this;
                    },
                    // Have the list do nothing anymore
                    disable: function () {
                        list = stack = memory = undefined;
                        return this;
                    },
                    // Is it disabled?
                    disabled: function () {
                        return !list;
                    },
                    // Lock the list in its current state
                    lock: function () {
                        stack = undefined;
                        if (!memory) {
                            self.disable();
                        }
                        return this;
                    },
                    // Is it locked?
                    locked: function () {
                        return !stack;
                    },
                    // Call all callbacks with the given context and arguments
                    fireWith: function (context, args) {
                        if (list && (!fired || stack)) {
                            args = args || [];
                            args = [
                                context,
                                args.slice ? args.slice() : args
                            ];
                            if (firing) {
                                stack.push(args);
                            } else {
                                fire(args);
                            }
                        }
                        return this;
                    },
                    // Call all the callbacks with the given arguments
                    fire: function () {
                        self.fireWith(this, arguments);
                        return this;
                    },
                    // To know if the callbacks have already been called at least once
                    fired: function () {
                        return !!fired;
                    }
                };
            return self;
        };
        jQuery.extend({
            Deferred: function (func) {
                var tuples = [
                        // action, add listener, listener list, final state
                        [
                            'resolve',
                            'done',
                            jQuery.Callbacks('once memory'),
                            'resolved'
                        ],
                        [
                            'reject',
                            'fail',
                            jQuery.Callbacks('once memory'),
                            'rejected'
                        ],
                        [
                            'notify',
                            'progress',
                            jQuery.Callbacks('memory')
                        ]
                    ], state = 'pending', promise = {
                        state: function () {
                            return state;
                        },
                        always: function () {
                            deferred.done(arguments).fail(arguments);
                            return this;
                        },
                        then: function () {
                            var fns = arguments;
                            return jQuery.Deferred(function (newDefer) {
                                jQuery.each(tuples, function (i, tuple) {
                                    var fn = jQuery.isFunction(fns[i]) && fns[i];
                                    // deferred[ done | fail | progress ] for forwarding actions to newDefer
                                    deferred[tuple[1]](function () {
                                        var returned = fn && fn.apply(this, arguments);
                                        if (returned && jQuery.isFunction(returned.promise)) {
                                            returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify);
                                        } else {
                                            newDefer[tuple[0] + 'With'](this === promise ? newDefer.promise() : this, fn ? [returned] : arguments);
                                        }
                                    });
                                });
                                fns = null;
                            }).promise();
                        },
                        // Get a promise for this deferred
                        // If obj is provided, the promise aspect is added to the object
                        promise: function (obj) {
                            return obj != null ? jQuery.extend(obj, promise) : promise;
                        }
                    }, deferred = {};
                // Keep pipe for back-compat
                promise.pipe = promise.then;
                // Add list-specific methods
                jQuery.each(tuples, function (i, tuple) {
                    var list = tuple[2], stateString = tuple[3];
                    // promise[ done | fail | progress ] = list.add
                    promise[tuple[1]] = list.add;
                    // Handle state
                    if (stateString) {
                        list.add(function () {
                            // state = [ resolved | rejected ]
                            state = stateString;    // [ reject_list | resolve_list ].disable; progress_list.lock
                        }, tuples[i ^ 1][2].disable, tuples[2][2].lock);
                    }
                    // deferred[ resolve | reject | notify ]
                    deferred[tuple[0]] = function () {
                        deferred[tuple[0] + 'With'](this === deferred ? promise : this, arguments);
                        return this;
                    };
                    deferred[tuple[0] + 'With'] = list.fireWith;
                });
                // Make the deferred a promise
                promise.promise(deferred);
                // Call given func if any
                if (func) {
                    func.call(deferred, deferred);
                }
                // All done!
                return deferred;
            },
            // Deferred helper
            when: function (subordinate) {
                var i = 0, resolveValues = slice.call(arguments), length = resolveValues.length,
                    // the count of uncompleted subordinates
                    remaining = length !== 1 || subordinate && jQuery.isFunction(subordinate.promise) ? length : 0,
                    // the master Deferred. If resolveValues consist of only a single Deferred, just use that.
                    deferred = remaining === 1 ? subordinate : jQuery.Deferred(),
                    // Update function for both resolve and progress values
                    updateFunc = function (i, contexts, values) {
                        return function (value) {
                            contexts[i] = this;
                            values[i] = arguments.length > 1 ? slice.call(arguments) : value;
                            if (values === progressValues) {
                                deferred.notifyWith(contexts, values);
                            } else if (!--remaining) {
                                deferred.resolveWith(contexts, values);
                            }
                        };
                    }, progressValues, progressContexts, resolveContexts;
                // add listeners to Deferred subordinates; treat others as resolved
                if (length > 1) {
                    progressValues = new Array(length);
                    progressContexts = new Array(length);
                    resolveContexts = new Array(length);
                    for (; i < length; i++) {
                        if (resolveValues[i] && jQuery.isFunction(resolveValues[i].promise)) {
                            resolveValues[i].promise().done(updateFunc(i, resolveContexts, resolveValues)).fail(deferred.reject).progress(updateFunc(i, progressContexts, progressValues));
                        } else {
                            --remaining;
                        }
                    }
                }
                // if we're not waiting on anything, resolve the master
                if (!remaining) {
                    deferred.resolveWith(resolveContexts, resolveValues);
                }
                return deferred.promise();
            }
        });
        // The deferred used on DOM ready
        var readyList;
        jQuery.fn.ready = function (fn) {
            // Add the callback
            jQuery.ready.promise().done(fn);
            return this;
        };
        jQuery.extend({
            // Is the DOM ready to be used? Set to true once it occurs.
            isReady: false,
            // A counter to track how many items to wait for before
            // the ready event fires. See #6781
            readyWait: 1,
            // Hold (or release) the ready event
            holdReady: function (hold) {
                if (hold) {
                    jQuery.readyWait++;
                } else {
                    jQuery.ready(true);
                }
            },
            // Handle when the DOM is ready
            ready: function (wait) {
                // Abort if there are pending holds or we're already ready
                if (wait === true ? --jQuery.readyWait : jQuery.isReady) {
                    return;
                }
                // Make sure body exists, at least, in case IE gets a little overzealous (ticket #5443).
                if (!document.body) {
                    return setTimeout(jQuery.ready);
                }
                // Remember that the DOM is ready
                jQuery.isReady = true;
                // If a normal DOM Ready event fired, decrement, and wait if need be
                if (wait !== true && --jQuery.readyWait > 0) {
                    return;
                }
                // If there are functions bound, to execute
                readyList.resolveWith(document, [jQuery]);
                // Trigger any bound ready events
                if (jQuery.fn.triggerHandler) {
                    jQuery(document).triggerHandler('ready');
                    jQuery(document).off('ready');
                }
            }
        });
        /**
 * Clean-up method for dom ready events
 */
        function detach() {
            if (document.addEventListener) {
                document.removeEventListener('DOMContentLoaded', completed, false);
                window.removeEventListener('load', completed, false);
            } else {
                document.detachEvent('onreadystatechange', completed);
                window.detachEvent('onload', completed);
            }
        }
        /**
 * The ready event handler and self cleanup method
 */
        function completed() {
            // readyState === "complete" is good enough for us to call the dom ready in oldIE
            if (document.addEventListener || event.type === 'load' || document.readyState === 'complete') {
                detach();
                jQuery.ready();
            }
        }
        jQuery.ready.promise = function (obj) {
            if (!readyList) {
                readyList = jQuery.Deferred();
                // Catch cases where $(document).ready() is called after the browser event has already occurred.
                // we once tried to use readyState "interactive" here, but it caused issues like the one
                // discovered by ChrisS here: http://bugs.jquery.com/ticket/12282#comment:15
                if (document.readyState === 'complete') {
                    // Handle it asynchronously to allow scripts the opportunity to delay ready
                    setTimeout(jQuery.ready);    // Standards-based browsers support DOMContentLoaded
                } else if (document.addEventListener) {
                    // Use the handy event callback
                    document.addEventListener('DOMContentLoaded', completed, false);
                    // A fallback to window.onload, that will always work
                    window.addEventListener('load', completed, false);    // If IE event model is used
                } else {
                    // Ensure firing before onload, maybe late but safe also for iframes
                    document.attachEvent('onreadystatechange', completed);
                    // A fallback to window.onload, that will always work
                    window.attachEvent('onload', completed);
                    // If IE and not a frame
                    // continually check to see if the document is ready
                    var top = false;
                    try {
                        top = window.frameElement == null && document.documentElement;
                    } catch (e) {
                    }
                    if (top && top.doScroll) {
                        (function doScrollCheck() {
                            if (!jQuery.isReady) {
                                try {
                                    // Use the trick by Diego Perini
                                    // http://javascript.nwbox.com/IEContentLoaded/
                                    top.doScroll('left');
                                } catch (e) {
                                    return setTimeout(doScrollCheck, 50);
                                }
                                // detach all dom ready events
                                detach();
                                // and execute any waiting functions
                                jQuery.ready();
                            }
                        }());
                    }
                }
            }
            return readyList.promise(obj);
        };
        var strundefined = typeof undefined;
        // Support: IE<9
        // Iteration over object's inherited properties before its own
        var i;
        for (i in jQuery(support)) {
            break;
        }
        support.ownLast = i !== '0';
        // Note: most support tests are defined in their respective modules.
        // false until the test is run
        support.inlineBlockNeedsLayout = false;
        // Execute ASAP in case we need to set body.style.zoom
        jQuery(function () {
            // Minified: var a,b,c,d
            var val, div, body, container;
            body = document.getElementsByTagName('body')[0];
            if (!body || !body.style) {
                // Return for frameset docs that don't have a body
                return;
            }
            // Setup
            div = document.createElement('div');
            container = document.createElement('div');
            container.style.cssText = 'position:absolute;border:0;width:0;height:0;top:0;left:-9999px';
            body.appendChild(container).appendChild(div);
            if (typeof div.style.zoom !== strundefined) {
                // Support: IE<8
                // Check if natively block-level elements act like inline-block
                // elements when setting their display to 'inline' and giving
                // them layout
                div.style.cssText = 'display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1';
                support.inlineBlockNeedsLayout = val = div.offsetWidth === 3;
                if (val) {
                    // Prevent IE 6 from affecting layout for positioned elements #11048
                    // Prevent IE from shrinking the body in IE 7 mode #12869
                    // Support: IE<8
                    body.style.zoom = 1;
                }
            }
            body.removeChild(container);
        });
        (function () {
            var div = document.createElement('div');
            // Execute the test only if not already executed in another module.
            if (support.deleteExpando == null) {
                // Support: IE<9
                support.deleteExpando = true;
                try {
                    delete div.test;
                } catch (e) {
                    support.deleteExpando = false;
                }
            }
            // Null elements to avoid leaks in IE.
            div = null;
        }());
        /**
 * Determines whether an object can have data
 */
        jQuery.acceptData = function (elem) {
            var noData = jQuery.noData[(elem.nodeName + ' ').toLowerCase()], nodeType = +elem.nodeType || 1;
            // Do not set data on non-element DOM nodes because it will not be cleared (#8335).
            return nodeType !== 1 && nodeType !== 9 ? false : // Nodes accept data unless otherwise specified; rejection can be conditional
            !noData || noData !== true && elem.getAttribute('classid') === noData;
        };
        var rbrace = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/, rmultiDash = /([A-Z])/g;
        function dataAttr(elem, key, data) {
            // If nothing was found internally, try to fetch any
            // data from the HTML5 data-* attribute
            if (data === undefined && elem.nodeType === 1) {
                var name = 'data-' + key.replace(rmultiDash, '-$1').toLowerCase();
                data = elem.getAttribute(name);
                if (typeof data === 'string') {
                    try {
                        data = data === 'true' ? true : data === 'false' ? false : data === 'null' ? null : // Only convert to a number if it doesn't change the string
                        +data + '' === data ? +data : rbrace.test(data) ? jQuery.parseJSON(data) : data;
                    } catch (e) {
                    }
                    // Make sure we set the data so it isn't changed later
                    jQuery.data(elem, key, data);
                } else {
                    data = undefined;
                }
            }
            return data;
        }
        // checks a cache object for emptiness
        function isEmptyDataObject(obj) {
            var name;
            for (name in obj) {
                // if the public data object is empty, the private is still empty
                if (name === 'data' && jQuery.isEmptyObject(obj[name])) {
                    continue;
                }
                if (name !== 'toJSON') {
                    return false;
                }
            }
            return true;
        }
        function internalData(elem, name, data, pvt) {
            if (!jQuery.acceptData(elem)) {
                return;
            }
            var ret, thisCache, internalKey = jQuery.expando,
                // We have to handle DOM nodes and JS objects differently because IE6-7
                // can't GC object references properly across the DOM-JS boundary
                isNode = elem.nodeType,
                // Only DOM nodes need the global jQuery cache; JS object data is
                // attached directly to the object so GC can occur automatically
                cache = isNode ? jQuery.cache : elem,
                // Only defining an ID for JS objects if its cache already exists allows
                // the code to shortcut on the same path as a DOM node with no cache
                id = isNode ? elem[internalKey] : elem[internalKey] && internalKey;
            // Avoid doing any more work than we need to when trying to get data on an
            // object that has no data at all
            if ((!id || !cache[id] || !pvt && !cache[id].data) && data === undefined && typeof name === 'string') {
                return;
            }
            if (!id) {
                // Only DOM nodes need a new unique ID for each element since their data
                // ends up in the global cache
                if (isNode) {
                    id = elem[internalKey] = deletedIds.pop() || jQuery.guid++;
                } else {
                    id = internalKey;
                }
            }
            if (!cache[id]) {
                // Avoid exposing jQuery metadata on plain JS objects when the object
                // is serialized using JSON.stringify
                cache[id] = isNode ? {} : { toJSON: jQuery.noop };
            }
            // An object can be passed to jQuery.data instead of a key/value pair; this gets
            // shallow copied over onto the existing cache
            if (typeof name === 'object' || typeof name === 'function') {
                if (pvt) {
                    cache[id] = jQuery.extend(cache[id], name);
                } else {
                    cache[id].data = jQuery.extend(cache[id].data, name);
                }
            }
            thisCache = cache[id];
            // jQuery data() is stored in a separate object inside the object's internal data
            // cache in order to avoid key collisions between internal data and user-defined
            // data.
            if (!pvt) {
                if (!thisCache.data) {
                    thisCache.data = {};
                }
                thisCache = thisCache.data;
            }
            if (data !== undefined) {
                thisCache[jQuery.camelCase(name)] = data;
            }
            // Check for both converted-to-camel and non-converted data property names
            // If a data property was specified
            if (typeof name === 'string') {
                // First Try to find as-is property data
                ret = thisCache[name];
                // Test for null|undefined property data
                if (ret == null) {
                    // Try to find the camelCased property
                    ret = thisCache[jQuery.camelCase(name)];
                }
            } else {
                ret = thisCache;
            }
            return ret;
        }
        function internalRemoveData(elem, name, pvt) {
            if (!jQuery.acceptData(elem)) {
                return;
            }
            var thisCache, i, isNode = elem.nodeType,
                // See jQuery.data for more information
                cache = isNode ? jQuery.cache : elem, id = isNode ? elem[jQuery.expando] : jQuery.expando;
            // If there is already no cache entry for this object, there is no
            // purpose in continuing
            if (!cache[id]) {
                return;
            }
            if (name) {
                thisCache = pvt ? cache[id] : cache[id].data;
                if (thisCache) {
                    // Support array or space separated string names for data keys
                    if (!jQuery.isArray(name)) {
                        // try the string as a key before any manipulation
                        if (name in thisCache) {
                            name = [name];
                        } else {
                            // split the camel cased version by spaces unless a key with the spaces exists
                            name = jQuery.camelCase(name);
                            if (name in thisCache) {
                                name = [name];
                            } else {
                                name = name.split(' ');
                            }
                        }
                    } else {
                        // If "name" is an array of keys...
                        // When data is initially created, via ("key", "val") signature,
                        // keys will be converted to camelCase.
                        // Since there is no way to tell _how_ a key was added, remove
                        // both plain key and camelCase key. #12786
                        // This will only penalize the array argument path.
                        name = name.concat(jQuery.map(name, jQuery.camelCase));
                    }
                    i = name.length;
                    while (i--) {
                        delete thisCache[name[i]];
                    }
                    // If there is no data left in the cache, we want to continue
                    // and let the cache object itself get destroyed
                    if (pvt ? !isEmptyDataObject(thisCache) : !jQuery.isEmptyObject(thisCache)) {
                        return;
                    }
                }
            }
            // See jQuery.data for more information
            if (!pvt) {
                delete cache[id].data;
                // Don't destroy the parent cache unless the internal data object
                // had been the only thing left in it
                if (!isEmptyDataObject(cache[id])) {
                    return;
                }
            }
            // Destroy the cache
            if (isNode) {
                jQuery.cleanData([elem], true);    // Use delete when supported for expandos or `cache` is not a window per isWindow (#10080)
                                                   /* jshint eqeqeq: false */
            } else if (support.deleteExpando || cache != cache.window) {
                /* jshint eqeqeq: true */
                delete cache[id];    // When all else fails, null
            } else {
                cache[id] = null;
            }
        }
        jQuery.extend({
            cache: {},
            // The following elements (space-suffixed to avoid Object.prototype collisions)
            // throw uncatchable exceptions if you attempt to set expando properties
            noData: {
                'applet ': true,
                'embed ': true,
                // ...but Flash objects (which have this classid) *can* handle expandos
                'object ': 'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'
            },
            hasData: function (elem) {
                elem = elem.nodeType ? jQuery.cache[elem[jQuery.expando]] : elem[jQuery.expando];
                return !!elem && !isEmptyDataObject(elem);
            },
            data: function (elem, name, data) {
                return internalData(elem, name, data);
            },
            removeData: function (elem, name) {
                return internalRemoveData(elem, name);
            },
            // For internal use only.
            _data: function (elem, name, data) {
                return internalData(elem, name, data, true);
            },
            _removeData: function (elem, name) {
                return internalRemoveData(elem, name, true);
            }
        });
        jQuery.fn.extend({
            data: function (key, value) {
                var i, name, data, elem = this[0], attrs = elem && elem.attributes;
                // Special expections of .data basically thwart jQuery.access,
                // so implement the relevant behavior ourselves
                // Gets all values
                if (key === undefined) {
                    if (this.length) {
                        data = jQuery.data(elem);
                        if (elem.nodeType === 1 && !jQuery._data(elem, 'parsedAttrs')) {
                            i = attrs.length;
                            while (i--) {
                                // Support: IE11+
                                // The attrs elements can be null (#14894)
                                if (attrs[i]) {
                                    name = attrs[i].name;
                                    if (name.indexOf('data-') === 0) {
                                        name = jQuery.camelCase(name.slice(5));
                                        dataAttr(elem, name, data[name]);
                                    }
                                }
                            }
                            jQuery._data(elem, 'parsedAttrs', true);
                        }
                    }
                    return data;
                }
                // Sets multiple values
                if (typeof key === 'object') {
                    return this.each(function () {
                        jQuery.data(this, key);
                    });
                }
                return arguments.length > 1 ? // Sets one value
                this.each(function () {
                    jQuery.data(this, key, value);
                }) : // Gets one value
                // Try to fetch any internally stored data first
                elem ? dataAttr(elem, key, jQuery.data(elem, key)) : undefined;
            },
            removeData: function (key) {
                return this.each(function () {
                    jQuery.removeData(this, key);
                });
            }
        });
        jQuery.extend({
            queue: function (elem, type, data) {
                var queue;
                if (elem) {
                    type = (type || 'fx') + 'queue';
                    queue = jQuery._data(elem, type);
                    // Speed up dequeue by getting out quickly if this is just a lookup
                    if (data) {
                        if (!queue || jQuery.isArray(data)) {
                            queue = jQuery._data(elem, type, jQuery.makeArray(data));
                        } else {
                            queue.push(data);
                        }
                    }
                    return queue || [];
                }
            },
            dequeue: function (elem, type) {
                type = type || 'fx';
                var queue = jQuery.queue(elem, type), startLength = queue.length, fn = queue.shift(), hooks = jQuery._queueHooks(elem, type), next = function () {
                        jQuery.dequeue(elem, type);
                    };
                // If the fx queue is dequeued, always remove the progress sentinel
                if (fn === 'inprogress') {
                    fn = queue.shift();
                    startLength--;
                }
                if (fn) {
                    // Add a progress sentinel to prevent the fx queue from being
                    // automatically dequeued
                    if (type === 'fx') {
                        queue.unshift('inprogress');
                    }
                    // clear up the last queue stop function
                    delete hooks.stop;
                    fn.call(elem, next, hooks);
                }
                if (!startLength && hooks) {
                    hooks.empty.fire();
                }
            },
            // not intended for public consumption - generates a queueHooks object, or returns the current one
            _queueHooks: function (elem, type) {
                var key = type + 'queueHooks';
                return jQuery._data(elem, key) || jQuery._data(elem, key, {
                    empty: jQuery.Callbacks('once memory').add(function () {
                        jQuery._removeData(elem, type + 'queue');
                        jQuery._removeData(elem, key);
                    })
                });
            }
        });
        jQuery.fn.extend({
            queue: function (type, data) {
                var setter = 2;
                if (typeof type !== 'string') {
                    data = type;
                    type = 'fx';
                    setter--;
                }
                if (arguments.length < setter) {
                    return jQuery.queue(this[0], type);
                }
                return data === undefined ? this : this.each(function () {
                    var queue = jQuery.queue(this, type, data);
                    // ensure a hooks for this queue
                    jQuery._queueHooks(this, type);
                    if (type === 'fx' && queue[0] !== 'inprogress') {
                        jQuery.dequeue(this, type);
                    }
                });
            },
            dequeue: function (type) {
                return this.each(function () {
                    jQuery.dequeue(this, type);
                });
            },
            clearQueue: function (type) {
                return this.queue(type || 'fx', []);
            },
            // Get a promise resolved when queues of a certain type
            // are emptied (fx is the type by default)
            promise: function (type, obj) {
                var tmp, count = 1, defer = jQuery.Deferred(), elements = this, i = this.length, resolve = function () {
                        if (!--count) {
                            defer.resolveWith(elements, [elements]);
                        }
                    };
                if (typeof type !== 'string') {
                    obj = type;
                    type = undefined;
                }
                type = type || 'fx';
                while (i--) {
                    tmp = jQuery._data(elements[i], type + 'queueHooks');
                    if (tmp && tmp.empty) {
                        count++;
                        tmp.empty.add(resolve);
                    }
                }
                resolve();
                return defer.promise(obj);
            }
        });
        var pnum = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source;
        var cssExpand = [
            'Top',
            'Right',
            'Bottom',
            'Left'
        ];
        var isHidden = function (elem, el) {
            // isHidden might be called from jQuery#filter function;
            // in that case, element will be second argument
            elem = el || elem;
            return jQuery.css(elem, 'display') === 'none' || !jQuery.contains(elem.ownerDocument, elem);
        };
        // Multifunctional method to get and set values of a collection
        // The value/s can optionally be executed if it's a function
        var access = jQuery.access = function (elems, fn, key, value, chainable, emptyGet, raw) {
            var i = 0, length = elems.length, bulk = key == null;
            // Sets many values
            if (jQuery.type(key) === 'object') {
                chainable = true;
                for (i in key) {
                    jQuery.access(elems, fn, i, key[i], true, emptyGet, raw);
                }    // Sets one value
            } else if (value !== undefined) {
                chainable = true;
                if (!jQuery.isFunction(value)) {
                    raw = true;
                }
                if (bulk) {
                    // Bulk operations run against the entire set
                    if (raw) {
                        fn.call(elems, value);
                        fn = null;    // ...except when executing function values
                    } else {
                        bulk = fn;
                        fn = function (elem, key, value) {
                            return bulk.call(jQuery(elem), value);
                        };
                    }
                }
                if (fn) {
                    for (; i < length; i++) {
                        fn(elems[i], key, raw ? value : value.call(elems[i], i, fn(elems[i], key)));
                    }
                }
            }
            return chainable ? elems : // Gets
            bulk ? fn.call(elems) : length ? fn(elems[0], key) : emptyGet;
        };
        var rcheckableType = /^(?:checkbox|radio)$/i;
        (function () {
            // Minified: var a,b,c
            var input = document.createElement('input'), div = document.createElement('div'), fragment = document.createDocumentFragment();
            // Setup
            div.innerHTML = '  <link/><table></table><a href=\'/a\'>a</a><input type=\'checkbox\'/>';
            // IE strips leading whitespace when .innerHTML is used
            support.leadingWhitespace = div.firstChild.nodeType === 3;
            // Make sure that tbody elements aren't automatically inserted
            // IE will insert them into empty tables
            support.tbody = !div.getElementsByTagName('tbody').length;
            // Make sure that link elements get serialized correctly by innerHTML
            // This requires a wrapper element in IE
            support.htmlSerialize = !!div.getElementsByTagName('link').length;
            // Makes sure cloning an html5 element does not cause problems
            // Where outerHTML is undefined, this still works
            support.html5Clone = document.createElement('nav').cloneNode(true).outerHTML !== '<:nav></:nav>';
            // Check if a disconnected checkbox will retain its checked
            // value of true after appended to the DOM (IE6/7)
            input.type = 'checkbox';
            input.checked = true;
            fragment.appendChild(input);
            support.appendChecked = input.checked;
            // Make sure textarea (and checkbox) defaultValue is properly cloned
            // Support: IE6-IE11+
            div.innerHTML = '<textarea>x</textarea>';
            support.noCloneChecked = !!div.cloneNode(true).lastChild.defaultValue;
            // #11217 - WebKit loses check when the name is after the checked attribute
            fragment.appendChild(div);
            div.innerHTML = '<input type=\'radio\' checked=\'checked\' name=\'t\'/>';
            // Support: Safari 5.1, iOS 5.1, Android 4.x, Android 2.3
            // old WebKit doesn't clone checked state correctly in fragments
            support.checkClone = div.cloneNode(true).cloneNode(true).lastChild.checked;
            // Support: IE<9
            // Opera does not clone events (and typeof div.attachEvent === undefined).
            // IE9-10 clones events bound via attachEvent, but they don't trigger with .click()
            support.noCloneEvent = true;
            if (div.attachEvent) {
                div.attachEvent('onclick', function () {
                    support.noCloneEvent = false;
                });
                div.cloneNode(true).click();
            }
            // Execute the test only if not already executed in another module.
            if (support.deleteExpando == null) {
                // Support: IE<9
                support.deleteExpando = true;
                try {
                    delete div.test;
                } catch (e) {
                    support.deleteExpando = false;
                }
            }
        }());
        (function () {
            var i, eventName, div = document.createElement('div');
            // Support: IE<9 (lack submit/change bubble), Firefox 23+ (lack focusin event)
            for (i in {
                    submit: true,
                    change: true,
                    focusin: true
                }) {
                eventName = 'on' + i;
                if (!(support[i + 'Bubbles'] = eventName in window)) {
                    // Beware of CSP restrictions (https://developer.mozilla.org/en/Security/CSP)
                    div.setAttribute(eventName, 't');
                    support[i + 'Bubbles'] = div.attributes[eventName].expando === false;
                }
            }
            // Null elements to avoid leaks in IE.
            div = null;
        }());
        var rformElems = /^(?:input|select|textarea)$/i, rkeyEvent = /^key/, rmouseEvent = /^(?:mouse|pointer|contextmenu)|click/, rfocusMorph = /^(?:focusinfocus|focusoutblur)$/, rtypenamespace = /^([^.]*)(?:\.(.+)|)$/;
        function returnTrue() {
            return true;
        }
        function returnFalse() {
            return false;
        }
        function safeActiveElement() {
            try {
                return document.activeElement;
            } catch (err) {
            }
        }
        /*
 * Helper functions for managing events -- not part of the public interface.
 * Props to Dean Edwards' addEvent library for many of the ideas.
 */
        jQuery.event = {
            global: {},
            add: function (elem, types, handler, data, selector) {
                var tmp, events, t, handleObjIn, special, eventHandle, handleObj, handlers, type, namespaces, origType, elemData = jQuery._data(elem);
                // Don't attach events to noData or text/comment nodes (but allow plain objects)
                if (!elemData) {
                    return;
                }
                // Caller can pass in an object of custom data in lieu of the handler
                if (handler.handler) {
                    handleObjIn = handler;
                    handler = handleObjIn.handler;
                    selector = handleObjIn.selector;
                }
                // Make sure that the handler has a unique ID, used to find/remove it later
                if (!handler.guid) {
                    handler.guid = jQuery.guid++;
                }
                // Init the element's event structure and main handler, if this is the first
                if (!(events = elemData.events)) {
                    events = elemData.events = {};
                }
                if (!(eventHandle = elemData.handle)) {
                    eventHandle = elemData.handle = function (e) {
                        // Discard the second event of a jQuery.event.trigger() and
                        // when an event is called after a page has unloaded
                        return typeof jQuery !== strundefined && (!e || jQuery.event.triggered !== e.type) ? jQuery.event.dispatch.apply(eventHandle.elem, arguments) : undefined;
                    };
                    // Add elem as a property of the handle fn to prevent a memory leak with IE non-native events
                    eventHandle.elem = elem;
                }
                // Handle multiple events separated by a space
                types = (types || '').match(rnotwhite) || [''];
                t = types.length;
                while (t--) {
                    tmp = rtypenamespace.exec(types[t]) || [];
                    type = origType = tmp[1];
                    namespaces = (tmp[2] || '').split('.').sort();
                    // There *must* be a type, no attaching namespace-only handlers
                    if (!type) {
                        continue;
                    }
                    // If event changes its type, use the special event handlers for the changed type
                    special = jQuery.event.special[type] || {};
                    // If selector defined, determine special event api type, otherwise given type
                    type = (selector ? special.delegateType : special.bindType) || type;
                    // Update special based on newly reset type
                    special = jQuery.event.special[type] || {};
                    // handleObj is passed to all event handlers
                    handleObj = jQuery.extend({
                        type: type,
                        origType: origType,
                        data: data,
                        handler: handler,
                        guid: handler.guid,
                        selector: selector,
                        needsContext: selector && jQuery.expr.match.needsContext.test(selector),
                        namespace: namespaces.join('.')
                    }, handleObjIn);
                    // Init the event handler queue if we're the first
                    if (!(handlers = events[type])) {
                        handlers = events[type] = [];
                        handlers.delegateCount = 0;
                        // Only use addEventListener/attachEvent if the special events handler returns false
                        if (!special.setup || special.setup.call(elem, data, namespaces, eventHandle) === false) {
                            // Bind the global event handler to the element
                            if (elem.addEventListener) {
                                elem.addEventListener(type, eventHandle, false);
                            } else if (elem.attachEvent) {
                                elem.attachEvent('on' + type, eventHandle);
                            }
                        }
                    }
                    if (special.add) {
                        special.add.call(elem, handleObj);
                        if (!handleObj.handler.guid) {
                            handleObj.handler.guid = handler.guid;
                        }
                    }
                    // Add to the element's handler list, delegates in front
                    if (selector) {
                        handlers.splice(handlers.delegateCount++, 0, handleObj);
                    } else {
                        handlers.push(handleObj);
                    }
                    // Keep track of which events have ever been used, for event optimization
                    jQuery.event.global[type] = true;
                }
                // Nullify elem to prevent memory leaks in IE
                elem = null;
            },
            // Detach an event or set of events from an element
            remove: function (elem, types, handler, selector, mappedTypes) {
                var j, handleObj, tmp, origCount, t, events, special, handlers, type, namespaces, origType, elemData = jQuery.hasData(elem) && jQuery._data(elem);
                if (!elemData || !(events = elemData.events)) {
                    return;
                }
                // Once for each type.namespace in types; type may be omitted
                types = (types || '').match(rnotwhite) || [''];
                t = types.length;
                while (t--) {
                    tmp = rtypenamespace.exec(types[t]) || [];
                    type = origType = tmp[1];
                    namespaces = (tmp[2] || '').split('.').sort();
                    // Unbind all events (on this namespace, if provided) for the element
                    if (!type) {
                        for (type in events) {
                            jQuery.event.remove(elem, type + types[t], handler, selector, true);
                        }
                        continue;
                    }
                    special = jQuery.event.special[type] || {};
                    type = (selector ? special.delegateType : special.bindType) || type;
                    handlers = events[type] || [];
                    tmp = tmp[2] && new RegExp('(^|\\.)' + namespaces.join('\\.(?:.*\\.|)') + '(\\.|$)');
                    // Remove matching events
                    origCount = j = handlers.length;
                    while (j--) {
                        handleObj = handlers[j];
                        if ((mappedTypes || origType === handleObj.origType) && (!handler || handler.guid === handleObj.guid) && (!tmp || tmp.test(handleObj.namespace)) && (!selector || selector === handleObj.selector || selector === '**' && handleObj.selector)) {
                            handlers.splice(j, 1);
                            if (handleObj.selector) {
                                handlers.delegateCount--;
                            }
                            if (special.remove) {
                                special.remove.call(elem, handleObj);
                            }
                        }
                    }
                    // Remove generic event handler if we removed something and no more handlers exist
                    // (avoids potential for endless recursion during removal of special event handlers)
                    if (origCount && !handlers.length) {
                        if (!special.teardown || special.teardown.call(elem, namespaces, elemData.handle) === false) {
                            jQuery.removeEvent(elem, type, elemData.handle);
                        }
                        delete events[type];
                    }
                }
                // Remove the expando if it's no longer used
                if (jQuery.isEmptyObject(events)) {
                    delete elemData.handle;
                    // removeData also checks for emptiness and clears the expando if empty
                    // so use it instead of delete
                    jQuery._removeData(elem, 'events');
                }
            },
            trigger: function (event, data, elem, onlyHandlers) {
                var handle, ontype, cur, bubbleType, special, tmp, i, eventPath = [elem || document], type = hasOwn.call(event, 'type') ? event.type : event, namespaces = hasOwn.call(event, 'namespace') ? event.namespace.split('.') : [];
                cur = tmp = elem = elem || document;
                // Don't do events on text and comment nodes
                if (elem.nodeType === 3 || elem.nodeType === 8) {
                    return;
                }
                // focus/blur morphs to focusin/out; ensure we're not firing them right now
                if (rfocusMorph.test(type + jQuery.event.triggered)) {
                    return;
                }
                if (type.indexOf('.') >= 0) {
                    // Namespaced trigger; create a regexp to match event type in handle()
                    namespaces = type.split('.');
                    type = namespaces.shift();
                    namespaces.sort();
                }
                ontype = type.indexOf(':') < 0 && 'on' + type;
                // Caller can pass in a jQuery.Event object, Object, or just an event type string
                event = event[jQuery.expando] ? event : new jQuery.Event(type, typeof event === 'object' && event);
                // Trigger bitmask: & 1 for native handlers; & 2 for jQuery (always true)
                event.isTrigger = onlyHandlers ? 2 : 3;
                event.namespace = namespaces.join('.');
                event.namespace_re = event.namespace ? new RegExp('(^|\\.)' + namespaces.join('\\.(?:.*\\.|)') + '(\\.|$)') : null;
                // Clean up the event in case it is being reused
                event.result = undefined;
                if (!event.target) {
                    event.target = elem;
                }
                // Clone any incoming data and prepend the event, creating the handler arg list
                data = data == null ? [event] : jQuery.makeArray(data, [event]);
                // Allow special events to draw outside the lines
                special = jQuery.event.special[type] || {};
                if (!onlyHandlers && special.trigger && special.trigger.apply(elem, data) === false) {
                    return;
                }
                // Determine event propagation path in advance, per W3C events spec (#9951)
                // Bubble up to document, then to window; watch for a global ownerDocument var (#9724)
                if (!onlyHandlers && !special.noBubble && !jQuery.isWindow(elem)) {
                    bubbleType = special.delegateType || type;
                    if (!rfocusMorph.test(bubbleType + type)) {
                        cur = cur.parentNode;
                    }
                    for (; cur; cur = cur.parentNode) {
                        eventPath.push(cur);
                        tmp = cur;
                    }
                    // Only add window if we got to document (e.g., not plain obj or detached DOM)
                    if (tmp === (elem.ownerDocument || document)) {
                        eventPath.push(tmp.defaultView || tmp.parentWindow || window);
                    }
                }
                // Fire handlers on the event path
                i = 0;
                while ((cur = eventPath[i++]) && !event.isPropagationStopped()) {
                    event.type = i > 1 ? bubbleType : special.bindType || type;
                    // jQuery handler
                    handle = (jQuery._data(cur, 'events') || {})[event.type] && jQuery._data(cur, 'handle');
                    if (handle) {
                        handle.apply(cur, data);
                    }
                    // Native handler
                    handle = ontype && cur[ontype];
                    if (handle && handle.apply && jQuery.acceptData(cur)) {
                        event.result = handle.apply(cur, data);
                        if (event.result === false) {
                            event.preventDefault();
                        }
                    }
                }
                event.type = type;
                // If nobody prevented the default action, do it now
                if (!onlyHandlers && !event.isDefaultPrevented()) {
                    if ((!special._default || special._default.apply(eventPath.pop(), data) === false) && jQuery.acceptData(elem)) {
                        // Call a native DOM method on the target with the same name name as the event.
                        // Can't use an .isFunction() check here because IE6/7 fails that test.
                        // Don't do default actions on window, that's where global variables be (#6170)
                        if (ontype && elem[type] && !jQuery.isWindow(elem)) {
                            // Don't re-trigger an onFOO event when we call its FOO() method
                            tmp = elem[ontype];
                            if (tmp) {
                                elem[ontype] = null;
                            }
                            // Prevent re-triggering of the same event, since we already bubbled it above
                            jQuery.event.triggered = type;
                            try {
                                elem[type]();
                            } catch (e) {
                            }
                            jQuery.event.triggered = undefined;
                            if (tmp) {
                                elem[ontype] = tmp;
                            }
                        }
                    }
                }
                return event.result;
            },
            dispatch: function (event) {
                // Make a writable jQuery.Event from the native event object
                event = jQuery.event.fix(event);
                var i, ret, handleObj, matched, j, handlerQueue = [], args = slice.call(arguments), handlers = (jQuery._data(this, 'events') || {})[event.type] || [], special = jQuery.event.special[event.type] || {};
                // Use the fix-ed jQuery.Event rather than the (read-only) native event
                args[0] = event;
                event.delegateTarget = this;
                // Call the preDispatch hook for the mapped type, and let it bail if desired
                if (special.preDispatch && special.preDispatch.call(this, event) === false) {
                    return;
                }
                // Determine handlers
                handlerQueue = jQuery.event.handlers.call(this, event, handlers);
                // Run delegates first; they may want to stop propagation beneath us
                i = 0;
                while ((matched = handlerQueue[i++]) && !event.isPropagationStopped()) {
                    event.currentTarget = matched.elem;
                    j = 0;
                    while ((handleObj = matched.handlers[j++]) && !event.isImmediatePropagationStopped()) {
                        // Triggered event must either 1) have no namespace, or
                        // 2) have namespace(s) a subset or equal to those in the bound event (both can have no namespace).
                        if (!event.namespace_re || event.namespace_re.test(handleObj.namespace)) {
                            event.handleObj = handleObj;
                            event.data = handleObj.data;
                            ret = ((jQuery.event.special[handleObj.origType] || {}).handle || handleObj.handler).apply(matched.elem, args);
                            if (ret !== undefined) {
                                if ((event.result = ret) === false) {
                                    event.preventDefault();
                                    event.stopPropagation();
                                }
                            }
                        }
                    }
                }
                // Call the postDispatch hook for the mapped type
                if (special.postDispatch) {
                    special.postDispatch.call(this, event);
                }
                return event.result;
            },
            handlers: function (event, handlers) {
                var sel, handleObj, matches, i, handlerQueue = [], delegateCount = handlers.delegateCount, cur = event.target;
                // Find delegate handlers
                // Black-hole SVG <use> instance trees (#13180)
                // Avoid non-left-click bubbling in Firefox (#3861)
                if (delegateCount && cur.nodeType && (!event.button || event.type !== 'click')) {
                    /* jshint eqeqeq: false */
                    for (; cur != this; cur = cur.parentNode || this) {
                        /* jshint eqeqeq: true */
                        // Don't check non-elements (#13208)
                        // Don't process clicks on disabled elements (#6911, #8165, #11382, #11764)
                        if (cur.nodeType === 1 && (cur.disabled !== true || event.type !== 'click')) {
                            matches = [];
                            for (i = 0; i < delegateCount; i++) {
                                handleObj = handlers[i];
                                // Don't conflict with Object.prototype properties (#13203)
                                sel = handleObj.selector + ' ';
                                if (matches[sel] === undefined) {
                                    matches[sel] = handleObj.needsContext ? jQuery(sel, this).index(cur) >= 0 : jQuery.find(sel, this, null, [cur]).length;
                                }
                                if (matches[sel]) {
                                    matches.push(handleObj);
                                }
                            }
                            if (matches.length) {
                                handlerQueue.push({
                                    elem: cur,
                                    handlers: matches
                                });
                            }
                        }
                    }
                }
                // Add the remaining (directly-bound) handlers
                if (delegateCount < handlers.length) {
                    handlerQueue.push({
                        elem: this,
                        handlers: handlers.slice(delegateCount)
                    });
                }
                return handlerQueue;
            },
            fix: function (event) {
                if (event[jQuery.expando]) {
                    return event;
                }
                // Create a writable copy of the event object and normalize some properties
                var i, prop, copy, type = event.type, originalEvent = event, fixHook = this.fixHooks[type];
                if (!fixHook) {
                    this.fixHooks[type] = fixHook = rmouseEvent.test(type) ? this.mouseHooks : rkeyEvent.test(type) ? this.keyHooks : {};
                }
                copy = fixHook.props ? this.props.concat(fixHook.props) : this.props;
                event = new jQuery.Event(originalEvent);
                i = copy.length;
                while (i--) {
                    prop = copy[i];
                    event[prop] = originalEvent[prop];
                }
                // Support: IE<9
                // Fix target property (#1925)
                if (!event.target) {
                    event.target = originalEvent.srcElement || document;
                }
                // Support: Chrome 23+, Safari?
                // Target should not be a text node (#504, #13143)
                if (event.target.nodeType === 3) {
                    event.target = event.target.parentNode;
                }
                // Support: IE<9
                // For mouse/key events, metaKey==false if it's undefined (#3368, #11328)
                event.metaKey = !!event.metaKey;
                return fixHook.filter ? fixHook.filter(event, originalEvent) : event;
            },
            // Includes some event props shared by KeyEvent and MouseEvent
            props: 'altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which'.split(' '),
            fixHooks: {},
            keyHooks: {
                props: 'char charCode key keyCode'.split(' '),
                filter: function (event, original) {
                    // Add which for key events
                    if (event.which == null) {
                        event.which = original.charCode != null ? original.charCode : original.keyCode;
                    }
                    return event;
                }
            },
            mouseHooks: {
                props: 'button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement'.split(' '),
                filter: function (event, original) {
                    var body, eventDoc, doc, button = original.button, fromElement = original.fromElement;
                    // Calculate pageX/Y if missing and clientX/Y available
                    if (event.pageX == null && original.clientX != null) {
                        eventDoc = event.target.ownerDocument || document;
                        doc = eventDoc.documentElement;
                        body = eventDoc.body;
                        event.pageX = original.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0);
                        event.pageY = original.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop || body && body.clientTop || 0);
                    }
                    // Add relatedTarget, if necessary
                    if (!event.relatedTarget && fromElement) {
                        event.relatedTarget = fromElement === event.target ? original.toElement : fromElement;
                    }
                    // Add which for click: 1 === left; 2 === middle; 3 === right
                    // Note: button is not normalized, so don't use it
                    if (!event.which && button !== undefined) {
                        event.which = button & 1 ? 1 : button & 2 ? 3 : button & 4 ? 2 : 0;
                    }
                    return event;
                }
            },
            special: {
                load: {
                    // Prevent triggered image.load events from bubbling to window.load
                    noBubble: true
                },
                focus: {
                    // Fire native event if possible so blur/focus sequence is correct
                    trigger: function () {
                        if (this !== safeActiveElement() && this.focus) {
                            try {
                                this.focus();
                                return false;
                            } catch (e) {
                            }
                        }
                    },
                    delegateType: 'focusin'
                },
                blur: {
                    trigger: function () {
                        if (this === safeActiveElement() && this.blur) {
                            this.blur();
                            return false;
                        }
                    },
                    delegateType: 'focusout'
                },
                click: {
                    // For checkbox, fire native event so checked state will be right
                    trigger: function () {
                        if (jQuery.nodeName(this, 'input') && this.type === 'checkbox' && this.click) {
                            this.click();
                            return false;
                        }
                    },
                    // For cross-browser consistency, don't fire native .click() on links
                    _default: function (event) {
                        return jQuery.nodeName(event.target, 'a');
                    }
                },
                beforeunload: {
                    postDispatch: function (event) {
                        // Support: Firefox 20+
                        // Firefox doesn't alert if the returnValue field is not set.
                        if (event.result !== undefined && event.originalEvent) {
                            event.originalEvent.returnValue = event.result;
                        }
                    }
                }
            },
            simulate: function (type, elem, event, bubble) {
                // Piggyback on a donor event to simulate a different one.
                // Fake originalEvent to avoid donor's stopPropagation, but if the
                // simulated event prevents default then we do the same on the donor.
                var e = jQuery.extend(new jQuery.Event(), event, {
                    type: type,
                    isSimulated: true,
                    originalEvent: {}
                });
                if (bubble) {
                    jQuery.event.trigger(e, null, elem);
                } else {
                    jQuery.event.dispatch.call(elem, e);
                }
                if (e.isDefaultPrevented()) {
                    event.preventDefault();
                }
            }
        };
        jQuery.removeEvent = document.removeEventListener ? function (elem, type, handle) {
            if (elem.removeEventListener) {
                elem.removeEventListener(type, handle, false);
            }
        } : function (elem, type, handle) {
            var name = 'on' + type;
            if (elem.detachEvent) {
                // #8545, #7054, preventing memory leaks for custom events in IE6-8
                // detachEvent needed property on element, by name of that event, to properly expose it to GC
                if (typeof elem[name] === strundefined) {
                    elem[name] = null;
                }
                elem.detachEvent(name, handle);
            }
        };
        jQuery.Event = function (src, props) {
            // Allow instantiation without the 'new' keyword
            if (!(this instanceof jQuery.Event)) {
                return new jQuery.Event(src, props);
            }
            // Event object
            if (src && src.type) {
                this.originalEvent = src;
                this.type = src.type;
                // Events bubbling up the document may have been marked as prevented
                // by a handler lower down the tree; reflect the correct value.
                this.isDefaultPrevented = src.defaultPrevented || src.defaultPrevented === undefined && // Support: IE < 9, Android < 4.0
                src.returnValue === false ? returnTrue : returnFalse;    // Event type
            } else {
                this.type = src;
            }
            // Put explicitly provided properties onto the event object
            if (props) {
                jQuery.extend(this, props);
            }
            // Create a timestamp if incoming event doesn't have one
            this.timeStamp = src && src.timeStamp || jQuery.now();
            // Mark it as fixed
            this[jQuery.expando] = true;
        };
        // jQuery.Event is based on DOM3 Events as specified by the ECMAScript Language Binding
        // http://www.w3.org/TR/2003/WD-DOM-Level-3-Events-20030331/ecma-script-binding.html
        jQuery.Event.prototype = {
            isDefaultPrevented: returnFalse,
            isPropagationStopped: returnFalse,
            isImmediatePropagationStopped: returnFalse,
            preventDefault: function () {
                var e = this.originalEvent;
                this.isDefaultPrevented = returnTrue;
                if (!e) {
                    return;
                }
                // If preventDefault exists, run it on the original event
                if (e.preventDefault) {
                    e.preventDefault();    // Support: IE
                                           // Otherwise set the returnValue property of the original event to false
                } else {
                    e.returnValue = false;
                }
            },
            stopPropagation: function () {
                var e = this.originalEvent;
                this.isPropagationStopped = returnTrue;
                if (!e) {
                    return;
                }
                // If stopPropagation exists, run it on the original event
                if (e.stopPropagation) {
                    e.stopPropagation();
                }
                // Support: IE
                // Set the cancelBubble property of the original event to true
                e.cancelBubble = true;
            },
            stopImmediatePropagation: function () {
                var e = this.originalEvent;
                this.isImmediatePropagationStopped = returnTrue;
                if (e && e.stopImmediatePropagation) {
                    e.stopImmediatePropagation();
                }
                this.stopPropagation();
            }
        };
        // Create mouseenter/leave events using mouseover/out and event-time checks
        jQuery.each({
            mouseenter: 'mouseover',
            mouseleave: 'mouseout',
            pointerenter: 'pointerover',
            pointerleave: 'pointerout'
        }, function (orig, fix) {
            jQuery.event.special[orig] = {
                delegateType: fix,
                bindType: fix,
                handle: function (event) {
                    var ret, target = this, related = event.relatedTarget, handleObj = event.handleObj;
                    // For mousenter/leave call the handler if related is outside the target.
                    // NB: No relatedTarget if the mouse left/entered the browser window
                    if (!related || related !== target && !jQuery.contains(target, related)) {
                        event.type = handleObj.origType;
                        ret = handleObj.handler.apply(this, arguments);
                        event.type = fix;
                    }
                    return ret;
                }
            };
        });
        // IE submit delegation
        if (!support.submitBubbles) {
            jQuery.event.special.submit = {
                setup: function () {
                    // Only need this for delegated form submit events
                    if (jQuery.nodeName(this, 'form')) {
                        return false;
                    }
                    // Lazy-add a submit handler when a descendant form may potentially be submitted
                    jQuery.event.add(this, 'click._submit keypress._submit', function (e) {
                        // Node name check avoids a VML-related crash in IE (#9807)
                        var elem = e.target, form = jQuery.nodeName(elem, 'input') || jQuery.nodeName(elem, 'button') ? elem.form : undefined;
                        if (form && !jQuery._data(form, 'submitBubbles')) {
                            jQuery.event.add(form, 'submit._submit', function (event) {
                                event._submit_bubble = true;
                            });
                            jQuery._data(form, 'submitBubbles', true);
                        }
                    });    // return undefined since we don't need an event listener
                },
                postDispatch: function (event) {
                    // If form was submitted by the user, bubble the event up the tree
                    if (event._submit_bubble) {
                        delete event._submit_bubble;
                        if (this.parentNode && !event.isTrigger) {
                            jQuery.event.simulate('submit', this.parentNode, event, true);
                        }
                    }
                },
                teardown: function () {
                    // Only need this for delegated form submit events
                    if (jQuery.nodeName(this, 'form')) {
                        return false;
                    }
                    // Remove delegated handlers; cleanData eventually reaps submit handlers attached above
                    jQuery.event.remove(this, '._submit');
                }
            };
        }
        // IE change delegation and checkbox/radio fix
        if (!support.changeBubbles) {
            jQuery.event.special.change = {
                setup: function () {
                    if (rformElems.test(this.nodeName)) {
                        // IE doesn't fire change on a check/radio until blur; trigger it on click
                        // after a propertychange. Eat the blur-change in special.change.handle.
                        // This still fires onchange a second time for check/radio after blur.
                        if (this.type === 'checkbox' || this.type === 'radio') {
                            jQuery.event.add(this, 'propertychange._change', function (event) {
                                if (event.originalEvent.propertyName === 'checked') {
                                    this._just_changed = true;
                                }
                            });
                            jQuery.event.add(this, 'click._change', function (event) {
                                if (this._just_changed && !event.isTrigger) {
                                    this._just_changed = false;
                                }
                                // Allow triggered, simulated change events (#11500)
                                jQuery.event.simulate('change', this, event, true);
                            });
                        }
                        return false;
                    }
                    // Delegated event; lazy-add a change handler on descendant inputs
                    jQuery.event.add(this, 'beforeactivate._change', function (e) {
                        var elem = e.target;
                        if (rformElems.test(elem.nodeName) && !jQuery._data(elem, 'changeBubbles')) {
                            jQuery.event.add(elem, 'change._change', function (event) {
                                if (this.parentNode && !event.isSimulated && !event.isTrigger) {
                                    jQuery.event.simulate('change', this.parentNode, event, true);
                                }
                            });
                            jQuery._data(elem, 'changeBubbles', true);
                        }
                    });
                },
                handle: function (event) {
                    var elem = event.target;
                    // Swallow native change events from checkbox/radio, we already triggered them above
                    if (this !== elem || event.isSimulated || event.isTrigger || elem.type !== 'radio' && elem.type !== 'checkbox') {
                        return event.handleObj.handler.apply(this, arguments);
                    }
                },
                teardown: function () {
                    jQuery.event.remove(this, '._change');
                    return !rformElems.test(this.nodeName);
                }
            };
        }
        // Create "bubbling" focus and blur events
        if (!support.focusinBubbles) {
            jQuery.each({
                focus: 'focusin',
                blur: 'focusout'
            }, function (orig, fix) {
                // Attach a single capturing handler on the document while someone wants focusin/focusout
                var handler = function (event) {
                    jQuery.event.simulate(fix, event.target, jQuery.event.fix(event), true);
                };
                jQuery.event.special[fix] = {
                    setup: function () {
                        var doc = this.ownerDocument || this, attaches = jQuery._data(doc, fix);
                        if (!attaches) {
                            doc.addEventListener(orig, handler, true);
                        }
                        jQuery._data(doc, fix, (attaches || 0) + 1);
                    },
                    teardown: function () {
                        var doc = this.ownerDocument || this, attaches = jQuery._data(doc, fix) - 1;
                        if (!attaches) {
                            doc.removeEventListener(orig, handler, true);
                            jQuery._removeData(doc, fix);
                        } else {
                            jQuery._data(doc, fix, attaches);
                        }
                    }
                };
            });
        }
        jQuery.fn.extend({
            on: function (types, selector, data, fn, one) {
                var type, origFn;
                // Types can be a map of types/handlers
                if (typeof types === 'object') {
                    // ( types-Object, selector, data )
                    if (typeof selector !== 'string') {
                        // ( types-Object, data )
                        data = data || selector;
                        selector = undefined;
                    }
                    for (type in types) {
                        this.on(type, selector, data, types[type], one);
                    }
                    return this;
                }
                if (data == null && fn == null) {
                    // ( types, fn )
                    fn = selector;
                    data = selector = undefined;
                } else if (fn == null) {
                    if (typeof selector === 'string') {
                        // ( types, selector, fn )
                        fn = data;
                        data = undefined;
                    } else {
                        // ( types, data, fn )
                        fn = data;
                        data = selector;
                        selector = undefined;
                    }
                }
                if (fn === false) {
                    fn = returnFalse;
                } else if (!fn) {
                    return this;
                }
                if (one === 1) {
                    origFn = fn;
                    fn = function (event) {
                        // Can use an empty set, since event contains the info
                        jQuery().off(event);
                        return origFn.apply(this, arguments);
                    };
                    // Use same guid so caller can remove using origFn
                    fn.guid = origFn.guid || (origFn.guid = jQuery.guid++);
                }
                return this.each(function () {
                    jQuery.event.add(this, types, fn, data, selector);
                });
            },
            one: function (types, selector, data, fn) {
                return this.on(types, selector, data, fn, 1);
            },
            off: function (types, selector, fn) {
                var handleObj, type;
                if (types && types.preventDefault && types.handleObj) {
                    // ( event )  dispatched jQuery.Event
                    handleObj = types.handleObj;
                    jQuery(types.delegateTarget).off(handleObj.namespace ? handleObj.origType + '.' + handleObj.namespace : handleObj.origType, handleObj.selector, handleObj.handler);
                    return this;
                }
                if (typeof types === 'object') {
                    // ( types-object [, selector] )
                    for (type in types) {
                        this.off(type, selector, types[type]);
                    }
                    return this;
                }
                if (selector === false || typeof selector === 'function') {
                    // ( types [, fn] )
                    fn = selector;
                    selector = undefined;
                }
                if (fn === false) {
                    fn = returnFalse;
                }
                return this.each(function () {
                    jQuery.event.remove(this, types, fn, selector);
                });
            },
            trigger: function (type, data) {
                return this.each(function () {
                    jQuery.event.trigger(type, data, this);
                });
            },
            triggerHandler: function (type, data) {
                var elem = this[0];
                if (elem) {
                    return jQuery.event.trigger(type, data, elem, true);
                }
            }
        });
        function createSafeFragment(document) {
            var list = nodeNames.split('|'), safeFrag = document.createDocumentFragment();
            if (safeFrag.createElement) {
                while (list.length) {
                    safeFrag.createElement(list.pop());
                }
            }
            return safeFrag;
        }
        var nodeNames = 'abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|' + 'header|hgroup|mark|meter|nav|output|progress|section|summary|time|video', rinlinejQuery = / jQuery\d+="(?:null|\d+)"/g, rnoshimcache = new RegExp('<(?:' + nodeNames + ')[\\s/>]', 'i'), rleadingWhitespace = /^\s+/, rxhtmlTag = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi, rtagName = /<([\w:]+)/, rtbody = /<tbody/i, rhtml = /<|&#?\w+;/, rnoInnerhtml = /<(?:script|style|link)/i,
            // checked="checked" or checked
            rchecked = /checked\s*(?:[^=]|=\s*.checked.)/i, rscriptType = /^$|\/(?:java|ecma)script/i, rscriptTypeMasked = /^true\/(.*)/, rcleanScript = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,
            // We have to close these tags to support XHTML (#13200)
            wrapMap = {
                option: [
                    1,
                    '<select multiple=\'multiple\'>',
                    '</select>'
                ],
                legend: [
                    1,
                    '<fieldset>',
                    '</fieldset>'
                ],
                area: [
                    1,
                    '<map>',
                    '</map>'
                ],
                param: [
                    1,
                    '<object>',
                    '</object>'
                ],
                thead: [
                    1,
                    '<table>',
                    '</table>'
                ],
                tr: [
                    2,
                    '<table><tbody>',
                    '</tbody></table>'
                ],
                col: [
                    2,
                    '<table><tbody></tbody><colgroup>',
                    '</colgroup></table>'
                ],
                td: [
                    3,
                    '<table><tbody><tr>',
                    '</tr></tbody></table>'
                ],
                // IE6-8 can't serialize link, script, style, or any html5 (NoScope) tags,
                // unless wrapped in a div with non-breaking characters in front of it.
                _default: support.htmlSerialize ? [
                    0,
                    '',
                    ''
                ] : [
                    1,
                    'X<div>',
                    '</div>'
                ]
            }, safeFragment = createSafeFragment(document), fragmentDiv = safeFragment.appendChild(document.createElement('div'));
        wrapMap.optgroup = wrapMap.option;
        wrapMap.tbody = wrapMap.tfoot = wrapMap.colgroup = wrapMap.caption = wrapMap.thead;
        wrapMap.th = wrapMap.td;
        function getAll(context, tag) {
            var elems, elem, i = 0, found = typeof context.getElementsByTagName !== strundefined ? context.getElementsByTagName(tag || '*') : typeof context.querySelectorAll !== strundefined ? context.querySelectorAll(tag || '*') : undefined;
            if (!found) {
                for (found = [], elems = context.childNodes || context; (elem = elems[i]) != null; i++) {
                    if (!tag || jQuery.nodeName(elem, tag)) {
                        found.push(elem);
                    } else {
                        jQuery.merge(found, getAll(elem, tag));
                    }
                }
            }
            return tag === undefined || tag && jQuery.nodeName(context, tag) ? jQuery.merge([context], found) : found;
        }
        // Used in buildFragment, fixes the defaultChecked property
        function fixDefaultChecked(elem) {
            if (rcheckableType.test(elem.type)) {
                elem.defaultChecked = elem.checked;
            }
        }
        // Support: IE<8
        // Manipulating tables requires a tbody
        function manipulationTarget(elem, content) {
            return jQuery.nodeName(elem, 'table') && jQuery.nodeName(content.nodeType !== 11 ? content : content.firstChild, 'tr') ? elem.getElementsByTagName('tbody')[0] || elem.appendChild(elem.ownerDocument.createElement('tbody')) : elem;
        }
        // Replace/restore the type attribute of script elements for safe DOM manipulation
        function disableScript(elem) {
            elem.type = (jQuery.find.attr(elem, 'type') !== null) + '/' + elem.type;
            return elem;
        }
        function restoreScript(elem) {
            var match = rscriptTypeMasked.exec(elem.type);
            if (match) {
                elem.type = match[1];
            } else {
                elem.removeAttribute('type');
            }
            return elem;
        }
        // Mark scripts as having already been evaluated
        function setGlobalEval(elems, refElements) {
            var elem, i = 0;
            for (; (elem = elems[i]) != null; i++) {
                jQuery._data(elem, 'globalEval', !refElements || jQuery._data(refElements[i], 'globalEval'));
            }
        }
        function cloneCopyEvent(src, dest) {
            if (dest.nodeType !== 1 || !jQuery.hasData(src)) {
                return;
            }
            var type, i, l, oldData = jQuery._data(src), curData = jQuery._data(dest, oldData), events = oldData.events;
            if (events) {
                delete curData.handle;
                curData.events = {};
                for (type in events) {
                    for (i = 0, l = events[type].length; i < l; i++) {
                        jQuery.event.add(dest, type, events[type][i]);
                    }
                }
            }
            // make the cloned public data object a copy from the original
            if (curData.data) {
                curData.data = jQuery.extend({}, curData.data);
            }
        }
        function fixCloneNodeIssues(src, dest) {
            var nodeName, e, data;
            // We do not need to do anything for non-Elements
            if (dest.nodeType !== 1) {
                return;
            }
            nodeName = dest.nodeName.toLowerCase();
            // IE6-8 copies events bound via attachEvent when using cloneNode.
            if (!support.noCloneEvent && dest[jQuery.expando]) {
                data = jQuery._data(dest);
                for (e in data.events) {
                    jQuery.removeEvent(dest, e, data.handle);
                }
                // Event data gets referenced instead of copied if the expando gets copied too
                dest.removeAttribute(jQuery.expando);
            }
            // IE blanks contents when cloning scripts, and tries to evaluate newly-set text
            if (nodeName === 'script' && dest.text !== src.text) {
                disableScript(dest).text = src.text;
                restoreScript(dest);    // IE6-10 improperly clones children of object elements using classid.
                                        // IE10 throws NoModificationAllowedError if parent is null, #12132.
            } else if (nodeName === 'object') {
                if (dest.parentNode) {
                    dest.outerHTML = src.outerHTML;
                }
                // This path appears unavoidable for IE9. When cloning an object
                // element in IE9, the outerHTML strategy above is not sufficient.
                // If the src has innerHTML and the destination does not,
                // copy the src.innerHTML into the dest.innerHTML. #10324
                if (support.html5Clone && (src.innerHTML && !jQuery.trim(dest.innerHTML))) {
                    dest.innerHTML = src.innerHTML;
                }
            } else if (nodeName === 'input' && rcheckableType.test(src.type)) {
                // IE6-8 fails to persist the checked state of a cloned checkbox
                // or radio button. Worse, IE6-7 fail to give the cloned element
                // a checked appearance if the defaultChecked value isn't also set
                dest.defaultChecked = dest.checked = src.checked;
                // IE6-7 get confused and end up setting the value of a cloned
                // checkbox/radio button to an empty string instead of "on"
                if (dest.value !== src.value) {
                    dest.value = src.value;
                }    // IE6-8 fails to return the selected option to the default selected
                     // state when cloning options
            } else if (nodeName === 'option') {
                dest.defaultSelected = dest.selected = src.defaultSelected;    // IE6-8 fails to set the defaultValue to the correct value when
                                                                               // cloning other types of input fields
            } else if (nodeName === 'input' || nodeName === 'textarea') {
                dest.defaultValue = src.defaultValue;
            }
        }
        jQuery.extend({
            clone: function (elem, dataAndEvents, deepDataAndEvents) {
                var destElements, node, clone, i, srcElements, inPage = jQuery.contains(elem.ownerDocument, elem);
                if (support.html5Clone || jQuery.isXMLDoc(elem) || !rnoshimcache.test('<' + elem.nodeName + '>')) {
                    clone = elem.cloneNode(true);    // IE<=8 does not properly clone detached, unknown element nodes
                } else {
                    fragmentDiv.innerHTML = elem.outerHTML;
                    fragmentDiv.removeChild(clone = fragmentDiv.firstChild);
                }
                if ((!support.noCloneEvent || !support.noCloneChecked) && (elem.nodeType === 1 || elem.nodeType === 11) && !jQuery.isXMLDoc(elem)) {
                    // We eschew Sizzle here for performance reasons: http://jsperf.com/getall-vs-sizzle/2
                    destElements = getAll(clone);
                    srcElements = getAll(elem);
                    // Fix all IE cloning issues
                    for (i = 0; (node = srcElements[i]) != null; ++i) {
                        // Ensure that the destination node is not null; Fixes #9587
                        if (destElements[i]) {
                            fixCloneNodeIssues(node, destElements[i]);
                        }
                    }
                }
                // Copy the events from the original to the clone
                if (dataAndEvents) {
                    if (deepDataAndEvents) {
                        srcElements = srcElements || getAll(elem);
                        destElements = destElements || getAll(clone);
                        for (i = 0; (node = srcElements[i]) != null; i++) {
                            cloneCopyEvent(node, destElements[i]);
                        }
                    } else {
                        cloneCopyEvent(elem, clone);
                    }
                }
                // Preserve script evaluation history
                destElements = getAll(clone, 'script');
                if (destElements.length > 0) {
                    setGlobalEval(destElements, !inPage && getAll(elem, 'script'));
                }
                destElements = srcElements = node = null;
                // Return the cloned set
                return clone;
            },
            buildFragment: function (elems, context, scripts, selection) {
                var j, elem, contains, tmp, tag, tbody, wrap, l = elems.length,
                    // Ensure a safe fragment
                    safe = createSafeFragment(context), nodes = [], i = 0;
                for (; i < l; i++) {
                    elem = elems[i];
                    if (elem || elem === 0) {
                        // Add nodes directly
                        if (jQuery.type(elem) === 'object') {
                            jQuery.merge(nodes, elem.nodeType ? [elem] : elem);    // Convert non-html into a text node
                        } else if (!rhtml.test(elem)) {
                            nodes.push(context.createTextNode(elem));    // Convert html into DOM nodes
                        } else {
                            tmp = tmp || safe.appendChild(context.createElement('div'));
                            // Deserialize a standard representation
                            tag = (rtagName.exec(elem) || [
                                '',
                                ''
                            ])[1].toLowerCase();
                            wrap = wrapMap[tag] || wrapMap._default;
                            tmp.innerHTML = wrap[1] + elem.replace(rxhtmlTag, '<$1></$2>') + wrap[2];
                            // Descend through wrappers to the right content
                            j = wrap[0];
                            while (j--) {
                                tmp = tmp.lastChild;
                            }
                            // Manually add leading whitespace removed by IE
                            if (!support.leadingWhitespace && rleadingWhitespace.test(elem)) {
                                nodes.push(context.createTextNode(rleadingWhitespace.exec(elem)[0]));
                            }
                            // Remove IE's autoinserted <tbody> from table fragments
                            if (!support.tbody) {
                                // String was a <table>, *may* have spurious <tbody>
                                elem = tag === 'table' && !rtbody.test(elem) ? tmp.firstChild : // String was a bare <thead> or <tfoot>
                                wrap[1] === '<table>' && !rtbody.test(elem) ? tmp : 0;
                                j = elem && elem.childNodes.length;
                                while (j--) {
                                    if (jQuery.nodeName(tbody = elem.childNodes[j], 'tbody') && !tbody.childNodes.length) {
                                        elem.removeChild(tbody);
                                    }
                                }
                            }
                            jQuery.merge(nodes, tmp.childNodes);
                            // Fix #12392 for WebKit and IE > 9
                            tmp.textContent = '';
                            // Fix #12392 for oldIE
                            while (tmp.firstChild) {
                                tmp.removeChild(tmp.firstChild);
                            }
                            // Remember the top-level container for proper cleanup
                            tmp = safe.lastChild;
                        }
                    }
                }
                // Fix #11356: Clear elements from fragment
                if (tmp) {
                    safe.removeChild(tmp);
                }
                // Reset defaultChecked for any radios and checkboxes
                // about to be appended to the DOM in IE 6/7 (#8060)
                if (!support.appendChecked) {
                    jQuery.grep(getAll(nodes, 'input'), fixDefaultChecked);
                }
                i = 0;
                while (elem = nodes[i++]) {
                    // #4087 - If origin and destination elements are the same, and this is
                    // that element, do not do anything
                    if (selection && jQuery.inArray(elem, selection) !== -1) {
                        continue;
                    }
                    contains = jQuery.contains(elem.ownerDocument, elem);
                    // Append to fragment
                    tmp = getAll(safe.appendChild(elem), 'script');
                    // Preserve script evaluation history
                    if (contains) {
                        setGlobalEval(tmp);
                    }
                    // Capture executables
                    if (scripts) {
                        j = 0;
                        while (elem = tmp[j++]) {
                            if (rscriptType.test(elem.type || '')) {
                                scripts.push(elem);
                            }
                        }
                    }
                }
                tmp = null;
                return safe;
            },
            cleanData: function (elems, acceptData) {
                var elem, type, id, data, i = 0, internalKey = jQuery.expando, cache = jQuery.cache, deleteExpando = support.deleteExpando, special = jQuery.event.special;
                for (; (elem = elems[i]) != null; i++) {
                    if (acceptData || jQuery.acceptData(elem)) {
                        id = elem[internalKey];
                        data = id && cache[id];
                        if (data) {
                            if (data.events) {
                                for (type in data.events) {
                                    if (special[type]) {
                                        jQuery.event.remove(elem, type);    // This is a shortcut to avoid jQuery.event.remove's overhead
                                    } else {
                                        jQuery.removeEvent(elem, type, data.handle);
                                    }
                                }
                            }
                            // Remove cache only if it was not already removed by jQuery.event.remove
                            if (cache[id]) {
                                delete cache[id];
                                // IE does not allow us to delete expando properties from nodes,
                                // nor does it have a removeAttribute function on Document nodes;
                                // we must handle all of these cases
                                if (deleteExpando) {
                                    delete elem[internalKey];
                                } else if (typeof elem.removeAttribute !== strundefined) {
                                    elem.removeAttribute(internalKey);
                                } else {
                                    elem[internalKey] = null;
                                }
                                deletedIds.push(id);
                            }
                        }
                    }
                }
            }
        });
        jQuery.fn.extend({
            text: function (value) {
                return access(this, function (value) {
                    return value === undefined ? jQuery.text(this) : this.empty().append((this[0] && this[0].ownerDocument || document).createTextNode(value));
                }, null, value, arguments.length);
            },
            append: function () {
                return this.domManip(arguments, function (elem) {
                    if (this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9) {
                        var target = manipulationTarget(this, elem);
                        target.appendChild(elem);
                    }
                });
            },
            prepend: function () {
                return this.domManip(arguments, function (elem) {
                    if (this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9) {
                        var target = manipulationTarget(this, elem);
                        target.insertBefore(elem, target.firstChild);
                    }
                });
            },
            before: function () {
                return this.domManip(arguments, function (elem) {
                    if (this.parentNode) {
                        this.parentNode.insertBefore(elem, this);
                    }
                });
            },
            after: function () {
                return this.domManip(arguments, function (elem) {
                    if (this.parentNode) {
                        this.parentNode.insertBefore(elem, this.nextSibling);
                    }
                });
            },
            remove: function (selector, keepData) {
                var elem, elems = selector ? jQuery.filter(selector, this) : this, i = 0;
                for (; (elem = elems[i]) != null; i++) {
                    if (!keepData && elem.nodeType === 1) {
                        jQuery.cleanData(getAll(elem));
                    }
                    if (elem.parentNode) {
                        if (keepData && jQuery.contains(elem.ownerDocument, elem)) {
                            setGlobalEval(getAll(elem, 'script'));
                        }
                        elem.parentNode.removeChild(elem);
                    }
                }
                return this;
            },
            empty: function () {
                var elem, i = 0;
                for (; (elem = this[i]) != null; i++) {
                    // Remove element nodes and prevent memory leaks
                    if (elem.nodeType === 1) {
                        jQuery.cleanData(getAll(elem, false));
                    }
                    // Remove any remaining nodes
                    while (elem.firstChild) {
                        elem.removeChild(elem.firstChild);
                    }
                    // If this is a select, ensure that it displays empty (#12336)
                    // Support: IE<9
                    if (elem.options && jQuery.nodeName(elem, 'select')) {
                        elem.options.length = 0;
                    }
                }
                return this;
            },
            clone: function (dataAndEvents, deepDataAndEvents) {
                dataAndEvents = dataAndEvents == null ? false : dataAndEvents;
                deepDataAndEvents = deepDataAndEvents == null ? dataAndEvents : deepDataAndEvents;
                return this.map(function () {
                    return jQuery.clone(this, dataAndEvents, deepDataAndEvents);
                });
            },
            html: function (value) {
                return access(this, function (value) {
                    var elem = this[0] || {}, i = 0, l = this.length;
                    if (value === undefined) {
                        return elem.nodeType === 1 ? elem.innerHTML.replace(rinlinejQuery, '') : undefined;
                    }
                    // See if we can take a shortcut and just use innerHTML
                    if (typeof value === 'string' && !rnoInnerhtml.test(value) && (support.htmlSerialize || !rnoshimcache.test(value)) && (support.leadingWhitespace || !rleadingWhitespace.test(value)) && !wrapMap[(rtagName.exec(value) || [
                            '',
                            ''
                        ])[1].toLowerCase()]) {
                        value = value.replace(rxhtmlTag, '<$1></$2>');
                        try {
                            for (; i < l; i++) {
                                // Remove element nodes and prevent memory leaks
                                elem = this[i] || {};
                                if (elem.nodeType === 1) {
                                    jQuery.cleanData(getAll(elem, false));
                                    elem.innerHTML = value;
                                }
                            }
                            elem = 0;    // If using innerHTML throws an exception, use the fallback method
                        } catch (e) {
                        }
                    }
                    if (elem) {
                        this.empty().append(value);
                    }
                }, null, value, arguments.length);
            },
            replaceWith: function () {
                var arg = arguments[0];
                // Make the changes, replacing each context element with the new content
                this.domManip(arguments, function (elem) {
                    arg = this.parentNode;
                    jQuery.cleanData(getAll(this));
                    if (arg) {
                        arg.replaceChild(elem, this);
                    }
                });
                // Force removal if there was no new content (e.g., from empty arguments)
                return arg && (arg.length || arg.nodeType) ? this : this.remove();
            },
            detach: function (selector) {
                return this.remove(selector, true);
            },
            domManip: function (args, callback) {
                // Flatten any nested arrays
                args = concat.apply([], args);
                var first, node, hasScripts, scripts, doc, fragment, i = 0, l = this.length, set = this, iNoClone = l - 1, value = args[0], isFunction = jQuery.isFunction(value);
                // We can't cloneNode fragments that contain checked, in WebKit
                if (isFunction || l > 1 && typeof value === 'string' && !support.checkClone && rchecked.test(value)) {
                    return this.each(function (index) {
                        var self = set.eq(index);
                        if (isFunction) {
                            args[0] = value.call(this, index, self.html());
                        }
                        self.domManip(args, callback);
                    });
                }
                if (l) {
                    fragment = jQuery.buildFragment(args, this[0].ownerDocument, false, this);
                    first = fragment.firstChild;
                    if (fragment.childNodes.length === 1) {
                        fragment = first;
                    }
                    if (first) {
                        scripts = jQuery.map(getAll(fragment, 'script'), disableScript);
                        hasScripts = scripts.length;
                        // Use the original fragment for the last item instead of the first because it can end up
                        // being emptied incorrectly in certain situations (#8070).
                        for (; i < l; i++) {
                            node = fragment;
                            if (i !== iNoClone) {
                                node = jQuery.clone(node, true, true);
                                // Keep references to cloned scripts for later restoration
                                if (hasScripts) {
                                    jQuery.merge(scripts, getAll(node, 'script'));
                                }
                            }
                            callback.call(this[i], node, i);
                        }
                        if (hasScripts) {
                            doc = scripts[scripts.length - 1].ownerDocument;
                            // Reenable scripts
                            jQuery.map(scripts, restoreScript);
                            // Evaluate executable scripts on first document insertion
                            for (i = 0; i < hasScripts; i++) {
                                node = scripts[i];
                                if (rscriptType.test(node.type || '') && !jQuery._data(node, 'globalEval') && jQuery.contains(doc, node)) {
                                    if (node.src) {
                                        // Optional AJAX dependency, but won't run scripts if not present
                                        if (jQuery._evalUrl) {
                                            jQuery._evalUrl(node.src);
                                        }
                                    } else {
                                        jQuery.globalEval((node.text || node.textContent || node.innerHTML || '').replace(rcleanScript, ''));
                                    }
                                }
                            }
                        }
                        // Fix #11809: Avoid leaking memory
                        fragment = first = null;
                    }
                }
                return this;
            }
        });
        jQuery.each({
            appendTo: 'append',
            prependTo: 'prepend',
            insertBefore: 'before',
            insertAfter: 'after',
            replaceAll: 'replaceWith'
        }, function (name, original) {
            jQuery.fn[name] = function (selector) {
                var elems, i = 0, ret = [], insert = jQuery(selector), last = insert.length - 1;
                for (; i <= last; i++) {
                    elems = i === last ? this : this.clone(true);
                    jQuery(insert[i])[original](elems);
                    // Modern browsers can apply jQuery collections as arrays, but oldIE needs a .get()
                    push.apply(ret, elems.get());
                }
                return this.pushStack(ret);
            };
        });
        var iframe, elemdisplay = {};
        /**
 * Retrieve the actual display of a element
 * @param {String} name nodeName of the element
 * @param {Object} doc Document object
 */
        // Called only from within defaultDisplay
        function actualDisplay(name, doc) {
            var style, elem = jQuery(doc.createElement(name)).appendTo(doc.body),
                // getDefaultComputedStyle might be reliably used only on attached element
                display = window.getDefaultComputedStyle && (style = window.getDefaultComputedStyle(elem[0])) ? // Use of this method is a temporary fix (more like optmization) until something better comes along,
                // since it was removed from specification and supported only in FF
                style.display : jQuery.css(elem[0], 'display');
            // We don't have any data stored on the element,
            // so use "detach" method as fast way to get rid of the element
            elem.detach();
            return display;
        }
        /**
 * Try to determine the default display value of an element
 * @param {String} nodeName
 */
        function defaultDisplay(nodeName) {
            var doc = document, display = elemdisplay[nodeName];
            if (!display) {
                display = actualDisplay(nodeName, doc);
                // If the simple way fails, read from inside an iframe
                if (display === 'none' || !display) {
                    // Use the already-created iframe if possible
                    iframe = (iframe || jQuery('<iframe frameborder=\'0\' width=\'0\' height=\'0\'/>')).appendTo(doc.documentElement);
                    // Always write a new HTML skeleton so Webkit and Firefox don't choke on reuse
                    doc = (iframe[0].contentWindow || iframe[0].contentDocument).document;
                    // Support: IE
                    doc.write();
                    doc.close();
                    display = actualDisplay(nodeName, doc);
                    iframe.detach();
                }
                // Store the correct default display
                elemdisplay[nodeName] = display;
            }
            return display;
        }
        (function () {
            var shrinkWrapBlocksVal;
            support.shrinkWrapBlocks = function () {
                if (shrinkWrapBlocksVal != null) {
                    return shrinkWrapBlocksVal;
                }
                // Will be changed later if needed.
                shrinkWrapBlocksVal = false;
                // Minified: var b,c,d
                var div, body, container;
                body = document.getElementsByTagName('body')[0];
                if (!body || !body.style) {
                    // Test fired too early or in an unsupported environment, exit.
                    return;
                }
                // Setup
                div = document.createElement('div');
                container = document.createElement('div');
                container.style.cssText = 'position:absolute;border:0;width:0;height:0;top:0;left:-9999px';
                body.appendChild(container).appendChild(div);
                // Support: IE6
                // Check if elements with layout shrink-wrap their children
                if (typeof div.style.zoom !== strundefined) {
                    // Reset CSS: box-sizing; display; margin; border
                    div.style.cssText = // Support: Firefox<29, Android 2.3
                    // Vendor-prefix box-sizing
                    '-webkit-box-sizing:content-box;-moz-box-sizing:content-box;' + 'box-sizing:content-box;display:block;margin:0;border:0;' + 'padding:1px;width:1px;zoom:1';
                    div.appendChild(document.createElement('div')).style.width = '5px';
                    shrinkWrapBlocksVal = div.offsetWidth !== 3;
                }
                body.removeChild(container);
                return shrinkWrapBlocksVal;
            };
        }());
        var rmargin = /^margin/;
        var rnumnonpx = new RegExp('^(' + pnum + ')(?!px)[a-z%]+$', 'i');
        var getStyles, curCSS, rposition = /^(top|right|bottom|left)$/;
        if (window.getComputedStyle) {
            getStyles = function (elem) {
                return elem.ownerDocument.defaultView.getComputedStyle(elem, null);
            };
            curCSS = function (elem, name, computed) {
                var width, minWidth, maxWidth, ret, style = elem.style;
                computed = computed || getStyles(elem);
                // getPropertyValue is only needed for .css('filter') in IE9, see #12537
                ret = computed ? computed.getPropertyValue(name) || computed[name] : undefined;
                if (computed) {
                    if (ret === '' && !jQuery.contains(elem.ownerDocument, elem)) {
                        ret = jQuery.style(elem, name);
                    }
                    // A tribute to the "awesome hack by Dean Edwards"
                    // Chrome < 17 and Safari 5.0 uses "computed value" instead of "used value" for margin-right
                    // Safari 5.1.7 (at least) returns percentage for a larger set of values, but width seems to be reliably pixels
                    // this is against the CSSOM draft spec: http://dev.w3.org/csswg/cssom/#resolved-values
                    if (rnumnonpx.test(ret) && rmargin.test(name)) {
                        // Remember the original values
                        width = style.width;
                        minWidth = style.minWidth;
                        maxWidth = style.maxWidth;
                        // Put in the new values to get a computed value out
                        style.minWidth = style.maxWidth = style.width = ret;
                        ret = computed.width;
                        // Revert the changed values
                        style.width = width;
                        style.minWidth = minWidth;
                        style.maxWidth = maxWidth;
                    }
                }
                // Support: IE
                // IE returns zIndex value as an integer.
                return ret === undefined ? ret : ret + '';
            };
        } else if (document.documentElement.currentStyle) {
            getStyles = function (elem) {
                return elem.currentStyle;
            };
            curCSS = function (elem, name, computed) {
                var left, rs, rsLeft, ret, style = elem.style;
                computed = computed || getStyles(elem);
                ret = computed ? computed[name] : undefined;
                // Avoid setting ret to empty string here
                // so we don't default to auto
                if (ret == null && style && style[name]) {
                    ret = style[name];
                }
                // From the awesome hack by Dean Edwards
                // http://erik.eae.net/archives/2007/07/27/18.54.15/#comment-102291
                // If we're not dealing with a regular pixel number
                // but a number that has a weird ending, we need to convert it to pixels
                // but not position css attributes, as those are proportional to the parent element instead
                // and we can't measure the parent instead because it might trigger a "stacking dolls" problem
                if (rnumnonpx.test(ret) && !rposition.test(name)) {
                    // Remember the original values
                    left = style.left;
                    rs = elem.runtimeStyle;
                    rsLeft = rs && rs.left;
                    // Put in the new values to get a computed value out
                    if (rsLeft) {
                        rs.left = elem.currentStyle.left;
                    }
                    style.left = name === 'fontSize' ? '1em' : ret;
                    ret = style.pixelLeft + 'px';
                    // Revert the changed values
                    style.left = left;
                    if (rsLeft) {
                        rs.left = rsLeft;
                    }
                }
                // Support: IE
                // IE returns zIndex value as an integer.
                return ret === undefined ? ret : ret + '' || 'auto';
            };
        }
        function addGetHookIf(conditionFn, hookFn) {
            // Define the hook, we'll check on the first run if it's really needed.
            return {
                get: function () {
                    var condition = conditionFn();
                    if (condition == null) {
                        // The test was not ready at this point; screw the hook this time
                        // but check again when needed next time.
                        return;
                    }
                    if (condition) {
                        // Hook not needed (or it's not possible to use it due to missing dependency),
                        // remove it.
                        // Since there are no other hooks for marginRight, remove the whole object.
                        delete this.get;
                        return;
                    }
                    // Hook needed; redefine it so that the support test is not executed again.
                    return (this.get = hookFn).apply(this, arguments);
                }
            };
        }
        (function () {
            // Minified: var b,c,d,e,f,g, h,i
            var div, style, a, pixelPositionVal, boxSizingReliableVal, reliableHiddenOffsetsVal, reliableMarginRightVal;
            // Setup
            div = document.createElement('div');
            div.innerHTML = '  <link/><table></table><a href=\'/a\'>a</a><input type=\'checkbox\'/>';
            a = div.getElementsByTagName('a')[0];
            style = a && a.style;
            // Finish early in limited (non-browser) environments
            if (!style) {
                return;
            }
            style.cssText = 'float:left;opacity:.5';
            // Support: IE<9
            // Make sure that element opacity exists (as opposed to filter)
            support.opacity = style.opacity === '0.5';
            // Verify style float existence
            // (IE uses styleFloat instead of cssFloat)
            support.cssFloat = !!style.cssFloat;
            div.style.backgroundClip = 'content-box';
            div.cloneNode(true).style.backgroundClip = '';
            support.clearCloneStyle = div.style.backgroundClip === 'content-box';
            // Support: Firefox<29, Android 2.3
            // Vendor-prefix box-sizing
            support.boxSizing = style.boxSizing === '' || style.MozBoxSizing === '' || style.WebkitBoxSizing === '';
            jQuery.extend(support, {
                reliableHiddenOffsets: function () {
                    if (reliableHiddenOffsetsVal == null) {
                        computeStyleTests();
                    }
                    return reliableHiddenOffsetsVal;
                },
                boxSizingReliable: function () {
                    if (boxSizingReliableVal == null) {
                        computeStyleTests();
                    }
                    return boxSizingReliableVal;
                },
                pixelPosition: function () {
                    if (pixelPositionVal == null) {
                        computeStyleTests();
                    }
                    return pixelPositionVal;
                },
                // Support: Android 2.3
                reliableMarginRight: function () {
                    if (reliableMarginRightVal == null) {
                        computeStyleTests();
                    }
                    return reliableMarginRightVal;
                }
            });
            function computeStyleTests() {
                // Minified: var b,c,d,j
                var div, body, container, contents;
                body = document.getElementsByTagName('body')[0];
                if (!body || !body.style) {
                    // Test fired too early or in an unsupported environment, exit.
                    return;
                }
                // Setup
                div = document.createElement('div');
                container = document.createElement('div');
                container.style.cssText = 'position:absolute;border:0;width:0;height:0;top:0;left:-9999px';
                body.appendChild(container).appendChild(div);
                div.style.cssText = // Support: Firefox<29, Android 2.3
                // Vendor-prefix box-sizing
                '-webkit-box-sizing:border-box;-moz-box-sizing:border-box;' + 'box-sizing:border-box;display:block;margin-top:1%;top:1%;' + 'border:1px;padding:1px;width:4px;position:absolute';
                // Support: IE<9
                // Assume reasonable values in the absence of getComputedStyle
                pixelPositionVal = boxSizingReliableVal = false;
                reliableMarginRightVal = true;
                // Check for getComputedStyle so that this code is not run in IE<9.
                if (window.getComputedStyle) {
                    pixelPositionVal = (window.getComputedStyle(div, null) || {}).top !== '1%';
                    boxSizingReliableVal = (window.getComputedStyle(div, null) || { width: '4px' }).width === '4px';
                    // Support: Android 2.3
                    // Div with explicit width and no margin-right incorrectly
                    // gets computed margin-right based on width of container (#3333)
                    // WebKit Bug 13343 - getComputedStyle returns wrong value for margin-right
                    contents = div.appendChild(document.createElement('div'));
                    // Reset CSS: box-sizing; display; margin; border; padding
                    contents.style.cssText = div.style.cssText = // Support: Firefox<29, Android 2.3
                    // Vendor-prefix box-sizing
                    '-webkit-box-sizing:content-box;-moz-box-sizing:content-box;' + 'box-sizing:content-box;display:block;margin:0;border:0;padding:0';
                    contents.style.marginRight = contents.style.width = '0';
                    div.style.width = '1px';
                    reliableMarginRightVal = !parseFloat((window.getComputedStyle(contents, null) || {}).marginRight);
                }
                // Support: IE8
                // Check if table cells still have offsetWidth/Height when they are set
                // to display:none and there are still other visible table cells in a
                // table row; if so, offsetWidth/Height are not reliable for use when
                // determining if an element has been hidden directly using
                // display:none (it is still safe to use offsets if a parent element is
                // hidden; don safety goggles and see bug #4512 for more information).
                div.innerHTML = '<table><tr><td></td><td>t</td></tr></table>';
                contents = div.getElementsByTagName('td');
                contents[0].style.cssText = 'margin:0;border:0;padding:0;display:none';
                reliableHiddenOffsetsVal = contents[0].offsetHeight === 0;
                if (reliableHiddenOffsetsVal) {
                    contents[0].style.display = '';
                    contents[1].style.display = 'none';
                    reliableHiddenOffsetsVal = contents[0].offsetHeight === 0;
                }
                body.removeChild(container);
            }
        }());
        // A method for quickly swapping in/out CSS properties to get correct calculations.
        jQuery.swap = function (elem, options, callback, args) {
            var ret, name, old = {};
            // Remember the old values, and insert the new ones
            for (name in options) {
                old[name] = elem.style[name];
                elem.style[name] = options[name];
            }
            ret = callback.apply(elem, args || []);
            // Revert the old values
            for (name in options) {
                elem.style[name] = old[name];
            }
            return ret;
        };
        var ralpha = /alpha\([^)]*\)/i, ropacity = /opacity\s*=\s*([^)]*)/,
            // swappable if display is none or starts with table except "table", "table-cell", or "table-caption"
            // see here for display values: https://developer.mozilla.org/en-US/docs/CSS/display
            rdisplayswap = /^(none|table(?!-c[ea]).+)/, rnumsplit = new RegExp('^(' + pnum + ')(.*)$', 'i'), rrelNum = new RegExp('^([+-])=(' + pnum + ')', 'i'), cssShow = {
                position: 'absolute',
                visibility: 'hidden',
                display: 'block'
            }, cssNormalTransform = {
                letterSpacing: '0',
                fontWeight: '400'
            }, cssPrefixes = [
                'Webkit',
                'O',
                'Moz',
                'ms'
            ];
        // return a css property mapped to a potentially vendor prefixed property
        function vendorPropName(style, name) {
            // shortcut for names that are not vendor prefixed
            if (name in style) {
                return name;
            }
            // check for vendor prefixed names
            var capName = name.charAt(0).toUpperCase() + name.slice(1), origName = name, i = cssPrefixes.length;
            while (i--) {
                name = cssPrefixes[i] + capName;
                if (name in style) {
                    return name;
                }
            }
            return origName;
        }
        function showHide(elements, show) {
            var display, elem, hidden, values = [], index = 0, length = elements.length;
            for (; index < length; index++) {
                elem = elements[index];
                if (!elem.style) {
                    continue;
                }
                values[index] = jQuery._data(elem, 'olddisplay');
                display = elem.style.display;
                if (show) {
                    // Reset the inline display of this element to learn if it is
                    // being hidden by cascaded rules or not
                    if (!values[index] && display === 'none') {
                        elem.style.display = '';
                    }
                    // Set elements which have been overridden with display: none
                    // in a stylesheet to whatever the default browser style is
                    // for such an element
                    if (elem.style.display === '' && isHidden(elem)) {
                        values[index] = jQuery._data(elem, 'olddisplay', defaultDisplay(elem.nodeName));
                    }
                } else {
                    hidden = isHidden(elem);
                    if (display && display !== 'none' || !hidden) {
                        jQuery._data(elem, 'olddisplay', hidden ? display : jQuery.css(elem, 'display'));
                    }
                }
            }
            // Set the display of most of the elements in a second loop
            // to avoid the constant reflow
            for (index = 0; index < length; index++) {
                elem = elements[index];
                if (!elem.style) {
                    continue;
                }
                if (!show || elem.style.display === 'none' || elem.style.display === '') {
                    elem.style.display = show ? values[index] || '' : 'none';
                }
            }
            return elements;
        }
        function setPositiveNumber(elem, value, subtract) {
            var matches = rnumsplit.exec(value);
            return matches ? // Guard against undefined "subtract", e.g., when used as in cssHooks
            Math.max(0, matches[1] - (subtract || 0)) + (matches[2] || 'px') : value;
        }
        function augmentWidthOrHeight(elem, name, extra, isBorderBox, styles) {
            var i = extra === (isBorderBox ? 'border' : 'content') ? // If we already have the right measurement, avoid augmentation
                4 : // Otherwise initialize for horizontal or vertical properties
                name === 'width' ? 1 : 0, val = 0;
            for (; i < 4; i += 2) {
                // both box models exclude margin, so add it if we want it
                if (extra === 'margin') {
                    val += jQuery.css(elem, extra + cssExpand[i], true, styles);
                }
                if (isBorderBox) {
                    // border-box includes padding, so remove it if we want content
                    if (extra === 'content') {
                        val -= jQuery.css(elem, 'padding' + cssExpand[i], true, styles);
                    }
                    // at this point, extra isn't border nor margin, so remove border
                    if (extra !== 'margin') {
                        val -= jQuery.css(elem, 'border' + cssExpand[i] + 'Width', true, styles);
                    }
                } else {
                    // at this point, extra isn't content, so add padding
                    val += jQuery.css(elem, 'padding' + cssExpand[i], true, styles);
                    // at this point, extra isn't content nor padding, so add border
                    if (extra !== 'padding') {
                        val += jQuery.css(elem, 'border' + cssExpand[i] + 'Width', true, styles);
                    }
                }
            }
            return val;
        }
        function getWidthOrHeight(elem, name, extra) {
            // Start with offset property, which is equivalent to the border-box value
            var valueIsBorderBox = true, val = name === 'width' ? elem.offsetWidth : elem.offsetHeight, styles = getStyles(elem), isBorderBox = support.boxSizing && jQuery.css(elem, 'boxSizing', false, styles) === 'border-box';
            // some non-html elements return undefined for offsetWidth, so check for null/undefined
            // svg - https://bugzilla.mozilla.org/show_bug.cgi?id=649285
            // MathML - https://bugzilla.mozilla.org/show_bug.cgi?id=491668
            if (val <= 0 || val == null) {
                // Fall back to computed then uncomputed css if necessary
                val = curCSS(elem, name, styles);
                if (val < 0 || val == null) {
                    val = elem.style[name];
                }
                // Computed unit is not pixels. Stop here and return.
                if (rnumnonpx.test(val)) {
                    return val;
                }
                // we need the check for style in case a browser which returns unreliable values
                // for getComputedStyle silently falls back to the reliable elem.style
                valueIsBorderBox = isBorderBox && (support.boxSizingReliable() || val === elem.style[name]);
                // Normalize "", auto, and prepare for extra
                val = parseFloat(val) || 0;
            }
            // use the active box-sizing model to add/subtract irrelevant styles
            return val + augmentWidthOrHeight(elem, name, extra || (isBorderBox ? 'border' : 'content'), valueIsBorderBox, styles) + 'px';
        }
        jQuery.extend({
            // Add in style property hooks for overriding the default
            // behavior of getting and setting a style property
            cssHooks: {
                opacity: {
                    get: function (elem, computed) {
                        if (computed) {
                            // We should always get a number back from opacity
                            var ret = curCSS(elem, 'opacity');
                            return ret === '' ? '1' : ret;
                        }
                    }
                }
            },
            // Don't automatically add "px" to these possibly-unitless properties
            cssNumber: {
                'columnCount': true,
                'fillOpacity': true,
                'flexGrow': true,
                'flexShrink': true,
                'fontWeight': true,
                'lineHeight': true,
                'opacity': true,
                'order': true,
                'orphans': true,
                'widows': true,
                'zIndex': true,
                'zoom': true
            },
            // Add in properties whose names you wish to fix before
            // setting or getting the value
            cssProps: {
                // normalize float css property
                'float': support.cssFloat ? 'cssFloat' : 'styleFloat'
            },
            // Get and set the style property on a DOM Node
            style: function (elem, name, value, extra) {
                // Don't set styles on text and comment nodes
                if (!elem || elem.nodeType === 3 || elem.nodeType === 8 || !elem.style) {
                    return;
                }
                // Make sure that we're working with the right name
                var ret, type, hooks, origName = jQuery.camelCase(name), style = elem.style;
                name = jQuery.cssProps[origName] || (jQuery.cssProps[origName] = vendorPropName(style, origName));
                // gets hook for the prefixed version
                // followed by the unprefixed version
                hooks = jQuery.cssHooks[name] || jQuery.cssHooks[origName];
                // Check if we're setting a value
                if (value !== undefined) {
                    type = typeof value;
                    // convert relative number strings (+= or -=) to relative numbers. #7345
                    if (type === 'string' && (ret = rrelNum.exec(value))) {
                        value = (ret[1] + 1) * ret[2] + parseFloat(jQuery.css(elem, name));
                        // Fixes bug #9237
                        type = 'number';
                    }
                    // Make sure that null and NaN values aren't set. See: #7116
                    if (value == null || value !== value) {
                        return;
                    }
                    // If a number was passed in, add 'px' to the (except for certain CSS properties)
                    if (type === 'number' && !jQuery.cssNumber[origName]) {
                        value += 'px';
                    }
                    // Fixes #8908, it can be done more correctly by specifing setters in cssHooks,
                    // but it would mean to define eight (for every problematic property) identical functions
                    if (!support.clearCloneStyle && value === '' && name.indexOf('background') === 0) {
                        style[name] = 'inherit';
                    }
                    // If a hook was provided, use that value, otherwise just set the specified value
                    if (!hooks || !('set' in hooks) || (value = hooks.set(elem, value, extra)) !== undefined) {
                        // Support: IE
                        // Swallow errors from 'invalid' CSS values (#5509)
                        try {
                            style[name] = value;
                        } catch (e) {
                        }
                    }
                } else {
                    // If a hook was provided get the non-computed value from there
                    if (hooks && 'get' in hooks && (ret = hooks.get(elem, false, extra)) !== undefined) {
                        return ret;
                    }
                    // Otherwise just get the value from the style object
                    return style[name];
                }
            },
            css: function (elem, name, extra, styles) {
                var num, val, hooks, origName = jQuery.camelCase(name);
                // Make sure that we're working with the right name
                name = jQuery.cssProps[origName] || (jQuery.cssProps[origName] = vendorPropName(elem.style, origName));
                // gets hook for the prefixed version
                // followed by the unprefixed version
                hooks = jQuery.cssHooks[name] || jQuery.cssHooks[origName];
                // If a hook was provided get the computed value from there
                if (hooks && 'get' in hooks) {
                    val = hooks.get(elem, true, extra);
                }
                // Otherwise, if a way to get the computed value exists, use that
                if (val === undefined) {
                    val = curCSS(elem, name, styles);
                }
                //convert "normal" to computed value
                if (val === 'normal' && name in cssNormalTransform) {
                    val = cssNormalTransform[name];
                }
                // Return, converting to number if forced or a qualifier was provided and val looks numeric
                if (extra === '' || extra) {
                    num = parseFloat(val);
                    return extra === true || jQuery.isNumeric(num) ? num || 0 : val;
                }
                return val;
            }
        });
        jQuery.each([
            'height',
            'width'
        ], function (i, name) {
            jQuery.cssHooks[name] = {
                get: function (elem, computed, extra) {
                    if (computed) {
                        // certain elements can have dimension info if we invisibly show them
                        // however, it must have a current display style that would benefit from this
                        return rdisplayswap.test(jQuery.css(elem, 'display')) && elem.offsetWidth === 0 ? jQuery.swap(elem, cssShow, function () {
                            return getWidthOrHeight(elem, name, extra);
                        }) : getWidthOrHeight(elem, name, extra);
                    }
                },
                set: function (elem, value, extra) {
                    var styles = extra && getStyles(elem);
                    return setPositiveNumber(elem, value, extra ? augmentWidthOrHeight(elem, name, extra, support.boxSizing && jQuery.css(elem, 'boxSizing', false, styles) === 'border-box', styles) : 0);
                }
            };
        });
        if (!support.opacity) {
            jQuery.cssHooks.opacity = {
                get: function (elem, computed) {
                    // IE uses filters for opacity
                    return ropacity.test((computed && elem.currentStyle ? elem.currentStyle.filter : elem.style.filter) || '') ? 0.01 * parseFloat(RegExp.$1) + '' : computed ? '1' : '';
                },
                set: function (elem, value) {
                    var style = elem.style, currentStyle = elem.currentStyle, opacity = jQuery.isNumeric(value) ? 'alpha(opacity=' + value * 100 + ')' : '', filter = currentStyle && currentStyle.filter || style.filter || '';
                    // IE has trouble with opacity if it does not have layout
                    // Force it by setting the zoom level
                    style.zoom = 1;
                    // if setting opacity to 1, and no other filters exist - attempt to remove filter attribute #6652
                    // if value === "", then remove inline opacity #12685
                    if ((value >= 1 || value === '') && jQuery.trim(filter.replace(ralpha, '')) === '' && style.removeAttribute) {
                        // Setting style.filter to null, "" & " " still leave "filter:" in the cssText
                        // if "filter:" is present at all, clearType is disabled, we want to avoid this
                        // style.removeAttribute is IE Only, but so apparently is this code path...
                        style.removeAttribute('filter');
                        // if there is no filter style applied in a css rule or unset inline opacity, we are done
                        if (value === '' || currentStyle && !currentStyle.filter) {
                            return;
                        }
                    }
                    // otherwise, set new filter values
                    style.filter = ralpha.test(filter) ? filter.replace(ralpha, opacity) : filter + ' ' + opacity;
                }
            };
        }
        jQuery.cssHooks.marginRight = addGetHookIf(support.reliableMarginRight, function (elem, computed) {
            if (computed) {
                // WebKit Bug 13343 - getComputedStyle returns wrong value for margin-right
                // Work around by temporarily setting element display to inline-block
                return jQuery.swap(elem, { 'display': 'inline-block' }, curCSS, [
                    elem,
                    'marginRight'
                ]);
            }
        });
        // These hooks are used by animate to expand properties
        jQuery.each({
            margin: '',
            padding: '',
            border: 'Width'
        }, function (prefix, suffix) {
            jQuery.cssHooks[prefix + suffix] = {
                expand: function (value) {
                    var i = 0, expanded = {},
                        // assumes a single number if not a string
                        parts = typeof value === 'string' ? value.split(' ') : [value];
                    for (; i < 4; i++) {
                        expanded[prefix + cssExpand[i] + suffix] = parts[i] || parts[i - 2] || parts[0];
                    }
                    return expanded;
                }
            };
            if (!rmargin.test(prefix)) {
                jQuery.cssHooks[prefix + suffix].set = setPositiveNumber;
            }
        });
        jQuery.fn.extend({
            css: function (name, value) {
                return access(this, function (elem, name, value) {
                    var styles, len, map = {}, i = 0;
                    if (jQuery.isArray(name)) {
                        styles = getStyles(elem);
                        len = name.length;
                        for (; i < len; i++) {
                            map[name[i]] = jQuery.css(elem, name[i], false, styles);
                        }
                        return map;
                    }
                    return value !== undefined ? jQuery.style(elem, name, value) : jQuery.css(elem, name);
                }, name, value, arguments.length > 1);
            },
            show: function () {
                return showHide(this, true);
            },
            hide: function () {
                return showHide(this);
            },
            toggle: function (state) {
                if (typeof state === 'boolean') {
                    return state ? this.show() : this.hide();
                }
                return this.each(function () {
                    if (isHidden(this)) {
                        jQuery(this).show();
                    } else {
                        jQuery(this).hide();
                    }
                });
            }
        });
        function Tween(elem, options, prop, end, easing) {
            return new Tween.prototype.init(elem, options, prop, end, easing);
        }
        jQuery.Tween = Tween;
        Tween.prototype = {
            constructor: Tween,
            init: function (elem, options, prop, end, easing, unit) {
                this.elem = elem;
                this.prop = prop;
                this.easing = easing || 'swing';
                this.options = options;
                this.start = this.now = this.cur();
                this.end = end;
                this.unit = unit || (jQuery.cssNumber[prop] ? '' : 'px');
            },
            cur: function () {
                var hooks = Tween.propHooks[this.prop];
                return hooks && hooks.get ? hooks.get(this) : Tween.propHooks._default.get(this);
            },
            run: function (percent) {
                var eased, hooks = Tween.propHooks[this.prop];
                if (this.options.duration) {
                    this.pos = eased = jQuery.easing[this.easing](percent, this.options.duration * percent, 0, 1, this.options.duration);
                } else {
                    this.pos = eased = percent;
                }
                this.now = (this.end - this.start) * eased + this.start;
                if (this.options.step) {
                    this.options.step.call(this.elem, this.now, this);
                }
                if (hooks && hooks.set) {
                    hooks.set(this);
                } else {
                    Tween.propHooks._default.set(this);
                }
                return this;
            }
        };
        Tween.prototype.init.prototype = Tween.prototype;
        Tween.propHooks = {
            _default: {
                get: function (tween) {
                    var result;
                    if (tween.elem[tween.prop] != null && (!tween.elem.style || tween.elem.style[tween.prop] == null)) {
                        return tween.elem[tween.prop];
                    }
                    // passing an empty string as a 3rd parameter to .css will automatically
                    // attempt a parseFloat and fallback to a string if the parse fails
                    // so, simple values such as "10px" are parsed to Float.
                    // complex values such as "rotate(1rad)" are returned as is.
                    result = jQuery.css(tween.elem, tween.prop, '');
                    // Empty strings, null, undefined and "auto" are converted to 0.
                    return !result || result === 'auto' ? 0 : result;
                },
                set: function (tween) {
                    // use step hook for back compat - use cssHook if its there - use .style if its
                    // available and use plain properties where available
                    if (jQuery.fx.step[tween.prop]) {
                        jQuery.fx.step[tween.prop](tween);
                    } else if (tween.elem.style && (tween.elem.style[jQuery.cssProps[tween.prop]] != null || jQuery.cssHooks[tween.prop])) {
                        jQuery.style(tween.elem, tween.prop, tween.now + tween.unit);
                    } else {
                        tween.elem[tween.prop] = tween.now;
                    }
                }
            }
        };
        // Support: IE <=9
        // Panic based approach to setting things on disconnected nodes
        Tween.propHooks.scrollTop = Tween.propHooks.scrollLeft = {
            set: function (tween) {
                if (tween.elem.nodeType && tween.elem.parentNode) {
                    tween.elem[tween.prop] = tween.now;
                }
            }
        };
        jQuery.easing = {
            linear: function (p) {
                return p;
            },
            swing: function (p) {
                return 0.5 - Math.cos(p * Math.PI) / 2;
            }
        };
        jQuery.fx = Tween.prototype.init;
        // Back Compat <1.8 extension point
        jQuery.fx.step = {};
        var fxNow, timerId, rfxtypes = /^(?:toggle|show|hide)$/, rfxnum = new RegExp('^(?:([+-])=|)(' + pnum + ')([a-z%]*)$', 'i'), rrun = /queueHooks$/, animationPrefilters = [defaultPrefilter], tweeners = {
                '*': [function (prop, value) {
                        var tween = this.createTween(prop, value), target = tween.cur(), parts = rfxnum.exec(value), unit = parts && parts[3] || (jQuery.cssNumber[prop] ? '' : 'px'),
                            // Starting value computation is required for potential unit mismatches
                            start = (jQuery.cssNumber[prop] || unit !== 'px' && +target) && rfxnum.exec(jQuery.css(tween.elem, prop)), scale = 1, maxIterations = 20;
                        if (start && start[3] !== unit) {
                            // Trust units reported by jQuery.css
                            unit = unit || start[3];
                            // Make sure we update the tween properties later on
                            parts = parts || [];
                            // Iteratively approximate from a nonzero starting point
                            start = +target || 1;
                            do {
                                // If previous iteration zeroed out, double until we get *something*
                                // Use a string for doubling factor so we don't accidentally see scale as unchanged below
                                scale = scale || '.5';
                                // Adjust and apply
                                start = start / scale;
                                jQuery.style(tween.elem, prop, start + unit);    // Update scale, tolerating zero or NaN from tween.cur()
                                                                                 // And breaking the loop if scale is unchanged or perfect, or if we've just had enough
                            } while (scale !== (scale = tween.cur() / target) && scale !== 1 && --maxIterations);
                        }
                        // Update tween properties
                        if (parts) {
                            start = tween.start = +start || +target || 0;
                            tween.unit = unit;
                            // If a +=/-= token was provided, we're doing a relative animation
                            tween.end = parts[1] ? start + (parts[1] + 1) * parts[2] : +parts[2];
                        }
                        return tween;
                    }]
            };
        // Animations created synchronously will run synchronously
        function createFxNow() {
            setTimeout(function () {
                fxNow = undefined;
            });
            return fxNow = jQuery.now();
        }
        // Generate parameters to create a standard animation
        function genFx(type, includeWidth) {
            var which, attrs = { height: type }, i = 0;
            // if we include width, step value is 1 to do all cssExpand values,
            // if we don't include width, step value is 2 to skip over Left and Right
            includeWidth = includeWidth ? 1 : 0;
            for (; i < 4; i += 2 - includeWidth) {
                which = cssExpand[i];
                attrs['margin' + which] = attrs['padding' + which] = type;
            }
            if (includeWidth) {
                attrs.opacity = attrs.width = type;
            }
            return attrs;
        }
        function createTween(value, prop, animation) {
            var tween, collection = (tweeners[prop] || []).concat(tweeners['*']), index = 0, length = collection.length;
            for (; index < length; index++) {
                if (tween = collection[index].call(animation, prop, value)) {
                    // we're done with this property
                    return tween;
                }
            }
        }
        function defaultPrefilter(elem, props, opts) {
            /* jshint validthis: true */
            var prop, value, toggle, tween, hooks, oldfire, display, checkDisplay, anim = this, orig = {}, style = elem.style, hidden = elem.nodeType && isHidden(elem), dataShow = jQuery._data(elem, 'fxshow');
            // handle queue: false promises
            if (!opts.queue) {
                hooks = jQuery._queueHooks(elem, 'fx');
                if (hooks.unqueued == null) {
                    hooks.unqueued = 0;
                    oldfire = hooks.empty.fire;
                    hooks.empty.fire = function () {
                        if (!hooks.unqueued) {
                            oldfire();
                        }
                    };
                }
                hooks.unqueued++;
                anim.always(function () {
                    // doing this makes sure that the complete handler will be called
                    // before this completes
                    anim.always(function () {
                        hooks.unqueued--;
                        if (!jQuery.queue(elem, 'fx').length) {
                            hooks.empty.fire();
                        }
                    });
                });
            }
            // height/width overflow pass
            if (elem.nodeType === 1 && ('height' in props || 'width' in props)) {
                // Make sure that nothing sneaks out
                // Record all 3 overflow attributes because IE does not
                // change the overflow attribute when overflowX and
                // overflowY are set to the same value
                opts.overflow = [
                    style.overflow,
                    style.overflowX,
                    style.overflowY
                ];
                // Set display property to inline-block for height/width
                // animations on inline elements that are having width/height animated
                display = jQuery.css(elem, 'display');
                // Test default display if display is currently "none"
                checkDisplay = display === 'none' ? jQuery._data(elem, 'olddisplay') || defaultDisplay(elem.nodeName) : display;
                if (checkDisplay === 'inline' && jQuery.css(elem, 'float') === 'none') {
                    // inline-level elements accept inline-block;
                    // block-level elements need to be inline with layout
                    if (!support.inlineBlockNeedsLayout || defaultDisplay(elem.nodeName) === 'inline') {
                        style.display = 'inline-block';
                    } else {
                        style.zoom = 1;
                    }
                }
            }
            if (opts.overflow) {
                style.overflow = 'hidden';
                if (!support.shrinkWrapBlocks()) {
                    anim.always(function () {
                        style.overflow = opts.overflow[0];
                        style.overflowX = opts.overflow[1];
                        style.overflowY = opts.overflow[2];
                    });
                }
            }
            // show/hide pass
            for (prop in props) {
                value = props[prop];
                if (rfxtypes.exec(value)) {
                    delete props[prop];
                    toggle = toggle || value === 'toggle';
                    if (value === (hidden ? 'hide' : 'show')) {
                        // If there is dataShow left over from a stopped hide or show and we are going to proceed with show, we should pretend to be hidden
                        if (value === 'show' && dataShow && dataShow[prop] !== undefined) {
                            hidden = true;
                        } else {
                            continue;
                        }
                    }
                    orig[prop] = dataShow && dataShow[prop] || jQuery.style(elem, prop);    // Any non-fx value stops us from restoring the original display value
                } else {
                    display = undefined;
                }
            }
            if (!jQuery.isEmptyObject(orig)) {
                if (dataShow) {
                    if ('hidden' in dataShow) {
                        hidden = dataShow.hidden;
                    }
                } else {
                    dataShow = jQuery._data(elem, 'fxshow', {});
                }
                // store state if its toggle - enables .stop().toggle() to "reverse"
                if (toggle) {
                    dataShow.hidden = !hidden;
                }
                if (hidden) {
                    jQuery(elem).show();
                } else {
                    anim.done(function () {
                        jQuery(elem).hide();
                    });
                }
                anim.done(function () {
                    var prop;
                    jQuery._removeData(elem, 'fxshow');
                    for (prop in orig) {
                        jQuery.style(elem, prop, orig[prop]);
                    }
                });
                for (prop in orig) {
                    tween = createTween(hidden ? dataShow[prop] : 0, prop, anim);
                    if (!(prop in dataShow)) {
                        dataShow[prop] = tween.start;
                        if (hidden) {
                            tween.end = tween.start;
                            tween.start = prop === 'width' || prop === 'height' ? 1 : 0;
                        }
                    }
                }    // If this is a noop like .hide().hide(), restore an overwritten display value
            } else if ((display === 'none' ? defaultDisplay(elem.nodeName) : display) === 'inline') {
                style.display = display;
            }
        }
        function propFilter(props, specialEasing) {
            var index, name, easing, value, hooks;
            // camelCase, specialEasing and expand cssHook pass
            for (index in props) {
                name = jQuery.camelCase(index);
                easing = specialEasing[name];
                value = props[index];
                if (jQuery.isArray(value)) {
                    easing = value[1];
                    value = props[index] = value[0];
                }
                if (index !== name) {
                    props[name] = value;
                    delete props[index];
                }
                hooks = jQuery.cssHooks[name];
                if (hooks && 'expand' in hooks) {
                    value = hooks.expand(value);
                    delete props[name];
                    // not quite $.extend, this wont overwrite keys already present.
                    // also - reusing 'index' from above because we have the correct "name"
                    for (index in value) {
                        if (!(index in props)) {
                            props[index] = value[index];
                            specialEasing[index] = easing;
                        }
                    }
                } else {
                    specialEasing[name] = easing;
                }
            }
        }
        function Animation(elem, properties, options) {
            var result, stopped, index = 0, length = animationPrefilters.length, deferred = jQuery.Deferred().always(function () {
                    // don't match elem in the :animated selector
                    delete tick.elem;
                }), tick = function () {
                    if (stopped) {
                        return false;
                    }
                    var currentTime = fxNow || createFxNow(), remaining = Math.max(0, animation.startTime + animation.duration - currentTime),
                        // archaic crash bug won't allow us to use 1 - ( 0.5 || 0 ) (#12497)
                        temp = remaining / animation.duration || 0, percent = 1 - temp, index = 0, length = animation.tweens.length;
                    for (; index < length; index++) {
                        animation.tweens[index].run(percent);
                    }
                    deferred.notifyWith(elem, [
                        animation,
                        percent,
                        remaining
                    ]);
                    if (percent < 1 && length) {
                        return remaining;
                    } else {
                        deferred.resolveWith(elem, [animation]);
                        return false;
                    }
                }, animation = deferred.promise({
                    elem: elem,
                    props: jQuery.extend({}, properties),
                    opts: jQuery.extend(true, { specialEasing: {} }, options),
                    originalProperties: properties,
                    originalOptions: options,
                    startTime: fxNow || createFxNow(),
                    duration: options.duration,
                    tweens: [],
                    createTween: function (prop, end) {
                        var tween = jQuery.Tween(elem, animation.opts, prop, end, animation.opts.specialEasing[prop] || animation.opts.easing);
                        animation.tweens.push(tween);
                        return tween;
                    },
                    stop: function (gotoEnd) {
                        var index = 0,
                            // if we are going to the end, we want to run all the tweens
                            // otherwise we skip this part
                            length = gotoEnd ? animation.tweens.length : 0;
                        if (stopped) {
                            return this;
                        }
                        stopped = true;
                        for (; index < length; index++) {
                            animation.tweens[index].run(1);
                        }
                        // resolve when we played the last frame
                        // otherwise, reject
                        if (gotoEnd) {
                            deferred.resolveWith(elem, [
                                animation,
                                gotoEnd
                            ]);
                        } else {
                            deferred.rejectWith(elem, [
                                animation,
                                gotoEnd
                            ]);
                        }
                        return this;
                    }
                }), props = animation.props;
            propFilter(props, animation.opts.specialEasing);
            for (; index < length; index++) {
                result = animationPrefilters[index].call(animation, elem, props, animation.opts);
                if (result) {
                    return result;
                }
            }
            jQuery.map(props, createTween, animation);
            if (jQuery.isFunction(animation.opts.start)) {
                animation.opts.start.call(elem, animation);
            }
            jQuery.fx.timer(jQuery.extend(tick, {
                elem: elem,
                anim: animation,
                queue: animation.opts.queue
            }));
            // attach callbacks from options
            return animation.progress(animation.opts.progress).done(animation.opts.done, animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always);
        }
        jQuery.Animation = jQuery.extend(Animation, {
            tweener: function (props, callback) {
                if (jQuery.isFunction(props)) {
                    callback = props;
                    props = ['*'];
                } else {
                    props = props.split(' ');
                }
                var prop, index = 0, length = props.length;
                for (; index < length; index++) {
                    prop = props[index];
                    tweeners[prop] = tweeners[prop] || [];
                    tweeners[prop].unshift(callback);
                }
            },
            prefilter: function (callback, prepend) {
                if (prepend) {
                    animationPrefilters.unshift(callback);
                } else {
                    animationPrefilters.push(callback);
                }
            }
        });
        jQuery.speed = function (speed, easing, fn) {
            var opt = speed && typeof speed === 'object' ? jQuery.extend({}, speed) : {
                complete: fn || !fn && easing || jQuery.isFunction(speed) && speed,
                duration: speed,
                easing: fn && easing || easing && !jQuery.isFunction(easing) && easing
            };
            opt.duration = jQuery.fx.off ? 0 : typeof opt.duration === 'number' ? opt.duration : opt.duration in jQuery.fx.speeds ? jQuery.fx.speeds[opt.duration] : jQuery.fx.speeds._default;
            // normalize opt.queue - true/undefined/null -> "fx"
            if (opt.queue == null || opt.queue === true) {
                opt.queue = 'fx';
            }
            // Queueing
            opt.old = opt.complete;
            opt.complete = function () {
                if (jQuery.isFunction(opt.old)) {
                    opt.old.call(this);
                }
                if (opt.queue) {
                    jQuery.dequeue(this, opt.queue);
                }
            };
            return opt;
        };
        jQuery.fn.extend({
            fadeTo: function (speed, to, easing, callback) {
                // show any hidden elements after setting opacity to 0
                return this.filter(isHidden).css('opacity', 0).show()    // animate to the value specified
.end().animate({ opacity: to }, speed, easing, callback);
            },
            animate: function (prop, speed, easing, callback) {
                var empty = jQuery.isEmptyObject(prop), optall = jQuery.speed(speed, easing, callback), doAnimation = function () {
                        // Operate on a copy of prop so per-property easing won't be lost
                        var anim = Animation(this, jQuery.extend({}, prop), optall);
                        // Empty animations, or finishing resolves immediately
                        if (empty || jQuery._data(this, 'finish')) {
                            anim.stop(true);
                        }
                    };
                doAnimation.finish = doAnimation;
                return empty || optall.queue === false ? this.each(doAnimation) : this.queue(optall.queue, doAnimation);
            },
            stop: function (type, clearQueue, gotoEnd) {
                var stopQueue = function (hooks) {
                    var stop = hooks.stop;
                    delete hooks.stop;
                    stop(gotoEnd);
                };
                if (typeof type !== 'string') {
                    gotoEnd = clearQueue;
                    clearQueue = type;
                    type = undefined;
                }
                if (clearQueue && type !== false) {
                    this.queue(type || 'fx', []);
                }
                return this.each(function () {
                    var dequeue = true, index = type != null && type + 'queueHooks', timers = jQuery.timers, data = jQuery._data(this);
                    if (index) {
                        if (data[index] && data[index].stop) {
                            stopQueue(data[index]);
                        }
                    } else {
                        for (index in data) {
                            if (data[index] && data[index].stop && rrun.test(index)) {
                                stopQueue(data[index]);
                            }
                        }
                    }
                    for (index = timers.length; index--;) {
                        if (timers[index].elem === this && (type == null || timers[index].queue === type)) {
                            timers[index].anim.stop(gotoEnd);
                            dequeue = false;
                            timers.splice(index, 1);
                        }
                    }
                    // start the next in the queue if the last step wasn't forced
                    // timers currently will call their complete callbacks, which will dequeue
                    // but only if they were gotoEnd
                    if (dequeue || !gotoEnd) {
                        jQuery.dequeue(this, type);
                    }
                });
            },
            finish: function (type) {
                if (type !== false) {
                    type = type || 'fx';
                }
                return this.each(function () {
                    var index, data = jQuery._data(this), queue = data[type + 'queue'], hooks = data[type + 'queueHooks'], timers = jQuery.timers, length = queue ? queue.length : 0;
                    // enable finishing flag on private data
                    data.finish = true;
                    // empty the queue first
                    jQuery.queue(this, type, []);
                    if (hooks && hooks.stop) {
                        hooks.stop.call(this, true);
                    }
                    // look for any active animations, and finish them
                    for (index = timers.length; index--;) {
                        if (timers[index].elem === this && timers[index].queue === type) {
                            timers[index].anim.stop(true);
                            timers.splice(index, 1);
                        }
                    }
                    // look for any animations in the old queue and finish them
                    for (index = 0; index < length; index++) {
                        if (queue[index] && queue[index].finish) {
                            queue[index].finish.call(this);
                        }
                    }
                    // turn off finishing flag
                    delete data.finish;
                });
            }
        });
        jQuery.each([
            'toggle',
            'show',
            'hide'
        ], function (i, name) {
            var cssFn = jQuery.fn[name];
            jQuery.fn[name] = function (speed, easing, callback) {
                return speed == null || typeof speed === 'boolean' ? cssFn.apply(this, arguments) : this.animate(genFx(name, true), speed, easing, callback);
            };
        });
        // Generate shortcuts for custom animations
        jQuery.each({
            slideDown: genFx('show'),
            slideUp: genFx('hide'),
            slideToggle: genFx('toggle'),
            fadeIn: { opacity: 'show' },
            fadeOut: { opacity: 'hide' },
            fadeToggle: { opacity: 'toggle' }
        }, function (name, props) {
            jQuery.fn[name] = function (speed, easing, callback) {
                return this.animate(props, speed, easing, callback);
            };
        });
        jQuery.timers = [];
        jQuery.fx.tick = function () {
            var timer, timers = jQuery.timers, i = 0;
            fxNow = jQuery.now();
            for (; i < timers.length; i++) {
                timer = timers[i];
                // Checks the timer has not already been removed
                if (!timer() && timers[i] === timer) {
                    timers.splice(i--, 1);
                }
            }
            if (!timers.length) {
                jQuery.fx.stop();
            }
            fxNow = undefined;
        };
        jQuery.fx.timer = function (timer) {
            jQuery.timers.push(timer);
            if (timer()) {
                jQuery.fx.start();
            } else {
                jQuery.timers.pop();
            }
        };
        jQuery.fx.interval = 13;
        jQuery.fx.start = function () {
            if (!timerId) {
                timerId = setInterval(jQuery.fx.tick, jQuery.fx.interval);
            }
        };
        jQuery.fx.stop = function () {
            clearInterval(timerId);
            timerId = null;
        };
        jQuery.fx.speeds = {
            slow: 600,
            fast: 200,
            // Default speed
            _default: 400
        };
        // Based off of the plugin by Clint Helfers, with permission.
        // http://blindsignals.com/index.php/2009/07/jquery-delay/
        jQuery.fn.delay = function (time, type) {
            time = jQuery.fx ? jQuery.fx.speeds[time] || time : time;
            type = type || 'fx';
            return this.queue(type, function (next, hooks) {
                var timeout = setTimeout(next, time);
                hooks.stop = function () {
                    clearTimeout(timeout);
                };
            });
        };
        (function () {
            // Minified: var a,b,c,d,e
            var input, div, select, a, opt;
            // Setup
            div = document.createElement('div');
            div.setAttribute('className', 't');
            div.innerHTML = '  <link/><table></table><a href=\'/a\'>a</a><input type=\'checkbox\'/>';
            a = div.getElementsByTagName('a')[0];
            // First batch of tests.
            select = document.createElement('select');
            opt = select.appendChild(document.createElement('option'));
            input = div.getElementsByTagName('input')[0];
            a.style.cssText = 'top:1px';
            // Test setAttribute on camelCase class. If it works, we need attrFixes when doing get/setAttribute (ie6/7)
            support.getSetAttribute = div.className !== 't';
            // Get the style information from getAttribute
            // (IE uses .cssText instead)
            support.style = /top/.test(a.getAttribute('style'));
            // Make sure that URLs aren't manipulated
            // (IE normalizes it by default)
            support.hrefNormalized = a.getAttribute('href') === '/a';
            // Check the default checkbox/radio value ("" on WebKit; "on" elsewhere)
            support.checkOn = !!input.value;
            // Make sure that a selected-by-default option has a working selected property.
            // (WebKit defaults to false instead of true, IE too, if it's in an optgroup)
            support.optSelected = opt.selected;
            // Tests for enctype support on a form (#6743)
            support.enctype = !!document.createElement('form').enctype;
            // Make sure that the options inside disabled selects aren't marked as disabled
            // (WebKit marks them as disabled)
            select.disabled = true;
            support.optDisabled = !opt.disabled;
            // Support: IE8 only
            // Check if we can trust getAttribute("value")
            input = document.createElement('input');
            input.setAttribute('value', '');
            support.input = input.getAttribute('value') === '';
            // Check if an input maintains its value after becoming a radio
            input.value = 't';
            input.setAttribute('type', 'radio');
            support.radioValue = input.value === 't';
        }());
        var rreturn = /\r/g;
        jQuery.fn.extend({
            val: function (value) {
                var hooks, ret, isFunction, elem = this[0];
                if (!arguments.length) {
                    if (elem) {
                        hooks = jQuery.valHooks[elem.type] || jQuery.valHooks[elem.nodeName.toLowerCase()];
                        if (hooks && 'get' in hooks && (ret = hooks.get(elem, 'value')) !== undefined) {
                            return ret;
                        }
                        ret = elem.value;
                        return typeof ret === 'string' ? // handle most common string cases
                        ret.replace(rreturn, '') : // handle cases where value is null/undef or number
                        ret == null ? '' : ret;
                    }
                    return;
                }
                isFunction = jQuery.isFunction(value);
                return this.each(function (i) {
                    var val;
                    if (this.nodeType !== 1) {
                        return;
                    }
                    if (isFunction) {
                        val = value.call(this, i, jQuery(this).val());
                    } else {
                        val = value;
                    }
                    // Treat null/undefined as ""; convert numbers to string
                    if (val == null) {
                        val = '';
                    } else if (typeof val === 'number') {
                        val += '';
                    } else if (jQuery.isArray(val)) {
                        val = jQuery.map(val, function (value) {
                            return value == null ? '' : value + '';
                        });
                    }
                    hooks = jQuery.valHooks[this.type] || jQuery.valHooks[this.nodeName.toLowerCase()];
                    // If set returns undefined, fall back to normal setting
                    if (!hooks || !('set' in hooks) || hooks.set(this, val, 'value') === undefined) {
                        this.value = val;
                    }
                });
            }
        });
        jQuery.extend({
            valHooks: {
                option: {
                    get: function (elem) {
                        var val = jQuery.find.attr(elem, 'value');
                        return val != null ? val : // Support: IE10-11+
                        // option.text throws exceptions (#14686, #14858)
                        jQuery.trim(jQuery.text(elem));
                    }
                },
                select: {
                    get: function (elem) {
                        var value, option, options = elem.options, index = elem.selectedIndex, one = elem.type === 'select-one' || index < 0, values = one ? null : [], max = one ? index + 1 : options.length, i = index < 0 ? max : one ? index : 0;
                        // Loop through all the selected options
                        for (; i < max; i++) {
                            option = options[i];
                            // oldIE doesn't update selected after form reset (#2551)
                            if ((option.selected || i === index) && // Don't return options that are disabled or in a disabled optgroup
                                (support.optDisabled ? !option.disabled : option.getAttribute('disabled') === null) && (!option.parentNode.disabled || !jQuery.nodeName(option.parentNode, 'optgroup'))) {
                                // Get the specific value for the option
                                value = jQuery(option).val();
                                // We don't need an array for one selects
                                if (one) {
                                    return value;
                                }
                                // Multi-Selects return an array
                                values.push(value);
                            }
                        }
                        return values;
                    },
                    set: function (elem, value) {
                        var optionSet, option, options = elem.options, values = jQuery.makeArray(value), i = options.length;
                        while (i--) {
                            option = options[i];
                            if (jQuery.inArray(jQuery.valHooks.option.get(option), values) >= 0) {
                                // Support: IE6
                                // When new option element is added to select box we need to
                                // force reflow of newly added node in order to workaround delay
                                // of initialization properties
                                try {
                                    option.selected = optionSet = true;
                                } catch (_) {
                                    // Will be executed only in IE6
                                    option.scrollHeight;
                                }
                            } else {
                                option.selected = false;
                            }
                        }
                        // Force browsers to behave consistently when non-matching value is set
                        if (!optionSet) {
                            elem.selectedIndex = -1;
                        }
                        return options;
                    }
                }
            }
        });
        // Radios and checkboxes getter/setter
        jQuery.each([
            'radio',
            'checkbox'
        ], function () {
            jQuery.valHooks[this] = {
                set: function (elem, value) {
                    if (jQuery.isArray(value)) {
                        return elem.checked = jQuery.inArray(jQuery(elem).val(), value) >= 0;
                    }
                }
            };
            if (!support.checkOn) {
                jQuery.valHooks[this].get = function (elem) {
                    // Support: Webkit
                    // "" is returned instead of "on" if a value isn't specified
                    return elem.getAttribute('value') === null ? 'on' : elem.value;
                };
            }
        });
        var nodeHook, boolHook, attrHandle = jQuery.expr.attrHandle, ruseDefault = /^(?:checked|selected)$/i, getSetAttribute = support.getSetAttribute, getSetInput = support.input;
        jQuery.fn.extend({
            attr: function (name, value) {
                return access(this, jQuery.attr, name, value, arguments.length > 1);
            },
            removeAttr: function (name) {
                return this.each(function () {
                    jQuery.removeAttr(this, name);
                });
            }
        });
        jQuery.extend({
            attr: function (elem, name, value) {
                var hooks, ret, nType = elem.nodeType;
                // don't get/set attributes on text, comment and attribute nodes
                if (!elem || nType === 3 || nType === 8 || nType === 2) {
                    return;
                }
                // Fallback to prop when attributes are not supported
                if (typeof elem.getAttribute === strundefined) {
                    return jQuery.prop(elem, name, value);
                }
                // All attributes are lowercase
                // Grab necessary hook if one is defined
                if (nType !== 1 || !jQuery.isXMLDoc(elem)) {
                    name = name.toLowerCase();
                    hooks = jQuery.attrHooks[name] || (jQuery.expr.match.bool.test(name) ? boolHook : nodeHook);
                }
                if (value !== undefined) {
                    if (value === null) {
                        jQuery.removeAttr(elem, name);
                    } else if (hooks && 'set' in hooks && (ret = hooks.set(elem, value, name)) !== undefined) {
                        return ret;
                    } else {
                        elem.setAttribute(name, value + '');
                        return value;
                    }
                } else if (hooks && 'get' in hooks && (ret = hooks.get(elem, name)) !== null) {
                    return ret;
                } else {
                    ret = jQuery.find.attr(elem, name);
                    // Non-existent attributes return null, we normalize to undefined
                    return ret == null ? undefined : ret;
                }
            },
            removeAttr: function (elem, value) {
                var name, propName, i = 0, attrNames = value && value.match(rnotwhite);
                if (attrNames && elem.nodeType === 1) {
                    while (name = attrNames[i++]) {
                        propName = jQuery.propFix[name] || name;
                        // Boolean attributes get special treatment (#10870)
                        if (jQuery.expr.match.bool.test(name)) {
                            // Set corresponding property to false
                            if (getSetInput && getSetAttribute || !ruseDefault.test(name)) {
                                elem[propName] = false;    // Support: IE<9
                                                           // Also clear defaultChecked/defaultSelected (if appropriate)
                            } else {
                                elem[jQuery.camelCase('default-' + name)] = elem[propName] = false;
                            }    // See #9699 for explanation of this approach (setting first, then removal)
                        } else {
                            jQuery.attr(elem, name, '');
                        }
                        elem.removeAttribute(getSetAttribute ? name : propName);
                    }
                }
            },
            attrHooks: {
                type: {
                    set: function (elem, value) {
                        if (!support.radioValue && value === 'radio' && jQuery.nodeName(elem, 'input')) {
                            // Setting the type on a radio button after the value resets the value in IE6-9
                            // Reset value to default in case type is set after value during creation
                            var val = elem.value;
                            elem.setAttribute('type', value);
                            if (val) {
                                elem.value = val;
                            }
                            return value;
                        }
                    }
                }
            }
        });
        // Hook for boolean attributes
        boolHook = {
            set: function (elem, value, name) {
                if (value === false) {
                    // Remove boolean attributes when set to false
                    jQuery.removeAttr(elem, name);
                } else if (getSetInput && getSetAttribute || !ruseDefault.test(name)) {
                    // IE<8 needs the *property* name
                    elem.setAttribute(!getSetAttribute && jQuery.propFix[name] || name, name);    // Use defaultChecked and defaultSelected for oldIE
                } else {
                    elem[jQuery.camelCase('default-' + name)] = elem[name] = true;
                }
                return name;
            }
        };
        // Retrieve booleans specially
        jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g), function (i, name) {
            var getter = attrHandle[name] || jQuery.find.attr;
            attrHandle[name] = getSetInput && getSetAttribute || !ruseDefault.test(name) ? function (elem, name, isXML) {
                var ret, handle;
                if (!isXML) {
                    // Avoid an infinite loop by temporarily removing this function from the getter
                    handle = attrHandle[name];
                    attrHandle[name] = ret;
                    ret = getter(elem, name, isXML) != null ? name.toLowerCase() : null;
                    attrHandle[name] = handle;
                }
                return ret;
            } : function (elem, name, isXML) {
                if (!isXML) {
                    return elem[jQuery.camelCase('default-' + name)] ? name.toLowerCase() : null;
                }
            };
        });
        // fix oldIE attroperties
        if (!getSetInput || !getSetAttribute) {
            jQuery.attrHooks.value = {
                set: function (elem, value, name) {
                    if (jQuery.nodeName(elem, 'input')) {
                        // Does not return so that setAttribute is also used
                        elem.defaultValue = value;
                    } else {
                        // Use nodeHook if defined (#1954); otherwise setAttribute is fine
                        return nodeHook && nodeHook.set(elem, value, name);
                    }
                }
            };
        }
        // IE6/7 do not support getting/setting some attributes with get/setAttribute
        if (!getSetAttribute) {
            // Use this for any attribute in IE6/7
            // This fixes almost every IE6/7 issue
            nodeHook = {
                set: function (elem, value, name) {
                    // Set the existing or create a new attribute node
                    var ret = elem.getAttributeNode(name);
                    if (!ret) {
                        elem.setAttributeNode(ret = elem.ownerDocument.createAttribute(name));
                    }
                    ret.value = value += '';
                    // Break association with cloned elements by also using setAttribute (#9646)
                    if (name === 'value' || value === elem.getAttribute(name)) {
                        return value;
                    }
                }
            };
            // Some attributes are constructed with empty-string values when not defined
            attrHandle.id = attrHandle.name = attrHandle.coords = function (elem, name, isXML) {
                var ret;
                if (!isXML) {
                    return (ret = elem.getAttributeNode(name)) && ret.value !== '' ? ret.value : null;
                }
            };
            // Fixing value retrieval on a button requires this module
            jQuery.valHooks.button = {
                get: function (elem, name) {
                    var ret = elem.getAttributeNode(name);
                    if (ret && ret.specified) {
                        return ret.value;
                    }
                },
                set: nodeHook.set
            };
            // Set contenteditable to false on removals(#10429)
            // Setting to empty string throws an error as an invalid value
            jQuery.attrHooks.contenteditable = {
                set: function (elem, value, name) {
                    nodeHook.set(elem, value === '' ? false : value, name);
                }
            };
            // Set width and height to auto instead of 0 on empty string( Bug #8150 )
            // This is for removals
            jQuery.each([
                'width',
                'height'
            ], function (i, name) {
                jQuery.attrHooks[name] = {
                    set: function (elem, value) {
                        if (value === '') {
                            elem.setAttribute(name, 'auto');
                            return value;
                        }
                    }
                };
            });
        }
        if (!support.style) {
            jQuery.attrHooks.style = {
                get: function (elem) {
                    // Return undefined in the case of empty string
                    // Note: IE uppercases css property names, but if we were to .toLowerCase()
                    // .cssText, that would destroy case senstitivity in URL's, like in "background"
                    return elem.style.cssText || undefined;
                },
                set: function (elem, value) {
                    return elem.style.cssText = value + '';
                }
            };
        }
        var rfocusable = /^(?:input|select|textarea|button|object)$/i, rclickable = /^(?:a|area)$/i;
        jQuery.fn.extend({
            prop: function (name, value) {
                return access(this, jQuery.prop, name, value, arguments.length > 1);
            },
            removeProp: function (name) {
                name = jQuery.propFix[name] || name;
                return this.each(function () {
                    // try/catch handles cases where IE balks (such as removing a property on window)
                    try {
                        this[name] = undefined;
                        delete this[name];
                    } catch (e) {
                    }
                });
            }
        });
        jQuery.extend({
            propFix: {
                'for': 'htmlFor',
                'class': 'className'
            },
            prop: function (elem, name, value) {
                var ret, hooks, notxml, nType = elem.nodeType;
                // don't get/set properties on text, comment and attribute nodes
                if (!elem || nType === 3 || nType === 8 || nType === 2) {
                    return;
                }
                notxml = nType !== 1 || !jQuery.isXMLDoc(elem);
                if (notxml) {
                    // Fix name and attach hooks
                    name = jQuery.propFix[name] || name;
                    hooks = jQuery.propHooks[name];
                }
                if (value !== undefined) {
                    return hooks && 'set' in hooks && (ret = hooks.set(elem, value, name)) !== undefined ? ret : elem[name] = value;
                } else {
                    return hooks && 'get' in hooks && (ret = hooks.get(elem, name)) !== null ? ret : elem[name];
                }
            },
            propHooks: {
                tabIndex: {
                    get: function (elem) {
                        // elem.tabIndex doesn't always return the correct value when it hasn't been explicitly set
                        // http://fluidproject.org/blog/2008/01/09/getting-setting-and-removing-tabindex-values-with-javascript/
                        // Use proper attribute retrieval(#12072)
                        var tabindex = jQuery.find.attr(elem, 'tabindex');
                        return tabindex ? parseInt(tabindex, 10) : rfocusable.test(elem.nodeName) || rclickable.test(elem.nodeName) && elem.href ? 0 : -1;
                    }
                }
            }
        });
        // Some attributes require a special call on IE
        // http://msdn.microsoft.com/en-us/library/ms536429%28VS.85%29.aspx
        if (!support.hrefNormalized) {
            // href/src property should get the full normalized URL (#10299/#12915)
            jQuery.each([
                'href',
                'src'
            ], function (i, name) {
                jQuery.propHooks[name] = {
                    get: function (elem) {
                        return elem.getAttribute(name, 4);
                    }
                };
            });
        }
        // Support: Safari, IE9+
        // mis-reports the default selected property of an option
        // Accessing the parent's selectedIndex property fixes it
        if (!support.optSelected) {
            jQuery.propHooks.selected = {
                get: function (elem) {
                    var parent = elem.parentNode;
                    if (parent) {
                        parent.selectedIndex;
                        // Make sure that it also works with optgroups, see #5701
                        if (parent.parentNode) {
                            parent.parentNode.selectedIndex;
                        }
                    }
                    return null;
                }
            };
        }
        jQuery.each([
            'tabIndex',
            'readOnly',
            'maxLength',
            'cellSpacing',
            'cellPadding',
            'rowSpan',
            'colSpan',
            'useMap',
            'frameBorder',
            'contentEditable'
        ], function () {
            jQuery.propFix[this.toLowerCase()] = this;
        });
        // IE6/7 call enctype encoding
        if (!support.enctype) {
            jQuery.propFix.enctype = 'encoding';
        }
        var rclass = /[\t\r\n\f]/g;
        jQuery.fn.extend({
            addClass: function (value) {
                var classes, elem, cur, clazz, j, finalValue, i = 0, len = this.length, proceed = typeof value === 'string' && value;
                if (jQuery.isFunction(value)) {
                    return this.each(function (j) {
                        jQuery(this).addClass(value.call(this, j, this.className));
                    });
                }
                if (proceed) {
                    // The disjunction here is for better compressibility (see removeClass)
                    classes = (value || '').match(rnotwhite) || [];
                    for (; i < len; i++) {
                        elem = this[i];
                        cur = elem.nodeType === 1 && (elem.className ? (' ' + elem.className + ' ').replace(rclass, ' ') : ' ');
                        if (cur) {
                            j = 0;
                            while (clazz = classes[j++]) {
                                if (cur.indexOf(' ' + clazz + ' ') < 0) {
                                    cur += clazz + ' ';
                                }
                            }
                            // only assign if different to avoid unneeded rendering.
                            finalValue = jQuery.trim(cur);
                            if (elem.className !== finalValue) {
                                elem.className = finalValue;
                            }
                        }
                    }
                }
                return this;
            },
            removeClass: function (value) {
                var classes, elem, cur, clazz, j, finalValue, i = 0, len = this.length, proceed = arguments.length === 0 || typeof value === 'string' && value;
                if (jQuery.isFunction(value)) {
                    return this.each(function (j) {
                        jQuery(this).removeClass(value.call(this, j, this.className));
                    });
                }
                if (proceed) {
                    classes = (value || '').match(rnotwhite) || [];
                    for (; i < len; i++) {
                        elem = this[i];
                        // This expression is here for better compressibility (see addClass)
                        cur = elem.nodeType === 1 && (elem.className ? (' ' + elem.className + ' ').replace(rclass, ' ') : '');
                        if (cur) {
                            j = 0;
                            while (clazz = classes[j++]) {
                                // Remove *all* instances
                                while (cur.indexOf(' ' + clazz + ' ') >= 0) {
                                    cur = cur.replace(' ' + clazz + ' ', ' ');
                                }
                            }
                            // only assign if different to avoid unneeded rendering.
                            finalValue = value ? jQuery.trim(cur) : '';
                            if (elem.className !== finalValue) {
                                elem.className = finalValue;
                            }
                        }
                    }
                }
                return this;
            },
            toggleClass: function (value, stateVal) {
                var type = typeof value;
                if (typeof stateVal === 'boolean' && type === 'string') {
                    return stateVal ? this.addClass(value) : this.removeClass(value);
                }
                if (jQuery.isFunction(value)) {
                    return this.each(function (i) {
                        jQuery(this).toggleClass(value.call(this, i, this.className, stateVal), stateVal);
                    });
                }
                return this.each(function () {
                    if (type === 'string') {
                        // toggle individual class names
                        var className, i = 0, self = jQuery(this), classNames = value.match(rnotwhite) || [];
                        while (className = classNames[i++]) {
                            // check each className given, space separated list
                            if (self.hasClass(className)) {
                                self.removeClass(className);
                            } else {
                                self.addClass(className);
                            }
                        }    // Toggle whole class name
                    } else if (type === strundefined || type === 'boolean') {
                        if (this.className) {
                            // store className if set
                            jQuery._data(this, '__className__', this.className);
                        }
                        // If the element has a class name or if we're passed "false",
                        // then remove the whole classname (if there was one, the above saved it).
                        // Otherwise bring back whatever was previously saved (if anything),
                        // falling back to the empty string if nothing was stored.
                        this.className = this.className || value === false ? '' : jQuery._data(this, '__className__') || '';
                    }
                });
            },
            hasClass: function (selector) {
                var className = ' ' + selector + ' ', i = 0, l = this.length;
                for (; i < l; i++) {
                    if (this[i].nodeType === 1 && (' ' + this[i].className + ' ').replace(rclass, ' ').indexOf(className) >= 0) {
                        return true;
                    }
                }
                return false;
            }
        });
        // Return jQuery for attributes-only inclusion
        jQuery.each(('blur focus focusin focusout load resize scroll unload click dblclick ' + 'mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave ' + 'change select submit keydown keypress keyup error contextmenu').split(' '), function (i, name) {
            // Handle event binding
            jQuery.fn[name] = function (data, fn) {
                return arguments.length > 0 ? this.on(name, null, data, fn) : this.trigger(name);
            };
        });
        jQuery.fn.extend({
            hover: function (fnOver, fnOut) {
                return this.mouseenter(fnOver).mouseleave(fnOut || fnOver);
            },
            bind: function (types, data, fn) {
                return this.on(types, null, data, fn);
            },
            unbind: function (types, fn) {
                return this.off(types, null, fn);
            },
            delegate: function (selector, types, data, fn) {
                return this.on(types, selector, data, fn);
            },
            undelegate: function (selector, types, fn) {
                // ( namespace ) or ( selector, types [, fn] )
                return arguments.length === 1 ? this.off(selector, '**') : this.off(types, selector || '**', fn);
            }
        });
        var nonce = jQuery.now();
        var rquery = /\?/;
        var rvalidtokens = /(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;
        jQuery.parseJSON = function (data) {
            // Attempt to parse using the native JSON parser first
            if (window.JSON && window.JSON.parse) {
                // Support: Android 2.3
                // Workaround failure to string-cast null input
                return window.JSON.parse(data + '');
            }
            var requireNonComma, depth = null, str = jQuery.trim(data + '');
            // Guard against invalid (and possibly dangerous) input by ensuring that nothing remains
            // after removing valid tokens
            return str && !jQuery.trim(str.replace(rvalidtokens, function (token, comma, open, close) {
                // Force termination if we see a misplaced comma
                if (requireNonComma && comma) {
                    depth = 0;
                }
                // Perform no more replacements after returning to outermost depth
                if (depth === 0) {
                    return token;
                }
                // Commas must not follow "[", "{", or ","
                requireNonComma = open || comma;
                // Determine new depth
                // array/object open ("[" or "{"): depth += true - false (increment)
                // array/object close ("]" or "}"): depth += false - true (decrement)
                // other cases ("," or primitive): depth += true - true (numeric cast)
                depth += !close - !open;
                // Remove this token
                return '';
            })) ? Function('return ' + str)() : jQuery.error('Invalid JSON: ' + data);
        };
        // Cross-browser xml parsing
        jQuery.parseXML = function (data) {
            var xml, tmp;
            if (!data || typeof data !== 'string') {
                return null;
            }
            try {
                if (window.DOMParser) {
                    // Standard
                    tmp = new DOMParser();
                    xml = tmp.parseFromString(data, 'text/xml');
                } else {
                    // IE
                    xml = new ActiveXObject('Microsoft.XMLDOM');
                    xml.async = 'false';
                    xml.loadXML(data);
                }
            } catch (e) {
                xml = undefined;
            }
            if (!xml || !xml.documentElement || xml.getElementsByTagName('parsererror').length) {
                jQuery.error('Invalid XML: ' + data);
            }
            return xml;
        };
        var
            // Document location
            ajaxLocParts, ajaxLocation, rhash = /#.*$/, rts = /([?&])_=[^&]*/, rheaders = /^(.*?):[ \t]*([^\r\n]*)\r?$/gm,
            // IE leaves an \r character at EOL
            // #7653, #8125, #8152: local protocol detection
            rlocalProtocol = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/, rnoContent = /^(?:GET|HEAD)$/, rprotocol = /^\/\//, rurl = /^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,
            /* Prefilters
	 * 1) They are useful to introduce custom dataTypes (see ajax/jsonp.js for an example)
	 * 2) These are called:
	 *    - BEFORE asking for a transport
	 *    - AFTER param serialization (s.data is a string if s.processData is true)
	 * 3) key is the dataType
	 * 4) the catchall symbol "*" can be used
	 * 5) execution will start with transport dataType and THEN continue down to "*" if needed
	 */
            prefilters = {},
            /* Transports bindings
	 * 1) key is the dataType
	 * 2) the catchall symbol "*" can be used
	 * 3) selection will start with transport dataType and THEN go to "*" if needed
	 */
            transports = {},
            // Avoid comment-prolog char sequence (#10098); must appease lint and evade compression
            allTypes = '*/'.concat('*');
        // #8138, IE may throw an exception when accessing
        // a field from window.location if document.domain has been set
        try {
            ajaxLocation = location.href;
        } catch (e) {
            // Use the href attribute of an A element
            // since IE will modify it given document.location
            ajaxLocation = document.createElement('a');
            ajaxLocation.href = '';
            ajaxLocation = ajaxLocation.href;
        }
        // Segment location into parts
        ajaxLocParts = rurl.exec(ajaxLocation.toLowerCase()) || [];
        // Base "constructor" for jQuery.ajaxPrefilter and jQuery.ajaxTransport
        function addToPrefiltersOrTransports(structure) {
            // dataTypeExpression is optional and defaults to "*"
            return function (dataTypeExpression, func) {
                if (typeof dataTypeExpression !== 'string') {
                    func = dataTypeExpression;
                    dataTypeExpression = '*';
                }
                var dataType, i = 0, dataTypes = dataTypeExpression.toLowerCase().match(rnotwhite) || [];
                if (jQuery.isFunction(func)) {
                    // For each dataType in the dataTypeExpression
                    while (dataType = dataTypes[i++]) {
                        // Prepend if requested
                        if (dataType.charAt(0) === '+') {
                            dataType = dataType.slice(1) || '*';
                            (structure[dataType] = structure[dataType] || []).unshift(func);    // Otherwise append
                        } else {
                            (structure[dataType] = structure[dataType] || []).push(func);
                        }
                    }
                }
            };
        }
        // Base inspection function for prefilters and transports
        function inspectPrefiltersOrTransports(structure, options, originalOptions, jqXHR) {
            var inspected = {}, seekingTransport = structure === transports;
            function inspect(dataType) {
                var selected;
                inspected[dataType] = true;
                jQuery.each(structure[dataType] || [], function (_, prefilterOrFactory) {
                    var dataTypeOrTransport = prefilterOrFactory(options, originalOptions, jqXHR);
                    if (typeof dataTypeOrTransport === 'string' && !seekingTransport && !inspected[dataTypeOrTransport]) {
                        options.dataTypes.unshift(dataTypeOrTransport);
                        inspect(dataTypeOrTransport);
                        return false;
                    } else if (seekingTransport) {
                        return !(selected = dataTypeOrTransport);
                    }
                });
                return selected;
            }
            return inspect(options.dataTypes[0]) || !inspected['*'] && inspect('*');
        }
        // A special extend for ajax options
        // that takes "flat" options (not to be deep extended)
        // Fixes #9887
        function ajaxExtend(target, src) {
            var deep, key, flatOptions = jQuery.ajaxSettings.flatOptions || {};
            for (key in src) {
                if (src[key] !== undefined) {
                    (flatOptions[key] ? target : deep || (deep = {}))[key] = src[key];
                }
            }
            if (deep) {
                jQuery.extend(true, target, deep);
            }
            return target;
        }
        /* Handles responses to an ajax request:
 * - finds the right dataType (mediates between content-type and expected dataType)
 * - returns the corresponding response
 */
        function ajaxHandleResponses(s, jqXHR, responses) {
            var firstDataType, ct, finalDataType, type, contents = s.contents, dataTypes = s.dataTypes;
            // Remove auto dataType and get content-type in the process
            while (dataTypes[0] === '*') {
                dataTypes.shift();
                if (ct === undefined) {
                    ct = s.mimeType || jqXHR.getResponseHeader('Content-Type');
                }
            }
            // Check if we're dealing with a known content-type
            if (ct) {
                for (type in contents) {
                    if (contents[type] && contents[type].test(ct)) {
                        dataTypes.unshift(type);
                        break;
                    }
                }
            }
            // Check to see if we have a response for the expected dataType
            if (dataTypes[0] in responses) {
                finalDataType = dataTypes[0];
            } else {
                // Try convertible dataTypes
                for (type in responses) {
                    if (!dataTypes[0] || s.converters[type + ' ' + dataTypes[0]]) {
                        finalDataType = type;
                        break;
                    }
                    if (!firstDataType) {
                        firstDataType = type;
                    }
                }
                // Or just use first one
                finalDataType = finalDataType || firstDataType;
            }
            // If we found a dataType
            // We add the dataType to the list if needed
            // and return the corresponding response
            if (finalDataType) {
                if (finalDataType !== dataTypes[0]) {
                    dataTypes.unshift(finalDataType);
                }
                return responses[finalDataType];
            }
        }
        /* Chain conversions given the request and the original response
 * Also sets the responseXXX fields on the jqXHR instance
 */
        function ajaxConvert(s, response, jqXHR, isSuccess) {
            var conv2, current, conv, tmp, prev, converters = {},
                // Work with a copy of dataTypes in case we need to modify it for conversion
                dataTypes = s.dataTypes.slice();
            // Create converters map with lowercased keys
            if (dataTypes[1]) {
                for (conv in s.converters) {
                    converters[conv.toLowerCase()] = s.converters[conv];
                }
            }
            current = dataTypes.shift();
            // Convert to each sequential dataType
            while (current) {
                if (s.responseFields[current]) {
                    jqXHR[s.responseFields[current]] = response;
                }
                // Apply the dataFilter if provided
                if (!prev && isSuccess && s.dataFilter) {
                    response = s.dataFilter(response, s.dataType);
                }
                prev = current;
                current = dataTypes.shift();
                if (current) {
                    // There's only work to do if current dataType is non-auto
                    if (current === '*') {
                        current = prev;    // Convert response if prev dataType is non-auto and differs from current
                    } else if (prev !== '*' && prev !== current) {
                        // Seek a direct converter
                        conv = converters[prev + ' ' + current] || converters['* ' + current];
                        // If none found, seek a pair
                        if (!conv) {
                            for (conv2 in converters) {
                                // If conv2 outputs current
                                tmp = conv2.split(' ');
                                if (tmp[1] === current) {
                                    // If prev can be converted to accepted input
                                    conv = converters[prev + ' ' + tmp[0]] || converters['* ' + tmp[0]];
                                    if (conv) {
                                        // Condense equivalence converters
                                        if (conv === true) {
                                            conv = converters[conv2];    // Otherwise, insert the intermediate dataType
                                        } else if (converters[conv2] !== true) {
                                            current = tmp[0];
                                            dataTypes.unshift(tmp[1]);
                                        }
                                        break;
                                    }
                                }
                            }
                        }
                        // Apply converter (if not an equivalence)
                        if (conv !== true) {
                            // Unless errors are allowed to bubble, catch and return them
                            if (conv && s['throws']) {
                                response = conv(response);
                            } else {
                                try {
                                    response = conv(response);
                                } catch (e) {
                                    return {
                                        state: 'parsererror',
                                        error: conv ? e : 'No conversion from ' + prev + ' to ' + current
                                    };
                                }
                            }
                        }
                    }
                }
            }
            return {
                state: 'success',
                data: response
            };
        }
        jQuery.extend({
            // Counter for holding the number of active queries
            active: 0,
            // Last-Modified header cache for next request
            lastModified: {},
            etag: {},
            ajaxSettings: {
                url: ajaxLocation,
                type: 'GET',
                isLocal: rlocalProtocol.test(ajaxLocParts[1]),
                global: true,
                processData: true,
                async: true,
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                /*
		timeout: 0,
		data: null,
		dataType: null,
		username: null,
		password: null,
		cache: null,
		throws: false,
		traditional: false,
		headers: {},
		*/
                accepts: {
                    '*': allTypes,
                    text: 'text/plain',
                    html: 'text/html',
                    xml: 'application/xml, text/xml',
                    json: 'application/json, text/javascript'
                },
                contents: {
                    xml: /xml/,
                    html: /html/,
                    json: /json/
                },
                responseFields: {
                    xml: 'responseXML',
                    text: 'responseText',
                    json: 'responseJSON'
                },
                // Data converters
                // Keys separate source (or catchall "*") and destination types with a single space
                converters: {
                    // Convert anything to text
                    '* text': String,
                    // Text to html (true = no transformation)
                    'text html': true,
                    // Evaluate text as a json expression
                    'text json': jQuery.parseJSON,
                    // Parse text as xml
                    'text xml': jQuery.parseXML
                },
                // For options that shouldn't be deep extended:
                // you can add your own custom options here if
                // and when you create one that shouldn't be
                // deep extended (see ajaxExtend)
                flatOptions: {
                    url: true,
                    context: true
                }
            },
            // Creates a full fledged settings object into target
            // with both ajaxSettings and settings fields.
            // If target is omitted, writes into ajaxSettings.
            ajaxSetup: function (target, settings) {
                return settings ? // Building a settings object
                ajaxExtend(ajaxExtend(target, jQuery.ajaxSettings), settings) : // Extending ajaxSettings
                ajaxExtend(jQuery.ajaxSettings, target);
            },
            ajaxPrefilter: addToPrefiltersOrTransports(prefilters),
            ajaxTransport: addToPrefiltersOrTransports(transports),
            // Main method
            ajax: function (url, options) {
                // If url is an object, simulate pre-1.5 signature
                if (typeof url === 'object') {
                    options = url;
                    url = undefined;
                }
                // Force options to be an object
                options = options || {};
                var
                    // Cross-domain detection vars
                    parts,
                    // Loop variable
                    i,
                    // URL without anti-cache param
                    cacheURL,
                    // Response headers as string
                    responseHeadersString,
                    // timeout handle
                    timeoutTimer,
                    // To know if global events are to be dispatched
                    fireGlobals, transport,
                    // Response headers
                    responseHeaders,
                    // Create the final options object
                    s = jQuery.ajaxSetup({}, options),
                    // Callbacks context
                    callbackContext = s.context || s,
                    // Context for global events is callbackContext if it is a DOM node or jQuery collection
                    globalEventContext = s.context && (callbackContext.nodeType || callbackContext.jquery) ? jQuery(callbackContext) : jQuery.event,
                    // Deferreds
                    deferred = jQuery.Deferred(), completeDeferred = jQuery.Callbacks('once memory'),
                    // Status-dependent callbacks
                    statusCode = s.statusCode || {},
                    // Headers (they are sent all at once)
                    requestHeaders = {}, requestHeadersNames = {},
                    // The jqXHR state
                    state = 0,
                    // Default abort message
                    strAbort = 'canceled',
                    // Fake xhr
                    jqXHR = {
                        readyState: 0,
                        // Builds headers hashtable if needed
                        getResponseHeader: function (key) {
                            var match;
                            if (state === 2) {
                                if (!responseHeaders) {
                                    responseHeaders = {};
                                    while (match = rheaders.exec(responseHeadersString)) {
                                        responseHeaders[match[1].toLowerCase()] = match[2];
                                    }
                                }
                                match = responseHeaders[key.toLowerCase()];
                            }
                            return match == null ? null : match;
                        },
                        // Raw string
                        getAllResponseHeaders: function () {
                            return state === 2 ? responseHeadersString : null;
                        },
                        // Caches the header
                        setRequestHeader: function (name, value) {
                            var lname = name.toLowerCase();
                            if (!state) {
                                name = requestHeadersNames[lname] = requestHeadersNames[lname] || name;
                                requestHeaders[name] = value;
                            }
                            return this;
                        },
                        // Overrides response content-type header
                        overrideMimeType: function (type) {
                            if (!state) {
                                s.mimeType = type;
                            }
                            return this;
                        },
                        // Status-dependent callbacks
                        statusCode: function (map) {
                            var code;
                            if (map) {
                                if (state < 2) {
                                    for (code in map) {
                                        // Lazy-add the new callback in a way that preserves old ones
                                        statusCode[code] = [
                                            statusCode[code],
                                            map[code]
                                        ];
                                    }
                                } else {
                                    // Execute the appropriate callbacks
                                    jqXHR.always(map[jqXHR.status]);
                                }
                            }
                            return this;
                        },
                        // Cancel the request
                        abort: function (statusText) {
                            var finalText = statusText || strAbort;
                            if (transport) {
                                transport.abort(finalText);
                            }
                            done(0, finalText);
                            return this;
                        }
                    };
                // Attach deferreds
                deferred.promise(jqXHR).complete = completeDeferred.add;
                jqXHR.success = jqXHR.done;
                jqXHR.error = jqXHR.fail;
                // Remove hash character (#7531: and string promotion)
                // Add protocol if not provided (#5866: IE7 issue with protocol-less urls)
                // Handle falsy url in the settings object (#10093: consistency with old signature)
                // We also use the url parameter if available
                s.url = ((url || s.url || ajaxLocation) + '').replace(rhash, '').replace(rprotocol, ajaxLocParts[1] + '//');
                // Alias method option to type as per ticket #12004
                s.type = options.method || options.type || s.method || s.type;
                // Extract dataTypes list
                s.dataTypes = jQuery.trim(s.dataType || '*').toLowerCase().match(rnotwhite) || [''];
                // A cross-domain request is in order when we have a protocol:host:port mismatch
                if (s.crossDomain == null) {
                    parts = rurl.exec(s.url.toLowerCase());
                    s.crossDomain = !!(parts && (parts[1] !== ajaxLocParts[1] || parts[2] !== ajaxLocParts[2] || (parts[3] || (parts[1] === 'http:' ? '80' : '443')) !== (ajaxLocParts[3] || (ajaxLocParts[1] === 'http:' ? '80' : '443'))));
                }
                // Convert data if not already a string
                if (s.data && s.processData && typeof s.data !== 'string') {
                    s.data = jQuery.param(s.data, s.traditional);
                }
                // Apply prefilters
                inspectPrefiltersOrTransports(prefilters, s, options, jqXHR);
                // If request was aborted inside a prefilter, stop there
                if (state === 2) {
                    return jqXHR;
                }
                // We can fire global events as of now if asked to
                fireGlobals = s.global;
                // Watch for a new set of requests
                if (fireGlobals && jQuery.active++ === 0) {
                    jQuery.event.trigger('ajaxStart');
                }
                // Uppercase the type
                s.type = s.type.toUpperCase();
                // Determine if request has content
                s.hasContent = !rnoContent.test(s.type);
                // Save the URL in case we're toying with the If-Modified-Since
                // and/or If-None-Match header later on
                cacheURL = s.url;
                // More options handling for requests with no content
                if (!s.hasContent) {
                    // If data is available, append data to url
                    if (s.data) {
                        cacheURL = s.url += (rquery.test(cacheURL) ? '&' : '?') + s.data;
                        // #9682: remove data so that it's not used in an eventual retry
                        delete s.data;
                    }
                    // Add anti-cache in url if needed
                    if (s.cache === false) {
                        s.url = rts.test(cacheURL) ? // If there is already a '_' parameter, set its value
                        cacheURL.replace(rts, '$1_=' + nonce++) : // Otherwise add one to the end
                        cacheURL + (rquery.test(cacheURL) ? '&' : '?') + '_=' + nonce++;
                    }
                }
                // Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.
                if (s.ifModified) {
                    if (jQuery.lastModified[cacheURL]) {
                        jqXHR.setRequestHeader('If-Modified-Since', jQuery.lastModified[cacheURL]);
                    }
                    if (jQuery.etag[cacheURL]) {
                        jqXHR.setRequestHeader('If-None-Match', jQuery.etag[cacheURL]);
                    }
                }
                // Set the correct header, if data is being sent
                if (s.data && s.hasContent && s.contentType !== false || options.contentType) {
                    jqXHR.setRequestHeader('Content-Type', s.contentType);
                }
                // Set the Accepts header for the server, depending on the dataType
                jqXHR.setRequestHeader('Accept', s.dataTypes[0] && s.accepts[s.dataTypes[0]] ? s.accepts[s.dataTypes[0]] + (s.dataTypes[0] !== '*' ? ', ' + allTypes + '; q=0.01' : '') : s.accepts['*']);
                // Check for headers option
                for (i in s.headers) {
                    jqXHR.setRequestHeader(i, s.headers[i]);
                }
                // Allow custom headers/mimetypes and early abort
                if (s.beforeSend && (s.beforeSend.call(callbackContext, jqXHR, s) === false || state === 2)) {
                    // Abort if not done already and return
                    return jqXHR.abort();
                }
                // aborting is no longer a cancellation
                strAbort = 'abort';
                // Install callbacks on deferreds
                for (i in {
                        success: 1,
                        error: 1,
                        complete: 1
                    }) {
                    jqXHR[i](s[i]);
                }
                // Get transport
                transport = inspectPrefiltersOrTransports(transports, s, options, jqXHR);
                // If no transport, we auto-abort
                if (!transport) {
                    done(-1, 'No Transport');
                } else {
                    jqXHR.readyState = 1;
                    // Send global event
                    if (fireGlobals) {
                        globalEventContext.trigger('ajaxSend', [
                            jqXHR,
                            s
                        ]);
                    }
                    // Timeout
                    if (s.async && s.timeout > 0) {
                        timeoutTimer = setTimeout(function () {
                            jqXHR.abort('timeout');
                        }, s.timeout);
                    }
                    try {
                        state = 1;
                        transport.send(requestHeaders, done);
                    } catch (e) {
                        // Propagate exception as error if not done
                        if (state < 2) {
                            done(-1, e);    // Simply rethrow otherwise
                        } else {
                            throw e;
                        }
                    }
                }
                // Callback for when everything is done
                function done(status, nativeStatusText, responses, headers) {
                    var isSuccess, success, error, response, modified, statusText = nativeStatusText;
                    // Called once
                    if (state === 2) {
                        return;
                    }
                    // State is "done" now
                    state = 2;
                    // Clear timeout if it exists
                    if (timeoutTimer) {
                        clearTimeout(timeoutTimer);
                    }
                    // Dereference transport for early garbage collection
                    // (no matter how long the jqXHR object will be used)
                    transport = undefined;
                    // Cache response headers
                    responseHeadersString = headers || '';
                    // Set readyState
                    jqXHR.readyState = status > 0 ? 4 : 0;
                    // Determine if successful
                    status = jqXHR.getResponseHeader('Custom-Header-Status') || status;
                    isSuccess = status >= 200 && status < 300 || status === 304;
                    // Get response data
                    if (responses) {
                        response = ajaxHandleResponses(s, jqXHR, responses);
                    }
                    // Convert no matter what (that way responseXXX fields are always set)
                    response = ajaxConvert(s, response, jqXHR, isSuccess);
                    // If successful, handle type chaining
                    if (isSuccess) {
                        // Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.
                        if (s.ifModified) {
                            modified = jqXHR.getResponseHeader('Last-Modified');
                            if (modified) {
                                jQuery.lastModified[cacheURL] = modified;
                            }
                            modified = jqXHR.getResponseHeader('etag');
                            if (modified) {
                                jQuery.etag[cacheURL] = modified;
                            }
                        }
                        // if no content
                        if (status === 204 || s.type === 'HEAD') {
                            statusText = 'nocontent';    // if not modified
                        } else if (status === 304) {
                            statusText = 'notmodified';    // If we have data, let's convert it
                        } else {
                            statusText = response.state;
                            success = response.data;
                            error = response.error;
                            isSuccess = !error;
                        }
                    } else {
                        // We extract error from statusText
                        // then normalize statusText and status for non-aborts
                        error = statusText;
                        if (status || !statusText) {
                            statusText = 'error';
                            if (status < 0) {
                                status = 0;
                            }
                        }
                    }
                    // Set data for the fake xhr object
                    jqXHR.status = status;
                    jqXHR.statusText = (nativeStatusText || statusText) + '';
                    // Success/Error
                    if (isSuccess) {
                        deferred.resolveWith(callbackContext, [
                            success,
                            statusText,
                            jqXHR
                        ]);
                    } else {
                        deferred.rejectWith(callbackContext, [
                            jqXHR,
                            statusText,
                            error
                        ]);
                    }
                    // Status-dependent callbacks
                    jqXHR.statusCode(statusCode);
                    statusCode = undefined;
                    if (fireGlobals) {
                        globalEventContext.trigger(isSuccess ? 'ajaxSuccess' : 'ajaxError', [
                            jqXHR,
                            s,
                            isSuccess ? success : error
                        ]);
                    }
                    // Complete
                    completeDeferred.fireWith(callbackContext, [
                        jqXHR,
                        statusText
                    ]);
                    if (fireGlobals) {
                        globalEventContext.trigger('ajaxComplete', [
                            jqXHR,
                            s
                        ]);
                        // Handle the global AJAX counter
                        if (!--jQuery.active) {
                            jQuery.event.trigger('ajaxStop');
                        }
                    }
                }
                return jqXHR;
            },
            getJSON: function (url, data, callback) {
                return jQuery.get(url, data, callback, 'json');
            },
            getScript: function (url, callback) {
                return jQuery.get(url, undefined, callback, 'script');
            }
        });
        jQuery.each([
            'get',
            'post'
        ], function (i, method) {
            jQuery[method] = function (url, data, callback, type) {
                // shift arguments if data argument was omitted
                if (jQuery.isFunction(data)) {
                    type = type || callback;
                    callback = data;
                    data = undefined;
                }
                return jQuery.ajax({
                    url: url,
                    type: method,
                    dataType: type,
                    data: data,
                    success: callback
                });
            };
        });
        // Attach a bunch of functions for handling common AJAX events
        jQuery.each([
            'ajaxStart',
            'ajaxStop',
            'ajaxComplete',
            'ajaxError',
            'ajaxSuccess',
            'ajaxSend'
        ], function (i, type) {
            jQuery.fn[type] = function (fn) {
                return this.on(type, fn);
            };
        });
        jQuery._evalUrl = function (url) {
            return jQuery.ajax({
                url: url,
                type: 'GET',
                dataType: 'script',
                async: false,
                global: false,
                'throws': true
            });
        };
        jQuery.fn.extend({
            wrapAll: function (html) {
                if (jQuery.isFunction(html)) {
                    return this.each(function (i) {
                        jQuery(this).wrapAll(html.call(this, i));
                    });
                }
                if (this[0]) {
                    // The elements to wrap the target around
                    var wrap = jQuery(html, this[0].ownerDocument).eq(0).clone(true);
                    if (this[0].parentNode) {
                        wrap.insertBefore(this[0]);
                    }
                    wrap.map(function () {
                        var elem = this;
                        while (elem.firstChild && elem.firstChild.nodeType === 1) {
                            elem = elem.firstChild;
                        }
                        return elem;
                    }).append(this);
                }
                return this;
            },
            wrapInner: function (html) {
                if (jQuery.isFunction(html)) {
                    return this.each(function (i) {
                        jQuery(this).wrapInner(html.call(this, i));
                    });
                }
                return this.each(function () {
                    var self = jQuery(this), contents = self.contents();
                    if (contents.length) {
                        contents.wrapAll(html);
                    } else {
                        self.append(html);
                    }
                });
            },
            wrap: function (html) {
                var isFunction = jQuery.isFunction(html);
                return this.each(function (i) {
                    jQuery(this).wrapAll(isFunction ? html.call(this, i) : html);
                });
            },
            unwrap: function () {
                return this.parent().each(function () {
                    if (!jQuery.nodeName(this, 'body')) {
                        jQuery(this).replaceWith(this.childNodes);
                    }
                }).end();
            }
        });
        jQuery.expr.filters.hidden = function (elem) {
            // Support: Opera <= 12.12
            // Opera reports offsetWidths and offsetHeights less than zero on some elements
            return elem.offsetWidth <= 0 && elem.offsetHeight <= 0 || !support.reliableHiddenOffsets() && (elem.style && elem.style.display || jQuery.css(elem, 'display')) === 'none';
        };
        jQuery.expr.filters.visible = function (elem) {
            return !jQuery.expr.filters.hidden(elem);
        };
        var r20 = /%20/g, rbracket = /\[\]$/, rCRLF = /\r?\n/g, rsubmitterTypes = /^(?:submit|button|image|reset|file)$/i, rsubmittable = /^(?:input|select|textarea|keygen)/i;
        function buildParams(prefix, obj, traditional, add) {
            var name;
            if (jQuery.isArray(obj)) {
                // Serialize array item.
                jQuery.each(obj, function (i, v) {
                    if (traditional || rbracket.test(prefix)) {
                        // Treat each array item as a scalar.
                        add(prefix, v);
                    } else {
                        // Item is non-scalar (array or object), encode its numeric index.
                        buildParams(prefix + '[' + (typeof v === 'object' ? i : '') + ']', v, traditional, add);
                    }
                });
            } else if (!traditional && jQuery.type(obj) === 'object') {
                // Serialize object item.
                for (name in obj) {
                    buildParams(prefix + '[' + name + ']', obj[name], traditional, add);
                }
            } else {
                // Serialize scalar item.
                add(prefix, obj);
            }
        }
        // Serialize an array of form elements or a set of
        // key/values into a query string
        jQuery.param = function (a, traditional) {
            var prefix, s = [], add = function (key, value) {
                    // If value is a function, invoke it and return its value
                    value = jQuery.isFunction(value) ? value() : value == null ? '' : value;
                    s[s.length] = encodeURIComponent(key) + '=' + encodeURIComponent(value);
                };
            // Set traditional to true for jQuery <= 1.3.2 behavior.
            if (traditional === undefined) {
                traditional = jQuery.ajaxSettings && jQuery.ajaxSettings.traditional;
            }
            // If an array was passed in, assume that it is an array of form elements.
            if (jQuery.isArray(a) || a.jquery && !jQuery.isPlainObject(a)) {
                // Serialize the form elements
                jQuery.each(a, function () {
                    add(this.name, this.value);
                });
            } else {
                // If traditional, encode the "old" way (the way 1.3.2 or older
                // did it), otherwise encode params recursively.
                for (prefix in a) {
                    buildParams(prefix, a[prefix], traditional, add);
                }
            }
            // Return the resulting serialization
            return s.join('&').replace(r20, '+');
        };
        jQuery.fn.extend({
            serialize: function () {
                return jQuery.param(this.serializeArray());
            },
            serializeArray: function () {
                return this.map(function () {
                    // Can add propHook for "elements" to filter or add form elements
                    var elements = jQuery.prop(this, 'elements');
                    return elements ? jQuery.makeArray(elements) : this;
                }).filter(function () {
                    var type = this.type;
                    // Use .is(":disabled") so that fieldset[disabled] works
                    return this.name && !jQuery(this).is(':disabled') && rsubmittable.test(this.nodeName) && !rsubmitterTypes.test(type) && (this.checked || !rcheckableType.test(type));
                }).map(function (i, elem) {
                    var val = jQuery(this).val();
                    return val == null ? null : jQuery.isArray(val) ? jQuery.map(val, function (val) {
                        return {
                            name: elem.name,
                            value: val.replace(rCRLF, '\r\n')
                        };
                    }) : {
                        name: elem.name,
                        value: val.replace(rCRLF, '\r\n')
                    };
                }).get();
            }
        });
        // Create the request object
        // (This is still attached to ajaxSettings for backward compatibility)
        jQuery.ajaxSettings.xhr = window.ActiveXObject !== undefined ? // Support: IE6+
        function () {
            // XHR cannot access local files, always use ActiveX for that case
            return !this.isLocal && // Support: IE7-8
            // oldIE XHR does not support non-RFC2616 methods (#13240)
            // See http://msdn.microsoft.com/en-us/library/ie/ms536648(v=vs.85).aspx
            // and http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9
            // Although this check for six methods instead of eight
            // since IE also does not support "trace" and "connect"
            /^(get|post|head|put|delete|options)$/i.test(this.type) && createStandardXHR() || createActiveXHR();
        } : // For all other browsers, use the standard XMLHttpRequest object
        createStandardXHR;
        var xhrId = 0, xhrCallbacks = {}, xhrSupported = jQuery.ajaxSettings.xhr();
        // Support: IE<10
        // Open requests must be manually aborted on unload (#5280)
        if (window.ActiveXObject) {
            jQuery(window).on('unload', function () {
                for (var key in xhrCallbacks) {
                    xhrCallbacks[key](undefined, true);
                }
            });
        }
        // Determine support properties
        support.cors = !!xhrSupported && 'withCredentials' in xhrSupported;
        xhrSupported = support.ajax = !!xhrSupported;
        // Create transport if the browser can provide an xhr
        if (xhrSupported) {
            jQuery.ajaxTransport(function (options) {
                // Cross domain only allowed if supported through XMLHttpRequest
                if (!options.crossDomain || support.cors) {
                    var callback;
                    return {
                        send: function (headers, complete) {
                            var i, xhr = options.xhr(), id = ++xhrId;
                            // Open the socket
                            xhr.open(options.type, options.url, options.async, options.username, options.password);
                            // Apply custom fields if provided
                            if (options.xhrFields) {
                                for (i in options.xhrFields) {
                                    xhr[i] = options.xhrFields[i];
                                }
                            }
                            // Override mime type if needed
                            if (options.mimeType && xhr.overrideMimeType) {
                                xhr.overrideMimeType(options.mimeType);
                            }
                            // X-Requested-With header
                            // For cross-domain requests, seeing as conditions for a preflight are
                            // akin to a jigsaw puzzle, we simply never set it to be sure.
                            // (it can always be set on a per-request basis or even using ajaxSetup)
                            // For same-domain requests, won't change header if already provided.
                            if (!options.crossDomain && !headers['X-Requested-With']) {
                                headers['X-Requested-With'] = 'XMLHttpRequest';
                            }
                            // Set headers
                            for (i in headers) {
                                // Support: IE<9
                                // IE's ActiveXObject throws a 'Type Mismatch' exception when setting
                                // request header to a null-value.
                                //
                                // To keep consistent with other XHR implementations, cast the value
                                // to string and ignore `undefined`.
                                if (headers[i] !== undefined) {
                                    xhr.setRequestHeader(i, headers[i] + '');
                                }
                            }
                            // Do send the request
                            // This may raise an exception which is actually
                            // handled in jQuery.ajax (so no try/catch here)
                            xhr.send(options.hasContent && options.data || null);
                            // Listener
                            callback = function (_, isAbort) {
                                var status, statusText, responses;
                                // Was never called and is aborted or complete
                                if (callback && (isAbort || xhr.readyState === 4)) {
                                    // Clean up
                                    delete xhrCallbacks[id];
                                    callback = undefined;
                                    xhr.onreadystatechange = jQuery.noop;
                                    // Abort manually if needed
                                    if (isAbort) {
                                        if (xhr.readyState !== 4) {
                                            xhr.abort();
                                        }
                                    } else {
                                        responses = {};
                                        status = xhr.status;
                                        // Support: IE<10
                                        // Accessing binary-data responseText throws an exception
                                        // (#11426)
                                        if (typeof xhr.responseText === 'string') {
                                            responses.text = xhr.responseText;
                                        }
                                        // Firefox throws an exception when accessing
                                        // statusText for faulty cross-domain requests
                                        try {
                                            statusText = xhr.statusText;
                                        } catch (e) {
                                            // We normalize with Webkit giving an empty statusText
                                            statusText = '';
                                        }
                                        // Filter status for non standard behaviors
                                        // If the request is local and we have data: assume a success
                                        // (success with no data won't get notified, that's the best we
                                        // can do given current implementations)
                                        if (!status && options.isLocal && !options.crossDomain) {
                                            status = responses.text ? 200 : 404;    // IE - #1450: sometimes returns 1223 when it should be 204
                                        } else if (status === 1223) {
                                            status = 204;
                                        }
                                    }
                                }
                                // Call complete if needed
                                if (responses) {
                                    complete(status, statusText, responses, xhr.getAllResponseHeaders());
                                }
                            };
                            if (!options.async) {
                                // if we're in sync mode we fire the callback
                                callback();
                            } else if (xhr.readyState === 4) {
                                // (IE6 & IE7) if it's in cache and has been
                                // retrieved directly we need to fire the callback
                                setTimeout(callback);
                            } else {
                                // Add to the list of active xhr callbacks
                                xhr.onreadystatechange = xhrCallbacks[id] = callback;
                            }
                        },
                        abort: function () {
                            if (callback) {
                                callback(undefined, true);
                            }
                        }
                    };
                }
            });
        }
        // Functions to create xhrs
        function createStandardXHR() {
            try {
                return new window.XMLHttpRequest();
            } catch (e) {
            }
        }
        function createActiveXHR() {
            try {
                return new window.ActiveXObject('Microsoft.XMLHTTP');
            } catch (e) {
            }
        }
        // Install script dataType
        jQuery.ajaxSetup({
            accepts: { script: 'text/javascript, application/javascript, application/ecmascript, application/x-ecmascript' },
            contents: { script: /(?:java|ecma)script/ },
            converters: {
                'text script': function (text) {
                    jQuery.globalEval(text);
                    return text;
                }
            }
        });
        // Handle cache's special case and global
        jQuery.ajaxPrefilter('script', function (s) {
            if (s.cache === undefined) {
                s.cache = false;
            }
            if (s.crossDomain) {
                s.type = 'GET';
                s.global = false;
            }
        });
        // Bind script tag hack transport
        jQuery.ajaxTransport('script', function (s) {
            // This transport only deals with cross domain requests
            if (s.crossDomain) {
                var script, head = document.head || jQuery('head')[0] || document.documentElement;
                return {
                    send: function (_, callback) {
                        script = document.createElement('script');
                        script.async = true;
                        if (s.scriptCharset) {
                            script.charset = s.scriptCharset;
                        }
                        script.src = s.url;
                        // Attach handlers for all browsers
                        script.onload = script.onreadystatechange = function (_, isAbort) {
                            if (isAbort || !script.readyState || /loaded|complete/.test(script.readyState)) {
                                // Handle memory leak in IE
                                script.onload = script.onreadystatechange = null;
                                // Remove the script
                                if (script.parentNode) {
                                    script.parentNode.removeChild(script);
                                }
                                // Dereference the script
                                script = null;
                                // Callback if not abort
                                if (!isAbort) {
                                    callback(200, 'success');
                                }
                            }
                        };
                        // Circumvent IE6 bugs with base elements (#2709 and #4378) by prepending
                        // Use native DOM manipulation to avoid our domManip AJAX trickery
                        head.insertBefore(script, head.firstChild);
                    },
                    abort: function () {
                        if (script) {
                            script.onload(undefined, true);
                        }
                    }
                };
            }
        });
        var oldCallbacks = [], rjsonp = /(=)\?(?=&|$)|\?\?/;
        // Default jsonp settings
        jQuery.ajaxSetup({
            jsonp: 'callback',
            jsonpCallback: function () {
                var callback = oldCallbacks.pop() || jQuery.expando + '_' + nonce++;
                this[callback] = true;
                return callback;
            }
        });
        // Detect, normalize options and install callbacks for jsonp requests
        jQuery.ajaxPrefilter('json jsonp', function (s, originalSettings, jqXHR) {
            var callbackName, overwritten, responseContainer, jsonProp = s.jsonp !== false && (rjsonp.test(s.url) ? 'url' : typeof s.data === 'string' && !(s.contentType || '').indexOf('application/x-www-form-urlencoded') && rjsonp.test(s.data) && 'data');
            // Handle iff the expected data type is "jsonp" or we have a parameter to set
            if (jsonProp || s.dataTypes[0] === 'jsonp') {
                // Get callback name, remembering preexisting value associated with it
                callbackName = s.jsonpCallback = jQuery.isFunction(s.jsonpCallback) ? s.jsonpCallback() : s.jsonpCallback;
                // Insert callback into url or form data
                if (jsonProp) {
                    s[jsonProp] = s[jsonProp].replace(rjsonp, '$1' + callbackName);
                } else if (s.jsonp !== false) {
                    s.url += (rquery.test(s.url) ? '&' : '?') + s.jsonp + '=' + callbackName;
                }
                // Use data converter to retrieve json after script execution
                s.converters['script json'] = function () {
                    if (!responseContainer) {
                        jQuery.error(callbackName + ' was not called');
                    }
                    return responseContainer[0];
                };
                // force json dataType
                s.dataTypes[0] = 'json';
                // Install callback
                overwritten = window[callbackName];
                window[callbackName] = function () {
                    responseContainer = arguments;
                };
                // Clean-up function (fires after converters)
                jqXHR.always(function () {
                    // Restore preexisting value
                    window[callbackName] = overwritten;
                    // Save back as free
                    if (s[callbackName]) {
                        // make sure that re-using the options doesn't screw things around
                        s.jsonpCallback = originalSettings.jsonpCallback;
                        // save the callback name for future use
                        oldCallbacks.push(callbackName);
                    }
                    // Call if it was a function and we have a response
                    if (responseContainer && jQuery.isFunction(overwritten)) {
                        overwritten(responseContainer[0]);
                    }
                    responseContainer = overwritten = undefined;
                });
                // Delegate to script
                return 'script';
            }
        });
        // data: string of html
        // context (optional): If specified, the fragment will be created in this context, defaults to document
        // keepScripts (optional): If true, will include scripts passed in the html string
        jQuery.parseHTML = function (data, context, keepScripts) {
            if (!data || typeof data !== 'string') {
                return null;
            }
            if (typeof context === 'boolean') {
                keepScripts = context;
                context = false;
            }
            context = context || document;
            var parsed = rsingleTag.exec(data), scripts = !keepScripts && [];
            // Single tag
            if (parsed) {
                return [context.createElement(parsed[1])];
            }
            parsed = jQuery.buildFragment([data], context, scripts);
            if (scripts && scripts.length) {
                jQuery(scripts).remove();
            }
            return jQuery.merge([], parsed.childNodes);
        };
        // Keep a copy of the old load method
        var _load = jQuery.fn.load;
        /**
 * Load a url into a page
 */
        jQuery.fn.load = function (url, params, callback) {
            if (typeof url !== 'string' && _load) {
                return _load.apply(this, arguments);
            }
            var selector, response, type, self = this, off = url.indexOf(' ');
            if (off >= 0) {
                selector = jQuery.trim(url.slice(off, url.length));
                url = url.slice(0, off);
            }
            // If it's a function
            if (jQuery.isFunction(params)) {
                // We assume that it's the callback
                callback = params;
                params = undefined;    // Otherwise, build a param string
            } else if (params && typeof params === 'object') {
                type = 'POST';
            }
            // If we have elements to modify, make the request
            if (self.length > 0) {
                jQuery.ajax({
                    url: url,
                    // if "type" variable is undefined, then "GET" method will be used
                    type: type,
                    dataType: 'html',
                    data: params
                }).done(function (responseText) {
                    // Save response for use in complete callback
                    response = arguments;
                    self.html(selector ? // If a selector was specified, locate the right elements in a dummy div
                    // Exclude scripts to avoid IE 'Permission Denied' errors
                    jQuery('<div>').append(jQuery.parseHTML(responseText)).find(selector) : // Otherwise use the full result
                    responseText);
                }).complete(callback && function (jqXHR, status) {
                    self.each(callback, response || [
                        jqXHR.responseText,
                        status,
                        jqXHR
                    ]);
                });
            }
            return this;
        };
        jQuery.expr.filters.animated = function (elem) {
            return jQuery.grep(jQuery.timers, function (fn) {
                return elem === fn.elem;
            }).length;
        };
        var docElem = window.document.documentElement;
        /**
 * Gets a window from an element
 */
        function getWindow(elem) {
            return jQuery.isWindow(elem) ? elem : elem.nodeType === 9 ? elem.defaultView || elem.parentWindow : false;
        }
        jQuery.offset = {
            setOffset: function (elem, options, i) {
                var curPosition, curLeft, curCSSTop, curTop, curOffset, curCSSLeft, calculatePosition, position = jQuery.css(elem, 'position'), curElem = jQuery(elem), props = {};
                // set position first, in-case top/left are set even on static elem
                if (position === 'static') {
                    elem.style.position = 'relative';
                }
                curOffset = curElem.offset();
                curCSSTop = jQuery.css(elem, 'top');
                curCSSLeft = jQuery.css(elem, 'left');
                calculatePosition = (position === 'absolute' || position === 'fixed') && jQuery.inArray('auto', [
                    curCSSTop,
                    curCSSLeft
                ]) > -1;
                // need to be able to calculate position if either top or left is auto and position is either absolute or fixed
                if (calculatePosition) {
                    curPosition = curElem.position();
                    curTop = curPosition.top;
                    curLeft = curPosition.left;
                } else {
                    curTop = parseFloat(curCSSTop) || 0;
                    curLeft = parseFloat(curCSSLeft) || 0;
                }
                if (jQuery.isFunction(options)) {
                    options = options.call(elem, i, curOffset);
                }
                if (options.top != null) {
                    props.top = options.top - curOffset.top + curTop;
                }
                if (options.left != null) {
                    props.left = options.left - curOffset.left + curLeft;
                }
                if ('using' in options) {
                    options.using.call(elem, props);
                } else {
                    curElem.css(props);
                }
            }
        };
        jQuery.fn.extend({
            offset: function (options) {
                if (arguments.length) {
                    return options === undefined ? this : this.each(function (i) {
                        jQuery.offset.setOffset(this, options, i);
                    });
                }
                var docElem, win, box = {
                        top: 0,
                        left: 0
                    }, elem = this[0], doc = elem && elem.ownerDocument;
                if (!doc) {
                    return;
                }
                docElem = doc.documentElement;
                // Make sure it's not a disconnected DOM node
                if (!jQuery.contains(docElem, elem)) {
                    return box;
                }
                // If we don't have gBCR, just use 0,0 rather than error
                // BlackBerry 5, iOS 3 (original iPhone)
                if (typeof elem.getBoundingClientRect !== strundefined) {
                    box = elem.getBoundingClientRect();
                }
                win = getWindow(doc);
                return {
                    top: box.top + (win.pageYOffset || docElem.scrollTop) - (docElem.clientTop || 0),
                    left: box.left + (win.pageXOffset || docElem.scrollLeft) - (docElem.clientLeft || 0)
                };
            },
            position: function () {
                if (!this[0]) {
                    return;
                }
                var offsetParent, offset, parentOffset = {
                        top: 0,
                        left: 0
                    }, elem = this[0];
                // fixed elements are offset from window (parentOffset = {top:0, left: 0}, because it is its only offset parent
                if (jQuery.css(elem, 'position') === 'fixed') {
                    // we assume that getBoundingClientRect is available when computed position is fixed
                    offset = elem.getBoundingClientRect();
                } else {
                    // Get *real* offsetParent
                    offsetParent = this.offsetParent();
                    // Get correct offsets
                    offset = this.offset();
                    if (!jQuery.nodeName(offsetParent[0], 'html')) {
                        parentOffset = offsetParent.offset();
                    }
                    // Add offsetParent borders
                    parentOffset.top += jQuery.css(offsetParent[0], 'borderTopWidth', true);
                    parentOffset.left += jQuery.css(offsetParent[0], 'borderLeftWidth', true);
                }
                // Subtract parent offsets and element margins
                // note: when an element has margin: auto the offsetLeft and marginLeft
                // are the same in Safari causing offset.left to incorrectly be 0
                return {
                    top: offset.top - parentOffset.top - jQuery.css(elem, 'marginTop', true),
                    left: offset.left - parentOffset.left - jQuery.css(elem, 'marginLeft', true)
                };
            },
            offsetParent: function () {
                return this.map(function () {
                    var offsetParent = this.offsetParent || docElem;
                    while (offsetParent && (!jQuery.nodeName(offsetParent, 'html') && jQuery.css(offsetParent, 'position') === 'static')) {
                        offsetParent = offsetParent.offsetParent;
                    }
                    return offsetParent || docElem;
                });
            }
        });
        // Create scrollLeft and scrollTop methods
        jQuery.each({
            scrollLeft: 'pageXOffset',
            scrollTop: 'pageYOffset'
        }, function (method, prop) {
            var top = /Y/.test(prop);
            jQuery.fn[method] = function (val) {
                return access(this, function (elem, method, val) {
                    var win = getWindow(elem);
                    if (val === undefined) {
                        return win ? prop in win ? win[prop] : win.document.documentElement[method] : elem[method];
                    }
                    if (win) {
                        win.scrollTo(!top ? val : jQuery(win).scrollLeft(), top ? val : jQuery(win).scrollTop());
                    } else {
                        elem[method] = val;
                    }
                }, method, val, arguments.length, null);
            };
        });
        // Add the top/left cssHooks using jQuery.fn.position
        // Webkit bug: https://bugs.webkit.org/show_bug.cgi?id=29084
        // getComputedStyle returns percent when specified for top/left/bottom/right
        // rather than make the css module depend on the offset module, we just check for it here
        jQuery.each([
            'top',
            'left'
        ], function (i, prop) {
            jQuery.cssHooks[prop] = addGetHookIf(support.pixelPosition, function (elem, computed) {
                if (computed) {
                    computed = curCSS(elem, prop);
                    // if curCSS returns percentage, fallback to offset
                    return rnumnonpx.test(computed) ? jQuery(elem).position()[prop] + 'px' : computed;
                }
            });
        });
        // Create innerHeight, innerWidth, height, width, outerHeight and outerWidth methods
        jQuery.each({
            Height: 'height',
            Width: 'width'
        }, function (name, type) {
            jQuery.each({
                padding: 'inner' + name,
                content: type,
                '': 'outer' + name
            }, function (defaultExtra, funcName) {
                // margin is only for outerHeight, outerWidth
                jQuery.fn[funcName] = function (margin, value) {
                    var chainable = arguments.length && (defaultExtra || typeof margin !== 'boolean'), extra = defaultExtra || (margin === true || value === true ? 'margin' : 'border');
                    return access(this, function (elem, type, value) {
                        var doc;
                        if (jQuery.isWindow(elem)) {
                            // As of 5/8/2012 this will yield incorrect results for Mobile Safari, but there
                            // isn't a whole lot we can do. See pull request at this URL for discussion:
                            // https://github.com/jquery/jquery/pull/764
                            return elem.document.documentElement['client' + name];
                        }
                        // Get document width or height
                        if (elem.nodeType === 9) {
                            doc = elem.documentElement;
                            // Either scroll[Width/Height] or offset[Width/Height] or client[Width/Height], whichever is greatest
                            // unfortunately, this causes bug #3838 in IE6/8 only, but there is currently no good, small way to fix it.
                            return Math.max(elem.body['scroll' + name], doc['scroll' + name], elem.body['offset' + name], doc['offset' + name], doc['client' + name]);
                        }
                        return value === undefined ? // Get width or height on the element, requesting but not forcing parseFloat
                        jQuery.css(elem, type, extra) : // Set width or height on the element
                        jQuery.style(elem, type, value, extra);
                    }, type, chainable ? margin : undefined, chainable, null);
                };
            });
        });
        // The number of elements contained in the matched element set
        jQuery.fn.size = function () {
            return this.length;
        };
        jQuery.fn.andSelf = jQuery.fn.addBack;
        // Register as a named AMD module, since jQuery can be concatenated with other
        // files that may use define, but not via a proper concatenation script that
        // understands anonymous AMD modules. A named AMD is safest and most robust
        // way to register. Lowercase jquery is used because AMD module names are
        // derived from file names, and jQuery is normally delivered in a lowercase
        // file name. Do this after creating the global so that if an AMD module wants
        // to call noConflict to hide this version of jQuery, it will work.
        // Note that for maximum portability, libraries that are not jQuery should
        // declare themselves as anonymous modules, and avoid setting a global if an
        // AMD loader is present. jQuery is a special case. For more information, see
        // https://github.com/jrburke/requirejs/wiki/Updating-existing-libraries#wiki-anon
        if (typeof define === 'function' && define.amd) {
            define('jquery', [], function () {
                return jQuery;
            });
        }
        var
            // Map over jQuery in case of overwrite
            _jQuery = window.jQuery,
            // Map over the $ in case of overwrite
            _$ = window.$;
        jQuery.noConflict = function (deep) {
            if (window.$ === jQuery) {
                window.$ = _$;
            }
            if (deep && window.jQuery === jQuery) {
                window.jQuery = _jQuery;
            }
            return jQuery;
        };
        // Expose jQuery and $ identifiers, even in
        // AMD (#7102#comment:10, https://github.com/jquery/jquery/pull/557)
        // and CommonJS for browser emulators (#13566)
        if (typeof noGlobal === strundefined) {
            window.jQuery = window.$ = jQuery;
        }
        return jQuery;
    }));
    return jQuery;
});
//     Backbone.js 1.1.2
//     (c) 2010-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org
(function (root, factory) {
    // Set up Backbone appropriately for the environment. Start with AMD.
    if (typeof define === 'function' && define.amd) {
        define('Backbone', [
            'underscore',
            'jQuery',
            'exports'
        ], function (_, $, exports) {
            // Export global even in AMD case in case this script is loaded with
            // others that may still expect a global Backbone.
            root.Backbone = factory(root, exports, _, $);
        });    // Next for Node.js or CommonJS. jQuery may not be needed as a module.
    } else if (typeof exports !== 'undefined') {
        var _ = require('underscore');
        factory(root, exports, _);    // Finally, as a browser global.
    } else {
        root.Backbone = factory(root, {}, root._, root.jQuery || root.Zepto || root.ender || root.$);
    }
}(this, function (root, Backbone, _, $) {
    // Initial Setup
    // -------------
    // Save the previous value of the `Backbone` variable, so that it can be
    // restored later on, if `noConflict` is used.
    var previousBackbone = root.Backbone;
    // Create local references to array methods we'll want to use later.
    var array = [];
    var push = array.push;
    var slice = array.slice;
    var splice = array.splice;
    // Current version of the library. Keep in sync with `package.json`.
    Backbone.VERSION = '1.1.2';
    // For Backbone's purposes, jQuery, Zepto, Ender, or My Library (kidding) owns
    // the `$` variable.
    Backbone.$ = $;
    // Runs Backbone.js in *noConflict* mode, returning the `Backbone` variable
    // to its previous owner. Returns a reference to this Backbone object.
    Backbone.noConflict = function () {
        root.Backbone = previousBackbone;
        return this;
    };
    // Turn on `emulateHTTP` to support legacy HTTP servers. Setting this option
    // will fake `"PATCH"`, `"PUT"` and `"DELETE"` requests via the `_method` parameter and
    // set a `X-Http-Method-Override` header.
    Backbone.emulateHTTP = false;
    // Turn on `emulateJSON` to support legacy servers that can't deal with direct
    // `application/json` requests ... will encode the body as
    // `application/x-www-form-urlencoded` instead and will send the model in a
    // form param named `model`.
    Backbone.emulateJSON = false;
    // Backbone.Events
    // ---------------
    // A module that can be mixed in to *any object* in order to provide it with
    // custom events. You may bind with `on` or remove with `off` callback
    // functions to an event; `trigger`-ing an event fires all callbacks in
    // succession.
    //
    //     var object = {};
    //     _.extend(object, Backbone.Events);
    //     object.on('expand', function(){ alert('expanded'); });
    //     object.trigger('expand');
    //
    var Events = Backbone.Events = {
        // Bind an event to a `callback` function. Passing `"all"` will bind
        // the callback to all events fired.
        on: function (name, callback, context) {
            if (!eventsApi(this, 'on', name, [
                    callback,
                    context
                ]) || !callback)
                return this;
            this._events || (this._events = {});
            var events = this._events[name] || (this._events[name] = []);
            events.push({
                callback: callback,
                context: context,
                ctx: context || this
            });
            return this;
        },
        // Bind an event to only be triggered a single time. After the first time
        // the callback is invoked, it will be removed.
        once: function (name, callback, context) {
            if (!eventsApi(this, 'once', name, [
                    callback,
                    context
                ]) || !callback)
                return this;
            var self = this;
            var once = _.once(function () {
                self.off(name, once);
                callback.apply(this, arguments);
            });
            once._callback = callback;
            return this.on(name, once, context);
        },
        // Remove one or many callbacks. If `context` is null, removes all
        // callbacks with that function. If `callback` is null, removes all
        // callbacks for the event. If `name` is null, removes all bound
        // callbacks for all events.
        off: function (name, callback, context) {
            var retain, ev, events, names, i, l, j, k;
            if (!this._events || !eventsApi(this, 'off', name, [
                    callback,
                    context
                ]))
                return this;
            if (!name && !callback && !context) {
                this._events = void 0;
                return this;
            }
            names = name ? [name] : _.keys(this._events);
            for (i = 0, l = names.length; i < l; i++) {
                name = names[i];
                if (events = this._events[name]) {
                    this._events[name] = retain = [];
                    if (callback || context) {
                        for (j = 0, k = events.length; j < k; j++) {
                            ev = events[j];
                            if (callback && callback !== ev.callback && callback !== ev.callback._callback || context && context !== ev.context) {
                                retain.push(ev);
                            }
                        }
                    }
                    if (!retain.length)
                        delete this._events[name];
                }
            }
            return this;
        },
        // Trigger one or many events, firing all bound callbacks. Callbacks are
        // passed the same arguments as `trigger` is, apart from the event name
        // (unless you're listening on `"all"`, which will cause your callback to
        // receive the true name of the event as the first argument).
        trigger: function (name) {
            if (!this._events)
                return this;
            var args = slice.call(arguments, 1);
            if (!eventsApi(this, 'trigger', name, args))
                return this;
            var events = this._events[name];
            var allEvents = this._events.all;
            if (events)
                triggerEvents(events, args);
            if (allEvents)
                triggerEvents(allEvents, arguments);
            return this;
        },
        // Tell this object to stop listening to either specific events ... or
        // to every object it's currently listening to.
        stopListening: function (obj, name, callback) {
            var listeningTo = this._listeningTo;
            if (!listeningTo)
                return this;
            var remove = !name && !callback;
            if (!callback && typeof name === 'object')
                callback = this;
            if (obj)
                (listeningTo = {})[obj._listenId] = obj;
            for (var id in listeningTo) {
                obj = listeningTo[id];
                obj.off(name, callback, this);
                if (remove || _.isEmpty(obj._events))
                    delete this._listeningTo[id];
            }
            return this;
        }
    };
    // Regular expression used to split event strings.
    var eventSplitter = /\s+/;
    // Implement fancy features of the Events API such as multiple event
    // names `"change blur"` and jQuery-style event maps `{change: action}`
    // in terms of the existing API.
    var eventsApi = function (obj, action, name, rest) {
        if (!name)
            return true;
        // Handle event maps.
        if (typeof name === 'object') {
            for (var key in name) {
                obj[action].apply(obj, [
                    key,
                    name[key]
                ].concat(rest));
            }
            return false;
        }
        // Handle space separated event names.
        if (eventSplitter.test(name)) {
            var names = name.split(eventSplitter);
            for (var i = 0, l = names.length; i < l; i++) {
                obj[action].apply(obj, [names[i]].concat(rest));
            }
            return false;
        }
        return true;
    };
    // A difficult-to-believe, but optimized internal dispatch function for
    // triggering events. Tries to keep the usual cases speedy (most internal
    // Backbone events have 3 arguments).
    var triggerEvents = function (events, args) {
        var ev, i = -1, l = events.length, a1 = args[0], a2 = args[1], a3 = args[2];
        switch (args.length) {
        case 0:
            while (++i < l)
                (ev = events[i]).callback.call(ev.ctx);
            return;
        case 1:
            while (++i < l)
                (ev = events[i]).callback.call(ev.ctx, a1);
            return;
        case 2:
            while (++i < l)
                (ev = events[i]).callback.call(ev.ctx, a1, a2);
            return;
        case 3:
            while (++i < l)
                (ev = events[i]).callback.call(ev.ctx, a1, a2, a3);
            return;
        default:
            while (++i < l)
                (ev = events[i]).callback.apply(ev.ctx, args);
            return;
        }
    };
    var listenMethods = {
        listenTo: 'on',
        listenToOnce: 'once'
    };
    // Inversion-of-control versions of `on` and `once`. Tell *this* object to
    // listen to an event in another object ... keeping track of what it's
    // listening to.
    _.each(listenMethods, function (implementation, method) {
        Events[method] = function (obj, name, callback) {
            var listeningTo = this._listeningTo || (this._listeningTo = {});
            var id = obj._listenId || (obj._listenId = _.uniqueId('l'));
            listeningTo[id] = obj;
            if (!callback && typeof name === 'object')
                callback = this;
            obj[implementation](name, callback, this);
            return this;
        };
    });
    // Aliases for backwards compatibility.
    Events.bind = Events.on;
    Events.unbind = Events.off;
    // Allow the `Backbone` object to serve as a global event bus, for folks who
    // want global "pubsub" in a convenient place.
    _.extend(Backbone, Events);
    // Backbone.Model
    // --------------
    // Backbone **Models** are the basic data object in the framework --
    // frequently representing a row in a table in a database on your server.
    // A discrete chunk of data and a bunch of useful, related methods for
    // performing computations and transformations on that data.
    // Create a new model with the specified attributes. A client id (`cid`)
    // is automatically generated and assigned for you.
    var Model = Backbone.Model = function (attributes, options) {
        var attrs = attributes || {};
        options || (options = {});
        this.cid = _.uniqueId('c');
        this.attributes = {};
        if (options.collection)
            this.collection = options.collection;
        if (options.parse)
            attrs = this.parse(attrs, options) || {};
        attrs = _.defaults({}, attrs, _.result(this, 'defaults'));
        this.set(attrs, options);
        this.changed = {};
        this.initialize.apply(this, arguments);
    };
    // Attach all inheritable methods to the Model prototype.
    _.extend(Model.prototype, Events, {
        // A hash of attributes whose current and previous value differ.
        changed: null,
        // The value returned during the last failed validation.
        validationError: null,
        // The default name for the JSON `id` attribute is `"id"`. MongoDB and
        // CouchDB users may want to set this to `"_id"`.
        idAttribute: 'id',
        // Initialize is an empty function by default. Override it with your own
        // initialization logic.
        initialize: function () {
        },
        // Return a copy of the model's `attributes` object.
        toJSON: function (options) {
            return _.clone(this.attributes);
        },
        // Proxy `Backbone.sync` by default -- but override this if you need
        // custom syncing semantics for *this* particular model.
        sync: function () {
            return Backbone.sync.apply(this, arguments);
        },
        // Get the value of an attribute.
        get: function (attr) {
            return this.attributes[attr];
        },
        // Get the HTML-escaped value of an attribute.
        escape: function (attr) {
            return _.escape(this.get(attr));
        },
        // Returns `true` if the attribute contains a value that is not null
        // or undefined.
        has: function (attr) {
            return this.get(attr) != null;
        },
        // Set a hash of model attributes on the object, firing `"change"`. This is
        // the core primitive operation of a model, updating the data and notifying
        // anyone who needs to know about the change in state. The heart of the beast.
        set: function (key, val, options) {
            var attr, attrs, unset, changes, silent, changing, prev, current;
            if (key == null)
                return this;
            // Handle both `"key", value` and `{key: value}` -style arguments.
            if (typeof key === 'object') {
                attrs = key;
                options = val;
            } else {
                (attrs = {})[key] = val;
            }
            options || (options = {});
            // Run validation.
            if (!this._validate(attrs, options))
                return false;
            // Extract attributes and options.
            unset = options.unset;
            silent = options.silent;
            changes = [];
            changing = this._changing;
            this._changing = true;
            if (!changing) {
                this._previousAttributes = _.clone(this.attributes);
                this.changed = {};
            }
            current = this.attributes, prev = this._previousAttributes;
            // Check for changes of `id`.
            if (this.idAttribute in attrs)
                this.id = attrs[this.idAttribute];
            // For each `set` attribute, update or delete the current value.
            for (attr in attrs) {
                val = attrs[attr];
                if (!_.isEqual(current[attr], val))
                    changes.push(attr);
                if (!_.isEqual(prev[attr], val)) {
                    this.changed[attr] = val;
                } else {
                    delete this.changed[attr];
                }
                unset ? delete current[attr] : current[attr] = val;
            }
            // Trigger all relevant attribute changes.
            if (!silent) {
                if (changes.length)
                    this._pending = options;
                for (var i = 0, l = changes.length; i < l; i++) {
                    this.trigger('change:' + changes[i], this, current[changes[i]], options);
                }
            }
            // You might be wondering why there's a `while` loop here. Changes can
            // be recursively nested within `"change"` events.
            if (changing)
                return this;
            if (!silent) {
                while (this._pending) {
                    options = this._pending;
                    this._pending = false;
                    this.trigger('change', this, options);
                }
            }
            this._pending = false;
            this._changing = false;
            return this;
        },
        // Remove an attribute from the model, firing `"change"`. `unset` is a noop
        // if the attribute doesn't exist.
        unset: function (attr, options) {
            return this.set(attr, void 0, _.extend({}, options, { unset: true }));
        },
        // Clear all attributes on the model, firing `"change"`.
        clear: function (options) {
            var attrs = {};
            for (var key in this.attributes)
                attrs[key] = void 0;
            return this.set(attrs, _.extend({}, options, { unset: true }));
        },
        // Determine if the model has changed since the last `"change"` event.
        // If you specify an attribute name, determine if that attribute has changed.
        hasChanged: function (attr) {
            if (attr == null)
                return !_.isEmpty(this.changed);
            return _.has(this.changed, attr);
        },
        // Return an object containing all the attributes that have changed, or
        // false if there are no changed attributes. Useful for determining what
        // parts of a view need to be updated and/or what attributes need to be
        // persisted to the server. Unset attributes will be set to undefined.
        // You can also pass an attributes object to diff against the model,
        // determining if there *would be* a change.
        changedAttributes: function (diff) {
            if (!diff)
                return this.hasChanged() ? _.clone(this.changed) : false;
            var val, changed = false;
            var old = this._changing ? this._previousAttributes : this.attributes;
            for (var attr in diff) {
                if (_.isEqual(old[attr], val = diff[attr]))
                    continue;
                (changed || (changed = {}))[attr] = val;
            }
            return changed;
        },
        // Get the previous value of an attribute, recorded at the time the last
        // `"change"` event was fired.
        previous: function (attr) {
            if (attr == null || !this._previousAttributes)
                return null;
            return this._previousAttributes[attr];
        },
        // Get all of the attributes of the model at the time of the previous
        // `"change"` event.
        previousAttributes: function () {
            return _.clone(this._previousAttributes);
        },
        // Fetch the model from the server. If the server's representation of the
        // model differs from its current attributes, they will be overridden,
        // triggering a `"change"` event.
        fetch: function (options) {
            options = options ? _.clone(options) : {};
            if (options.parse === void 0)
                options.parse = true;
            var model = this;
            var success = options.success;
            options.success = function (resp) {
                if (!model.set(model.parse(resp, options), options))
                    return false;
                if (success)
                    success(model, resp, options);
                model.trigger('sync', model, resp, options);
            };
            wrapError(this, options);
            return this.sync('read', this, options);
        },
        // Set a hash of model attributes, and sync the model to the server.
        // If the server returns an attributes hash that differs, the model's
        // state will be `set` again.
        save: function (key, val, options) {
            var attrs, method, xhr, attributes = this.attributes;
            // Handle both `"key", value` and `{key: value}` -style arguments.
            if (key == null || typeof key === 'object') {
                attrs = key;
                options = val;
            } else {
                (attrs = {})[key] = val;
            }
            options = _.extend({ validate: true }, options);
            // If we're not waiting and attributes exist, save acts as
            // `set(attr).save(null, opts)` with validation. Otherwise, check if
            // the model will be valid when the attributes, if any, are set.
            if (attrs && !options.wait) {
                if (!this.set(attrs, options))
                    return false;
            } else {
                if (!this._validate(attrs, options))
                    return false;
            }
            // Set temporary attributes if `{wait: true}`.
            if (attrs && options.wait) {
                this.attributes = _.extend({}, attributes, attrs);
            }
            // After a successful server-side save, the client is (optionally)
            // updated with the server-side state.
            if (options.parse === void 0)
                options.parse = true;
            var model = this;
            var success = options.success;
            options.success = function (resp) {
                // Ensure attributes are restored during synchronous saves.
                model.attributes = attributes;
                var serverAttrs = model.parse(resp, options);
                if (options.wait)
                    serverAttrs = _.extend(attrs || {}, serverAttrs);
                if (_.isObject(serverAttrs) && !model.set(serverAttrs, options)) {
                    return false;
                }
                if (success)
                    success(model, resp, options);
                model.trigger('sync', model, resp, options);
            };
            wrapError(this, options);
            method = this.isNew() ? 'create' : options.patch ? 'patch' : 'update';
            if (method === 'patch')
                options.attrs = attrs;
            xhr = this.sync(method, this, options);
            // Restore attributes.
            if (attrs && options.wait)
                this.attributes = attributes;
            return xhr;
        },
        // Destroy this model on the server if it was already persisted.
        // Optimistically removes the model from its collection, if it has one.
        // If `wait: true` is passed, waits for the server to respond before removal.
        destroy: function (options) {
            options = options ? _.clone(options) : {};
            var model = this;
            var success = options.success;
            var destroy = function () {
                model.trigger('destroy', model, model.collection, options);
            };
            options.success = function (resp) {
                if (options.wait || model.isNew())
                    destroy();
                if (success)
                    success(model, resp, options);
                if (!model.isNew())
                    model.trigger('sync', model, resp, options);
            };
            if (this.isNew()) {
                options.success();
                return false;
            }
            wrapError(this, options);
            var xhr = this.sync('delete', this, options);
            if (!options.wait)
                destroy();
            return xhr;
        },
        // Default URL for the model's representation on the server -- if you're
        // using Backbone's restful methods, override this to change the endpoint
        // that will be called.
        url: function () {
            var base = _.result(this, 'urlRoot') || _.result(this.collection, 'url') || urlError();
            if (this.isNew())
                return base;
            return base.replace(/([^\/])$/, '$1/') + encodeURIComponent(this.id);
        },
        // **parse** converts a response into the hash of attributes to be `set` on
        // the model. The default implementation is just to pass the response along.
        parse: function (resp, options) {
            return resp;
        },
        // Create a new model with identical attributes to this one.
        clone: function () {
            return new this.constructor(this.attributes);
        },
        // A model is new if it has never been saved to the server, and lacks an id.
        isNew: function () {
            return !this.has(this.idAttribute);
        },
        // Check if the model is currently in a valid state.
        isValid: function (options) {
            return this._validate({}, _.extend(options || {}, { validate: true }));
        },
        // Run validation against the next complete set of model attributes,
        // returning `true` if all is well. Otherwise, fire an `"invalid"` event.
        _validate: function (attrs, options) {
            if (!options.validate || !this.validate)
                return true;
            attrs = _.extend({}, this.attributes, attrs);
            var error = this.validationError = this.validate(attrs, options) || null;
            if (!error)
                return true;
            this.trigger('invalid', this, error, _.extend(options, { validationError: error }));
            return false;
        }
    });
    // Underscore methods that we want to implement on the Model.
    var modelMethods = [
        'keys',
        'values',
        'pairs',
        'invert',
        'pick',
        'omit'
    ];
    // Mix in each Underscore method as a proxy to `Model#attributes`.
    _.each(modelMethods, function (method) {
        Model.prototype[method] = function () {
            var args = slice.call(arguments);
            args.unshift(this.attributes);
            return _[method].apply(_, args);
        };
    });
    // Backbone.Collection
    // -------------------
    // If models tend to represent a single row of data, a Backbone Collection is
    // more analagous to a table full of data ... or a small slice or page of that
    // table, or a collection of rows that belong together for a particular reason
    // -- all of the messages in this particular folder, all of the documents
    // belonging to this particular author, and so on. Collections maintain
    // indexes of their models, both in order, and for lookup by `id`.
    // Create a new **Collection**, perhaps to contain a specific type of `model`.
    // If a `comparator` is specified, the Collection will maintain
    // its models in sort order, as they're added and removed.
    var Collection = Backbone.Collection = function (models, options) {
        options || (options = {});
        if (options.model)
            this.model = options.model;
        if (options.comparator !== void 0)
            this.comparator = options.comparator;
        this._reset();
        this.initialize.apply(this, arguments);
        if (models)
            this.reset(models, _.extend({ silent: true }, options));
    };
    // Default options for `Collection#set`.
    var setOptions = {
        add: true,
        remove: true,
        merge: true
    };
    var addOptions = {
        add: true,
        remove: false
    };
    // Define the Collection's inheritable methods.
    _.extend(Collection.prototype, Events, {
        // The default model for a collection is just a **Backbone.Model**.
        // This should be overridden in most cases.
        model: Model,
        // Initialize is an empty function by default. Override it with your own
        // initialization logic.
        initialize: function () {
        },
        // The JSON representation of a Collection is an array of the
        // models' attributes.
        toJSON: function (options) {
            return this.map(function (model) {
                return model.toJSON(options);
            });
        },
        // Proxy `Backbone.sync` by default.
        sync: function () {
            return Backbone.sync.apply(this, arguments);
        },
        // Add a model, or list of models to the set.
        add: function (models, options) {
            return this.set(models, _.extend({ merge: false }, options, addOptions));
        },
        // Remove a model, or a list of models from the set.
        remove: function (models, options) {
            var singular = !_.isArray(models);
            models = singular ? [models] : _.clone(models);
            options || (options = {});
            var i, l, index, model;
            for (i = 0, l = models.length; i < l; i++) {
                model = models[i] = this.get(models[i]);
                if (!model)
                    continue;
                delete this._byId[model.id];
                delete this._byId[model.cid];
                index = this.indexOf(model);
                this.models.splice(index, 1);
                this.length--;
                if (!options.silent) {
                    options.index = index;
                    model.trigger('remove', model, this, options);
                }
                this._removeReference(model, options);
            }
            return singular ? models[0] : models;
        },
        // Update a collection by `set`-ing a new list of models, adding new ones,
        // removing models that are no longer present, and merging models that
        // already exist in the collection, as necessary. Similar to **Model#set**,
        // the core operation for updating the data contained by the collection.
        set: function (models, options) {
            options = _.defaults({}, options, setOptions);
            if (options.parse)
                models = this.parse(models, options);
            var singular = !_.isArray(models);
            models = singular ? models ? [models] : [] : _.clone(models);
            var i, l, id, model, attrs, existing, sort;
            var at = options.at;
            var targetModel = this.model;
            var sortable = this.comparator && at == null && options.sort !== false;
            var sortAttr = _.isString(this.comparator) ? this.comparator : null;
            var toAdd = [], toRemove = [], modelMap = {};
            var add = options.add, merge = options.merge, remove = options.remove;
            var order = !sortable && add && remove ? [] : false;
            // Turn bare objects into model references, and prevent invalid models
            // from being added.
            for (i = 0, l = models.length; i < l; i++) {
                attrs = models[i] || {};
                if (attrs instanceof Model) {
                    id = model = attrs;
                } else {
                    id = attrs[targetModel.prototype.idAttribute || 'id'];
                }
                // If a duplicate is found, prevent it from being added and
                // optionally merge it into the existing model.
                if (existing = this.get(id)) {
                    if (remove)
                        modelMap[existing.cid] = true;
                    if (merge) {
                        attrs = attrs === model ? model.attributes : attrs;
                        if (options.parse)
                            attrs = existing.parse(attrs, options);
                        existing.set(attrs, options);
                        if (sortable && !sort && existing.hasChanged(sortAttr))
                            sort = true;
                    }
                    models[i] = existing;    // If this is a new, valid model, push it to the `toAdd` list.
                } else if (add) {
                    model = models[i] = this._prepareModel(attrs, options);
                    if (!model)
                        continue;
                    toAdd.push(model);
                    this._addReference(model, options);
                }
                // Do not add multiple models with the same `id`.
                model = existing || model;
                if (order && (model.isNew() || !modelMap[model.id]))
                    order.push(model);
                modelMap[model.id] = true;
            }
            // Remove nonexistent models if appropriate.
            if (remove) {
                for (i = 0, l = this.length; i < l; ++i) {
                    if (!modelMap[(model = this.models[i]).cid])
                        toRemove.push(model);
                }
                if (toRemove.length)
                    this.remove(toRemove, options);
            }
            // See if sorting is needed, update `length` and splice in new models.
            if (toAdd.length || order && order.length) {
                if (sortable)
                    sort = true;
                this.length += toAdd.length;
                if (at != null) {
                    for (i = 0, l = toAdd.length; i < l; i++) {
                        this.models.splice(at + i, 0, toAdd[i]);
                    }
                } else {
                    if (order)
                        this.models.length = 0;
                    var orderedModels = order || toAdd;
                    for (i = 0, l = orderedModels.length; i < l; i++) {
                        this.models.push(orderedModels[i]);
                    }
                }
            }
            // Silently sort the collection if appropriate.
            if (sort)
                this.sort({ silent: true });
            // Unless silenced, it's time to fire all appropriate add/sort events.
            if (!options.silent) {
                for (i = 0, l = toAdd.length; i < l; i++) {
                    (model = toAdd[i]).trigger('add', model, this, options);
                }
                if (sort || order && order.length)
                    this.trigger('sort', this, options);
            }
            // Return the added (or merged) model (or models).
            return singular ? models[0] : models;
        },
        // When you have more items than you want to add or remove individually,
        // you can reset the entire set with a new list of models, without firing
        // any granular `add` or `remove` events. Fires `reset` when finished.
        // Useful for bulk operations and optimizations.
        reset: function (models, options) {
            options || (options = {});
            for (var i = 0, l = this.models.length; i < l; i++) {
                this._removeReference(this.models[i], options);
            }
            options.previousModels = this.models;
            this._reset();
            models = this.add(models, _.extend({ silent: true }, options));
            if (!options.silent)
                this.trigger('reset', this, options);
            return models;
        },
        // Add a model to the end of the collection.
        push: function (model, options) {
            return this.add(model, _.extend({ at: this.length }, options));
        },
        // Remove a model from the end of the collection.
        pop: function (options) {
            var model = this.at(this.length - 1);
            this.remove(model, options);
            return model;
        },
        // Add a model to the beginning of the collection.
        unshift: function (model, options) {
            return this.add(model, _.extend({ at: 0 }, options));
        },
        // Remove a model from the beginning of the collection.
        shift: function (options) {
            var model = this.at(0);
            this.remove(model, options);
            return model;
        },
        // Slice out a sub-array of models from the collection.
        slice: function () {
            return slice.apply(this.models, arguments);
        },
        // Get a model from the set by id.
        get: function (obj) {
            if (obj == null)
                return void 0;
            return this._byId[obj] || this._byId[obj.id] || this._byId[obj.cid];
        },
        // Get the model at the given index.
        at: function (index) {
            return this.models[index];
        },
        // Return models with matching attributes. Useful for simple cases of
        // `filter`.
        where: function (attrs, first) {
            if (_.isEmpty(attrs))
                return first ? void 0 : [];
            return this[first ? 'find' : 'filter'](function (model) {
                for (var key in attrs) {
                    if (attrs[key] !== model.get(key))
                        return false;
                }
                return true;
            });
        },
        // Return the first model with matching attributes. Useful for simple cases
        // of `find`.
        findWhere: function (attrs) {
            return this.where(attrs, true);
        },
        // Force the collection to re-sort itself. You don't need to call this under
        // normal circumstances, as the set will maintain sort order as each item
        // is added.
        sort: function (options) {
            if (!this.comparator)
                throw new Error('Cannot sort a set without a comparator');
            options || (options = {});
            // Run sort based on type of `comparator`.
            if (_.isString(this.comparator) || this.comparator.length === 1) {
                this.models = this.sortBy(this.comparator, this);
            } else {
                this.models.sort(_.bind(this.comparator, this));
            }
            if (!options.silent)
                this.trigger('sort', this, options);
            return this;
        },
        // Pluck an attribute from each model in the collection.
        pluck: function (attr) {
            return _.invoke(this.models, 'get', attr);
        },
        // Fetch the default set of models for this collection, resetting the
        // collection when they arrive. If `reset: true` is passed, the response
        // data will be passed through the `reset` method instead of `set`.
        fetch: function (options) {
            options = options ? _.clone(options) : {};
            if (options.parse === void 0)
                options.parse = true;
            var success = options.success;
            var collection = this;
            options.success = function (resp) {
                var method = options.reset ? 'reset' : 'set';
                collection[method](resp, options);
                if (success)
                    success(collection, resp, options);
                collection.trigger('sync', collection, resp, options);
            };
            wrapError(this, options);
            return this.sync('read', this, options);
        },
        // Create a new instance of a model in this collection. Add the model to the
        // collection immediately, unless `wait: true` is passed, in which case we
        // wait for the server to agree.
        create: function (model, options) {
            options = options ? _.clone(options) : {};
            if (!(model = this._prepareModel(model, options)))
                return false;
            if (!options.wait)
                this.add(model, options);
            var collection = this;
            var success = options.success;
            options.success = function (model, resp) {
                if (options.wait)
                    collection.add(model, options);
                if (success)
                    success(model, resp, options);
            };
            model.save(null, options);
            return model;
        },
        // **parse** converts a response into a list of models to be added to the
        // collection. The default implementation is just to pass it through.
        parse: function (resp, options) {
            return resp;
        },
        // Create a new collection with an identical list of models as this one.
        clone: function () {
            return new this.constructor(this.models);
        },
        // Private method to reset all internal state. Called when the collection
        // is first initialized or reset.
        _reset: function () {
            this.length = 0;
            this.models = [];
            this._byId = {};
        },
        // Prepare a hash of attributes (or other model) to be added to this
        // collection.
        _prepareModel: function (attrs, options) {
            if (attrs instanceof Model)
                return attrs;
            options = options ? _.clone(options) : {};
            options.collection = this;
            var model = new this.model(attrs, options);
            if (!model.validationError)
                return model;
            this.trigger('invalid', this, model.validationError, options);
            return false;
        },
        // Internal method to create a model's ties to a collection.
        _addReference: function (model, options) {
            this._byId[model.cid] = model;
            if (model.id != null)
                this._byId[model.id] = model;
            if (!model.collection)
                model.collection = this;
            model.on('all', this._onModelEvent, this);
        },
        // Internal method to sever a model's ties to a collection.
        _removeReference: function (model, options) {
            if (this === model.collection)
                delete model.collection;
            model.off('all', this._onModelEvent, this);
        },
        // Internal method called every time a model in the set fires an event.
        // Sets need to update their indexes when models change ids. All other
        // events simply proxy through. "add" and "remove" events that originate
        // in other collections are ignored.
        _onModelEvent: function (event, model, collection, options) {
            if ((event === 'add' || event === 'remove') && collection !== this)
                return;
            if (event === 'destroy')
                this.remove(model, options);
            if (model && event === 'change:' + model.idAttribute) {
                delete this._byId[model.previous(model.idAttribute)];
                if (model.id != null)
                    this._byId[model.id] = model;
            }
            this.trigger.apply(this, arguments);
        }
    });
    // Underscore methods that we want to implement on the Collection.
    // 90% of the core usefulness of Backbone Collections is actually implemented
    // right here:
    var methods = [
        'forEach',
        'each',
        'map',
        'collect',
        'reduce',
        'foldl',
        'inject',
        'reduceRight',
        'foldr',
        'find',
        'detect',
        'filter',
        'select',
        'reject',
        'every',
        'all',
        'some',
        'any',
        'include',
        'contains',
        'invoke',
        'max',
        'min',
        'toArray',
        'size',
        'first',
        'head',
        'take',
        'initial',
        'rest',
        'tail',
        'drop',
        'last',
        'without',
        'difference',
        'indexOf',
        'shuffle',
        'lastIndexOf',
        'isEmpty',
        'chain',
        'sample'
    ];
    // Mix in each Underscore method as a proxy to `Collection#models`.
    _.each(methods, function (method) {
        Collection.prototype[method] = function () {
            var args = slice.call(arguments);
            args.unshift(this.models);
            return _[method].apply(_, args);
        };
    });
    // Underscore methods that take a property name as an argument.
    var attributeMethods = [
        'groupBy',
        'countBy',
        'sortBy',
        'indexBy'
    ];
    // Use attributes instead of properties.
    _.each(attributeMethods, function (method) {
        Collection.prototype[method] = function (value, context) {
            var iterator = _.isFunction(value) ? value : function (model) {
                return model.get(value);
            };
            return _[method](this.models, iterator, context);
        };
    });
    // Backbone.View  // -------------
    // Backbone Views are almost more convention than they are actual code. A View
    // is simply a JavaScript object that represents a logical chunk of UI in the
    // DOM. This might be a single item, an entire list, a sidebar or panel, or
    // even the surrounding frame which wraps your whole app. Defining a chunk of
    // UI as a **View** allows you to define your DOM events declaratively, without
    // having to worry about render order ... and makes it easy for the view to
    // react to specific changes in the state of your models.
    // Creating a Backbone.View creates its initial element outside of the DOM,
    // if an existing element is not provided...
    var View = Backbone.View = function (options) {
        this.cid = _.uniqueId('view');
        this._configure(options || {});
        this._ensureElement();
        this.initialize.apply(this, arguments);
        this.delegateEvents();
    };
    // Cached regex to split keys for `delegate`.
    var delegateEventSplitter = /^(\S+)\s*(.*)$/;
    // List of view options to be merged as properties.
    var viewOptions = [
        'model',
        'collection',
        'el',
        'id',
        'attributes',
        'className',
        'tagName',
        'events'
    ];
    // Set up all inheritable **Backbone.View** properties and methods.
    _.extend(View.prototype, Events, {
        // The default `tagName` of a View's element is `"div"`.
        tagName: 'div',
        // jQuery delegate for element lookup, scoped to DOM elements within the
        // current view. This should be preferred to global lookups where possible.
        $: function (selector) {
            return this.$el.find(selector);
        },
        // Initialize is an empty function by default. Override it with your own
        // initialization logic.
        initialize: function () {
        },
        // **render** is the core function that your view should override, in order
        // to populate its element (`this.el`), with the appropriate HTML. The
        // convention is for **render** to always return `this`.
        render: function () {
            return this;
        },
        // Remove this view by taking the element out of the DOM, and removing any
        // applicable Backbone.Events listeners.
        remove: function () {
            this.$el.remove();
            this.stopListening();
            return this;
        },
        // Change the view's element (`this.el` property), including event
        // re-delegation.
        setElement: function (element, delegate) {
            if (this.$el)
                this.undelegateEvents();
            this.$el = element instanceof Backbone.$ ? element : Backbone.$(element);
            this.el = this.$el[0];
            if (delegate !== false)
                this.delegateEvents();
            return this;
        },
        // Set callbacks, where `this.events` is a hash of
        //
        // *{"event selector": "callback"}*
        //
        //     {
        //       'mousedown .title':  'edit',
        //       'click .button':     'save',
        //       'click .open':       function(e) { ... }
        //     }
        //
        // pairs. Callbacks will be bound to the view, with `this` set properly.
        // Uses event delegation for efficiency.
        // Omitting the selector binds the event to `this.el`.
        // This only works for delegate-able events: not `focus`, `blur`, and
        // not `change`, `submit`, and `reset` in Internet Explorer.
        delegateEvents: function (events) {
            if (!(events || (events = _.result(this, 'events'))))
                return this;
            this.undelegateEvents();
            for (var key in events) {
                var method = events[key];
                if (!_.isFunction(method))
                    method = this[events[key]];
                if (!method)
                    continue;
                var match = key.match(delegateEventSplitter);
                var eventName = match[1], selector = match[2];
                method = _.bind(method, this);
                eventName += '.delegateEvents' + this.cid;
                if (selector === '') {
                    this.$el.on(eventName, method);
                } else {
                    this.$el.on(eventName, selector, method);
                }
            }
            return this;
        },
        // Clears all callbacks previously bound to the view with `delegateEvents`.
        // You usually don't need to use this, but may wish to if you have multiple
        // Backbone views attached to the same DOM element.
        undelegateEvents: function () {
            this.$el.off('.delegateEvents' + this.cid);
            return this;
        },
        // Performs the initial configuration of a View with a set of options.
        // Keys with special meaning *(e.g. model, collection, id, className)* are
        // attached directly to the view.  See `viewOptions` for an exhaustive
        // list.
        _configure: function (options) {
            if (this.options)
                options = _.extend({}, _.result(this, 'options'), options);
            _.extend(this, _.pick(options, viewOptions));
            this.options = options;
        },
        // Ensure that the View has a DOM element to render into.
        // If `this.el` is a string, pass it through `$()`, take the first
        // matching element, and re-assign it to `el`. Otherwise, create
        // an element from the `id`, `className` and `tagName` properties.
        _ensureElement: function () {
            if (!this.el) {
                var attrs = _.extend({}, _.result(this, 'attributes'));
                if (this.id)
                    attrs.id = _.result(this, 'id');
                if (this.className)
                    attrs['class'] = _.result(this, 'className');
                var $el = Backbone.$('<' + _.result(this, 'tagName') + '>').attr(attrs);
                this.setElement($el, false);
            } else {
                this.setElement(_.result(this, 'el'), false);
            }
        }
    });
    // Backbone.sync
    // -------------
    // Override this function to change the manner in which Backbone persists
    // models to the server. You will be passed the type of request, and the
    // model in question. By default, makes a RESTful Ajax request
    // to the model's `url()`. Some possible customizations could be:
    //
    // * Use `setTimeout` to batch rapid-fire updates into a single request.
    // * Send up the models as XML instead of JSON.
    // * Persist models via WebSockets instead of Ajax.
    //
    // Turn on `Backbone.emulateHTTP` in order to send `PUT` and `DELETE` requests
    // as `POST`, with a `_method` parameter containing the true HTTP method,
    // as well as all requests with the body as `application/x-www-form-urlencoded`
    // instead of `application/json` with the model in a param named `model`.
    // Useful when interfacing with server-side languages like **PHP** that make
    // it difficult to read the body of `PUT` requests.
    Backbone.sync = function (method, model, options) {
        var type = methodMap[method];
        // Default options, unless specified.
        _.defaults(options || (options = {}), {
            emulateHTTP: Backbone.emulateHTTP,
            emulateJSON: Backbone.emulateJSON
        });
        // Default JSON-request options.
        var params = {
            type: type,
            dataType: 'json'
        };
        // Ensure that we have a URL.
        if (!options.url) {
            params.url = _.result(model, 'url') || urlError();
        }
        // Ensure that we have the appropriate request data.
        if (options.data == null && model && (method === 'create' || method === 'update' || method === 'patch')) {
            params.contentType = 'application/json';
            params.data = JSON.stringify(options.attrs || model.toJSON(options));
        }
        // For older servers, emulate JSON by encoding the request into an HTML-form.
        if (options.emulateJSON) {
            params.contentType = 'application/x-www-form-urlencoded';
            params.data = params.data ? { model: params.data } : {};
        }
        // For older servers, emulate HTTP by mimicking the HTTP method with `_method`
        // And an `X-HTTP-Method-Override` header.
        if (options.emulateHTTP && (type === 'PUT' || type === 'DELETE' || type === 'PATCH')) {
            params.type = 'POST';
            if (options.emulateJSON)
                params.data._method = type;
            var beforeSend = options.beforeSend;
            options.beforeSend = function (xhr) {
                xhr.setRequestHeader('X-HTTP-Method-Override', type);
                if (beforeSend)
                    return beforeSend.apply(this, arguments);
            };
        }
        // Don't process data on a non-GET request.
        if (params.type !== 'GET' && !options.emulateJSON) {
            params.processData = false;
        }
        // If we're sending a `PATCH` request, and we're in an old Internet Explorer
        // that still has ActiveX enabled by default, override jQuery to use that
        // for XHR instead. Remove this line when jQuery supports `PATCH` on IE8.
        if (params.type === 'PATCH' && noXhrPatch) {
            params.xhr = function () {
                return new ActiveXObject('Microsoft.XMLHTTP');
            };
        }
        // Make the request, allowing the user to override any Ajax options.
        var xhr = options.xhr = Backbone.ajax(_.extend(params, options));
        model.trigger('request', model, xhr, options);
        return xhr;
    };
    var noXhrPatch = typeof window !== 'undefined' && !!window.ActiveXObject && !(window.XMLHttpRequest && new XMLHttpRequest().dispatchEvent);
    // Map from CRUD to HTTP for our default `Backbone.sync` implementation.
    var methodMap = {
        'create': 'POST',
        'update': 'PUT',
        'patch': 'PATCH',
        'delete': 'DELETE',
        'read': 'GET'
    };
    // Set the default implementation of `Backbone.ajax` to proxy through to `$`.
    // Override this if you'd like to use a different library.
    Backbone.ajax = function () {
        return Backbone.$.ajax.apply(Backbone.$, arguments);
    };
    // Backbone.Router
    // ---------------
    // Routers map faux-URLs to actions, and fire events when routes are
    // matched. Creating a new one sets its `routes` hash, if not set statically.
    var Router = Backbone.Router = function (options) {
        options || (options = {});
        if (options.routes)
            this.routes = options.routes;
        this._bindRoutes();
        this.initialize.apply(this, arguments);
    };
    // Cached regular expressions for matching named param parts and splatted
    // parts of route strings.
    var optionalParam = /\((.*?)\)/g;
    var namedParam = /(\(\?)?:\w+/g;
    var splatParam = /\*\w+/g;
    var escapeRegExp = /[\-{}\[\]+?.,\\\^$|#\s]/g;
    // Set up all inheritable **Backbone.Router** properties and methods.
    _.extend(Router.prototype, Events, {
        // Initialize is an empty function by default. Override it with your own
        // initialization logic.
        initialize: function () {
        },
        // Manually bind a single named route to a callback. For example:
        //
        //     this.route('search/:query/p:num', 'search', function(query, num) {
        //       ...
        //     });
        //
        route: function (route, name, callback) {
            if (!_.isRegExp(route))
                route = this._routeToRegExp(route);
            if (_.isFunction(name)) {
                callback = name;
                name = '';
            }
            if (!callback)
                callback = this[name];
            var router = this;
            Backbone.history.route(route, function (fragment) {
                var args = router._extractParameters(route, fragment);
                router.execute(callback, args);
                router.trigger.apply(router, ['route:' + name].concat(args));
                router.trigger('route', name, args);
                Backbone.history.trigger('route', router, name, args);
            });
            return this;
        },
        // Execute a route handler with the provided parameters.  This is an
        // excellent place to do pre-route setup or post-route cleanup.
        execute: function (callback, args) {
            if (callback)
                callback.apply(this, args);
        },
        // Simple proxy to `Backbone.history` to save a fragment into the history.
        navigate: function (fragment, options) {
            Backbone.history.navigate(fragment, options);
            return this;
        },
        // Bind all defined routes to `Backbone.history`. We have to reverse the
        // order of the routes here to support behavior where the most general
        // routes can be defined at the bottom of the route map.
        _bindRoutes: function () {
            if (!this.routes)
                return;
            this.routes = _.result(this, 'routes');
            var route, routes = _.keys(this.routes);
            while ((route = routes.pop()) != null) {
                this.route(route, this.routes[route]);
            }
        },
        // Convert a route string into a regular expression, suitable for matching
        // against the current location hash.
        _routeToRegExp: function (route) {
            route = route.replace(escapeRegExp, '\\$&').replace(optionalParam, '(?:$1)?').replace(namedParam, function (match, optional) {
                return optional ? match : '([^/?]+)';
            }).replace(splatParam, '([^?]*?)');
            return new RegExp('^' + route + '(?:\\?([\\s\\S]*))?$');
        },
        // Given a route, and a URL fragment that it matches, return the array of
        // extracted decoded parameters. Empty or unmatched parameters will be
        // treated as `null` to normalize cross-browser behavior.
        _extractParameters: function (route, fragment) {
            var params = route.exec(fragment).slice(1);
            return _.map(params, function (param, i) {
                // Don't decode the search params.
                if (i === params.length - 1)
                    return param || null;
                return param ? decodeURIComponent(param) : null;
            });
        }
    });
    // Backbone.History
    // ----------------
    // Handles cross-browser history management, based on either
    // [pushState](http://diveintohtml5.info/history.html) and real URLs, or
    // [onhashchange](https://developer.mozilla.org/en-US/docs/DOM/window.onhashchange)
    // and URL fragments. If the browser supports neither (old IE, natch),
    // falls back to polling.
    var History = Backbone.History = function () {
        this.handlers = [];
        _.bindAll(this, 'checkUrl');
        // Ensure that `History` can be used outside of the browser.
        if (typeof window !== 'undefined') {
            this.location = window.location;
            this.history = window.history;
        }
    };
    // Cached regex for stripping a leading hash/slash and trailing space.
    var routeStripper = /^[#\/]|\s+$/g;
    // Cached regex for stripping leading and trailing slashes.
    var rootStripper = /^\/+|\/+$/g;
    // Cached regex for detecting MSIE.
    var isExplorer = /msie [\w.]+/;
    // Cached regex for removing a trailing slash.
    var trailingSlash = /\/$/;
    // Cached regex for stripping urls of hash.
    var pathStripper = /#.*$/;
    // Has the history handling already been started?
    History.started = false;
    // Set up all inheritable **Backbone.History** properties and methods.
    _.extend(History.prototype, Events, {
        // The default interval to poll for hash changes, if necessary, is
        // twenty times a second.
        interval: 50,
        // Are we at the app root?
        atRoot: function () {
            return this.location.pathname.replace(/[^\/]$/, '$&/') === this.root;
        },
        // Gets the true hash value. Cannot use location.hash directly due to bug
        // in Firefox where location.hash will always be decoded.
        getHash: function (window) {
            var match = (window || this).location.href.match(/#(.*)$/);
            return match ? match[1] : '';
        },
        // Get the cross-browser normalized URL fragment, either from the URL,
        // the hash, or the override.
        getFragment: function (fragment, forcePushState) {
            if (fragment == null) {
                if (this._hasPushState || !this._wantsHashChange || forcePushState) {
                    fragment = decodeURI(this.location.pathname + this.location.search);
                    var root = this.root.replace(trailingSlash, '');
                    if (!fragment.indexOf(root))
                        fragment = fragment.slice(root.length);
                } else {
                    fragment = this.getHash();
                }
            }
            return fragment.replace(routeStripper, '');
        },
        // Start the hash change handling, returning `true` if the current URL matches
        // an existing route, and `false` otherwise.
        start: function (options) {
            if (History.started)
                throw new Error('Backbone.history has already been started');
            History.started = true;
            // Figure out the initial configuration. Do we need an iframe?
            // Is pushState desired ... is it available?
            this.options = _.extend({ root: '/' }, this.options, options);
            this.root = this.options.root;
            this._wantsHashChange = this.options.hashChange !== false;
            this._wantsPushState = !!this.options.pushState;
            this._hasPushState = !!(this.options.pushState && this.history && this.history.pushState);
            var fragment = this.getFragment();
            var docMode = document.documentMode;
            var oldIE = isExplorer.exec(navigator.userAgent.toLowerCase()) && (!docMode || docMode <= 7);
            // Normalize root to always include a leading and trailing slash.
            this.root = ('/' + this.root + '/').replace(rootStripper, '/');
            if (oldIE && this._wantsHashChange) {
                var frame = Backbone.$('<iframe src="javascript:0" tabindex="-1">');
                this.iframe = frame.hide().appendTo('body')[0].contentWindow;
                this.navigate(fragment);
            }
            // Depending on whether we're using pushState or hashes, and whether
            // 'onhashchange' is supported, determine how we check the URL state.
            if (this._hasPushState) {
                Backbone.$(window).on('popstate', this.checkUrl);
            } else if (this._wantsHashChange && 'onhashchange' in window && !oldIE) {
                Backbone.$(window).on('hashchange', this.checkUrl);
            } else if (this._wantsHashChange) {
                this._checkUrlInterval = setInterval(this.checkUrl, this.interval);
            }
            // Determine if we need to change the base url, for a pushState link
            // opened by a non-pushState browser.
            this.fragment = fragment;
            var loc = this.location;
            // Transition from hashChange to pushState or vice versa if both are
            // requested.
            if (this._wantsHashChange && this._wantsPushState) {
                // If we've started off with a route from a `pushState`-enabled
                // browser, but we're currently in a browser that doesn't support it...
                if (!this._hasPushState && !this.atRoot()) {
                    this.fragment = this.getFragment(null, true);
                    this.location.replace(this.root + '#' + this.fragment);
                    // Return immediately as browser will do redirect to new url
                    return true;    // Or if we've started out with a hash-based route, but we're currently
                                    // in a browser where it could be `pushState`-based instead...
                } else if (this._hasPushState && this.atRoot() && loc.hash) {
                    this.fragment = this.getHash().replace(routeStripper, '');
                    this.history.replaceState({}, document.title, this.root + this.fragment);
                }
            }
            if (!this.options.silent)
                return this.loadUrl();
        },
        // Disable Backbone.history, perhaps temporarily. Not useful in a real app,
        // but possibly useful for unit testing Routers.
        stop: function () {
            Backbone.$(window).off('popstate', this.checkUrl).off('hashchange', this.checkUrl);
            if (this._checkUrlInterval)
                clearInterval(this._checkUrlInterval);
            History.started = false;
        },
        // Add a route to be tested when the fragment changes. Routes added later
        // may override previous routes.
        route: function (route, callback) {
            this.handlers.unshift({
                route: route,
                callback: callback
            });
        },
        // Checks the current URL to see if it has changed, and if it has,
        // calls `loadUrl`, normalizing across the hidden iframe.
        checkUrl: function (e) {
            var current = this.getFragment();
            if (current === this.fragment && this.iframe) {
                current = this.getFragment(this.getHash(this.iframe));
            }
            if (current === this.fragment)
                return false;
            if (this.iframe)
                this.navigate(current);
            this.loadUrl();
        },
        // Attempt to load the current URL fragment. If a route succeeds with a
        // match, returns `true`. If no defined routes matches the fragment,
        // returns `false`.
        loadUrl: function (fragment) {
            fragment = this.fragment = this.getFragment(fragment);
            return _.any(this.handlers, function (handler) {
                if (handler.route.test(fragment)) {
                    handler.callback(fragment);
                    return true;
                }
            });
        },
        // Save a fragment into the hash history, or replace the URL state if the
        // 'replace' option is passed. You are responsible for properly URL-encoding
        // the fragment in advance.
        //
        // The options object can contain `trigger: true` if you wish to have the
        // route callback be fired (not usually desirable), or `replace: true`, if
        // you wish to modify the current URL without adding an entry to the history.
        navigate: function (fragment, options) {
            if (!History.started)
                return false;
            if (!options || options === true)
                options = { trigger: !!options };
            var url = this.root + (fragment = this.getFragment(fragment || ''));
            // Strip the hash for matching.
            fragment = fragment.replace(pathStripper, '');
            if (this.fragment === fragment)
                return;
            this.fragment = fragment;
            // Don't include a trailing slash on the root.
            if (fragment === '' && url !== '/')
                url = url.slice(0, -1);
            // If pushState is available, we use it to set the fragment as a real URL.
            if (this._hasPushState) {
                this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);    // If hash changes haven't been explicitly disabled, update the hash
                                                                                                          // fragment to store history.
            } else if (this._wantsHashChange) {
                this._updateHash(this.location, fragment, options.replace);
                if (this.iframe && fragment !== this.getFragment(this.getHash(this.iframe))) {
                    // Opening and closing the iframe tricks IE7 and earlier to push a
                    // history entry on hash-tag change.  When replace is true, we don't
                    // want this.
                    if (!options.replace)
                        this.iframe.document.open().close();
                    this._updateHash(this.iframe.location, fragment, options.replace);
                }    // If you've told us that you explicitly don't want fallback hashchange-
                     // based history, then `navigate` becomes a page refresh.
            } else {
                return this.location.assign(url);
            }
            if (options.trigger)
                return this.loadUrl(fragment);
        },
        // Update the hash location, either replacing the current entry, or adding
        // a new one to the browser history.
        _updateHash: function (location, fragment, replace) {
            if (replace) {
                var href = location.href.replace(/(javascript:|#).*$/, '');
                location.replace(href + '#' + fragment);
            } else {
                // Some browsers require that `hash` contains a leading #.
                location.hash = '#' + fragment;
            }
        }
    });
    // Create the default Backbone.history.
    Backbone.history = new History();
    // Helpers
    // -------
    // Helper function to correctly set up the prototype chain, for subclasses.
    // Similar to `goog.inherits`, but uses a hash of prototype properties and
    // class properties to be extended.
    var extend = function (protoProps, staticProps) {
        var parent = this;
        var child;
        // The constructor function for the new subclass is either defined by you
        // (the "constructor" property in your `extend` definition), or defaulted
        // by us to simply call the parent's constructor.
        if (protoProps && _.has(protoProps, 'constructor')) {
            child = protoProps.constructor;
        } else {
            child = function () {
                return parent.apply(this, arguments);
            };
        }
        // Add static properties to the constructor function, if supplied.
        _.extend(child, parent, staticProps);
        // Set the prototype chain to inherit from `parent`, without calling
        // `parent`'s constructor function.
        var Surrogate = function () {
            this.constructor = child;
        };
        Surrogate.prototype = parent.prototype;
        child.prototype = new Surrogate();
        // Add prototype properties (instance properties) to the subclass,
        // if supplied.
        if (protoProps)
            _.extend(child.prototype, protoProps);
        // Set a convenience property in case the parent's prototype is needed
        // later.
        child.__super__ = parent.prototype;
        return child;
    };
    // Set up inheritance for the model, collection, router, view and history.
    Model.extend = Collection.extend = Router.extend = View.extend = History.extend = extend;
    // Throw an error when a URL is needed, and none is supplied.
    var urlError = function () {
        throw new Error('A "url" property or function must be specified');
    };
    // Wrap an optional error callback with a fallback error event.
    var wrapError = function (model, options) {
        var error = options.error;
        options.error = function (resp) {
            if (error)
                error(model, resp, options);
            model.trigger('error', model, resp, options);
        };
    };
    return Backbone;
}));

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module GlobalViews
define('GlobalViews.Message.View', [
    'global_views_message.tpl',
    'Backbone',
    'underscore'
], function (global_views_message_tpl, Backbone, _) {
    'use strict';
    // @class GlobalViews.Message.View @extends Backbone.View
    return Backbone.View.extend({
        template: global_views_message_tpl    // @method initialize
                                    // @param {GlobalViews.Message.View.InitializeOptions} options
                                    // @return {Void}
,
        event: { 'click [data-action="close-message"]': 'closeMessage' },
        show: function show($placeholder, time) {
            $placeholder.empty();
            this.render();
            $placeholder.html(this.$el).show();
            if (time && time > 0) {
                setTimeout(function () {
                    $placeholder.fadeOut(function () {
                        $placeholder.empty();
                    });
                }, time);
            }
        },
        closeMessage: function closeMessage(e) {
            return _.isFunction(this.options.closeMessageHandler) && this.options.closeMessageHandler(e);
        },
        childViews: {
            'global-views-message-childview-message': function () {
                return this.options.childView;
            }
        }    // @method getContext
             // @return {GlobalViews.Message.View.Context}
,
        getContext: function getContext() {
            var has_error_code = !!this.options.message.errorCode, message = has_error_code ? this.options.message.message : this.options.message, errorCode = this.options.message.errorCode;
            return {
                // @property {String} message
                message: message    // @property {Boolean} hasErrorCode
,
                hasErrorCode: has_error_code    // @property {String} errorCode
,
                errorCode: errorCode    // @property {Boolean} closable
,
                closable: !!this.options.closable,
                type: this.options.type ? 'global-views-message-' + this.options.type : ''    // @property {Boolean} showMultipleMessage
,
                showMultipleMessage: !!_.isObject(this.options.message) && !has_error_code    // @property {Array} messages
,
                messages: _.isArray(this.options.message) ? this.options.message : [this.options.message]    // @property {Boolean} showStringMessage
,
                showStringMessage: !this.options.childView
            };    // @class GlobalViewss.Message.View
        }
    });
});    //@class GlobalViews.Message.View.InitializeOptions
       //@property {String|Array<String>?} message Message or list of message to show
       //@property {Boolean} closable Indicate if the message can be closed or not
       //@property {String} type Optional class name of be added into the resulting HTML message
       //@property {Function} closeMessageHandler Optional handler for the close action
       //@property {SC.View} childView Optional view used to show the message. When a view is specified the message property will be ignored

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module PluginContainer Defines the architecture to extend module through plugins
define('PluginContainer', ['underscore'], function (_) {
    'use strict';
    // @class PluginContainer The PluginContainer pattern is very similar to events listeners pattern but
    // designed to let listeners hook more appropiately into some processing. One or more Plugin objects
    // are installed into a PluginContainer and the owner of the container runs container.executeAll()
    // Registered plugins will be then executed by priority order and if any input is passed it will transformed
    var PluginContainer = function () {
        this.initialize();
    };
    _(PluginContainer.prototype).extend({
        // @method initialize
        initialize: function () {
            this.plugins = [];
        }    // @method executeAll execute all registered plugins The first param is the
             // input and the rest of the params will be passed to Plugin's execute method.
             // @param {Any} input. Optional. The input that plugins will take and transform.
             // @return {Any} the output, if any
,
        executeAll: function () {
            var args = Array.prototype.slice.call(arguments, 0);
            _(this.plugins).each(function (p) {
                args[0] = p.execute.apply(p, args) || args[0];
            });
            return args[0];
        }    // @method executeAllWithContext execute all registered plugins The first param is the
             // context and the rest of the params will be passed to Plugin's execute method.
             // @param {Any} context. Optional. The context that plugins will take and transform.
             // @return {Any} the output, if any
,
        executeAllWithContext: function () {
            var context = arguments[0], args = Array.prototype.slice.call(arguments, 1);
            _(this.plugins).each(function (p) {
                args[0] = p.execute.apply(context || p, args) || args[0];
            });
            return args[0];
        },
        _getPluginName: function (plugin) {
            return _(plugin).isString() ? plugin : plugin.name;
        }    // @method install add a new plugin 
             // @param {Plugin} plugin
             // @return {Void}
,
        install: function (plugin) {
            this.plugins.push(plugin);
            this.plugins = _(this.plugins).sort(function (a, b) {
                return a.priority < b.priority ? 1 : -1;
            });
        }    //@method uninstall Remove an installed plugin 
             // @param {Plugin|String} plugin
             // @return {Void}
,
        uninstall: function uninstall(plugin) {
            var name = this._getPluginName(plugin);
            this.plugins = _(this.plugins).reject(function (p) {
                return p.name === name;
            });
        }
    });
    return PluginContainer;
});    // @class Plugin installable in a PluginContainer. There is no concrete API, only an execute method and
       // It's up to the users to define de Plugin semantics @property {String} name used to identify the plugins in the container
       // @property {Number} priority lower numbers will execute before higher numbers
       // @method {Function} execute @param {Any} input @return {Any} pugins have the possibility of
       // @return {Any} will do some modifications to any passed object and will return these modifications - implementer freedom

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module SC
define('SC.CancelableEvents', [
    'underscore',
    'jQuery'
], function (_, jQuery) {
    'use strict';
    /*
	@class SC.CancelableEvents

	Cancelable events adds canceling functionality to the Observer pattern so Listeners can notify the Subject
	to cancel the actual action.

	Particularly, in SuiteCommerce extension APIs, for each action, two different events are triggered, one *before* the action
	happen and other *after* the action happen. In the case of *before* events, listeners can cancel the execution of the actual
	action by throwing an Error or by returning a rejected @?class jQuery.Deferred instance.

	This is specially useful when doing validations, being able to call an external service to validate the input, and canceling
	if the validation fails.

	Example: canceling an option selection from a listener by throwing an Error:

		pdp_component.on('beforeOptionSelection', function()	{
			if(someCondition)
		    	throw new Error('Canceling select option.');
		});

	Example: same as before but returning a rejected promise:

		pdp_component.on('beforeOptionSelection', function()	{
			if(someCondition)
			    return jQuery.Deferred().reject(new Error('Canceling select option.'));
		});

	@extlayer
	*/
    return {
        // @method cancelableOn Allow to attach an event handler into a particular event name
        // @public @extlayer
        // @param {String} event_name The name of the event to attach to
        // @param {Function} handler The event handler function that will be invoked when the event __event_name__ is triggered.
        // This function can receive optionally one parameter representing the action parameter. Besides optionally can return a jQuery.Deferred
        // to details the execution of the trigger's callback. If the returned jQuery.Deferred is rejected the trigger's callback wont be called
        // @return {Void}
        cancelableOn: function cancelableOn(event_name, handler) {
            this._cancelableOn(this, event_name, handler);
        }    // @method cancelableOff Allow to detach an event handler.
             // @public @extlayer
             // @param {String} event_name The name of the event to detach from. Note that this parameter is mandatory
             // @param {Function} handler The event handler function that will be removed from the list of register handlers. Note this parameter is required.
             // @return {Void}
,
        cancelableOff: function cancelableOff(event_name, handler) {
            if (!_.isString(event_name) || !_.isFunction(handler)) {
                var error = new Error('Parameter "event_name" and "handler" must be String and Function respectively');
                error.name = 'INVALID_PARAM';
                throw error;
            }
            this._cancelableOff(this, event_name, handler);
        }    // @method _cancelableOff Internal method that implemented the logic to remove an event handler from an event container.
             // @private
             // @param {Object} events_container_entity Any object used to store the list of event handlers
             // @param {String} event_name The name of the event to detach from. Note that this parameter is mandatory
             // @param {Function} handler The event handler function that will be removed from the list of register handlers. Note this parameter is required.
             // @return {Object} the same events_container_entity passed in as parameter
,
        _cancelableOff: function _cancelableOff(events_container_entity, event_name, handler) {
            if (!events_container_entity || !events_container_entity._cancelableEvents || !events_container_entity._cancelableEvents[event_name] || !events_container_entity._cancelableEvents[event_name].length) {
                return events_container_entity;
            }
            events_container_entity._cancelableEvents[event_name] = _.reject(events_container_entity._cancelableEvents[event_name], function (event_object) {
                return event_object.fn === handler;
            });
            return events_container_entity;
        }    // @method _cancelableOn Internal method that implements the logic to add a new event handler into a container
             // @private
             // @param {Object} events_container_entity Any object used to store the list of event handlers
             // @param {String} event_name The name of the event to attach to
             // @param {Function} handler The event handler function that will be invoked when the event __event_name__ is triggered.
             // This function can receive optionally one parameter representing the action parameter. Besides optionally can return a jQuery.Deferred
             // to details the execution of the trigger's callback. If the returned jQuery.Deferred is rejected the trigger's callback wont be called
             // @return {Object} the same events_container_entity passed in as parameter
,
        _cancelableOn: function _cancelableOn(events_container_entity, event_name, handler) {
            events_container_entity._cancelableEvents = events_container_entity._cancelableEvents || {};
            events_container_entity._cancelableEvents[event_name] = events_container_entity._cancelableEvents[event_name] || [];
            var event_handlers = events_container_entity._cancelableEvents[event_name];
            event_handlers.push({ fn: handler });
            return events_container_entity;
        }    // @method cancelableDisable Allow to disable all the handlers of a particular event
             // @public @extlayer
             // @param {String} event_name The name of the event to disable
             // @return {Void}
,
        cancelableDisable: function cancelableDisable(event_name) {
            if (!_.isString(event_name)) {
                throw {
                    status: SC.ERROR_IDENTIFIERS.invalidParameter.status,
                    code: SC.ERROR_IDENTIFIERS.invalidParameter.code,
                    message: 'Parameter "event_name" must be String'
                };
            }
            this._cancelableDisable(this, event_name);
        }    // @method _cancelableDisable Internal method that implements the logic to disable an event into a container
             // @private
             // @param {Object} events_container_entity Any object used to store the list of event handlers
             // @param {String} event_name The name of the event to attach to
             // @return {Object} the same events_container_entity passed in as parameter
,
        _cancelableDisable: function _cancelableDisable(events_container_entity, event_name) {
            events_container_entity._cancelableEvents = events_container_entity._cancelableEvents || {};
            events_container_entity._cancelableDisabledEvents = events_container_entity._cancelableDisabledEvents || {};
            events_container_entity._cancelableDisabledEvents[event_name] = events_container_entity._cancelableDisabledEvents[event_name] || [];
            //If already disable an event without re-enable it do nothing
            if (_.isEmpty(events_container_entity._cancelableDisabledEvents[event_name])) {
                events_container_entity._cancelableDisabledEvents[event_name] = events_container_entity._cancelableEvents[event_name] || [];
                events_container_entity._cancelableEvents[event_name] = [];
            }
            return events_container_entity;
        }    // @method cancelableEnable Allow to enable (restore) all the handlers of a particular event
             // @public @extlayer
             // @param {String} event_name The name of the event to disable
             // @return {Void}
,
        cancelableEnable: function cancelableEnable(event_name) {
            if (!_.isString(event_name)) {
                throw {
                    status: SC.ERROR_IDENTIFIERS.invalidParameter.status,
                    code: SC.ERROR_IDENTIFIERS.invalidParameter.code,
                    message: 'Parameter "event_name" must be String'
                };
            }
            this._cancelableEnable(this, event_name);
        }    // @method _cancelableEnable Internal method that implements the logic to enable (restore) an event into a container
             // @private
             // @param {Object} events_container_entity Any object used to store the list of event handlers
             // @param {String} event_name The name of the event to attach to
             // @return {Object} the same events_container_entity passed in as parameter
,
        _cancelableEnable: function _cancelableEnable(events_container_entity, event_name) {
            events_container_entity._cancelableEvents = events_container_entity._cancelableEvents || {};
            events_container_entity._cancelableDisabledEvents = events_container_entity._cancelableDisabledEvents || {};
            events_container_entity._cancelableDisabledEvents[event_name] = events_container_entity._cancelableDisabledEvents[event_name] || [];
            //If the event was not disable before do nothing
            if (!_.isEmpty(events_container_entity._cancelableDisabledEvents[event_name])) {
                events_container_entity._cancelableEvents[event_name] = _.union(events_container_entity._cancelableEvents[event_name] || [], events_container_entity._cancelableDisabledEvents[event_name]);
                events_container_entity._cancelableDisabledEvents[event_name] = [];
            }
            return events_container_entity;
        }    // @method cancelableTrigger Trigger the indicate event with the passed in parameters. In case that any of the event handler reject the execution (the callback WONT be called)
             // @public @extlayer
             // @param {String} event_name Event to trigger
             // @param {...params} args All other parameter passed to this function will be broadcaster to all event handlers
             // @return {jQuery.Deferred} As the event handler of an event can be asynchronous (that why it use Deferrers) the invocation of the callback is async. This means that this function
             // will return Deferred to represent this asynchronous
,
        cancelableTrigger: function cancelableTrigger(event_name) {
            var args = Array.prototype.slice.call(arguments).slice(1);
            return this._cancelableTrigger(this, event_name, args, true);
        }    // @method cancelableTriggerUnsafe Trigger the indicate event with the passed in parameters WITHOUT sanitize them.
             // In case that any of the event handler reject (returns a rejected Deferred) the execution (the callback WONT be called)
             // @public @extlayer
             // @param {String} event_name Event to trigger
             // @param {...params} args All other parameter passed to this function will be broadcaster to all event handlers
             // @return {jQuery.Deferred} As the event handler of an event can be asynchronous (that why it use Deferrers) the invocation of the callback is async. This means that this function
             // will return Deferred to represent this asynchronous
,
        cancelableTriggerUnsafe: function cancelableTriggerUnsafe(event_name) {
            var args = Array.prototype.slice.call(arguments).slice(1);
            return this._cancelableTrigger(this, event_name, args, false);
        }    // @method _cancelableTrigger Internal method that will trigger the indicate event with the passed in data (intent). In case that any of the event handler reject the execution (the callback WONT be called)
             // @private
             // @param {Object} events_container_entity Store of the event handlers
             // @param {String} event_name Event to trigger
             // @param {Array<Any>} args Array of parameters to send to all event handlers attached to the specified event (if any)
             // @param {Boolean} safe_parameters Indicate if the parameter args should be sanitized or no.
             // @return {jQuery.Deferred}
,
        _cancelableTrigger: function _cancelableTrigger(events_container_entity, event_name, args, safe_parameters) {
            var self = this;
            if (!events_container_entity || !events_container_entity._cancelableEvents || !events_container_entity._cancelableEvents[event_name] || !events_container_entity._cancelableEvents[event_name].length) {
                return jQuery.Deferred().resolve();
            } else {
                var event_handler_promises = _.map(events_container_entity._cancelableEvents[event_name], function (event_handler_container) {
                    try {
                        return event_handler_container.fn.apply(null, safe_parameters ? _.map(args, self._getSafeParameter) : args);
                    } catch (e) {
                        console.error('Exception on event handler for event ' + event_name, e);
                        return jQuery.Deferred().reject(e);
                    }
                });
                return jQuery.when.apply(jQuery, event_handler_promises);
            }
        }    // @method _getSafeParameter Generate a safe-to-be-used copy of the passed in parameter
             // @private
             // @param {Object?} original_intent Any object
             // @return {Object?} Safe to be used by event handlers methods
,
        _getSafeParameter: function _getSafeParameter(original_intent) {
            return _.isUndefined(original_intent) ? original_intent : JSON.parse(JSON.stringify(original_intent));
        }
    };
});    // @class jQuery.Deferred See https://api.jquery.com/category/deferred-object/
       // @method reject See https://api.jquery.com/category/deferred-object/ @extlayer
       // @method resolve See https://api.jquery.com/category/deferred-object/ @extlayer
       // @method then See https://api.jquery.com/category/deferred-object/ @extlayer

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module BackboneExtras
#Backbone.View
Extends native Backbone.View with a bunch of required methods most of this were defined as no-ops in ApplicationSkeleton.js
@module Backbone @class Backbone.View
It overwrites the Backbone.View constructor with the one necessary to load all the views as composite views through
the beforeInitialize and afterInitialize plugins. This code needs to be here so that all the views can load it first.
*/
define('Backbone.View', [
    'Backbone',
    'GlobalViews.Message.View',
    'underscore',
    'jQuery',
    'PluginContainer',
    'SC.CancelableEvents'
], function (Backbone, GlobalViewsMessageView, _, jQuery, PluginContainer, SCCancelableEvents) {
    'use strict';
    var proto = Backbone.View.prototype, view = Backbone.View;
    Backbone.View.beforeInitialize = new PluginContainer();
    Backbone.View.afterInitialize = new PluginContainer();
    Backbone.View = function (options) {
        this.cid = _.uniqueId('view');
        this._configure(options || {});
        this._ensureElement();
        this.constructor.beforeInitialize.executeAllWithContext(this, arguments);
        this.initialize.apply(this, arguments);
        this.constructor.afterInitialize.executeAllWithContext(this, arguments);
        this.delegateEvents();
    };
    _.extend(Backbone.View, view);
    Backbone.View.prototype = proto;
    _.extend(Backbone.View.prototype, {
        // @property {String} errorMessage Default error message, usally overwritten by server response on error
        errorMessage: 'Sorry, the information you provided is either incomplete or needs to be corrected.',
        // @property {Array<String>} contextDataRequest The list of contexts that the view is requesting
        contextDataRequest: []    // @method showContent @param {Boolean} dont_scroll will eventually be changed to an object literal
              // @return {jQuery.Deferred}
,
        showContent: function (dont_scroll) {
            return this.options.application && this.options.application.getLayout().showContent(this, dont_scroll);
        }    // @method showInModal @param {Object} options @return {jQuery.Deferred}
,
        showInModal: function (options) {
            // NavigationHelper.Plugins.Modals triggering the beforeShowContent event twice
            // for the ProductDetails.Quick.View
            if (options && options.silence) {
                delete options.silence;
                return this.options.application && this.options.application.getLayout()._showInModal(this, options);
            } else {
                return this.options.application && this.options.application.getLayout().showInModal(this, options);
            }
        }    // @method showInPush @param {Object} options @return {jQuery.Deferred}
,
        showInPush: function (options) {
            return this.options.application && this.options.application.getLayout().showInPush(this, options);
        }    // @method getMetaDescription Get view's SEO attributes @return {String}
,
        getMetaDescription: function () {
            return this.metaDescription;
        }    // @method getMetaKeywords @return {String}
,
        getMetaKeywords: function () {
            return this.metaKeywords;
        }    // @method getAddToHead @return {String}
,
        getAddToHead: function () {
            return this.addToHead;
        }    // @method getMetaTags @return {Array<HTMLElement>}
,
        getMetaTags: function () {
            return jQuery('<head/>').html(this.metaTags || '').children('meta');
        }    //@method getTitle @returns {String} the document's title to show when this view is active.
,
        getTitle: function () {
            // @property {String} title this view title. The default behavior is to set the document's title using view.title when calling view.showContent()
            return this.title;
        }    // @method getPageDescription returns a text describing the page this view is implemented in the case is rendered as a main view with Layout.showContent()
,
        getPageDescription: function () {
            return this.attributes ? this.attributes.id || this.attributes['class'] || '' : '';
        }    //@method getCanonical @return {String}
,
        getCanonical: function () {
            var canonical = window.location.protocol + '//' + window.location.hostname + '/' + Backbone.history.fragment, index_of_query = canonical.indexOf('?');
            // !~ means: indexOf == -1
            return !~index_of_query ? canonical : canonical.substring(0, index_of_query);
        }    // @method getRelPrev For paginated pages, subclasses should implement this operations to return the url of the previous and next pages
,
        getRelPrev: jQuery.noop,
        getRelNext: jQuery.noop,
        _destroy: function () {
        }    // @method destroy
,
        destroy: function (softDestroy) {
            this._destroy(softDestroy);
        }    // @method showConfirmationMessage @param {String} message
,
        showConfirmationMessage: function (message, fixed) {
            var confirmation_message = this.$('[data-confirm-message]'), global_view_message = new GlobalViewsMessageView({
                    message: message,
                    type: 'success',
                    closable: true
                });
            confirmation_message.html(global_view_message.render().$el.html());
            if (!fixed) {
                setTimeout(function () {
                    confirmation_message.fadeOut(3000);
                }, 5000);
            }
        }    // @method showWarningMessage @param {String} message
,
        showWarningMessage: function (message) {
            var global_view_message = new GlobalViewsMessageView({
                message: message,
                type: 'warning',
                closable: true
            });
            this.$('[data-confirm-message]').html(global_view_message.render().$el.html());
        }    // @method disableElementsOnPromise Disables and re-enables a given set of elements based on a promise
             // @param {jQuery.Deferred} promise @param {String} selector
,
        disableElementsOnPromise: function (promise, selector) {
            var $target = this.$(selector);
            console.warn('Use of deprecated method View.disableElementsOnPromise');
            if ($target.length === 0) {
                return;
            }
            $target.attr('disabled', true);
            promise.always(function () {
                $target.attr('disabled', false);
            });
        },
        getContext: function () {
            return {};
        }    // @method validateContextDataRequest Validate if the context that the view recieves is enough for it to work
             // @param {Object} context_data An object with the contexts found
             // @return {Boolean}
,
        validateContextDataRequest: function (context_data) {
            return _.keys(context_data).length === this.contextDataRequest.length;
        }    // @method getContextDataRequest Returns a copy of the 'contextDataRequest' property
             // @return {Array<String>}
,
        getContextDataRequest: function () {
            return this.contextDataRequest.slice();
        }
    }, SCCancelableEvents);
    //Static methods
    _.extend(Backbone.View, {
        //@method _isEventSelectorValid Validates is the passed in selector follows the format/standard required by SC Views
        //format: '<event_name> [data=action="<event_handlerName>"]'
        //@private
        //@param {String} event_selector Selector to be validates
        //@return {Boolean}
        _isEventSelectorValid: function _isEventSelectorValid(event_selector) {
            var event_name = [
                'blur',
                'change',
                'click',
                'contextmenu',
                'dblclick',
                'error',
                'focus',
                'focusin',
                'focusout',
                'keydown',
                'keypress',
                'keyup',
                'load',
                'mousedown',
                'mousemove',
                'mouseout',
                'mouseover',
                'mouseup',
                'resize',
                'scroll',
                'select',
                'submit',
                'touchend',
                'touchmove',
                'touchstart',
                'unload'
            ];
            var event_selector_structure_re = /([a-zA-Z]+) \[data\-action="([^"]+)"\]/, matches = event_selector_structure_re.exec(event_selector);
            return matches && _.indexOf(event_name, matches[1]) >= 0 && !!matches[2].length;
        }    //@method addExtraEventHandler Adds an extra event handler to the current view
             //@param {String} event_selector Event specification to be added into the list of event handled by the current view
             //@param {Function} callback Function that will be called when the specified event is triggered
             //@return {Void}
             //@static
             //@public
,
        addExtraEventHandler: function addExtraEventHandler(event_selector, callback) {
            var error = {};
            this.prototype.events = this.prototype.events || {};
            if (!this._isEventSelectorValid(event_selector)) {
                error = new Error('The specified event_selector parameter does not respect the required format.');
                error.name = 'INVALID_PARAM';
                throw error;
            }
            if (this.prototype.events[event_selector]) {
                error = new Error('Duplicated event selector. Please specify a different one.');
                error.name = 'DUPLICATED_EVENT_SELECTOR';
                throw error;
            }
            this.prototype.events[event_selector] = _.bind(callback, null);
            this.prototype.events[event_selector].custom = true;
        }    //@method removeExtraEventHandler Removes an extra event handler of the current view
             //@param {String} event_selector Event specification to be added into the list of event handled by the current view
             //@return {Void}
             //@static
             //@public
,
        removeExtraEventHandler: function removeExtraEventHandler(event_selector) {
            var error = {};
            this.prototype.events = this.prototype.events || {};
            if (!this.prototype.events[event_selector] || !this.prototype.events[event_selector].custom) {
                error = new Error('The specified event selector does not exists or is not custom.');
                error.name = 'INVALID_PARAM';
                throw error;
            }
            delete this.prototype.events[event_selector];
        }
    });
    return Backbone.View;
});









/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//! © 2015 NetSuite Inc.
// String.format.js
// ----------------
// Used for the translation method in Utils.js
// Will replace $(n) for the n parameter entered 
// eg: "This $(0) a $(1), $(0) it?".format("is", "test");
//     returns "This is a test, is it?"
define('String.format', function () {
    'use strict';
    String.prototype.format = function () {
        var args = arguments;
        return this.replace(/\$\((\d+)\)/g, function (match, number) {
            return typeof args[number] !== 'undefined' ? args[number] : match;
        });
    };
});
// Backbone.Validation v0.9.1
//
// Copyright (c) 2011-2014 Thomas Pedersen
// Distributed under MIT License
//
// Documentation and full license available at:
// http://thedersen.com/projects/backbone-validation
define('Backbone.Validation', ['Backbone'], function () {
    Backbone.Validation = function (_) {
        'use strict';
        // Default options
        // ---------------
        var defaultOptions = {
            forceUpdate: false,
            selector: 'name',
            labelFormatter: 'sentenceCase',
            valid: Function.prototype,
            invalid: Function.prototype
        };
        // Helper functions
        // ----------------
        // Formatting functions used for formatting error messages
        var formatFunctions = {
            // Uses the configured label formatter to format the attribute name
            // to make it more readable for the user
            formatLabel: function (attrName, model) {
                return defaultLabelFormatters[defaultOptions.labelFormatter](attrName, model);
            },
            // Replaces nummeric placeholders like {0} in a string with arguments
            // passed to the function
            format: function () {
                var args = Array.prototype.slice.call(arguments), text = args.shift();
                return text.replace(/\{(\d+)\}/g, function (match, number) {
                    return typeof args[number] !== 'undefined' ? args[number] : match;
                });
            }
        };
        // Flattens an object
        // eg:
        //
        //     var o = {
        //       address: {
        //         street: 'Street',
        //         zip: 1234
        //       }
        //     };
        //
        // becomes:
        //
        //     var o = {
        //       'address.street': 'Street',
        //       'address.zip': 1234
        //     };
        var flatten = function (obj, into, prefix) {
            into = into || {};
            prefix = prefix || '';
            _.each(obj, function (val, key) {
                if (obj.hasOwnProperty(key)) {
                    if (val && typeof val === 'object' && !(val instanceof Array || val instanceof Date || val instanceof RegExp || val instanceof Backbone.Model || val instanceof Backbone.Collection)) {
                        flatten(val, into, prefix + key + '.');
                    } else {
                        into[prefix + key] = val;
                    }
                }
            });
            return into;
        };
        // Validation
        // ----------
        var Validation = function () {
            // Returns an object with undefined properties for all
            // attributes on the model that has defined one or more
            // validation rules.
            var getValidatedAttrs = function (model) {
                return _.reduce(_.keys(_.result(model, 'validation') || {}), function (memo, key) {
                    memo[key] = void 0;
                    return memo;
                }, {});
            };
            // Looks on the model for validations for a specified
            // attribute. Returns an array of any validators defined,
            // or an empty array if none is defined.
            var getValidators = function (model, attr) {
                var attrValidationSet = model.validation ? _.result(model, 'validation')[attr] || {} : {};
                // If the validator is a function or a string, wrap it in a function validator
                if (_.isFunction(attrValidationSet) || _.isString(attrValidationSet)) {
                    attrValidationSet = { fn: attrValidationSet };
                }
                // Stick the validator object into an array
                if (!_.isArray(attrValidationSet)) {
                    attrValidationSet = [attrValidationSet];
                }
                // Reduces the array of validators into a new array with objects
                // with a validation method to call, the value to validate against
                // and the specified error message, if any
                return _.reduce(attrValidationSet, function (memo, attrValidation) {
                    _.each(_.without(_.keys(attrValidation), 'msg'), function (validator) {
                        memo.push({
                            fn: defaultValidators[validator],
                            val: attrValidation[validator],
                            msg: attrValidation.msg
                        });
                    });
                    return memo;
                }, []);
            };
            // Validates an attribute against all validators defined
            // for that attribute. If one or more errors are found,
            // the first error message is returned.
            // If the attribute is valid, an empty string is returned.
            var validateAttr = function (model, attr, value, computed) {
                // Reduces the array of validators to an error message by
                // applying all the validators and returning the first error
                // message, if any.
                return _.reduce(getValidators(model, attr), function (memo, validator) {
                    // Pass the format functions plus the default
                    // validators as the context to the validator
                    var ctx = _.extend({}, formatFunctions, defaultValidators), result = validator.fn.call(ctx, value, attr, validator.val, model, computed);
                    if (result === false || memo === false) {
                        return false;
                    }
                    if (result && !memo) {
                        return _.result(validator, 'msg') || result;
                    }
                    return memo;
                }, '');
            };
            // Loops through the model's attributes and validates them all.
            // Returns and object containing names of invalid attributes
            // as well as error messages.
            var validateModel = function (model, attrs) {
                var error, invalidAttrs = {}, isValid = true, computed = _.clone(attrs), flattened = flatten(attrs);
                _.each(flattened, function (val, attr) {
                    error = validateAttr(model, attr, val, computed);
                    if (error) {
                        invalidAttrs[attr] = error;
                        isValid = false;
                    }
                });
                return {
                    invalidAttrs: invalidAttrs,
                    isValid: isValid
                };
            };
            // Contains the methods that are mixed in on the model when binding
            var mixin = function (view, options) {
                return {
                    // Check whether or not a value, or a hash of values
                    // passes validation without updating the model
                    preValidate: function (attr, value) {
                        var self = this, result = {}, error;
                        if (_.isObject(attr)) {
                            _.each(attr, function (value, key) {
                                error = self.preValidate(key, value);
                                if (error) {
                                    result[key] = error;
                                }
                            });
                            return _.isEmpty(result) ? undefined : result;
                        } else {
                            return validateAttr(this, attr, value, _.extend({}, this.attributes));
                        }
                    },
                    // Check to see if an attribute, an array of attributes or the
                    // entire model is valid. Passing true will force a validation
                    // of the model.
                    isValid: function (option) {
                        var flattened = flatten(this.attributes);
                        if (_.isString(option)) {
                            return !validateAttr(this, option, flattened[option], _.extend({}, this.attributes));
                        }
                        if (_.isArray(option)) {
                            return _.reduce(option, function (memo, attr) {
                                return memo && !validateAttr(this, attr, flattened[attr], _.extend({}, this.attributes));
                            }, true, this);
                        }
                        if (option === true) {
                            this.validate();
                        }
                        return this.validation ? this._isValid : true;
                    },
                    // This is called by Backbone when it needs to perform validation.
                    // You can call it manually without any parameters to validate the
                    // entire model.
                    validate: function (attrs, setOptions) {
                        var model = this, validateAll = !attrs, opt = _.extend({}, options, setOptions), validatedAttrs = getValidatedAttrs(model), allAttrs = _.extend({}, validatedAttrs, model.attributes, attrs), changedAttrs = flatten(attrs || allAttrs), result = validateModel(model, allAttrs);
                        model._isValid = result.isValid;
                        // After validation is performed, loop through all validated attributes
                        // and call the valid callbacks so the view is updated.
                        _.each(validatedAttrs, function (val, attr) {
                            var invalid = result.invalidAttrs.hasOwnProperty(attr);
                            if (!invalid) {
                                opt.valid(view, attr, opt.selector);
                            }
                        });
                        // After validation is performed, loop through all validated and changed attributes
                        // and call the invalid callback so the view is updated.
                        _.each(validatedAttrs, function (val, attr) {
                            var invalid = result.invalidAttrs.hasOwnProperty(attr), changed = changedAttrs.hasOwnProperty(attr);
                            if (invalid && (changed || validateAll)) {
                                opt.invalid(view, attr, result.invalidAttrs[attr], opt.selector);
                            }
                        });
                        // Trigger validated events.
                        // Need to defer this so the model is actually updated before
                        // the event is triggered.
                        _.defer(function () {
                            model.trigger('validated', model._isValid, model, result.invalidAttrs);
                            model.trigger('validated:' + (model._isValid ? 'valid' : 'invalid'), model, result.invalidAttrs);
                        });
                        // Return any error messages to Backbone, unless the forceUpdate flag is set.
                        // Then we do not return anything and fools Backbone to believe the validation was
                        // a success. That way Backbone will update the model regardless.
                        if (!opt.forceUpdate && _.intersection(_.keys(result.invalidAttrs), _.keys(changedAttrs)).length > 0) {
                            return result.invalidAttrs;
                        }
                    }
                };
            };
            // Helper to mix in validation on a model
            var bindModel = function (view, model, options) {
                _.extend(model, mixin(view, options));
            };
            // Removes the methods added to a model
            var unbindModel = function (model) {
                delete model.validate;
                delete model.preValidate;
                delete model.isValid;
            };
            // Mix in validation on a model whenever a model is
            // added to a collection
            var collectionAdd = function (model) {
                bindModel(this.view, model, this.options);
            };
            // Remove validation from a model whenever a model is
            // removed from a collection
            var collectionRemove = function (model) {
                unbindModel(model);
            };
            // Returns the public methods on Backbone.Validation
            return {
                // Current version of the library
                version: '0.9.1',
                // Called to configure the default options
                configure: function (options) {
                    _.extend(defaultOptions, options);
                },
                // Hooks up validation on a view with a model
                // or collection
                bind: function (view, options) {
                    options = _.extend({}, defaultOptions, defaultCallbacks, options);
                    var model = options.model || view.model, collection = options.collection || view.collection;
                    if (typeof model === 'undefined' && typeof collection === 'undefined') {
                        throw 'Before you execute the binding your view must have a model or a collection.\n' + 'See http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.';
                    }
                    if (model) {
                        bindModel(view, model, options);
                    } else if (collection) {
                        collection.each(function (model) {
                            bindModel(view, model, options);
                        });
                        collection.bind('add', collectionAdd, {
                            view: view,
                            options: options
                        });
                        collection.bind('remove', collectionRemove);
                    }
                },
                // Removes validation from a view with a model
                // or collection
                unbind: function (view, options) {
                    options = _.extend({}, options);
                    var model = options.model || view.model, collection = options.collection || view.collection;
                    if (model) {
                        unbindModel(model);
                    } else if (collection) {
                        collection.each(function (model) {
                            unbindModel(model);
                        });
                        collection.unbind('add', collectionAdd);
                        collection.unbind('remove', collectionRemove);
                    }
                },
                // Used to extend the Backbone.Model.prototype
                // with validation
                mixin: mixin(null, defaultOptions)
            };
        }();
        // Callbacks
        // ---------
        var defaultCallbacks = Validation.callbacks = {
            // Gets called when a previously invalid field in the
            // view becomes valid. Removes any error message.
            // Should be overridden with custom functionality.
            valid: function (view, attr, selector) {
                view.$('[' + selector + '~="' + attr + '"]').removeClass('invalid').removeAttr('data-error');
            },
            // Gets called when a field in the view becomes invalid.
            // Adds a error message.
            // Should be overridden with custom functionality.
            invalid: function (view, attr, error, selector) {
                view.$('[' + selector + '~="' + attr + '"]').addClass('invalid').attr('data-error', error);
            }
        };
        // Patterns
        // --------
        var defaultPatterns = Validation.patterns = {
            // Matches any digit(s) (i.e. 0-9)
            digits: /^\d+$/,
            // Matches any number (e.g. 100.000)
            number: /^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,
            // Matches a valid email address (e.g. mail@example.com)
            email: /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,
            // Same as email but is more restrictive and matches the same emails as the Netsuite backend UI
            // Source: https://system.netsuite.com/javascript/NLUtil.jsp__NS_VER=2014.1.0&minver=154&locale=en_US.nlqs
            //        (Search for NLValidationUtil_SIMPLE_EMAIL_PATTERN)
            netsuiteEmail: /^[-a-z0-9!#$%&'*+\/=?^_`{|}~]+(?:\.[-a-z0-9!#$%&'*+\/=?^_`{|}~]+)*@(?:[a-z0-9]+(?:-+[a-z0-9]+)*\.)+(?:zw|zone|zm|za|yt|yokohama|ye|yandex|yachts|xyz|xxx|xn--zfr164b|xn--ygbi2ammx|xn--yfro4i67o|xn--xkc2dl3a5ee0h|xn--xkc2al3hye2a|xn--wgbl6a|xn--wgbh1c|xn--unup4y|xn--ses554g|xn--s9brj9c|xn--rhqv96g|xn--q9jyb4c|xn--pgbs0dh|xn--p1ai|xn--ogbpf8fl|xn--o3cw4h|xn--nqv7fs00ema|xn--nqv7f|xn--ngbc5azd|xn--mgbx4cd0ab|xn--mgberp4a5d4ar|xn--mgbc0a9azcg|xn--mgbbh1a71e|xn--mgbayh7gpa|xn--mgbab2bd|xn--mgbaam7a8h|xn--mgba3a4f16a|xn--mgb9awbf|xn--lgbbat1ad8j|xn--l1acc|xn--kput3i|xn--kpry57d|xn--kprw13d|xn--j6w193g|xn--j1amh|xn--io0a7i|xn--i1b6b1a6a2e|xn--h2brj9c|xn--gecrj9c|xn--fzc2c9e2c|xn--fpcrj9c3d|xn--fiqz9s|xn--fiqs8s|xn--fiq64b|xn--fiq228c5hs|xn--d1acj3b|xn--czru2d|xn--czr694b|xn--clchc0ea0b2g2a9gcd|xn--cg4bki|xn--c1avg|xn--90a3ac|xn--80aswg|xn--80asehdb|xn--80ao21a|xn--80adxhks|xn--6qq986b3xl|xn--6frz82g|xn--55qx5d|xn--55qw42g|xn--4gbrim|xn--45brj9c|xn--3e0b707e|xn--3ds443g|xn--3bst00m|wtf|wtc|ws|works|williamhill|wiki|wien|whoswho|wf|wed|website|webcam|watch|wang|vu|voyage|voto|voting|vote|vodka|vn|vlaanderen|vision|villas|viajes|vi|vg|vet|versicherung|ventures|vegas|ve|vc|vacations|va|uz|uy|us|uno|university|uk|ug|ua|tz|tw|tv|tt|travel|training|trade|tr|tp|toys|town|top|tools|tokyo|today|to|tn|tm|tl|tk|tj|tirol|tips|tienda|th|tg|tf|tel|technology|td|tc|tax|tattoo|sz|systems|sy|sx|sv|suzuki|surgery|surf|support|supply|supplies|su|st|sr|spiegel|space|soy|solutions|solar|sohu|software|social|so|sn|sm|sl|sk|sj|singles|si|shoes|shiksha|sh|sg|sexy|services|se|sd|scot|schule|schmidt|scb|sc|sb|saarland|sa|ryukyu|rw|ruhr|ru|rs|rodeo|rocks|ro|rio|rich|reviews|rest|republican|report|repair|rentals|ren|reisen|reise|rehab|red|recipes|realtor|re|quebec|qpon|qa|py|pw|pub|pt|ps|properties|productions|pro|press|praxi|pr|post|pn|pm|plumbing|place|pl|pk|pink|pictures|pics|physio|photos|photography|photo|ph|pg|pf|pe|parts|partners|paris|pa|ovh|organic|org|onl|ong|om|okinawa|nz|nyc|nu|nrw|nra|nr|np|no|nl|ninja|ni|nhk|ngo|ng|nf|neustar|net|ne|nc|navy|name|nagoya|na|mz|my|mx|mw|mv|museum|mu|mt|ms|mr|mq|mp|motorcycles|moscow|mortgage|monash|moe|moda|mobi|mo|mn|mm|ml|mk|mini|mil|miami|mh|mg|menu|melbourne|meet|media|me|md|mc|marketing|market|mango|management|maison|ma|ly|lv|luxury|luxe|lu|lt|ls|lr|lotto|london|loans|lk|link|limo|limited|lighting|life|li|lgbt|lease|lc|lb|lawyer|land|lacaixa|la|kz|ky|kw|kred|krd|kr|kp|koeln|kn|km|kiwi|kitchen|kim|ki|kh|kg|ke|kaufen|juegos|jp|joburg|jobs|jo|jm|jetzt|je|it|is|ir|iq|io|investments|international|int|insure|institute|ink|info|industries|in|immobilien|im|il|ie|id|hu|ht|hr|house|host|horse|homes|holiday|holdings|hn|hm|hk|hiv|hiphop|healthcare|haus|hamburg|gy|gw|guru|guitars|guide|gu|gt|gs|gripe|green|gratis|graphics|gr|gq|gp|gov|gop|gn|gmo|gm|globo|global|glass|gl|gives|gift|gi|gh|gg|gf|gent|ge|gd|gb|gallery|gal|ga|futbol|furniture|fund|frogans|fr|foundation|foo|fo|fm|florist|flights|fk|fj|fitness|fishing|fish|financial|finance|fi|feedback|farm|fail|exposed|expert|exchange|events|eus|eu|et|estate|es|er|equipment|enterprises|engineering|engineer|email|eg|ee|education|edu|ec|dz|durban|domains|do|dnp|dm|dk|dj|discount|directory|direct|digital|diamonds|desi|dentist|dental|democrat|degree|deals|de|dating|dance|cz|cy|cx|cw|cv|cuisinella|cu|cruises|creditcard|credit|cr|country|corp|coop|cool|cooking|contractors|consulting|construction|condos|computer|company|community|com|cologne|college|coffee|codes|co|cn|cm|club|clothing|clinic|cleaning|claims|cl|ck|city|citic|ci|church|christmas|cheap|ch|cg|cf|ceo|center|cd|cc|catering|cat|cash|careers|career|care|cards|capital|capetown|cancerresearch|camp|camera|cab|ca|bzh|bz|by|bw|bv|buzz|builders|build|bt|bs|brussels|br|boutique|bo|bn|bmw|bm|blue|blackfriday|black|bj|biz|bio|bike|bid|bi|bh|bg|bf|best|berlin|beer|be|bd|bb|bayern|bargains|bar|ba|az|axa|ax|aw|autos|audio|auction|au|attorney|at|associates|asia|as|arpa|army|archi|ar|aq|ao|an|am|al|airforce|ai|agency|ag|af|aero|ae|ad|actor|active|accountants|academy|ac)$/i,
            // Mathes any valid url (e.g. http://www.xample.com)
            url: /^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i
        };
        // Error messages
        // --------------
        // Error message for the build in validators.
        // {x} gets swapped out with arguments form the validator.
        var defaultMessages = Validation.messages = {
            required: '{0} is required',
            acceptance: '{0} must be accepted',
            min: '{0} must be greater than or equal to {1}',
            max: '{0} must be less than or equal to {1}',
            range: '{0} must be between {1} and {2}',
            length: '{0} must be {1} characters',
            minLength: '{0} must be at least {1} characters',
            maxLength: '{0} must be at most {1} characters',
            rangeLength: '{0} must be between {1} and {2} characters',
            oneOf: '{0} must be one of: {1}',
            equalTo: '{0} must be the same as {1}',
            digits: '{0} must only contain digits',
            number: '{0} must be a number',
            email: '{0} must be a valid email',
            url: '{0} must be a valid url',
            inlinePattern: '{0} is invalid'
        };
        // Label formatters
        // ----------------
        // Label formatters are used to convert the attribute name
        // to a more human friendly label when using the built in
        // error messages.
        // Configure which one to use with a call to
        //
        //     Backbone.Validation.configure({
        //       labelFormatter: 'label'
        //     });
        var defaultLabelFormatters = Validation.labelFormatters = {
            // Returns the attribute name with applying any formatting
            none: function (attrName) {
                return attrName;
            },
            // Converts attributeName or attribute_name to Attribute name
            sentenceCase: function (attrName) {
                return attrName.replace(/(?:^\w|[A-Z]|\b\w)/g, function (match, index) {
                    return index === 0 ? match.toUpperCase() : ' ' + match.toLowerCase();
                }).replace(/_/g, ' ');
            },
            // Looks for a label configured on the model and returns it
            //
            //      var Model = Backbone.Model.extend({
            //        validation: {
            //          someAttribute: {
            //            required: true
            //          }
            //        },
            //
            //        labels: {
            //          someAttribute: 'Custom label'
            //        }
            //      });
            label: function (attrName, model) {
                return model.labels && model.labels[attrName] || defaultLabelFormatters.sentenceCase(attrName, model);
            }
        };
        // Built in validators
        // -------------------
        var defaultValidators = Validation.validators = function () {
            // Use native trim when defined
            var trim = String.prototype.trim ? function (text) {
                return text === null ? '' : String.prototype.trim.call(text);
            } : function (text) {
                var trimLeft = /^\s+/, trimRight = /\s+$/;
                return text === null ? '' : text.toString().replace(trimLeft, '').replace(trimRight, '');
            };
            // Determines whether or not a value is a number
            var isNumber = function (value) {
                return _.isNumber(value) || _.isString(value) && value.match(defaultPatterns.number);
            };
            // Determines whether or not a value is empty
            var hasValue = function (value) {
                return !(_.isNull(value) || _.isUndefined(value) || _.isString(value) && trim(value) === '' || _.isArray(value) && _.isEmpty(value));
            };
            return {
                // Function validator
                // Lets you implement a custom function used for validation
                fn: function (value, attr, fn, model, computed) {
                    if (_.isString(fn)) {
                        fn = model[fn];
                    }
                    return fn.call(model, value, attr, computed);
                },
                // Required validator
                // Validates if the attribute is required or not
                // This can be specified as either a boolean value or a function that returns a boolean value
                required: function (value, attr, required, model, computed) {
                    var isRequired = _.isFunction(required) ? required.call(model, value, attr, computed) : required;
                    if (!isRequired && !hasValue(value)) {
                        return false;    // overrides all other validators
                    }
                    if (isRequired && !hasValue(value)) {
                        return this.format(defaultMessages.required, this.formatLabel(attr, model));
                    }
                },
                // Acceptance validator
                // Validates that something has to be accepted, e.g. terms of use
                // `true` or 'true' are valid
                acceptance: function (value, attr, accept, model) {
                    if (value !== 'true' && (!_.isBoolean(value) || value === false)) {
                        return this.format(defaultMessages.acceptance, this.formatLabel(attr, model));
                    }
                },
                // Min validator
                // Validates that the value has to be a number and equal to or greater than
                // the min value specified
                min: function (value, attr, minValue, model) {
                    if (!isNumber(value) || value < minValue) {
                        return this.format(defaultMessages.min, this.formatLabel(attr, model), minValue);
                    }
                },
                // Max validator
                // Validates that the value has to be a number and equal to or less than
                // the max value specified
                max: function (value, attr, maxValue, model) {
                    if (!isNumber(value) || value > maxValue) {
                        return this.format(defaultMessages.max, this.formatLabel(attr, model), maxValue);
                    }
                },
                // Range validator
                // Validates that the value has to be a number and equal to or between
                // the two numbers specified
                range: function (value, attr, range, model) {
                    if (!isNumber(value) || value < range[0] || value > range[1]) {
                        return this.format(defaultMessages.range, this.formatLabel(attr, model), range[0], range[1]);
                    }
                },
                // Length validator
                // Validates that the value has to be a string with length equal to
                // the length value specified
                length: function (value, attr, length, model) {
                    if (!_.isString(value) || value.length !== length) {
                        return this.format(defaultMessages.length, this.formatLabel(attr, model), length);
                    }
                },
                // Min length validator
                // Validates that the value has to be a string with length equal to or greater than
                // the min length value specified
                minLength: function (value, attr, minLength, model) {
                    if (!_.isString(value) || value.length < minLength) {
                        return this.format(defaultMessages.minLength, this.formatLabel(attr, model), minLength);
                    }
                },
                // Max length validator
                // Validates that the value has to be a string with length equal to or less than
                // the max length value specified
                maxLength: function (value, attr, maxLength, model) {
                    if (!_.isString(value) || value.length > maxLength) {
                        return this.format(defaultMessages.maxLength, this.formatLabel(attr, model), maxLength);
                    }
                },
                // Range length validator
                // Validates that the value has to be a string and equal to or between
                // the two numbers specified
                rangeLength: function (value, attr, range, model) {
                    if (!_.isString(value) || value.length < range[0] || value.length > range[1]) {
                        return this.format(defaultMessages.rangeLength, this.formatLabel(attr, model), range[0], range[1]);
                    }
                },
                // One of validator
                // Validates that the value has to be equal to one of the elements in
                // the specified array. Case sensitive matching
                oneOf: function (value, attr, values, model) {
                    if (!_.include(values, value)) {
                        return this.format(defaultMessages.oneOf, this.formatLabel(attr, model), values.join(', '));
                    }
                },
                // Equal to validator
                // Validates that the value has to be equal to the value of the attribute
                // with the name specified
                equalTo: function (value, attr, equalTo, model, computed) {
                    if (value !== computed[equalTo]) {
                        return this.format(defaultMessages.equalTo, this.formatLabel(attr, model), this.formatLabel(equalTo, model));
                    }
                },
                // Pattern validator
                // Validates that the value has to match the pattern specified.
                // Can be a regular expression or the name of one of the built in patterns
                pattern: function (value, attr, pattern, model) {
                    if (!hasValue(value) || !value.toString().match(defaultPatterns[pattern] || pattern)) {
                        return this.format(defaultMessages[pattern] || defaultMessages.inlinePattern, this.formatLabel(attr, model), pattern);
                    }
                }
            };
        }();
        // Set the correct context for all validators
        // when used from within a method validator
        _.each(defaultValidators, function (validator, key) {
            defaultValidators[key] = _.bind(defaultValidators[key], _.extend({}, formatFunctions, defaultValidators));
        });
        return Validation;
    }(_);
    return;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/* globals session */
// @module Utilities
// --------
// @class Utils
// A collection of utility methods. This are added to both SC.Utils, and Underscore.js
// eg: you could use SC.Utils.formatPhone() or _.formatPhone()
define('Utils', [
    'jQuery',
    'underscore',
    'Backbone',
    'String.format',
    'Backbone.Validation'
], function (jQuery, _, Backbone) {
    'use strict';
    //@function deepCopy Deep Copy of the object taking care of Backbone models
    //@param {Object} obj Object to be copy
    //@return {Object}
    function deepCopy(obj) {
        if (_.isFunction(obj)) {
            return null;
        }
        var copy = {};
        if (obj instanceof Backbone.Model) {
            obj = obj.deepCopy();
        } else if (obj instanceof Backbone.Collection) {
            obj = obj.models || [];
        }
        if (_.isArray(obj)) {
            copy = [];
            _.each(obj, function (value) {
                !_.isFunction(value) && copy.push(_.deepCopy(value));
            });
        } else if (_.isObject(obj)) {
            _.each(obj, function (value, attr) {
                if (!_.isFunction(value) && attr.indexOf('_') !== 0) {
                    copy[attr] = _.deepCopy(value);
                }
            });
        } else {
            copy = obj;
        }
        return copy;
    }
    //@function trim Remove starting and ending spaces
    //@param {String} str String to be trimmed
    //@return {String}
    var trim = jQuery.trim;
    // @method formatPhone
    // Will try to reformat a phone number for a given phone Format,
    // If no format is given, it will try to use the one in site settings.
    // @param {String} phone @param {String} format @return {String}
    function formatPhone(phone, format) {
        // fyi: the tilde (~) its used as !== -1
        var extentionSearch = phone.search(/[A-Za-z#]/), extention = ~extentionSearch ? ' ' + phone.substring(extentionSearch) : '', phoneNumber = ~extentionSearch ? ' ' + phone.substring(0, extentionSearch) : phone;
        format = format || SC.ENVIRONMENT.siteSettings.phoneformat;
        if (/^[0-9()-.\s]+$/.test(phoneNumber) && format) {
            var format_tokens = {}, phoneDigits = phoneNumber.replace(/[()-.\s]/g, '');
            switch (format) {
            // c: country, ab: area_before, aa: area_after, d: digits
            case '(123) 456-7890':
                format_tokens = {
                    c: ' ',
                    ab: '(',
                    aa: ') ',
                    d: '-'
                };
                break;
            case '123 456 7890':
                format_tokens = {
                    c: ' ',
                    ab: '',
                    aa: ' ',
                    d: ' '
                };
                break;
            case '123-456-7890':
                format_tokens = {
                    c: ' ',
                    ab: '',
                    aa: '-',
                    d: '-'
                };
                break;
            case '123.456.7890':
                format_tokens = {
                    c: ' ',
                    ab: '',
                    aa: '.',
                    d: '.'
                };
                break;
            default:
                return phone;
            }
            switch (phoneDigits.length) {
            case 7:
                return phoneDigits.substring(0, 3) + format_tokens.d + phoneDigits.substring(3) + extention;
            case 10:
                return format_tokens.ab + phoneDigits.substring(0, 3) + format_tokens.aa + phoneDigits.substring(3, 6) + format_tokens.d + phoneDigits.substring(6) + extention;
            case 11:
                return phoneDigits.substring(0, 1) + format_tokens.c + format_tokens.ab + phoneDigits.substring(1, 4) + format_tokens.aa + phoneDigits.substring(4, 7) + format_tokens.d + phoneDigits.substring(7) + extention;
            default:
                return phone;
            }
        }
        return phone;
    }
    // @method dateToString Convert a date object to string using international format YYYY-MM-dd
    // Useful for inputs of type="date" @param {Date} date @return {String}
    function dateToString(date) {
        var month = '' + (date.getMonth() + 1), day = '' + date.getDate();
        if (month.length === 1) {
            month = '0' + month;
        }
        if (day.length === 1) {
            day = '0' + day;
        }
        return date.getFullYear() + '-' + month + '-' + day;
    }
    // @method stringToDate parse a string date into a date object.
    // @param {String} str_date
    // @param {format:String,plusMonth:Number} options.format: String format that specify the format of the input string. By Default YYYY-MM-dd.
    // options.plusMonth: Number that indicate how many month offset should be applied whne creating the date object.
    function stringToDate(str_date, options) {
        options = _.extend({
            format: 'YYYY-MM-dd',
            plusMonth: -1,
            dateSplitCharacter: '-'
        }, options || {});
        //plumbing
        var date_parts = str_date ? str_date.split(options.dateSplitCharacter) : [], format_parts = options.format ? options.format.split('-') : [], year_index = _.indexOf(format_parts, 'YYYY') >= 0 ? _.indexOf(format_parts, 'YYYY') : 2, month_index = _.indexOf(format_parts, 'MM') >= 0 ? _.indexOf(format_parts, 'MM') : 1, day_index = _.indexOf(format_parts, 'dd') >= 0 ? _.indexOf(format_parts, 'dd') : 0    //Date parts
, year = parseInt(date_parts[year_index], 10), month = parseInt(date_parts[month_index], 10) + (options.plusMonth || 0), day = parseInt(date_parts[day_index], 10), result = new Date(year, month, day);
        if (!(result.getMonth() !== month || day !== result.getDate() || result.getFullYear() !== year)) {
            return result;
        }
    }
    // @method isDateValid @param {Date} date @return {Boolean}
    function isDateValid(date) {
        if (Object.prototype.toString.call(date) === '[object Date]') {
            // it is a date
            if (isNaN(date.getTime())) {
                // d.valueOf() could also work
                // date is not valid
                return false;
            } else {
                // date is valid
                // now validate the values of day, month and year
                var dtDay = date.getDate(), dtMonth = date.getMonth() + 1, dtYear = date.getFullYear(), pattern = /^\d{4}$/;
                if (!pattern.test(dtYear)) {
                    return false;
                } else if (dtMonth < 1 || dtMonth > 12) {
                    return false;
                } else if (dtDay < 1 || dtDay > 31) {
                    return false;
                } else if ((dtMonth === 4 || dtMonth === 6 || dtMonth === 9 || dtMonth === 11) && dtDay === 31) {
                    return false;
                } else if (dtMonth === 2) {
                    var isleap = dtYear % 4 === 0 && (dtYear % 100 !== 0 || dtYear % 400 === 0);
                    if (dtDay > 29 || dtDay === 29 && !isleap) {
                        return false;
                    }
                }
                return true;
            }
        } else {
            // not a date
            return false;
        }
    }
    // @method validateSecurityCode @param {String} value @return a non empty string with a internationalized warning message
    function validateSecurityCode(value) {
        var ccsn = trim(value);
        if (!ccsn) {
            return _('Security Number is required').translate();
        }
        if (!(Backbone.Validation.patterns.number.test(ccsn) && (ccsn.length === 3 || ccsn.length === 4))) {
            return _('Security Number is invalid').translate();
        }
    }
    // @method validatePhone @param {String} phone @return {String} an error message if the passed phone is invalid or falsy if it is valid
    function validatePhone(phone) {
        var minLength = 7;
        if (_.isNumber(phone)) {
            // phone is a number so we can't ask for .length
            // we elevate 10 to (minLength - 1)
            // if the number is lower, then its invalid
            // eg: phone = 1234567890 is greater than 1000000, so its valid
            //     phone = 123456 is lower than 1000000, so its invalid
            if (phone < Math.pow(10, minLength - 1)) {
                return _('Phone Number is invalid').translate();
            }
        } else if (phone) {
            // if its a string, we remove all the useless characters
            var value = phone.replace(/[()-.\s]/g, '');
            // we then turn the value into an integer and back to string
            // to make sure all of the characters are numeric
            //first remove leading zeros for number comparison
            while (value.length && value.substring(0, 1) === '0') {
                value = value.substring(1, value.length);
            }
            if (parseInt(value, 10).toString() !== value || value.length < minLength) {
                return _('Phone Number is invalid').translate();
            }
        } else {
            return _('Phone is required').translate();
        }
    }
    // @method validateState @param {String} value @param {String} valName @param {Object} form @return {String} an error message if the passed state is invalid or falsy if it is valid
    function validateState(value, valName, form) {
        var countries = SC.ENVIRONMENT.siteSettings.countries || {};
        if (countries[form.country] && countries[form.country].states && value === '') {
            return _('State is required').translate();
        }
    }
    // @method validateZipCode @param {String} value @param {String} valName @param {Object} form @return {String} an error message if the passed zip code is invalid or falsy if it is valid
    function validateZipCode(value, valName, form) {
        var countries = SC.ENVIRONMENT.siteSettings.countries || {};
        value = trim(value);
        if (!value && (!form.country || countries[form.country] && countries[form.country].isziprequired === 'T')) {
            return _('Zip Code is required').translate();
        }
    }
    // @method translate
    // Used on all of the hardcoded texts in the templates. Gets the translated value from SC.Translations object literal.
    // Please always use the syntax _('string').translate(1, 2) instead of the syntax _.translate('string', 1, 2)
    // Example: ```_('There are $(0) apples in the tree').translate(appleCount)```
    // @param {String} text @return {String}
    function translate(text) {
        if (!text) {
            return '';
        }
        text = text.toString();
        // Turns the arguments object into an array
        var args = Array.prototype.slice.call(arguments), parameters, result = SC.Translations && SC.Translations[text] ? SC.Translations[text] : text;
        if (args.length && result) {
            if (_.isArray(args[1]) && args[1].length) {
                parameters = args[1];
            } else {
                // Mixes in inline variables
                parameters = _.map(args.slice(1), function (param) {
                    return _.escape(param);
                });
            }
            result = result.format.apply(result, parameters);
        }
        return result;
    }
    // @method getFullPathForElement
    // @param {HTMLElement} el
    // @returns {String} a string containing the path in the DOM tree of the element
    function getFullPathForElement(el) {
        var names = [], c, e;
        while (el.parentNode) {
            if (el.id) {
                // if a parent element has an id, that is enough for our path
                names.unshift('#' + el.id);
                break;
            } else if (el === document.body) {
                names.unshift('HTML > BODY');
                break;
            } else if (el === (document.head || document.getElementsByTagName('head')[0])) {
                names.unshift('HTML > HEAD');
                break;
            } else if (el === el.ownerDocument.documentElement) {
                names.unshift(el.tagName);
                break;
            } else {
                e = el;
                for (c = 1; e.previousElementSibling; c++) {
                    e = e.previousElementSibling;
                }
                names.unshift(el.tagName + ':nth-child(' + c + ')');
                el = el.parentNode;
            }
        }
        return names.join(' > ');
    }
    // @method formatCurrency @param {String} value @param {String} symbol @return {String}
    function formatCurrency(value, symbol) {
        var value_float = parseFloat(value), negative = value_float < 0, groupseparator = ',', decimalseparator = '.', negativeprefix = '(', negativesuffix = ')', thousand_string = '', beforeValue = true, sessionInfo = SC.getSessionInfo && SC.getSessionInfo('currentCurrency');
        if (isNaN(value_float)) {
            return value;
        }
        value_float = parseInt((Math.abs(value_float) + 0.005) * 100, 10) / 100;
        var value_string = value_float.toString(), settings = SC && SC.ENVIRONMENT && SC.ENVIRONMENT.siteSettings ? SC.ENVIRONMENT.siteSettings : {};
        if (Object.prototype.hasOwnProperty.call(window, 'groupseparator')) {
            groupseparator = window.groupseparator;
        } else if (Object.prototype.hasOwnProperty.call(settings, 'groupseparator')) {
            groupseparator = settings.groupseparator;
        }
        if (Object.prototype.hasOwnProperty.call(window, 'decimalseparator')) {
            decimalseparator = window.decimalseparator;
        } else if (Object.prototype.hasOwnProperty.call(settings, 'decimalseparator')) {
            decimalseparator = settings.decimalseparator;
        }
        if (Object.prototype.hasOwnProperty.call(window, 'negativeprefix')) {
            negativeprefix = window.negativeprefix;
        } else if (Object.prototype.hasOwnProperty.call(settings, 'negativeprefix')) {
            negativeprefix = settings.negativeprefix;
        }
        if (Object.prototype.hasOwnProperty.call(window, 'negativesuffix')) {
            negativesuffix = window.negativesuffix;
        } else if (Object.prototype.hasOwnProperty.call(settings, 'negativesuffix')) {
            negativesuffix = settings.negativesuffix;
        }
        value_string = value_string.replace('.', decimalseparator);
        var decimal_position = value_string.indexOf(decimalseparator);
        // if the string doesn't contains a .
        if (!~decimal_position) {
            value_string += decimalseparator + '00';
            decimal_position = value_string.indexOf(decimalseparator);
        }    // if it only contains one number after the .
        else if (value_string.indexOf(decimalseparator) === value_string.length - 2) {
            value_string += '0';
        }
        for (var i = value_string.length - 1; i >= 0; i--) {
            //If the distance to the left of the decimal separator is a multiple of 3 you need to add the group separator
            thousand_string = (i > 0 && i < decimal_position && (decimal_position - i) % 3 === 0 ? groupseparator : '') + value_string[i] + thousand_string;
        }
        if (!symbol) {
            if (typeof session !== 'undefined' && session.getShopperCurrency) {
                beforeValue = session.getShopperCurrency().beforeValue;
                symbol = session.getShopperCurrency().symbol;
            } else if (settings.shopperCurrency) {
                beforeValue = settings.shopperCurrency.beforeValue;
                symbol = settings.shopperCurrency.symbol;
            } else if (sessionInfo) {
                beforeValue = sessionInfo.beforeValue;
                symbol = sessionInfo.symbol;
            }
            if (!symbol) {
                symbol = '$';
            }
        }
        value_string = beforeValue || _.isUndefined(beforeValue) ? symbol + thousand_string : thousand_string + symbol;
        return negative ? negativeprefix + value_string + negativesuffix : value_string;
    }
    // @method formatQuantity Formats with commas as thousand separator (e.g. for displaying quantities)
    // @param {String} number @return {String} the formatted quantity.
    function formatQuantity(number) {
        var result = [], parts = ('' + number).split('.'), integerPart = parts[0].split('').reverse();
        for (var i = 0; i < integerPart.length; i++) {
            if (i > 0 && i % 3 === 0 && integerPart[i] !== '-') {
                result.unshift(',');
            }
            result.unshift(integerPart[i]);
        }
        if (parts.length > 1) {
            result.push('.');
            result.push(parts[1]);
        }
        return result.join('');
    }
    // @method highlightKeyword  given a string containing a keyword it highlights it using html strong @param {String} text @param {String} keyword
    function highlightKeyword(text, keyword) {
        text = text || '';
        text = _.escape(text);
        if (!keyword) {
            return text;
        }
        keyword = trim(keyword).replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\\$&');
        return text.replace(new RegExp('(' + keyword + ')', 'ig'), function ($1, match) {
            return '<strong>' + match + '</strong>';
        });
    }
    // @method collectionToString iterates a collection of objects, runs a custom function getValue on each item and then joins them
    // @param {Object} options @returns {String}
    function collectionToString(options) {
        var temp = [];
        _.each(options.collection, function (item) {
            temp.push(options.getValue(item));
        });
        return temp.join(options.joinWith);
    }
    // @method addParamsToUrl
    // @param {String} baseUrl
    // @param {Object} params the params mapping to add @return {String}
    // @param {Boolean} avoidDoubleRedirect If true it will modify all the url parameters to be prepended with __. We do this to prevent Netsuite platform to process some parameters and generate a double redirect. See searchApi.ssp
    // @return {String}
    function addParamsToUrl(baseUrl, params, avoidDoubleRedirect) {
        if (avoidDoubleRedirect) {
            var new_params = {};
            _.each(params, function (param_value, param_key) {
                new_params['__' + param_key] = param_value;
            });
            params = new_params;
        }
        // We get the search options from the config file
        if (baseUrl && !_.isEmpty(params)) {
            var paramString = jQuery.param(params), join_string = ~baseUrl.indexOf('?') ? '&' : '?';
            return baseUrl + join_string + paramString;
        }
        return baseUrl;
    }
    // @method getDecodedURLParameter
    // Takes an url parameter and returns a decoded version of it, if decodeURIComponent() wasn't previously called.
    // Otherwise, returns the character itself.
    // It prevents decodeURIComponent() function gets called twice over the same url parameter (EX: url_parameter = 10%+%20OFF)
    // @param  {String} url_parameter
    // @return {String}
    function getDecodedURLParameter(url_parameter) {
        url_parameter = url_parameter || '';
        var position;
        for (var temporal = ''; (position = url_parameter.indexOf('%')) >= 0; url_parameter = url_parameter.substring(position + 3)) {
            temporal += url_parameter.substring(0, position);
            var extract = url_parameter.substring(position, position + 3);
            try {
                temporal += decodeURIComponent(extract);
            } catch (e) {
                temporal += extract;
            }
        }
        return temporal + url_parameter;
    }
    // @method parseUrlOptions
    // Takes a url with options (or just the options part of the url) and returns an object. You can do the reverse operation (object to url string) using jQuery.param()
    // @param {String} options_string
    // @return {ParameterOptions}
    function parseUrlOptions(options_string) {
        options_string = options_string || '';
        if (~options_string.indexOf('?')) {
            options_string = _.last(options_string.split('?'));
        }
        if (~options_string.indexOf('#')) {
            options_string = _.first(options_string.split('#'));
        }
        //@class ParameterOptions @extend Dictionary<String,String>
        //This class is used as a dictionary where each string key is a parameter from the passed in string and each value
        //is the corresponding value from the string being decodeURIComponent.
        //Example
        // input: /some-item?quantity=2&custcol3=12
        // output: {quantity: decodeURIComponent(2), custcol3: decodeURIComponent(12)}
        var options = {};
        if (options_string.length > 0) {
            var tokens = options_string.split(/\&/g), current_token;
            while (tokens.length > 0) {
                current_token = tokens.shift().split(/\=/g);
                if (current_token[0].length === 0) {
                    continue;
                }
                options[current_token[0]] = Utils.getDecodedURLParameter(current_token[1]);
            }
        }
        return options;
    }
    // @method hyphenate simple hyphenation of a string, replaces non-alphanumerical characters with hyphens
    // @param {String} string
    // @returns {String}
    function hyphenate(string) {
        return string.replace(/[\W]/g, '-');
    }
    var objectToAtrributesKeyMap = [
        'href',
        'id',
        'title',
        'data',
        'data-hashtag',
        'data-touchpoint',
        'data-permissions'
    ];
    // @method objectToAtrributes @param {Object} obj @param {String} prefix @return {String}
    function objectToAtrributes(obj, prefix) {
        prefix = prefix || '';
        return _.reduce(obj, function (memo, value, key) {
            var prefixKey = prefix + key;
            //filters attributes
            if (_.contains(objectToAtrributesKeyMap, prefixKey) === false) {
                return memo;
            }
            if (_.isObject(value)) {
                return memo + objectToAtrributes(obj[key], key + '-');
            } else if (_.isArray(value) === true) {
                return memo + ' ' + _.escape(prefixKey) + '="' + _.escape(value.join(' ')) + '"';
            } else {
                return memo + ' ' + _.escape(prefixKey) + '="' + _.escape(value) + '"';
            }
        }, '');
    }
    // @method isTargetActionable
    // @param {Event} event
    // @return {Boolean}
    function isTargetActionable(event) {
        //return true if the target is actionable
        var target = jQuery(event.target), targetTagName = target.prop('tagName').toLowerCase(), targetParentTagName = target.parent().prop('tagName').toLowerCase(), isCheckbox = target.prop('type') === 'checkbox';
        return targetTagName === 'a' || targetParentTagName === 'a' || targetTagName === 'i' || targetParentTagName === 'button' || targetTagName === 'button' || targetTagName === 'input' && isCheckbox === false;
    }
    // @method resizeImage @param {Array<Object>} sizes @param {String} url @param {String} size the size id @return {String}
    function resizeImage(sizes, url, size) {
        var resize = _.where(sizes, { name: size })[0];
        url = url || '';
        if (!!resize) {
            return url + (~url.indexOf('?') ? '&' : '?') + resize.urlsuffix;
        }
        return url;
    }
    // @method getThemeAbsoluteUrlOfNonManagedResources @param {String} file @returns {String}
    function getThemeAbsoluteUrlOfNonManagedResources(default_value, file) {
        if (!file) {
            file = '';
            if (SC.ENVIRONMENT.isExtended) {
                file = SC.ENVIRONMENT.themeAssetsPath || '';
            } else if (SC.ENVIRONMENT.BuildTimeInf && SC.ENVIRONMENT.BuildTimeInf.isSCLite) {
                if (SC.CONFIGURATION.unmanagedResourcesFolderName) {
                    file = 'site/' + SC.CONFIGURATION.unmanagedResourcesFolderName + '/';
                } else {
                    file = 'default/';
                }
            }
            file += default_value;
        }
        var absoulute_path = getAbsoluteUrl('');
        return file.indexOf(absoulute_path) !== 0 ? getAbsoluteUrl(file) : file;
    }
    // @method getAbsoluteUrl @param {String} file @returns {String}
    function getAbsoluteUrl(file) {
        var base_url = SC && SC.ENVIRONMENT && SC.ENVIRONMENT.baseUrl || '', fileReplace = file ? file : '';
        return base_url ? base_url.replace('{{file}}', fileReplace) : file;
    }
    // @method getAbsoluteUrlOfNonManagedResources @param {String} file @returns {String}
    function getAbsoluteUrlOfNonManagedResources(file) {
        return getAbsoluteUrl(file);
    }
    // @method getDownloadPdfUrl @param {Object} params @returns {String}
    function getDownloadPdfUrl(params) {
        params = params || {};
        params.n = SC && SC.ENVIRONMENT && SC.ENVIRONMENT.siteSettings && SC.ENVIRONMENT.siteSettings.siteid || '';
        return _.addParamsToUrl(_.getAbsoluteUrl('download.ssp'), params);
    }
    // @method getWindow The reason for this method is be able to test logic regarding window.location - so tests can mock the window object @return {HTMLElement} the window global object
    function getWindow() {
        return window;
    }
    // @method doPost Performs a POST operation to a specific url @param {String} url
    function doPost(url) {
        var form = jQuery('<form id="do-post" method="POST" action="' + url + '"></form>').hide();
        // we have to append it to the dom  for browser compatibility
        // check if the form already exists (user could cancel the operation before it gets to the submit)
        var do_post = jQuery('#do-post');
        if (do_post && do_post[0]) {
            do_post[0].action = url;
            do_post[0].method = 'POST';
        } else {
            jQuery('html').append(form);
            do_post = jQuery('#do-post');
        }
        do_post[0].submit();
    }
    // @method getPathFromObject @param {Object} object @param {String} path a path with values separated by dots @param {Any} default_value value to return if nothing is found.
    function getPathFromObject(object, path, default_value) {
        if (!path) {
            return object;
        } else if (object) {
            var tokens = path.split('.'), prev = object, n = 0;
            while (!_.isUndefined(prev) && n < tokens.length) {
                prev = prev[tokens[n++]];
            }
            if (!_.isUndefined(prev)) {
                return prev;
            }
        }
        return default_value;
    }
    // @method setPathFromObject @param {Object} object @param {String} path a path with values separated by dots @param {Any} value the value to set
    function setPathFromObject(object, path, value) {
        if (!path) {
            return;
        } else if (!object) {
            return;
        }
        var tokens = path.split('.'), prev = object;
        for (var token_idx = 0; token_idx < tokens.length - 1; ++token_idx) {
            var current_token = tokens[token_idx];
            if (_.isUndefined(prev[current_token])) {
                prev[current_token] = {};
            }
            prev = prev[current_token];
        }
        prev[_.last(tokens)] = value;
    }
    // @method ellipsis creates the ellipsis animation (used visually while waiting to something) @param {String} selector
    function ellipsis(selector) {
        if (!jQuery(selector).data('ellipsis')) {
            var values = [
                    '',
                    '.',
                    '..',
                    '...',
                    '..',
                    '.'
                ], count = 0, timer = null, element = jQuery(selector);
            element.data('ellipsis', true);
            element.css('visibility', 'hidden');
            element.html('...');
            element.css('width', element.css('width'));
            element.css('display', 'inline-block');
            element.html('');
            element.css('visibility', 'visible');
            timer = setInterval(function () {
                if (jQuery(selector).length) {
                    element.html(values[count % values.length]);
                    count++;
                } else {
                    clearInterval(timer);
                    element = null;
                }
            }, 250);
        }
    }
    // @method reorderUrlParams
    // @param {String} url
    // @return {String} the url with reordered parameters
    function reorderUrlParams(url) {
        var params = [], url_array = url.split('?');
        if (url_array.length > 1) {
            params = url_array[1].split('&');
            return url_array[0] + '?' + params.sort().join('&');
        }
        return url_array[0];
    }
    // @method isShoppingDomain determines if we are in shopping domain (secure or non secure)
    // or single domain
    // @return {Boolean} true if in checkout or in single domain
    function isShoppingDomain() {
        return SC.ENVIRONMENT.siteSettings.shoppingSupported;
    }
    // @method isCheckoutDomain determines if we are in a secure checkout
    // domain or in a secure single domain environment
    // @return {Boolean} true if in checkout or in single domain
    function isCheckoutDomain() {
        return SC.ENVIRONMENT.siteSettings.checkoutSupported;
    }
    // @method isSingleDomain determines if we are in a single domain environment
    // @return {Boolean} true if single domain
    function isSingleDomain() {
        return SC.ENVIRONMENT.siteSettings.isSingleDomain;
    }
    // @method isInShopping determines if we are in shopping ssp
    // used when there are frontend features only shown in the shopping domain
    // @return {Boolean} true if in shopping domain, false if in checkout or myaccount
    function isInShopping() {
        return _.isShoppingDomain() && (SC.ENVIRONMENT.SCTouchpoint === 'shopping' || SC.ENVIRONMENT.siteSettings.sitetype === 'STANDARD');
    }
    // @method isInCheckout determines if we are in checkout or my account ssp
    // @return {Boolean} true if in checkout domain
    function isInCheckout() {
        return !_.isSingleDomain() ? _.isCheckoutDomain() : _.isCheckoutDomain() && (SC.ENVIRONMENT.SCTouchpoint === 'checkout' || SC.ENVIRONMENT.SCTouchpoint === 'myaccount');
    }
    // @method getParameterByName @param {String} url @param {String} param_name
    function getParameterByName(url, param_name) {
        param_name = param_name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + param_name + '=([^&#]*)'), results = regex.exec(url);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }
    function isPageGenerator() {
        return _.result(SC, 'isPageGenerator') || _.result(SC, 'isPageGenerator');
    }
    var SCRIPT_REGEX = /<\s*script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;
    //@function Remove script tags in a html text @param {String} text
    function removeScripts(text) {
        if (isPageGenerator() && text) {
            text = text.replace(/(<!--[\s\S]*?-->)/g, ' $1 ');
            //invalidates de XSS attack like <scr<!--cheat-->ipt> - keep the comment and add spaces
            while (SCRIPT_REGEX.test(text)) {
                text = text.replace(SCRIPT_REGEX, '');
            }
        }
        return text || '';
    }
    //@function Reduce unnecessary spaces in html texts @param {String} text
    function minifyMarkup(text) {
        return text    // remove spaces between tags.
.replace(/\>\s+</g, '><')    // remove html comments that our markup could have.
.replace(/<!--[\s\S]*?-->/g, '')    // replace multiple spaces with a single one.
.replace(/\s+/g, ' ');
    }
    function oldIE(version) {
        var ie_version = version || 7;
        // IE7 detection courtesy of Backbone
        // More info: http://www.glennjones.net/2006/02/getattribute-href-bug/
        var isExplorer = /msie [\w.]+/, docMode = document.documentMode;
        return isExplorer.exec(navigator.userAgent.toLowerCase()) && (!docMode || docMode <= ie_version);
    }
    // @method require The motive for this method is being able to call require() of modules in-line without breaking amd-optimizer because we cannot use require() directly passing variables as dependencies because amd-optimizer will try to parse that and fail.
    // @param {Array<String>} dependencies
    // @param {Function} fn
    var requireModules;
    if (_.isFunction(window.require)) {
        requireModules = window.require;
    } else if (window.SCM) {
        requireModules = function (moduleName) {
            return window.SCM[moduleName];
        };
    } else {
        requireModules = function () {
            console.error('Impossible to retrieve dependencies');
        };
    }
    // we are caching window width so this won't work on window resize. Same for data-templates in views.
    var viewport_width = 0, viewport_height = 0;
    // @method resetViewportWidth resets viewport width explicitly to be updated on resize.
    function resetViewportWidth() {
        viewport_width = 0;
    }
    // @method getViewportWidth @return {Number} the width of the viewport in pixels
    function getViewportWidth() {
        return viewport_width || (viewport_width = jQuery(window).width());
    }
    // @method getViewportHeight @return {Number} the height of the viewport in pixels
    function getViewportHeight() {
        return viewport_height || (viewport_height = jQuery(window).height());
    }
    // @method selectByViewportWidth depending on current viewport width it will return one of the passed options that are named 'phone', 'tablet' or 'desktop'
    // @param {Object<String,Any>} options @param defaultValue @return {Any}
    function selectByViewportWidth(options, defaultValue) {
        var device = getDeviceType();
        return options[device] || defaultValue;
    }
    function getDeviceType(widthToCheck) {
        var width = widthToCheck ? widthToCheck : Utils.getViewportWidth();
        if (width < 768) {
            return 'phone';
        } else if (width < 992) {
            return 'tablet';
        } else {
            return 'desktop';
        }
    }
    function isPhoneDevice() {
        return getDeviceType() === 'phone';
    }
    function isTabletDevice() {
        return getDeviceType() === 'tablet';
    }
    function isDesktopDevice() {
        return getDeviceType() === 'desktop';
    }
    function isNativeDatePickerSupported() {
        var input = document.createElement('input');
        input.setAttribute('type', 'date');
        //if special input is not supported browser will fall back to text
        return input.type !== 'text';
    }
    function initBxSlider($element, options) {
        if ($element.bxSlider && !oldIE() && !SC.isPageGenerator()) {
            $element.bxSlider(options);
        }
        return $element;
    }
    function countItems(lines) {
        var item_count = 0;
        _.each(lines.models ? lines.models : lines, function (line) {
            item_count += line.get('quantity');
        });
        return item_count;
    }
    function getExponentialDelay(options) {
        var settings = options.settings || {
            base: 1.5,
            y: 0.8,
            retries: 2
        };
        return (Math.pow(settings.base, options.x) - settings.y) * 1000;
    }
    // @function imageFlatten
    // Helper function that receives the itemimages_detail (returned by the search api)
    // and flattens it into an array of objects containing url and altimagetext
    // @param {Object} images Receives the itemimages_detail (returned by the search api) which is a multi-level tree-like object grouped by "categories"
    // @return {Array<ImageContainer>}
    function imageFlatten(images) {
        if ('url' in images && 'altimagetext' in images) {
            return [images];
        }
        return _.flatten(_.map(images, function (item) {
            if (_.isArray(item)) {
                return item;
            }
            return imageFlatten(item);
        }));
    }
    var Utils = SC.Utils = {
        translate: translate,
        formatPhone: formatPhone,
        dateToString: dateToString,
        isDateValid: isDateValid,
        stringToDate: stringToDate,
        validatePhone: validatePhone,
        trim: trim,
        validateState: validateState,
        validateZipCode: validateZipCode,
        validateSecurityCode: validateSecurityCode,
        formatCurrency: formatCurrency,
        formatQuantity: formatQuantity,
        highlightKeyword: highlightKeyword,
        getFullPathForElement: getFullPathForElement,
        collectionToString: collectionToString,
        countItems: countItems,
        addParamsToUrl: addParamsToUrl,
        parseUrlOptions: parseUrlOptions,
        objectToAtrributes: objectToAtrributes,
        isTargetActionable: isTargetActionable,
        resizeImage: resizeImage,
        hyphenate: hyphenate,
        getAbsoluteUrl: getAbsoluteUrl,
        getAbsoluteUrlOfNonManagedResources: getAbsoluteUrlOfNonManagedResources,
        getThemeAbsoluteUrlOfNonManagedResources: getThemeAbsoluteUrlOfNonManagedResources,
        getWindow: getWindow,
        getDownloadPdfUrl: getDownloadPdfUrl,
        doPost: doPost,
        getPathFromObject: getPathFromObject,
        setPathFromObject: setPathFromObject,
        ellipsis: ellipsis,
        reorderUrlParams: reorderUrlParams,
        getParameterByName: getParameterByName,
        isPageGenerator: isPageGenerator,
        removeScripts: removeScripts,
        minifyMarkup: minifyMarkup,
        oldIE: oldIE,
        requireModules: requireModules,
        getViewportWidth: getViewportWidth,
        getViewportHeight: getViewportHeight,
        isPhoneDevice: isPhoneDevice,
        isTabletDevice: isTabletDevice,
        isDesktopDevice: isDesktopDevice,
        isNativeDatePickerSupported: isNativeDatePickerSupported,
        selectByViewportWidth: selectByViewportWidth,
        isShoppingDomain: isShoppingDomain,
        isCheckoutDomain: isCheckoutDomain,
        isSingleDomain: isSingleDomain,
        isInShopping: isInShopping,
        isInCheckout: isInCheckout,
        resetViewportWidth: resetViewportWidth,
        getDeviceType: getDeviceType,
        initBxSlider: initBxSlider,
        getExponentialDelay: getExponentialDelay,
        imageFlatten: imageFlatten,
        deepCopy: deepCopy,
        getDecodedURLParameter: getDecodedURLParameter
    };
    // We extend underscore with our utility methods
    // see http://underscorejs.org/#mixin
    _.mixin(Utils);
    return Utils;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module SC
// @class SC.Configuration
// This class is responsible of creating the front end SC.Configuration object from the properties bootstrapped in SC.CONFIGURATION from backend. Also it does some properties post processing.
define('SC.Configuration', [
    'product_views_option_radio.tpl',
    'product_views_option_tile.tpl',
    'product_views_option_text.tpl',
    'product_views_option_color.tpl',
    'product_views_option_dropdown.tpl',
    'product_views_option_facets_color.tpl',
    'product_views_option_facets_tile.tpl',
    'transaction_line_views_selected_option.tpl',
    'transaction_line_views_selected_option_color.tpl',
    'underscore',
    'jQuery',
    'Utils'
], function (product_views_option_radio_tpl, product_views_option_tile_tpl, product_views_option_text_tpl, product_views_option_color_tpl, product_views_option_dropdown_tpl, product_views_option_facets_color_tpl, product_views_option_facets_tile_tpl, transaction_line_views_selected_option_tpl, transaction_line_views_selected_option_color_tpl, _, jQuery, Utils) {
    'use strict';
    var baseConfiguration = SC.CONFIGURATION || {};
    baseConfiguration.ItemOptions = baseConfiguration.ItemOptions || {};
    baseConfiguration.ItemOptions.defaultTemplates = baseConfiguration.ItemOptions.defaultTemplates || {
        //@class ItemOptions.DefaultTemplates
        //@property {DefaultOptionTemplateSpecification} selectorByType
        // each apply to specific item option types
        selectorByType: {
            select: product_views_option_tile_tpl,
            'default': product_views_option_text_tpl
        }    // for rendering selected options in the shopping cart
,
        selectedByType: { 'default': transaction_line_views_selected_option_tpl },
        facetCellByType: { 'default': product_views_option_facets_color_tpl }
    };
    var item_option_templates = {
        'transaction_line_views_selected_option_color.tpl': transaction_line_views_selected_option_color_tpl,
        'transaction_line_views_selected_option.tpl': transaction_line_views_selected_option_tpl,
        'product_views_option_color.tpl': product_views_option_color_tpl,
        'product_views_option_dropdown.tpl': product_views_option_dropdown_tpl,
        'product_views_option_radio.tpl': product_views_option_radio_tpl,
        'product_views_option_text.tpl': product_views_option_text_tpl,
        'product_views_option_tile.tpl': product_views_option_tile_tpl,
        'product_views_option_facets_color.tpl': product_views_option_facets_color_tpl,
        'product_views_option_facets_tile.tpl': product_views_option_facets_tile_tpl
    };
    _.each(baseConfiguration.ItemOptions.optionsConfiguration || [], function (item_option) {
        if (item_option.templateSelected && item_option_templates[item_option.templateSelected]) {
            item_option.templates = item_option.templates || {};
            item_option.templates.selected = item_option_templates[item_option.templateSelected];
        }
        if (item_option.templateSelector && item_option_templates[item_option.templateSelector]) {
            item_option.templates = item_option.templates || {};
            item_option.templates.selector = item_option_templates[item_option.templateSelector];
        }
        if (item_option.templateFacetCell && item_option_templates[item_option.templateFacetCell]) {
            item_option.templates = item_option.templates || {};
            item_option.templates.facetCell = item_option_templates[item_option.templateFacetCell];
        }
    });
    var Configuration = {
        searchPrefs: {
            // Keyword formatter function will format the text entered by the user in the search box. This default implementation will remove invalid keyword characters like *()+-="
            keywordsFormatter: function (keywords) {
                if (keywords === '||') {
                    return '';
                }
                var anyLocationRegex = /[\(\)\[\]\{\~\}\!\"\:\/]{1}/g    // characters that cannot appear at any location
, beginingRegex = /^[\*\-\+]{1}/g    // characters that cannot appear at the begining
, replaceWith = '';
                // replacement for invalid chars
                return keywords.replace(anyLocationRegex, replaceWith).replace(beginingRegex, replaceWith);
            }
        },
        bxSliderDefaults: {
            minSlides: 2,
            slideWidth: 228,
            maxSlides: 5,
            forceStart: true,
            pager: false,
            touchEnabled: true,
            nextText: '<a class="item-relations-related-carousel-next"><span class="control-text">' + _('next').translate() + '</span> <i class="carousel-next-arrow"></i></a>',
            prevText: '<a class="item-relations-related-carousel-prev"><i class="carousel-prev-arrow"></i> <span class="control-text">' + _('prev').translate() + '</span></a>',
            controls: true,
            preloadImages: 'all'
        },
        siteSettings: SC && SC.ENVIRONMENT && SC.ENVIRONMENT.siteSettings || {},
        get: function (path, defaultValue) {
            return _.getPathFromObject(this, path, defaultValue);
        },
        getRegistrationType: function () {
            //registrationmandatory is 'T' when customer registration is disabled
            if (Configuration.get('siteSettings.registration.registrationmandatory') === 'T') {
                // no login, no register, checkout as guest only
                return 'disabled';
            } else {
                if (Configuration.get('siteSettings.registration.registrationoptional') === 'T') {
                    // login, register, guest
                    return 'optional';
                } else {
                    if (Configuration.get('siteSettings.registration.registrationallowed') === 'T') {
                        // login, register, no guest
                        return 'required';
                    } else {
                        // login, no register, no guest
                        return 'existing';
                    }
                }
            }
        }
    };
    // Deep extend
    jQuery.extend(true, baseConfiguration, Configuration);
    //BACKWARDS COMPATIBILITY: all the following is a normalization to the object baseConfiguration to guarantee backguard compatibility with pre montblanc in the sense of configuration property names in application.getConfig('foo')
    //fixing some properties for backward compatibility w montblanc:
    var imageSizeMapping = {};
    _.each(baseConfiguration.imageSizeMapping, function (item) {
        imageSizeMapping[item.id] = item.value;
    });
    baseConfiguration.imageSizeMapping = imageSizeMapping;
    var searchApiMasterOptions = {};
    _.each(baseConfiguration.searchApiMasterOptions, function (item) {
        searchApiMasterOptions[item.id] = {
            fieldset: item.fieldset,
            include: item.include
        };
    });
    baseConfiguration.searchApiMasterOptions = searchApiMasterOptions;
    //social sharing backward compatibility
    var addThisOptions = {};
    _.each(baseConfiguration.addThis && baseConfiguration.addThis.options, function (item) {
        addThisOptions[item.key] = item.value;
    });
    baseConfiguration.addThis && (baseConfiguration.addThis.options = addThisOptions);
    var addThisServicesToShow = {};
    _.each(baseConfiguration.addThis && baseConfiguration.addThis.servicesToShow, function (item) {
        addThisServicesToShow[item.key] = item.value;
    });
    baseConfiguration.addThis && (baseConfiguration.addThis.servicesToShow = addThisServicesToShow);
    _.each(baseConfiguration.paymentmethods, function (item) {
        try {
            if (item.regex) {
                item.regex = new RegExp(item.regex);
            }
        } catch (ex) {
        }
    });
    if (baseConfiguration.productReviews && baseConfiguration.productReviews.sortOptions) {
        _.each(baseConfiguration.productReviews.sortOptions, function (sortOptions) {
            try {
                sortOptions.params = JSON.parse(sortOptions.params || '{}') || {};
            } catch (ex) {
            }
        });
    }
    if (baseConfiguration.productReviews && baseConfiguration.productReviews.filterOptions) {
        _.each(baseConfiguration.productReviews.filterOptions, function (filterOptions) {
            try {
                filterOptions.params = JSON.parse(filterOptions.params || '{}') || {};
            } catch (ex) {
            }
        });
    }
    //extraTranslations
    var currentLocale = SC && SC.ENVIRONMENT && SC.ENVIRONMENT.currentLanguage && SC.ENVIRONMENT.currentLanguage.locale;
    _.each(baseConfiguration.extraTranslations, function (item) {
        if (item[currentLocale]) {
            SC.Translations[item.key] = item[currentLocale];
        }
    });
    //navigation data
    baseConfiguration.navigationData = baseConfiguration.navigationData || [];
    // navigation hierarchy bindings.
    _.each(baseConfiguration.navigationData, function (entry) {
        if (!entry) {
            return;
        } else {
            // These 2 ifs were done for backwards compatibility.
            // The correct way of fixing it would have been modifying the navigation.json
            // Replacing dataTouchpoint with data-touchpoint and dataHashtag with data-hashtag.
            // This way when rendering the Header.Menu.View it will pass the entry to
            // Utils.objectToAtrributes and pass the property name filter
            if (entry.dataTouchpoint) {
                entry['data-touchpoint'] = entry.dataTouchpoint;
            }
            if (entry.dataHashtag) {
                entry['data-hashtag'] = entry.dataHashtag;
            }
            if (entry.placeholder) {
                entry.text = '';
            }
            entry['class'] = 'header-menu-level' + entry.level + '-anchor';
        }
        if (entry.parentId) {
            var parent = _.find(baseConfiguration.navigationData, function (e) {
                return e.id === entry.parentId;
            });
            parent = parent || {};
            parent.categories = parent.categories || [];
            parent.categories.push(entry);
        }
        if (entry.classnames) {
            entry['class'] += ' ' + entry.classnames;
        }
    });
    // Now, remove  non top level nav entries from the array (root nodes)
    // heads up ! we have to re-iterate :( this is the correct way of deleting and iterating an array - not _.each()
    for (var i = 0; i < baseConfiguration.navigationData.length; i++) {
        var entry = baseConfiguration.navigationData[i];
        if (!entry || entry.level > 1) {
            baseConfiguration.navigationData.splice(i, 1);
            i--;
        }
    }
    Utils.setPathFromObject(baseConfiguration, 'forms.address.showAddressLine2', Utils.getPathFromObject(baseConfiguration, 'forms.address.showAddressLineTwo', true));
    return baseConfiguration;
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Wizard
define('Wizard.Module', [
    'wizard_module.tpl',
    'GlobalViews.Message.View',
    'Backbone',
    'underscore',
    'jQuery'
], function (wizard_module_tpl, GlobalViewsMessageView, Backbone, _, jQuery) {
    'use strict';
    // @class Wizard.Module Abstract Representation of a Wizard Module @extends Backbone.View
    return Backbone.View.extend({
        tagName: 'article',
        template: wizard_module_tpl    // @property {Array} errors
,
        errors: [],
        initialize: function (options) {
            this.wizard = options.wizard;
            this.step = options.step;
            this.model = options.wizard.model;
            this.module_id = options.module_id || (this.template ? this.template.Name : '');
            // errors array in the configuration file completely overrides the default one.
            if (options.errors) {
                this.errors = options.errors;
            }
        }    // @method disableInterface General method to disable the module interface called at the moment of submitting the step
,
        disableInterface: jQuery.noop,
        enableInterface: jQuery.noop,
        refresh: jQuery.noop,
        _render: function () {
            var ret;
            if (!this.isActive()) {
                ret = this.$el.empty();
            } else {
                this.$el.addClass('module-rendered');
                ret = Backbone.View.prototype._render.apply(this, arguments);
                // add the error message box to the module
                if (!this.$('[data-type="alert-placeholder-module"]').length) {
                    this.$el.prepend('<div data-type="alert-placeholder-module"></div>');
                }
                // we show module errors (if any) and remove the error object
                if (this.error) {
                    this.showError();
                }
            }
            // We trigger the resize event of the body as the DOM is changed
            // and some components might be positioned based on the body size
            jQuery(document.body).trigger('resize');
            return ret;
        }    // @method submit by default, a module returns it's validation promise. @returns {jQuery.Deferred}
,
        submit: function () {
            return this.isValid();
        }    // @method cancel @returns {jQuery.Deferred}
,
        cancel: function () {
            return jQuery.Deferred().resolve();
        }    // @method isValid validate resolves a promise because maybe it needs to do some ajax for validation @returns {jQuery.Deferred}
,
        isValid: function () {
            return jQuery.Deferred().resolve();
        }    // @method isActive Base implementation to determines is a module is active (can be submitted, rendered or just use) or not. @returns {Boolean}
,
        isActive: function () {
            return _.isFunction(this.options.isActive) ? this.options.isActive.apply(this, arguments) : true;
        }    // @method getTitle returns the title of the module, can be overridden in the configuration file. @returns {String}
,
        getTitle: function () {
            return _.isFunction(this.options.title) ? this.options.title.apply(this) : this.options.title || this.title || '';
        }    // @method manageError @param {Wizard.Module.Error} error
,
        manageError: function (error) {
            if (this.state !== 'future' && this.isActive()) {
                //@property {Wizard.Module.Error} error the current error object if any
                this.error = error;
                this.trigger('error', error);
                // if the module is being shown we show the error
                if (this.wizard.getCurrentStep() === this.step) {
                    this.showError();
                }
            }
        }    // @method showError render the error message
,
        showError: function () {
            var global_view_message = new GlobalViewsMessageView({
                message: this.error.errorMessage,
                type: 'error',
                closable: true
            });
            //Note: in special situations (like in payment-selector), there are modules inside modules, so we have several place holders, so we only want to show the error in the first place holder.
            var error_container = this.$('[data-type="alert-placeholder-module"]:first'), error_container_parent = error_container.parents('.module-rendered:last');
            if (error_container_parent.length) {
                //may be more than one, we are interested in the last one
                jQuery('html, body').animate({ scrollTop: jQuery(error_container_parent[0]).offset().top }, 600);
            }
            error_container.html(global_view_message.render().$el.html());
            this.error = null;
        }    // @method clearError empty the error message container
,
        clearError: function () {
            this.$('[data-type="alert-placeholder-module"]').empty();
            this.error = null;
        }    // @method clearGeneralMessages General method to clear any message at step level
,
        clearGeneralMessages: function () {
            jQuery('[data-type="alert-placeholder-module"]:first').empty();
        }    // @method showGeneralMessage Notify a message (not just an error) at step level. Type can be a boolean (true: for errors, false: for success) or string to add a class alert-<type>
,
        showGeneralMessage: function (message, type) {
            var message_type = _.isString(type) ? type : type && 'error' || 'success';
            var global_view_message = new GlobalViewsMessageView({
                message: message,
                type: message_type,
                closable: true
            });
            jQuery('[data-type="alert-placeholder-module"]:first').html(global_view_message.render().$el.html());
        }
    });
});    //@class Wizard.Module.Error 
       //@property {String} errorMessage
       //@property {String} errorCode


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module Backbone.CompositeView @class Backbone.CompositeView
#Description

The module Backbone.CompositeView adds support for Backbone Views composition.

#Define a Composite View

Since Elbrus, all Backbone.View are CompositeView by default so there is no need to required
'Backbone.CompositeView' and call the 'CompositeView.add(this)' method.
To make it backwards compatible, we made the 'CompositeView.add()' method a 'noop' method, so
you will get no errors if you call it from your code

Before Elbrus:

```js
	var CompositeView = require('Backbone.CompositeView');
	var MyView = new backbone.View.extend({
		initialize: function()
		{
			CompositeView.add(this);
			//now this view is a composite view!
		}
	});
```

After Elbrus:

```js
	var MyView = new backbone.View.extend({
		initialize: function()
		{
			//every view now is a composite view!
		}
	});
```

#Composition by View definition

Another change since Elbrus is that a data-view is now a container for multiple children views.

The parent view needs to declare a place holder element in its template to render the children
in it.

```html
	<div data-view="Buttons"></div>
```

The parent view must also declare how its sub views will be created. For doing so it declares the
'childViews' property which is an object with properties that are the name of the children views.
The value of those properties are objects that define 2 properties, 'childViewIndex' and 'childViewConstructor'

```js
	childViews: {
		'Buttons': {
			'Whishlist': {
				'childViewIndex': 10
			,	'childViewConstructor': function() {
					return new WhishlistView();
				}
			}
			'SaveForLater': {
				'childViewIndex': 20
			,	'childViewConstructor': SomeView
			}
		}
	}
```

'childViewIndex': is the order in which the children will be rendered in that container.
'childViewConstructor': can be either functions or Backbone.View subclasses. Each defined function
must return an instance of a Backbone.View.

To make it backward compatible, we will still supporting the old format:

```js
	childViews: {
		'Promocode': function()
		{
			return new PromocodeView({model: this.model.get('promocode')});
		}
	,	'SomeWidget': SomeWidget
	}
```

In this case, the container and the view name will have the same, and in the 'childViews' property,
you can combine the old and the new format.


The function callback takes as an arguments the data attributes of the element placeholder. For example if a placeholder
element contains a data attribute named color

```html
	<div data-view="Rectangles.View" data-color="#FF0000"></div>
```

The function callback will have an key named color using that value.

```js
	childViews: {
		'Rectangles.View':
		{
			'RectangleRed':
			{
				childViewIndex: 10
			,	childViewConstructor: function(options)
				{
					return new RectangleView({ color: options.color });
				}
			}
		}
	}
```

In the case of Backbone.View subclasses in the childViews properties the options are passed to the initialize function.
So the previous example could be written as

```js
	childViews: {
		'Rectangles.View':
		{
			'RectangleRed':
			{
				childViewIndex: 10
			,	childViewConstructor: RectangleView
			}
		}
	}
```

##Summary

So in summary, the parent view has all the responsibility of declaring the location of the child
views in the markup and to instantiate its child views by name. Also has the responsibility of
destroying its children and this is done automatically.

Children constructor functions and children instances are available in the parent view.
There is children to parent references in the 'parentView' property and also a boolean 'hasParent'.

#Composition by Extension

Any view declared as Composite View can be extended with new child views externally by passing certain properties when initializing it.
This is extremely useful when developing components.

In this case, as in Composition by View definition, the template must indicate the location where the child view will be located by
adding a data-view attribute.

```html
	<div data-view="ExternalChildViews"></div>
```

When initializing a component view that is composite you can pass in its options a property called 'childViews' that resemble the
'childViews'.
Example:

```js

//...

var component = new MyComponent({
	childViews: {
		ExternalChildViews: function (component_model)
		{
			SomeView:
			{
				childViewIndex: 10
			,	childViewConstructor: function ()
			{
				return new RectangleView();
			}
		}
	}
})

```

*/
define('Backbone.CompositeView', [
    'Backbone.View',
    'Backbone',
    'jQuery',
    'underscore',
    'Utils',
    'PluginContainer'
], function (BackboneView, Backbone, jQuery, _, Utils, PluginContainer) {
    'use strict';
    var compositeView = {
        // @method destroyCompositeView Destroy all the child view instances
        destroyCompositeView: function destroyCompositeView() {
            var self = this;
            _(this.childViewInstances).each(function (container, container_name) {
                _.each(container, function (generator, view_name) {
                    self.removeChildViewInstance(container_name, view_name);
                });
            });
        }    // @method renderChild Creates and render a childView
             // @param {DOM|String}elementOrViewName The DOM element or the name of the childView
             // @return {Backbone.View}
,
        renderChild: function renderChild(elementOrViewName) {
            //console.warn('DEPRECATED: "Backbone.View.renderChild(params)" is deprecated. Use "Backbone.CompositeView.renderChildViewContainer(params)" instead');
            if (typeof elementOrViewName !== 'string') {
                elementOrViewName = jQuery(elementOrViewName).data('view');
            }
            if (elementOrViewName) {
                this.renderChildViewContainer(elementOrViewName, true);
            }
            return this.getChildViewInstance(elementOrViewName);
        }    // @method renderCompositeView Creates and renders the childViews
,
        renderCompositeView: function renderCompositeView() {
            // @event beforeCompositeViewRender triggered just before a view's children finish rendering in the DOM
            this.trigger('beforeCompositeViewRender', this);
            this._createChildViewInstances();
            this._renderChildViewInstances();
            Backbone.View.afterCompositeViewRender.executeAll(this);
            // @event afterCompositeViewRender triggered when a view's children finish rendering in the DOM
            this.trigger('afterCompositeViewRender', this);
        }    // @method _renderChildViewInstances Render the all the childViews
             // @private
,
        _renderChildViewInstances: function _renderChildViewInstances() {
            var self = this;
            _.each(this.childViewInstances, function (child_views, container_name) {
                self.renderChildViewContainer(container_name);
            });
        }    // @method _renderChildViewInstance Render a childView
             // @param {Backbone.View} child_view_instance The instance of the childview
             // @param {String} placeholder Where to insert the childView
             // @param {Number} number_views The number of views of the container of the childView
             // @private
,
        _renderChildViewInstance: function _renderChildViewInstance(child_view_instance, placeholder, number_views, isExternal) {
            if (child_view_instance) {
                this._setCustomTemplate(child_view_instance);
                if (number_views === 1 && !isExternal) {
                    this._finishRender(child_view_instance, this.$el.find(placeholder));
                } else {
                    child_view_instance.render();
                    this.$(placeholder).append(child_view_instance.$el);
                }
            }
        }    // @method renderChildViewContainer Renders the childViews of a container
             // @param {String} container_name The name of the container
             // @param {Boolean} create_child Indicate if the childView instnace is created
,
        renderChildViewContainer: function renderChildViewContainer(container_name, create_child) {
            var self = this, generators = _.values(this.childViewInstances[container_name]);
            generators.sort(function (a, b) {
                return a.childViewIndex - b.childViewIndex;
            });
            _.each(generators, function (generator) {
                if (create_child) {
                    self.createChildViewInstance(generator);
                }
                var placeholder = self._getPlaceholder(generator.childViewSelector);
                self._renderChildViewInstance(generator.childViewInstance, placeholder, generators.length, generator.childViewIsExternal);
            });
        }    // @method_getPlaceholder
             // @param {Object} selector
             // @return {String}
             // @private
,
        _getPlaceholder: function _getPlaceholder(selector) {
            var placeholder = '';
            _.each(selector, function (value, key) {
                placeholder += '[' + key + '="' + value + '"]';
            });
            return placeholder;
        }    // @method _createChildViewInstances Create instances of all childViews
             // @private
,
        _createChildViewInstances: function _createChildViewInstances() {
            var self = this;
            _.each(this.childViewInstances, function (child_views) {
                _.each(child_views, function (generator) {
                    var placeholder = self._getPlaceholder(generator.childViewSelector), $element = self.$(placeholder);
                    if ($element.length) {
                        if (generator.childViewConstructor) {
                            self.createChildViewInstance(generator, $element.data());
                        }
                    }
                });
            });
        }    // @method createChildViewInstance Create a instance of a childView
             // @param {Object} generator The generator of the childView
             // @param {Object} element_data Data of the DOM to initialize the instance
             // @return {Backbone.View} return the instance of the childView
,
        createChildViewInstance: function createChildViewInstance(generator, element_data) {
            element_data = element_data || {};
            var options = _.extend({}, element_data, this.options);
            if (generator.childViewInstance) {
                generator.childViewInstance.destroy(true);
            }
            if (generator.childViewConstructor.extend === Backbone.View.extend) {
                // special case of 'Some.View': SomeView
                // generator.childViewInstance = new generator.childViewConstructor(options);
                generator.childViewInstance = generator.childViewIsExternal ? new generator.childViewConstructor() : new generator.childViewConstructor(options);
            } else {
                // common case 'Some.View': function() { ... }
                generator.childViewInstance = generator.childViewIsExternal ? generator.childViewConstructor.call(null) : generator.childViewConstructor.call(this, options);
                if (_.isFunction(generator.childViewInstance)) {
                    generator.childViewInstance = generator.childViewInstance();
                }
            }
            if (generator.childViewInstance) {
                if (!generator.childViewIsExternal || generator.childViewInstance.parentView) {
                    generator.childViewInstance.parentView = generator.childViewIsExternal ? this : generator.childViewInstance.parentView || this;
                    generator.childViewInstance.hasParent = true;
                }
                var context_data_request = generator.childViewInstance.getContextDataRequest();
                if (context_data_request.length) {
                    var context_data = this.getContextData(context_data_request);
                    if (generator.childViewInstance.validateContextDataRequest(context_data)) {
                        generator.childViewInstance.contextData = context_data;
                    } else {
                        console.error('Requested context data is not valid for this child view instance.');
                        generator.childViewInstance = null;
                        return null;
                    }
                }
                generator.childViewInstance.placeholderData = element_data || {};
                generator.childViewInstance._originalTemplate = generator.childViewInstance.template;
                if (!(generator.childViewInstance.attributes && generator.childViewInstance.attributes['data-root-component-id'])) {
                    generator.childViewInstance.attributes = generator.childViewInstance.attributes || {};
                    generator.childViewInstance.attributes['data-root-component-id'] = this.attributes && this.attributes['data-root-component-id'] || '';
                }
                this._setCustomTemplate(generator.childViewInstance);
            }
            return generator.childViewInstance;
        }    // @method addChildViewInstances Add childViews to this View
             // @param {Object} child_views The view to be added
             // @param {Boolean} render Indicates if the childViews needs to be rendered
,
        addChildViewInstances: function addChildViewInstances(child_views, render) {
            var self = this;
            _.each(child_views, function (child_view, child_view_container) {
                if (!self.childViewInstances[child_view_container]) {
                    self.childViewInstances[child_view_container] = {};
                }
                var childViewSelector = child_view_container.indexOf('cms:') === 0 ? { 'data-cms-area': child_view_container.replace('cms:', '') } : { 'data-view': child_view_container };
                if (_.isFunction(child_view)) {
                    //console.warn('This --- will be deprecated, please use the follow format ---');
                    self.childViewInstances[child_view_container][child_view_container] = {
                        childViewIndex: 10,
                        childViewConstructor: child_view,
                        childViewInstance: null    // initialize??
,
                        childViewSelector: childViewSelector
                    };
                } else {
                    _.each(child_view, function (child_view_generator, child_view_name) {
                        self.childViewInstances[child_view_container][child_view_name] = {
                            childViewIndex: child_view_generator.childViewIndex || 10,
                            childViewConstructor: child_view_generator.childViewConstructor,
                            childViewInstance: child_view_generator.childViewInstance,
                            childViewSelector: child_view_generator.childViewSelector || childViewSelector,
                            childViewIsExternal: child_view_generator.childViewIsExternal
                        };
                        if (child_view_generator.childViewInstance) {
                            var placeholder = self._getPlaceholder(child_view_generator.childViewSelector);
                            if (!child_view_generator.childViewIsExternal || child_view_generator.childViewInstance.parentView) {
                                child_view_generator.childViewInstance.parentView = child_view_generator.childViewIsExternal ? self : child_view_generator.childViewInstance.parentView || self;
                                child_view_generator.childViewInstance.hasParent = true;
                            }
                            child_view_generator.childViewInstance.placeholderData = self.$(placeholder).data() || {};
                            child_view_generator.childViewInstance._originalTemplate = child_view_generator.childViewInstance.template;
                            if (!(child_view_generator.childViewInstance.attributes && child_view_generator.childViewInstance.attributes['data-root-component-id'])) {
                                child_view_generator.childViewInstance.attributes = child_view_generator.childViewInstance.attributes || {};
                                child_view_generator.childViewInstance.attributes['data-root-component-id'] = self.attributes && self.attributes['data-root-component-id'] || '';
                            }
                            self._setCustomTemplate(child_view_generator.childViewInstance);
                        }
                    });
                }
                if (render) {
                    self.renderChildViewContainer(child_view_container);
                }
            });
        }    // @method getChildViewInstance Get a particular childView
             // @param {String} container_name The name of the container_name
             // @param {String} child_view_name The name of the view
             // @return {Backbone.View}
,
        getChildViewInstance: function getChildViewInstance(container_name, child_view_name) {
            child_view_name = child_view_name || container_name;
            return this.childViewInstances[container_name] && this.childViewInstances[container_name][child_view_name] && this.childViewInstances[container_name][child_view_name].childViewInstance;
        }    // @method getChildViewInstances Returns an Array of all the childViews instances
             // @param {String|null} container_name The name of the container (Optional)
             // @return {Array<Backbone.View>}
,
        getChildViewInstances: function getChildViewInstances(container_name) {
            var all_child_views = [];
            if (container_name) {
                _.each(this.childViewInstances[container_name], function (child_view_generator) {
                    if (child_view_generator.childViewInstance) {
                        all_child_views.push(child_view_generator.childViewInstance);
                    }
                });
            } else {
                _.each(this.childViewInstances, function (child_views) {
                    _.each(child_views, function (child_view_generator) {
                        if (child_view_generator.childViewInstance) {
                            all_child_views.push(child_view_generator.childViewInstance);
                        }
                    });
                });
            }
            return all_child_views;
        }    //@method updateChildViewInstances updates the render settings or the selector
             //@param {String} selector Where the child view will be inserted
             //@param {Backbone.View} child_instance Child View to be added
             //@param {Backbone.CompositeView.AddChildView.Settings} render_settings Indicate how the insertion must be done. Information like where the child view will be placed
             //@return {Void}
,
        updateChildViewInstances: function updateChildViewInstances(child_views, render) {
            var self = this, promises = [];
            _.each(child_views, function (child_view, container_name) {
                _.each(child_view, function (generator, child_view_name) {
                    promises.push(self.removeChildViewInstance(container_name, child_view_name));
                });
            });
            return jQuery.when(promises).then(function () {
                self.addChildViewInstances(child_views, render);
            });
        }    //@method removeChildViewInstance Removes a child view instance from the current view. Optionally destroy the child view
             //@param {Backbone.View} child_instance Instance to be removed
             //@param {Boolean} destroy Indicate if the child view will be also destroyed.
             //@return {jQuery.Deferred|undefined}
,
        removeChildViewInstance: function removeChildViewInstance(container_name, child_view_name, destroy) {
            if (this.childViewInstances[container_name] && this.childViewInstances[container_name][child_view_name]) {
                var child_view_instance = this.childViewInstances[container_name][child_view_name].childViewInstance;
                destroy && delete this.childViewInstances[container_name][child_view_name];
                if (child_view_instance) {
                    child_view_instance.$el.detach();
                    return child_view_instance.destroy(!destroy);
                }
            }
        },
        _getCustomTemplatePrefix: function _getCustomTemplatePrefix() {
            return [
                'cell-',
                'row-',
                'child-',
                ''
            ];
        }    // @method _setCustomTemplate Select the best templated based on the current view port with and set it to the child view
             // @param {Backbone.View} child_view Instance of the child view to be inserted
,
        _setCustomTemplate: function _setCustomTemplate(child_view) {
            var template_prefix = this._getCustomTemplatePrefix();
            _.each(template_prefix, function (prefix) {
                var template_name = child_view.placeholderData[prefix + 'template'];
                // if (template_name)
                // {
                var definitive_template_name = Utils.selectByViewportWidth({
                    phone: child_view.placeholderData[prefix + 'phoneTemplate']    //remember that data-phone-template get's converted in phoneTemplate when we use jQuery.data()
,
                    tablet: child_view.placeholderData[prefix + 'tabletTemplate'],
                    desktop: template_name
                }, template_name);
                if (definitive_template_name) {
                    // IMPORTANT: we are require()ing the template dynamically! In order to this to work, the template should
                    // be ALREADY loaded and this is automatically handled at build time by gulp template
                    child_view[prefix ? prefix + 'Template' : 'template'] = Utils.requireModules(definitive_template_name + '.tpl');
                } else {
                    child_view[prefix ? prefix + 'Template' : 'template'] = child_view._originalTemplate;
                }    // }
            });
        }    // @method _finishRender Render the child view and insert its result into the placeholder
             // @param {Backbone.View} child_view Instance of the view to be inserted
             // @param {jQuery} $placeholder Element container of the child. This is the div that contains the tag data-view="..."
,
        _finishRender: function _finishRender(child_view, $placeholder) {
            //HEADS UP! we use the placeholder as the children view's container element ($el)
            child_view.$el = $placeholder;
            // keep the placeholder classes
            var placeholder_class = $placeholder.attr('class');
            child_view.className = (child_view.className || '') + ' ' + (placeholder_class || '');
            child_view.render();
        },
        setChildViewIndex: function setChildViewIndex(container_name, view_name, index, render) {
            if (this.childViewInstances[container_name] && this.childViewInstances[container_name][view_name]) {
                this.childViewInstances[container_name][view_name].childViewIndex = index;
                if (render) {
                    this.render();
                }
            }
        },
        contextData: {}    // ie: contexts = ['item', 'order']
,
        getContextData: function (contexts) {
            var contextData = {}, i = contexts.length;
            while (i--) {
                var selfContextData = _.extend({}, this.contextData, this.constructor.contextData);
                if (selfContextData[contexts[i]]) {
                    contextData[contexts[i]] = _.bind(selfContextData[contexts[i]], this);
                    contexts.splice(i, 1);
                }
            }
            if (contexts.length && this.parentView) {
                return _.extend(this.parentView.getContextData(contexts), contextData);
            }
            return contextData;
        }
    };
    _.extend(Backbone.View.prototype, compositeView);
    // @module Backbone @class Backbone.View
    // @property {PluginContainer} afterCompositeViewRender Plugins registered here will be called when
    // a composite view finish rendering it self and all its children.
    Backbone.View.afterCompositeViewRender = new PluginContainer();
    // @method addExtraChildrenViews Allows adding extra child view to any view.
    // This property will be read by the class Backbone.CompositeView when initializing a view
    // @param {ExtraChildView} option_views
    // @return {Void}
    // @static
    Backbone.View.addExtraChildrenViews = function addExtraChildrenViews(option_views) {
        console.warn('DEPRECATED: "Backbone.View.addExtraChildrenViews(params)" is deprecated. Use "Backbone.CompositeView.addChildViews(params)" instead');
        this.addChildViews(option_views);
    };
    /*
		childViews = {
			'Other.View': {
				'Id1': {
					'childViewIndex': 10
				,	'childViewConstructor': function() {}
				}
				'Id2': {
					'childViewIndex': 20
				,	'childViewConstructor': function() {}
				}
			}
		}
	*/
    // @method setChildViewIndex Allows to change the position of a Child View in a container
    // @param {String} container_name The name of the container
    // @param {String} view_name The name of the Child View
    // @param {Number} index The new index to position the Child View in the container
    // @return {Void}
    // @static
    Backbone.View.setChildViewIndex = function setChildViewIndex(container_name, view_name, index) {
        if (this.childViews[container_name]) {
            if (_.isFunction(this.childViews[container_name])) {
                this._normalizeChildView(container_name);
            }
            if (this.childViews[container_name][view_name]) {
                this.childViews[container_name][view_name].childViewIndex = index;
            }
        }
    };
    // @method _normalizeChildView Change the format of the childView into the new format
    // @param {String} container_name The name of the container
    // @return {Void}
    // @static
    // @private
    Backbone.View._normalizeChildView = function _normalizeChildView(container_name) {
        var childViewConstructor = this.childViews[container_name];
        this.childViews[container_name] = {};
        this.childViews[container_name][container_name] = {
            childViewIndex: 10,
            childViewConstructor: childViewConstructor
        };
    };
    // @method addChildViews adds children views to the current view
    // @param {ChildViews} child_views
    // @return {Void}
    // @static
    Backbone.View.addChildViews = function addChildViews(child_views) {
        var self = this;
        this.childViews = _.extend({}, this.prototype.childViews, this.childViews);
        _.each(child_views, function (child_view, child_view_container) {
            if (self.childViews[child_view_container]) {
                if (_.isFunction(self.childViews[child_view_container])) {
                    self._normalizeChildView(child_view_container);
                }
            } else {
                self.childViews[child_view_container] = {};
            }
            if (_.isFunction(child_view)) {
                self.childViews[child_view_container][child_view_container] = {
                    childViewIndex: 10,
                    childViewConstructor: child_view
                };
            } else {
                _.each(child_view, function (child_view_generator, child_view_name) {
                    self.childViews[child_view_container][child_view_name] = child_view_generator;
                });
            }
        });
    };
    // @method removeChildView removes a particular childView
    // @param {String} container_name
    // @param {String} child_view_name
    // @return {Void}
    // @static
    Backbone.View.removeChildView = function removeChildView(container_name, child_view_name) {
        if (_.isFunction(this.childViews[container_name])) {
            delete this.childViews[container_name];
        } else if (this.childViews[container_name] && this.childViews[container_name][child_view_name]) {
            delete this.childViews[container_name][child_view_name];
        }
    };
    Backbone.View.beforeInitialize.install({
        name: 'compositeView',
        priority: 1,
        execute: function () {
            var childViews = _.extend({}, this.childViews, this.constructor.childViews);
            this.childViewInstances = {};
            this.addChildViewInstances(childViews);
            if (this.options) {
                if (this.options.extraChildViews) {
                    console.warn('DEPRECATED: "options.extraChildViews" is deprecated. Use "options.childViews" instead');
                    //Add extra child views from view's initialization options
                    this.addChildViewInstances(this.options.extraChildViews);
                }
                if (this.options.childViews) {
                    //Add extra child views from view's initialization options
                    this.addChildViewInstances(this.options.childViews);
                }
            }
        }
    });
    return { add: jQuery.noop };
});    //@class ChildViews This class defines the type used on each childView property on composite views
       //Each property on this object will be related with a child view and the its value must a function that when evaluated returns the instance
       //of a Backbone View, or the constructor of a Backbone.View
       //Example
       //
       //,	childView: {
       //		'PromoCodeContainer':
       //		{
       //			'PromoCodeForm':
       //			{
       //				childViewIndex: 10
       //			,	childViewConstructor: function ()
       //				{
       //					return new PromocodeFormView({});
       //				}
       //			}
       //		}
       //	}
       //
       //@class addChildViews This class define the type used to add external children views into a view by specifying them on the view options when
       //creating a new composite view (this is a common scenario when creating components), and by specifying external child views statically using
       //the addChildViews method present in all Backbone Views when the Backbone.CompositeView module is loaded
       //Example
       //
       //	SomeView.addChildViews({
       //		'ChildViewContainer':
       //		{
       //			'ChildViewName': function ()
       //			{
       //				return new ExtraChildView({model: some_view_model});
       //			};
       //		}
       //	});
       //

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module GlobalViews
define('GlobalViews.Confirmation.View', [
    'global_views_confirmation.tpl',
    'Backbone.CompositeView',
    'Backbone',
    'underscore',
    'Utils'
], function (global_views_confirmation_tpl, BackboneCompositeView, Backbone, _, Utils) {
    'use strict';
    // @class GlobalViews.Confirmation.View @extends Backbone.View
    return Backbone.View.extend({
        template: global_views_confirmation_tpl,
        title: _('Confirm').translate(),
        page_header: _('Confirm').translate(),
        events: {
            'click [data-action="confirm"]': 'confirm',
            'click [data-action="cancel"]': 'cancel'
        }    //@method initialize
             //@param {GlobalViews.Confirmation.Initialize.Options} options
             //@return {Void}
,
        initialize: function (options) {
            this.callBack = options.callBack;
            this.callBackParameters = options.callBackParameters;
            this.cancelCallBack = options.cancelCallBack;
            this.cancelCallBackParameters = options.cancelCallBackParameters;
            this.title = options.title || this.title;
            this.page_header = options.title || this.page_header;
            this.className = options.className || '';
            this.body = options.body;
            this.showBodyMessage = !options.view;
            this.childViewMessage = options.view;
            this.childViewMessageParameters = options.viewParameters;
            this.autohide = !!options.autohide;
            this.confirmLabel = options.confirmLabel;
            this.cancelLabel = options.cancelLabel;
            BackboneCompositeView.add(this);
            this.once('afterViewRender', function () {
                var self = this;
                self.$containerModal.on('shown.bs.modal', function () {
                    self.$containerModal.off('shown.bs.modal');
                    self.$('[data-action="confirm"]').focus();
                });
            }, this);
        }    //@property {Object} childViews
,
        childViews: {
            'ChildViewMessage': function () {
                return new this.childViewMessage(this.childViewMessageParameters || {});
            }
        }    // @method confirm Invokes callBack function
             // @return {Void}
,
        confirm: function confirm() {
            _.isFunction(this.callBack) && this.callBack.call(this, this.callBackParameters);
            if (this.autohide) {
                this.$containerModal.modal('hide');
            }
        }    // @method cancel Invokes cancelCallBack function
             // @return {Void}
,
        cancel: function cancel() {
            _.isFunction(this.cancelCallBack) && this.cancelCallBack.call(this, this.cancelCallBackParameters);
            if (this.autohide) {
                this.$containerModal.modal('hide');
            }
        }    // @method getTitle This method returns the name the current browser window will have.
             // This is called by Content.EnhancedViews
             // @return {String}
,
        getTitle: function getTitle() {
            return Utils.translate('Confirmation');
        }    // @method getContext
             // @return {GlobalViews.Confirmation.View.Context}
,
        getContext: function getContext() {
            // @class GlobalViews.Confirmation.View.Context
            return {
                // @property {String} body
                body: this.body,
                hasConfirmLabel: !!this.confirmLabel,
                confirmLabel: this.confirmLabel,
                hasCancelLabel: !!this.cancelLabel,
                cancelLabel: this.cancelLabel,
                showBodyMessage: this.showBodyMessage,
                className: this.className
            };    // @class GlobalViews.Confirmation.View
        }
    });
});    //@class GlobalViews.Confirmation.Initialize.Options
       //@property {Function?} callBack Optional function called in case the user confirm the current prompt
       //@property {Any?} callBackParameters Any optional object used as parameter of the callBack parameters function
       //@property {String?} title Optional modal title
       //@property {String?} body String message to display. This value is optional as you can specify a child view as
       //the body of the modal
       //@property {Backbone.View?} view Optional view used to specify a body when you need a rich body that a simple body property
       //is not enough
       //@property {String?} confirmLabel Label used in the confirmation button. 'Yes' is used when no data is provided
       //@property {Boolean} autohide Indicate if after confirming the windows should auto-close
       //@property {String?} cancelLabel Optional label used for the cancel button. If no value is provided Cancel will be used.
       //@property {Any?} viewParameters Optional Object with the parameters used to instantiate the passed in View


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('OrderWizard.Module.MultiShipTo.RemovedPromoCodes', [
    'order_wizard_msr_removed_promocodes.tpl',
    'Backbone'
], function (order_wizard_msr_removed_promocodes_tpl, Backbone) {
    'use strict';
    //@class OrderWizard.Module.MultiShipTo.RemovedPromoCodes @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: order_wizard_msr_removed_promocodes_tpl    //@method getContet
                                                   //@return {OrderWizard.Module.MultiShipTo.RemovedPromoCodes.Context}
,
        getContext: function getContext() {
            //@class OrderWizard.Module.MultiShipTo.RemovedPromoCodes.Context
            return { invalidPromocodes: this.options.invalidPromocodes };    //@class OrderWizard.Module.MultiShipTo.RemovedPromoCodes
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard.Module.MultiShipTo.EnableLink
define('OrderWizard.Module.MultiShipTo.EnableLink', [
    'Wizard.Module',
    'GlobalViews.Confirmation.View',
    'GlobalViews.Message.View',
    'Backbone.CompositeView',
    'OrderWizard.Module.MultiShipTo.RemovedPromoCodes',
    'order_wizard_msr_enablelink_module.tpl',
    'Backbone',
    'underscore'
], function (WizardModule, GlobalViewsConfirmationView, GlobalViewsMessageView, BackboneCompositeView, OrderWizardModuleMultiShipToRemovedPromoCodes, order_wizard_msr_enablelink_module_tpl, Backbone, _) {
    'use strict';
    //@class OrderWizard.Module.MultiShipTo.EnableLink @extend Wizard.Module
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_msr_enablelink_module_tpl,
        className: 'OrderWizard.Module.MultiShipTo.EnableLink',
        events: {
            'click [data-action="change-status-multishipto"]': 'toggleMultiShipTo',
            'click [data-action="order-wizard-msr-promocodes-undo"]': 'revertMultiShipToAndPromoCodes'
        }    //@method initialize Override default method to attach current module on wizard's model events
             //@return {Void}
,
        initialize: function initialize() {
            WizardModule.prototype.initialize.apply(this, arguments);
            if (!this.wizard.model._events['toggle-multi-ship-to']) {
                this.wizard.model.on('toggle-multi-ship-to', this.toggleMultiShipTo, this);
                this.wizard.model.on('update-multi-ship-to-status', this.toggleMultiShipTo, this);
                this.wizard.model.on('ismultishiptoUpdated', this.render, this);
            }
            this.wizard.closedModal = this.wizard.pressedModalButton = false;
            BackboneCompositeView.add(this);
        }    //@method isActive Determines if the current module is valid to be shown and operate with
             //@return {Boolean}
,
        isActive: function isActive() {
            var shippable_items = this.wizard.model.getShippableLines();
            return this.wizard.application.getConfig('siteSettings.isMultiShippingRoutesEnabled', false) && (shippable_items.length > 1 || shippable_items.length === 1 && shippable_items[0].get('quantity') > 1) && !this.wizard.model.getPickupInStoreLines().length;
        }    //@method toggleMultiShipTo Toggle the MST status of the order
             //@return {jQuery.Deferred}
,
        toggleMultiShipTo: function toggleMultiShipTo() {
            if (!this.wizard.model.get('ismultishipto')) {
                //These unsets are silent in order to avoid problems with other modules
                this.wizard.model.set('shipmethod', null, { silent: true });
                this.wizard.model.set('sameAs', false, { silent: true });
                this.wizard.model.set('shipaddress', null, { silent: true });
            }
            var self = this;
            this.wizard.model.set('ismultishipto', !this.wizard.model.get('ismultishipto'));
            return this.wizard.model.save().done(function () {
                self.wizard.model.trigger('ismultishiptoUpdated');
                self.wizard.invalidPromocodes = self.wizard.model.get('automaticallyremovedpromocodes');
                self.wizard.model.unset('automaticallyremovedpromocodes');
                Backbone.history.navigate(self.options.change_url || '/', { trigger: true });
                self.render();
                if (self.wizard.invalidPromocodes && self.wizard.invalidPromocodes.length) {
                    self.removedPromocodesConfirmation(self.wizard.invalidPromocodes);
                }
            });
        }    //@method removedPromocodesConfirmation
             //@param {Array<LiveOrder.Model.PromoCode>} invalid_promocodes
             //@return {Void}
,
        removedPromocodesConfirmation: function removedPromocodesConfirmation() {
            var removedPromocodesConfirmationView = new GlobalViewsConfirmationView({
                callBack: _.bind(this.revertMultiShipToAndPromoCodesCallback, this),
                cancelCallBack: _.bind(this.canceledModalCallback, this),
                confirmLabel: _('Cancel and Keep the Promotions').translate(),
                cancelLabel: _('Continue Without them').translate(),
                className: 'order-wizard-msr-removed-promocodes-confirmation',
                title: _('Promotions not Supported').translate(),
                view: OrderWizardModuleMultiShipToRemovedPromoCodes,
                viewParameters: { invalidPromocodes: this.wizard.invalidPromocodes },
                autohide: true
            });
            var self = this;
            removedPromocodesConfirmationView.on('modal-close', function () {
                self.wizard.closedModal = true;
                if (!self.wizard.pressedModalButton) {
                    //Refresh
                    Backbone.history.navigate(this.options.change_url || '/', { trigger: true });
                }
            });
            this.wizard.closedModal = this.wizard.pressedModalButton = false;
            this.wizard.application.getLayout().showInModal(removedPromocodesConfirmationView);
        }    //@method canceledModalCallback
             //@return {Void}
,
        canceledModalCallback: function canceledModalCallback() {
            this.wizard.pressedModalButton = true;
        }    //@method revertMultiShipToAndPromoCodesCallback
             //@return {Void}
,
        revertMultiShipToAndPromoCodesCallback: function revertMultiShipToAndPromoCodesCallback() {
            this.wizard.pressedModalButton = true;
            this.revertMultiShipToAndPromoCodes();
        }    //@method revertMultiShipToAndPromoCodesCallback
             //@return {jQuery.Deferred}
,
        revertMultiShipToAndPromoCodes: function revertMultiShipToAndPromoCodes() {
            var new_promocodes = (this.wizard.model.get('promocodes') || []).concat(this.wizard.invalidPromocodes);
            var save = this.wizard.model.save({
                promocodes: new_promocodes,
                ismultishipto: false
            });
            Backbone.history.navigate(this.options.change_url || '/', { trigger: true });
            return save;
        }    //@method render We override render to just render this module in case the multi ship to feature is enabled
             //@return {Void}
,
        render: function render() {
            if (this.isActive()) {
                this._render();
                this.trigger('ready', true);
            }
        },
        childViews: {
            'PromocodesRemovedWarning': function () {
                var msg = _('The following promotions are not supported when shipping to multiple addresses and have been removed: ').translate();
                msg += '<span class="order-wizard-msr-removed-promocodes-list">';
                _.each(this.wizard.invalidPromocodes, function (e) {
                    msg += e.code + '&nbsp;';
                });
                msg += '</span><br />';
                msg += '<a href="#" data-action="order-wizard-msr-promocodes-undo">';
                msg += _('Ship to a single address and re-apply codes.').translate();
                msg += '</a>';
                return new GlobalViewsMessageView({
                    message: msg,
                    type: 'warning',
                    closable: true
                });
            }
        }    //@method getContext
             //@return {OrderWizard.Module.MultiShipTo.EnableLink.Context}
,
        getContext: function getContext() {
            var showPromocodesRemovedWarning = this.wizard.closedModal && !this.wizard.pressedModalButton;
            if (showPromocodesRemovedWarning) {
                //Reset warning after showing to make sure it's a one time operation.
                this.wizard.closedModal = this.wizard.pressedModalButton = false;
            }
            //@class OrderWizard.Module.MultiShipTo.EnableLink.Context
            return {
                //@property {Boolean} isMultiShipToEnabled
                isMultiShipToEnabled: !!this.model.get('ismultishipto')    //@property {Boolean} showPromocodesRemovedWarning
,
                showPromocodesRemovedWarning: showPromocodesRemovedWarning
            };    //@class OrderWizard.Module.MultiShipTo.EnableLink
        }
    });
});
/**!

 @license
 handlebars v4.0.10

Copyright (C) 2011-2016 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/
!function (a, b) {
    'object' == typeof exports && 'object' == typeof module ? module.exports = b() : 'function' == typeof define && define.amd ? define('Handlebars', [], b) : 'object' == typeof exports ? exports.Handlebars = b() : a.Handlebars = b();
}(this, function () {
    return function (a) {
        function b(d) {
            if (c[d])
                return c[d].exports;
            var e = c[d] = {
                exports: {},
                id: d,
                loaded: !1
            };
            return a[d].call(e.exports, e, e.exports, b), e.loaded = !0, e.exports;
        }
        var c = {};
        return b.m = a, b.c = c, b.p = '', b(0);
    }([
        function (a, b, c) {
            'use strict';
            function d() {
                var a = new h.HandlebarsEnvironment();
                return n.extend(a, h), a.SafeString = j['default'], a.Exception = l['default'], a.Utils = n, a.escapeExpression = n.escapeExpression, a.VM = p, a.template = function (b) {
                    return p.template(b, a);
                }, a;
            }
            var e = c(1)['default'], f = c(2)['default'];
            b.__esModule = !0;
            var g = c(3), h = e(g), i = c(20), j = f(i), k = c(5), l = f(k), m = c(4), n = e(m), o = c(21), p = e(o), q = c(33), r = f(q), s = d();
            s.create = d, r['default'](s), s['default'] = s, b['default'] = s, a.exports = b['default'];
        },
        function (a, b) {
            'use strict';
            b['default'] = function (a) {
                if (a && a.__esModule)
                    return a;
                var b = {};
                if (null != a)
                    for (var c in a)
                        Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
                return b['default'] = a, b;
            }, b.__esModule = !0;
        },
        function (a, b) {
            'use strict';
            b['default'] = function (a) {
                return a && a.__esModule ? a : { 'default': a };
            }, b.__esModule = !0;
        },
        function (a, b, c) {
            'use strict';
            function d(a, b, c) {
                this.helpers = a || {}, this.partials = b || {}, this.decorators = c || {}, i.registerDefaultHelpers(this), j.registerDefaultDecorators(this);
            }
            var e = c(2)['default'];
            b.__esModule = !0, b.HandlebarsEnvironment = d;
            var f = c(4), g = c(5), h = e(g), i = c(9), j = c(17), k = c(19), l = e(k), m = '4.0.10';
            b.VERSION = m;
            var n = 7;
            b.COMPILER_REVISION = n;
            var o = {
                1: '<= 1.0.rc.2',
                2: '== 1.0.0-rc.3',
                3: '== 1.0.0-rc.4',
                4: '== 1.x.x',
                5: '== 2.0.0-alpha.x',
                6: '>= 2.0.0-beta.1',
                7: '>= 4.0.0'
            };
            b.REVISION_CHANGES = o;
            var p = '[object Object]';
            d.prototype = {
                constructor: d,
                logger: l['default'],
                log: l['default'].log,
                registerHelper: function (a, b) {
                    if (f.toString.call(a) === p) {
                        if (b)
                            throw new h['default']('Arg not supported with multiple helpers');
                        f.extend(this.helpers, a);
                    } else
                        this.helpers[a] = b;
                },
                unregisterHelper: function (a) {
                    delete this.helpers[a];
                },
                registerPartial: function (a, b) {
                    if (f.toString.call(a) === p)
                        f.extend(this.partials, a);
                    else {
                        if ('undefined' == typeof b)
                            throw new h['default']('Attempting to register a partial called "' + a + '" as undefined');
                        this.partials[a] = b;
                    }
                },
                unregisterPartial: function (a) {
                    delete this.partials[a];
                },
                registerDecorator: function (a, b) {
                    if (f.toString.call(a) === p) {
                        if (b)
                            throw new h['default']('Arg not supported with multiple decorators');
                        f.extend(this.decorators, a);
                    } else
                        this.decorators[a] = b;
                },
                unregisterDecorator: function (a) {
                    delete this.decorators[a];
                }
            };
            var q = l['default'].log;
            b.log = q, b.createFrame = f.createFrame, b.logger = l['default'];
        },
        function (a, b) {
            'use strict';
            function c(a) {
                return k[a];
            }
            function d(a) {
                for (var b = 1; b < arguments.length; b++)
                    for (var c in arguments[b])
                        Object.prototype.hasOwnProperty.call(arguments[b], c) && (a[c] = arguments[b][c]);
                return a;
            }
            function e(a, b) {
                for (var c = 0, d = a.length; c < d; c++)
                    if (a[c] === b)
                        return c;
                return -1;
            }
            function f(a) {
                if ('string' != typeof a) {
                    if (a && a.toHTML)
                        return a.toHTML();
                    if (null == a)
                        return '';
                    if (!a)
                        return a + '';
                    a = '' + a;
                }
                return m.test(a) ? a.replace(l, c) : a;
            }
            function g(a) {
                return !a && 0 !== a || !(!p(a) || 0 !== a.length);
            }
            function h(a) {
                var b = d({}, a);
                return b._parent = a, b;
            }
            function i(a, b) {
                return a.path = b, a;
            }
            function j(a, b) {
                return (a ? a + '.' : '') + b;
            }
            b.__esModule = !0, b.extend = d, b.indexOf = e, b.escapeExpression = f, b.isEmpty = g, b.createFrame = h, b.blockParams = i, b.appendContextPath = j;
            var k = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    '\'': '&#x27;',
                    '`': '&#x60;',
                    '=': '&#x3D;'
                }, l = /[&<>"'`=]/g, m = /[&<>"'`=]/, n = Object.prototype.toString;
            b.toString = n;
            var o = function (a) {
                return 'function' == typeof a;
            };
            o(/x/) && (b.isFunction = o = function (a) {
                return 'function' == typeof a && '[object Function]' === n.call(a);
            }), b.isFunction = o;
            var p = Array.isArray || function (a) {
                return !(!a || 'object' != typeof a) && '[object Array]' === n.call(a);
            };
            b.isArray = p;
        },
        function (a, b, c) {
            'use strict';
            function d(a, b) {
                var c = b && b.loc, g = void 0, h = void 0;
                c && (g = c.start.line, h = c.start.column, a += ' - ' + g + ':' + h);
                for (var i = Error.prototype.constructor.call(this, a), j = 0; j < f.length; j++)
                    this[f[j]] = i[f[j]];
                Error.captureStackTrace && Error.captureStackTrace(this, d);
                try {
                    c && (this.lineNumber = g, e ? Object.defineProperty(this, 'column', {
                        value: h,
                        enumerable: !0
                    }) : this.column = h);
                } catch (k) {
                }
            }
            var e = c(6)['default'];
            b.__esModule = !0;
            var f = [
                'description',
                'fileName',
                'lineNumber',
                'message',
                'name',
                'number',
                'stack'
            ];
            d.prototype = new Error(), b['default'] = d, a.exports = b['default'];
        },
        function (a, b, c) {
            a.exports = {
                'default': c(7),
                __esModule: !0
            };
        },
        function (a, b, c) {
            var d = c(8);
            a.exports = function (a, b, c) {
                return d.setDesc(a, b, c);
            };
        },
        function (a, b) {
            var c = Object;
            a.exports = {
                create: c.create,
                getProto: c.getPrototypeOf,
                isEnum: {}.propertyIsEnumerable,
                getDesc: c.getOwnPropertyDescriptor,
                setDesc: c.defineProperty,
                setDescs: c.defineProperties,
                getKeys: c.keys,
                getNames: c.getOwnPropertyNames,
                getSymbols: c.getOwnPropertySymbols,
                each: [].forEach
            };
        },
        function (a, b, c) {
            'use strict';
            function d(a) {
                g['default'](a), i['default'](a), k['default'](a), m['default'](a), o['default'](a), q['default'](a), s['default'](a);
            }
            var e = c(2)['default'];
            b.__esModule = !0, b.registerDefaultHelpers = d;
            var f = c(10), g = e(f), h = c(11), i = e(h), j = c(12), k = e(j), l = c(13), m = e(l), n = c(14), o = e(n), p = c(15), q = e(p), r = c(16), s = e(r);
        },
        function (a, b, c) {
            'use strict';
            b.__esModule = !0;
            var d = c(4);
            b['default'] = function (a) {
                a.registerHelper('blockHelperMissing', function (b, c) {
                    var e = c.inverse, f = c.fn;
                    if (b === !0)
                        return f(this);
                    if (b === !1 || null == b)
                        return e(this);
                    if (d.isArray(b))
                        return b.length > 0 ? (c.ids && (c.ids = [c.name]), a.helpers.each(b, c)) : e(this);
                    if (c.data && c.ids) {
                        var g = d.createFrame(c.data);
                        g.contextPath = d.appendContextPath(c.data.contextPath, c.name), c = { data: g };
                    }
                    return f(b, c);
                });
            }, a.exports = b['default'];
        },
        function (a, b, c) {
            'use strict';
            var d = c(2)['default'];
            b.__esModule = !0;
            var e = c(4), f = c(5), g = d(f);
            b['default'] = function (a) {
                a.registerHelper('each', function (a, b) {
                    function c(b, c, f) {
                        j && (j.key = b, j.index = c, j.first = 0 === c, j.last = !!f, k && (j.contextPath = k + b)), i += d(a[b], {
                            data: j,
                            blockParams: e.blockParams([
                                a[b],
                                b
                            ], [
                                k + b,
                                null
                            ])
                        });
                    }
                    if (!b)
                        throw new g['default']('Must pass iterator to #each');
                    var d = b.fn, f = b.inverse, h = 0, i = '', j = void 0, k = void 0;
                    if (b.data && b.ids && (k = e.appendContextPath(b.data.contextPath, b.ids[0]) + '.'), e.isFunction(a) && (a = a.call(this)), b.data && (j = e.createFrame(b.data)), a && 'object' == typeof a)
                        if (e.isArray(a))
                            for (var l = a.length; h < l; h++)
                                h in a && c(h, h, h === a.length - 1);
                        else {
                            var m = void 0;
                            for (var n in a)
                                a.hasOwnProperty(n) && (void 0 !== m && c(m, h - 1), m = n, h++);
                            void 0 !== m && c(m, h - 1, !0);
                        }
                    return 0 === h && (i = f(this)), i;
                });
            }, a.exports = b['default'];
        },
        function (a, b, c) {
            'use strict';
            var d = c(2)['default'];
            b.__esModule = !0;
            var e = c(5), f = d(e);
            b['default'] = function (a) {
                a.registerHelper('helperMissing', function () {
                    if (1 !== arguments.length)
                        throw new f['default']('Missing helper: "' + arguments[arguments.length - 1].name + '"');
                });
            }, a.exports = b['default'];
        },
        function (a, b, c) {
            'use strict';
            b.__esModule = !0;
            var d = c(4);
            b['default'] = function (a) {
                a.registerHelper('if', function (a, b) {
                    return d.isFunction(a) && (a = a.call(this)), !b.hash.includeZero && !a || d.isEmpty(a) ? b.inverse(this) : b.fn(this);
                }), a.registerHelper('unless', function (b, c) {
                    return a.helpers['if'].call(this, b, {
                        fn: c.inverse,
                        inverse: c.fn,
                        hash: c.hash
                    });
                });
            }, a.exports = b['default'];
        },
        function (a, b) {
            'use strict';
            b.__esModule = !0, b['default'] = function (a) {
                a.registerHelper('log', function () {
                    for (var b = [void 0], c = arguments[arguments.length - 1], d = 0; d < arguments.length - 1; d++)
                        b.push(arguments[d]);
                    var e = 1;
                    null != c.hash.level ? e = c.hash.level : c.data && null != c.data.level && (e = c.data.level), b[0] = e, a.log.apply(a, b);
                });
            }, a.exports = b['default'];
        },
        function (a, b) {
            'use strict';
            b.__esModule = !0, b['default'] = function (a) {
                a.registerHelper('lookup', function (a, b) {
                    return a && a[b];
                });
            }, a.exports = b['default'];
        },
        function (a, b, c) {
            'use strict';
            b.__esModule = !0;
            var d = c(4);
            b['default'] = function (a) {
                a.registerHelper('with', function (a, b) {
                    d.isFunction(a) && (a = a.call(this));
                    var c = b.fn;
                    if (d.isEmpty(a))
                        return b.inverse(this);
                    var e = b.data;
                    return b.data && b.ids && (e = d.createFrame(b.data), e.contextPath = d.appendContextPath(b.data.contextPath, b.ids[0])), c(a, {
                        data: e,
                        blockParams: d.blockParams([a], [e && e.contextPath])
                    });
                });
            }, a.exports = b['default'];
        },
        function (a, b, c) {
            'use strict';
            function d(a) {
                g['default'](a);
            }
            var e = c(2)['default'];
            b.__esModule = !0, b.registerDefaultDecorators = d;
            var f = c(18), g = e(f);
        },
        function (a, b, c) {
            'use strict';
            b.__esModule = !0;
            var d = c(4);
            b['default'] = function (a) {
                a.registerDecorator('inline', function (a, b, c, e) {
                    var f = a;
                    return b.partials || (b.partials = {}, f = function (e, f) {
                        var g = c.partials;
                        c.partials = d.extend({}, g, b.partials);
                        var h = a(e, f);
                        return c.partials = g, h;
                    }), b.partials[e.args[0]] = e.fn, f;
                });
            }, a.exports = b['default'];
        },
        function (a, b, c) {
            'use strict';
            b.__esModule = !0;
            var d = c(4), e = {
                    methodMap: [
                        'debug',
                        'info',
                        'warn',
                        'error'
                    ],
                    level: 'info',
                    lookupLevel: function (a) {
                        if ('string' == typeof a) {
                            var b = d.indexOf(e.methodMap, a.toLowerCase());
                            a = b >= 0 ? b : parseInt(a, 10);
                        }
                        return a;
                    },
                    log: function (a) {
                        if (a = e.lookupLevel(a), 'undefined' != typeof console && e.lookupLevel(e.level) <= a) {
                            var b = e.methodMap[a];
                            console[b] || (b = 'log');
                            for (var c = arguments.length, d = Array(c > 1 ? c - 1 : 0), f = 1; f < c; f++)
                                d[f - 1] = arguments[f];
                            console[b].apply(console, d);
                        }
                    }
                };
            b['default'] = e, a.exports = b['default'];
        },
        function (a, b) {
            'use strict';
            function c(a) {
                this.string = a;
            }
            b.__esModule = !0, c.prototype.toString = c.prototype.toHTML = function () {
                return '' + this.string;
            }, b['default'] = c, a.exports = b['default'];
        },
        function (a, b, c) {
            'use strict';
            function d(a) {
                var b = a && a[0] || 1, c = s.COMPILER_REVISION;
                if (b !== c) {
                    if (b < c) {
                        var d = s.REVISION_CHANGES[c], e = s.REVISION_CHANGES[b];
                        throw new r['default']('Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version (' + d + ') or downgrade your runtime to an older version (' + e + ').');
                    }
                    throw new r['default']('Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version (' + a[1] + ').');
                }
            }
            function e(a, b) {
                function c(c, d, e) {
                    e.hash && (d = p.extend({}, d, e.hash), e.ids && (e.ids[0] = !0)), c = b.VM.resolvePartial.call(this, c, d, e);
                    var f = b.VM.invokePartial.call(this, c, d, e);
                    if (null == f && b.compile && (e.partials[e.name] = b.compile(c, a.compilerOptions, b), f = e.partials[e.name](d, e)), null != f) {
                        if (e.indent) {
                            for (var g = f.split('\n'), h = 0, i = g.length; h < i && (g[h] || h + 1 !== i); h++)
                                g[h] = e.indent + g[h];
                            f = g.join('\n');
                        }
                        return f;
                    }
                    throw new r['default']('The partial ' + e.name + ' could not be compiled when running in runtime-only mode');
                }
                function d(b) {
                    function c(b) {
                        return '' + a.main(e, b, e.helpers, e.partials, g, i, h);
                    }
                    var f = arguments.length <= 1 || void 0 === arguments[1] ? {} : arguments[1], g = f.data;
                    d._setup(f), !f.partial && a.useData && (g = j(b, g));
                    var h = void 0, i = a.useBlockParams ? [] : void 0;
                    return a.useDepths && (h = f.depths ? b != f.depths[0] ? [b].concat(f.depths) : f.depths : [b]), (c = k(a.main, c, e, f.depths || [], g, i))(b, f);
                }
                if (!b)
                    throw new r['default']('No environment passed to template');
                if (!a || !a.main)
                    throw new r['default']('Unknown template object: ' + typeof a);
                a.main.decorator = a.main_d, b.VM.checkRevision(a.compiler);
                var e = {
                    strict: function (a, b) {
                        if (!(b in a))
                            throw new r['default']('"' + b + '" not defined in ' + a);
                        return a[b];
                    },
                    lookup: function (a, b) {
                        for (var c = a.length, d = 0; d < c; d++)
                            if (a[d] && null != a[d][b])
                                return a[d][b];
                    },
                    lambda: function (a, b) {
                        return 'function' == typeof a ? a.call(b) : a;
                    },
                    escapeExpression: p.escapeExpression,
                    invokePartial: c,
                    fn: function (b) {
                        var c = a[b];
                        return c.decorator = a[b + '_d'], c;
                    },
                    programs: [],
                    program: function (a, b, c, d, e) {
                        var g = this.programs[a], h = this.fn(a);
                        return b || e || d || c ? g = f(this, a, h, b, c, d, e) : g || (g = this.programs[a] = f(this, a, h)), g;
                    },
                    data: function (a, b) {
                        for (; a && b--;)
                            a = a._parent;
                        return a;
                    },
                    merge: function (a, b) {
                        var c = a || b;
                        return a && b && a !== b && (c = p.extend({}, b, a)), c;
                    },
                    nullContext: l({}),
                    noop: b.VM.noop,
                    compilerInfo: a.compiler
                };
                return d.isTop = !0, d._setup = function (c) {
                    c.partial ? (e.helpers = c.helpers, e.partials = c.partials, e.decorators = c.decorators) : (e.helpers = e.merge(c.helpers, b.helpers), a.usePartial && (e.partials = e.merge(c.partials, b.partials)), (a.usePartial || a.useDecorators) && (e.decorators = e.merge(c.decorators, b.decorators)));
                }, d._child = function (b, c, d, g) {
                    if (a.useBlockParams && !d)
                        throw new r['default']('must pass block params');
                    if (a.useDepths && !g)
                        throw new r['default']('must pass parent depths');
                    return f(e, b, a[b], c, 0, d, g);
                }, d;
            }
            function f(a, b, c, d, e, f, g) {
                function h(b) {
                    var e = arguments.length <= 1 || void 0 === arguments[1] ? {} : arguments[1], h = g;
                    return !g || b == g[0] || b === a.nullContext && null === g[0] || (h = [b].concat(g)), c(a, b, a.helpers, a.partials, e.data || d, f && [e.blockParams].concat(f), h);
                }
                return h = k(c, h, a, g, d, f), h.program = b, h.depth = g ? g.length : 0, h.blockParams = e || 0, h;
            }
            function g(a, b, c) {
                return a ? a.call || c.name || (c.name = a, a = c.partials[a]) : a = '@partial-block' === c.name ? c.data['partial-block'] : c.partials[c.name], a;
            }
            function h(a, b, c) {
                var d = c.data && c.data['partial-block'];
                c.partial = !0, c.ids && (c.data.contextPath = c.ids[0] || c.data.contextPath);
                var e = void 0;
                if (c.fn && c.fn !== i && !function () {
                        c.data = s.createFrame(c.data);
                        var a = c.fn;
                        e = c.data['partial-block'] = function (b) {
                            var c = arguments.length <= 1 || void 0 === arguments[1] ? {} : arguments[1];
                            return c.data = s.createFrame(c.data), c.data['partial-block'] = d, a(b, c);
                        }, a.partials && (c.partials = p.extend({}, c.partials, a.partials));
                    }(), void 0 === a && e && (a = e), void 0 === a)
                    throw new r['default']('The partial ' + c.name + ' could not be found');
                if (a instanceof Function)
                    return a(b, c);
            }
            function i() {
                return '';
            }
            function j(a, b) {
                return b && 'root' in b || (b = b ? s.createFrame(b) : {}, b.root = a), b;
            }
            function k(a, b, c, d, e, f) {
                if (a.decorator) {
                    var g = {};
                    b = a.decorator(b, g, c, d && d[0], e, f, d), p.extend(b, g);
                }
                return b;
            }
            var l = c(22)['default'], m = c(1)['default'], n = c(2)['default'];
            b.__esModule = !0, b.checkRevision = d, b.template = e, b.wrapProgram = f, b.resolvePartial = g, b.invokePartial = h, b.noop = i;
            var o = c(4), p = m(o), q = c(5), r = n(q), s = c(3);
        },
        function (a, b, c) {
            a.exports = {
                'default': c(23),
                __esModule: !0
            };
        },
        function (a, b, c) {
            c(24), a.exports = c(29).Object.seal;
        },
        function (a, b, c) {
            var d = c(25);
            c(26)('seal', function (a) {
                return function (b) {
                    return a && d(b) ? a(b) : b;
                };
            });
        },
        function (a, b) {
            a.exports = function (a) {
                return 'object' == typeof a ? null !== a : 'function' == typeof a;
            };
        },
        function (a, b, c) {
            var d = c(27), e = c(29), f = c(32);
            a.exports = function (a, b) {
                var c = (e.Object || {})[a] || Object[a], g = {};
                g[a] = b(c), d(d.S + d.F * f(function () {
                    c(1);
                }), 'Object', g);
            };
        },
        function (a, b, c) {
            var d = c(28), e = c(29), f = c(30), g = 'prototype', h = function (a, b, c) {
                    var i, j, k, l = a & h.F, m = a & h.G, n = a & h.S, o = a & h.P, p = a & h.B, q = a & h.W, r = m ? e : e[b] || (e[b] = {}), s = m ? d : n ? d[b] : (d[b] || {})[g];
                    m && (c = b);
                    for (i in c)
                        j = !l && s && i in s, j && i in r || (k = j ? s[i] : c[i], r[i] = m && 'function' != typeof s[i] ? c[i] : p && j ? f(k, d) : q && s[i] == k ? function (a) {
                            var b = function (b) {
                                return this instanceof a ? new a(b) : a(b);
                            };
                            return b[g] = a[g], b;
                        }(k) : o && 'function' == typeof k ? f(Function.call, k) : k, o && ((r[g] || (r[g] = {}))[i] = k));
                };
            h.F = 1, h.G = 2, h.S = 4, h.P = 8, h.B = 16, h.W = 32, a.exports = h;
        },
        function (a, b) {
            var c = a.exports = 'undefined' != typeof window && window.Math == Math ? window : 'undefined' != typeof self && self.Math == Math ? self : Function('return this')();
            'number' == typeof __g && (__g = c);
        },
        function (a, b) {
            var c = a.exports = { version: '1.2.6' };
            'number' == typeof __e && (__e = c);
        },
        function (a, b, c) {
            var d = c(31);
            a.exports = function (a, b, c) {
                if (d(a), void 0 === b)
                    return a;
                switch (c) {
                case 1:
                    return function (c) {
                        return a.call(b, c);
                    };
                case 2:
                    return function (c, d) {
                        return a.call(b, c, d);
                    };
                case 3:
                    return function (c, d, e) {
                        return a.call(b, c, d, e);
                    };
                }
                return function () {
                    return a.apply(b, arguments);
                };
            };
        },
        function (a, b) {
            a.exports = function (a) {
                if ('function' != typeof a)
                    throw TypeError(a + ' is not a function!');
                return a;
            };
        },
        function (a, b) {
            a.exports = function (a) {
                try {
                    return !!a();
                } catch (b) {
                    return !0;
                }
            };
        },
        function (a, b) {
            (function (c) {
                'use strict';
                b.__esModule = !0, b['default'] = function (a) {
                    var b = 'undefined' != typeof c ? c : window, d = b.Handlebars;
                    a.noConflict = function () {
                        return b.Handlebars === a && (b.Handlebars = d), a;
                    };
                }, a.exports = b['default'];
            }.call(b, function () {
                return this;
            }()));
        }
    ]);
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('HandlebarsExtras', [
    'SC.Configuration',
    'Utils',
    'Handlebars',
    'Backbone',
    'underscore',
    'jQuery'
], function (Configuration, Utils, Handlebars, Backbone, _, jQuery) {
    'use strict';
    Handlebars.registerHelper('getThemeAssetsPathWithDefault', function (img_path, default_img_path) {
        if (img_path && img_path === Utils.getAbsoluteUrlOfNonManagedResources('')) {
            img_path = null;
        }
        //If the theme path provided by the template's context is an url (and not a relative path) I'll use it as it's
        //This is used for the local devtool in order to serve the assets locally
        if (/^https?:\/\//.test(this._theme_path) && !img_path) {
            return this._theme_path + default_img_path;
        }
        return Utils.getThemeAbsoluteUrlOfNonManagedResources(default_img_path, img_path);
    });
    Handlebars.registerHelper('getThemeAssetsPath', function (default_img_path) {
        return Handlebars.helpers.getThemeAssetsPathWithDefault.apply(this, [
            null,
            default_img_path
        ]);
    });
    Handlebars.registerHelper('getExtensionAssetsPathWithDefault', function (img_path, default_img_path) {
        if (img_path && img_path !== Utils.getAbsoluteUrl()) {
            return img_path;
        }
        //If the extension path provided by the template's context is an url (and not a relative path) I'll use it as it's
        //This is used for the local devtool in order to serve the assets locally
        if (/^https?:\/\//.test(this._extension_path)) {
            return this._extension_path + default_img_path;
        }
        img_path = (this._extension_path || '') + default_img_path;
        return Utils.getAbsoluteUrl(img_path);
    });
    Handlebars.registerHelper('getExtensionAssetsPath', function (default_img_path) {
        return Handlebars.helpers.getExtensionAssetsPathWithDefault.apply(this, [
            null,
            default_img_path
        ]);
    });
    Handlebars.registerHelper('translate', function () {
        //NOTE: translate returns a safe string
        return new Handlebars.SafeString(_.translate.apply(_, arguments));
    });
    Handlebars.registerHelper('highlightKeyword', function (text, keyword) {
        //NOTE: highlightKeyword returns a safe string
        return new Handlebars.SafeString(Utils.highlightKeyword(text, keyword));
    });
    var objectToAttributesFn = function () {
        //Note: object to attributes
        return new Handlebars.SafeString(Utils.objectToAtrributes(this, ''));
    };
    Handlebars.registerHelper('objectToAtrributes', objectToAttributesFn);
    Handlebars.registerHelper('objectToAttributes', objectToAttributesFn);
    //define our own each helper with support for backbone collections
    Handlebars.registerHelper('each', function (context, options) {
        var ret = '', iterable = context instanceof Backbone.Collection ? context.models : context, length = iterable && iterable.length || 0;
        for (var i = 0, j = length; i < j; i++) {
            ret = ret + options.fn(iterable[i], {
                data: {
                    first: i === 0,
                    last: i === iterable.length - 1,
                    index: i,
                    indexPlusOne: i + 1
                }
            });
        }
        if (!length) {
            ret = options.inverse(this);
        }
        return ret;
    });
    Handlebars.registerHelper('resizeImage', function (url, size) {
        url = url || _.getThemeAbsoluteUrlOfNonManagedResources('img/no_image_available.jpeg', Configuration.get('imageNotAvailable'));
        var mapped_size = Configuration['imageSizeMapping.' + size] || size;
        return Utils.resizeImage(SC.ENVIRONMENT.siteSettings.imagesizes || [], url, mapped_size);
    });
    Handlebars.registerHelper('trimHtml', function (htmlString, length) {
        var htmlStringSelector;
        try {
            htmlStringSelector = jQuery(htmlString);
        } catch (e) {
        }
        var trimmedString = htmlStringSelector && htmlStringSelector.length > 0 ? jQuery.trim(htmlStringSelector.text()) : jQuery.trim(htmlString), moreContent = '';
        if (trimmedString.length > length) {
            moreContent = '...';
        }
        return trimmedString.substring(0, length) + moreContent;
    });
    //Helper 'breaklines' places <br/> tags instead of the newlines provided by backend
    //Used in messages in Quotes, Return, Case, Review.
    Handlebars.registerHelper('breaklines', function (text) {
        text = Handlebars.Utils.escapeExpression(text || '');
        text = text.replace(/(\r\n|\n|\r|\u0005)/gm, '<br/>');
        return new Handlebars.SafeString(text);
    });
    //Helper 'ifEqual' works like if (v1 == v2) {} else {}
    Handlebars.registerHelper('ifEquals', function (v1, v2, options) {
        /*jslint eqeq: true*/
        if (v1 == v2) {
            return options.fn(this);
        }
        return options.inverse(this);
    });
    Handlebars.registerHelper('formatCurrency', function (amount, symbol) {
        //Handlebars sets an object as the last arguement. If formatCurrency was called with one argument, second argument won't be the expected string symbol
        if (typeof symbol === 'string') {
            return Utils.formatCurrency(amount, symbol);
        } else {
            return Utils.formatCurrency(amount);
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module BackboneExtras
#Backbone.View.render()
This file extends native Backbone.View with a custom rendering method. Basically a View must have the 'template'
property pointing to a Function and that function is evaluated using the result of view.getContext()
@module Backbone
@class Backbone.View
*/
define('Backbone.View.render', [
    'Backbone',
    'underscore',
    'jQuery',
    'PluginContainer',
    'Utils',
    'Backbone.CompositeView',
    'Backbone.Validation',
    'Handlebars',
    'HandlebarsExtras'
], function (Backbone, _, jQuery, PluginContainer, Utils) {
    'use strict';
    _.extend(Backbone.View.prototype, {
        //@method getTemplateContext @return {Object} the exact object that is passed to the template function as parameter
        getTemplateContext: function () {
            var template_context;
            if (this.getContext) {
                template_context = this.getContext();
                if (this.constructor.extraContextProperties) {
                    //Item key mapping? >> get item info using item key mapping
                    //what about Model property?
                    var safe_context = Utils.deepCopy(template_context);
                    _.each(this.constructor.extraContextProperties, function contextExtender(property_generator, property_name) {
                        template_context[property_name] = property_generator.fn(safe_context);
                    });
                }
            } else {
                template_context = {};
                if (this.model) {
                    template_context.model = this.model;
                }
                if (this.collection) {
                    template_context.collection = this.collection;
                }
            }
            return template_context;
        }    //@method compileTemplate executes the template passing the context which generates a HTML string. @return {String}
,
        compileTemplate: function () {
            var template_context = this.getTemplateContext();
            this.template = Backbone.View.preCompile.executeAll(this.template, this, template_context) || this.template;
            if (!this.template) {
                throw new Error('View doesn\'t have a template');
            }
            if (!_.isFunction(this.template)) {
                var templateName = this.template + '';
                this.template = Utils.requireModules(templateName);
                if (!this.template) {
                    console.log('View render error, template not found: ', templateName);
                }
            }
            var tmpl_str = this.template(template_context);
            tmpl_str = Backbone.View.postCompile.executeAll(tmpl_str, this);
            return tmpl_str;
        }    // @method _initialize
,
        _initialize: function () {
        }    // @method initialize
,
        initialize: function () {
            this._initialize();
        }    // @method _render Implements the templates execution, rendering and append to DOM.
             // Plugins can be hooked in these interesting 'template rendering' moments to perform customizations.
,
        _render: function () {
            if (this.events) {
                this.undelegateEvents();
            }
            var tmpl_str = this.compileTemplate();
            // Rendering: generating DOM from the HTML string
            var $tmpl = SC.ENVIRONMENT.jsEnvironment === 'server' ? jQuery('<div/>').append(tmpl_str) : jQuery(tmpl_str);
            $tmpl = Backbone.View.preRender.executeAll($tmpl, this);
            // @property {PluginContainer} preRenderPlugins Instance prerender plugins. Useful for extending the DOM using plugins per instance or per class using JavaScript
            $tmpl = this.preRenderPlugins ? this.preRenderPlugins.executeAll($tmpl, this) : $tmpl;
            this.$el.empty();
            this.trigger('beforeViewRender', this);
            // Appends/render the content HTML string to the view's element
            if (SC.ENVIRONMENT.jsEnvironment === 'server') {
                // If $el[0] doesn't exists it means that the ExtraChildView don't need to be shown on this page
                if (this.$el[0]) {
                    // in page generator we append the content this way because of envjs bug.
                    this.$el[0].innerHTML = $tmpl[0].innerHTML;
                }
            } else {
                this.$el.append($tmpl);
            }
            this.renderCompositeView();
            Backbone.View.postRender.executeAll(this.$el, this);
            this.trigger('afterViewRender', this);
            if (this.events) {
                this.delegateEvents();
            }
            return this;
        }    //@method render public overridable render method used as a facade for the internal _render method
,
        render: function () {
            return this._render();
        }    // @method _destroy "private", shouldn't be overwritten if a custom destroy method is required override the destroy method. This method should still be called
             // @param {Boolean} softDestroy decides if the view should be empty instead of removed
,
        _destroy: function (softDestroy) {
            this.destroyCompositeView();
            if (this.$el) {
                // http://backbonejs.org/#View-undelegateEvents
                this.undelegateEvents();
            }
            // http://backbonejs.org/#Events-off
            this.model && this.model.off(null, null, this);
            this.collection && this.collection.off && this.collection.off(null, null, this);
            if (this.$el && softDestroy) {
                this.$el.empty();
            } else if (this.$el) {
                // http://backbonejs.org/#View-remove
                this.remove();
                // unbind all DOM events not just delegated ones
                this.$el.unbind();
            }
            this.trigger('destroy');
        }    // @method destroy
,
        destroy: function (softDestroy) {
            this._destroy(softDestroy);
        }
    });
    var isDataTypeValid = function (data_type) {
        var valid_data_types = [
            'number',
            'string',
            'object',
            'array',
            'boolean',
            'null'
        ];
        if (_.isString(data_type)) {
            return _.indexOf(valid_data_types, data_type) >= 0;
        } else if (_.isArray(data_type)) {
            return !_.difference(data_type, valid_data_types).length;
        }
        return false;
    };
    // Install the plugin containers
    _.extend(Backbone.View, {
        // @property {PluginContainer} preCompile These hooks are executed before the template function is executed and generates a HTML string
        // Each execute method of each plugin will receive: the template function, the view and the context where the template will execute. @static
        preCompile: new PluginContainer()    //@property {PluginContainer} postCompile These hooks are executed after the template the template function is executed and generates a HTML string
                                 //Each execute method of each plugin will receive: the template string (result of having running the template) and the view. @static
,
        postCompile: new PluginContainer()    //@property {PluginContainer} preRender These hooks are executed before the template result is appended to DOM
                                 //Each execute method of each plugin will receive: the template  DOM object (without begin insert into the DOM) and the view. @static
,
        preRender: new PluginContainer()    //@property {PluginContainer} postRender These hooks are executed after the template is appended to DOM
                                 //Each execute method of each plugin will receive: the template DOM object (already in the DOM) and the view. @static
,
        postRender: new PluginContainer()    // @method addExtraContextProperty Allows adding an extra context property into a view.
                                 // @param {String} property_name Unique name of the extra property to be added
                                 // @param {String} type Name of the type of the new property
                                 // @param {Function} callback Function invoked each time the View's UI context is being generated
                                 // @return {Void}
                                 // @public
                                 // @static
,
        addExtraContextProperty: function addExtraContextProperty(property_name, type, callback) {
            this.extraContextProperties = this.extraContextProperties || {};
            var error = {};
            if (!isDataTypeValid(type)) {
                error = new Error('Invalid data type. Please check the json-schema documentation for valid data types.');
                error.name = 'INVALID_DATA_TYPE';
                throw error;
            }
            if (this.extraContextProperties[property_name]) {
                error = new Error('Duplicated property_name. Trying to add more than one extra context property with the same name.');
                error.name = 'DUPLICATED_CONTEXT_PROPERTY';
                throw error;
            }
            this.extraContextProperties[property_name] = {
                type: type,
                fn: callback
            };
        }    //@method removeExtraContextProperty Removes a previously extra context property
             //@param {String} property_name Name of the property
             //@return {Void}
             //@public
             //@static
,
        removeExtraContextProperty: function removeExtraContextProperty(property_name) {
            this.extraContextProperties = this.extraContextProperties || {};
            delete this.extraContextProperties[property_name];
        }
    });
    return Backbone.View;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module BackboneExtras
#Collection View

See @?ref Backbone.CollectionView

@class Backbone.CollectionView
A collection view is a concrete tool view for showing a collection of items all of the same type.
We just create a collection view instance and give it the collection of items (array or backbone collection)
and the view class used for rendering each item.

It support the high level concept of rows and cells to group / grid the items and let use custom templates
for cells and rows.

@extends Backbone.View
*/
define('Backbone.CollectionView', [
    'Backbone',
    'jQuery',
    'underscore',
    'Backbone.View',
    'Backbone.View.render'
], function (Backbone, jQuery, _) {
    'use strict';
    return Backbone.View.extend({
        // @property {Class} childView the View class of this collection view children
        childView: Backbone.View,
        template: null    // @property {Object} childViewOptions the options to be passed to children views
,
        childViewOptions: {}    // @property {Number} viewsPerRow
,
        viewsPerRow: 3    // @property {Number} rowsCount Total number of rows used by the CSS framework
,
        rowsCount: 12    // @property {Function} childTemplate Template used to override the default child view template
,
        childTemplate: null    // @property {Function} cellTemplate Template used to create a cell
,
        cellTemplate: null    // @property {Function} rowTemplate Template used to create a row
,
        rowTemplate: null    // @property  {String} cellsContainerId Defines the data type values used to find the container element of the cells in a row
,
        cellsContainerId: 'backbone.collection.view.cells'    // @property  {String} cellContainerId Defines the data type values used to find the container elements of the child view in a cell
,
        cellContainerId: 'backbone.collection.view.cell'    // @property  {String} rowsContainerId Defines the data type values used to find the container elements of the rows in a template
,
        rowsContainerId: 'backbone.collection.view.rows'    // @property {Object} allows the user to define a custom context.
,
        context: {},
        initialize: function (options) {
            this.childView = options.childView || this.childView;
            this.childViewOptions = options.childViewOptions || this.childViewOptions;
            this.viewsPerRow = options.viewsPerRow ? options.viewsPerRow : this.viewsPerRow;
            if (this.viewsPerRow < 1) {
                this.viewsPerRow = Infinity;
            }
            this.context = options.context || {};
            this.collection = options.collection;
            this.childTemplate = options.childTemplate || this.childTemplate;
            this.cellTemplate = options.cellTemplate || this.cellTemplate;
            this.rowTemplate = options.rowTemplate || this.rowTemplate;
            this.cellsContainerId = options.cellsContainerId || this.cellsContainerId;
            this.cellContainerId = options.cellContainerId || this.cellContainerId;
            this.template = options.template || this.template;
            this.childCells = [];
        },
        createChildElement: function () {
            var data = this.placeholderData || {}, tag_name = data.childTagName || 'div', element = jQuery('<' + tag_name + '></' + tag_name + '>');
            if (data.childId) {
                element.attr('id', data.childId);
            }
            if (data.childClass) {
                element.addClass(data.childClass);
            }
            if (data.childDataAction) {
                element.attr('data-action', data.childDataAction);
            }
            if (data.childDataType) {
                element.attr('data-type', data.childDataType);
            }
            return element;
        }    // @method generateRowContext Generates the context used by the row template. This method is aimed to be overrided @return {Backbone.CollectionView.RowContext}
,
        generateRowContext: function () {
            //@class Backbone.CollectionView.RowContext
            return {};
        }    // @method generateCellContext Generates the context used by the cell template @return {Backbone.CollectionView.CellContext}
,
        generateCellContext: function (child_view_instance) {
            var child_view_instance_context = child_view_instance.getTemplateContext ? child_view_instance.getTemplateContext() : child_view_instance.getContext ? child_view_instance.getContext() : {};
            //@class Backbone.CollectionView.CellContext
            return _.extend(child_view_instance_context, {
                //@property {Number} spanSize
                spanSize: this.calculateSpanSize()
            });
        },
        calculateSpanSize: function () {
            return this.rowsCount / this.viewsPerRow;
        }    // @method createCell Internal method for generate the render result of a child view wrapping it into a cell container.
,
        createCell: function (model, index) {
            var options = _.extend({}, this.childViewOptions, {
                    model: model,
                    index: index
                }), child_view_instance = new this.childView(options);
            this.childCells.push(child_view_instance);
            if (!(child_view_instance.attributes && child_view_instance.attributes['data-root-component-id'])) {
                child_view_instance.attributes = child_view_instance.attributes || {};
                child_view_instance.attributes['data-root-component-id'] = this.attributes && this.attributes['data-root-component-id'] || '';
            }
            child_view_instance.parentView = child_view_instance.parentView || this;
            child_view_instance.hasParent = true;
            child_view_instance.setElement(this.createChildElement());
            child_view_instance.render();
            if (child_view_instance.$el.children().length === 1) {
                child_view_instance.setElement(child_view_instance.$el.children()[0]);
            }
            if (this.cellTemplate) {
                var $cell = jQuery(this.cellTemplate(this.generateCellContext(child_view_instance))), $placeholder = $cell.find('[data-type="' + this.cellContainerId + '"]');
                if ($placeholder.length) {
                    $placeholder.replaceWith(child_view_instance.$el);
                } else {
                    $cell = jQuery('<div></div>');
                    $cell.append(child_view_instance.$el);
                }
                return $cell;
            } else {
                return child_view_instance.$el;
            }
        }    // @method appendCellsToRow Add an array of jQuery cells into an jQuery row @param {Array<jQuery>} cells
,
        appendCellsToRow: function (cells) {
            var $cells = jQuery(_(cells).map(function (element) {
                return element.get(0);
            }));
            if (this.rowTemplate) {
                var $row = jQuery(this.rowTemplate(this.generateRowContext())), $placeholder = $row.find('[data-type="' + this.cellsContainerId + '"]');
                if ($placeholder.length) {
                    $placeholder.replaceWith($cells);
                } else {
                    $row = jQuery('<div></div>');
                    $row.append($cells);
                }
                return $row;
            } else {
                return $cells;
            }
        }    // @method render Override default render to give support to iteration and multiple items per row
,
        render: function () {
            this.collection = this.collection instanceof Backbone.Collection ? this.collection : new Backbone.Collection(this.collection);
            //Empty the div before starting the render
            this.$el.empty();
            if (this.template) {
                this._render();
            }
            var self = this, rows = [], cells_in_row = [];
            if (self.childTemplate) {
                self.childView.prototype.template = self.childTemplate;
            }
            this.viewsPerRow = this.placeholderData && this.placeholderData.viewsPerRow || this.viewsPerRow;
            // @property {Array<Object>} collection this kind of view should be always have a collection property which is what is rendered.
            this.collection.each(function (model, index) {
                var cell = self.createCell(model, index);
                if (self.rowTemplate) {
                    cells_in_row.push(cell);
                    if (self.viewsPerRow === 1 || (index + 1) % self.viewsPerRow === 0 || index + 1 === self.collection.length) {
                        rows.push(self.appendCellsToRow(cells_in_row));
                        cells_in_row = [];
                    }
                } else {
                    rows.push(cell);
                }
            });
            var $content = jQuery(_(rows).map(function (element) {
                return element.get(0);
            }));
            if (this.template) {
                this.$('[data-type="' + this.rowsContainerId + '"]').replaceWith($content);
            } else {
                this.$el.append($content);
            }
        },
        destroy: function () {
            _.each(this.childCells, function (child) {
                child && child.destroy();
            });
            Backbone.View.prototype.destroy.apply(this, Array.prototype.slice.call(arguments));
        },
        getContext: function () {
            var context = {
                collection: this.collection,
                showCells: !!this.collection.length
            };
            return _.extend(context, this.context);
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module GlobalViews
define('GlobalViews.FormatPaymentMethod.View', [
    'SC.Configuration',
    'Utils',
    'global_views_format_payment_method.tpl',
    'Backbone',
    'underscore'
], function (Configuration, Utils, global_views_format_payment_method_tpl, Backbone, _) {
    'use strict';
    // @class GlobalViews.FormatPaymentMethod.View @extends Backbone.View
    return Backbone.View.extend({
        // @property {Function} template
        template: global_views_format_payment_method_tpl    // @method initialize
,
        initialize: function (options) {
            this.showBillingInfo = options.showBillingInfo;
            this.model = options.model || new Backbone.Model();
        }    // @method getContext @return GlobalViews.FormatPaymentMethod.View.Context
,
        getContext: function () {
            var payment_methods = Configuration.get('siteSettings.paymentmethods'), credit_card = this.model.get('creditcard'), is_paypal = this.model.get('type') === 'paypal', is_credit_card = this.model.get('type') === 'creditcard' && credit_card && credit_card.ccnumber, is_invoice = this.model.get('type') === 'invoice', is_gift_certificate = this.model.get('type') === 'giftcertificate', credit_card_payment_method_name = credit_card && credit_card.paymentmethod ? credit_card.paymentmethod.name : '', credit_card_payment_method_internalid = credit_card && credit_card.paymentmethod ? credit_card.paymentmethod.internalid : '', credit_card_payment_method_key = credit_card && credit_card.paymentmethod ? credit_card.paymentmethod.key : '', gift_certificate_ending = '', payment_method = credit_card_payment_method_key ? _.findWhere(payment_methods, { key: credit_card_payment_method_key }) : _.findWhere(payment_methods, { internalid: credit_card_payment_method_internalid }), icon = payment_method && payment_method.imagesrc && payment_method.imagesrc[0];
            if (is_gift_certificate) {
                var code_length = this.model.get('giftcertificate').code.length;
                gift_certificate_ending = this.model.get('giftcertificate').code.substring(code_length - 4, code_length);
            }
            // @class GlobalViews.FormatPaymentMethod.View.Context
            return {
                // @property {Object} model
                model: this.model,
                showStreet: this.model.get('ccstreet') && this.showBillingInfo,
                showZipCode: this.model.get('cczipcode') && this.showBillingInfo,
                isCreditcard: !!is_credit_card    // @property {Boolean} isGiftCertificate
,
                isGiftCertificate: is_gift_certificate    // @property {Boolean} isPaypal
,
                isPaypal: is_paypal    // @property {Boolean} isInvoice
,
                isInvoice: is_invoice    // @property {Boolean} isOther
,
                isOther: !is_invoice && !is_paypal && !is_credit_card && !is_gift_certificate    // @property {String} type
,
                type: this.model.get('type') || _('Not specified').translate()    // @property {String} name
,
                name: this.model.get('name') || _('Not specified').translate()    // @property {String} creditCardNumberEnding
,
                creditCardNumberEnding: credit_card && credit_card.ccnumber && credit_card.ccnumber.replace(/\*/g, '') || ''    // @property {String} showCreditCardImage
,
                showCreditCardImage: !!icon    // @property {String} creditCardImageUrl
,
                creditCardImageUrl: icon || ''    // @property {String} creditCardPaymentMethodName
,
                creditCardPaymentMethodName: credit_card_payment_method_name    // @property {Object} creditCard: credit_card
,
                creditCard: credit_card    // @property {String} giftCertificateEnding
,
                giftCertificateEnding: gift_certificate_ending    // @property {String} showPurchaseNumber
,
                showPurchaseNumber: !!this.model.get('purchasenumber')
            };
        }
    });
});

/*
    © 2017 NetSuite Inc.
    User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
    provided, however, if you are an authorized user with a NetSuite account or log-in, you
    may use this code subject to the terms that govern your access and use.
*/
//@module Cart
define('Cart.Promocode.List.Item.View', [
    'cart_promocode_list_item.tpl',
    'Backbone',
    'underscore'
], function (cart_promocode_list_item_tpl, Backbone, _) {
    'use strict';
    //@class Cart.Promocode.List.Item.View @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: cart_promocode_list_item_tpl    //@method getContext
                                        //@return {Cart.Promocode.List.Item.View.Context}
,
        getContext: function getContext() {
            var code = this.model.get('code'), internalid = this.model.get('internalid'), hide_autoapply_promo = !_.isUndefined(this.model.get('isautoapplied')) ? this.model.get('applicabilityreason') === 'DISCARDED_BEST_OFFER' || this.model.get('isautoapplied') && this.model.get('applicabilitystatus') === 'NOT_APPLIED' : false, errormsg = '';
            var reason = this.model.get('applicabilityreason');
            var status = this.model.get('applicabilitystatus');
            var reasonmsg = '', statusmsg = '';
            if (status == 'APPLIED') {
                statusmsg = _('Promotion is applied for this item.').translate();
            } else if (status == 'NOT_APPLIED') {
                statusmsg = _('Sorry, no discount is added to your order').translate();
            } else if (status == 'NOT_AVAILABLE') {
                statusmsg = _('Status of this promotion is not available.').translate();
            }
            if (reason == 'DISCARDED_BEST_OFFER') {
                reasonmsg = _('Promotion is not applied as there is another promocode or a combination of promocodes that is giving you a better discount.').translate();
            } else if (reason == 'CRITERIA_NOT_MET') {
                reasonmsg = _('Sorry, the promocode is not applied as it does not meet the criteria.').translate();
            }
            if (this.options.source === 'item_summary') {
                code = this.model.get('promotion_couponcode');
                internalid = this.model.get('promotion_id');
            }
            if (this.model.get('errormsg')) {
                errormsg = this.model.get('errormsg');
            } else if (this.model.get('applicabilityreason') === 'NO_FREE_GIFTS_ADDED') {
                errormsg = _('Sorry, something went wrong. We couldn\'t add your gift to the order.').translate();
            }
            //@class Cart.Promocode.List.Item.View.Context
            return {
                //@property {Boolean} showPromo
                showPromo: !!code && !hide_autoapply_promo    //@property {String} code
,
                code: code    //@property {String} internalid
,
                internalid: internalid    //@property {Boolean} isEditable
,
                isEditable: !this.options.isReadOnly && !this.model.get('isautoapplied')    //@property {Boolean} showDiscountRate
,
                showDiscountRate: !!this.model.get('discountrate_formatted')    //@property {String} discountRate
,
                discountRate: this.model.get('discountrate_formatted')    //@property {Boolean} showWarning
,
                showWarning: this.model.get('isvalid') === false || this.model.get('applicabilitystatus') === 'NOT_APPLIED'    //@property {String} errorMessage
,
                errorMessage: errormsg,
                testt: reasonmsg,
                test: statusmsg
            };    //@class Cart.Promocode.List.Item.View
        }
    });
});    //@class Cart.Promocode.List.Item.View.Initialize.Options
       //@property {Backbone.Model<{code:String,internalid:String}>} model
       //@property {Boolean?} isReadOnly


/*
    © 2017 NetSuite Inc.
    User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
    provided, however, if you are an authorized user with a NetSuite account or log-in, you
    may use this code subject to the terms that govern your access and use.
*/
//@module Cart
define('Cart.Promocode.List.View', [
    'Cart.Promocode.List.Item.View',
    'cart_promocode_list.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'underscore'
], function (CartPromocodeListItemView, cart_promocode_list_tpl, Backbone, BackboneCompositeView, BackboneCollectionView, _) {
    'use strict';
    //@class Cart.Promocode.List.View @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: cart_promocode_list_tpl,
        events: { 'click [data-action="remove-promocode"]': 'removePromocode' }    //@method initialize
                                                                           //@param {Cart.Promocode.List.View.Initialize.Options} options
                                                                           //@return {Void}
,
        initialize: function initialize() {
            this.removing_promocode = _.bind(this.removing_promocode, this);
            this.remove_promocode_finished = _.bind(this.remove_promocode_finished, this);
            this.model.cancelableOn('before:LiveOrder.removePromotion', this.removing_promocode);
            this.model.on('remove_promocode_finished', this.remove_promocode_finished);
            BackboneCompositeView.add(this);
        },
        destroy: function destroy() {
            this.model.cancelableOff('before:LiveOrder.removePromotion', this.removing_promocode);
            this.model.off('remove_promocode_finished', this.remove_promocode_finished);
            this._destroy();
        },
        removing_promocode: function removing_promocode() {
            //@event {Void} removing_promocode
            this.trigger('removing_promocode');
        },
        remove_promocode_finished: function remove_promocode_finished() {
            //@event {Void} remove_promocode_finished
            this.trigger('remove_promocode_finished');
        }    //@method setOptions Allow changing the internal model and options.
             //This is necessary as in some cases (Order wizard) the model from which the list of promocodes is read changes in
             //the middle of the process. (In OrderWizard the read model is the instance of the LiveOrder.Model until the order is places
             //and by some hacks another model is read)
             //@param {Any} options
             //@return {Void}
,
        setOptions: function setOptions(options) {
            this.options = options;
            this.model = options.model || this.model;
        }    // @method removePromocode Handles the remove promocode button
             // @param {DOMEvent}
             // @return {Void}
,
        removePromocode: function removePromocode(e) {
            e.preventDefault();
            var promo_code_internalid = (this.$(e.currentTarget).data('id') || '').toString();
            this.model.removePromotion(promo_code_internalid);
        },
        childViews: {
            'PromocodeList': function () {
                return new BackboneCollectionView({
                    collection: _.filter(this.model.get('promocodes') || [], function (promocode) {
                        return promocode.internalid;
                    }),
                    viewsPerRow: 1,
                    childView: CartPromocodeListItemView,
                    childViewOptions: {
                        isReadOnly: this.options.isReadOnly,
                        source: 'summary'
                    }
                });
            }
        }    //@method getContext
             //@return {Cart.Promocode.List.View.context}
,
        getContext: function getContext() {
            //@class Cart.Promocode.List.View.context
            return {};    //@class Cart.Promocode.List.View
        }
    });
});    //@class Cart.Promocode.List.View.Initialize.Options
       //@property {LiveOrder.Model} model
       //@property {Boolean} isReadOnly



/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module OrderWizard.Module.CartSummary
define('OrderWizard.Module.CartSummary', [
    'SC.Configuration',
    'Wizard.Module',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'GlobalViews.FormatPaymentMethod.View',
    'Cart.Promocode.List.View',
    'order_wizard_cart_summary.tpl',
    'cart_summary_gift_certificate_cell.tpl',
    'underscore'
], function (Configuration, WizardModule, BackboneCompositeView, BackboneCollectionView, GlobalViewsFormatPaymentMethodView, CartPromocodeListView, order_wizard_cart_summary_tpl, cart_summary_gift_certificate_cell_tpl, _) {
    'use strict';
    // @class OrderWizard.Module.CartSummary @extends Wizard.Module
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_cart_summary_tpl    //@property {String} className
,
        className: 'OrderWizard.Module.CartSummary'    //@property {Object} attributes
,
        attributes: {
            'id': 'order-wizard-layout',
            'class': 'order-wizard-layout'
        }    //@method initialize
,
        initialize: function initialize() {
            WizardModule.prototype.initialize.apply(this, arguments);
            var self = this;
            //on change model we need to refresh summary
            this.wizard.model.on('change:summary change:paymentmethods', function () {
                //This is an ugly hack to solve the case when the change event trigger first than the confirmation and the lines are converted to collections and models
                if (!_.isArray(self.wizard.model.get('lines')) && self.wizard.model.get('confirmation') && _.isObject(self.wizard.model.get('confirmation').attributes)) {
                    self.render();
                }
            });
            BackboneCompositeView.add(this);
        },
        isActive: function isActive() {
            return this.options.isConfirmation ? this.wizard.model.get('confirmation').get('internalid') : true;
        }    //@method render
             //@return {Void}
,
        render: function render() {
            if (this.state === 'present') {
                this._render();
                this.trigger('ready', true);
            }
        }    //@property {Object} childViews
,
        childViews: {
            'GiftCertificates': function () {
                return new BackboneCollectionView({
                    collection: this.wizard.model.get('paymentmethods').where({ type: 'giftcertificate' }) || [],
                    cellTemplate: cart_summary_gift_certificate_cell_tpl,
                    viewsPerRow: 1,
                    childView: GlobalViewsFormatPaymentMethodView,
                    rowTemplate: null
                });
            },
            'CartPromocodeListView': function () {
                var self = this, promocodeListView = new CartPromocodeListView({
                        model: this.wizard.model,
                        hideRemovePromocodeButton: false
                    });
                promocodeListView.on('removing_promocode', function () {
                    self.trigger('change_enable_continue', false);
                });
                promocodeListView.on('remove_promocode_finished', function () {
                    self.trigger('change_enable_continue', true);
                });
                if (this._isReadFromConfirmation()) {
                    promocodeListView.setOptions({
                        model: this._getModel(),
                        isReadOnly: true
                    });
                }
                return promocodeListView;
            }
        },
        countItems: function countItems(lines) {
            var item_count = 0;
            _.each(lines.models ? lines.models : lines, function (line) {
                item_count += line.get('quantity');
            });
            return item_count;
        },
        _isReadFromConfirmation: function () {
            var confirmation = this.wizard.model.get('confirmation')    // You need to read from confirmation from the wizards (checkout) that have the isExternalCheckout and the return value is true (when returning from an external payment method)
                                                         // Other wizards, like QuoteToSalesOrder, does not make the confirmation hack
, read_from_confirmation = confirmation && confirmation.get('internalid') && this.wizard.isExternalCheckout;
            return read_from_confirmation;
        }    //@method getShowShippingCost
             //@returns {boolean}
,
        getShowShippingCost: function (confirmation) {
            var confirmation_lines = confirmation && confirmation.get('lines');
            if (confirmation_lines.length) {
                var pickup_lines = confirmation_lines.filter(function (model) {
                    return model.get('fulfillmentChoice') && model.get('fulfillmentChoice') === 'pickup';
                });
                var non_shippable_lines = confirmation_lines.filter(function (model) {
                    return !model.get('item').get('_isfulfillable');
                });
                return confirmation_lines.length - non_shippable_lines.length - pickup_lines.length > 0;
            } else {
                return this.wizard.model.getIfThereAreDeliverableItems();
            }
        }    //@method getShowPickupCost
             //@returns {boolean}
,
        getShowPickupCost: function (confirmation) {
            var confirmation_lines = confirmation && confirmation.get('lines');
            if (confirmation_lines.length) {
                return !!confirmation_lines.find(function (model) {
                    return model.get('fulfillmentChoice') && model.get('fulfillmentChoice') === 'pickup';
                });
            } else {
                return !!this.wizard.model.getPickupInStoreLines().length;
            }
        },
        _getModel: function () {
            if (this._isReadFromConfirmation()) {
                var wizard_confirmation = this.wizard.model.get('confirmation');
                var internalid = wizard_confirmation.get('internalid');
                if (internalid) {
                    wizard_confirmation.set('internalid', internalid.toString());
                }
                return wizard_confirmation;
            } else {
                return this.wizard.model;
            }
        }    //@method getContext
             //@returns {OrderWizard.Module.CartSummary.Context}
,
        getContext: function getContext() {
            var model = this._getModel(), summary = model.get('summary') || {}, item_count = this.countItems(model.get('lines')), confirmation = this.wizard.model.get('confirmation');
            //@class OrderWizard.Module.CartSummary.Context
            return {
                model: model    //@property {Number} itemCount
,
                itemCount: item_count    //@property {Boolean} itemCountGreaterThan1
,
                itemCountGreaterThan1: item_count > 1    //@property {Array} giftCertificates
,
                giftCertificates: model.get('paymentmethods').where({ type: 'giftcertificate' }) || []    //@property {Boolean} showGiftCertificates
,
                showGiftCertificates: !!summary.giftcertapplied,
                showDiscount: !!summary.discounttotal,
                showHandlingCost: !!summary.handlingcost,
                showShippingCost: this.getShowShippingCost(confirmation)    //@property {Boolean} showPickupCost
,
                showPickupCost: this.getShowPickupCost(confirmation)    //@property {Boolean} showRemovePromocodeButton
,
                showRemovePromocodeButton: !!this.options.allow_remove_promocode,
                showWarningMessage: !!this.options.warningMessage,
                warningMessage: this.options.warningMessage,
                showEditCartMST: this.wizard.isMultiShipTo() && !this.options.isConfirmation,
                taxLabel: !!Configuration.get('summaryTaxLabel') ? Configuration.get('summaryTaxLabel') : 'Tax'
            };    //@class OrderWizard.Module.CartSummary
        }
    });
});



/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module GlobalViews
define('GlobalViews.CountriesDropdown.View', [
    'global_views_countriesDropdown.tpl',
    'Backbone',
    'jQuery',
    'underscore'
], function (global_views_countriesDropdown_tpl, Backbone, jQuery, _) {
    'use strict';
    // @class GlobalViews.CountriesDropdown.View @extends Backbone.View
    return Backbone.View.extend({
        template: global_views_countriesDropdown_tpl    // @method getContext @return GlobalViews.CountriesDropdown.View.Context
,
        getContext: function () {
            //@class GlobalViews.CountriesDropdown.View.Context
            return {
                // @property {String} cssclass
                cssclass: this.options.cssclass || ''    // @property {Boolean} isCSSclass
,
                showCSSclass: !!this.options.cssclass,
                id: this.options.manage || ''    //@property {Array<Country>} countries
,
                countries: _.values(this.options.countries)
            };
        }
    });
});    //@class Country
       //@property {Number} code
       //@property {String} name
       //@class GlobalViews.CountriesDropdown.View.Options
       //@property {String} cssclass
       //@property {Array<Country>} countries
       //@property {Number} selectedCountry
       //@property {String} manage


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module GlobalViews
define('GlobalViews.States.View', [
    'global_views_states.tpl',
    'Backbone',
    'jQuery',
    'underscore'
], function (global_views_states_tpl, Backbone, jQuery, _) {
    'use strict';
    // @class GlobalViews.States.View @extends Backbone.View
    return Backbone.View.extend({
        template: global_views_states_tpl    // @method getContext @returns GlobalViews.States.View.Context
,
        getContext: function () {
            var country = this.options.selectedCountry && this.options.countries[this.options.selectedCountry], states = country && country.states, self = this;
            _.each(states, function (state) {
                state.isSelected = state.code === self.options.selectedState;
            });
            //@class GlobalViews.States.View.Context
            return {
                //@property {Boolean} isCountryAndStatePresent
                isCountryAndStatePresent: !!(country && states)    //@property {String} manage
,
                manage: this.options.manage || ''    //@property {Array<Object>} sates
,
                states: states    //@property {String} selectedState
,
                selectedState: this.options.selectedState,
                inputClass: this.options.cssclass || 'input-xlarge'
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Address
define('Address.Edit.Fields.View', [
    'address_edit_fields.tpl',
    'GlobalViews.CountriesDropdown.View',
    'SC.Configuration',
    'Backbone.CompositeView',
    'GlobalViews.States.View',
    'Backbone',
    'underscore',
    'jQuery'
], function (address_edit_fields_tpl, CountriesDropdownView, Configuration, BackboneCompositeView, GlobalViewsStatesView, Backbone, _, jQuery) {
    'use strict';
    //@class Address.Edit.View @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: address_edit_fields_tpl    //@property {Object} events
,
        events: {
            'change [data-action="selectcountry"]': 'updateStates',
            'change [data-action="selectstate"]': 'eraseZip',
            'change [data-action="inputstate"]': 'eraseZip',
            'blur [data-action="inputphone"]': 'formatPhone'
        }    //@method initialize Defines this view as composite
             //@return {Void}
,
        initialize: function () {
            BackboneCompositeView.add(this);
            this.calculateState();
        }    //@method calculateState Pre-calculate many state variables used in the get context. In this way this is state is calculated once
             //@return {Void}
,
        calculateState: function () {
            this.site_settings = Configuration.get('siteSettings');
            this.manage = this.options.manage ? this.options.manage + '-' : '';
            this.countries = this.options.countries;
            this.quantity_countries = _.size(this.countries);
            this.selected_country = this.options.selectedCountry;
            this.zip_not_required = this.selected_country && this.site_settings.countries[this.selected_country] && this.site_settings.countries[this.selected_country].isziprequired === 'F';
        }    //@method eraseZip Show and hide the zip field depending on the selected country
             //@return {Void}
,
        eraseZip: function () {
            var selected_country = this.$('[name="country"]').val(), countries = Configuration.get('siteSettings.countries', {}), $zip_fieldset = this.$('[data-input="zip"]'), $zip_input = this.$('input[name="zip"]', $zip_fieldset);
            $zip_input.val('');
            if (countries[selected_country] && countries[selected_country].isziprequired === 'F') {
                $zip_fieldset.hide();
            } else {
                $zip_fieldset.show();
            }
        }    //@method formatPhone Will try to reformat a phone number for a given phone Format,
             // If no format is given, it will try to use the one in site settings.
             //@param {jQuery.Event} e
             //@return {Void}
,
        formatPhone: function (e) {
            var $target = jQuery(e.target);
            $target.val(_($target.val()).formatPhone());
        }    //@method updateStates Initialize state of the  dropdowns
             //@param {jQuery.Event} e
             //@return {Void}
,
        updateStates: function (e) {
            var statesView = this.getChildViewInstance('StatesView');
            statesView.options.selectedCountry = this.$(e.currentTarget).val();
            statesView.render();
            this.eraseZip(e);
        }    //@property {Object} childViews
,
        childViews: {
            'CountriesDropdown': function () {
                return new CountriesDropdownView({
                    countries: this.options.countries,
                    selectedCountry: this.selected_country,
                    manage: this.options.manage
                });
            },
            'StatesView': function () {
                return new GlobalViewsStatesView({
                    countries: this.options.countries,
                    selectedCountry: this.selected_country,
                    selectedState: this.model.get('state'),
                    manage: this.manage
                });
            }
        }    //@method getContext @return Address.Edit.View.Context
,
        getContext: function () {
            //@class Address.Edit.View.Context
            return {
                //@property {String} manage
                manage: this.manage,
                fullName: this.model.get('fullname')    //@property {Boolean} showCompanyField
,
                showCompanyField: this.site_settings.registration.displaycompanyfield === 'T'    //@property {Boolean} isCompanyFieldMandatory
,
                isCompanyFieldMandatory: this.site_settings.registration.companyfieldmandatory === 'T'    //@property {Boolean} isPhoneFieldMandatory
,
                isPhoneFieldMandatory: Configuration.get('addresses') && Configuration.get('addresses').isPhoneMandatory,
                company: this.model.get('company')    //@property {String} addressLine1
,
                addressLine1: this.model.get('addr1')    //@property {String} addressLine2
,
                addressLine2: this.model.get('addr2')    //@property {String} city
,
                city: this.model.get('city')    //@property {Boolean} showCountriesField
,
                showCountriesField: this.quantity_countries > 1    //@property {Boolean} isZipOptional
,
                isZipOptional: this.zip_not_required,
                zip: this.model.get('zip')    //@property {String} phone
,
                phone: this.model.get('phone')    //@property {Boolean} isAddressResidential
,
                isAddressResidential: this.model.get('isresidential') === 'T'    //@property {Boolean} showDefaultControls
,
                showDefaultControls: !this.options.hideDefaults,
                isAddressDefaultBilling: this.model.get('defaultbilling') === 'T'    //@property {Boolean} isCurrentTouchPointCheckout
,
                isCurrentTouchPointCheckout: Configuration.get('currentTouchpoint') === 'checkout'    //@property {Boolean} isAddressDefaultShipping
,
                isAddressDefaultShipping: this.model.get('defaultshipping') === 'T'    //@property {Boolean} showAddressFormSecondAddress
,
                showAddressFormSecondAddress: Configuration.get('forms.address.showAddressLine2')
            };
        }
    });
});
// Backbone.Stickit v0.9.2, MIT Licensed
// Copyright (c) 2012-2015 The New York Times, CMS Group, Matthew DeLambo <delambo@gmail.com>
(function (factory) {
    // Set up Stickit appropriately for the environment. Start with AMD.
    if (typeof define === 'function' && define.amd)
        define('backbone.stickit', [
            'underscore',
            'Backbone',
            'exports'
        ], factory);    // Next for Node.js or CommonJS.
    else if (typeof exports === 'object')
        factory(require('underscore'), require('Backbone'), exports);    // Finally, as a browser global.
    else
        factory(_, Backbone, {});
}(function (_, Backbone, Stickit) {
    // Stickit Namespace
    // --------------------------
    // Export onto Backbone object
    Backbone.Stickit = Stickit;
    Stickit._handlers = [];
    Stickit.addHandler = function (handlers) {
        // Fill-in default values.
        handlers = _.map(_.flatten([handlers]), function (handler) {
            return _.defaults({}, handler, {
                updateModel: true,
                updateView: true,
                updateMethod: 'text'
            });
        });
        this._handlers = this._handlers.concat(handlers);
    };
    // Backbone.View Mixins
    // --------------------
    Stickit.ViewMixin = {
        // Collection of model event bindings.
        //   [{model,event,fn,config}, ...]
        _modelBindings: null,
        // Unbind the model and event bindings from `this._modelBindings` and
        // `this.$el`. If the optional `model` parameter is defined, then only
        // delete bindings for the given `model` and its corresponding view events.
        unstickit: function (model, bindingSelector) {
            // Support passing a bindings hash in place of bindingSelector.
            if (_.isObject(bindingSelector)) {
                _.each(bindingSelector, _.bind(function (v, selector) {
                    this.unstickit(model, selector);
                }, this));
                return;
            }
            var models = [], destroyFns = [];
            this._modelBindings = _.reject(this._modelBindings, function (binding) {
                if (model && binding.model !== model)
                    return;
                if (bindingSelector && binding.config.selector != bindingSelector)
                    return;
                binding.model.off(binding.event, binding.fn);
                destroyFns.push(binding.config._destroy);
                models.push(binding.model);
                return true;
            });
            // Trigger an event for each model that was unbound.
            _.each(_.uniq(models), _.bind(function (model) {
                model.trigger('stickit:unstuck', this.cid);
            }, this));
            // Call `_destroy` on a unique list of the binding callbacks.
            _.each(_.uniq(destroyFns), _.bind(function (fn) {
                fn.call(this);
            }, this));
            this.$el.off('.stickit' + (model ? '.' + model.cid : ''), bindingSelector);
        },
        // Initilize Stickit bindings for the view. Subsequent binding additions
        // can either call `stickit` with the new bindings, or add them directly
        // with `addBinding`. Both arguments to `stickit` are optional.
        stickit: function (optionalModel, optionalBindingsConfig) {
            var model = optionalModel || this.model, bindings = optionalBindingsConfig || _.result(this, 'bindings') || {};
            this._modelBindings || (this._modelBindings = []);
            // Add bindings in bulk using `addBinding`.
            this.addBinding(model, bindings);
            // Wrap `view.remove` to unbind stickit model and dom events.
            var remove = this.remove;
            if (!remove.stickitWrapped) {
                this.remove = function () {
                    var ret = this;
                    this.unstickit();
                    if (remove)
                        ret = remove.apply(this, arguments);
                    return ret;
                };
            }
            this.remove.stickitWrapped = true;
            return this;
        },
        // Add a single Stickit binding or a hash of bindings to the model. If
        // `optionalModel` is ommitted, will default to the view's `model` property.
        addBinding: function (optionalModel, selector, binding) {
            var model = optionalModel || this.model, namespace = '.stickit.' + model.cid;
            binding = binding || {};
            // Support jQuery-style {key: val} event maps.
            if (_.isObject(selector)) {
                var bindings = selector;
                _.each(bindings, _.bind(function (val, key) {
                    this.addBinding(model, key, val);
                }, this));
                return;
            }
            // Special case the ':el' selector to use the view's this.$el.
            var $el = selector === ':el' ? this.$el : this.$(selector);
            // Clear any previous matching bindings.
            this.unstickit(model, selector);
            // Fail fast if the selector didn't match an element.
            if (!$el.length)
                return;
            // Allow shorthand setting of model attributes - `'selector':'observe'`.
            if (_.isString(binding))
                binding = { observe: binding };
            // Handle case where `observe` is in the form of a function.
            if (_.isFunction(binding.observe))
                binding.observe = binding.observe.call(this);
            // Find all matching Stickit handlers that could apply to this element
            // and store in a config object.
            var config = getConfiguration($el, binding);
            // The attribute we're observing in our config.
            var modelAttr = config.observe;
            // Store needed properties for later.
            config.selector = selector;
            config.view = this;
            // Create the model set options with a unique `bindId` so that we
            // can avoid double-binding in the `change:attribute` event handler.
            var bindId = config.bindId = _.uniqueId();
            // Add a reference to the view for handlers of stickitChange events
            var options = _.extend({ stickitChange: config }, config.setOptions);
            // Add a `_destroy` callback to the configuration, in case `destroy`
            // is a named function and we need a unique function when unsticking.
            config._destroy = function () {
                applyViewFn.call(this, config.destroy, $el, model, config);
            };
            initializeAttributes($el, config, model, modelAttr);
            initializeVisible($el, config, model, modelAttr);
            initializeClasses($el, config, model, modelAttr);
            if (modelAttr) {
                // Setup one-way (input element -> model) bindings.
                _.each(config.events, _.bind(function (type) {
                    var eventName = type + namespace;
                    var listener = function (event) {
                        var val = applyViewFn.call(this, config.getVal, $el, event, config, slice.call(arguments, 1));
                        // Don't update the model if false is returned from the `updateModel` configuration.
                        var currentVal = evaluateBoolean(config.updateModel, val, event, config);
                        if (currentVal)
                            setAttr(model, modelAttr, val, options, config);
                    };
                    var sel = selector === ':el' ? '' : selector;
                    this.$el.on(eventName, sel, _.bind(listener, this));
                }, this));
                // Setup a `change:modelAttr` observer to keep the view element in sync.
                // `modelAttr` may be an array of attributes or a single string value.
                _.each(_.flatten([modelAttr]), function (attr) {
                    observeModelEvent(model, 'change:' + attr, config, function (m, val, options) {
                        var changeId = options && options.stickitChange && options.stickitChange.bindId;
                        if (changeId !== bindId) {
                            var currentVal = getAttr(model, modelAttr, config);
                            updateViewBindEl($el, config, currentVal, model);
                        }
                    });
                });
                var currentVal = getAttr(model, modelAttr, config);
                updateViewBindEl($el, config, currentVal, model, true);
            }
            // After each binding is setup, call the `initialize` callback.
            applyViewFn.call(this, config.initialize, $el, model, config);
        }
    };
    _.extend(Backbone.View.prototype, Stickit.ViewMixin);
    // Helpers
    // -------
    var slice = [].slice;
    // Evaluates the given `path` (in object/dot-notation) relative to the given
    // `obj`. If the path is null/undefined, then the given `obj` is returned.
    var evaluatePath = function (obj, path) {
        var parts = (path || '').split('.');
        var result = _.reduce(parts, function (memo, i) {
            return memo[i];
        }, obj);
        return result == null ? obj : result;
    };
    // If the given `fn` is a string, then view[fn] is called, otherwise it is
    // a function that should be executed.
    var applyViewFn = function (fn) {
        fn = _.isString(fn) ? evaluatePath(this, fn) : fn;
        if (fn)
            return fn.apply(this, slice.call(arguments, 1));
    };
    // Given a function, string (view function reference), or a boolean
    // value, returns the truthy result. Any other types evaluate as false.
    // The first argument must be `reference` and the last must be `config`, but
    // middle arguments can be variadic.
    var evaluateBoolean = function (reference, val, config) {
        if (_.isBoolean(reference)) {
            return reference;
        } else if (_.isFunction(reference) || _.isString(reference)) {
            var view = _.last(arguments).view;
            return applyViewFn.apply(view, arguments);
        }
        return false;
    };
    // Setup a model event binding with the given function, and track the event
    // in the view's _modelBindings.
    var observeModelEvent = function (model, event, config, fn) {
        var view = config.view;
        model.on(event, fn, view);
        view._modelBindings.push({
            model: model,
            event: event,
            fn: fn,
            config: config
        });
    };
    // Prepares the given `val`ue and sets it into the `model`.
    var setAttr = function (model, attr, val, options, config) {
        var value = {}, view = config.view;
        if (config.onSet) {
            val = applyViewFn.call(view, config.onSet, val, config);
        }
        if (config.set) {
            applyViewFn.call(view, config.set, attr, val, options, config);
        } else {
            value[attr] = val;
            // If `observe` is defined as an array and `onSet` returned
            // an array, then map attributes to their values.
            if (_.isArray(attr) && _.isArray(val)) {
                value = _.reduce(attr, function (memo, attribute, index) {
                    memo[attribute] = _.has(val, index) ? val[index] : null;
                    return memo;
                }, {});
            }
            model.set(value, options);
        }
    };
    // Returns the given `attr`'s value from the `model`, escaping and
    // formatting if necessary. If `attr` is an array, then an array of
    // respective values will be returned.
    var getAttr = function (model, attr, config) {
        var view = config.view;
        var retrieveVal = function (field) {
            return model[config.escape ? 'escape' : 'get'](field);
        };
        var sanitizeVal = function (val) {
            return val == null ? '' : val;
        };
        var val = _.isArray(attr) ? _.map(attr, retrieveVal) : retrieveVal(attr);
        if (config.onGet)
            val = applyViewFn.call(view, config.onGet, val, config);
        return _.isArray(val) ? _.map(val, sanitizeVal) : sanitizeVal(val);
    };
    // Find handlers in `Backbone.Stickit._handlers` with selectors that match
    // `$el` and generate a configuration by mixing them in the order that they
    // were found with the given `binding`.
    var getConfiguration = Stickit.getConfiguration = function ($el, binding) {
        var handlers = [{
                updateModel: false,
                updateMethod: 'text',
                update: function ($el, val, m, opts) {
                    if ($el[opts.updateMethod])
                        $el[opts.updateMethod](val);
                },
                getVal: function ($el, e, opts) {
                    return $el[opts.updateMethod]();
                }
            }];
        handlers = handlers.concat(_.filter(Stickit._handlers, function (handler) {
            return $el.is(handler.selector);
        }));
        handlers.push(binding);
        // Merge handlers into a single config object. Last props in wins.
        var config = _.extend.apply(_, handlers);
        // `updateView` is defaulted to false for configutrations with
        // `visible`; otherwise, `updateView` is defaulted to true.
        if (!_.has(config, 'updateView'))
            config.updateView = !config.visible;
        return config;
    };
    // Setup the attributes configuration - a list that maps an attribute or
    // property `name`, to an `observe`d model attribute, using an optional
    // `onGet` formatter.
    //
    //     attributes: [{
    //       name: 'attributeOrPropertyName',
    //       observe: 'modelAttrName'
    //       onGet: function(modelAttrVal, modelAttrName) { ... }
    //     }, ...]
    //
    var initializeAttributes = function ($el, config, model, modelAttr) {
        var props = [
            'autofocus',
            'autoplay',
            'async',
            'checked',
            'controls',
            'defer',
            'disabled',
            'hidden',
            'indeterminate',
            'loop',
            'multiple',
            'open',
            'readonly',
            'required',
            'scoped',
            'selected'
        ];
        var view = config.view;
        _.each(config.attributes || [], function (attrConfig) {
            attrConfig = _.clone(attrConfig);
            attrConfig.view = view;
            var lastClass = '';
            var observed = attrConfig.observe || (attrConfig.observe = modelAttr);
            var updateAttr = function () {
                var updateType = _.includes(props, attrConfig.name) ? 'prop' : 'attr', val = getAttr(model, observed, attrConfig);
                // If it is a class then we need to remove the last value and add the new.
                if (attrConfig.name === 'class') {
                    $el.removeClass(lastClass).addClass(val);
                    lastClass = val;
                } else {
                    $el[updateType](attrConfig.name, val);
                }
            };
            _.each(_.flatten([observed]), function (attr) {
                observeModelEvent(model, 'change:' + attr, config, updateAttr);
            });
            // Initialize the matched element's state.
            updateAttr();
        });
    };
    var initializeClasses = function ($el, config, model, modelAttr) {
        _.each(config.classes || [], function (classConfig, name) {
            if (_.isString(classConfig))
                classConfig = { observe: classConfig };
            classConfig.view = config.view;
            var observed = classConfig.observe;
            var updateClass = function () {
                var val = getAttr(model, observed, classConfig);
                $el.toggleClass(name, !!val);
            };
            _.each(_.flatten([observed]), function (attr) {
                observeModelEvent(model, 'change:' + attr, config, updateClass);
            });
            updateClass();
        });
    };
    // If `visible` is configured, then the view element will be shown/hidden
    // based on the truthiness of the modelattr's value or the result of the
    // given callback. If a `visibleFn` is also supplied, then that callback
    // will be executed to manually handle showing/hiding the view element.
    //
    //     observe: 'isRight',
    //     visible: true, // or function(val, options) {}
    //     visibleFn: function($el, isVisible, options) {} // optional handler
    //
    var initializeVisible = function ($el, config, model, modelAttr) {
        if (config.visible == null)
            return;
        var view = config.view;
        var visibleCb = function () {
            var visible = config.visible, visibleFn = config.visibleFn, val = getAttr(model, modelAttr, config), isVisible = !!val;
            // If `visible` is a function then it should return a boolean result to show/hide.
            if (_.isFunction(visible) || _.isString(visible)) {
                isVisible = !!applyViewFn.call(view, visible, val, config);
            }
            // Either use the custom `visibleFn`, if provided, or execute the standard show/hide.
            if (visibleFn) {
                applyViewFn.call(view, visibleFn, $el, isVisible, config);
            } else {
                $el.toggle(isVisible);
            }
        };
        _.each(_.flatten([modelAttr]), function (attr) {
            observeModelEvent(model, 'change:' + attr, config, visibleCb);
        });
        visibleCb();
    };
    // Update the value of `$el` using the given configuration and trigger the
    // `afterUpdate` callback. This action may be blocked by `config.updateView`.
    //
    //     update: function($el, val, model, options) {},  // handler for updating
    //     updateView: true, // defaults to true
    //     afterUpdate: function($el, val, options) {} // optional callback
    //
    var updateViewBindEl = function ($el, config, val, model, isInitializing) {
        var view = config.view;
        if (!evaluateBoolean(config.updateView, val, config))
            return;
        applyViewFn.call(view, config.update, $el, val, model, config);
        if (!isInitializing)
            applyViewFn.call(view, config.afterUpdate, $el, val, config);
    };
    // Default Handlers
    // ----------------
    Stickit.addHandler([
        {
            selector: '[contenteditable]',
            updateMethod: 'html',
            events: [
                'input',
                'change'
            ]
        },
        {
            selector: 'input',
            events: [
                'propertychange',
                'input',
                'change'
            ],
            update: function ($el, val) {
                $el.val(val);
            },
            getVal: function ($el) {
                return $el.val();
            }
        },
        {
            selector: 'textarea',
            events: [
                'propertychange',
                'input',
                'change'
            ],
            update: function ($el, val) {
                $el.val(val);
            },
            getVal: function ($el) {
                return $el.val();
            }
        },
        {
            selector: 'input[type="radio"]',
            events: ['change'],
            update: function ($el, val) {
                // Because we use " in the value descriptor, we need to escape any
                // quotes in the value itself otherwise jQuery/Sizzle complain that
                // the selector is invalid.
                var escapedVal = val.toString().replace(/"/g, '\\"');
                $el.filter('[value="' + escapedVal + '"]').prop('checked', true);
            },
            getVal: function ($el) {
                return $el.filter(':checked').val();
            }
        },
        {
            selector: 'input[type="checkbox"]',
            events: ['change'],
            update: function ($el, val, model, options) {
                if ($el.length > 1) {
                    // There are multiple checkboxes so we need to go through them and check
                    // any that have value attributes that match what's in the array of `val`s.
                    val || (val = []);
                    $el.each(function (i, el) {
                        var checkbox = Backbone.$(el);
                        var checkboxVal = checkbox.val();
                        var checked = _.some(val, function (item) {
                            return '' + item === checkboxVal;
                        });
                        checkbox.prop('checked', checked);
                    });
                } else {
                    var checked = _.isBoolean(val) ? val : '' + val === $el.val();
                    $el.prop('checked', checked);
                }
            },
            getVal: function ($el) {
                var val;
                if ($el.length > 1) {
                    val = _.reduce($el, function (memo, el) {
                        var checkbox = Backbone.$(el);
                        if (checkbox.prop('checked'))
                            memo.push(checkbox.val());
                        return memo;
                    }, []);
                } else {
                    val = $el.prop('checked');
                    // If the checkbox has a value attribute defined, then
                    // use that value. Most browsers use "on" as a default.
                    var boxval = $el.val();
                    if (boxval !== 'on' && boxval != null) {
                        val = val ? $el.val() : null;
                    }
                }
                return val;
            }
        },
        {
            selector: 'select',
            events: ['change'],
            update: function ($el, val, model, options) {
                var optList, selectConfig = options.selectOptions, list = selectConfig && selectConfig.collection || undefined, isMultiple = $el.prop('multiple');
                // If there are no `selectOptions` then we assume that the `<select>`
                // is pre-rendered and that we need to generate the collection.
                if (!selectConfig) {
                    selectConfig = {};
                    var getList = function ($el) {
                        return $el.map(function (index, option) {
                            // Retrieve the text and value of the option, preferring "stickit-bind-val"
                            // data attribute over value property.
                            var dataVal = Backbone.$(option).data('stickit-bind-val');
                            return {
                                value: dataVal !== undefined ? dataVal : option.value,
                                label: option.text
                            };
                        }).get();
                    };
                    if ($el.find('optgroup').length) {
                        list = { opt_labels: [] };
                        // Search for options without optgroup
                        if ($el.find('> option').length) {
                            list.opt_labels.push(undefined);
                            _.each($el.find('> option'), function (el) {
                                list[undefined] = getList(Backbone.$(el));
                            });
                        }
                        _.each($el.find('optgroup'), function (el) {
                            var label = Backbone.$(el).attr('label');
                            list.opt_labels.push(label);
                            list[label] = getList(Backbone.$(el).find('option'));
                        });
                    } else {
                        list = getList($el.find('option'));
                    }
                }
                // Fill in default label and path values.
                selectConfig.valuePath = selectConfig.valuePath || 'value';
                selectConfig.labelPath = selectConfig.labelPath || 'label';
                selectConfig.disabledPath = selectConfig.disabledPath || 'disabled';
                var addSelectOptions = function (optList, $el, fieldVal) {
                    var fragment = document.createDocumentFragment();
                    _.each(optList, function (obj) {
                        var option = Backbone.$('<option/>'), optionVal = obj;
                        var fillOption = function (text, val, disabled) {
                            option.text(text);
                            optionVal = val;
                            // Save the option value as data so that we can reference it later.
                            option.data('stickit-bind-val', optionVal);
                            if (!_.isArray(optionVal) && !_.isObject(optionVal))
                                option.val(optionVal);
                            if (disabled === true)
                                option.prop('disabled', 'disabled');
                        };
                        var text, val, disabled;
                        if (obj === '__default__') {
                            text = fieldVal.label, val = fieldVal.value, disabled = fieldVal.disabled;
                        } else {
                            text = evaluatePath(obj, selectConfig.labelPath), val = evaluatePath(obj, selectConfig.valuePath), disabled = evaluatePath(obj, selectConfig.disabledPath);
                        }
                        fillOption(text, val, disabled);
                        // Determine if this option is selected.
                        var isSelected = function () {
                            if (!isMultiple && optionVal != null && fieldVal != null && optionVal === fieldVal) {
                                return true;
                            } else if (_.isObject(fieldVal) && _.isEqual(optionVal, fieldVal)) {
                                return true;
                            }
                            return false;
                        };
                        if (isSelected()) {
                            option.prop('selected', true);
                        } else if (isMultiple && _.isArray(fieldVal)) {
                            _.each(fieldVal, function (val) {
                                if (_.isObject(val))
                                    val = evaluatePath(val, selectConfig.valuePath);
                                if (val === optionVal || _.isObject(val) && _.isEqual(optionVal, val))
                                    option.prop('selected', true);
                            });
                        }
                        option.appendTo(fragment);
                    });
                    $el.append(fragment);
                };
                $el.empty();
                // The `list` configuration is a function that returns the options list or a string
                // which represents the path to the list relative to `window` or the view/`this`.
                if (_.isString(list)) {
                    var context = window;
                    if (list.indexOf('this.') === 0)
                        context = this;
                    list = list.replace(/^[a-z]*\.(.+)$/, '$1');
                    optList = evaluatePath(context, list);
                } else if (_.isFunction(list)) {
                    optList = applyViewFn.call(this, list, $el, options);
                } else {
                    optList = list;
                }
                // Support Backbone.Collection and deserialize.
                if (optList instanceof Backbone.Collection) {
                    var collection = optList;
                    var refreshSelectOptions = function () {
                        var currentVal = getAttr(model, options.observe, options);
                        applyViewFn.call(this, options.update, $el, currentVal, model, options);
                    };
                    // We need to call this function after unstickit and after an update so we don't end up
                    // with multiple listeners doing the same thing
                    var removeCollectionListeners = function () {
                        collection.off('add remove reset sort', refreshSelectOptions);
                    };
                    var removeAllListeners = function () {
                        removeCollectionListeners();
                        collection.off('stickit:selectRefresh');
                        collection.off('stickit:selectRefreshForView');
                        model.off('stickit:selectRefresh');
                    };
                    collection.trigger('stickit:selectRefreshForView', this.cid);
                    // Compare the view cid on the event to this.cid to ensure we don't
                    // remove events from the collection that are tied to other views.
                    collection.once('stickit:selectRefreshForView', function (viewCid) {
                        if (this.cid == viewCid) {
                            // Remove previously set event listeners by triggering a custom event
                            collection.trigger('stickit:selectRefresh');
                        }
                    }, this);
                    collection.once('stickit:selectRefresh', removeCollectionListeners, this);
                    // Listen to the collection and trigger an update of the select options
                    collection.on('add remove reset sort', refreshSelectOptions, this);
                    // Remove the previous model event listener
                    model.trigger('stickit:selectRefresh');
                    model.once('stickit:selectRefresh', function () {
                        model.off('stickit:unstuck', removeAllListeners);
                    });
                    // Remove collection event listeners once this binding is unstuck
                    model.once('stickit:unstuck', removeAllListeners, this);
                    optList = optList.toJSON();
                }
                if (selectConfig.defaultOption) {
                    var option = _.isFunction(selectConfig.defaultOption) ? selectConfig.defaultOption.call(this, $el, options) : selectConfig.defaultOption;
                    addSelectOptions(['__default__'], $el, option);
                }
                if (_.isArray(optList)) {
                    addSelectOptions(optList, $el, val);
                } else if (optList.opt_labels) {
                    // To define a select with optgroups, format selectOptions.collection as an object
                    // with an 'opt_labels' property, as in the following:
                    //
                    //     {
                    //       'opt_labels': ['Looney Tunes', 'Three Stooges'],
                    //       'Looney Tunes': [{id: 1, name: 'Bugs Bunny'}, {id: 2, name: 'Donald Duck'}],
                    //       'Three Stooges': [{id: 3, name : 'moe'}, {id: 4, name : 'larry'}, {id: 5, name : 'curly'}]
                    //     }
                    //
                    _.each(optList.opt_labels, function (label) {
                        var $group = Backbone.$('<optgroup/>').attr('label', label);
                        addSelectOptions(optList[label], $group, val);
                        $el.append($group);
                    });    // With no 'opt_labels' parameter, the object is assumed to be a simple value-label map.
                           // Pass a selectOptions.comparator to override the default order of alphabetical by label.
                } else {
                    var opts = [], opt;
                    for (var i in optList) {
                        opt = {};
                        opt[selectConfig.valuePath] = i;
                        opt[selectConfig.labelPath] = optList[i];
                        opts.push(opt);
                    }
                    opts = _.sortBy(opts, selectConfig.comparator || selectConfig.labelPath);
                    addSelectOptions(opts, $el, val);
                }
            },
            getVal: function ($el) {
                var selected = $el.find('option:selected');
                if ($el.prop('multiple')) {
                    return _.map(selected, function (el) {
                        return Backbone.$(el).data('stickit-bind-val');
                    });
                } else {
                    return selected.data('stickit-bind-val');
                }
            }
        }
    ]);
    return Stickit;
}));
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module BackboneExtras
#Form Views

See @?ref Backbone.FormView

@class Backbone.FormView

This class add two main utilities to classes that contains forms:

On one side it provides the method saveForm that can be binded with a form submit and it will
automatically serialize the form data and save() the backbone model associated with this view.
Model validation is implemented by library backbone.validation.

On the other side, if 'bindings' property is found it will setup the double binding so when
input elements are modified b the user the model is automatically validated. This will trigger
validation error messages while the user types instead of only doing it when user submits the form.
Currently binding is implemented by library backbone.stickit.

This class is meant to be used as a mixing to add the functionality to other classes.
Instead Class.extend() please use Backbone.FormView.add(my_instance)

@extends Backbone.View
*/
define('Backbone.FormView', [
    'Backbone',
    'underscore',
    'jQuery',
    'backbone.stickit',
    'Backbone.Validation'
], function (Backbone, _, jQuery) {
    'use strict';
    function buttonSubmitProgress(savingForm) {
        savingForm.find('[type="submit"]').each(function () {
            var element = jQuery(this);
            element.attr('disabled', true);
            element.data('default-text', jQuery.trim(element.text()));
            element.text(_('Processing...').translate());
        });
    }
    function buttonSubmitDone(savingForm) {
        savingForm.find('[type="submit"]').each(function () {
            var element = jQuery(this);
            element.attr('disabled', false);
            element.text(element.data('default-text'));
        });
    }
    // override default handler to uncheck radio buttons.
    var handler_radio = _.findWhere(Backbone.Stickit._handlers, { 'selector': 'input[type="radio"]' });
    if (handler_radio) {
        handler_radio.update = function ($el, val) {
            if (val) {
                $el.filter('[value="' + val + '"]').prop('checked', true);
            } else {
                $el.prop('checked', false);
            }
        };
    }
    return {
        // override render() to add support to double binding using Backbone.stickit:
        bindViewToStickit: function () {
            var view = this;
            Backbone.Validation.bind(view, {
                model: view.validationModel,
                forceUpdate: true
            });
            view.stickit(view.validationModel, view.bindings);
        },
        formatBindings: function (view) {
            // we want to automatically add default desired configuration to stickit bindings without deleting stickit passed config.
            // The default action is 'blur' and model modifications will be silent - this can be customized for particular inputs
            _(view.bindings).each(function (binding, name) {
                if (_(binding).isString()) {
                    view.bindings[name] = {
                        observe: binding,
                        setOptions: {
                            validate: true,
                            silent: true
                        },
                        events: ['blur']
                    };
                } else if (!binding.setOptions || typeof binding.setOptions.validate === 'undefined') {
                    binding.setOptions = binding.setOptions || {};
                    binding.setOptions.validate = true;
                    binding.setOptions.silent = true;
                }
            });
        }    // @method add makes the passed view a Form View. Views that want to be form views should call this method at initialize @static
             // @param {Backbone.View} view the view instance we want to transform in a FormView.
,
        add: function (view, options) {
            options = options || {};
            this.formatBindings(view);
            view.validationModel = options.noCloneModel ? view.model : view.model.clone();
            !options.noCloneModel && view.model.on('change', this.synchronizeModels, view);
            view.on(view.childViews ? 'afterCompositeViewRender' : 'afterViewRender', this.bindViewToStickit);
            var self = this;
            // overrides destroy() so we unstickit (remove bindings event listeners)
            view.destroy = _.wrap(view.destroy, function (fn) {
                this.unstickit();
                view.model.off('change', self.synchronizeModels);
                return fn.apply(this, Array.prototype.slice.call(arguments));
            });
            view.model.bind('validated', function (isValid) {
                //user clicked on submit AND there are validation errors -> focus on first error.
                if (view.isSavingForm && isValid === false) {
                    var $first_input_error = jQuery('body [data-validation-error]:first input');
                    if ($first_input_error) {
                        if (!jQuery('.global-views-message-error').length && $first_input_error.closest('[data-validation="control-group"]').length) {
                            jQuery('body').animate({ scrollTop: $first_input_error.closest('[data-validation="control-group"]').offset().top }, 600);
                        }
                        $first_input_error.focus();
                    }
                }
                //user clicked on submit AND form is OK -> show progress button.
                if (view.isSavingForm && isValid === true) {
                    buttonSubmitProgress(view.$savingForm);
                }
                view.isSavingForm = false;
            });
            // when we have two FormViews and we switch focus from one to another we want to erase the validation error messages from the first one:
            view.events = view.events || {};
            view.events['focusin *'] = 'formViewFocusHandler';
            var removeValidationErrors = function ($el) {
                $el.find('[data-validation-error="block"]').remove();
                $el.find('[data-validation-error]').removeAttr('data-validation-error');
            };
            // @method removeValidationErrors remove all visual validation errors of this form view if any
            view.removeValidationErrors = function () {
                removeValidationErrors(this.$el);
            };
            view.formViewFocusHandler = function () {
                if (!this.$el.hasClass('focused-form-view')) {
                    removeValidationErrors(jQuery('.focused-form-view'));
                    jQuery('.focused-form-view').removeClass('focused-form-view');
                }
                this.$el.addClass('focused-form-view');
            };
            view.saveForm = this.saveForm;
            return view.validationModel;
        }    //@method synchronizeModels Auxiliary method used to keep sync all changes made on the view's model and the cloned model
             //It is important to notice that this method is expected to run in the context of the view
             //@param {Backbone.Model} view_model Original view's model
             //@return {Void}
,
        synchronizeModels: function (view_model) {
            if (!view_model) {
                return;
            }
            var changed_attributes = view_model.changedAttributes(), view = this;
            _.each(changed_attributes, function (value, attribute) {
                view.validationModel.set(attribute, value);
            });
        }    // @method saveForm will serialize the input of some form and save() the given model using it
             // @param {HTMLEvent} e @param {Backbone.Model} model @param {Object} props properties to pass to model.save()
             // @return {jQuery.Deferred}
,
        saveForm: function (e, model, props) {
            e.preventDefault();
            //Add validate method into the view.model
            Backbone.Validation.bind(this);
            model = model || this.model;
            this.$savingForm = jQuery(e.target).closest('form');
            this.isSavingForm = true;
            if (this.$savingForm.length) {
                // and hides reset buttons
                this.$savingForm.find('input[type="reset"], button[type="reset"]').hide();
            }
            this.hideError();
            var self = this, options = self.selector ? { selector: self.selector } : {}    // Returns the promise of the save action of the model
, result = model.save(props || this.$savingForm.serializeObject(), _.extend({
                    wait: true,
                    forceUpdate: false    // Hides error messages, re enables buttons and triggers the save event
                             // if we are in a modal this also closes it
,
                    success: function (model, response) {
                        if (self.inModal && self.$containerModal) {
                            self.$containerModal.modal('hide');
                        }
                        if (self.$savingForm.length) {
                            self.hideError(self.$savingForm);
                            buttonSubmitDone(self.$savingForm);
                            model.trigger('save', model, response);
                        }
                        model.trigger('saveCompleted');
                    }    // Re enables all button and shows an error message
,
                    error: function (model, response) {
                        buttonSubmitDone(self.$savingForm);
                        if (response.responseText) {
                            model.trigger('error', jQuery.parseJSON(response.responseText));
                        }
                    }
                }, options));
            if (result === false) {
                this.$savingForm.find('input[type="reset"], button[type="reset"]').show();
                this.$savingForm.find('*[type=submit], *[type=reset]').attr('disabled', false);
            }
            return result;
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Address
define('Address.Edit.View', [
    'address_edit.tpl',
    'Address.Edit.Fields.View',
    'Backbone.FormView',
    'SC.Configuration',
    'Backbone.CompositeView',
    'Backbone',
    'underscore',
    'jQuery',
    'Utils'
], function (address_edit_tpl, AddressEditFieldView, BackboneFormView, Configuration, BackboneCompositeView, Backbone, _, jQuery) {
    'use strict';
    //@class Address.Edit.View @extend Backbone.View
    return Backbone.View.extend({
        template: address_edit_tpl,
        attributes: { 'class': 'AddressListView' },
        events: { 'submit form': 'saveForm' },
        bindings: {
            '[name="fullname"]': 'fullname',
            '[name="company"]': 'company',
            '[name="addr1"]': 'addr1',
            '[name="city"]': 'city',
            '[name="country"]': 'country',
            '[name="zip"]': 'zip',
            '[name="phone"]': 'phone'
        },
        initialize: function (options) {
            this.manage = options.manage;
            this.application = options.application;
            var addNewAddresLabel = _('Add New Address').translate();
            var editAddressLabel = _('Edit Address').translate();
            this.title = this.model.isNew() ? addNewAddresLabel : editAddressLabel;
            this.page_header = this.title;
            this.countries = Configuration.get('siteSettings.countries');
            this.selectedCountry = this.model.get('country') || Configuration.get('siteSettings.defaultshipcountry');
            if (!this.selectedCountry && _.size(this.countries) === 1) {
                this.selectedCountry = _.first(_.keys(this.countries));
            }
            if (!!this.selectedCountry) {
                this.model.set('country', this.selectedCountry);
            }
            BackboneCompositeView.add(this);
            BackboneFormView.add(this);
        }    //@method getSelectedMenu
,
        getSelectedMenu: function () {
            return 'addressbook';
        }    //@method getBreadcrumbPages
,
        getBreadcrumbPages: function () {
            return [
                {
                    text: _('Address Book').translate(),
                    href: '/addressbook'
                },
                {
                    text: this.title,
                    href: '/addressbook/new'
                }
            ];
        },
        render: function () {
            Backbone.View.prototype.render.apply(this, arguments);
            this.$('[rel="tooltip"]').tooltip({ placement: 'right' }).on('hide', function (e) {
                e.preventDefault();
                jQuery(e.target).next('.tooltip').hide();
            });
        },
        childViews: {
            'Address.Edit.Fields': function () {
                return new AddressEditFieldView({
                    model: this.model,
                    countries: this.countries,
                    selectedCountry: this.selectedCountry,
                    hideDefaults: Configuration.get('currentTouchpoint') !== 'customercenter',
                    application: this.options.application,
                    manage: this.manage
                });
            }
        }    //@method getContext @return Address.Edit.View.Context
,
        getContext: function () {
            //@class Address.Edit.View.Context
            return {
                //@property {Address.Model} model
                model: this.model,
                isAddressNew: this.model.isNew()    //@property {Boolean} isCollectionEmpty
,
                isCollectionEmpty: !this.collection.length,
                isInModal: this.inModal,
                isInModalOrHideHeader: this.inModal || !!this.options.hideHeader,
                showFooter: !this.options.hideFooter,
                isInModalOrCollectionNotEmpty: !!(this.inModal || this.collection.length)
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Address
define('Address.Model', [
    'underscore',
    'Backbone',
    'Utils'
], function (_, Backbone) {
    'use strict';
    // @method isCompanyRequired
    // Check if company field is mandatory.
    function isCompanyRequired() {
        return SC && SC.ENVIRONMENT && SC.ENVIRONMENT.siteSettings && SC.ENVIRONMENT.siteSettings.registration && SC.ENVIRONMENT.siteSettings.registration.companyfieldmandatory === 'T';
    }
    // @method isPhoneRequired
    // Check if phone field is mandatory.
    function isPhoneRequired() {
        return SC && SC.CONFIGURATION && SC.CONFIGURATION.addresses && SC.CONFIGURATION.addresses.isPhoneMandatory;
    }
    // @class Address.Model @extend Backbone.Model
    return Backbone.Model.extend({
        // @property {String} urlRoot
        urlRoot: 'services/Address.Service.ss'    //@property validation
                                         // Backbone.Validation attribute used for validating the form before submit.
,
        validation: {
            fullname: {
                required: true,
                msg: _('Full Name is required').translate()
            },
            addr1: {
                required: true,
                msg: _('Address is required').translate()
            },
            company: {
                required: isCompanyRequired(),
                msg: _('Company is required').translate()
            },
            country: {
                required: true,
                msg: _('Country is required').translate()
            },
            state: { fn: _.validateState },
            city: {
                required: true,
                msg: _('City is required').translate()
            },
            zip: { fn: _.validateZipCode },
            phone: {
                required: isPhoneRequired(),
                fn: _.validatePhone
            }
        }    // @method getInvalidAttributes
             // Returns an array of localized attributes that are invalid for the current address.
,
        getInvalidAttributes: function () {
            //As this model is not always used inside a model's view, we need to check that the validation is attached
            var attributes_to_validate = _.keys(this.validation), attribute_name, invalid_attributes = [];
            this.get('isvalid') !== 'T' && this.isValid(true) && _.extend(this, Backbone.Validation.mixin);
            _.each(attributes_to_validate, function (attribute) {
                if (!this.isValid(attribute)) {
                    attribute_name = null;
                    switch (attribute) {
                    case 'fullname':
                        attribute_name = _('Full Name').translate();
                        break;
                    case 'addr1':
                        attribute_name = _('Address').translate();
                        break;
                    case 'city':
                        attribute_name = _('City').translate();
                        break;
                    case 'zip':
                        attribute_name = _('Zip Code').translate();
                        break;
                    case 'country':
                        attribute_name = _('Country').translate();
                        break;
                    case 'phone':
                        attribute_name = _('Phone Number').translate();
                        break;
                    case 'state':
                        attribute_name = _('State').translate();
                        break;
                    }
                    if (attribute_name) {
                        invalid_attributes.push(attribute_name);
                    }
                }
            }, this);
            return invalid_attributes;
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Address
define('Address.Details.View', [
    'address_details.tpl',
    'SC.Configuration',
    'Backbone',
    'underscore',
    'Utils'
], function (address_tpl, Configuration, Backbone, _) {
    'use strict';
    //@class Address.View @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: address_tpl    //@property {Object} attributes
,
        attributes: { 'class': 'AddressDetailsView' }    //@method initialize Attach to any change on the model and make a render on this changes
                                             //@return {Void}
,
        initialize: function () {
            this.model.on('sync', _.bind(this.render, this));
        },
        destroy: function destroy() {
            this.model.off('sync');
            return this._destroy();
        }    //@method getContext @return Address.View.Context
,
        getContext: function () {
            var label = this.model.get('label'), company = Configuration.get('siteSettings.registration.displaycompanyfield') === 'T' ? this.model.get('company') : null, fullname = this.model.get('fullname'), countries = Configuration.get('siteSettings.countries', []), country_object = countries[this.model.get('country')], country = country_object ? country_object.name : this.model.get('country'), state_object = country_object && country_object.states ? _.findWhere(countries[this.model.get('country')].states, { code: this.model.get('state') }) : null, state = state_object ? state_object.name : this.model.get('state'), invalidAttributes = this.model.getInvalidAttributes() || [];
            //@class Address.View.Context
            return {
                //@property {Address.Model} model
                model: this.model,
                internalid: this.model.get('internalid')    //@property {Boolean} isManageOptionsSpecified
,
                isManageOptionsSpecified: !!this.options.manage,
                manageOption: this.options.manage,
                showMultiSelect: this.options.showMultiSelect,
                isAddressCheck: !!this.model.get('check')    //@property {String} title
,
                title: label || company || fullname    //@property {Boolean} showCompanyAndFullName
,
                showCompanyAndFullName: !!(label && company)    //@property {String} company
,
                company: company    //@property {String} fullname
,
                fullname: fullname    //@property {Boolean} showFullNameOnly
,
                showFullNameOnly: !!(label ? !company : company)    //@property {String} addressLine1
,
                addressLine1: this.model.get('addr1')    //@property {Boolean} showAddressLine1
,
                showAddressLine1: !!this.model.get('addr2')    //@property {String} addressLine2
,
                addressLine2: this.model.get('addr2')    //@property {String} city
,
                city: this.model.get('city')    //@property {Boolean} showState
,
                showState: !!this.model.get('state')    //@property {String} state
,
                state: state    //@property {String} zip
,
                zip: this.model.get('zip')    //@property {String} country
,
                country: country    //@property {String} phone
,
                phone: this.model.get('phone')    //@property {Boolean} showDefaultLabels
,
                showDefaultLabels: !this.options.hideDefaults,
                isDefaultShippingAddress: this.model.get('defaultshipping') === 'T'    //@property {Boolean} isDefaultBillingAddress
,
                isDefaultBillingAddress: this.model.get('defaultbilling') === 'T'    //@property {Boolean} showSelectionButton
,
                showSelectionButton: !!this.options.showSelect,
                isASelectMessageSpecified: !!this.options.selectMessage,
                selectMessage: this.options.selectMessage,
                showActionButtons: !this.options.hideActions,
                showChangeButton: !!this.options.showChangeButton,
                showRemoveButton: !this.options.hideRemoveButton,
                showError: this.options.showError && this.model.get('isvalid') && this.model.get('isvalid') !== 'T' && invalidAttributes.length,
                invalidAttributes: invalidAttributes    //@property {Boolean} isInvalidAddressToRemove
,
                isInvalidAddressToRemove: !!(this.options.disableRemoveButton && this.options.disableRemoveButton(this.model.get('internalid')))
            };
        }
    });
});



/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard
define('OrderWizard.Module.Address', [
    'Wizard.Module',
    'Address.Edit.View',
    'Address.Model',
    'Address.Details.View',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'SC.Configuration',
    'GlobalViews.Confirmation.View',
    'order_wizard_address_module.tpl',
    'order_wizard_address_row.tpl',
    'order_wizard_address_cell.tpl',
    'Backbone',
    'underscore',
    'jQuery',
    'Utils'
], function (WizardModule, AddressEditView, AddressModel, AddressDetailsView, BackboneCompositeView, BackboneCollectionView, Configuration, GlobalViewsConfirmationView, order_wizard_address_module_tpl, order_wizard_address_row_tpl, order_wizard_address_cell_tpl, Backbone, _, jQuery) {
    'use strict';
    //@class OrderWizard.Module.Address @extend Wizard.Module
    return WizardModule.extend({
        template: order_wizard_address_module_tpl,
        sameAsMessage: _('Same as Address').translate(),
        selectAddressErrorMessage: {
            errorCode: 'ERR_CHK_SELECT_AN_ADDRESS',
            errorMessage: _('Please select an address').translate()
        },
        invalidAddressErrorMessage: {
            errorCode: 'ERR_CHK_INVALID_ADDRESS',
            errorMessage: _('The selected address is invalid').translate()
        },
        events: {
            'click [data-action="submit"]': 'submit',
            'click [data-action="select"]': 'selectAddress',
            'click [data-action="change-address"]': 'changeAddressHandler',
            'click [data-action="remove"]': 'validateAddressRemovalHandler',
            'click [data-action="edit-address"]': 'editAddress',
            'change [data-action="same-as"]': 'markSameAsHandler',
            'change form': 'changeForm'
        },
        errors: [
            'ERR_CHK_INCOMPLETE_ADDRESS',
            'ERR_CHK_INVALID_ADDRESS'
        ],
        initialize: function () {
            WizardModule.prototype.initialize.apply(this, arguments);
            BackboneCompositeView.add(this);
        }    //@method editAddress Intercept the edition of address. When the source of addresses is extracted from the current model
             //(which is the expected behavior form now on) that address collection can contains address that are temporal or just not in the addresses
             //profile collection. One example is when you pay a quote transforming it into a sales order, the original shipping/billing address
             //used to created to quote can have been removed from profile addresses and so are added as temporal address, that when edited are created
             //@param {jQuery.Event} e
             //@return {Void}
,
        editAddress: function (e) {
            var address_id_str = this.$(e.target).data('id'), address_id = parseInt(address_id_str, 10);
            if (_.isNaN(address_id) || !_.isNumber(address_id)) {
                e.stopPropagation();
                e.preventDefault();
                var collection = this.getAddressCollection(), selected_address = collection.get(address_id_str), view;
                selected_address.unset('internalid', { silent: true });
                view = new AddressEditView({
                    application: this.wizard.application,
                    collection: collection,
                    model: selected_address
                });
                var add_new_address_on_profile = function (model) {
                        //Make sure that the new address now take part of the profile addresses
                        //This is important if a temporal address is edited more than once
                        this.wizard.options.profile.get('addresses').add(model);
                    }, reset_current_address = function (model) {
                        //After saving the temp address, we set it as the one selected
                        this.setAddress(model.id);
                    };
                view.model.once('change', add_new_address_on_profile, this);
                //If the address being edited is the selected one we must re-set once it is created
                if (this.wizard.model.get(this.manage) === address_id_str) {
                    view.model.once('sync', reset_current_address, this);
                }
                view.once('modal-close', function () {
                    view.model.off('sync', reset_current_address);
                    view.model.off('change', add_new_address_on_profile);
                }, this);
                this.wizard.application.getLayout().showInModal(view);
            }
        }    //@method render
,
        render: function (not_trigger_ready) {
            //Is Active is overridden by child modules, like Shipping to hide this module in Multi Ship To
            if (!this.isActive()) {
                return this.$el.empty();
            }
            this.addresses = this.getAddressCollection();
            this.isGuest = this.getIsCurrentUserGuest();
            this.isSameAsEnabled = _.isFunction(this.options.enable_same_as) ? this.options.enable_same_as() : this.options.enable_same_as;
            this.addressId = this.model.get(this.manage);
            this.evaluateDisablingSameAsCheckBox();
            // if the selected manage address is the fake one
            if (this.addressId && ~this.addressId.indexOf('null')) {
                // we silently remove it
                this.setAddress(null, { silent: true });
            }
            this.evaluateSameAs();
            this.address = this.getSelectedAddress();
            // Add event listeners to allow special flows
            this.eventHandlersOn();
            this.addressView = null;
            // Calls the render function
            this._render();
            var is_address_new = this.address.isNew();
            if (!(this.isSameAsEnabled && this.sameAs || this.addressId && !is_address_new) && this.isGuest && !is_address_new) {
                this.setAddress(this.address.id, { silent: true });
            }
            // the module is ready when a valid address is selected.
            if (!not_trigger_ready && this.address && this.addressId && this.address.get('isvalid') === 'T') {
                this.trigger('ready', true);
            }
        }    // @method enableInterface
,
        enableInterface: function () {
            this.$('[data-action="change-address"]').attr('disabled', false);
            this.evaluateDisablingSameAsCheckBox();
            if (!this.disableSameAsCheckBox) {
                this.$('[data-action="same-as"]').attr('disabled', false);
            }
        }    // @method evaluateDisablingSameAsCheckBox Evaluates if the same as checkbox should be enabled or not. This values is saved in the instance variable disableSameAsCheckBox
             // it is possible to indicate that if the new value is enable to ren-render the view @param {Boolean} re_render_is_change
,
        evaluateDisablingSameAsCheckBox: function (re_render_is_change) {
            //The other manage address is not selected AND the other temp address is not created
            var old_value = this.disableSameAsCheckBox;
            this.disableSameAsCheckBox = (this.model.get(this.sameAsManage) === undefined || this.model.get(this.sameAsManage) === null || this.model.get(this.sameAsManage) === '-------null') && !this.model.get('temp' + this.sameAsManage);
            if (old_value !== this.disableSameAsCheckBox && re_render_is_change) {
                this.render();
            }
        }    // @method disableInterface
,
        disableInterface: function () {
            this.$('[data-action="change-address"], [data-action="same-as"]').attr('disabled', true);
        }    // @method getChangeLinkText This function, which is called from the template, returns the label for the change link @return {String}
,
        getChangeLinkText: function () {
            return this.getIsCurrentUserGuest() ? _('Edit Address').translate() : _('Change address').translate();
        }    // @method getIsCurrentUserGuest Returns true if the current user is logged in as Guest @return {Boolean}
,
        getIsCurrentUserGuest: function () {
            return this.wizard.options.profile.get('isGuest') === 'T';
        }    // @method validateAddressRemovalHandler Handle address removal validating that the address selected is not being used by someone else @param {HTMLEvent}e
,
        validateAddressRemovalHandler: function (e)
            //address_module
            {
                var address_id = jQuery(e.target).data('id');
                this.validateAddressRemoval(address_id);
            }    // @method validateAddressRemoval Handle address removal validating that the address selected is not being used by someone else @param {String} address_id
,
        validateAddressRemoval: function (address_id)
            //address_module
            {
                var deleteConfirmationView, body = '';
                if (this.isAddressIdValidForRemoval(address_id)) {
                    body = _('Are you sure you want to remove this address?').translate();
                } else {
                    var other_address_message = this.sameAsManage === 'billaddress' ? _('(billing address)').translate() : this.sameAsManage === 'shipaddress' ? _('(shipping address)').translate() : '';
                    body = _('The selected address is in use. $(0) Are you sure you want to delete this address?').translate(other_address_message);
                }
                deleteConfirmationView = new GlobalViewsConfirmationView({
                    callBack: this.removeAddress,
                    callBackParameters: {
                        context: this,
                        addressId: address_id
                    },
                    title: _('Remove Address').translate(),
                    body: body,
                    autohide: true
                });
                this.wizard.application.getLayout().showInModal(deleteConfirmationView);
            },
        removeAddress: function (options) {
            options.context.addresses.get(options.addressId).destroy({ wait: true });
        }    // @method isAddressIdValidForRemoval Validate that the address that want to be removed is not used by the related address (sameAsManage) @returns {Boolean}
,
        isAddressIdValidForRemoval: function (address_id) {
            var related_address_id = this.model.get(this.sameAsManage);
            return +address_id !== +related_address_id;
        }    // @method evaluateSameAs
,
        evaluateSameAs: function () {
            var manage_address_id = this.addressId, other_address = this.getTheOtherAddress(), other_address_id = other_address && other_address.get('internalid') || null;
            if (manage_address_id && manage_address_id === other_address_id) {
                this.sameAs = true;
            } else if (!this.tempAddress && manage_address_id !== other_address_id) {
                this.sameAs = false;
            } else {
                // We need a default sameAs value so is no longer undefined
                // if the sameAs was checked, and we have an address id set or there is a temporary address
                this.sameAs = this.sameAs && (manage_address_id || this.tempAddress || this.isGuest && this.addresses.length);
            }
            this.model.set('sameAs', this.sameAs);
        }    // @method eventHandlersOn
,
        eventHandlersOn: function () {
            var self = this, other_address = this.sameAsManage;
            this.eventHandlersOff();
            this.addresses.on('reset sync add remove change destroy', function () {
                this.render(true);
            }, this).on('destroy', function (deleted_address) {
                // if the destroyed address was used as the sameAs
                if (self.model.get(other_address) === deleted_address.id) {
                    // we need to remove it, as it doesn't exists
                    self.model.set(other_address, null);
                }
            }, this);
            // when the value for the other address changes
            this.model.on('change:' + other_address, function (model, value) {
                // If same as is enabled and its selected
                if (self.isSameAsEnabled && self.sameAs) {
                    // we change this manage to the value
                    self.setAddress(value);
                    self.render();
                } else if (self.isSameAsEnabled) {
                    //This evaluation must be done despite self.sameAs is set or not to re-evaluate if the check-box status remains equal or not.
                    //Ex. If in OPC neither shipping address not billing address is selected, and after that I select one shipping address, then it's require
                    // to re-evaluate the state of the sameAs check-box
                    this.evaluateDisablingSameAsCheckBox(true);
                }
            }, this);
            if (this.isSameAsEnabled && this.sameAs) {
                this.model.on('change:temp' + other_address, function (model, temp_address) {
                    self.tempAddress = temp_address;
                    self.render();
                }, this);
            } else if (this.isSameAsEnabled) {
                this.model.once('change:temp' + other_address, function () {
                    //The following consideration take importance in OPC.
                    //Changes in the temp (other) address will take into account only if there is no a real (other) address, otherwise this generate that
                    //render gets executed more than once, because is this event always get triggered by the changeForm method.
                    //Problem example: When the temp address change because of submitting the other address (particularly shipping address) this will cause
                    //that the billing address get re-rendered, and if the billing is not completed all errors will disappear.
                    if (!this.model.get(other_address)) {
                        this.render();
                    }
                }, self);
            }
            _.isFunction(this.onEventHandlersOn) && this.onEventHandlersOn();
        }    // @method eventHandlersOff
,
        eventHandlersOff: function () {
            // Removes previously added events on the address collection
            this.addresses && this.addresses.off(null, null, this);
            this.model.off('change:' + this.sameAsManage, null, this).off('change:temp' + this.sameAsManage, null, this);
            _.isFunction(this.onEventHandlersOff) && this.onEventHandlersOff();
        },
        past: function () {
            this.eventHandlersOff();
        },
        future: function () {
            this.eventHandlersOff();
        }    // @method selectAddress Captures the click on the select button of the addresses list @param {HTMLEvent} e
,
        selectAddress: function (e) {
            jQuery('.wizard-content .alert-error').hide();
            // Grabs the address id and sets it to the model
            // on the position in which our sub class is managing (billaddress or shipaddress)
            this.setAddress(jQuery(e.target).data('id').toString());
            // re render so if there is changes to be shown they are represented in the view
            this.render();
            // As we already set the address, we let the step know that we are ready
            this.trigger('ready', true);
        }    // @method setAddress @param {String} address_id @param {Object} options
,
        setAddress: function (address_id, options) {
            this.model.setAddress(this.manage, address_id, options);
            this.addressId = address_id;
            return this;
        }    // @method unsetAddress @param {Boolean} norender @param {Object} options
,
        unsetAddress: function (norender, options) {
            this.setAddress(null, options);
            this.tempAddress = null;
            if (!norender) {
                this.render();
            }
        }    // @method changeAddressHandler @param {HTMLEvent} e
,
        changeAddressHandler: function (e) {
            e.preventDefault();
            e.stopPropagation();
            var $link = jQuery(e.currentTarget), is_disabled = $link.attr('disabled');
            this.changeAddress(is_disabled);
        }    // @method changeAddress @parma {Boolean} is_disabled
,
        changeAddress: function (is_disabled) {
            if (is_disabled) {
                return;
            }
            if (this.options.edit_url) {
                this.unsetAddress(true);
                Backbone.history.navigate(this.options.edit_url + '?force=true', { trigger: true });
            } else {
                this.unsetAddress();
            }
        }    // @method submit. Module.submit() The step will call this function when the user clicks next or all the modules are ready
             // Will take care of saving the address if its a new one. Other way it will just
             // return a resolved promise to comply with the API
,
        submit: function () {
            //Is Active is overridden by child modules, like Shipping to hide this module in Multi Ship To
            if (!this.isActive()) {
                return jQuery.Deferred().resolve();
            }
            var self = this;
            // its a new address
            if (this.addressView) {
                // The saveForm function expects the event to be in an element of the form or the form itself,
                // But in this case it may be in a button outside of the form (as the nav buttons live in the step)
                //  or triggered by a module ready event, so we need to create a fake event which the target is the form itself
                var fake_event = jQuery.Event('submit', { target: this.addressView.$('form').get(0) })    // Calls the saveForm, this may kick the backbone.validation, and it may return false if there were errors,
                                                                                             // other ways it will return an Ajax promise
, result = this.addressView.saveForm(fake_event);
                var save_result = jQuery.Deferred();
                // Went well, so there is a promise we can return, before returning we will set the address in the model
                // and add the model to the profile collection
                if (result && !result.frontEndValidationError) {
                    result.done(function (model) {
                        // Set Address id to the order model. This has to go before the following self.addresses.add() as it triggers the render
                        self.setAddress(model.internalid);
                        // we only want to trigger an event on add() when the user has some address and is not guest because if not,
                        // in OPC case (two instances of this module in the same page), the triggered re-render erase the module errors.
                        var add_options = self.isGuest || self.addresses.length === 0 ? { silent: true } : null;
                        self.addresses.add(model, add_options);
                        self.model.set('temp' + self.manage, null);
                        self.newAddressCreated && self.newAddressCreated(model.internalid, add_options);
                        self.render();
                        save_result.resolve();
                    });
                } else {
                    // There were errors so we return a rejected promise
                    save_result.reject({
                        errorCode: 'ERR_CHK_INCOMPLETE_ADDRESS',
                        errorMessage: _('The address is incomplete').translate()
                    });
                }
                return save_result;
            } else {
                return this.isValid();
            }
        }    //@method getAddressCollection Return the address collection source
             //@return {Address.Collection}
,
        getAddressCollection: function () {
            return this.options.useModelAddresses ? this.wizard.model.get('addresses') : this.wizard.options.profile.get('addresses');
        },
        isValid: function () {
            //Is Active is override by child modules, like Shipping to hide this module in Multi Ship To
            if (!this.isActive() || this.tempAddress) {
                return jQuery.Deferred().resolve();
            }
            var addresses = this.getAddressCollection(), selected_address = addresses && addresses.get(this.model.get(this.manage));
            if (selected_address) {
                if (selected_address.get('isvalid') === 'T') {
                    return jQuery.Deferred().resolve();
                }
                return jQuery.Deferred().reject(this.invalidAddressErrorMessage);
            }
            return jQuery.Deferred().reject(this.selectAddressErrorMessage);
        },
        changeForm: function (e) {
            this.model.set('temp' + this.manage, jQuery(e.target).closest('form').serializeObject());
        },
        markSameAsHandler: function (e) {
            var is_checked = jQuery(e.target).prop('checked');
            this.markSameAs(is_checked);
        }    // @method markSameAs @param {Boolean} is_checked
,
        markSameAs: function (is_checked) {
            this.sameAs = is_checked;
            this.model.set('sameAs', is_checked);
            this.setAddress(is_checked ? this.model.get(this.sameAsManage) : null);
            this.tempAddress = is_checked ? this.model.get('temp' + this.sameAsManage) : null;
            this.render();
        }    // @method getSelectedAddress @returns the selected address
,
        getSelectedAddress: function () {
            if (!this.addressId) {
                if (this.sameAs && this.tempAddress) {
                    return new AddressModel(this.tempAddress);
                }
                // if the user is guest it only has 1 address for this module so we return that address or a new one
                if (this.isGuest) {
                    return this.getFixedAddress();
                }
            }
            return this.addresses.get(this.addressId) || this.getEmptyAddress();
        }    // @method getEmptyAddress
             // If the same as check-box is not checked
             // we return a new model with any attributes that were already typed into the address form
             // that's what the temp + this.manage is, the temporary address for this manage.
,
        getEmptyAddress: function () {
            return new AddressModel(this.isSameAsEnabled && this.sameAs ? null : this.model.get('temp' + this.manage));
        }    // @method getTheOtherAddress returns the address in the addresses collection which id is current model's sameAsManage attribute
,
        getTheOtherAddress: function () {
            return this.addresses.get(this.model.get(this.sameAsManage));
        }    // @method getAddressesToShow returns the list of addresses available for this module, if the module has enable_same_as then it removes the sameAsManage address
,
        getAddressesToShow: function () {
            if (this.isGuest && this.isSameAsEnabled) {
                var same_as_address_id = this.model.get(this.sameAsManage);
                return new Backbone.Collection(this.addresses.reject(function (address) {
                    return address.id === same_as_address_id;
                }));
            } else {
                return new Backbone.Collection(this.addresses.models);
            }
        }    // @method getFixedAddress return the fixed address for this module. This is used only when user = guest
             // returns the first address to show or an empty address
,
        getFixedAddress: function () {
            var addresses = this.getAddressesToShow();
            return addresses.length ? addresses.at(0) : this.getEmptyAddress();
        }    // @method manageError @param {Object} error
,
        manageError: function (error) {
            if (error && error.errorCode !== 'ERR_CHK_INCOMPLETE_ADDRESS') {
                WizardModule.prototype.manageError.apply(this, arguments);
            }
        }    // @method getAddressListOptions Get the object containing the options to be passed to the Address.Details view when rendering the list of available addresses
             // @return {showSelect:Boolean,selectMessage:String,hideDefaults:Boolean}
,
        getAddressListOptions: function () {
            return {
                showSelect: true,
                selectMessage: this.selectMessage || '',
                hideDefaults: true
            };
        },
        prepopulateAddressModel: function () {
            if (this.wizard.isAutoPopulateEnabled && this.wizard.isAutoPopulateEnabled()) {
                this.address.set('fullname', this.wizard.options.profile.get('firstname') + ' ' + this.wizard.options.profile.get('lastname'));
            }
            return this.address;
        },
        childViews: {
            'Single.Address.Details': function () {
                return new AddressDetailsView({
                    model: this.address,
                    hideDefaults: true,
                    manage: this.manage,
                    showChangeButton: !this.isGuest,
                    hideRemoveButton: !!this.isGuest,
                    hideActions: !this.address.id,
                    showError: true
                });
            },
            'New.Address.Form': function () {
                this.addressView = new AddressEditView({
                    application: this.wizard.application,
                    collection: this.addresses,
                    model: this.prepopulateAddressModel(),
                    manage: this.manage,
                    hideFooter: true,
                    hideHeader: true
                });
                return this.addressView;
            },
            'Address.List': function () {
                return new BackboneCollectionView({
                    collection: this.getAddressesToShow(),
                    viewsPerRow: this.itemsPerRow || (_.isDesktopDevice() ? 2 : 1),
                    rowTemplate: order_wizard_address_row_tpl,
                    cellTemplate: order_wizard_address_cell_tpl,
                    childView: AddressDetailsView,
                    childViewOptions: this.getAddressListOptions()
                });
            }
        }    //@method getContext @return {OrderWizard.Module.Address.Context}
,
        getContext: function () {
            //@class OrderWizard.Module.Address.Context
            return {
                //@property {Boolean} showTitle
                showTitle: !!(!this.options.hide_title && this.getTitle())    //@property {String} title
,
                title: this.getTitle()    //@property {Boolean} isSameAsEnabled
,
                isSameAsEnabled: !!this.isSameAsEnabled,
                isSameAsCheckBoxDisable: !!this.disableSameAsCheckBox,
                isSameAsSelected: !!this.sameAs,
                sameAsMessage: this.sameAsMessage,
                showSingleAddressDetails: !!(this.isSameAsEnabled && this.sameAs || this.addressId && !this.address.isNew()) || !!(this.getAddressesToShow().length && this.isGuest)    //@property {Boolean} showAddressList
,
                showAddressList: !!(this.getAddressesToShow().length && !this.isGuest)    //@property {String} changeLinkText
,
                changeLinkText: this.getChangeLinkText()    //@property {String} selectedAddressId
,
                selectedAddressId: this.address && this.address.get('internalid') || ''    //@property {Boolean} showManageValue
,
                showManageValue: !!this.manage,
                manageValue: this.manage,
                showSaveButton: this.showSaveButton
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard
define('OrderWizard.Module.Address.Shipping', [
    'OrderWizard.Module.Address',
    'underscore',
    'jQuery',
    'Utils'
], function (OrderWizardModuleAddress, _, jQuery) {
    'use strict';
    //@class OrderWizard.Module.Address.Shipping @extend OrderWizard.Module.Address
    return OrderWizardModuleAddress.extend({
        manage: 'shipaddress',
        sameAsManage: 'billaddress',
        className: 'OrderWizard.Module.Address.Shipping',
        errors: [
            'ERR_CHK_INCOMPLETE_ADDRESS',
            'ERR_CHK_SELECT_SHIPPING_ADDRESS',
            'ERR_CHK_INVALID_SHIPPING_ADDRESS',
            'ERR_WS_INVALID_SHIPPING_ADDRESS'
        ],
        sameAsMessage: _('Same as billing address').translate(),
        selectAddressErrorMessage: {
            errorCode: 'ERR_CHK_SELECT_SHIPPING_ADDRESS',
            errorMessage: _('Please select a shipping address').translate()
        },
        invalidAddressErrorMessage: {
            errorCode: 'ERR_CHK_INVALID_SHIPPING_ADDRESS',
            errorMessage: _('The selected shipping address is invalid').translate()
        },
        selectMessage: _('Ship to this Address').translate(),
        isActive: function () {
            return !this.wizard.model.get('ismultishipto') && this.wizard.model.shippingAddressIsRequired();
        },
        eventHandlersOn: function () {
            OrderWizardModuleAddress.prototype.eventHandlersOn.apply(this, arguments);
            this.model.on('change:tempshipaddress', jQuery.proxy(this, 'estimateShipping'), this);
            this.wizard.model.on('ismultishiptoUpdated', this.render, this);
        },
        eventHandlersOff: function () {
            OrderWizardModuleAddress.prototype.eventHandlersOff.apply(this, arguments);
            this.model.off('change:tempshipaddress', null, this);
            this.model.off('change:ismultishipto', null, this);
        },
        changeAddress: function () {
            OrderWizardModuleAddress.prototype.changeAddress.apply(this, arguments);
            if (this.address) {
                this.model.trigger('change:' + this.manage);
            }
        },
        estimateShipping: function (model, address) {
            var countries = this.wizard.application.getConfig('siteSettings.countries'), country_value = address && address.country, state_value = address && address.state, zip_value = address && address.zip, country_ready = country_value && country_value !== model.previous('country'), state_ready = country_value && !countries[country_value].states || state_value && state_value !== model.previous('state'), zip_ready = country_value && countries[country_value].isziprequired === 'F' || zip_value && zip_value !== model.previous('zip');
            if (country_ready && zip_ready && state_ready) {
                var addresses = this.model.get('addresses'), address_id = country_value + '-' + (state_value || '-') + '--' + (zip_value || '-') + '----null', current_address = addresses.get(address_id);
                if (!current_address) {
                    addresses.add({
                        internalid: address_id,
                        country: country_value,
                        state: state_value,
                        zip: zip_value
                    });
                } else {
                    current_address.set({
                        country: country_value,
                        state: state_value,
                        zip: zip_value
                    });
                }
                if (this.addressId !== address_id) {
                    model.set({
                        shipaddress: address_id,
                        isEstimating: true
                    });
                }
            } else {
                model.set({ isEstimating: false });
            }
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Quote
define('OrderWizard.Module.PaymentMethod.GiftCertificates.Record', [
    'GlobalViews.FormatPaymentMethod.View',
    'order_wizard_paymentmethod_giftcertificates_module_record.tpl',
    'Backbone',
    'Backbone.CompositeView'
], function (GlobalViewsFormatPaymentMethodView, order_wizard_paymentmethod_giftcertificates_module_record_tpl, Backbone, BackboneCompositeView) {
    'use strict';
    // @class OrderWizard.Module.PaymentMethod.GiftCertificates.Record @extends Backbone.View
    return Backbone.View.extend({
        template: order_wizard_paymentmethod_giftcertificates_module_record_tpl,
        initialize: function () {
            BackboneCompositeView.add(this);
        }    // @property {Object} childViews
,
        childViews: {
            'GiftCertificates': function () {
                return new GlobalViewsFormatPaymentMethodView({ model: this.model });
            }
        }    // @method getContext @return OrderWizard.Module.PaymentMethod.GiftCertificates.Record.Context
,
        getContext: function () {
            // @class OrderWizard.Module.PaymentMethod.GiftCertificates.Record.Context
            return {
                // @property {Quote.Model} collection 
                giftcertificate: this.model.get('giftcertificate')
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @method OrderWizard.Module.Confirmation
define('OrderWizard.Module.PaymentMethod.GiftCertificates', [
    'Wizard.Module',
    'OrderWizard.Module.PaymentMethod.GiftCertificates.Record',
    'GlobalViews.Confirmation.View',
    'order_wizard_paymentmethod_giftcertificates_module.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'underscore',
    'jQuery',
    'Utils'
], function (WizardModule, OrderWizardModulePaymentMethodGiftCertificatesRecord, GlobalViewsConfirmationView, order_wizard_paymentmethod_giftcertificates_module_tpl, Backbone, BackboneCompositeView, BackboneCollectionView, _, jQuery) {
    'use strict';
    // @class OrderWizard.Module.PaymentMethod.GiftCertificates @extends WizardModule.extend
    return WizardModule.extend({
        template: order_wizard_paymentmethod_giftcertificates_module_tpl,
        className: 'OrderWizard.Module.PaymentMethod.GiftCertificates',
        events: {
            'submit form': 'applyGiftCertificate',
            'click [data-action="remove"]': 'removeGiftCertificate',
            'shown [data-action="gift-certificate-form"]': 'onShownGiftCertificateForm'
        },
        initialize: function () {
            WizardModule.prototype.initialize.apply(this, arguments);
            BackboneCompositeView.add(this);
        },
        errors: [
            'ERR_WS_INVALID_GIFTCERTIFICATE',
            'ERR_WS_APPLIED_GIFTCERTIFICATE',
            'ERR_WS_EMPTY_GIFTCERTIFICATE'
        ]    // Determines if the current module is valid to be shown and operate with
,
        isActive: function () {
            return SC.ENVIRONMENT.giftCertificatesEnabled;
        },
        render: function () {
            // Is Active is overridden by child modules, like Shipping to hide this module in Multi Ship To
            if (!this.isActive()) {
                this.$el.attr('class', '');
                return this.$el.empty();
            }
            this.giftCertificates = this.model.get('paymentmethods').where({ type: 'giftcertificate' }) || [];
            this.trigger('ready', true);
            this._render();
        },
        eventHandlersOff: function () {
            this.model.off('change:paymentmethods', this.render, this);
        },
        past: function () {
            this.eventHandlersOff();
        },
        present: function () {
            this.eventHandlersOff();
            this.model.on('change:paymentmethods', this.render, this);
        },
        future: function () {
            this.eventHandlersOff();
        },
        updateGiftCertificates: function (codes) {
            var self = this;
            codes = _.map(codes, function (code) {
                return { code: code };
            });
            // disable navigation buttons
            this.wizard.getCurrentStep().disableNavButtons();
            // disable inputs and buttons
            this.$('input, button').prop('disabled', true);
            return new Backbone.Model().save({ giftcertificates: codes }, {
                url: _.getAbsoluteUrl('services/LiveOrder.GiftCertificate.Service.ss'),
                success: function (model, attributes) {
                    self.model.set({
                        paymentmethods: attributes.paymentmethods,
                        summary: attributes.summary,
                        touchpoints: attributes.touchpoints
                    });
                },
                error: function (model, jqXhr) {
                    jqXhr.preventDefault = true;
                    self.wizard.manageError(JSON.parse(jqXhr.responseText));
                }
            }).always(function () {
                // enable navigation buttons
                self.wizard.getCurrentStep().enableNavButtons();
                // enable inputs and buttons
                self.$('input, button').prop('disabled', false);
            });
        },
        applyGiftCertificate: function (e) {
            e.preventDefault();
            var code = jQuery.trim(jQuery(e.target).find('[name="code"]').val()), is_applied = _.find(this.giftCertificates, function (certificate) {
                    return certificate.get('giftcertificate').code === code;
                });
            if (!code) {
                this.wizard.manageError({
                    errorCode: 'ERR_WS_EMPTY_GIFTCERTIFICATE',
                    errorMessage: _('Gift Certificate is empty').translate()
                });
            } else if (is_applied) {
                this.wizard.manageError({
                    errorCode: 'ERR_WS_APPLIED_GIFTCERTIFICATE',
                    errorMessage: _('Gift Certificate is applied').translate()
                });
            } else {
                this.updateGiftCertificates(this.getGiftCertificatesCodes().concat(code));
            }
        },
        removeGiftCertificate: function (e) {
            var code = jQuery(e.target).data('id').toString(), is_applied = _.find(this.giftCertificates, function (payment_method) {
                    return payment_method.get('giftcertificate').code === code;
                });
            if (is_applied) {
                var deleteConfirmationView = new GlobalViewsConfirmationView({
                    callBack: this._removeGiftCertificate,
                    callBackParameters: {
                        context: this,
                        code: code
                    },
                    title: _('Remove Gift certificate').translate(),
                    body: _('Are you sure you want to remove this Gift certificate?').translate(),
                    autohide: true
                });
                this.wizard.application.getLayout().showInModal(deleteConfirmationView);
            }
        },
        _removeGiftCertificate: function (options) {
            options.context.updateGiftCertificates(_.without(options.context.getGiftCertificatesCodes(), options.code));
        },
        getGiftCertificatesCodes: function () {
            return _.map(this.giftCertificates, function (payment_method) {
                return payment_method.get('giftcertificate').code;
            });
        },
        showError: function () {
            this.$('.control-group').addClass('error');
            WizardModule.prototype.showError.apply(this, arguments);
        }    // onShownGiftCertificateForm
             // Handles the shown of promocode form
,
        onShownGiftCertificateForm: function (e) {
            jQuery(e.target).find('input[name="code"]').focus();
        }    // @property {Object} childViews
,
        childViews: {
            'GiftCertificatesRecords': function () {
                return new BackboneCollectionView({
                    collection: this.giftCertificates,
                    childView: OrderWizardModulePaymentMethodGiftCertificatesRecord,
                    viewsPerRow: 1
                });
            }
        }    // @method getContext @return OrderWizard.Module.PaymentMethod.GiftCertificates.Context
,
        getContext: function () {
            // @class OrderWizard.Module.PaymentMethod.GiftCertificates.Context
            return {
                // @property {String} pageHeader
                pageHeader: this.getTitle()    // @property {Boolean} hasGiftCertificates
,
                hasGiftCertificates: 0 < this.giftCertificates.length
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// OrderWizard.Module.PaymentMethod.js
// --------------------------------
//
define('OrderWizard.Module.PaymentMethod', ['Wizard.Module'], function (WizardModule) {
    'use strict';
    return WizardModule.extend({
        submit: function () {
            // Gets the payment method for this object
            var payment_method = this.paymentMethod;
            return this.model.addPayment(payment_method);
        }
    });
});


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Address
define('Address.Collection', [
    'Address.Model',
    'Backbone'
], function (Model, Backbone) {
    'use strict';
    //@class Address.Collection @extend Backbone.Collection
    return Backbone.Collection.extend({
        //@property {Address.Model} model
        model: Model    //@property {String} url
,
        url: 'services/Address.Service.ss'    //@method comparator Defines a custom comparative method between address to sort the address taking into account if there are default shipping or default billing
                                         //@param {Address.Model} model
                                         //@return {Number}
,
        comparator: function (model) {
            return model.get('defaultbilling') === 'T' || model.get('defaultshipping') === 'T' ? 0 : 1;
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CreditCard
// Model for handling credit cards (CRUD)
define('CreditCard.Model', [
    'Backbone',
    'underscore',
    'jQuery',
    'Utils'
], function (Backbone, _, jQuery) {
    'use strict';
    //@method validate that the expiration date is bigger than today
    function validateExpirationDate(value, name, data) {
        var current = new Date(), selected_date = new Date(data.expyear, data.expmonth - 1).getTime();
        if (!value || _.isNaN(selected_date) || new Date(current.getFullYear(), current.getMonth()).getTime() > selected_date) {
            return _('Please select a date in the future').translate();
        }
    }
    // @class CreditCard.Model responsible of implement the REST model of a credit card and of validating 
    // the credit card properties @extends Backbone.Model
    return Backbone.Model.extend({
        //@property {String} urlRoot
        urlRoot: 'services/CreditCard.Service.ss'    //@property validation. Backbone.Validation attribute used for validating the form before submit.
,
        validation: {
            ccname: {
                fn: function (cc_name) {
                    if (!cc_name || !jQuery.trim(cc_name)) {
                        return _('Name is required').translate();
                    } else if (cc_name.length > 26) {
                        return _('Name too long').translate();
                    }
                }
            },
            ccnumber: {
                fn: function (cc_number, attr, form) {
                    // credit card number validation
                    // It validates that the number pass the Luhn test and also that it has the right starting digits that identify the card issuer
                    if (!cc_number) {
                        return _('Card Number is required').translate();
                    }
                    if (_.isUndefined(form.internalid)) {
                        cc_number = cc_number.replace(/\s/g, '');
                        //check Luhn Algorithm
                        var card_number_is_valid = _(cc_number.split('').reverse()).reduce(function (a, n, index) {
                            return a + _((+n * [
                                1,
                                2
                            ][index % 2]).toString().split('')).reduce(function (b, o) {
                                return b + +o;
                            }, 0);
                        }, 0) % 10 === 0;
                        if (!card_number_is_valid) {
                            // we throw an error if the number fails the regex or the Luhn algorithm
                            return _('Credit Card Number is invalid').translate();
                        }
                    }
                }
            },
            paymentmethod: {
                fn: function (paymentmethod, attr, form) {
                    if (_.isUndefined(form.internalid) && paymentmethod === '0') {
                        return _('Please Select a Credit Card Type').translate();
                    }
                }
            },
            expyear: { fn: validateExpirationDate },
            expmonth: { fn: validateExpirationDate },
            ccsecuritycode: {
                fn: function (cc_security_code) {
                    if (SC.ENVIRONMENT.siteSettings.checkout.requireccsecuritycode === 'T' && (this.hasSecurityCode || this.get('hasSecurityCode'))) {
                        var errorMessage = _.validateSecurityCode(cc_security_code);
                        if (errorMessage) {
                            return errorMessage;
                        }
                    }
                }
            }
        }    //@method initialize
,
        initialize: function (attributes, options) {
            this.options = options;
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CreditCard
define('CreditCard.Collection', [
    'CreditCard.Model',
    'Backbone'
], function (Model, Backbone) {
    'use strict';
    // @class CreditCard.Collection Credit cards collection @extends Backbone.Collection
    return Backbone.Collection.extend({
        model: Model,
        url: 'services/CreditCard.Service.ss',
        comparator: function (model) {
            return model.get('ccdefault') !== 'T';    // ? 0 : 1;
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('Singleton', function () {
    'use strict';
    // Singleton:
    // Defines a simple getInstance method for:
    // models, collections, views or any other object to use to be used as singletons
    // How to use:
    // Backbone.[Collection, Model, View].extend({Your code}, Singleton);
    // or _.extend({Object literal}, Singleton);
    var Singleton = {
        getInstance: function () {
            var This = this;
            this.instance = this.instance || new This();
            return this.instance;
        }
    };
    SC.Singleton = Singleton;
    return Singleton;
});
/*! bignumber.js v4.0.4 https://github.com/MikeMcl/bignumber.js/LICENCE */
;
(function (globalObj) {
    'use strict';
    /*
      bignumber.js v4.0.4
      A JavaScript library for arbitrary-precision arithmetic.
      https://github.com/MikeMcl/bignumber.js
      Copyright (c) 2017 Michael Mclaughlin <M8ch88l@gmail.com>
      MIT Expat Licence
    */
    var BigNumber, isNumeric = /^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i, mathceil = Math.ceil, mathfloor = Math.floor, notBool = ' not a boolean or binary digit', roundingMode = 'rounding mode', tooManyDigits = 'number type has more than 15 significant digits', ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_', BASE = 100000000000000, LOG_BASE = 14, MAX_SAFE_INTEGER = 9007199254740991,
        // 2^53 - 1
        // MAX_INT32 = 0x7fffffff,                   // 2^31 - 1
        POWS_TEN = [
            1,
            10,
            100,
            1000,
            10000,
            100000,
            1000000,
            10000000,
            100000000,
            1000000000,
            10000000000,
            100000000000,
            1000000000000,
            10000000000000
        ], SQRT_BASE = 10000000,
        /*
         * The limit on the value of DECIMAL_PLACES, TO_EXP_NEG, TO_EXP_POS, MIN_EXP, MAX_EXP, and
         * the arguments to toExponential, toFixed, toFormat, and toPrecision, beyond which an
         * exception is thrown (if ERRORS is true).
         */
        MAX = 1000000000;
    // 0 to MAX_INT32
    /*
     * Create and return a BigNumber constructor.
     */
    function constructorFactory(config) {
        var div, parseNumeric,
            // id tracks the caller function, so its name can be included in error messages.
            id = 0, P = BigNumber.prototype, ONE = new BigNumber(1),
            /********************************* EDITABLE DEFAULTS **********************************/
            /*
             * The default values below must be integers within the inclusive ranges stated.
             * The values can also be changed at run-time using BigNumber.config.
             */
            // The maximum number of decimal places for operations involving division.
            DECIMAL_PLACES = 20,
            // 0 to MAX
            /*
             * The rounding mode used when rounding to the above decimal places, and when using
             * toExponential, toFixed, toFormat and toPrecision, and round (default value).
             * UP         0 Away from zero.
             * DOWN       1 Towards zero.
             * CEIL       2 Towards +Infinity.
             * FLOOR      3 Towards -Infinity.
             * HALF_UP    4 Towards nearest neighbour. If equidistant, up.
             * HALF_DOWN  5 Towards nearest neighbour. If equidistant, down.
             * HALF_EVEN  6 Towards nearest neighbour. If equidistant, towards even neighbour.
             * HALF_CEIL  7 Towards nearest neighbour. If equidistant, towards +Infinity.
             * HALF_FLOOR 8 Towards nearest neighbour. If equidistant, towards -Infinity.
             */
            ROUNDING_MODE = 4,
            // 0 to 8
            // EXPONENTIAL_AT : [TO_EXP_NEG , TO_EXP_POS]
            // The exponent value at and beneath which toString returns exponential notation.
            // Number type: -7
            TO_EXP_NEG = -7,
            // 0 to -MAX
            // The exponent value at and above which toString returns exponential notation.
            // Number type: 21
            TO_EXP_POS = 21,
            // 0 to MAX
            // RANGE : [MIN_EXP, MAX_EXP]
            // The minimum exponent value, beneath which underflow to zero occurs.
            // Number type: -324  (5e-324)
            MIN_EXP = -10000000,
            // -1 to -MAX
            // The maximum exponent value, above which overflow to Infinity occurs.
            // Number type:  308  (1.7976931348623157e+308)
            // For MAX_EXP > 1e7, e.g. new BigNumber('1e100000000').plus(1) may be slow.
            MAX_EXP = 10000000,
            // 1 to MAX
            // Whether BigNumber Errors are ever thrown.
            ERRORS = true,
            // true or false
            // Change to intValidatorNoErrors if ERRORS is false.
            isValidInt = intValidatorWithErrors,
            // intValidatorWithErrors/intValidatorNoErrors
            // Whether to use cryptographically-secure random number generation, if available.
            CRYPTO = false,
            // true or false
            /*
             * The modulo mode used when calculating the modulus: a mod n.
             * The quotient (q = a / n) is calculated according to the corresponding rounding mode.
             * The remainder (r) is calculated as: r = a - n * q.
             *
             * UP        0 The remainder is positive if the dividend is negative, else is negative.
             * DOWN      1 The remainder has the same sign as the dividend.
             *             This modulo mode is commonly known as 'truncated division' and is
             *             equivalent to (a % n) in JavaScript.
             * FLOOR     3 The remainder has the same sign as the divisor (Python %).
             * HALF_EVEN 6 This modulo mode implements the IEEE 754 remainder function.
             * EUCLID    9 Euclidian division. q = sign(n) * floor(a / abs(n)).
             *             The remainder is always positive.
             *
             * The truncated division, floored division, Euclidian division and IEEE 754 remainder
             * modes are commonly used for the modulus operation.
             * Although the other rounding modes can also be used, they may not give useful results.
             */
            MODULO_MODE = 1,
            // 0 to 9
            // The maximum number of significant digits of the result of the toPower operation.
            // If POW_PRECISION is 0, there will be unlimited significant digits.
            POW_PRECISION = 0,
            // 0 to MAX
            // The format specification used by the BigNumber.prototype.toFormat method.
            FORMAT = {
                decimalSeparator: '.',
                groupSeparator: ',',
                groupSize: 3,
                secondaryGroupSize: 0,
                fractionGroupSeparator: '\xA0',
                // non-breaking space
                fractionGroupSize: 0
            };
        /******************************************************************************************/
        // CONSTRUCTOR
        /*
         * The BigNumber constructor and exported function.
         * Create and return a new instance of a BigNumber object.
         *
         * n {number|string|BigNumber} A numeric value.
         * [b] {number} The base of n. Integer, 2 to 64 inclusive.
         */
        function BigNumber(n, b) {
            var c, e, i, num, len, str, x = this;
            // Enable constructor usage without new.
            if (!(x instanceof BigNumber)) {
                // 'BigNumber() constructor call without new: {n}'
                if (ERRORS)
                    raise(26, 'constructor call without new', n);
                return new BigNumber(n, b);
            }
            // 'new BigNumber() base not an integer: {b}'
            // 'new BigNumber() base out of range: {b}'
            if (b == null || !isValidInt(b, 2, 64, id, 'base')) {
                // Duplicate.
                if (n instanceof BigNumber) {
                    x.s = n.s;
                    x.e = n.e;
                    x.c = (n = n.c) ? n.slice() : n;
                    id = 0;
                    return;
                }
                if ((num = typeof n == 'number') && n * 0 == 0) {
                    x.s = 1 / n < 0 ? (n = -n, -1) : 1;
                    // Fast path for integers.
                    if (n === ~~n) {
                        for (e = 0, i = n; i >= 10; i /= 10, e++);
                        x.e = e;
                        x.c = [n];
                        id = 0;
                        return;
                    }
                    str = n + '';
                } else {
                    if (!isNumeric.test(str = n + ''))
                        return parseNumeric(x, str, num);
                    x.s = str.charCodeAt(0) === 45 ? (str = str.slice(1), -1) : 1;
                }
            } else {
                b = b | 0;
                str = n + '';
                // Ensure return value is rounded to DECIMAL_PLACES as with other bases.
                // Allow exponential notation to be used with base 10 argument.
                if (b == 10) {
                    x = new BigNumber(n instanceof BigNumber ? n : str);
                    return round(x, DECIMAL_PLACES + x.e + 1, ROUNDING_MODE);
                }
                // Avoid potential interpretation of Infinity and NaN as base 44+ values.
                // Any number in exponential form will fail due to the [Ee][+-].
                if ((num = typeof n == 'number') && n * 0 != 0 || !new RegExp('^-?' + (c = '[' + ALPHABET.slice(0, b) + ']+') + '(?:\\.' + c + ')?$', b < 37 ? 'i' : '').test(str)) {
                    return parseNumeric(x, str, num, b);
                }
                if (num) {
                    x.s = 1 / n < 0 ? (str = str.slice(1), -1) : 1;
                    if (ERRORS && str.replace(/^0\.0*|\./, '').length > 15) {
                        // 'new BigNumber() number type has more than 15 significant digits: {n}'
                        raise(id, tooManyDigits, n);
                    }
                    // Prevent later check for length on converted number.
                    num = false;
                } else {
                    x.s = str.charCodeAt(0) === 45 ? (str = str.slice(1), -1) : 1;
                }
                str = convertBase(str, 10, b, x.s);
            }
            // Decimal point?
            if ((e = str.indexOf('.')) > -1)
                str = str.replace('.', '');
            // Exponential form?
            if ((i = str.search(/e/i)) > 0) {
                // Determine exponent.
                if (e < 0)
                    e = i;
                e += +str.slice(i + 1);
                str = str.substring(0, i);
            } else if (e < 0) {
                // Integer.
                e = str.length;
            }
            // Determine leading zeros.
            for (i = 0; str.charCodeAt(i) === 48; i++);
            // Determine trailing zeros.
            for (len = str.length; str.charCodeAt(--len) === 48;);
            str = str.slice(i, len + 1);
            if (str) {
                len = str.length;
                // Disallow numbers with over 15 significant digits if number type.
                // 'new BigNumber() number type has more than 15 significant digits: {n}'
                if (num && ERRORS && len > 15 && (n > MAX_SAFE_INTEGER || n !== mathfloor(n))) {
                    raise(id, tooManyDigits, x.s * n);
                }
                e = e - i - 1;
                // Overflow?
                if (e > MAX_EXP) {
                    // Infinity.
                    x.c = x.e = null;    // Underflow?
                } else if (e < MIN_EXP) {
                    // Zero.
                    x.c = [x.e = 0];
                } else {
                    x.e = e;
                    x.c = [];
                    // Transform base
                    // e is the base 10 exponent.
                    // i is where to slice str to get the first element of the coefficient array.
                    i = (e + 1) % LOG_BASE;
                    if (e < 0)
                        i += LOG_BASE;
                    if (i < len) {
                        if (i)
                            x.c.push(+str.slice(0, i));
                        for (len -= LOG_BASE; i < len;) {
                            x.c.push(+str.slice(i, i += LOG_BASE));
                        }
                        str = str.slice(i);
                        i = LOG_BASE - str.length;
                    } else {
                        i -= len;
                    }
                    for (; i--; str += '0');
                    x.c.push(+str);
                }
            } else {
                // Zero.
                x.c = [x.e = 0];
            }
            id = 0;
        }
        // CONSTRUCTOR PROPERTIES
        BigNumber.another = constructorFactory;
        BigNumber.ROUND_UP = 0;
        BigNumber.ROUND_DOWN = 1;
        BigNumber.ROUND_CEIL = 2;
        BigNumber.ROUND_FLOOR = 3;
        BigNumber.ROUND_HALF_UP = 4;
        BigNumber.ROUND_HALF_DOWN = 5;
        BigNumber.ROUND_HALF_EVEN = 6;
        BigNumber.ROUND_HALF_CEIL = 7;
        BigNumber.ROUND_HALF_FLOOR = 8;
        BigNumber.EUCLID = 9;
        /*
         * Configure infrequently-changing library-wide settings.
         *
         * Accept an object or an argument list, with one or many of the following properties or
         * parameters respectively:
         *
         *   DECIMAL_PLACES  {number}  Integer, 0 to MAX inclusive
         *   ROUNDING_MODE   {number}  Integer, 0 to 8 inclusive
         *   EXPONENTIAL_AT  {number|number[]}  Integer, -MAX to MAX inclusive or
         *                                      [integer -MAX to 0 incl., 0 to MAX incl.]
         *   RANGE           {number|number[]}  Non-zero integer, -MAX to MAX inclusive or
         *                                      [integer -MAX to -1 incl., integer 1 to MAX incl.]
         *   ERRORS          {boolean|number}   true, false, 1 or 0
         *   CRYPTO          {boolean|number}   true, false, 1 or 0
         *   MODULO_MODE     {number}           0 to 9 inclusive
         *   POW_PRECISION   {number}           0 to MAX inclusive
         *   FORMAT          {object}           See BigNumber.prototype.toFormat
         *      decimalSeparator       {string}
         *      groupSeparator         {string}
         *      groupSize              {number}
         *      secondaryGroupSize     {number}
         *      fractionGroupSeparator {string}
         *      fractionGroupSize      {number}
         *
         * (The values assigned to the above FORMAT object properties are not checked for validity.)
         *
         * E.g.
         * BigNumber.config(20, 4) is equivalent to
         * BigNumber.config({ DECIMAL_PLACES : 20, ROUNDING_MODE : 4 })
         *
         * Ignore properties/parameters set to null or undefined.
         * Return an object with the properties current values.
         */
        BigNumber.config = BigNumber.set = function () {
            var v, p, i = 0, r = {}, a = arguments, o = a[0], has = o && typeof o == 'object' ? function () {
                    if (o.hasOwnProperty(p))
                        return (v = o[p]) != null;
                } : function () {
                    if (a.length > i)
                        return (v = a[i++]) != null;
                };
            // DECIMAL_PLACES {number} Integer, 0 to MAX inclusive.
            // 'config() DECIMAL_PLACES not an integer: {v}'
            // 'config() DECIMAL_PLACES out of range: {v}'
            if (has(p = 'DECIMAL_PLACES') && isValidInt(v, 0, MAX, 2, p)) {
                DECIMAL_PLACES = v | 0;
            }
            r[p] = DECIMAL_PLACES;
            // ROUNDING_MODE {number} Integer, 0 to 8 inclusive.
            // 'config() ROUNDING_MODE not an integer: {v}'
            // 'config() ROUNDING_MODE out of range: {v}'
            if (has(p = 'ROUNDING_MODE') && isValidInt(v, 0, 8, 2, p)) {
                ROUNDING_MODE = v | 0;
            }
            r[p] = ROUNDING_MODE;
            // EXPONENTIAL_AT {number|number[]}
            // Integer, -MAX to MAX inclusive or [integer -MAX to 0 inclusive, 0 to MAX inclusive].
            // 'config() EXPONENTIAL_AT not an integer: {v}'
            // 'config() EXPONENTIAL_AT out of range: {v}'
            if (has(p = 'EXPONENTIAL_AT')) {
                if (isArray(v)) {
                    if (isValidInt(v[0], -MAX, 0, 2, p) && isValidInt(v[1], 0, MAX, 2, p)) {
                        TO_EXP_NEG = v[0] | 0;
                        TO_EXP_POS = v[1] | 0;
                    }
                } else if (isValidInt(v, -MAX, MAX, 2, p)) {
                    TO_EXP_NEG = -(TO_EXP_POS = (v < 0 ? -v : v) | 0);
                }
            }
            r[p] = [
                TO_EXP_NEG,
                TO_EXP_POS
            ];
            // RANGE {number|number[]} Non-zero integer, -MAX to MAX inclusive or
            // [integer -MAX to -1 inclusive, integer 1 to MAX inclusive].
            // 'config() RANGE not an integer: {v}'
            // 'config() RANGE cannot be zero: {v}'
            // 'config() RANGE out of range: {v}'
            if (has(p = 'RANGE')) {
                if (isArray(v)) {
                    if (isValidInt(v[0], -MAX, -1, 2, p) && isValidInt(v[1], 1, MAX, 2, p)) {
                        MIN_EXP = v[0] | 0;
                        MAX_EXP = v[1] | 0;
                    }
                } else if (isValidInt(v, -MAX, MAX, 2, p)) {
                    if (v | 0)
                        MIN_EXP = -(MAX_EXP = (v < 0 ? -v : v) | 0);
                    else if (ERRORS)
                        raise(2, p + ' cannot be zero', v);
                }
            }
            r[p] = [
                MIN_EXP,
                MAX_EXP
            ];
            // ERRORS {boolean|number} true, false, 1 or 0.
            // 'config() ERRORS not a boolean or binary digit: {v}'
            if (has(p = 'ERRORS')) {
                if (v === !!v || v === 1 || v === 0) {
                    id = 0;
                    isValidInt = (ERRORS = !!v) ? intValidatorWithErrors : intValidatorNoErrors;
                } else if (ERRORS) {
                    raise(2, p + notBool, v);
                }
            }
            r[p] = ERRORS;
            // CRYPTO {boolean|number} true, false, 1 or 0.
            // 'config() CRYPTO not a boolean or binary digit: {v}'
            // 'config() crypto unavailable: {crypto}'
            if (has(p = 'CRYPTO')) {
                if (v === true || v === false || v === 1 || v === 0) {
                    if (v) {
                        v = typeof crypto == 'undefined';
                        if (!v && crypto && (crypto.getRandomValues || crypto.randomBytes)) {
                            CRYPTO = true;
                        } else if (ERRORS) {
                            raise(2, 'crypto unavailable', v ? void 0 : crypto);
                        } else {
                            CRYPTO = false;
                        }
                    } else {
                        CRYPTO = false;
                    }
                } else if (ERRORS) {
                    raise(2, p + notBool, v);
                }
            }
            r[p] = CRYPTO;
            // MODULO_MODE {number} Integer, 0 to 9 inclusive.
            // 'config() MODULO_MODE not an integer: {v}'
            // 'config() MODULO_MODE out of range: {v}'
            if (has(p = 'MODULO_MODE') && isValidInt(v, 0, 9, 2, p)) {
                MODULO_MODE = v | 0;
            }
            r[p] = MODULO_MODE;
            // POW_PRECISION {number} Integer, 0 to MAX inclusive.
            // 'config() POW_PRECISION not an integer: {v}'
            // 'config() POW_PRECISION out of range: {v}'
            if (has(p = 'POW_PRECISION') && isValidInt(v, 0, MAX, 2, p)) {
                POW_PRECISION = v | 0;
            }
            r[p] = POW_PRECISION;
            // FORMAT {object}
            // 'config() FORMAT not an object: {v}'
            if (has(p = 'FORMAT')) {
                if (typeof v == 'object') {
                    FORMAT = v;
                } else if (ERRORS) {
                    raise(2, p + ' not an object', v);
                }
            }
            r[p] = FORMAT;
            return r;
        };
        /*
         * Return a new BigNumber whose value is the maximum of the arguments.
         *
         * arguments {number|string|BigNumber}
         */
        BigNumber.max = function () {
            return maxOrMin(arguments, P.lt);
        };
        /*
         * Return a new BigNumber whose value is the minimum of the arguments.
         *
         * arguments {number|string|BigNumber}
         */
        BigNumber.min = function () {
            return maxOrMin(arguments, P.gt);
        };
        /*
         * Return a new BigNumber with a random value equal to or greater than 0 and less than 1,
         * and with dp, or DECIMAL_PLACES if dp is omitted, decimal places (or less if trailing
         * zeros are produced).
         *
         * [dp] {number} Decimal places. Integer, 0 to MAX inclusive.
         *
         * 'random() decimal places not an integer: {dp}'
         * 'random() decimal places out of range: {dp}'
         * 'random() crypto unavailable: {crypto}'
         */
        BigNumber.random = function () {
            var pow2_53 = 9007199254740992;
            // Return a 53 bit integer n, where 0 <= n < 9007199254740992.
            // Check if Math.random() produces more than 32 bits of randomness.
            // If it does, assume at least 53 bits are produced, otherwise assume at least 30 bits.
            // 0x40000000 is 2^30, 0x800000 is 2^23, 0x1fffff is 2^21 - 1.
            var random53bitInt = Math.random() * pow2_53 & 2097151 ? function () {
                return mathfloor(Math.random() * pow2_53);
            } : function () {
                return (Math.random() * 1073741824 | 0) * 8388608 + (Math.random() * 8388608 | 0);
            };
            return function (dp) {
                var a, b, e, k, v, i = 0, c = [], rand = new BigNumber(ONE);
                dp = dp == null || !isValidInt(dp, 0, MAX, 14) ? DECIMAL_PLACES : dp | 0;
                k = mathceil(dp / LOG_BASE);
                if (CRYPTO) {
                    // Browsers supporting crypto.getRandomValues.
                    if (crypto.getRandomValues) {
                        a = crypto.getRandomValues(new Uint32Array(k *= 2));
                        for (; i < k;) {
                            // 53 bits:
                            // ((Math.pow(2, 32) - 1) * Math.pow(2, 21)).toString(2)
                            // 11111 11111111 11111111 11111111 11100000 00000000 00000000
                            // ((Math.pow(2, 32) - 1) >>> 11).toString(2)
                            //                                     11111 11111111 11111111
                            // 0x20000 is 2^21.
                            v = a[i] * 131072 + (a[i + 1] >>> 11);
                            // Rejection sampling:
                            // 0 <= v < 9007199254740992
                            // Probability that v >= 9e15, is
                            // 7199254740992 / 9007199254740992 ~= 0.0008, i.e. 1 in 1251
                            if (v >= 9000000000000000) {
                                b = crypto.getRandomValues(new Uint32Array(2));
                                a[i] = b[0];
                                a[i + 1] = b[1];
                            } else {
                                // 0 <= v <= 8999999999999999
                                // 0 <= (v % 1e14) <= 99999999999999
                                c.push(v % 100000000000000);
                                i += 2;
                            }
                        }
                        i = k / 2;    // Node.js supporting crypto.randomBytes.
                    } else if (crypto.randomBytes) {
                        // buffer
                        a = crypto.randomBytes(k *= 7);
                        for (; i < k;) {
                            // 0x1000000000000 is 2^48, 0x10000000000 is 2^40
                            // 0x100000000 is 2^32, 0x1000000 is 2^24
                            // 11111 11111111 11111111 11111111 11111111 11111111 11111111
                            // 0 <= v < 9007199254740992
                            v = (a[i] & 31) * 281474976710656 + a[i + 1] * 1099511627776 + a[i + 2] * 4294967296 + a[i + 3] * 16777216 + (a[i + 4] << 16) + (a[i + 5] << 8) + a[i + 6];
                            if (v >= 9000000000000000) {
                                crypto.randomBytes(7).copy(a, i);
                            } else {
                                // 0 <= (v % 1e14) <= 99999999999999
                                c.push(v % 100000000000000);
                                i += 7;
                            }
                        }
                        i = k / 7;
                    } else {
                        CRYPTO = false;
                        if (ERRORS)
                            raise(14, 'crypto unavailable', crypto);
                    }
                }
                // Use Math.random.
                if (!CRYPTO) {
                    for (; i < k;) {
                        v = random53bitInt();
                        if (v < 9000000000000000)
                            c[i++] = v % 100000000000000;
                    }
                }
                k = c[--i];
                dp %= LOG_BASE;
                // Convert trailing digits to zeros according to dp.
                if (k && dp) {
                    v = POWS_TEN[LOG_BASE - dp];
                    c[i] = mathfloor(k / v) * v;
                }
                // Remove trailing elements which are zero.
                for (; c[i] === 0; c.pop(), i--);
                // Zero?
                if (i < 0) {
                    c = [e = 0];
                } else {
                    // Remove leading elements which are zero and adjust exponent accordingly.
                    for (e = -1; c[0] === 0; c.splice(0, 1), e -= LOG_BASE);
                    // Count the digits of the first element of c to determine leading zeros, and...
                    for (i = 1, v = c[0]; v >= 10; v /= 10, i++);
                    // adjust the exponent accordingly.
                    if (i < LOG_BASE)
                        e -= LOG_BASE - i;
                }
                rand.e = e;
                rand.c = c;
                return rand;
            };
        }();
        // PRIVATE FUNCTIONS
        // Convert a numeric string of baseIn to a numeric string of baseOut.
        function convertBase(str, baseOut, baseIn, sign) {
            var d, e, k, r, x, xc, y, i = str.indexOf('.'), dp = DECIMAL_PLACES, rm = ROUNDING_MODE;
            if (baseIn < 37)
                str = str.toLowerCase();
            // Non-integer.
            if (i >= 0) {
                k = POW_PRECISION;
                // Unlimited precision.
                POW_PRECISION = 0;
                str = str.replace('.', '');
                y = new BigNumber(baseIn);
                x = y.pow(str.length - i);
                POW_PRECISION = k;
                // Convert str as if an integer, then restore the fraction part by dividing the
                // result by its base raised to a power.
                y.c = toBaseOut(toFixedPoint(coeffToString(x.c), x.e), 10, baseOut);
                y.e = y.c.length;
            }
            // Convert the number as integer.
            xc = toBaseOut(str, baseIn, baseOut);
            e = k = xc.length;
            // Remove trailing zeros.
            for (; xc[--k] == 0; xc.pop());
            if (!xc[0])
                return '0';
            if (i < 0) {
                --e;
            } else {
                x.c = xc;
                x.e = e;
                // sign is needed for correct rounding.
                x.s = sign;
                x = div(x, y, dp, rm, baseOut);
                xc = x.c;
                r = x.r;
                e = x.e;
            }
            d = e + dp + 1;
            // The rounding digit, i.e. the digit to the right of the digit that may be rounded up.
            i = xc[d];
            k = baseOut / 2;
            r = r || d < 0 || xc[d + 1] != null;
            r = rm < 4 ? (i != null || r) && (rm == 0 || rm == (x.s < 0 ? 3 : 2)) : i > k || i == k && (rm == 4 || r || rm == 6 && xc[d - 1] & 1 || rm == (x.s < 0 ? 8 : 7));
            if (d < 1 || !xc[0]) {
                // 1^-dp or 0.
                str = r ? toFixedPoint('1', -dp) : '0';
            } else {
                xc.length = d;
                if (r) {
                    // Rounding up may mean the previous digit has to be rounded up and so on.
                    for (--baseOut; ++xc[--d] > baseOut;) {
                        xc[d] = 0;
                        if (!d) {
                            ++e;
                            xc = [1].concat(xc);
                        }
                    }
                }
                // Determine trailing zeros.
                for (k = xc.length; !xc[--k];);
                // E.g. [4, 11, 15] becomes 4bf.
                for (i = 0, str = ''; i <= k; str += ALPHABET.charAt(xc[i++]));
                str = toFixedPoint(str, e);
            }
            // The caller will add the sign.
            return str;
        }
        // Perform division in the specified base. Called by div and convertBase.
        div = function () {
            // Assume non-zero x and k.
            function multiply(x, k, base) {
                var m, temp, xlo, xhi, carry = 0, i = x.length, klo = k % SQRT_BASE, khi = k / SQRT_BASE | 0;
                for (x = x.slice(); i--;) {
                    xlo = x[i] % SQRT_BASE;
                    xhi = x[i] / SQRT_BASE | 0;
                    m = khi * xlo + xhi * klo;
                    temp = klo * xlo + m % SQRT_BASE * SQRT_BASE + carry;
                    carry = (temp / base | 0) + (m / SQRT_BASE | 0) + khi * xhi;
                    x[i] = temp % base;
                }
                if (carry)
                    x = [carry].concat(x);
                return x;
            }
            function compare(a, b, aL, bL) {
                var i, cmp;
                if (aL != bL) {
                    cmp = aL > bL ? 1 : -1;
                } else {
                    for (i = cmp = 0; i < aL; i++) {
                        if (a[i] != b[i]) {
                            cmp = a[i] > b[i] ? 1 : -1;
                            break;
                        }
                    }
                }
                return cmp;
            }
            function subtract(a, b, aL, base) {
                var i = 0;
                // Subtract b from a.
                for (; aL--;) {
                    a[aL] -= i;
                    i = a[aL] < b[aL] ? 1 : 0;
                    a[aL] = i * base + a[aL] - b[aL];
                }
                // Remove leading zeros.
                for (; !a[0] && a.length > 1; a.splice(0, 1));
            }
            // x: dividend, y: divisor.
            return function (x, y, dp, rm, base) {
                var cmp, e, i, more, n, prod, prodL, q, qc, rem, remL, rem0, xi, xL, yc0, yL, yz, s = x.s == y.s ? 1 : -1, xc = x.c, yc = y.c;
                // Either NaN, Infinity or 0?
                if (!xc || !xc[0] || !yc || !yc[0]) {
                    return new BigNumber(// Return NaN if either NaN, or both Infinity or 0.
                    !x.s || !y.s || (xc ? yc && xc[0] == yc[0] : !yc) ? NaN : // Return ±0 if x is ±0 or y is ±Infinity, or return ±Infinity as y is ±0.
                    xc && xc[0] == 0 || !yc ? s * 0 : s / 0);
                }
                q = new BigNumber(s);
                qc = q.c = [];
                e = x.e - y.e;
                s = dp + e + 1;
                if (!base) {
                    base = BASE;
                    e = bitFloor(x.e / LOG_BASE) - bitFloor(y.e / LOG_BASE);
                    s = s / LOG_BASE | 0;
                }
                // Result exponent may be one less then the current value of e.
                // The coefficients of the BigNumbers from convertBase may have trailing zeros.
                for (i = 0; yc[i] == (xc[i] || 0); i++);
                if (yc[i] > (xc[i] || 0))
                    e--;
                if (s < 0) {
                    qc.push(1);
                    more = true;
                } else {
                    xL = xc.length;
                    yL = yc.length;
                    i = 0;
                    s += 2;
                    // Normalise xc and yc so highest order digit of yc is >= base / 2.
                    n = mathfloor(base / (yc[0] + 1));
                    // Not necessary, but to handle odd bases where yc[0] == ( base / 2 ) - 1.
                    // if ( n > 1 || n++ == 1 && yc[0] < base / 2 ) {
                    if (n > 1) {
                        yc = multiply(yc, n, base);
                        xc = multiply(xc, n, base);
                        yL = yc.length;
                        xL = xc.length;
                    }
                    xi = yL;
                    rem = xc.slice(0, yL);
                    remL = rem.length;
                    // Add zeros to make remainder as long as divisor.
                    for (; remL < yL; rem[remL++] = 0);
                    yz = yc.slice();
                    yz = [0].concat(yz);
                    yc0 = yc[0];
                    if (yc[1] >= base / 2)
                        yc0++;
                    // Not necessary, but to prevent trial digit n > base, when using base 3.
                    // else if ( base == 3 && yc0 == 1 ) yc0 = 1 + 1e-15;
                    do {
                        n = 0;
                        // Compare divisor and remainder.
                        cmp = compare(yc, rem, yL, remL);
                        // If divisor < remainder.
                        if (cmp < 0) {
                            // Calculate trial digit, n.
                            rem0 = rem[0];
                            if (yL != remL)
                                rem0 = rem0 * base + (rem[1] || 0);
                            // n is how many times the divisor goes into the current remainder.
                            n = mathfloor(rem0 / yc0);
                            //  Algorithm:
                            //  1. product = divisor * trial digit (n)
                            //  2. if product > remainder: product -= divisor, n--
                            //  3. remainder -= product
                            //  4. if product was < remainder at 2:
                            //    5. compare new remainder and divisor
                            //    6. If remainder > divisor: remainder -= divisor, n++
                            if (n > 1) {
                                // n may be > base only when base is 3.
                                if (n >= base)
                                    n = base - 1;
                                // product = divisor * trial digit.
                                prod = multiply(yc, n, base);
                                prodL = prod.length;
                                remL = rem.length;
                                // Compare product and remainder.
                                // If product > remainder.
                                // Trial digit n too high.
                                // n is 1 too high about 5% of the time, and is not known to have
                                // ever been more than 1 too high.
                                while (compare(prod, rem, prodL, remL) == 1) {
                                    n--;
                                    // Subtract divisor from product.
                                    subtract(prod, yL < prodL ? yz : yc, prodL, base);
                                    prodL = prod.length;
                                    cmp = 1;
                                }
                            } else {
                                // n is 0 or 1, cmp is -1.
                                // If n is 0, there is no need to compare yc and rem again below,
                                // so change cmp to 1 to avoid it.
                                // If n is 1, leave cmp as -1, so yc and rem are compared again.
                                if (n == 0) {
                                    // divisor < remainder, so n must be at least 1.
                                    cmp = n = 1;
                                }
                                // product = divisor
                                prod = yc.slice();
                                prodL = prod.length;
                            }
                            if (prodL < remL)
                                prod = [0].concat(prod);
                            // Subtract product from remainder.
                            subtract(rem, prod, remL, base);
                            remL = rem.length;
                            // If product was < remainder.
                            if (cmp == -1) {
                                // Compare divisor and new remainder.
                                // If divisor < new remainder, subtract divisor from remainder.
                                // Trial digit n too low.
                                // n is 1 too low about 5% of the time, and very rarely 2 too low.
                                while (compare(yc, rem, yL, remL) < 1) {
                                    n++;
                                    // Subtract divisor from remainder.
                                    subtract(rem, yL < remL ? yz : yc, remL, base);
                                    remL = rem.length;
                                }
                            }
                        } else if (cmp === 0) {
                            n++;
                            rem = [0];
                        }
                        // else cmp === 1 and n will be 0
                        // Add the next digit, n, to the result array.
                        qc[i++] = n;
                        // Update the remainder.
                        if (rem[0]) {
                            rem[remL++] = xc[xi] || 0;
                        } else {
                            rem = [xc[xi]];
                            remL = 1;
                        }
                    } while ((xi++ < xL || rem[0] != null) && s--);
                    more = rem[0] != null;
                    // Leading zero?
                    if (!qc[0])
                        qc.splice(0, 1);
                }
                if (base == BASE) {
                    // To calculate q.e, first get the number of digits of qc[0].
                    for (i = 1, s = qc[0]; s >= 10; s /= 10, i++);
                    round(q, dp + (q.e = i + e * LOG_BASE - 1) + 1, rm, more);    // Caller is convertBase.
                } else {
                    q.e = e;
                    q.r = +more;
                }
                return q;
            };
        }();
        /*
         * Return a string representing the value of BigNumber n in fixed-point or exponential
         * notation rounded to the specified decimal places or significant digits.
         *
         * n is a BigNumber.
         * i is the index of the last digit required (i.e. the digit that may be rounded up).
         * rm is the rounding mode.
         * caller is caller id: toExponential 19, toFixed 20, toFormat 21, toPrecision 24.
         */
        function format(n, i, rm, caller) {
            var c0, e, ne, len, str;
            rm = rm != null && isValidInt(rm, 0, 8, caller, roundingMode) ? rm | 0 : ROUNDING_MODE;
            if (!n.c)
                return n.toString();
            c0 = n.c[0];
            ne = n.e;
            if (i == null) {
                str = coeffToString(n.c);
                str = caller == 19 || caller == 24 && ne <= TO_EXP_NEG ? toExponential(str, ne) : toFixedPoint(str, ne);
            } else {
                n = round(new BigNumber(n), i, rm);
                // n.e may have changed if the value was rounded up.
                e = n.e;
                str = coeffToString(n.c);
                len = str.length;
                // toPrecision returns exponential notation if the number of significant digits
                // specified is less than the number of digits necessary to represent the integer
                // part of the value in fixed-point notation.
                // Exponential notation.
                if (caller == 19 || caller == 24 && (i <= e || e <= TO_EXP_NEG)) {
                    // Append zeros?
                    for (; len < i; str += '0', len++);
                    str = toExponential(str, e);    // Fixed-point notation.
                } else {
                    i -= ne;
                    str = toFixedPoint(str, e);
                    // Append zeros?
                    if (e + 1 > len) {
                        if (--i > 0)
                            for (str += '.'; i--; str += '0');
                    } else {
                        i += e - len;
                        if (i > 0) {
                            if (e + 1 == len)
                                str += '.';
                            for (; i--; str += '0');
                        }
                    }
                }
            }
            return n.s < 0 && c0 ? '-' + str : str;
        }
        // Handle BigNumber.max and BigNumber.min.
        function maxOrMin(args, method) {
            var m, n, i = 0;
            if (isArray(args[0]))
                args = args[0];
            m = new BigNumber(args[0]);
            for (; ++i < args.length;) {
                n = new BigNumber(args[i]);
                // If any number is NaN, return NaN.
                if (!n.s) {
                    m = n;
                    break;
                } else if (method.call(m, n)) {
                    m = n;
                }
            }
            return m;
        }
        /*
         * Return true if n is an integer in range, otherwise throw.
         * Use for argument validation when ERRORS is true.
         */
        function intValidatorWithErrors(n, min, max, caller, name) {
            if (n < min || n > max || n != truncate(n)) {
                raise(caller, (name || 'decimal places') + (n < min || n > max ? ' out of range' : ' not an integer'), n);
            }
            return true;
        }
        /*
         * Strip trailing zeros, calculate base 10 exponent and check against MIN_EXP and MAX_EXP.
         * Called by minus, plus and times.
         */
        function normalise(n, c, e) {
            var i = 1, j = c.length;
            // Remove trailing zeros.
            for (; !c[--j]; c.pop());
            // Calculate the base 10 exponent. First get the number of digits of c[0].
            for (j = c[0]; j >= 10; j /= 10, i++);
            // Overflow?
            if ((e = i + e * LOG_BASE - 1) > MAX_EXP) {
                // Infinity.
                n.c = n.e = null;    // Underflow?
            } else if (e < MIN_EXP) {
                // Zero.
                n.c = [n.e = 0];
            } else {
                n.e = e;
                n.c = c;
            }
            return n;
        }
        // Handle values that fail the validity test in BigNumber.
        parseNumeric = function () {
            var basePrefix = /^(-?)0([xbo])(?=\w[\w.]*$)/i, dotAfter = /^([^.]+)\.$/, dotBefore = /^\.([^.]+)$/, isInfinityOrNaN = /^-?(Infinity|NaN)$/, whitespaceOrPlus = /^\s*\+(?=[\w.])|^\s+|\s+$/g;
            return function (x, str, num, b) {
                var base, s = num ? str : str.replace(whitespaceOrPlus, '');
                // No exception on ±Infinity or NaN.
                if (isInfinityOrNaN.test(s)) {
                    x.s = isNaN(s) ? null : s < 0 ? -1 : 1;
                } else {
                    if (!num) {
                        // basePrefix = /^(-?)0([xbo])(?=\w[\w.]*$)/i
                        s = s.replace(basePrefix, function (m, p1, p2) {
                            base = (p2 = p2.toLowerCase()) == 'x' ? 16 : p2 == 'b' ? 2 : 8;
                            return !b || b == base ? p1 : m;
                        });
                        if (b) {
                            base = b;
                            // E.g. '1.' to '1', '.1' to '0.1'
                            s = s.replace(dotAfter, '$1').replace(dotBefore, '0.$1');
                        }
                        if (str != s)
                            return new BigNumber(s, base);
                    }
                    // 'new BigNumber() not a number: {n}'
                    // 'new BigNumber() not a base {b} number: {n}'
                    if (ERRORS)
                        raise(id, 'not a' + (b ? ' base ' + b : '') + ' number', str);
                    x.s = null;
                }
                x.c = x.e = null;
                id = 0;
            };
        }();
        // Throw a BigNumber Error.
        function raise(caller, msg, val) {
            var error = new Error([
                'new BigNumber',
                // 0
                'cmp',
                // 1
                'config',
                // 2
                'div',
                // 3
                'divToInt',
                // 4
                'eq',
                // 5
                'gt',
                // 6
                'gte',
                // 7
                'lt',
                // 8
                'lte',
                // 9
                'minus',
                // 10
                'mod',
                // 11
                'plus',
                // 12
                'precision',
                // 13
                'random',
                // 14
                'round',
                // 15
                'shift',
                // 16
                'times',
                // 17
                'toDigits',
                // 18
                'toExponential',
                // 19
                'toFixed',
                // 20
                'toFormat',
                // 21
                'toFraction',
                // 22
                'pow',
                // 23
                'toPrecision',
                // 24
                'toString',
                // 25
                'BigNumber'    // 26
            ][caller] + '() ' + msg + ': ' + val);
            error.name = 'BigNumber Error';
            id = 0;
            throw error;
        }
        /*
         * Round x to sd significant digits using rounding mode rm. Check for over/under-flow.
         * If r is truthy, it is known that there are more digits after the rounding digit.
         */
        function round(x, sd, rm, r) {
            var d, i, j, k, n, ni, rd, xc = x.c, pows10 = POWS_TEN;
            // if x is not Infinity or NaN...
            if (xc) {
                // rd is the rounding digit, i.e. the digit after the digit that may be rounded up.
                // n is a base 1e14 number, the value of the element of array x.c containing rd.
                // ni is the index of n within x.c.
                // d is the number of digits of n.
                // i is the index of rd within n including leading zeros.
                // j is the actual index of rd within n (if < 0, rd is a leading zero).
                out: {
                    // Get the number of digits of the first element of xc.
                    for (d = 1, k = xc[0]; k >= 10; k /= 10, d++);
                    i = sd - d;
                    // If the rounding digit is in the first element of xc...
                    if (i < 0) {
                        i += LOG_BASE;
                        j = sd;
                        n = xc[ni = 0];
                        // Get the rounding digit at index j of n.
                        rd = n / pows10[d - j - 1] % 10 | 0;
                    } else {
                        ni = mathceil((i + 1) / LOG_BASE);
                        if (ni >= xc.length) {
                            if (r) {
                                // Needed by sqrt.
                                for (; xc.length <= ni; xc.push(0));
                                n = rd = 0;
                                d = 1;
                                i %= LOG_BASE;
                                j = i - LOG_BASE + 1;
                            } else {
                                break out;
                            }
                        } else {
                            n = k = xc[ni];
                            // Get the number of digits of n.
                            for (d = 1; k >= 10; k /= 10, d++);
                            // Get the index of rd within n.
                            i %= LOG_BASE;
                            // Get the index of rd within n, adjusted for leading zeros.
                            // The number of leading zeros of n is given by LOG_BASE - d.
                            j = i - LOG_BASE + d;
                            // Get the rounding digit at index j of n.
                            rd = j < 0 ? 0 : n / pows10[d - j - 1] % 10 | 0;
                        }
                    }
                    r = r || sd < 0 || // Are there any non-zero digits after the rounding digit?
                    // The expression  n % pows10[ d - j - 1 ]  returns all digits of n to the right
                    // of the digit at j, e.g. if n is 908714 and j is 2, the expression gives 714.
                    xc[ni + 1] != null || (j < 0 ? n : n % pows10[d - j - 1]);
                    r = rm < 4 ? (rd || r) && (rm == 0 || rm == (x.s < 0 ? 3 : 2)) : rd > 5 || rd == 5 && (rm == 4 || r || rm == 6 && // Check whether the digit to the left of the rounding digit is odd.
                    (i > 0 ? j > 0 ? n / pows10[d - j] : 0 : xc[ni - 1]) % 10 & 1 || rm == (x.s < 0 ? 8 : 7));
                    if (sd < 1 || !xc[0]) {
                        xc.length = 0;
                        if (r) {
                            // Convert sd to decimal places.
                            sd -= x.e + 1;
                            // 1, 0.1, 0.01, 0.001, 0.0001 etc.
                            xc[0] = pows10[(LOG_BASE - sd % LOG_BASE) % LOG_BASE];
                            x.e = -sd || 0;
                        } else {
                            // Zero.
                            xc[0] = x.e = 0;
                        }
                        return x;
                    }
                    // Remove excess digits.
                    if (i == 0) {
                        xc.length = ni;
                        k = 1;
                        ni--;
                    } else {
                        xc.length = ni + 1;
                        k = pows10[LOG_BASE - i];
                        // E.g. 56700 becomes 56000 if 7 is the rounding digit.
                        // j > 0 means i > number of leading zeros of n.
                        xc[ni] = j > 0 ? mathfloor(n / pows10[d - j] % pows10[j]) * k : 0;
                    }
                    // Round up?
                    if (r) {
                        for (;;) {
                            // If the digit to be rounded up is in the first element of xc...
                            if (ni == 0) {
                                // i will be the length of xc[0] before k is added.
                                for (i = 1, j = xc[0]; j >= 10; j /= 10, i++);
                                j = xc[0] += k;
                                for (k = 1; j >= 10; j /= 10, k++);
                                // if i != k the length has increased.
                                if (i != k) {
                                    x.e++;
                                    if (xc[0] == BASE)
                                        xc[0] = 1;
                                }
                                break;
                            } else {
                                xc[ni] += k;
                                if (xc[ni] != BASE)
                                    break;
                                xc[ni--] = 0;
                                k = 1;
                            }
                        }
                    }
                    // Remove trailing zeros.
                    for (i = xc.length; xc[--i] === 0; xc.pop());
                }
                // Overflow? Infinity.
                if (x.e > MAX_EXP) {
                    x.c = x.e = null;    // Underflow? Zero.
                } else if (x.e < MIN_EXP) {
                    x.c = [x.e = 0];
                }
            }
            return x;
        }
        // PROTOTYPE/INSTANCE METHODS
        /*
         * Return a new BigNumber whose value is the absolute value of this BigNumber.
         */
        P.absoluteValue = P.abs = function () {
            var x = new BigNumber(this);
            if (x.s < 0)
                x.s = 1;
            return x;
        };
        /*
         * Return a new BigNumber whose value is the value of this BigNumber rounded to a whole
         * number in the direction of Infinity.
         */
        P.ceil = function () {
            return round(new BigNumber(this), this.e + 1, 2);
        };
        /*
         * Return
         * 1 if the value of this BigNumber is greater than the value of BigNumber(y, b),
         * -1 if the value of this BigNumber is less than the value of BigNumber(y, b),
         * 0 if they have the same value,
         * or null if the value of either is NaN.
         */
        P.comparedTo = P.cmp = function (y, b) {
            id = 1;
            return compare(this, new BigNumber(y, b));
        };
        /*
         * Return the number of decimal places of the value of this BigNumber, or null if the value
         * of this BigNumber is ±Infinity or NaN.
         */
        P.decimalPlaces = P.dp = function () {
            var n, v, c = this.c;
            if (!c)
                return null;
            n = ((v = c.length - 1) - bitFloor(this.e / LOG_BASE)) * LOG_BASE;
            // Subtract the number of trailing zeros of the last number.
            if (v = c[v])
                for (; v % 10 == 0; v /= 10, n--);
            if (n < 0)
                n = 0;
            return n;
        };
        /*
         *  n / 0 = I
         *  n / N = N
         *  n / I = 0
         *  0 / n = 0
         *  0 / 0 = N
         *  0 / N = N
         *  0 / I = 0
         *  N / n = N
         *  N / 0 = N
         *  N / N = N
         *  N / I = N
         *  I / n = I
         *  I / 0 = I
         *  I / N = N
         *  I / I = N
         *
         * Return a new BigNumber whose value is the value of this BigNumber divided by the value of
         * BigNumber(y, b), rounded according to DECIMAL_PLACES and ROUNDING_MODE.
         */
        P.dividedBy = P.div = function (y, b) {
            id = 3;
            return div(this, new BigNumber(y, b), DECIMAL_PLACES, ROUNDING_MODE);
        };
        /*
         * Return a new BigNumber whose value is the integer part of dividing the value of this
         * BigNumber by the value of BigNumber(y, b).
         */
        P.dividedToIntegerBy = P.divToInt = function (y, b) {
            id = 4;
            return div(this, new BigNumber(y, b), 0, 1);
        };
        /*
         * Return true if the value of this BigNumber is equal to the value of BigNumber(y, b),
         * otherwise returns false.
         */
        P.equals = P.eq = function (y, b) {
            id = 5;
            return compare(this, new BigNumber(y, b)) === 0;
        };
        /*
         * Return a new BigNumber whose value is the value of this BigNumber rounded to a whole
         * number in the direction of -Infinity.
         */
        P.floor = function () {
            return round(new BigNumber(this), this.e + 1, 3);
        };
        /*
         * Return true if the value of this BigNumber is greater than the value of BigNumber(y, b),
         * otherwise returns false.
         */
        P.greaterThan = P.gt = function (y, b) {
            id = 6;
            return compare(this, new BigNumber(y, b)) > 0;
        };
        /*
         * Return true if the value of this BigNumber is greater than or equal to the value of
         * BigNumber(y, b), otherwise returns false.
         */
        P.greaterThanOrEqualTo = P.gte = function (y, b) {
            id = 7;
            return (b = compare(this, new BigNumber(y, b))) === 1 || b === 0;
        };
        /*
         * Return true if the value of this BigNumber is a finite number, otherwise returns false.
         */
        P.isFinite = function () {
            return !!this.c;
        };
        /*
         * Return true if the value of this BigNumber is an integer, otherwise return false.
         */
        P.isInteger = P.isInt = function () {
            return !!this.c && bitFloor(this.e / LOG_BASE) > this.c.length - 2;
        };
        /*
         * Return true if the value of this BigNumber is NaN, otherwise returns false.
         */
        P.isNaN = function () {
            return !this.s;
        };
        /*
         * Return true if the value of this BigNumber is negative, otherwise returns false.
         */
        P.isNegative = P.isNeg = function () {
            return this.s < 0;
        };
        /*
         * Return true if the value of this BigNumber is 0 or -0, otherwise returns false.
         */
        P.isZero = function () {
            return !!this.c && this.c[0] == 0;
        };
        /*
         * Return true if the value of this BigNumber is less than the value of BigNumber(y, b),
         * otherwise returns false.
         */
        P.lessThan = P.lt = function (y, b) {
            id = 8;
            return compare(this, new BigNumber(y, b)) < 0;
        };
        /*
         * Return true if the value of this BigNumber is less than or equal to the value of
         * BigNumber(y, b), otherwise returns false.
         */
        P.lessThanOrEqualTo = P.lte = function (y, b) {
            id = 9;
            return (b = compare(this, new BigNumber(y, b))) === -1 || b === 0;
        };
        /*
         *  n - 0 = n
         *  n - N = N
         *  n - I = -I
         *  0 - n = -n
         *  0 - 0 = 0
         *  0 - N = N
         *  0 - I = -I
         *  N - n = N
         *  N - 0 = N
         *  N - N = N
         *  N - I = N
         *  I - n = I
         *  I - 0 = I
         *  I - N = N
         *  I - I = N
         *
         * Return a new BigNumber whose value is the value of this BigNumber minus the value of
         * BigNumber(y, b).
         */
        P.minus = P.sub = function (y, b) {
            var i, j, t, xLTy, x = this, a = x.s;
            id = 10;
            y = new BigNumber(y, b);
            b = y.s;
            // Either NaN?
            if (!a || !b)
                return new BigNumber(NaN);
            // Signs differ?
            if (a != b) {
                y.s = -b;
                return x.plus(y);
            }
            var xe = x.e / LOG_BASE, ye = y.e / LOG_BASE, xc = x.c, yc = y.c;
            if (!xe || !ye) {
                // Either Infinity?
                if (!xc || !yc)
                    return xc ? (y.s = -b, y) : new BigNumber(yc ? x : NaN);
                // Either zero?
                if (!xc[0] || !yc[0]) {
                    // Return y if y is non-zero, x if x is non-zero, or zero if both are zero.
                    return yc[0] ? (y.s = -b, y) : new BigNumber(xc[0] ? x : // IEEE 754 (2008) 6.3: n - n = -0 when rounding to -Infinity
                    ROUNDING_MODE == 3 ? -0 : 0);
                }
            }
            xe = bitFloor(xe);
            ye = bitFloor(ye);
            xc = xc.slice();
            // Determine which is the bigger number.
            if (a = xe - ye) {
                if (xLTy = a < 0) {
                    a = -a;
                    t = xc;
                } else {
                    ye = xe;
                    t = yc;
                }
                t.reverse();
                // Prepend zeros to equalise exponents.
                for (b = a; b--; t.push(0));
                t.reverse();
            } else {
                // Exponents equal. Check digit by digit.
                j = (xLTy = (a = xc.length) < (b = yc.length)) ? a : b;
                for (a = b = 0; b < j; b++) {
                    if (xc[b] != yc[b]) {
                        xLTy = xc[b] < yc[b];
                        break;
                    }
                }
            }
            // x < y? Point xc to the array of the bigger number.
            if (xLTy)
                t = xc, xc = yc, yc = t, y.s = -y.s;
            b = (j = yc.length) - (i = xc.length);
            // Append zeros to xc if shorter.
            // No need to add zeros to yc if shorter as subtract only needs to start at yc.length.
            if (b > 0)
                for (; b--; xc[i++] = 0);
            b = BASE - 1;
            // Subtract yc from xc.
            for (; j > a;) {
                if (xc[--j] < yc[j]) {
                    for (i = j; i && !xc[--i]; xc[i] = b);
                    --xc[i];
                    xc[j] += BASE;
                }
                xc[j] -= yc[j];
            }
            // Remove leading zeros and adjust exponent accordingly.
            for (; xc[0] == 0; xc.splice(0, 1), --ye);
            // Zero?
            if (!xc[0]) {
                // Following IEEE 754 (2008) 6.3,
                // n - n = +0  but  n - n = -0  when rounding towards -Infinity.
                y.s = ROUNDING_MODE == 3 ? -1 : 1;
                y.c = [y.e = 0];
                return y;
            }
            // No need to check for Infinity as +x - +y != Infinity && -x - -y != Infinity
            // for finite x and y.
            return normalise(y, xc, ye);
        };
        /*
         *   n % 0 =  N
         *   n % N =  N
         *   n % I =  n
         *   0 % n =  0
         *  -0 % n = -0
         *   0 % 0 =  N
         *   0 % N =  N
         *   0 % I =  0
         *   N % n =  N
         *   N % 0 =  N
         *   N % N =  N
         *   N % I =  N
         *   I % n =  N
         *   I % 0 =  N
         *   I % N =  N
         *   I % I =  N
         *
         * Return a new BigNumber whose value is the value of this BigNumber modulo the value of
         * BigNumber(y, b). The result depends on the value of MODULO_MODE.
         */
        P.modulo = P.mod = function (y, b) {
            var q, s, x = this;
            id = 11;
            y = new BigNumber(y, b);
            // Return NaN if x is Infinity or NaN, or y is NaN or zero.
            if (!x.c || !y.s || y.c && !y.c[0]) {
                return new BigNumber(NaN);    // Return x if y is Infinity or x is zero.
            } else if (!y.c || x.c && !x.c[0]) {
                return new BigNumber(x);
            }
            if (MODULO_MODE == 9) {
                // Euclidian division: q = sign(y) * floor(x / abs(y))
                // r = x - qy    where  0 <= r < abs(y)
                s = y.s;
                y.s = 1;
                q = div(x, y, 0, 3);
                y.s = s;
                q.s *= s;
            } else {
                q = div(x, y, 0, MODULO_MODE);
            }
            return x.minus(q.times(y));
        };
        /*
         * Return a new BigNumber whose value is the value of this BigNumber negated,
         * i.e. multiplied by -1.
         */
        P.negated = P.neg = function () {
            var x = new BigNumber(this);
            x.s = -x.s || null;
            return x;
        };
        /*
         *  n + 0 = n
         *  n + N = N
         *  n + I = I
         *  0 + n = n
         *  0 + 0 = 0
         *  0 + N = N
         *  0 + I = I
         *  N + n = N
         *  N + 0 = N
         *  N + N = N
         *  N + I = N
         *  I + n = I
         *  I + 0 = I
         *  I + N = N
         *  I + I = I
         *
         * Return a new BigNumber whose value is the value of this BigNumber plus the value of
         * BigNumber(y, b).
         */
        P.plus = P.add = function (y, b) {
            var t, x = this, a = x.s;
            id = 12;
            y = new BigNumber(y, b);
            b = y.s;
            // Either NaN?
            if (!a || !b)
                return new BigNumber(NaN);
            // Signs differ?
            if (a != b) {
                y.s = -b;
                return x.minus(y);
            }
            var xe = x.e / LOG_BASE, ye = y.e / LOG_BASE, xc = x.c, yc = y.c;
            if (!xe || !ye) {
                // Return ±Infinity if either ±Infinity.
                if (!xc || !yc)
                    return new BigNumber(a / 0);
                // Either zero?
                // Return y if y is non-zero, x if x is non-zero, or zero if both are zero.
                if (!xc[0] || !yc[0])
                    return yc[0] ? y : new BigNumber(xc[0] ? x : a * 0);
            }
            xe = bitFloor(xe);
            ye = bitFloor(ye);
            xc = xc.slice();
            // Prepend zeros to equalise exponents. Faster to use reverse then do unshifts.
            if (a = xe - ye) {
                if (a > 0) {
                    ye = xe;
                    t = yc;
                } else {
                    a = -a;
                    t = xc;
                }
                t.reverse();
                for (; a--; t.push(0));
                t.reverse();
            }
            a = xc.length;
            b = yc.length;
            // Point xc to the longer array, and b to the shorter length.
            if (a - b < 0)
                t = yc, yc = xc, xc = t, b = a;
            // Only start adding at yc.length - 1 as the further digits of xc can be ignored.
            for (a = 0; b;) {
                a = (xc[--b] = xc[b] + yc[b] + a) / BASE | 0;
                xc[b] = BASE === xc[b] ? 0 : xc[b] % BASE;
            }
            if (a) {
                xc = [a].concat(xc);
                ++ye;
            }
            // No need to check for zero, as +x + +y != 0 && -x + -y != 0
            // ye = MAX_EXP + 1 possible
            return normalise(y, xc, ye);
        };
        /*
         * Return the number of significant digits of the value of this BigNumber.
         *
         * [z] {boolean|number} Whether to count integer-part trailing zeros: true, false, 1 or 0.
         */
        P.precision = P.sd = function (z) {
            var n, v, x = this, c = x.c;
            // 'precision() argument not a boolean or binary digit: {z}'
            if (z != null && z !== !!z && z !== 1 && z !== 0) {
                if (ERRORS)
                    raise(13, 'argument' + notBool, z);
                if (z != !!z)
                    z = null;
            }
            if (!c)
                return null;
            v = c.length - 1;
            n = v * LOG_BASE + 1;
            if (v = c[v]) {
                // Subtract the number of trailing zeros of the last element.
                for (; v % 10 == 0; v /= 10, n--);
                // Add the number of digits of the first element.
                for (v = c[0]; v >= 10; v /= 10, n++);
            }
            if (z && x.e + 1 > n)
                n = x.e + 1;
            return n;
        };
        /*
         * Return a new BigNumber whose value is the value of this BigNumber rounded to a maximum of
         * dp decimal places using rounding mode rm, or to 0 and ROUNDING_MODE respectively if
         * omitted.
         *
         * [dp] {number} Decimal places. Integer, 0 to MAX inclusive.
         * [rm] {number} Rounding mode. Integer, 0 to 8 inclusive.
         *
         * 'round() decimal places out of range: {dp}'
         * 'round() decimal places not an integer: {dp}'
         * 'round() rounding mode not an integer: {rm}'
         * 'round() rounding mode out of range: {rm}'
         */
        P.round = function (dp, rm) {
            var n = new BigNumber(this);
            if (dp == null || isValidInt(dp, 0, MAX, 15)) {
                round(n, ~~dp + this.e + 1, rm == null || !isValidInt(rm, 0, 8, 15, roundingMode) ? ROUNDING_MODE : rm | 0);
            }
            return n;
        };
        /*
         * Return a new BigNumber whose value is the value of this BigNumber shifted by k places
         * (powers of 10). Shift to the right if n > 0, and to the left if n < 0.
         *
         * k {number} Integer, -MAX_SAFE_INTEGER to MAX_SAFE_INTEGER inclusive.
         *
         * If k is out of range and ERRORS is false, the result will be ±0 if k < 0, or ±Infinity
         * otherwise.
         *
         * 'shift() argument not an integer: {k}'
         * 'shift() argument out of range: {k}'
         */
        P.shift = function (k) {
            var n = this;
            return isValidInt(k, -MAX_SAFE_INTEGER, MAX_SAFE_INTEGER, 16, 'argument')    // k < 1e+21, or truncate(k) will produce exponential notation.
 ? n.times('1e' + truncate(k)) : new BigNumber(n.c && n.c[0] && (k < -MAX_SAFE_INTEGER || k > MAX_SAFE_INTEGER) ? n.s * (k < 0 ? 0 : 1 / 0) : n);
        };
        /*
         *  sqrt(-n) =  N
         *  sqrt( N) =  N
         *  sqrt(-I) =  N
         *  sqrt( I) =  I
         *  sqrt( 0) =  0
         *  sqrt(-0) = -0
         *
         * Return a new BigNumber whose value is the square root of the value of this BigNumber,
         * rounded according to DECIMAL_PLACES and ROUNDING_MODE.
         */
        P.squareRoot = P.sqrt = function () {
            var m, n, r, rep, t, x = this, c = x.c, s = x.s, e = x.e, dp = DECIMAL_PLACES + 4, half = new BigNumber('0.5');
            // Negative/NaN/Infinity/zero?
            if (s !== 1 || !c || !c[0]) {
                return new BigNumber(!s || s < 0 && (!c || c[0]) ? NaN : c ? x : 1 / 0);
            }
            // Initial estimate.
            s = Math.sqrt(+x);
            // Math.sqrt underflow/overflow?
            // Pass x to Math.sqrt as integer, then adjust the exponent of the result.
            if (s == 0 || s == 1 / 0) {
                n = coeffToString(c);
                if ((n.length + e) % 2 == 0)
                    n += '0';
                s = Math.sqrt(n);
                e = bitFloor((e + 1) / 2) - (e < 0 || e % 2);
                if (s == 1 / 0) {
                    n = '1e' + e;
                } else {
                    n = s.toExponential();
                    n = n.slice(0, n.indexOf('e') + 1) + e;
                }
                r = new BigNumber(n);
            } else {
                r = new BigNumber(s + '');
            }
            // Check for zero.
            // r could be zero if MIN_EXP is changed after the this value was created.
            // This would cause a division by zero (x/t) and hence Infinity below, which would cause
            // coeffToString to throw.
            if (r.c[0]) {
                e = r.e;
                s = e + dp;
                if (s < 3)
                    s = 0;
                // Newton-Raphson iteration.
                for (;;) {
                    t = r;
                    r = half.times(t.plus(div(x, t, dp, 1)));
                    if (coeffToString(t.c).slice(0, s) === (n = coeffToString(r.c)).slice(0, s)) {
                        // The exponent of r may here be one less than the final result exponent,
                        // e.g 0.0009999 (e-4) --> 0.001 (e-3), so adjust s so the rounding digits
                        // are indexed correctly.
                        if (r.e < e)
                            --s;
                        n = n.slice(s - 3, s + 1);
                        // The 4th rounding digit may be in error by -1 so if the 4 rounding digits
                        // are 9999 or 4999 (i.e. approaching a rounding boundary) continue the
                        // iteration.
                        if (n == '9999' || !rep && n == '4999') {
                            // On the first iteration only, check to see if rounding up gives the
                            // exact result as the nines may infinitely repeat.
                            if (!rep) {
                                round(t, t.e + DECIMAL_PLACES + 2, 0);
                                if (t.times(t).eq(x)) {
                                    r = t;
                                    break;
                                }
                            }
                            dp += 4;
                            s += 4;
                            rep = 1;
                        } else {
                            // If rounding digits are null, 0{0,4} or 50{0,3}, check for exact
                            // result. If not, then there are further digits and m will be truthy.
                            if (!+n || !+n.slice(1) && n.charAt(0) == '5') {
                                // Truncate to the first rounding digit.
                                round(r, r.e + DECIMAL_PLACES + 2, 1);
                                m = !r.times(r).eq(x);
                            }
                            break;
                        }
                    }
                }
            }
            return round(r, r.e + DECIMAL_PLACES + 1, ROUNDING_MODE, m);
        };
        /*
         *  n * 0 = 0
         *  n * N = N
         *  n * I = I
         *  0 * n = 0
         *  0 * 0 = 0
         *  0 * N = N
         *  0 * I = N
         *  N * n = N
         *  N * 0 = N
         *  N * N = N
         *  N * I = N
         *  I * n = I
         *  I * 0 = N
         *  I * N = N
         *  I * I = I
         *
         * Return a new BigNumber whose value is the value of this BigNumber times the value of
         * BigNumber(y, b).
         */
        P.times = P.mul = function (y, b) {
            var c, e, i, j, k, m, xcL, xlo, xhi, ycL, ylo, yhi, zc, base, sqrtBase, x = this, xc = x.c, yc = (id = 17, y = new BigNumber(y, b)).c;
            // Either NaN, ±Infinity or ±0?
            if (!xc || !yc || !xc[0] || !yc[0]) {
                // Return NaN if either is NaN, or one is 0 and the other is Infinity.
                if (!x.s || !y.s || xc && !xc[0] && !yc || yc && !yc[0] && !xc) {
                    y.c = y.e = y.s = null;
                } else {
                    y.s *= x.s;
                    // Return ±Infinity if either is ±Infinity.
                    if (!xc || !yc) {
                        y.c = y.e = null;    // Return ±0 if either is ±0.
                    } else {
                        y.c = [0];
                        y.e = 0;
                    }
                }
                return y;
            }
            e = bitFloor(x.e / LOG_BASE) + bitFloor(y.e / LOG_BASE);
            y.s *= x.s;
            xcL = xc.length;
            ycL = yc.length;
            // Ensure xc points to longer array and xcL to its length.
            if (xcL < ycL)
                zc = xc, xc = yc, yc = zc, i = xcL, xcL = ycL, ycL = i;
            // Initialise the result array with zeros.
            for (i = xcL + ycL, zc = []; i--; zc.push(0));
            base = BASE;
            sqrtBase = SQRT_BASE;
            for (i = ycL; --i >= 0;) {
                c = 0;
                ylo = yc[i] % sqrtBase;
                yhi = yc[i] / sqrtBase | 0;
                for (k = xcL, j = i + k; j > i;) {
                    xlo = xc[--k] % sqrtBase;
                    xhi = xc[k] / sqrtBase | 0;
                    m = yhi * xlo + xhi * ylo;
                    xlo = ylo * xlo + m % sqrtBase * sqrtBase + zc[j] + c;
                    c = (xlo / base | 0) + (m / sqrtBase | 0) + yhi * xhi;
                    zc[j--] = xlo % base;
                }
                zc[j] = c;
            }
            if (c) {
                ++e;
            } else {
                zc.splice(0, 1);
            }
            return normalise(y, zc, e);
        };
        /*
         * Return a new BigNumber whose value is the value of this BigNumber rounded to a maximum of
         * sd significant digits using rounding mode rm, or ROUNDING_MODE if rm is omitted.
         *
         * [sd] {number} Significant digits. Integer, 1 to MAX inclusive.
         * [rm] {number} Rounding mode. Integer, 0 to 8 inclusive.
         *
         * 'toDigits() precision out of range: {sd}'
         * 'toDigits() precision not an integer: {sd}'
         * 'toDigits() rounding mode not an integer: {rm}'
         * 'toDigits() rounding mode out of range: {rm}'
         */
        P.toDigits = function (sd, rm) {
            var n = new BigNumber(this);
            sd = sd == null || !isValidInt(sd, 1, MAX, 18, 'precision') ? null : sd | 0;
            rm = rm == null || !isValidInt(rm, 0, 8, 18, roundingMode) ? ROUNDING_MODE : rm | 0;
            return sd ? round(n, sd, rm) : n;
        };
        /*
         * Return a string representing the value of this BigNumber in exponential notation and
         * rounded using ROUNDING_MODE to dp fixed decimal places.
         *
         * [dp] {number} Decimal places. Integer, 0 to MAX inclusive.
         * [rm] {number} Rounding mode. Integer, 0 to 8 inclusive.
         *
         * 'toExponential() decimal places not an integer: {dp}'
         * 'toExponential() decimal places out of range: {dp}'
         * 'toExponential() rounding mode not an integer: {rm}'
         * 'toExponential() rounding mode out of range: {rm}'
         */
        P.toExponential = function (dp, rm) {
            return format(this, dp != null && isValidInt(dp, 0, MAX, 19) ? ~~dp + 1 : null, rm, 19);
        };
        /*
         * Return a string representing the value of this BigNumber in fixed-point notation rounding
         * to dp fixed decimal places using rounding mode rm, or ROUNDING_MODE if rm is omitted.
         *
         * Note: as with JavaScript's number type, (-0).toFixed(0) is '0',
         * but e.g. (-0.00001).toFixed(0) is '-0'.
         *
         * [dp] {number} Decimal places. Integer, 0 to MAX inclusive.
         * [rm] {number} Rounding mode. Integer, 0 to 8 inclusive.
         *
         * 'toFixed() decimal places not an integer: {dp}'
         * 'toFixed() decimal places out of range: {dp}'
         * 'toFixed() rounding mode not an integer: {rm}'
         * 'toFixed() rounding mode out of range: {rm}'
         */
        P.toFixed = function (dp, rm) {
            return format(this, dp != null && isValidInt(dp, 0, MAX, 20) ? ~~dp + this.e + 1 : null, rm, 20);
        };
        /*
         * Return a string representing the value of this BigNumber in fixed-point notation rounded
         * using rm or ROUNDING_MODE to dp decimal places, and formatted according to the properties
         * of the FORMAT object (see BigNumber.config).
         *
         * FORMAT = {
         *      decimalSeparator : '.',
         *      groupSeparator : ',',
         *      groupSize : 3,
         *      secondaryGroupSize : 0,
         *      fractionGroupSeparator : '\xA0',    // non-breaking space
         *      fractionGroupSize : 0
         * };
         *
         * [dp] {number} Decimal places. Integer, 0 to MAX inclusive.
         * [rm] {number} Rounding mode. Integer, 0 to 8 inclusive.
         *
         * 'toFormat() decimal places not an integer: {dp}'
         * 'toFormat() decimal places out of range: {dp}'
         * 'toFormat() rounding mode not an integer: {rm}'
         * 'toFormat() rounding mode out of range: {rm}'
         */
        P.toFormat = function (dp, rm) {
            var str = format(this, dp != null && isValidInt(dp, 0, MAX, 21) ? ~~dp + this.e + 1 : null, rm, 21);
            if (this.c) {
                var i, arr = str.split('.'), g1 = +FORMAT.groupSize, g2 = +FORMAT.secondaryGroupSize, groupSeparator = FORMAT.groupSeparator, intPart = arr[0], fractionPart = arr[1], isNeg = this.s < 0, intDigits = isNeg ? intPart.slice(1) : intPart, len = intDigits.length;
                if (g2)
                    i = g1, g1 = g2, g2 = i, len -= i;
                if (g1 > 0 && len > 0) {
                    i = len % g1 || g1;
                    intPart = intDigits.substr(0, i);
                    for (; i < len; i += g1) {
                        intPart += groupSeparator + intDigits.substr(i, g1);
                    }
                    if (g2 > 0)
                        intPart += groupSeparator + intDigits.slice(i);
                    if (isNeg)
                        intPart = '-' + intPart;
                }
                str = fractionPart ? intPart + FORMAT.decimalSeparator + ((g2 = +FORMAT.fractionGroupSize) ? fractionPart.replace(new RegExp('\\d{' + g2 + '}\\B', 'g'), '$&' + FORMAT.fractionGroupSeparator) : fractionPart) : intPart;
            }
            return str;
        };
        /*
         * Return a string array representing the value of this BigNumber as a simple fraction with
         * an integer numerator and an integer denominator. The denominator will be a positive
         * non-zero value less than or equal to the specified maximum denominator. If a maximum
         * denominator is not specified, the denominator will be the lowest value necessary to
         * represent the number exactly.
         *
         * [md] {number|string|BigNumber} Integer >= 1 and < Infinity. The maximum denominator.
         *
         * 'toFraction() max denominator not an integer: {md}'
         * 'toFraction() max denominator out of range: {md}'
         */
        P.toFraction = function (md) {
            var arr, d0, d2, e, exp, n, n0, q, s, k = ERRORS, x = this, xc = x.c, d = new BigNumber(ONE), n1 = d0 = new BigNumber(ONE), d1 = n0 = new BigNumber(ONE);
            if (md != null) {
                ERRORS = false;
                n = new BigNumber(md);
                ERRORS = k;
                if (!(k = n.isInt()) || n.lt(ONE)) {
                    if (ERRORS) {
                        raise(22, 'max denominator ' + (k ? 'out of range' : 'not an integer'), md);
                    }
                    // ERRORS is false:
                    // If md is a finite non-integer >= 1, round it to an integer and use it.
                    md = !k && n.c && round(n, n.e + 1, 1).gte(ONE) ? n : null;
                }
            }
            if (!xc)
                return x.toString();
            s = coeffToString(xc);
            // Determine initial denominator.
            // d is a power of 10 and the minimum max denominator that specifies the value exactly.
            e = d.e = s.length - x.e - 1;
            d.c[0] = POWS_TEN[(exp = e % LOG_BASE) < 0 ? LOG_BASE + exp : exp];
            md = !md || n.cmp(d) > 0 ? e > 0 ? d : n1 : n;
            exp = MAX_EXP;
            MAX_EXP = 1 / 0;
            n = new BigNumber(s);
            // n0 = d1 = 0
            n0.c[0] = 0;
            for (;;) {
                q = div(n, d, 0, 1);
                d2 = d0.plus(q.times(d1));
                if (d2.cmp(md) == 1)
                    break;
                d0 = d1;
                d1 = d2;
                n1 = n0.plus(q.times(d2 = n1));
                n0 = d2;
                d = n.minus(q.times(d2 = d));
                n = d2;
            }
            d2 = div(md.minus(d0), d1, 0, 1);
            n0 = n0.plus(d2.times(n1));
            d0 = d0.plus(d2.times(d1));
            n0.s = n1.s = x.s;
            e *= 2;
            // Determine which fraction is closer to x, n0/d0 or n1/d1
            arr = div(n1, d1, e, ROUNDING_MODE).minus(x).abs().cmp(div(n0, d0, e, ROUNDING_MODE).minus(x).abs()) < 1 ? [
                n1.toString(),
                d1.toString()
            ] : [
                n0.toString(),
                d0.toString()
            ];
            MAX_EXP = exp;
            return arr;
        };
        /*
         * Return the value of this BigNumber converted to a number primitive.
         */
        P.toNumber = function () {
            return +this;
        };
        /*
         * Return a BigNumber whose value is the value of this BigNumber raised to the power n.
         * If m is present, return the result modulo m.
         * If n is negative round according to DECIMAL_PLACES and ROUNDING_MODE.
         * If POW_PRECISION is non-zero and m is not present, round to POW_PRECISION using
         * ROUNDING_MODE.
         *
         * The modular power operation works efficiently when x, n, and m are positive integers,
         * otherwise it is equivalent to calculating x.toPower(n).modulo(m) (with POW_PRECISION 0).
         *
         * n {number} Integer, -MAX_SAFE_INTEGER to MAX_SAFE_INTEGER inclusive.
         * [m] {number|string|BigNumber} The modulus.
         *
         * 'pow() exponent not an integer: {n}'
         * 'pow() exponent out of range: {n}'
         *
         * Performs 54 loop iterations for n of 9007199254740991.
         */
        P.toPower = P.pow = function (n, m) {
            var k, y, z, i = mathfloor(n < 0 ? -n : +n), x = this;
            if (m != null) {
                id = 23;
                m = new BigNumber(m);
            }
            // Pass ±Infinity to Math.pow if exponent is out of range.
            if (!isValidInt(n, -MAX_SAFE_INTEGER, MAX_SAFE_INTEGER, 23, 'exponent') && (!isFinite(n) || i > MAX_SAFE_INTEGER && (n /= 0) || parseFloat(n) != n && !(n = NaN)) || n == 0) {
                k = Math.pow(+x, n);
                return new BigNumber(m ? k % m : k);
            }
            if (m) {
                if (n > 1 && x.gt(ONE) && x.isInt() && m.gt(ONE) && m.isInt()) {
                    x = x.mod(m);
                } else {
                    z = m;
                    // Nullify m so only a single mod operation is performed at the end.
                    m = null;
                }
            } else if (POW_PRECISION) {
                // Truncating each coefficient array to a length of k after each multiplication
                // equates to truncating significant digits to POW_PRECISION + [28, 41],
                // i.e. there will be a minimum of 28 guard digits retained.
                // (Using + 1.5 would give [9, 21] guard digits.)
                k = mathceil(POW_PRECISION / LOG_BASE + 2);
            }
            y = new BigNumber(ONE);
            for (;;) {
                if (i % 2) {
                    y = y.times(x);
                    if (!y.c)
                        break;
                    if (k) {
                        if (y.c.length > k)
                            y.c.length = k;
                    } else if (m) {
                        y = y.mod(m);
                    }
                }
                i = mathfloor(i / 2);
                if (!i)
                    break;
                x = x.times(x);
                if (k) {
                    if (x.c && x.c.length > k)
                        x.c.length = k;
                } else if (m) {
                    x = x.mod(m);
                }
            }
            if (m)
                return y;
            if (n < 0)
                y = ONE.div(y);
            return z ? y.mod(z) : k ? round(y, POW_PRECISION, ROUNDING_MODE) : y;
        };
        /*
         * Return a string representing the value of this BigNumber rounded to sd significant digits
         * using rounding mode rm or ROUNDING_MODE. If sd is less than the number of digits
         * necessary to represent the integer part of the value in fixed-point notation, then use
         * exponential notation.
         *
         * [sd] {number} Significant digits. Integer, 1 to MAX inclusive.
         * [rm] {number} Rounding mode. Integer, 0 to 8 inclusive.
         *
         * 'toPrecision() precision not an integer: {sd}'
         * 'toPrecision() precision out of range: {sd}'
         * 'toPrecision() rounding mode not an integer: {rm}'
         * 'toPrecision() rounding mode out of range: {rm}'
         */
        P.toPrecision = function (sd, rm) {
            return format(this, sd != null && isValidInt(sd, 1, MAX, 24, 'precision') ? sd | 0 : null, rm, 24);
        };
        /*
         * Return a string representing the value of this BigNumber in base b, or base 10 if b is
         * omitted. If a base is specified, including base 10, round according to DECIMAL_PLACES and
         * ROUNDING_MODE. If a base is not specified, and this BigNumber has a positive exponent
         * that is equal to or greater than TO_EXP_POS, or a negative exponent equal to or less than
         * TO_EXP_NEG, return exponential notation.
         *
         * [b] {number} Integer, 2 to 64 inclusive.
         *
         * 'toString() base not an integer: {b}'
         * 'toString() base out of range: {b}'
         */
        P.toString = function (b) {
            var str, n = this, s = n.s, e = n.e;
            // Infinity or NaN?
            if (e === null) {
                if (s) {
                    str = 'Infinity';
                    if (s < 0)
                        str = '-' + str;
                } else {
                    str = 'NaN';
                }
            } else {
                str = coeffToString(n.c);
                if (b == null || !isValidInt(b, 2, 64, 25, 'base')) {
                    str = e <= TO_EXP_NEG || e >= TO_EXP_POS ? toExponential(str, e) : toFixedPoint(str, e);
                } else {
                    str = convertBase(toFixedPoint(str, e), b | 0, 10, s);
                }
                if (s < 0 && n.c[0])
                    str = '-' + str;
            }
            return str;
        };
        /*
         * Return a new BigNumber whose value is the value of this BigNumber truncated to a whole
         * number.
         */
        P.truncated = P.trunc = function () {
            return round(new BigNumber(this), this.e + 1, 1);
        };
        /*
         * Return as toString, but do not accept a base argument, and include the minus sign for
         * negative zero.
         */
        P.valueOf = P.toJSON = function () {
            var str, n = this, e = n.e;
            if (e === null)
                return n.toString();
            str = coeffToString(n.c);
            str = e <= TO_EXP_NEG || e >= TO_EXP_POS ? toExponential(str, e) : toFixedPoint(str, e);
            return n.s < 0 ? '-' + str : str;
        };
        P.isBigNumber = true;
        if (config != null)
            BigNumber.config(config);
        return BigNumber;
    }
    // PRIVATE HELPER FUNCTIONS
    function bitFloor(n) {
        var i = n | 0;
        return n > 0 || n === i ? i : i - 1;
    }
    // Return a coefficient array as a string of base 10 digits.
    function coeffToString(a) {
        var s, z, i = 1, j = a.length, r = a[0] + '';
        for (; i < j;) {
            s = a[i++] + '';
            z = LOG_BASE - s.length;
            for (; z--; s = '0' + s);
            r += s;
        }
        // Determine trailing zeros.
        for (j = r.length; r.charCodeAt(--j) === 48;);
        return r.slice(0, j + 1 || 1);
    }
    // Compare the value of BigNumbers x and y.
    function compare(x, y) {
        var a, b, xc = x.c, yc = y.c, i = x.s, j = y.s, k = x.e, l = y.e;
        // Either NaN?
        if (!i || !j)
            return null;
        a = xc && !xc[0];
        b = yc && !yc[0];
        // Either zero?
        if (a || b)
            return a ? b ? 0 : -j : i;
        // Signs differ?
        if (i != j)
            return i;
        a = i < 0;
        b = k == l;
        // Either Infinity?
        if (!xc || !yc)
            return b ? 0 : !xc ^ a ? 1 : -1;
        // Compare exponents.
        if (!b)
            return k > l ^ a ? 1 : -1;
        j = (k = xc.length) < (l = yc.length) ? k : l;
        // Compare digit by digit.
        for (i = 0; i < j; i++)
            if (xc[i] != yc[i])
                return xc[i] > yc[i] ^ a ? 1 : -1;
        // Compare lengths.
        return k == l ? 0 : k > l ^ a ? 1 : -1;
    }
    /*
     * Return true if n is a valid number in range, otherwise false.
     * Use for argument validation when ERRORS is false.
     * Note: parseInt('1e+1') == 1 but parseFloat('1e+1') == 10.
     */
    function intValidatorNoErrors(n, min, max) {
        return (n = truncate(n)) >= min && n <= max;
    }
    function isArray(obj) {
        return Object.prototype.toString.call(obj) == '[object Array]';
    }
    /*
     * Convert string of baseIn to an array of numbers of baseOut.
     * Eg. convertBase('255', 10, 16) returns [15, 15].
     * Eg. convertBase('ff', 16, 10) returns [2, 5, 5].
     */
    function toBaseOut(str, baseIn, baseOut) {
        var j, arr = [0], arrL, i = 0, len = str.length;
        for (; i < len;) {
            for (arrL = arr.length; arrL--; arr[arrL] *= baseIn);
            arr[j = 0] += ALPHABET.indexOf(str.charAt(i++));
            for (; j < arr.length; j++) {
                if (arr[j] > baseOut - 1) {
                    if (arr[j + 1] == null)
                        arr[j + 1] = 0;
                    arr[j + 1] += arr[j] / baseOut | 0;
                    arr[j] %= baseOut;
                }
            }
        }
        return arr.reverse();
    }
    function toExponential(str, e) {
        return (str.length > 1 ? str.charAt(0) + '.' + str.slice(1) : str) + (e < 0 ? 'e' : 'e+') + e;
    }
    function toFixedPoint(str, e) {
        var len, z;
        // Negative exponent?
        if (e < 0) {
            // Prepend zeros.
            for (z = '0.'; ++e; z += '0');
            str = z + str;    // Positive exponent
        } else {
            len = str.length;
            // Append zeros.
            if (++e > len) {
                for (z = '0', e -= len; --e; z += '0');
                str += z;
            } else if (e < len) {
                str = str.slice(0, e) + '.' + str.slice(e);
            }
        }
        return str;
    }
    function truncate(n) {
        n = parseFloat(n);
        return n < 0 ? mathceil(n) : mathfloor(n);
    }
    // EXPORT
    BigNumber = constructorFactory();
    BigNumber['default'] = BigNumber.BigNumber = BigNumber;
    // AMD.
    if (typeof define == 'function' && define.amd) {
        define('bignumber', [], function () {
            return BigNumber;
        });    // Node.js and other environments that support module.exports.
    } else if (typeof module != 'undefined' && module.exports) {
        module.exports = BigNumber;    // Browser.
    } else {
        if (!globalObj)
            globalObj = typeof self != 'undefined' ? self : Function('return this')();
        globalObj.BigNumber = BigNumber;
    }
}(this));
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Profile
define('Profile.Model', [
    'Address.Collection',
    'SC.Configuration',
    'CreditCard.Collection',
    'Singleton',
    'underscore',
    'jQuery',
    'Backbone',
    'bignumber',
    'Utils'
], function (AddressCollection, Configuration, CreditCardsCollection, Singleton, _, jQuery, Backbone, BigNumber, Utils) {
    'use strict';
    var classProperties = _.extend({
            // @method getPromise
            // @static
            // @return {jQuery.Deferred}
            getPromise: function () {
                var self = this;
                if (!SC.PROFILE_PROMISE) {
                    SC.PROFILE_PROMISE = jQuery.Deferred().done(function (profile) {
                        delete SC.ENVIRONMENT.PROFILE;
                        self.getInstance().set(profile);
                    });
                }
                // if the user.env has already loaded, resolve the profile promise if not already resolved
                if (SC.ENVIRONMENT.PROFILE && SC.PROFILE_PROMISE.state() !== 'resolved') {
                    SC.PROFILE_PROMISE.resolve(SC.ENVIRONMENT.PROFILE);
                }
                return SC.PROFILE_PROMISE;
            }
        }, Singleton)    //@class Profile.Model @extend Backbone.Model
, ProfileModel = Backbone.Model.extend({
            validation: {
                firstname: {
                    required: true,
                    msg: _('First Name is required').translate()
                }    // This code is commented temporally, because of the inconsistence between Checkout and My Account regarding the require data from profile information (Checkout can miss last name)
,
                lastname: {
                    required: true,
                    msg: _('Last Name is required').translate()
                },
                email: {
                    required: true,
                    pattern: 'email',
                    msg: _('Valid Email is required').translate()
                },
                phone: {
                    required: true,
                    fn: Utils.validatePhone
                },
                companyname: {
                    required: function isCompanyRequired() {
                        return Configuration.get('siteSettings.registration.companyfieldmandatory', 'F') === 'T';
                    },
                    msg: _('Company Name is required').translate()
                }    // if the user wants to change its email we need ask for confirmation and current password.
                     // We leave this validation in this model, instead of creating a new one like UpdatePassword, because
                     // the email is updated in the same window than the rest of the attributes
,
                confirm_email: function (confirm_email, attr, form) {
                    if (Utils.trim(form.email) !== this.attributes.email && Utils.trim(confirm_email) !== Utils.trim(form.email)) {
                        return _('Emails do not match').translate();
                    }
                },
                current_password: function (current_password, attr, form) {
                    if (Utils.trim(form.email) !== this.attributes.email && (_.isNull(current_password) || _.isUndefined(current_password) || _.isString(current_password) && Utils.trim(current_password) === '')) {
                        return _('Current password is required').translate();
                    }
                }
            },
            urlRoot: 'services/Profile.Service.ss',
            initialize: function initialize(attributes) {
                this.on('change:addresses', function () {
                    this.get('addresses').on('change:defaultshipping change:defaultbilling add destroy reset', this.checkDefaultsAddresses, this);
                });
                this.on('change:creditcards', function (model, creditcards) {
                    model.set('creditcards', new CreditCardsCollection(creditcards), { silent: true });
                    this.get('creditcards').on('change:ccdefault add destroy reset', this.checkDefaultsCreditCard, this);
                });
                this.on('change:balance', function (model) {
                    if (_.isNumber(model.get('creditlimit')) && _.isNumber(model.get('balance'))) {
                        var balance_available;
                        if (typeof BigNumber !== 'undefined') {
                            balance_available = new BigNumber(model.get('creditlimit')).minus(model.get('balance'));
                        } else {
                            balance_available = model.get('creditlimit') - model.get('balance');
                        }
                        model.set('balance_available', balance_available);
                        model.set('balance_available_formatted', Utils.formatCurrency(balance_available));
                    }
                });
                this.set('addresses', attributes && attributes.addresses || new AddressCollection());
                this.set('creditcards', attributes && attributes.creditcards || new CreditCardsCollection());
            }    // @method checkDefaultsAddresses
                 // @param {Profile.Model} model
                 // @return {Void}
,
            checkDefaultsAddresses: function checkDefaultsAddresses(model) {
                var addresses = this.get('addresses'), Model = addresses.model;
                if (model instanceof Model) {
                    // if the created/modified address is set as default for shipping we set every other one as not default
                    if (model.get('defaultshipping') === 'T') {
                        _.each(addresses.where({ defaultshipping: 'T' }), function (address) {
                            if (model !== address) {
                                address.set({ defaultshipping: 'F' }, { silent: true });
                            }
                        });
                    }
                    // if the created/modified address is set as default for billing we set every other one as not default
                    if (model.get('defaultbilling') === 'T') {
                        _.each(addresses.where({ defaultbilling: 'T' }), function (address) {
                            if (model !== address) {
                                address.set({ defaultbilling: 'F' }, { silent: true });
                            }
                        });
                    }
                }
            }    // @method checkDefaultsCreditCard
                 // @param {Profile.Model} model
                 // @return {Void}
,
            checkDefaultsCreditCard: function (model) {
                var creditcards = this.get('creditcards'), Model = creditcards.model;
                // if the created/modified card is set as default we set every other card as not default
                if (model.get('ccdefault') === 'T') {
                    _.each(creditcards.where({ ccdefault: 'T' }), function (creditCard) {
                        if (creditCard && model !== creditCard) {
                            creditCard.set({ ccdefault: 'F' }, { silent: true });
                        }
                    });
                }
                var default_creditcard = creditcards.find(function (model) {
                    return model.get('ccdefault') === 'T';
                });
                // set the default card in the collection as the profile's default card
                this.set('defaultCreditCard', default_creditcard || new Model({ ccdefault: 'T' }));
            }    // @method getSearchApiUrl
                 // @return {String}
,
            getSearchApiUrl: function () {
                //We've got to disable passwordProtectedSite and loginToSeePrices features if customer registration is disabled.
                if (Configuration.getRegistrationType() !== 'disabled' && (Configuration.get('siteSettings.requireloginforpricing', 'F') === 'T' || Configuration.get('siteSettings.siteloginrequired', 'F') === 'T') && this.get('isLoggedIn') === 'T') {
                    return Utils.getAbsoluteUrl('searchApi.ssp');
                }
                return '/api/items';
            }    // @method isAvoidingDoubleRedirect
                 // @return {Boolean}
,
            isAvoidingDoubleRedirect: function () {
                //We've got to disable passwordProtectedSite and loginToSeePrices features if customer registration is disabled.
                return Configuration.getRegistrationType() !== 'disabled' && (Configuration.get('siteSettings.requireloginforpricing', 'F') === 'T' || Configuration.get('siteSettings.siteloginrequired', 'F') === 'T') && this.get('isLoggedIn') === 'T';
            }    // @method hidePrices Determines -when LoginToSeePrices feature is enabled- if the prices should be hidden.
                 // @return {Boolean}
,
            hidePrices: function () {
                //We've got to disable loginToSeePrices feature if customer registration is disabled.
                return Configuration.getRegistrationType() !== 'disabled' && Configuration.get('siteSettings.requireloginforpricing', 'F') === 'T' && this.get('isLoggedIn') !== 'T';
            },
            set: function (key, val, options) {
                //If the addresses attribute is not an instance of AddressCollection, will be converted into one.
                // attributes both `"key", value` and `{key: value}` -style arguments.
                var attributes = {};
                if (typeof key === 'object') {
                    attributes = key;
                    options = val;
                } else {
                    attributes[key] = val;
                }
                if (attributes.addresses && !(attributes.addresses instanceof AddressCollection)) {
                    attributes.addresses = new AddressCollection(attributes.addresses);
                }
                return Backbone.Model.prototype.set.call(this, attributes, options);
            }
        }, classProperties);
    return ProfileModel;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CreditCard
define('CreditCard.Edit.Form.SecurityCode.Tooltip.View', [
    'creditcard_edit_form_securitycode_tooltip.tpl',
    'SC.Configuration',
    'Profile.Model',
    'Backbone',
    'underscore'
], function (creditcard_edit_form_securitycode_tootltip, Configuration, ProfileModel, Backbone, _) {
    'use strict';
    // @class CreditCard.Edit.Form.SecurityCode.Tooltip.View @extends Backbone.View
    return Backbone.View.extend({
        template: creditcard_edit_form_securitycode_tootltip    //@method getAvailableCreditcards
,
        getAvailableCreditcards: function () {
            // Creditcards
            var creditcards = [], user_creditcards = ProfileModel.getInstance().get('creditcards');
            user_creditcards.each(function (user_cc) {
                creditcards.push(user_cc.get('paymentmethod').name);
            });
            if (!creditcards.length) {
                var available_creditcards = _.where(Configuration.get('siteSettings.paymentmethods'), {
                    creditcard: 'T',
                    ispaypal: 'F'
                });
                _.each(available_creditcards, function (index, el) {
                    creditcards.push(available_creditcards[el].name);
                });
            }
            return _.unique(creditcards);
        }    //@method getContext @return CreditCard.Edit.Form.SecurityCode.Tooltip.View.Context
,
        getContext: function () {
            var available_credit_cards = this.getAvailableCreditcards();
            //@class CreditCard.Edit.Form.SecurityCode.Tooltip.View.Context
            return {
                //@property {Boolean} isCreditCards
                isCreditCards: available_credit_cards.length > 0    //@property {Array<String>} availableCreditcards
,
                availableCreditcards: available_credit_cards    //@property {String} imageCvvAmericanCard
,
                imageCvvAmericanCardURL: _.getAbsoluteUrlOfNonManagedResources(Configuration.get('creditCard.imageCvvAmericanCard'))    //@property {String} imageCvvAllCards
,
                imageCvvAllCardsURL: _.getAbsoluteUrlOfNonManagedResources(Configuration.get('creditCard.imageCvvAllCards'))    //@property {Boolean} isVisaMasterOrDiscoverAvailable
,
                isVisaMasterOrDiscoverAvailable: _.indexOf(available_credit_cards, 'VISA') !== -1 || _.indexOf(available_credit_cards, 'Master Card') !== -1 || _.indexOf(available_credit_cards, 'Discover') !== -1    //@property {Boolean} isAmexAvailable
,
                isAmexAvailable: _.indexOf(available_credit_cards, 'American Express') !== -1
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CreditCard
define('CreditCard.Edit.Form.SecurityCode.View', [
    'creditcard_edit_form_securitycode.tpl',
    'CreditCard.Edit.Form.SecurityCode.Tooltip.View',
    'SC.Configuration',
    'Backbone'
], function (creditcard_edit_form_securitycode_tpl, CreditCardEditFormSecurityCodeTooltipView, Configuration, Backbone) {
    'use strict';
    // @class CreditCard.Edit.Form.SecurityCode.View Credit cards list @extends Backbone.View
    return Backbone.View.extend({
        template: creditcard_edit_form_securitycode_tpl,
        render: function () {
            this._render();
            var ccv_tooltip_view = new CreditCardEditFormSecurityCodeTooltipView();
            ccv_tooltip_view.render();
            var placeholder = this.$el.find('[data-toggle="popover"]');
            placeholder.attr('data-content', ccv_tooltip_view.$el.html());
        }    //@method getContext @return CreditCard.Edit.Form.SecurityCode.View.Context
,
        getContext: function () {
            //@class CreditCard.Edit.Form.SecurityCode.View.Context
            return {
                //@property {Boolean} showCreditCardHelp
                showCreditCardHelp: this.options.showCreditCardHelp,
                creditCardHelpTitle: this.options.creditCardHelpTitle,
                showError: !!this.options.error,
                errorMessage: this.options.error ? this.options.error.errorMessage : ''    //@property {Number} value
,
                value: this.options.value
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CreditCard
define('CreditCard.Edit.Form.View', [
    'CreditCard.Edit.Form.SecurityCode.View',
    'creditcard_edit_form.tpl',
    'SC.Configuration',
    'Backbone.CompositeView',
    'Backbone.FormView',
    'Backbone',
    'underscore'
], function (CreditCardEditFormSecurityCodeView, creditcard_edit_form_tpl, Configuration, BackboneCompositeView, BackboneFormView, Backbone, _) {
    'use strict';
    // @class CreditCard.Edit.Form.View @extends Backbone.View
    return Backbone.View.extend({
        template: creditcard_edit_form_tpl,
        bindings: {
            '[name="ccnumber"]': 'ccnumber',
            '[name="ccname"]': 'ccname',
            '[name="ccsecuritycode"]': 'ccsecuritycode',
            '[name="expmonth"]': 'expmonth',
            '[name="expyear"]': 'expyear'
        },
        initialize: function () {
            if (!this.model.isNew()) {
                delete this.bindings['[name="ccnumber"]'];
            }
            if (this.options.showSecurityCodeForm) {
                this.model.set({ hasSecurityCode: true });
            } else {
                this.model.unset('hasSecurityCode', { silent: true });
            }
            if (!this.model.get('expmonth')) {
                this.model.set({ 'expmonth': this.options.currentMonth + '' }, { silent: true });
            }
            if (!this.model.get('expyear')) {
                this.model.set({ 'expyear': this.options.years[0] + '' }, { silent: true });
            }
            BackboneCompositeView.add(this);
            BackboneFormView.add(this);
        },
        childViews: {
            'CreditCard.Edit.Form.SecurityCode': function () {
                return new CreditCardEditFormSecurityCodeView({
                    showCreditCardHelp: this.options.showCreditCardHelp,
                    creditCardHelpTitle: this.options.creditCardHelpTitle
                });
            }
        }    //@method getContext @return CreditCard.Edit.Form.View.Context
,
        getContext: function () {
            var selected_payment_method = this.model.get('paymentmethod'), self = this, paymentMethods = _.map(_.where(Configuration.get('siteSettings.paymentmethods', []), { creditcard: 'T' }), function (paymentmethod) {
                    //@class CreditCard.PaymentMetod
                    return {
                        //@property 
                        hidden: !(self.model.isNew() || selected_payment_method && paymentmethod.key === selected_payment_method.key),
                        icon: paymentmethod.imagesrc,
                        internalid: paymentmethod.internalid,
                        key: paymentmethod.key,
                        name: paymentmethod.name,
                        selected: selected_payment_method && paymentmethod.key === selected_payment_method.key
                    };
                }), months = _.map(this.options.months, function (month) {
                    return { month: month };
                }), years = _.map(this.options.years, function (year) {
                    return {
                        year: year,
                        disabled: year === self.options.expyear
                    };
                }), ccnumber = this.model.get('ccnumber');
            // temporal credit card.
            if (ccnumber && !~ccnumber.indexOf('*')) {
                ccnumber = '************' + ccnumber.substring(ccnumber.length - 4);
            }
            //@class CreditCard.Form.View.Context
            return {
                //@property {Array<CreditCard.PaymentMetod>} paymentMethods
                paymentMethods: paymentMethods    //@property {String} paymentMethodValue
,
                paymentMethodValue: selected_payment_method ? selected_payment_method.key : ''    //@property {String} ccnumber
,
                ccnumber: ccnumber    //@property {boolean} showPaymentSelector
,
                showPaymentSelector: this.model.isNew()    //@property {Boolean} isNew
,
                isNew: this.model.isNew()    //@property {Array<Object>?} months			
,
                months: months    //@property {Array<Object>?} years
,
                years: years    //@property {Boolean} showDefaults
,
                showDefaults: !!this.options.showDefaults,
                ccname: this.model.get('ccname')    //@property {Boolean} ccdefault
,
                ccdefault: this.model.get('ccdefault') === 'T'    //@property {Boolean} showSecurityCode
,
                showSecurityCodeForm: !!this.options.showSecurityCodeForm,
                showSaveCreditCardCheckbox: !!this.options.showSaveCreditCardCheckbox && (this.model.isNew() || this.model.get('internalid') === '-temporal-')    //@property {Boolean} saveCreditCardByDefault
,
                saveCreditCardByDefault: this.model.get('internalid') === '-temporal-' ? false : !!this.options.saveCreditCardByDefault
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module BackboneExtras
#Backbone.CachedModel - cachedSync
adds the functionality to Backbone to support backbone models&collections cached
in memory - it will load from memory the second fetch() will return results from memory the next time a model is fetched.
Backbone.CachedModel and Backbone.CachedCollection classes can be extended and they use the core method
Backbone.cachedSync, instead the normal Backbone.sync.
*/
define('Backbone.CachedSync', [
    'Backbone',
    'underscore',
    'jQuery'
], function (Backbone, _, jQuery) {
    'use strict';
    // @module Backbone @class Backbone
    // @property {Object<String,jQuery.Deferred>} localCache The cache is an object where keys are a request identifier and values are a the result of the request and some metadata. @static
    Backbone.localCache = {};
    // @property {Number} cacheSize We will cap the size of the cache by an arbitratry number, fell free to change it to meet your needs.
    Backbone.cacheSize = 100;
    // Removes the oldest requests once the limit is reached
    function evictRecords() {
        var keys = _.keys(Backbone.localCache), cache_size = keys.length;
        if (cache_size > Backbone.cacheSize) {
            delete Backbone.localCache[keys[0]];
        }
    }
    // @method cachedSync
    // This method is the base for implementing backbone model caching in memory. Adds a cache
    // layer to all read requests, but leaves all write actions unmodified. Can be used
    // interchangeably with Backbone.sync (has the same API), it will retun a jQuery promise once
    // it's done will call the apropiate function
    // @return {jQuery.Deferred} Generates a new deferred for every new sync, no matter if its
    // or not in the cache. This promise is / already-was resolved with the ajax call.
    Backbone.cachedSync = function (action, self, options) {
        if (action === 'read') {
            // Generates an uninque url that will be used as the request identifier
            var url = _.result(this, 'url');
            if (options && options.data) {
                url += (~url.indexOf('?') ? '&' : '?') + jQuery.param(options.data);
            }
            var deferred = jQuery.Deferred();
            // jQuery.ajax maps error to fail and success to done
            deferred.error = deferred.fail;
            deferred.success = deferred.done;
            // Now we make sure the success and error options are called
            deferred.success(options.success);
            deferred.error(options.error);
            // We then delete them from the options that will be passed to the real call so they are not called twice, for the 1st request
            delete options.success;
            delete options.error;
            // Force ajaxSetup cache to be true and not append a &_={timestamp} to the end of the URL
            options.cache = true;
            // Now we get the actual request from the cache or we perform it
            Backbone.localCache[url] = Backbone.localCache[url] || Backbone.sync.apply(this, arguments);
            // Now we resolve the Deferred by listeinig to the resolution of the real request
            // if the request was already resolved our methods will be called imediatelly
            Backbone.localCache[url].then(// Success Callback
            function (response, status, jqXhr) {
                // Sometimes parse modifies the responce object (that is passed by reference)
                response = jqXhr.responseText ? JSON.parse(jqXhr.responseText) : response;
                // now we resolve the defered one with results
                deferred.resolveWith(Backbone.localCache[url], [
                    response,
                    status,
                    jqXhr
                ]);
                // This make sure the cache is keept short
                evictRecords();
            }    // Error Callback
, function () {
                // if it fails we make sure the next time its requested, dont read from cache
                delete Backbone.localCache[url];
                deferred.rejectWith(Backbone.localCache[url], arguments);
            }    // Progess Callback
, function () {
                deferred.notifyWith(Backbone.localCache[url], arguments);
            });
            // Then we just return the defered
            return deferred;    // Bottom line: we are piping a fake ajax deferred from the original one
        }
        // if cache is not present we just call the original Backbone.sync
        return Backbone.sync.apply(this, arguments);
    };
    // @module BackboneExtras
    // @class Backbone.CachedModel @method addToCache @param data @param {Object} params
    // @class Backbone.CachedCollection @method addToCache @param data @param {Object} params
    function addToCache(data, params) {
        /*jshint validthis:true*/
        // Generates an uninque url that will be used as the request identifier
        var url = _.result(this, 'url');
        url += (~url.indexOf('?') ? '&' : '?') + jQuery.param(params || {});
        // This defered will be used as a fake Ajax Request we are gonna store in the cache
        var deferred = jQuery.Deferred();
        // We resolve the defered with the data you sent and some fake ajax info
        deferred.resolveWith(this, [
            data,
            'success',
            {
                response: data,
                status: 'success',
                statusCode: '200',
                readyState: 4,
                statusText: 'OK',
                responseText: false    // So it will use response instead of responseText
            }
        ]);
        // Stores this fake promice in the cache
        Backbone.localCache[url] = deferred;
    }
    // @class Backbone.CachedModel @method isCached @param {Object} params @return {Boolean}
    // @class Backbone.CachedCollection @method isCached @param {Object} params @return {Boolean}
    function isCached(params) {
        /*jshint validthis:true*/
        // Generates an uninque url that will be used as the request identifier
        var url = _.result(this, 'url');
        if (params) {
            url += (~url.indexOf('?') ? '&' : '?') + jQuery.param(params);
        }
        return !!Backbone.localCache[url];
    }
    return {
        cachedSync: Backbone.cachedSync,
        addToCache: addToCache,
        isCached: isCached
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module BackboneExtras
It adds the Backbome.CachedModel class. 
@class Backbone.CachedModel 
It is a Backbone.Model that will return results from memory the second time you call fetch(). It's 
just an extension of the original Backbone.Model but it uses the Backbone.cachedSync.
@extends Backbone.Model
*/
define('Backbone.CachedModel', [
    'Backbone.CachedSync',
    'Backbone'
], function (BackboneCachedSync, Backbone) {
    'use strict';
    Backbone.CachedModel = Backbone.Model.extend({
        sync: BackboneCachedSync.cachedSync,
        addToCache: BackboneCachedSync.addToCache,
        isCached: BackboneCachedSync.isCached
    });
    return Backbone.CachedModel;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//! © 2015 NetSuite Inc.
// Session.js
// -------------
//
define('Session', [
    'underscore',
    'Utils'
], function (_) {
    'use strict';
    return {
        get: function (path, default_value) {
            var session_info = SC && SC.getSessionInfo && SC.getSessionInfo() || {};
            return _.getPathFromObject(session_info, path, default_value);
        },
        set: function (path, value) {
            var session_info = SC && SC.getSessionInfo && SC.getSessionInfo() || {};
            session_info[path] = value;
        },
        getSearchApiParams: function () {
            var search_api_params = {}, locale = this.get('language.locale', ''), language = '', country = '', currency = this.get('currency.code', '') ? this.get('currency.code', '') : this.get('currency', '');
            if (~locale.indexOf('_')) {
                var locale_tokens = locale.split('_');
                language = locale_tokens[0];
                country = locale_tokens[1];
            } else {
                language = locale;
            }
            //SET API PARAMS
            if (language) {
                search_api_params.language = language;
            }
            if (country) {
                search_api_params.country = country;
            }
            // Currency
            if (currency) {
                search_api_params.currency = currency;
            }
            // Price Level
            search_api_params.pricelevel = this.get('priceLevel', '');
            // No cache
            if (_.parseUrlOptions(location.search).nocache === 'T') {
                search_api_params.nocache = 'T';
            }
            return search_api_params;
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module UrlHelper
define('UrlHelper', [
    'underscore',
    'Utils'
], function (_, Utils) {
    'use strict';
    // @class UrlHelper Keeps track of the URL, triggering custom events to specific parameters. 
    // Provides methods to add, get and remove parameters from the url. 
    // Extends Utils and add this methods to underscore. 
    // As an application module, when mounted to the application will listen to onAfterAppendView 
    // and will update itself with the new url @extends ApplicationModule
    var UrlHelper = {
        // @property {String} url
        url: ''    // @property {Object} listeners
,
        listeners: {}    // @property {Object} parameters
,
        parameters: {}    // @method setUrl @param {String} url
,
        setUrl: function (url) {
            var self = this;
            this.url = url;
            this.parameters = {};
            // for each of the listeners
            _.each(this.listeners, function (fn, token) {
                var parameter_value = self.getParameterValue(token);
                // if the key (token) is in the url
                if (parameter_value) {
                    // we trigger the function
                    var value = _.isFunction(fn) ? fn(parameter_value) : fn;
                    // if there is a value, we store it in our parameters object
                    if (value) {
                        if (_.isBoolean(value)) {
                            self.parameters[token] = parameter_value;
                        } else {
                            self.parameters[token] = value;
                        }
                    }
                }
            });
        }    // @method addTokenListener @param {String} token @param {Function} fn
,
        addTokenListener: function (token, fn) {
            this.listeners[token] = fn;
        }    // @method getParameters @return {Object}
,
        getParameters: function () {
            return this.parameters;
        }    // @method getParameterValue @param {String} parameter @return {String} 
,
        getParameterValue: function (parameter) {
            var value = this.url.match(parameter + '{1}\\={1}(.*?[^&#]*)');
            if (value && value[1]) {
                return value[1];
            } else {
                return '';
            }
        }    // @method clearValues
,
        clearValues: function () {
            this.url = '';
            this.listeners = {};
            this.parameters = {};
        }
    };
    // @module Utils @class Utils
    // @method fixUrl added by UrlHelper @param {String} url
    function fixUrl(url) {
        if (!new RegExp('^http').test(url)) {
            var parameters = UrlHelper.getParameters(), charValue = '', value = '';
            // for each of the parameters in the helper
            _.each(parameters, function (i, parameter) {
                value = url.match(new RegExp(parameter + '{1}\\={1}(.*?[^&]*)'));
                // if the parameter is not in the url
                if (!value) {
                    charValue = ~url.indexOf('?') ? '&' : '?';
                    // we append it
                    url += charValue + parameter + '=' + parameters[parameter];
                }
            });
        }
        return url;
    }
    // @method setUrlParameter changes the value of a parameter in the url 
    // @param {String} url @param {String} parameter @param {String} new_value 
    function setUrlParameter(url, parameter, new_value) {
        var value = url.match(new RegExp(parameter + '{1}\\={1}(.*?[^(&|#)]*)')), charValue = '';
        if (value) {
            return url.replace(value[0], parameter + '=' + new_value);
        } else {
            charValue = ~url.indexOf('?') ? '&' : '?';
            return url + charValue + parameter + '=' + new_value;
        }
    }
    // @method removeUrlParameter @param {String} url @param {String} parameter
    function removeUrlParameter(url, parameter) {
        var value = url.match(new RegExp('(\\?|&)' + parameter + '{1}\\={1}(.*?[^(&|#)]*)'));
        if (value) {
            if (~value[0].indexOf('?') && ~url.indexOf('&')) {
                return url.replace(value[0] + '&', '?');
            } else {
                return url.replace(value[0], '');
            }
        } else {
            return url;
        }
    }
    _.extend(Utils, {
        fixUrl: fixUrl,
        setUrlParameter: setUrlParameter,
        removeUrlParameter: removeUrlParameter
    });
    _.mixin(Utils);
    return _.extend(UrlHelper, {
        mountToApp: function (Application) {
            var self = this;
            Application.getLayout().on('afterAppendView', function () {
                // Every time afterAppendView is called, we set the url to the helper
                self.setUrl(window.location.href);
            });
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module Item

Item related models, like Item.Model, override its get() method to support high level item semantics defined here.
For example, attributes like '_url', '_name', '_images' are calculated taking into account matrix options, item type, etc.

Since this holds the mapping definition of whats returned by the search api / Commerce api for items and this semantics
is used across all the applications it is a good place to extenders to add its own high level item semantics or even
override existing ones.

For example, people may want to set that the name of the items are store in a custom item field instead of the display name field,
then you just change the mapping here instead of looking for that attribute in all templates and js files.

*/
define('Item.KeyMapping', [
    'underscore',
    'Utils',
    'UrlHelper'
], function (_, Utils) {
    'use strict';
    function getKeyMapping(configuration) {
        /*
		@class ItemsKeyMapping can be used by Backbone Model to add high level semantic attributes defined here.
		For example, @?class Item.Model override its get() method to support these attributes. So for example
		item.get('_name') will return the _name semantics in property defined here.

		If the property value is a string then that attribute will be used. If the value is a function, then the
		function is evaluated passing the item model as first argument.
		*/
        return {
            // @property {String} _id Item Internal Id: used as a fallback to the URL and to add to cart
            // You should not need to change this tho
            _id: 'internalid'    // @property {String} _sku Item SKU number
,
            _sku: function (item) {
                return item.get('itemid') || '';
            }    // @property {String} _name Name of the item, some times displayname is empty but storedisplayname2 tends to be set always
,
            _name: function (item) {
                // If its a matrix child it will use the name of the parent
                var item_id = item.get('itemid') || '';
                var parent = item.get('_matrixParent');
                if (parent.get('internalid')) {
                    //we need the displayname included in the itemdid, see #B-11868
                    var matches = item_id.match(/:(.*)/);
                    var child_name = matches && matches[1];
                    return child_name || parent.get('storedisplayname2') || parent.get('displayname') || item_id;
                }
                // Otherwise return its own name
                return item.get('storedisplayname2') || item.get('displayname') || item_id;
            }    // @property {String} _pageTitle Page Title of the PDP
,
            _pageTitle: [
                'pagetitle',
                'storedisplayname2',
                'displayname'
            ]    // @property {String}  _pageHeader h1 of the PDP and also the title of the modal
,
            _pageHeader: [
                'storedisplayname2',
                'displayname'
            ]    // @property {String}  _keywords
,
            _keywords: 'searchkeywords'    // @property {String} _metaTags
,
            _metaTags: 'metataghtml'    // @method _breadcrumb This returns the breadcrum json obj for the PDP
                             // @property {Item.Model} item Model of a specific item
                             // @return {Array<Object>} breadcrumb An array of objects containing breadcrumb info
,
            _breadcrumb: function (item) {
                var breadcrumb = [], commercecategory = item.get('commercecategory');
                if (commercecategory && commercecategory.primarypath && commercecategory.primarypath.length) {
                    var primarypath = _.sortBy(commercecategory.primarypath, function (path) {
                        return path.urls[0];
                    });
                    _.each(primarypath, function (path) {
                        breadcrumb.push({
                            href: path.urls[0],
                            text: path.name
                        });
                    });
                }
                breadcrumb.push({
                    href: item.get('_url'),
                    text: item.get('_name')
                });
                return breadcrumb;
            }    // @property {String} _url Url of the item
,
            _url: function (item) {
                var matrixParent = item.get('_matrixParent');
                // If this item is a child of a matrix return the URL of the parent
                if (!_.isEmpty(matrixParent) && matrixParent.get('internalid')) {
                    return item.get('_matrixParent').get('_url');
                }    // if its a standard version we need to send it to the canonical URL
                else if (SC.ENVIRONMENT.siteType && SC.ENVIRONMENT.siteType === 'STANDARD') {
                    return item.get('canonicalurl');
                }
                // Other ways it will use the URL component or a default /product/ID
                return item.get('urlcomponent') ? '/' + item.get('urlcomponent') : '/product/' + item.get('internalid');
            }    // @property {String} _thumbnail Object containing the url and the altimagetext of the thumbnail
,
            _thumbnail: function (item) {
                var item_images_detail = item.get('itemimages_detail') || {};
                // If you generate a thumbnail position in the itemimages_detail it will be used
                if (item_images_detail.thumbnail) {
                    if (_.isArray(item_images_detail.thumbnail.urls) && item_images_detail.thumbnail.urls.length) {
                        return item_images_detail.thumbnail.urls[0];
                    }
                    return item_images_detail.thumbnail;
                }
                // otherwise it will try to use the storedisplaythumbnail
                if (SC.ENVIRONMENT.siteType && SC.ENVIRONMENT.siteType === 'STANDARD' && item.get('storedisplaythumbnail')) {
                    return {
                        url: item.get('storedisplaythumbnail'),
                        altimagetext: item.get('_name')
                    };
                }
                // No images huh? carry on
                var parent_item = item.get('_matrixParent');
                // If the item is a matrix child, it will return the thumbnail of the parent
                if (parent_item && parent_item.get('internalid')) {
                    return parent_item.get('_thumbnail');
                }
                var images = Utils.imageFlatten(item_images_detail);
                // If you using the advance images features it will grab the 1st one
                if (images.length) {
                    return images[0];
                }
                // still nothing? image the not available
                return {
                    url: Utils.getThemeAbsoluteUrlOfNonManagedResources('img/no_image_available.jpeg', configuration.get('imageNotAvailable')),
                    altimagetext: item.get('_name')
                };
            }    // @property {Array} _images Array of objects containing the URL and the altimagetext of the images of the item
,
            _images: function (item) {
                var result = [], item_images_detail = item.get('itemimages_detail') || {};
                item_images_detail = item_images_detail.media || item_images_detail;
                result = Utils.imageFlatten(item_images_detail);
                return result.length ? result : [{
                        url: Utils.getThemeAbsoluteUrlOfNonManagedResources('img/no_image_available.jpeg', configuration.get('imageNotAvailable')),
                        altimagetext: item.get('_name')
                    }];
            }    // @property _matrixParent For matrix child items in the cart we generate this position so we have a link to the parent
,
            _matrixParent: 'matrix_parent'    // @property _matrixChilds For matrix parent items, where are the attributes of the children
,
            _matrixChilds: 'matrixchilditems_detail'    // @property  _optionsDetailsThe definition of the options of items with options
,
            _optionsDetails: 'itemoptions_detail'    // @property _relatedItems Related items
,
            _relatedItems: 'related_items'    // @property _relatedItemsDetail _relatedItemsDetail Related items in the PDP.
,
            _relatedItemsDetail: 'relateditems_detail'    // @property _correlatedItemsDetail Correlated (Up-sell) items in the PDP.
,
            _correlatedItemsDetail: 'correlateditems_detail'    // @property _priceDetails Item price information. This property returned by the Search API defines the type class OnlineCustomerPriceDetail
                                        //@class OnlineCustomerPriceDetail
                                        //@property {Number} onlinecustomerprice This is the default price of the item. IMPORTANT: This value take into account the item already present in the cart.
                                        //So if you have defined quantity pricing, this property wont show the price for quantity 1 but rather for the quantity already present in the cart. (Tested for NO matrix item)
                                        //@property {String} onlinecustomerprice_formatted This property shows the value of the property onlinecustomerprice formatted with the current currency
                                        //@property {Array<OnlineCustomerPriceDetail.PriceSchedule>?} priceschedule List of prices present when the item has quantity prices configured.
                                        //@class OnlineCustomerPriceDetail.PriceSchedule Class that indicate for a quantity range the price of an item
                                        //@property {Number} maximumquantity Maximum quantity inside of the current range
                                        //@property {Number} minimumquantity Minimum quantity inside of the current range
                                        //@property {Number} price Price corresponding to the item when the specified quantity is in the range specified for the current class
                                        //@property {String} @property {Number} price Price property formatted based on the current currency
                                        //@class ItemsKeyMapping
,
            _priceDetails: 'onlinecustomerprice_detail'    // @property {String} _price
,
            _price: function (item) {
                return item.get('onlinecustomerprice_detail') && item.get('onlinecustomerprice_detail').onlinecustomerprice || '';
            }    // @property {String} _price_formatted
,
            _price_formatted: function (item) {
                return item.get('onlinecustomerprice_detail') && item.get('onlinecustomerprice_detail').onlinecustomerprice_formatted || '';
            }    // @property {Number} _comparePriceAgainst Returns the default price of the passed in item assuming quantity minimum quantity. This method check if quantity pricing is configured.
,
            _comparePriceAgainst: function (item) {
                //var prices = item.get('_priceDetails');
                var prices = item.get('pricelevel10');
                if (prices) {
                    //The priceschedule is the array containing the quantity range and the price
                    if (prices.priceschedule) {
                        //The index 0 will be the case when the quantity is greater than 0 and lower than prices.priceschedule[0].maximumquantity
                        //return prices.priceschedule[0].price;
                        return item.get('pricelevel10');
                    } else {
                        //return prices.onlinecustomerprice;
                        return item.get('pricelevel10');
                    }
                } else {
                    //This is the default price, equivalent to onlinecustomerprice but without taking into account the amount of items into the cart
                    //This value returns the 'Base Price'
                    //return item.get('pricelevel1');
                    return item.get('pricelevel10');
                }
            }    // @property {String} _comparePriceAgainstFormated This method a formatted version of the method _comparePriceAgainst
,
            _comparePriceAgainstFormated: function (item) {
                //var prices = item.get('_priceDetails');
                var prices = item.get('pricelevel10_formatted');
                if (prices) {
                    if (prices.priceschedule) {
                        //return prices.priceschedule[0].price_formatted;
                        return item.get('pricelevel10_formatted');
                    } else {
                        //return prices.onlinecustomerprice_formatted;
                        return item.get('pricelevel10_formatted');
                    }
                } else {
                    //return item.get('pricelevel1_formatted');
                    return item.get('pricelevel10_formatted');
                }
            }    // @property _itemType Item Type
,
            _itemType: 'itemtype'    // @property {Number} _stock The number of items you have available
,
            _stock: 'quantityavailable'    // @property {Number} _minimumQuantity
,
            _minimumQuantity: function (item) {
                return item.get('minimumquantity') || 1;
            }    // @property {Number} _maximumQuantity
,
            _maximumQuantity: function (item) {
                return item.get('maximumquantity');
            }    // @property {Boolean} _isReturnable
,
            _isReturnable: function (item) {
                var type = item.get('itemtype');
                return type === 'InvtPart' || type === 'NonInvtPart' || type === 'Kit';
            }    // @property {Boolean} _isInStock
,
            _isInStock: 'isinstock'    // @property {Boolean} _isPurchasable
,
            _isPurchasable: 'ispurchasable'    // @property {Boolean} _isBackorderable
,
            _isBackorderable: 'isbackorderable'    // @property {Boolean} _showOutOfStockMessage
,
            _showOutOfStockMessage: 'showoutofstockmessage'    // @property {Boolean} _isfulfillable
,
            _isfulfillable: function (item) {
                return item.get('isfulfillable') !== false;
            }    // @property {Boolean} _showInStockMessage Show the IN STOCK label, this can be configured in a per item basis
,
            _showInStockMessage: function () {
                return false;
            }    // @property {Boolean} _showQuantityAvailable Show the quantity available for this item.
,
            _showQuantityAvailable: function () {
                return true;
            }    // @property {Boolean} _showStockDescription Should we show the stock description?
,
            _showStockDescription: function () {
                return true;
            }    // @property {String} _stockDescription Stock Description, some times used to display messages like New Arrival, Ships in 3 days or Refubrished
,
            _stockDescription: 'stockdescription'    // @property {String} _stockDescriptionClass Stock Description class, we use this to add a class to the HTML element containing the _stockDescription so you can easily style it.
                                  // This implementation will strip spaces and other punctuations from the _stockDescription and prepends stock-description-
                                  // so if your _stockDescription is 'Ships in 3 days' your _stockDescriptionClass will be stock-description-ships-in-3-days
,
            _stockDescriptionClass: function (item) {
                return 'stock-description-' + (item.get('_stockDescription') || '').toLowerCase().replace(/[\W\"]+/g, '-').replace(/\-+/g, '-');
            }    // @property {String} _outOfStockMessage What to write when the item is out of stock
,
            _outOfStockMessage: function (item) {
                return item.get('outofstockmessage2') || item.get('outofstockmessage');
            }    // @property {String} _inStockMessage What to write when the item is in stock
,
            _inStockMessage: function () {
                return _('In Stock').translate();
            }    // Reviews related item attributes
                 // @property {Number} _rating Overall item rating
,
            _rating: function (item) {
                return Math.round(item.get('custitem_ns_pr_rating') * 10) / 10 || 0;
            }    // @property {Number} _ratingsCount How many times this item was reviewed
,
            _ratingsCount: function (item) {
                return item.get('custitem_ns_pr_count') || 0;
            }    // @property {Array<String>} _attributesToRateOn What are the possible attributes I want this item to be rated on
,
            _attributesToRateOn: function (item) {
                var attributes = item.get('custitem_ns_pr_item_attributes') || '';
                return _.reject(attributes.split(', '), function (attribute) {
                    return !attribute || attribute === '&nbsp;';
                });
            }    // @property _attributesRating returns a object containing the average rating per attribute
,
            _attributesRating: function (item) {
                return item.get('custitem_ns_pr_attributes_rating') && JSON.parse(item.get('custitem_ns_pr_attributes_rating')) || {};
            }    // @property _ratingsCountsByRate returns an object containing how many reviews it the item has for each particular rating
,
            _ratingsCountsByRate: function (item) {
                return item.get('custitem_ns_pr_rating_by_rate') && JSON.parse(item.get('custitem_ns_pr_rating_by_rate')) || {};
            }    // @property {Boolean} _isstorepickupallowed
,
            _isstorepickupallowed: 'isstorepickupallowed'    // @property {Object} _quantityavailableforstorepickup_detail returns an object with stock information per location.
,
            _quantityavailableforstorepickup_detail: function (item) {
                return item.get('quantityavailableforstorepickup_detail') && item.get('quantityavailableforstorepickup_detail').locations || [];
            }
        };
    }
    return { getKeyMapping: getKeyMapping };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module ProductLine
define('ProductLine.Option.Model', ['Backbone'], function (Backbone) {
    'use strict';
    //@class ProductLine.Option.Model Base model class used to manage the common parts of Product, Item and Transaction.Line options
    //@extend Backbone.Model
    return Backbone.Model.extend({
        //@method toJSON Override default method to send just the require data to the back-end
        //@return {ProductLine.Option.Model.JSON}
        toJSON: function toJSON() {
            //@class ProductLine.Option.Model.JSON
            return {
                //@property {String} cartOptionId
                cartOptionId: this.get('cartOptionId')    //@property {String} itemOptionId
,
                itemOptionId: this.get('itemOptionId')    //@property {String} label
,
                label: this.get('label')    //@property {String} type
,
                type: this.get('type')    //@property {ProductLine.Option.Value?} value
,
                value: this.get('value')
            };    //@class ProductLine.Option.Model
        }
    });
});    //@class ProductLine.Option.Value
       //@property {String} internalid
       //@property {String} value

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Item
define('Item.Option.Model', ['ProductLine.Option.Model'], function (ProductLineOptionModel) {
    'use strict';
    //@class Item.Option.Model @extend ProductLine.Option.Model
    return ProductLineOptionModel.extend({});
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module ProductLine
define('ProductLine.Option.Collection', [
    'ProductLine.Option.Model',
    'Backbone'
], function (ProductLineOptionModel, Backbone) {
    'use strict';
    //@class ProdctLine.Option.Collection Base collection class used to manage the common parts of Product, Item and Transaction.Line options
    //@extend Backbone.Collection
    return Backbone.Collection.extend({
        //@property {ProdctLine.Option.Model}
        model: ProductLineOptionModel
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Item
define('Item.Option.Collection', [
    'Item.Option.Model',
    'ProductLine.Option.Collection'
], function (ItemOptionModel, ProductLineOptionCollection) {
    'use strict';
    //@class Item.Option.Collection @extend ProductLine.Option.Collection
    return ProductLineOptionCollection.extend({
        //@property {Item.Option.Model} model
        model: ItemOptionModel
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Item
define('Item.Model', [
    'Backbone.CachedModel',
    'Session',
    'Item.KeyMapping',
    'Item.Option.Collection',
    'SC.Configuration',
    'Profile.Model',
    'underscore',
    'Utils'
], function (BackboneCachedModel, Session, ItemKeyMapping, ItemOptionCollection, Configuration, ProfileModel, _, Utils) {
    'use strict';
    var ItemCollection = null    // @class Item.Model Represents 1 single product of the web store
                // This model is enhanced with high level attributes defined in @class ItemKeyMapping
                // @extends Backbone.CachedModel
, ItemModel = BackboneCachedModel.extend({
            moduleName: 'Item.Model',
            constructor: function (attributes) {
                this.sanitize(attributes);
                BackboneCachedModel.apply(this, arguments);
            }    //@method url
                 //@return {String}
,
            url: function url() {
                var profile = ProfileModel.getInstance(), url = Utils.addParamsToUrl(profile.getSearchApiUrl(), _.extend({}, this.searchApiMasterOptions, Session.getSearchApiParams()), profile.isAvoidingDoubleRedirect());
                return url;
            }    //@method parse The API returns the items as an array always this takes care of returning the object
                 //@return {Item.Model.Model.Attributes}
,
            parse: function parse(response) {
                // if we are performing a direct API call the item is response.items[0]
                // but if you are using the Item.Collection to fetch this guys
                // The item is the response
                var single_item = response.items && response.items[0];
                if (single_item) {
                    single_item.facets = response.facets;
                }
                return single_item ? this.sanitize(single_item) : this.sanitize(response);
            },
            sanitize: function (attributes) {
                if (attributes && attributes.onlinecustomerprice_detail && attributes.onlinecustomerprice_detail.onlinecustomerprice === '') {
                    attributes.onlinecustomerprice_detail.onlinecustomerprice = null;
                }
                return attributes;
            }    //@method generateURL Returns the current URL. This method is just an alias over get('_url') to provide a unified interface with the Product.Model
                 //@return {String}
,
            generateURL: function generateURL() {
                return this.get('_url');
            }    //@method getFullLink Generates a String ready to be used to a link for a PDP. In difference to the method generateURL, getFullLink
                 //returns a string that contains the value of href, data-hashtag and data-touchpoint.
                 //output example: href="/Californium-Mtr" data-touchpoint="home" data-hashtag="#/Californium-Mtr"
                 //@return {Object}
,
            getFullLink: function getFullLink() {
                var url = this.generateURL(), link_attributes = { href: url };
                if (SC.ENVIRONMENT.siteSettings.sitetype === 'ADVANCED') {
                    _.extend(link_attributes, {
                        data: {
                            touchpoint: 'home',
                            hashtag: Configuration.get('currentTouchpoint') !== 'home' ? encodeURIComponent(url) : url
                        }
                    });
                }
                return Utils.objectToAtrributes(link_attributes);
            }    //@method initialize
                 //@return {Void}
,
            initialize: function initialize() {
                // Wires the config options to the URL of the model
                this.searchApiMasterOptions = Configuration.get('searchApiMasterOptions.itemDetails', {});
                this.itemOptionsConfig = Configuration.get('ItemOptions.optionsConfiguration', []);
                var self = this;
                this.set('options', this.getPosibleOptions(), { silent: true });
                this.on('change:itemoptions_detail', function () {
                    self.set('options', self.getPosibleOptions(), { silent: true });
                }, this);
            },
            deepCopy: function deepCopy() {
                var self = this, obj = this.attributes || {}, item_key_mapping = this.getKeyMapping(Configuration);
                _.each(item_key_mapping, function (value, attr) {
                    if (attr.charAt(0) === '_') {
                        attr = 'keyMapping' + attr;
                    }
                    obj[attr] = _.isFunction(value) ? value(self) : value;
                });
                return obj;
            }    // @method getPosibleOptions
                 // @returns {Item.Options.Collection} an array of all the possible options with values and information
,
            getPosibleOptions: function getPosibleOptions() {
                if (this.cachedPosibleOptions) {
                    return this.cachedPosibleOptions;
                }
                var result = new ItemOptionCollection();
                if (this.get('_optionsDetails') && this.get('_optionsDetails').fields) {
                    var self = this    // Prepares a simple map of the configuration
, options_config_map = {};
                    _.each(this.itemOptionsConfig, function (option) {
                        if (option.cartOptionId) {
                            options_config_map[option.cartOptionId] = option;
                        }
                    });
                    // if you are an child in the cart it then checks for the options of the parent
                    var fields = this.get('_matrixParent').get('_id') ? this.get('_matrixParent').get('_optionsDetails').fields : this.get('_optionsDetails').fields;
                    // Walks the _optionsDetails to generate a standard options response.
                    _.each(fields, function (option_details) {
                        //@class Item.Model.Option.Value
                        //@property {String} internalid
                        //@property {String} label
                        //@property {String} url The url of the option to navigate to the PDP with that option selected by default
                        //@class Item.Model.Option
                        var option = {
                            //@property {String} label Visible option name
                            label: option_details.label,
                            values: option_details.values,
                            type: option_details.type,
                            cartOptionId: option_details.internalid,
                            itemOptionId: option_details.sourcefrom || ''    //@property {Boolean} isMatrixDimension
,
                            isMatrixDimension: !!option_details.ismatrixdimension || false    //@property {Boolean} isMandatory Indicate if the options is required or not
,
                            isMandatory: !!option_details.ismandatory || false    //@property {String} urlParameterName Parameter used to generate the url of this options. For example size instead or custcol12 in www.yourdomain.com/item?size=12&custcol12=3
,
                            urlParameterName: option_details.internalid,
                            useLabelsOnUrl: false    //@property {Number} index Property used to sort options. 10 by default
,
                            index: 10
                        };
                        // Makes sure all options are availabe by defualt
                        _.each(option.values, function (value) {
                            value.isAvailable = true;
                        });
                        // Merges this with the configuration object
                        if (options_config_map[option.cartOptionId]) {
                            option = _.extend(option, options_config_map[option.cartOptionId]);
                        }
                        option.values = _.map(option.values, function (value) {
                            value.url = Utils.setUrlParameter(self.get('_url'), option.urlParameterName, option.useLabelsOnUrl ? value.label : value.internalid);
                            return value;
                        });
                        if (option_details.ismatrixdimension && self.get('_matrixChilds').length) {
                            var item_values = self.get('_matrixChilds').pluck(option.itemOptionId);
                            option.values = _.filter(option.values, function (value) {
                                if (value.internalid) {
                                    return _.contains(item_values, value.label);
                                }
                                return true;
                            });
                        }
                        result.add(option);
                    });
                    // Since this is not going to change in the life of the model we can cache it
                    this.cachedPosibleOptions = result;
                }
                return result;
            }    // @method isProperlyConfigured Check in case the item has options all options have a itemOptionId property and in the item is matrix
                 // check there are child matrix items
                 // @returns {Boolean} true If the current item is properly configured
,
            isProperlyConfigured: function isProperlyConfigured() {
                var options = this.getPosibleOptions(), option = null;
                if (options && options.length) {
                    for (var i = 0; i < options.length; i++) {
                        option = options.at(i);
                        if (option.get('isMatrixDimension') && !option.get('itemOptionId')) {
                            return false;
                        }
                    }
                }    // If you omit item options from the field set and use matrix, that's an issue.
                else if (this.get('_matrixChilds') && this.get('_matrixChilds').length) {
                    return false;
                }
                return true;
            }    // @method getKeyMapping
                 // @return {ItemsKeyMapping}
,
            getKeyMapping: function getKeyMapping() {
                if (!this._keyMapping) {
                    this._keyMapping = _.defaults(Configuration.itemKeyMapping || {}, ItemKeyMapping.getKeyMapping(Configuration));
                }
                return this._keyMapping;
            }    // @method get We have override the get function for this model in order to honor the ItemKeyMapping
                 // It also makes sure that _matrixChilds and _relatedItems are Item.Collection and _matrixParent is an Item.Model
                 // @param {String} attr
                 // @param {Boolean} dont_cache if true it won't return the cached attribute value.
,
            get: function get(attr, dont_cache) {
                var keyMapping = this.getKeyMapping();
                // var keyMapping = this.keyMapping || (this.collection && this.collection.keyMapping); // TODO: Dev Tools migration concern...
                if (dont_cache || keyMapping && !this.attributes[attr] && keyMapping[attr]) {
                    var mapped_key = keyMapping[attr];
                    if (_.isFunction(mapped_key)) {
                        this.attributes[attr] = mapped_key(this);
                    } else if (_.isArray(mapped_key)) {
                        // then the value is get(arr[0]) || get(arr[1]) || ...
                        for (var i = 0; i < mapped_key.length; i++) {
                            if (this.attributes[mapped_key[i]]) {
                                this.attributes[attr] = this.attributes[mapped_key[i]];
                                break;
                            }
                        }
                    } else {
                        this.attributes[attr] = this.attributes[mapped_key];
                    }
                    if (attr === '_matrixChilds' || attr === '_relatedItems') {
                        ItemCollection = ItemCollection || Utils.requireModules('Item.Collection');
                        if (!(this.attributes[attr] instanceof ItemCollection)) {
                            this.attributes[attr] = new ItemCollection(this.attributes[attr] || []);
                        }
                    } else if (attr === '_matrixParent') {
                        if (!(this.attributes[attr] instanceof ItemModel)) {
                            this.attributes[attr] = new ItemModel(this.attributes[attr] || {});
                        }
                    }
                }
                return this.attributes[attr];
            }    // @method  getDefaultPrice Given the price details of an item (class OnlineCustomerPriceDetail) returns the default onlinecustomerprice_formatted and onlinecustomerprice
                 // @param {OnlineCustomerPriceDetail} details_object
                 // @return {ItemPrice}
,
            getDefaultPrice: function getDefaultPrice(details_object) {
                //@class ItemPrice
                return {
                    //@property {Number} price
                    price: details_object.onlinecustomerprice,
                    price_formatted: details_object.onlinecustomerprice_formatted
                };    //@class Item.Model
            }    //IMPORTANT: The following method are shared with Product.Model, allowing to use Products or Items interchangeably
                 //If you edit them, please consider reflect the same changes in the Product.Model and potentially in the
                 //Transaction.Line.Model
                 // @method getPrice Gets the price based on the selection of the item and the quantity
                 // @param {Number} quantity
                 // @param {Array<Item.Model>?} selected_matrix_children
                 // @return {ItemPrice}
,
            getPrice: function getPrice(quantity, selected_matrix_children) {
                selected_matrix_children = selected_matrix_children || (this.get('_matrixChilds') ? this.get('_matrixChilds').models : []);
                quantity = quantity || 1;
                var details_object = this.get('_priceDetails') || {}, result = this.getDefaultPrice(details_object);
                // Computes Quantity pricing based on the quantity specified as parameter
                if (details_object.priceschedule && details_object.priceschedule.length) {
                    var price_schedule, min, max;
                    for (var i = 0; i < details_object.priceschedule.length; i++) {
                        price_schedule = details_object.priceschedule[i];
                        min = parseInt(price_schedule.minimumquantity, 10);
                        max = parseInt(price_schedule.maximumquantity, 10);
                        if (min <= quantity && quantity < max || min <= quantity && !max) {
                            result = {
                                price: price_schedule.price,
                                price_formatted: price_schedule.price_formatted
                            };
                        }
                    }
                }
                // if it's a matrix it will compute the matrix price
                if (selected_matrix_children.length) {
                    // Gets the price of each child
                    var children_prices = [];
                    _.each(selected_matrix_children, function (child) {
                        children_prices.push(child.getPrice(quantity));
                    });
                    if (children_prices.length === 1) {
                        // If there is only one it means there is only one price to show
                        result = children_prices[0];
                    } else {
                        // otherwise we should compute max and min to show a range in the GUI
                        var children_prices_values = _.pluck(children_prices, 'price'), min_value = _.min(children_prices_values)    //Minimum price from all children items
, max_value = _.max(children_prices_values);
                        //Maximum price from all children items
                        if (min_value !== max_value) {
                            // We return them alongside the result of the parent
                            //@class ItemPrice
                            //@property {Number?} min This value will be present only in the case the current item is Matrix, has a partial selection and its children have different range
                            //of prices. When this property is present will contain the minimum price of all the children items valid to be selected.
                            result.min = _.where(children_prices, { price: min_value })[0];
                            //@property {Number?} max This value will be present only in the case the current item is Matrix, has a partial selection and its children have different range
                            //of prices. When this property is present will contain the maximum price of all the children items valid to be selected.
                            result.max = _.where(children_prices, { price: max_value })[0];    //@class Item.Model
                        } else {
                            // they are all alike so we can show any of them
                            result = children_prices[0];
                        }
                    }
                }
                // Adds the compare against price if its not set by one of the children
                if (!result.compare_price && this.get('_comparePriceAgainst')) {
                    //@class ItemPrice
                    //@property {Number} compare_price
                    result.compare_price = this.get('_comparePriceAgainst');
                    //@property {String} compare_price_formatted
                    result.compare_price_formatted = this.get('_comparePriceAgainstFormated');    //@class Item.Model
                }
                return result;
            }    //@method getThumbnail Gets the thumbnail. This method acts as an alias for get('_thumbnail') which allows to use
                 //Item.Model in places where Product.Model or Transaction.Line.Model is expected
                 //@return {ImageContainer}
,
            getThumbnail: function getThumbnail() {
                return this.get('_thumbnail');
            }    //@method getSku Returns the sky of the current item. This method exist to complain with the Product.Model interface
                 //@return {String}
,
            getSku: function getSku() {
                return this.get('_sku');
            }    //@method getImages Returns the list of the item images
                 //@return {Array<ImageContainer>}
,
            getImages: function getImages() {
                var result = [], item_images_detail = this.get('itemimages_detail') || {};
                item_images_detail = item_images_detail.media || item_images_detail;
                result = Utils.imageFlatten(item_images_detail);
                //@class ImageContainer
                return result.length ? result : [{
                        //@property {String} url
                        url: Utils.getThemeAbsoluteUrlOfNonManagedResources('img/no_image_available.jpeg', Configuration.get('imageNotAvailable'))    //@property {String} altimagetext
,
                        altimagetext: this.get('_name')
                    }];    //@class Item.Model
            }    // @method getOption
                 // Returns an item option
                 // @param {String} cart_option_id
                 // @return {Item.Option.Model}
,
            getOption: function getOption(cart_option_id) {
                return this.get('options').findWhere({ cartOptionId: cart_option_id });
            }    // @method getStockInfo
                 // Returns an standard formated object for the stock info taking in consideration current matrix option selection.
                 // the login is the following: if there is an unique child selected use that. Else use the parent as default
                 // values and open children properties if it has the same value for all selected children.
                 // @param {Array<Item.Model>} selected_matrix_children
                 // @param {OptionHelper.MatrixSelection} options_selection
                 // @return {Item.StockInfo} the stock information of the current item
,
            getStockInfo: function getStockInfo(selected_matrix_children, options_selection) {
                options_selection = options_selection || {};
                // Standardize the result object
                selected_matrix_children = selected_matrix_children || [];
                // if we have one selected child we use that - else we use the parent as default
                var model = selected_matrix_children.length === 1 ? selected_matrix_children[0] : this, parent = this.get('_matrixParent')    //@class Item.StockInfo
, stock_info = {
                        //@property {Object}stock
                        stock: model.get('_stock')    //@property {Boolean} isInStock
,
                        isInStock: model.get('_isInStock')    //@property {String} outOfStockMessage
,
                        outOfStockMessage: model.get('_outOfStockMessage') || this.get('_outOfStockMessage') || parent && parent.get('_outOfStockMessage') || _('Out of Stock').translate()    //@property {Boolean} showOutOfStockMessage
,
                        showOutOfStockMessage: model.get('_showOutOfStockMessage') || this.get('_showOutOfStockMessage')    //@property {String} inStockMessage
,
                        inStockMessage: model.get('_inStockMessage')    //@property {Boolean} showInStockMessage
,
                        showInStockMessage: model.get('_showInStockMessage')    //@property {String} stockDescription
,
                        stockDescription: model.get('_stockDescription') || this.get('_stockDescription')    //@property {Boolean} showStockDescription
,
                        showStockDescription: model.get('_showStockDescription')    //@property {String} stockDescriptionClass
,
                        stockDescriptionClass: model.get('_stockDescriptionClass')    //@property {Boolean} isNotAvailableInStore Indicate if the item is present in the store (returned by the store item and the search API)
,
                        isNotAvailableInStore: _.isUndefined(model.get('_isPurchasable'))    //@property {Object} stockPerLocation
,
                        stockPerLocation: model.get('_quantityavailableforstorepickup_detail')    //@propery {Boolean} isAvailableForPickUp
,
                        isAvailableForPickup: !!model.get('_isstorepickupallowed')    //@propery {Boolean} showQuantityAvailable
,
                        showQuantityAvailable: !!model.get('_showQuantityAvailable')
                    }    //@class Item.Model
, is_something_selected = _(options_selection).keys().length;
                // if this is an open selection we compute them all
                if (is_something_selected && selected_matrix_children.length > 1) {
                    var matrix_children_stock_info = [];
                    _.each(selected_matrix_children, function (child) {
                        matrix_children_stock_info.push(child.getStockInfo());
                    });
                    // If all matrix children return the same value for a given attribute that becomes the output,
                    // with the exception of stock that is an addition of the stocks of the children - but only if the parent has
                    _.each(stock_info, function (value, key) {
                        var children_values_for_attribute = _.pluck(matrix_children_stock_info, key);
                        if (key === 'stock') {
                            stock_info.stock = _.reduce(children_values_for_attribute, function (memo, num) {
                                return memo + num;
                            }, 0);
                            if (isNaN(stock_info.stock)) {
                                delete stock_info.stock;
                            }
                        } else if (key === 'isInStock') {
                            // the parent is in stock if any of the child items is in stock
                            // so, if in the array of the values of 'isInStock' for the childs
                            // there is a 'true', then the parent item is in stock
                            stock_info.isInStock = _.contains(children_values_for_attribute, true);
                        } else {
                            children_values_for_attribute = _.uniq(children_values_for_attribute);
                            if (children_values_for_attribute.length === 1) {
                                stock_info[key] = children_values_for_attribute[0];
                            }
                        }
                    });
                }
                return stock_info;
            }
        });
    return ItemModel;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Transaction
define('Transaction.Line.Option.Model', ['ProductLine.Option.Model'], function (ProductLineOptionModel) {
    'use strict';
    //@class Transaction.Line.Option.Model @extend ProductLine.Option.Model
    return ProductLineOptionModel.extend({});
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Transaction
define('Transaction.Line.Option.Collection', [
    'Transaction.Line.Option.Model',
    'ProductLine.Option.Collection'
], function (TransactionLineOptionModel, ProductLineOptionCollection) {
    'use strict';
    //@class Transaction.Line.Option.Collection @extend ProductLine.Option.Collection
    return ProductLineOptionCollection.extend({
        //@property {Transaction.Line.Model} model
        model: TransactionLineOptionModel
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductLine
define('ProductLine.Common.Url', [
    'underscore',
    'Utils',
    'PluginContainer',
    'SC.Configuration'
], function (_, utils, PluginContainer, Configuration) {
    'use strict';
    // @class ProductLine.Common.Url
    var ProductLineCommonUrl = {
        //@property {Array<String>} attributesReflectedInURL
        attributesReflectedInURL: [
            'options',
            'quantity'
        ],
        preURLGenerated: new PluginContainer(),
        preItemSetFromURL: new PluginContainer()    //@method getQuery Generates a string query with all the parameters of the current line set
                                 //@param {Dictionary<String, String?>} parameters_to_override Object where each key indicate a parameter value to override or null if the parameter want to be removed
                                 //@return {String}
,
        getQuery: function getQuery(parameters_to_override) {
            var query = '', line_model = this, attributes_to_map_in_url = _.filter(_.keys(line_model.attributes), function (attribute) {
                    return !!~_.indexOf(ProductLineCommonUrl.attributesReflectedInURL, attribute);
                }), all_parameters = _.map(attributes_to_map_in_url, function (attribute) {
                    //@class Product.Model.URLParameter
                    return {
                        //@param {String} param
                        param: attribute    //@param {String} value
,
                        value: line_model.get(attribute)
                    };    //@class Product.Model
                });
            all_parameters = this.mapOptionsToURLParameters(all_parameters);
            all_parameters = ProductLineCommonUrl.preURLGenerated.executeAll(all_parameters, this) || all_parameters;
            _.each(parameters_to_override || {}, function (value, parameter) {
                var selected_parameter = _.findWhere(all_parameters, { param: parameter });
                if (selected_parameter) {
                    if (_.isNull(value)) {
                        //Remove parameter
                        all_parameters.splice(_.indexOf(all_parameters, selected_parameter), 1);
                    } else {
                        //Override value
                        selected_parameter.value = value;
                    }
                } else if (!_.isNull(value)) {
                    //New extra value
                    all_parameters.push({
                        param: parameter,
                        value: value
                    });
                }
            });
            var params_to_set = _.filter(all_parameters, _.property('value'));
            query = _.reduce(params_to_set, function (memo_url, option) {
                return utils.setUrlParameter(memo_url, option.param, encodeURIComponent(option.value));
            }, query);
            return query;
        }    //@method generateURL Generates a string URL to a PDP with all the parameters of the current line set
             //@param {Dictionary<String, String?>} parameters_to_override Object where each key indicate a parameter value to override or null if the parameter want to be removed
             //@return {String}
,
        generateURL: function generateURL(parameters_to_override) {
            return this.get('item').get('_url') + this.getQuery(parameters_to_override);
        }    //@method mapOptionsToURLParameters This method make the invert behavior as the method mapURLParametersToOptions.
             //It is called when a URL for the current line is required and based on the current configuration and the options set it generate a list
             //of parameters values that will be reduced into the URL string by the method generateURL
             //@param {Array<Product.Model.URLParameter>} all_parameters
             //@return {Array<Product.Model.URLParameter>}
,
        mapOptionsToURLParameters: function mapOptionsToURLParameters(all_parameters) {
            var options_parameter = _.findWhere(all_parameters, { param: 'options' });
            if (options_parameter) {
                all_parameters.splice(_.indexOf(all_parameters, options_parameter), 1);
                this.get('options').each(function (option) {
                    if (option.get('value')) {
                        all_parameters.push({
                            param: option.get('urlParameterName'),
                            value: option.get('useLabelsOnUrl') ? option.get('value').label : option.get('value').internalid
                        });
                    }
                });
            }
            return all_parameters;
        }    //@method getFullLink Generates a String ready to be used to a link for a PDP. In difference to the method generateURL, getFullLink
             //returns a string that contains the value of href, data-hashtag and data-touchpoint.
             //output example: href="/Californium-Mtr?internalid=910_1&amp;quantity=2" data-touchpoint="home" data-hashtag="#/Californium-Mtr?internalid=910_1&amp;quantity=2"
             //@param {Dictionary<String, String?>} parameters_to_override Object where each key indicate a parameter value to override or null if the parameter want to be removed
             //@return {Object}
,
        getFullLink: function getFullLink(parameters_to_override) {
            var url = this.generateURL(parameters_to_override), link_attributes = { href: url };
            if (SC.ENVIRONMENT.siteSettings.sitetype === 'ADVANCED') {
                _.extend(link_attributes, {
                    data: {
                        touchpoint: 'home',
                        hashtag: Configuration.get('currentTouchpoint') !== 'home' ? encodeURIComponent(url) : url
                    }
                });
            }
            return utils.objectToAtrributes(link_attributes);
        }    // @method setOptionsFromURL Given a URL query string, it sets the options in the model
             // @param {ParameterOptions} options
             // @return {Void}
,
        setOptionsFromURL: function setOptionsFromURL(options) {
            var self = this;
            options = options || {};
            options = this.mapURLParametersToOptions(options);
            options.quantity && (options.quantity = parseInt(options.quantity, 10));
            options = ProductLineCommonUrl.preItemSetFromURL.executeAll(options, self) || options;
            _.each(options, function (value, name) {
                if (value && !!~_.indexOf(ProductLineCommonUrl.attributesReflectedInURL, name)) {
                    self.set(name, value);
                }
            });
        }    //@method mapURLParametersToOptions Map parameters from URL to its real/internal value. This is needed as based on the configuration
             //it is possible to show in the URL the label of the options and the string of the selected value instead of the internal id.
             //Something like: /item-name?color=red or /item-name?custcol3=2 are both valid urls depending on the configuration
             // @param {ParameterOptions} url_parameters
             // @return {ParameterOptions}
,
        mapURLParametersToOptions: function mapURLParametersToOptions(url_parameters) {
            var self = this;
            this.get('options').each(function (option) {
                if (url_parameters[option.get('urlParameterName')]) {
                    var aux_param_value = url_parameters[option.get('urlParameterName')], selected_option_value;
                    //Clean URL parameter based on URL option to change to option cartOptionId
                    delete url_parameters[option.get('urlParameterName')];
                    if (option.get('useLabelsOnUrl')) {
                        selected_option_value = _.findWhere(option.get('values'), { label: aux_param_value });
                        url_parameters[option.get('cartOptionId')] = selected_option_value ? selected_option_value.internalid : aux_param_value;
                    } else {
                        url_parameters[option.get('cartOptionId')] = aux_param_value;
                    }
                    self.setOption(option.get('cartOptionId'), url_parameters[option.get('cartOptionId')]);
                }
            });
            return url_parameters;
        }
    };
    return ProductLineCommonUrl;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module ProductLine
define('ProductLine.Common.Image', [
    'SC.Configuration',
    'underscore',
    'Utils'
], function (Configuration, _, Utils) {
    'use strict';
    //@class ProductLine.Common.Image
    return {
        //@method filterImages Given the tree-like object returned by the Search API containing the item's images and a group of options,
        // filters the item images
        // @param {Object} item_images_detail
        // @param {Array<String>} image_option_filters
        // @return {Object} The same input parameters filtered based on the current selection of the line/product taking into account the image option filters
        filterImages: function filterImages(item_images_detail, image_option_filters) {
            var self = this, images_container = item_images_detail, selected_option_filter;
            _.each(image_option_filters, function (image_filter) {
                selected_option_filter = self.get('options').findWhere({ cartOptionId: image_filter });
                //if the option/dimension has a value set
                if (selected_option_filter && selected_option_filter.get('value') && selected_option_filter.get('value').label) {
                    var label = selected_option_filter.get('value').label.toLowerCase();
                    _.each(images_container, function (value, key) {
                        if (key.toLowerCase() === label) {
                            images_container = value;
                        }
                    });
                }
            });
            return images_container;
        }    //@method getThumbnail Gets the thumbnail for the model based on the current selection
             //@return {ImageContainer}
,
        getThumbnail: function getThumbnail() {
            var item = this.get('item'), item_images_detail = item.get('itemimages_detail') || {}, image_filters = Configuration.get('productline.multiImageOption', []), images = [], images_container = {};
            if (_.isEqual(item_images_detail, {}) && item.get('_matrixParent').get('internalid') && item.get('_matrixParent').get('itemimages_detail')) {
                item_images_detail = item.get('_matrixParent').get('itemimages_detail');
            }
            // If you generate a thumbnail position in the itemimages_detail it will be used
            if (item_images_detail.thumbnail) {
                images_container = this.filterImages(item_images_detail.thumbnail, image_filters);
                images = Utils.imageFlatten(images_container);
                return _.first(images) || item_images_detail.thumbnail;
            } else if (SC.ENVIRONMENT.siteType === 'STANDARD') {
                return item.getThumbnail();
            } else {
                item_images_detail = item_images_detail.media || item_images_detail;
                images_container = this.filterImages(item_images_detail, image_filters);
                images = Utils.imageFlatten(images_container);
                return images.length ? // If you using the advance images features it will grab the 1st one
                _.first(images) : // still nothing? image the not available
                {
                    url: Utils.getThemeAbsoluteUrlOfNonManagedResources('img/no_image_available.jpeg', Configuration.get('imageNotAvailable')),
                    altimagetext: item.get('_name')
                };
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductLine
define('ProductLine.Common', [
    'ProductLine.Common.Url',
    'ProductLine.Common.Image',
    'SC.Configuration',
    'underscore'
], function (ProductLineCommonUrl, ProductLineCommonImage, Configuration, _) {
    'use strict';
    // @class ProductLine.Common
    var ProductLineCommon = {
        //@method getSku Gets the SKU for the current line or product based on the current item
        //@return {String}
        getSku: function getSku() {
            return this.getItem().getSku();
        }    // @method getOption
             // Returns an item option
             // @param {String} cart_option_id
             // @return {Item.Option.Model}
,
        getOption: function getOption(cart_option_id) {
            return this.get('options').findWhere({ cartOptionId: cart_option_id });
        }    //@method getVisibleOptions If the property ItemOptions.showOnlyTheListedOptions is true return only the
             //transactions item options and transaction column fields models configured in the property ItemOptions.optionsConfiguration,
             //otherwise return all of them. The array is going to be ordered by "index"
             //@return {Array<Product.Model|Transaction.Line.Model>}
,
        getVisibleOptions: function getVisibleOptions() {
            var collection;
            if (Configuration.get('ItemOptions.showOnlyTheListedOptions')) {
                collection = this.get('options').filter(function (option) {
                    return _.find(Configuration.get('ItemOptions.optionsConfiguration'), function (optionConfiguration) {
                        return optionConfiguration.cartOptionId === option.get('cartOptionId');
                    });
                });
            } else {
                collection = this.get('options').models;
            }
            return _.sortBy(collection, function (option) {
                return option.get('index');
            });
        }    //@method extendOptionsFromItem Extend the options in the product or line passed in based on the option from the item.
             //Notice that is the item who read from the configuration
             //@param {Item.Model} item
             //@param {Product.Model|Transaction.Line.Model} productline
             //@return {void}
,
        extendOptionsFromItem: function extendOptionsFromItem(item, productline) {
            // Here we make sure that the options collection of the line always
            // (event when the line is loaded from an already created transaction via SuiteScript) have all the properties
            item.get('options').each(function (item_option) {
                //IMPORTANT: The comparison here is done in lowercase because both the LiveOrder.Model and the Transaction.Model in
                // the back-end send their option in lower case. However the search API returns some option (Gift certificate ones) in
                // Uppercase and this case is require to be preserved so the Commerce API actually add the item into the cart.
                var item_option_cartId = item_option.get('cartOptionId').toLowerCase(), productline_option = productline.get('options').find(function (product_option) {
                        return product_option.get('cartOptionId').toLowerCase() === item_option_cartId;
                    });
                if (productline_option) {
                    productline_option.attributes = _.extend({}, productline_option.attributes, item_option.attributes);
                }
            });
        }    //@method toJSON Override default method to send only require data to the back-end
             //@return {Transaction.Line.Model.JSON}
,
        toJSON: function toJSON() {
            //@class Transaction.Line.Model.JSON Class used to send a transaction line representation to the back-end
            //without sending all the heavy weight JSON that is not totally needed by the back-end
            return {
                //@property {Transaction.Line.Model.JSON.Item} item
                //@class Transaction.Line.Model.JSON.Item
                item: {
                    //@property {String} internalid
                    internalid: this.getItemId()    //@property {String} type
,
                    type: this.attributes.item.get('itemtype')
                }    //@class Transaction.Line.Model.JSON
                     //@property {Number} quantity
,
                quantity: this.attributes.quantity,
                internalid: this.attributes.internalid,
                options: this.get('options').toJSON()    //@property {Number} shipaddress
,
                shipaddress: this.attributes.shipaddress,
                shipmethod: this.attributes.shipmethod,
                location: this.attributes.location && this.attributes.location.attributes && this.attributes.location.attributes.internalid || ''    //@property {Object} fulfillmentChoice
,
                fulfillmentChoice: this.attributes.fulfillmentChoice || 'ship'
            };    //@class Transaction.Line.Model
        }
    };
    return _.extend(ProductLineCommon, ProductLineCommonUrl, ProductLineCommonImage);
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Transaction
define('Transaction.Line.Model', [
    'Item.Model',
    'Transaction.Line.Option.Collection',
    'ProductLine.Common',
    'SC.Configuration',
    'underscore',
    'Backbone'
], function (ItemModel, TransactionLineOptionCollection, ProductLineCommon, Configuration, _, Backbone) {
    'use strict';
    // @class Transaction.Line.Model Model for showing information about a line in the order @extends Backbone.Model
    var TransactionLineModel = Backbone.Model.extend({
        //@method initialize Override default initialize method to assure the correct data structure
        //@param {Transaction.Model.Get.Line} attributes
        //@return {Void}
        initialize: function initialize(attributes) {
            Backbone.Model.prototype.initialize.apply(this, arguments);
            var self = this;
            this.on('change:item', function (model, item) {
                model.set('item', item instanceof ItemModel ? item.clone() : new ItemModel(item), { silent: true });
                var item_options = model.get('item').get('options'), options = model.get('options') || item_options.toJSON();
                model.set('options', options instanceof TransactionLineOptionCollection ? options : new TransactionLineOptionCollection(options), { silent: true });
                self.extendOptionsFromItem(model.get('item'), self);
            });
            this.trigger('change:item', this, attributes && attributes.item || {});
            // Extend the model with Backbone.Validation.mixin to validate it without a View
            _.extend(this, Backbone.Validation.mixin);
        },
        moduleName: 'Transaction.Line.Model'    //@method getItem Returns the current selected item. This method exists to share a common interface with the Product
                                    //@return {Item.Model}
,
        getItem: function getItem() {
            return this.get('item');
        }    //@method getStockInfo Get the stock information of the current item. Indicate if any stock message should be shown or not, and if the current item is valid to be purchased
             //@return {Item.StockInfo}
,
        getStockInfo: function getStockInfo() {
            return this.get('item').getStockInfo();
        }    //@method getPrice Returns the object specifying the price of the current selection
             //@return {ItemPrice}
,
        getPrice: function getPrice() {
            return this.getItem().getPrice(this.get('quantity'), []);
        }    //@method getItemId Returns the id of the current selected item. This method exists to share a common interface with the Product
             //@return {String}
,
        getItemId: function getItemId() {
            return this.get('item').id;
        }    //@method isEqual
             //@param {Transaction.Line.Model} other_line
             //@return {Boolean}
,
        isEqual: function isEqual(other_line) {
            return !!(other_line && this.getItemId() === other_line.getItemId() && _.isEqual(this.get('options').toJSON(), other_line.get('options').toJSON()));
        }
    }, {
        //@method createFromProduct Convert a Product.Model (ProductList.Item.Model) into a Transaction.Line.Model
        //@param {Product.Model} product
        //@return {Transaction.Line.Model}
        createFromProduct: function createFromProduct(product) {
            var line = new TransactionLineModel(product.toJSON()), item = product.get('item'), item_images_detail = item.get('itemimages_detail'), is_matrix_item = !!item.get('_matrixChilds').length;
            if (_.isEqual(item_images_detail, {}) && item.get('_matrixParent').get('internalid') && item.get('_matrixParent').get('itemimages_detail')) {
                item_images_detail = item.get('_matrixParent').get('itemimages_detail');
            }
            line.set('item', product.getItem().clone(), { silent: true });
            line.get('item').set('itemimages_detail', item_images_detail, { silent: true });
            line.get('item').set('itemid', item.get('itemid'), { silent: true });
            line.set('minimumquantity', product.get('item').minimumquantity);
            line.set('maximumquantity', product.get('item').maximumquantity);
            if (is_matrix_item) {
                line.get('item').set('matrix_parent', product.get('item'));
            }
            var price = product.getPrice();
            line.set('rate', price.price, { silent: true });
            line.set('rate_formatted', price.price_formatted, { silent: true });
            product.get('options').each(function (product_option) {
                var line_option = line.get('options').findWhere({ cartOptionId: product_option.get('cartOptionId') });
                line_option.attributes = _.extend({}, product_option.attributes, line_option.attributes);
            });
            return line;
        }
    });
    TransactionLineModel.prototype = _.extend(TransactionLineModel.prototype, ProductLineCommon);
    return TransactionLineModel;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Transaction
define('Transaction.Line.Collection', [
    'Transaction.Line.Model',
    'Backbone'
], function (TransactionLineModel, Backbone) {
    'use strict';
    // @class Transaction.Line.Collection Order Line collection @extends Backbone.Collection
    return Backbone.Collection.extend({
        // @property {Transaction.Line.Model} model
        model: TransactionLineModel
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Transaction
define('Transaction.Shipmethod.Model', ['Backbone'], function (Backbone) {
    'use strict';
    // @class Transaction.Shipmethod.Model Single ship method @extend Backbone.Model
    return Backbone.Model.extend({
        // @method getFormattedShipmethod
        // @return {String}
        getFormattedShipmethod: function () {
            return this.get('name');
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Transaction
define('Transaction.Shipmethod.Collection', [
    'Transaction.Shipmethod.Model',
    'Backbone'
], function (TransactionShipmethodModel, Backbone) {
    'use strict';
    // @class OrderShipmethod.Collection Shipping methods collection @extends Backbone.Collection
    return Backbone.Collection.extend({
        // @property {Transaction.Shipmethod.Model} model
        model: TransactionShipmethodModel    // @property {String} comparator
,
        comparator: 'name'
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Transaction
define('Transaction.Paymentmethod.Model', ['Backbone'], function (Backbone) {
    'use strict';
    // @class Transaction.Paymentmethod.Model Payment method Model @extends Backbone.Model
    return Backbone.Model.extend({
        // @method getFormattedPaymentmethod Returns the current model's type
        // @return {String}
        getFormattedPaymentmethod: function () {
            return this.get('type');
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Transaction
define('Transaction.Paymentmethod.Collection', [
    'Transaction.Paymentmethod.Model',
    'Backbone'
], function (TransactionPaymentmethodModel, Backbone) {
    'use strict';
    // @class Transaction.Paymentmethod.Collection Collection of possible payment method @extends Backbone.Collection
    return Backbone.Collection.extend({
        // @property {Transaction.Paymentmethod.Model} model
        model: TransactionPaymentmethodModel
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Transaction
define('Transaction.Model', [
    'Transaction.Line.Collection',
    'Transaction.Shipmethod.Collection',
    'Transaction.Paymentmethod.Collection',
    'Address.Collection',
    'CreditCard.Collection',
    'underscore',
    'Backbone',
    'Backbone.CachedSync'
], function (TransactionLineCollection, TransactionShipmethodCollection, TransactionPaymentmethodCollection, AddressesCollection, CreditCardsCollection, _, Backbone, BackboneCachedSync) {
    'use strict';
    // @class Transaction.Model Model for showing information about an order @extends Backbone.Model
    return Backbone.Model.extend({
        //@property {Transaction.Line.Collection} linesCollection Property used to make it easy to override this model and change the class used
        //to generates lines
        linesCollection: TransactionLineCollection,
        defaults: {
            //@property {Address.Collection} addresses
            'addresses': null    //@property {Address.Collection} shipmethods
,
            'shipmethods': null
        }    //@property {Boolean} cacheSupport enable or disable the support for cache (Backbone.CachedModel)
,
        cacheSupport: false    //@method initialize Creates the initial properties in order to generate the current complex object that a transaction is
                 //@param {Transaction.Model.InitializationParameter} attributes
                 //@return {Void}
,
        initialize: function (attributes) {
            if (this.cacheSupport) {
                var self = this;
                _.each(BackboneCachedSync, function (fn, name) {
                    self[name === 'cachedSync' ? 'sync' : name] = fn;
                });
            }
            this.on('change:lines', function (model, lines) {
                if (model.previous('lines') instanceof model.linesCollection) {
                    model.set('lines', model.previous('lines'), { silent: true });
                    model.get('lines').reset(lines instanceof model.linesCollection ? lines.models : lines);
                } else {
                    model.set('lines', new model.linesCollection(lines), { silent: true });
                }
            });
            this.trigger('change:lines', this, attributes && attributes.lines || []);
            this.on('change:shipmethods', function (model, shipmethods) {
                if (model.previous('shipmethods') instanceof TransactionShipmethodCollection) {
                    model.set('shipmethods', model.previous('shipmethods'), { silent: true });
                    model.get('shipmethods').reset(shipmethods instanceof TransactionShipmethodCollection ? shipmethods.models : shipmethods);
                } else {
                    model.set('shipmethods', new TransactionShipmethodCollection(shipmethods), { silent: true });
                }
            });
            this.trigger('change:shipmethods', this, attributes && attributes.shipmethods || []);
            this.on('change:paymentmethods', function (model, paymentmethods) {
                if (model.previous('paymentmethods') instanceof TransactionPaymentmethodCollection) {
                    model.set('paymentmethods', model.previous('paymentmethods'), { silent: true });
                    model.get('paymentmethods').reset(paymentmethods instanceof TransactionPaymentmethodCollection ? paymentmethods.models : paymentmethods);
                } else {
                    model.set('paymentmethods', new TransactionPaymentmethodCollection(paymentmethods), { silent: true });
                }
            });
            this.trigger('change:paymentmethods', this, attributes && attributes.paymentmethods || []);
            this.on('change:addresses', function (model, addresses) {
                if (model.previous('addresses') instanceof AddressesCollection) {
                    model.set('addresses', model.previous('addresses'), { silent: true });
                    model.get('addresses').reset(addresses instanceof AddressesCollection ? addresses.models : addresses);
                } else {
                    model.set('addresses', new AddressesCollection(addresses), { silent: true });
                }
            });
            this.trigger('change:addresses', this, attributes && attributes.addresses || []);
        }    // @method _submit Internal method invoked when the user place/submit a transaction
             // @return {jQuery.Deferred}
,
        _submit: function () {
            //Force a POST
            this.set('internalid', null);
            var creditcard = this.get('paymentmethods').findWhere({ type: 'creditcard' }), paypal = this.get('paymentmethods').findWhere({ type: 'paypal' });
            if (creditcard && !creditcard.get('creditcard')) {
                this.get('paymentmethods').remove(creditcard);
            }
            if (paypal && !paypal.get('complete')) {
                this.get('paymentmethods').remove(paypal);
            }
            if (_.isFunction(this.shippingAddressIsRequired) && !this.shippingAddressIsRequired()) {
                this.unset('shipaddress', { silent: true });
                this.set('sameAs', false, { silent: true });
            }
            return this.save();
        },
        addPayment: function addPayment(payment_method) {
            // Gets the payment method collection
            var payment_methods = this.get('paymentmethods');
            // Removes the primary if any
            payment_methods.remove(payment_methods.where({ primary: true }));
            // Sets it as primary
            payment_method.set('primary', true);
            // Adds it to the collection
            payment_methods.add(payment_method);
        },
        setAddress: function setAddress(address_type, address_id, options) {
            this.set(address_type, address_id, options);
        }
    });
});    //@class Transaction.Model.InitializationParameter
       //@property {Arra<Transaction.Model.Get.Line>?} lines
       //@property {Arra<Transaction.Model.Get.ShipMethod>?} shipmethods
       //@property {Arra<Transaction.Model.Get.PaymentMethod>?} paymentmethods
       //@property {Arra<Address.Model.Attributes>?} addresses

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Transaction
define('LiveOrder.Line.Model', [
    'Transaction.Line.Model',
    'Item.Model',
    'underscore',
    'Utils'
], function (TransactionLineModel, ItemModel, _) {
    'use strict';
    var LiveOrderLineModel = TransactionLineModel.extend({
        urlRoot: _.getAbsoluteUrl('services/LiveOrder.Line.Service.ss'),
        initialize: function initialize() {
            // call the initialize of the parent object, equivalent to super()
            TransactionLineModel.prototype.initialize.apply(this, arguments);
            this.on('error', function (model, jqXhr) {
                var result = JSON.parse(jqXhr.responseText), error_details = result.errorDetails;
                if (error_details && error_details.status === 'LINE_ROLLBACK') {
                    model.set('internalid', error_details.newLineId);
                }
            });
        }    // @method toJSON Override default method to send only require data to the back-end
             // @return {Transaction.Line.Model.JSON}
,
        toJSON: function toJSON() {
            // @class Transaction.Line.Model.JSON Class used to send a transaction line representation to the back-end
            // without sending all the heavy weight JSON that is not totally needed by the back-end
            // @public @extlayer
            return {
                // @property {Transaction.Line.Model.JSON.Item} item @public @extlayer
                // @class Transaction.Line.Model.JSON.Item  @public @extlayer
                item: {
                    // @property {String} internalid @public @extlayer
                    internalid: this.getItemId()    // @property {String} type @public @extlayer
,
                    type: this.attributes.item.get('itemtype')
                }    // @class Transaction.Line.Model.JSON
                     // @property {Number} quantity @public @extlayer
,
                quantity: this.attributes.quantity,
                internalid: this.attributes.internalid,
                options: this.get('options').toJSON()    // @property {Number} splitquantity @public @extlayer
,
                splitquantity: this.attributes.splitquantity,
                shipaddress: this.attributes.shipaddress,
                shipmethod: this.attributes.shipmethod,
                location: this.attributes.location && this.attributes.location.attributes && this.attributes.location.attributes.internalid || ''    // @property {String} fulfillmentChoice @public @extlayer
,
                fulfillmentChoice: this.attributes.fulfillmentChoice || 'ship'    //@property {Boolean} freeGift
,
                freeGift: this.attributes.free_gift === true
            };    //@class Transaction.Line.Model
        }    // @method isEqual Compares two LiveOrder lines and answer if they are the same
             // We are extending Transaction.Line.Model here; this method overrides the namesake one in this model.
             // This is so because if pickup in store is enabled, we need to differentiate between lines that look the same but has different delivery methods
             // @param {Transaction.Line.Model} other_line
             // @return {Boolean}
,
        isEqual: function isEqual(other_line) {
            return !!(other_line && this.getItemId() === other_line.getItemId() && _.isEqual(this.get('options').toJSON(), other_line.get('options').toJSON()) && (this.get('location') && this.get('location').get('internalid')) === (other_line.get('location') && other_line.get('location').get('internalid')) && this.get('fulfillmentChoice') === other_line.get('fulfillmentChoice'));
        }
    }, {
        // @method createFromProduct
        // @param {Product.Model} product
        // @return {LiveOrder.Line.Model}
        createFromProduct: function createFromProduct(product) {
            var line = new LiveOrderLineModel(product.toJSON()), item = product.get('item'), item_images_detail = item.get('itemimages_detail'), is_matrix_item = !!item.get('_matrixChilds').length;
            if (_.isEqual(item_images_detail, {}) && item.get('_matrixParent').get('internalid') && item.get('_matrixParent').get('itemimages_detail')) {
                item_images_detail = item.get('_matrixParent').get('itemimages_detail');
            }
            line.set('item', product.getItem().clone(), { silent: true });
            line.get('item').set('itemimages_detail', item_images_detail, { silent: true });
            line.get('item').set('itemid', item.get('itemid'), { silent: true });
            line.set('rate_formatted', product.getPrice().price_formatted, { silent: true });
            product.get('options').each(function (product_option) {
                var line_option = line.get('options').findWhere({ cartOptionId: product_option.get('cartOptionId') });
                line_option.attributes = _.extend({}, product_option.attributes, line_option.attributes);
            });
            if (is_matrix_item) {
                line.get('item').set('matrix_parent', product.get('item'));
            }
            return line;
        }    // @method createFromOuterLine Creates a LiveOrder.Line.Model from the outer representation of a line exposed by Extensibility Layer
             // @param {Line} outer_line
             // @return {LiveOrder.Line.Model}
,
        createFromOuterLine: function createFromOuterLine(outer_line) {
            var item = outer_line.item;
            outer_line = _.extend(outer_line, outer_line.extras);
            delete outer_line.extras;
            item = _.extend(item, item.extras);
            delete item.extras;
            outer_line.item = item;
            var new_line = new LiveOrderLineModel(outer_line);
            return new_line;
        }
    });
    return LiveOrderLineModel;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Transaction
define('LiveOrder.Line.Collection', [
    'Transaction.Line.Collection',
    'LiveOrder.Line.Model',
    'underscore',
    'Utils'
], function (TransactionLineCollection, LiveOrderLineModel, _) {
    'use strict';
    return TransactionLineCollection.extend({
        model: LiveOrderLineModel,
        url: _.getAbsoluteUrl('services/LiveOrder.Line.Service.ss')
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module jQueryExtras

#jQuery.ajaxSetup

Changes jQuery's ajax setup defaults for adding the loading icon. Updates icon's placement on mousemove. 
*/
define('jQuery.ajaxSetup', [
    'jQuery',
    'underscore',
    'Utils'
], function (jQuery, _) {
    'use strict';
    // Variable used to track the mouse position
    var mouse_position = {
        top: 0,
        left: 0
    };
    jQuery(document).ready(function () {
        var $body = jQuery(document.body), $loading_icon = jQuery('#loadingIndicator');
        if (!$loading_icon.length && !(SC && SC.ENVIRONMENT && SC.ENVIRONMENT.isTouchEnabled)) {
            // if the icon wasn't there, lets add it and make a reference in the global scope
            $loading_icon = jQuery('<img/>', {
                id: 'loadingIndicator',
                'class': 'global-loading-indicator',
                src: _.getThemeAbsoluteUrlOfNonManagedResources('img/ajax-loader.gif'),
                css: {
                    zIndex: 9999,
                    position: 'absolute'
                }
            }).hide();
            if (!_.result(SC, 'isPageGenerator')) {
                $loading_icon.appendTo($body);
            }
        }
        SC.$loadingIndicator = $loading_icon;
        // loading icon sizes, used for positioning math
        var icon_height = 16, icon_width = 16;
        $body.on({
            // On mouse move, we update the icon's position, even if its not shown
            mousemove: _.throttle(function (e) {
                mouse_position = {
                    top: Math.min($body.innerHeight() - icon_height, e.pageY + icon_width),
                    left: Math.min($body.innerWidth() - icon_width, e.pageX + icon_height)
                };
                $loading_icon.filter(':visible').css(mouse_position);
            }, 50)    // when the body resizes, we move the icon to the bottom of the page
                      // so we don't get some empty white space at the end of the body
,
            resize: _.throttle(function () {
                var icon_offset = $loading_icon.offset();
                if (!icon_offset) {
                    return;
                }
                mouse_position = {
                    top: Math.min($body.innerHeight() - icon_height, icon_offset.top),
                    left: Math.min($body.innerWidth() - icon_width, icon_offset.left)
                };
                $loading_icon.filter(':visible').css(mouse_position);
            }, 50)
        });
    });
    SC.loadingIndicatorShow = function () {
        SC.$loadingIndicator && SC.$loadingIndicator.css(mouse_position).show();
    };
    SC.loadingIndicatorHide = function () {
        SC.$loadingIndicator && SC.$loadingIndicator.hide();
    };
    // This registers an event listener to any ajax call
    var $document = jQuery(document)    // http://api.jquery.com/ajaxStart/
.ajaxStart(SC.loadingIndicatorShow)    // http://api.jquery.com/ajaxStop/
.ajaxStop(SC.loadingIndicatorHide);
    // fix to solve APM issue (timebrowser timing): https://confluence.corp.netsuite.com/display/SCRUMPSGSVCS/RUM+API+Issues+and+Enhancements
    if (_.result(SC.ENVIRONMENT, 'SENSORS_ENABLED')) {
        $document.ajaxStop(function () {
            if (typeof window.NLRUM !== 'undefined') {
                window.NLRUM.mark('done');
            }
        });
    }
    // http://api.jquery.com/jQuery.ajaxSetup/
    jQuery.ajaxSetup({
        beforeSend: function (jqXhr, options) {
            // BTW: "!~" means "== -1"
            if (!~options.contentType.indexOf('charset')) {
                // If there's no charset, we set it to UTF-8
                jqXhr.setRequestHeader('Content-Type', options.contentType + '; charset=UTF-8');
            }
            if (!SC.dontSetRequestHeaderTouchpoint) {
                // Add header so that suitescript code can know the current touchpoint
                jqXhr.setRequestHeader('X-SC-Touchpoint', SC.ENVIRONMENT.SCTouchpoint);
            }
        }
    });
    jQuery.ajaxTransport('+script', function (s) {
        // This transport only deals with cross domain requests
        if (s.crossDomain) {
            var script, head = document.head || jQuery('head')[0] || document.documentElement;
            return {
                send: function (_, callback) {
                    script = document.createElement('script');
                    script.async = true;
                    if (s.scriptCharset) {
                        script.charset = s.scriptCharset;
                    }
                    script.src = s.url;
                    function clean() {
                        // Handle memory leak in IE
                        script.onload = script.onreadystatechange = null;
                        // Remove the script
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        // Dereference the script
                        script = null;
                    }
                    // Attach handlers for all browsers
                    script.onload = script.onreadystatechange = function (_, isAbort) {
                        if (isAbort || !script.readyState || /loaded|complete/.test(script.readyState)) {
                            clean();
                            // Callback if not abort
                            if (!isAbort) {
                                callback(200, 'success');
                            }
                        }
                    };
                    script.onerror = function () {
                        clean();
                        callback(404, 'error');
                    };
                    // Circumvent IE6 bugs with base elements (#2709 and #4378) by prepending
                    // Use native DOM manipulation to avoid our domManip AJAX trickery
                    head.insertBefore(script, head.firstChild);
                },
                abort: function () {
                    if (script) {
                        script.onload(undefined, true);
                    }
                }
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module AjaxRequestsKiller
// Keeps trak of ongoing ajax requests and of url (or hash) changes,
// so when the url changes it kills all pending ajax requests that other routers may have initiated.
// It's important to note that not all ajax request are opened by the change of the url,
// for that reason it's important that you tag those who do by adding a killerId: AjaxRequestsKiller.getKillerId() to the request (collection.fetch and model.fetch may trigger a request)
define('AjaxRequestsKiller', [
    'underscore',
    'jQuery',
    'Backbone',
    'jQuery.ajaxSetup'
], function (_, jQuery, Backbone) {
    'use strict';
    var killerId, lambsToBeKilled;
    // @class AjaxRequestsKiller @extends ApplicationModule
    return {
        //@method getKillerId
        getKillerId: function () {
            return killerId;
        }    //@method getLambsToBeKilled
,
        getLambsToBeKilled: function () {
            return lambsToBeKilled;
        }    //@method mountToApp
,
        mountToApp: function (application) {
            // Sets the first Killer ID
            // Every time the url changes this will be reseted,
            // but as we are the last listening to the url change event
            // this only happens after all request are made
            killerId = _.uniqueId('ajax_killer_');
            // Every time a request is made, a ref to it will be store in this collection.
            lambsToBeKilled = [];
            // Wraps the beforeSend function of the jQuery.ajaxSettings
            jQuery.ajaxSettings.beforeSend = _.wrap(jQuery.ajaxSettings.beforeSend, function (fn, jqXhr, options) {
                // If the killerId is set we add it to the collection
                if (options.killerId) {
                    jqXhr.killerId = options.killerId;
                    lambsToBeKilled.push(jqXhr);
                }
                // Finally we call the original jQuery.ajaxSettings.beforeSend
                fn.apply(this, _.toArray(arguments).slice(1));
            });
            // We listen to the afterStart because Backbone.history is *potentialy* not ready until after that
            application.on('afterStart', function () {
                // There is a timing issue involved,
                // the on all event happens after the 2nd requests is done
                Backbone.history.on('all', function () {
                    // Check previous ongoing requests
                    _.each(lambsToBeKilled, function (prev_jqXhr) {
                        // if the new id is different than the old one, it means that there is a new killer id,
                        // so we kill the old one if its still ongoing
                        if (killerId && killerId !== prev_jqXhr.killerId) {
                            if (prev_jqXhr.readyState !== 4) {
                                // If we are killing this request we don't want the ErrorHandling.js to handle it
                                prev_jqXhr.preventDefault = true;
                                prev_jqXhr.abort();
                            }
                            // we take it off the lambsToBeKilled collection to free some space and processing.
                            lambsToBeKilled = _.without(lambsToBeKilled, prev_jqXhr);
                        }
                    });
                    // Generates a new id for the **next** request
                    killerId = _.uniqueId('ajax_killer_');
                });
            });
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Tracker
define('Tracker', [
    'Singleton',
    'underscore',
    'Backbone'
], function (Singleton, _, Backbone) {
    'use strict';
    var Tracker = function () {
        // Place holder for tracking modules.
        // When creating your own tracker module, be sure to push it to this array.
        this.trackers = [];
        this.trackOnce = {};
    };
    Tracker.prototype.track = function (method) {
        // Each method could be called with different type of parameters.
        // So we pass them all what ever they are.
        var parameters = Array.prototype.slice.call(arguments, 1);
        _.each(this.trackers, function (tracker) {
            // Only call the method if it exists, the context is the original tracker.
            tracker[method] && tracker[method].apply(tracker, parameters);
        });
        return this;
    };
    Tracker.prototype.trackPageview = function (url) {
        if (this.trackOnce.pageView !== url) {
            this.trackOnce = { 'pageView': url };
            return this.track('trackPageview', url);
        }
        return this;
    };
    Tracker.prototype.trackAddToCart = function (line, event) {
        return this.track('trackEvent', event || {
            category: 'add-to-cart',
            action: 'button',
            label: line.generateURL(),
            value: 1
        }).track('trackAddToCart', line);
    };
    Tracker.prototype.trackGenericEvent = function () {
        return this.track('trackGenericEvent', arguments);
    };
    Tracker.prototype.trackEvent = function (event) {
        this.track('trackEvent', event);
        if (event.callback) {
            var doCallback = _.find(this.trackers, function (tracker) {
                return tracker.doCallback();
            });
            !doCallback && event.callback();
        }
        return this;
    };
    Tracker.prototype.trackTransaction = function (transaction, event) {
        return this.track('trackEvent', event || {
            category: 'place-order',
            action: 'button',
            label: '',
            value: 1
        }).track('trackTransaction', transaction);
    };
    Tracker.prototype.trackViewCart = function (cart) {
        return this.track('trackViewCart', cart);
    };
    Tracker.prototype.trackProductList = function (items, listName) {
        var options = _.parseUrlOptions(Backbone.history.fragment), key = options.keywords || '';
        listName = listName || (key ? 'Search Results' : 'Category');
        if (!this.trackOnce[listName]) {
            this.trackOnce[listName] = true;
            return this.track('trackProductList', items, listName);
        }
        return this;
    };
    Tracker.prototype.trackProductClick = function (item) {
        if (!this.trackOnce['click_' + item.get('name')]) {
            this.trackOnce['click_' + item.get('name')] = true;
            return this.track('trackProductClick', item);
        }
        return this;
    };
    Tracker.prototype.trackProductView = function (product) {
        if (!this.trackOnce['view_' + product.getSku()]) {
            this.trackOnce['view_' + product.getSku()] = true;
            return this.track('trackProductView', product);
        }
        return this;
    };
    Tracker.prototype.addCrossDomainParameters = function (url) {
        _.each(this.trackers, function (tracker) {
            if (tracker.addCrossDomainParameters) {
                url = tracker.addCrossDomainParameters(url);
            }
        });
        return url;
    };
    return _.extend(Tracker, Singleton, Backbone.Events);
});    //@class TrackEvent
       //@property {String} category
       //@property {String} action
       //@property {String} label
       //@property {Number} value
       //@property {Function} callback
       //@property {String?} page

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module LiveOrder
define('LiveOrder.Model', [
    'Transaction.Model',
    'Transaction.Shipmethod.Collection',
    'LiveOrder.Line.Collection',
    'LiveOrder.Line.Model',
    'Profile.Model',
    'Session',
    'Singleton',
    'AjaxRequestsKiller',
    'SC.Configuration',
    'Utils',
    'underscore',
    'jQuery',
    'Tracker'
], function (TransactionModel, TransactionShipmethodCollection, LiveOrderLineCollection, LiveOrderLineModel, ProfileModel, Session, Singleton, AjaxRequestsKiller, Configuration, Utils, _, jQuery, Tracker) {
    'use strict';
    // @class LiveOrder.Model Model for showing information about an open order. It is a singleton so you can obtain the instance fro anywhere by calling ```LiveOrderModel.getInstance()```
    // @extends Transaction.Model
    var ClassProperties = _.extend({
        // @method loadCart
        // @return {jQuery.Deferred}
        // @static
        loadCart: function () {
            // if the Page Generator is on, do not fetch the cart. Instead, return an empty solved promise
            if (_.result(SC, 'isPageGenerator')) {
                return jQuery.Deferred().resolve();
            }
            var cart_instance = this.getInstance();
            if (cart_instance.cartLoad) {
                if (cart_instance.isLoading) {
                    cart_instance.isLoading = false;
                }
            } else {
                cart_instance.cartLoad = jQuery.Deferred();
                ProfileModel.getPromise().done(function () {
                    cart_instance.fetch().done(function () {
                        cart_instance.cartLoad.resolve.apply(this, arguments);
                    }).fail(function () {
                        cart_instance.cartLoad.reject.apply(this, arguments);
                    }).always(function () {
                        if (cart_instance.isLoading) {
                            cart_instance.isLoading = false;
                        }
                    });
                });
            }
            return cart_instance.cartLoad;
        }
    }, Singleton);
    var LiveOrderModel = TransactionModel.extend({
        urlRoot: Utils.getAbsoluteUrl('services/LiveOrder.Service.ss'),
        linesCollection: LiveOrderLineCollection,
        validation: { zip: { fn: Utils.validateZipCode } }    // @method url redefine url to avoid possible cache problems from browser
                                                  // @return {Void}
,
        url: function url() {
            var base_url = TransactionModel.prototype.url.apply(this, arguments);
            return base_url + (base_url.indexOf('?') > 0 ? '&' : '?') + 't=' + new Date().getTime();
        },
        initialize: function initialize(attributes) {
            // call the initialize of the parent object, equivalent to super()
            TransactionModel.prototype.initialize.apply(this, arguments);
            this.set('internalid', 'cart');
            this.on('change:confirmation', function (model, confirmation) {
                model.set('confirmation', new TransactionModel(confirmation), { silent: true });
            });
            this.trigger('change:confirmation', this, attributes && attributes.confirmation || {});
            this.on('change:multishipmethods', function (model, multishipmethods) {
                if (multishipmethods) {
                    _.each(_.keys(multishipmethods), function (address_id) {
                        multishipmethods[address_id] = new TransactionShipmethodCollection(multishipmethods[address_id], { silent: true });
                    });
                }
                model.set('multishipmethods', multishipmethods, { silent: true });
            });
            this.trigger('change:multishipmethods', this, attributes && attributes.multishipmethods || []);
            //Some actions in the live order may change the url of the checkout so to be sure we re send all the touchpoints
            this.on('change:touchpoints', function (model, touchpoints) {
                Session.set('touchpoints', touchpoints);
            });
            //metadata of the attribute options(custom fields)
            if (SC.ENVIRONMENT.customFieldsMetadata && SC.ENVIRONMENT.customFieldsMetadata.salesorder) {
                this.__customFieldsMetadata = SC.ENVIRONMENT.customFieldsMetadata.salesorder;
            }
        }    // @method getLatestAddition
             // @return {LiveOrder.Line.Model}
,
        getLatestAddition: function getLatestAddition() {
            var model = null;
            if (this.get('latest_addition')) {
                model = this.get('lines').get(this.get('latest_addition'));
            }
            if (!model && this.get('lines').length) {
                model = this.get('lines').at(0);
            }
            return model;
        }    // @method findItemInCart Algorithm to search an line in the cart. We can't use internalid only because for matrix items, the internalid change when is added to the cart
             // @param {Transaction.Line.Model} line
             // @return {LiveOrder.Line.Model}
,
        findLine: function findLine(line) {
            return this.get('lines').find(function (cart_line) {
                return cart_line.isEqual(line);
            });
        }    //@method addLines Add the passed in collection of products as new lines to the Cart
             //@param {Array<TransactionLineModel|LiveOrder.Line.Collection>} lines
             //@return {jQuery.Deferred}
,
        addLines: function addLines(lines) {
            var self = this;
            return this.cancelableTrigger('before:LiveOrder.addLines', lines).then(function () {
                lines = lines instanceof LiveOrderLineCollection ? lines : new LiveOrderLineCollection(lines);
                // As the LiveOrder.Live.Service IS NOT REST we cannot use lines.save, instead we directly call lines.sync
                var old_lines = self.get('lines').clone(), promise = lines.sync('create', lines, { killerId: AjaxRequestsKiller.getKillerId() });
                promise.done(function (attributes) {
                    // Though this should be a restful api, the live-order-line returns the full live-order back (lines and summary are interconnected)
                    self.set(attributes);
                    Tracker.getInstance().trackAddToCart(self.get('lines').get(self.get('latest_addition')));
                    self.cancelableTrigger('after:LiveOrder.addLines', old_lines, self.get('lines').clone());
                });
                return promise;
            });
        }    //@method addLine
             //@param {Transaction.Line.Model} line
             //@return {jQuery.Deferred}
,
        addLine: function addLine(line) {
            return this.addLines([line]);
        }    //@method addProduct
             //@param {Product.Model} line
             //@return {jQuery.Deferred}
,
        addProduct: function addProduct(product) {
            return this.addLine(LiveOrderLineModel.createFromProduct(product));
        }    //@method addProducts
             //@param {Array<Product.Model>} products
             //@return {jQuery.Deferred}
,
        addProducts: function addProducts(products) {
            var lines = _.map(products, function (product) {
                return LiveOrderLineModel.createFromProduct(product);
            });
            return this.addLines(lines);
        }    //@method updateProduct
             //@param {Product.Model} product
             //@return {jQuery.Deferred}
,
        updateProduct: function updateProduct(product) {
            return this.updateLine(LiveOrderLineModel.createFromProduct(product));
        }    //@method updateLine
             //@param {Transaction.Line.Model} line
             //@return {jQuery.Deferred}
,
        updateLine: function updateLine(line) {
            var self = this;
            return this.cancelableTrigger('before:LiveOrder.updateLine', line).then(function () {
                // As the LiveOrder.Live.Service IS NOT REST we cannot use line.save, instead we directly call line.sync
                return line.sync('update', line, {
                    killerId: AjaxRequestsKiller.getKillerId(),
                    validate: false
                }).done(function (attributes) {
                    // Although this should be a restful api, the live-order-line returns the full live-order back (lines and summary are interconnected)
                    self.set(attributes);
                    Tracker.getInstance().trackAddToCart(self.getLatestAddition());
                    self.cancelableTrigger('after:LiveOrder.updateLine', line);
                }).fail(function (jqXhr) {
                    var error_details = null;
                    try {
                        var response = JSON.parse(jqXhr.responseText);
                        error_details = response.errorDetails;
                    } finally {
                        if (error_details && error_details.status === 'LINE_ROLLBACK') {
                            var line = self.get('lines').get(error_details.oldLineId);
                            if (line) {
                                line.set('internalid', error_details.newLineId);
                                self.trigger('LINE_ROLLBACK', line);
                            }
                        }
                    }
                });
            });
        }    // @method removeLine
             // @param {LiveOrder.Line.Model} line
             // @return {jQuery.Deferred}
,
        removeLine: function removeLine(line) {
            var self = this;
            return this.cancelableTrigger('before:LiveOrder.removeLine', line).then(function () {
                return line.sync('delete', line, {
                    killerId: AjaxRequestsKiller.getKillerId(),
                    validate: false
                }).done(function (attributes) {
                    self.set(attributes);
                    self.cancelableTrigger('after:LiveOrder.removeLine', line);
                });
            });
        }    // @method submit invoked when the user place/submit the order
             // @return {jQuery.Deferred}
,
        submit: function submit() {
            var self = this;
            return this.cancelableTrigger('before:LiveOrder.submit').then(function () {
                self.set('internalid', null);
                var creditcard = self.get('paymentmethods').findWhere({ type: 'creditcard' }), paypal = self.get('paymentmethods').findWhere({ type: 'paypal' });
                if (creditcard && !creditcard.get('creditcard')) {
                    self.get('paymentmethods').remove(creditcard);
                }
                if (paypal && !paypal.get('complete')) {
                    self.get('paymentmethods').remove(paypal);
                }
                if (!self.shippingAddressIsRequired()) {
                    self.unset('shipaddress', { silent: true });
                    self.set('sameAs', false, { silent: true });
                }
                return self.save().done(function (order) {
                    self.cancelableTrigger('after:LiveOrder.submit', order.confirmation);
                }).fail(function () {
                    self.set('internalid', 'cart');
                });
            });
        }    //@method save Override default save method to just return a resolved promise when the cart have already been saved.
             //@return {jQuery.Deferred}
,
        save: function save() {
            if (this.get('confirmation') && this.get('confirmation').get('internalid')) {
                return jQuery.Deferred().resolve();
            }
            return TransactionModel.prototype.save.apply(this, arguments);
        }    // @method getTotalItemCount
             // @return {Number}
,
        getTotalItemCount: function getTotalItemCount() {
            return _.reduce(this.get('lines').pluck('quantity'), function (memo, quantity) {
                return memo + (parseFloat(quantity) || 1);
            }, 0);
        },
        parse: function parse(response, options) {
            if (options && !options.parse) {
                return;
            }
            return TransactionModel.prototype.parse.apply(this, arguments);
        }    // @method getUnsetLines
             // @returns {Array<Transaction.Line.Model>} the order's lines that have not set its addresses to Multi Ship To yet
,
        getUnsetLines: function getUnsetLines() {
            return this.get('lines').filter(function (line) {
                return !line.get('shipaddress') && line.get('item').get('_isfulfillable');
            });
        }    // @method getNonShippableLines
             // @returns {Array<Transaction.Line.Model>} the order's line that are NON Shippable
,
        getNonShippableLines: function getNonShippableLines() {
            return this.get('lines').filter(function (line) {
                return !line.get('item').get('_isfulfillable');
            });
        }    // @method getSetLines
             // @returns {Array<Transaction.Line.Model>} the list of lines already set its shipping address
,
        getSetLines: function getSetLines() {
            return this.get('lines').filter(function (line) {
                return line.get('shipaddress') && line.get('item').get('_isfulfillable');
            });
        }    // @method getShippableLines
             // @returns {Array<Transaction.Line.Model>} the order's line that are shippable without taking into account if their have or not set a shipaddress
,
        getShippableLines: function getShippableLines() {
            return this.get('lines').filter(function (line) {
                return line.get('item').get('_isfulfillable') && line.get('fulfillmentChoice') !== 'pickup';
            });
        }    // @method getItemsIds
             // @returns {Array<String>} an array containing the cart items ids
             // @return {Array<String>}
,
        getItemsIds: function getItemsIds() {
            return this.get('lines').map(function (line) {
                return line.get('item').get('internalid');
            });
        }    //@method getIfThereAreDeliverableItems Determines if at least one item is shippable
             //@return {Boolean}
,
        getIfThereAreDeliverableItems: function getIfThereAreDeliverableItems() {
            return this.get('lines').length - this.getNonShippableLines().length - this.getPickupInStoreLines().length > 0;
        }    // @method shippingAddressIsRequired Checks if the shipping address is require and if all items in the order are non-shippable.
             // @return {Boolean}
,
        shippingAddressIsRequired: function shippingAddressIsRequired() {
            return this.getIfThereAreDeliverableItems() && Configuration.get('siteSettings.requireshippinginformation', 'F') === 'T';
        },
        getPickupInStoreLines: function getPickupInStoreLines() {
            var lines = [];
            this.get('lines').each(function (line) {
                if (line.get('fulfillmentChoice') === 'pickup') {
                    lines.push(line);
                }
            });
            return lines;
        },
        addPromotion: function addPromotion(promocode) {
            var self = this;
            return this.cancelableTrigger('before:LiveOrder.addPromotion', { code: promocode }).then(function () {
                var pre_promocodes = self.get('promocodes') || [], new_promocodes = pre_promocodes.concat([{ code: promocode }]);
                return self.save({ promocodes: new_promocodes }).fail(function () {
                    self.set('promocodes', pre_promocodes);
                    self.trigger('apply_promocode_failed');
                }).always(function () {
                    self.trigger('apply_promocode_finished');
                }).pipe(function () {
                    var added_promocode = _.find(self.get('promocodes'), function (promo) {
                        return promo.code === promocode;
                    });
                    //We kept the pre existing event
                    self.trigger('promocodeUpdated', 'applied');
                    self.cancelableTrigger('after:LiveOrder.addPromotion', added_promocode);
                    return added_promocode;
                });
            });
        },
        removePromotion: function removePromotion(promocode_internal_id) {
            var self = this;
            return this.cancelableTrigger('before:LiveOrder.removePromotion', { internalid: promocode_internal_id }).then(function () {
                var promocodes = self.get('promocodes') || [];
                promocodes = _.reject(promocodes, function (promocode) {
                    return promocode.internalid === promocode_internal_id;
                });
                return self.save({ promocodes: promocodes }).always(function () {
                    self.trigger('remove_promocode_finished');
                }).pipe(function () {
                    //We kept the pre existing event
                    self.trigger('promocodeUpdated', 'removed');
                    self.cancelableTrigger('after:LiveOrder.removePromotion', { internalid: promocode_internal_id });
                });
            });
        },
        addPayment: function addPayment(payment_method, save) {
            var self = this;
            return this.cancelableTrigger('before:LiveOrder.addPayment', payment_method).pipe(function () {
                try {
                    TransactionModel.prototype.addPayment.apply(self, [payment_method]);
                    var promise = jQuery.Deferred().resolve();
                    if (save) {
                        promise = self.save();
                    }
                    return promise.then(function () {
                        self.cancelableTrigger('after:LiveOrder.addPayment', payment_method);
                    });
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            });
        },
        setAddress: function setAddress(address_type, address_id, options, save) {
            var self = this, address = {
                    id: address_id,
                    type: address_type
                };
            return this.cancelableTrigger('before:LiveOrder.setAddress', address).pipe(function () {
                try {
                    TransactionModel.prototype.setAddress.apply(self, [
                        address_type,
                        address_id,
                        options
                    ]);
                    var promise = jQuery.Deferred().resolve();
                    if (save) {
                        promise = self.save();
                    }
                    return promise.then(function () {
                        self.cancelableTrigger('after:LiveOrder.setAddress', address);
                    });
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            });
        }
    }, ClassProperties);
    return LiveOrderModel;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CreditCard
define('CreditCard.Edit.View', [
    'SC.Configuration',
    'CreditCard.Edit.Form.View',
    'creditcard_edit.tpl',
    'Backbone.CompositeView',
    'Backbone.FormView',
    'Backbone',
    'underscore',
    'LiveOrder.Model',
    'jQuery',
    'Utils'
], function (Configuration, CreditCardEditFormView, creditcard_edit_tpl, BackboneCompositeView, BackboneFormView, Backbone, _, LiveOrderModel, jQuery) {
    'use strict';
    // @class CreditCard.Edit.View card details view/edit @extends Backbone.View
    return Backbone.View.extend({
        template: creditcard_edit_tpl,
        attributes: { 'class': 'CreditCardDetailsView' },
        events: {
            'submit form': 'saveForm',
            'change form:has([data-action="reset"])': 'toggleReset',
            'click [data-action="reset"]': 'resetForm',
            'change form [name="ccnumber"]': 'setPaymethodKey'
        }    //@method initialize
             //@param {CreditCard.Edit.View.Initialize} options
,
        initialize: function () {
            var addCCLabel = _('Add Credit Card').translate();
            var editCCLabel = _('Edit Credit Card').translate();
            this.title = this.model.isNew() ? addCCLabel : editCCLabel;
            this.page_header = this.title;
            // initialize date selector
            var currentExpYear = this.model.get('expyear'), newExpYear = new Date().getFullYear(), range = _.range(new Date().getFullYear(), new Date().getFullYear() + 25);
            if (currentExpYear && currentExpYear < newExpYear) {
                range = _.union([parseInt(currentExpYear, 10)], range);
                this.options.expyear = currentExpYear;
            }
            if (!this.model.get('expmonth')) {
                this.options.currentMonth = new Date().getMonth() + 1;
            }
            this.options.months = _.range(1, 13);
            this.options.years = range;
            //only enable "default" functionality in myaccount
            this.options.showDefaults = Configuration.get('currentTouchpoint') === 'customercenter';
            this.showSaveCreditCardCheckbox = Configuration.get('siteSettings.checkout.showsavecc', 'T') === 'T' && Configuration.get('currentTouchpoint') === 'checkout';
            this.saveCreditCardByDefault = Configuration.get('siteSettings.checkout.saveccinfo', 'T') === 'T' && Configuration.get('currentTouchpoint') === 'checkout';
            BackboneCompositeView.add(this);
            this.showCardsImgs = true;
        },
        childViews: {
            'CreditCard.Form': function () {
                return new CreditCardEditFormView({
                    model: this.model,
                    months: this.options.months,
                    years: this.options.years,
                    currentMonth: this.options.currentMonth,
                    showDefaults: this.options.showDefaults,
                    showSecurityCodeForm: this.options.showSecurityCodeForm,
                    showSaveCreditCardCheckbox: this.showSaveCreditCardCheckbox,
                    saveCreditCardByDefault: this.saveCreditCardByDefault
                });
            }
        }    // @method paymenthodKeyCreditCart @param {String} cc_number @return {String} payment method key matching the passed credit card number if any or undefined.
,
        paymenthodKeyCreditCart: function (cc_number) {
            // regex for credit card issuer validation
            var payment_methods_configuration = Configuration.get('paymentmethods')    // get the credit card key
, paymenthod_key;
            // validate that the number and issuer
            _.each(payment_methods_configuration, function (payment_method_configuration) {
                if (payment_method_configuration.regex && payment_method_configuration.regex.test(cc_number)) {
                    paymenthod_key = payment_method_configuration.key;
                }
            });
            var paymentmethod = paymenthod_key && _.findWhere(Configuration.get('siteSettings.paymentmethods'), { key: paymenthod_key });
            return paymentmethod && paymentmethod.key;
        }    //@method setPaymethodKey
,
        setPaymethodKey: function (e) {
            var cc_number = jQuery(e.target).val().replace(/\s/g, ''), form = jQuery(e.target).closest('form'), paymenthod_key = this.paymenthodKeyCreditCart(cc_number);
            jQuery(e.target).val(cc_number);
            form.find('[name="paymentmethod"]').val(paymenthod_key || 0);
            if (paymenthod_key && this.showCardsImgs) {
                form.find('[data-image="creditcard-icon"]').each(function (index, img) {
                    var $img = jQuery(img);
                    if ($img.data('value') === paymenthod_key) {
                        $img.addClass('creditcard-edit-card-selected');
                        $img.removeClass('creditcard-edit-card-no-selected');
                    } else {
                        $img.addClass('creditcard-edit-card-no-selected');
                        $img.removeClass('creditcard-edit-card-selected');
                    }
                });
                form.find('[data-value="creditcard-select-container"]').css('display', 'none');
                form.find('[data-value="creditcard-img-container"]').css('display', 'block');
            } else {
                if (_.isUndefined(this.model.validation.ccnumber.fn(cc_number, {}, form))) {
                    this.showCardsImgs = false;
                    form.find('[data-image="creditcard-icon"]').removeClass('creditcard-edit-form-card-no-selected');
                    form.find('[data-value="creditcard-select-container"]').css('display', 'block');
                    form.find('[data-value="creditcard-img-container"]').css('display', 'none');
                } else {
                    form.find('[data-value="creditcard-img-container"]').css('display', 'none');
                }
            }
        }    //@method getSelectedMenu
,
        getSelectedMenu: function () {
            return 'creditcards';
        }    //@method getBreadcrumbPages
,
        getBreadcrumbPages: function () {
            return [
                {
                    text: _('Credit Cards').translate(),
                    href: '/creditcards'
                },
                {
                    text: this.title,
                    href: '/creditcards/new'
                }
            ];
        },
        saveForm: function (e) {
            var $form = this.$(e.target), form_data = $form.serializeObject();
            // This is a hack to fix cases when the change event in ccnumber is not triggered and setPaymethodId is not call.
            // This occur in Safari with the AutoFill feature (using keychain)
            if (!form_data.paymentmethod || form_data.paymentmethod === '0') {
                $form.find('[name="ccnumber"]').change();
                form_data = $form.serializeObject();
            }
            // Call super and then check if the edited credit card is not on the order and if so update it.
            // Note that if securitycode is required and we pass an empty one then the payment method will be removed from the order.
            var live_order = LiveOrderModel.getInstance(), promise;
            if (Configuration.get('currentTouchpoint') === 'checkout' && (this.showSaveCreditCardCheckbox && form_data.savecreditcard === 'F' || !this.showSaveCreditCardCheckbox && !this.saveCreditCardByDefault)) {
                e.preventDefault();
                Backbone.Validation.bind(this);
                var result = this.model._validate(form_data, { validate: true });
                if (result) {
                    var paymentmethods = Configuration.get('siteSettings.paymentmethods');
                    if (!form_data.internalid) {
                        // set fake internalid.
                        form_data.internalid = '-temporal-';
                    } else if (form_data.internalid === '-temporal-') {
                        // remove the number to preserve the original value.
                        delete form_data.ccnumber;
                    }
                    // format expiration date.
                    form_data.ccexpiredate = form_data.expmonth + '/' + form_data.expyear;
                    // set the payment method information.
                    form_data.paymentmethod = _.findWhere(paymentmethods, { key: form_data.paymentmethod });
                    // set the values to the model.
                    this.model.set(form_data);
                    promise = jQuery.Deferred();
                    promise.resolveWith(this.model, [this.model.attributes]);
                    // close the modal
                    if (this.inModal && this.$containerModal) {
                        this.$containerModal.modal('hide');
                    }
                } else {
                    promise = result;
                }
            } else {
                if (this.model.get('internalid') === '-temporal-') {
                    // remove fake internalid
                    this.model.unset('internalid', { silent: true });
                }
                promise = BackboneFormView.saveForm.apply(this, arguments);
            }
            promise && promise.done(function (user_cc) {
                live_order.get('paymentmethods').each(function (paymentmethod) {
                    var order_cc = paymentmethod.get('creditcard');
                    if (order_cc && user_cc && order_cc.internalid === user_cc.internalid) {
                        // in the payment method of the order, ONLY update those fields editable by the user.
                        order_cc.ccexpiredate = user_cc.ccexpiredate;
                        order_cc.ccname = user_cc.ccname;
                        order_cc.expmonth = user_cc.expmonth;
                        order_cc.expyear = user_cc.expyear;
                        paymentmethod.set('creditcard', order_cc);
                        live_order.get('paymentmethods').add(paymentmethod, { merge: true });
                    }
                });
            });
            return promise;
        },
        resetForm: function (e) {
            e.preventDefault();
            this.showContent('creditcards');
        }    //@method getContext @return CreditCard.View.Details.Context
,
        getContext: function () {
            //@class CreditCard.View.Details.Context
            return {
                //@property {Boolean} isModal
                isModal: this.inModal,
                isNew: this.model.isNew()    //@property {Boolean} isNew
,
                isCollectionEmpty: this.options.isCreditCardCollectionEmpty,
                isModalOrCollectionLength: !!(this.inModal || !this.options.isCreditCardCollectionEmpty)    //@property {Boolean} showFooter
,
                showFooter: !this.options.hideFooter,
                isInModalOrHideHeader: this.inModal || !!this.options.hideHeader,
                showHeader: !this.options.hideHeader,
                showBackToAccount: Configuration.get('siteSettings.sitetype') === 'STANDARD' && !this.options.hideHeader
            };
        }
    });
});    //@class CreditCard.Edit.View.Initialize
       //@property {Boolean} isCreditCardCollectionEmpty
       //@property {Boolean} hideFooter
       //@property {Boolean} hideHeader
       //@property {ApplicationSkeleton} application
       //@property {Address.Model} model


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CreditCard
define('CreditCard.View', [
    'SC.Configuration',
    'CreditCard.Edit.Form.SecurityCode.View',
    'creditcard.tpl',
    'Backbone.CompositeView',
    'Backbone.FormView',
    'Backbone',
    'underscore',
    'Utils'
], function (Configuration, CreditCardEditFormSecurityCodeView, creditcard_tpl, BackboneCompositeView, BackboneFormView, Backbone, _) {
    'use strict';
    // @class CreditCard.View @extends Backbone.View
    return Backbone.View.extend({
        template: creditcard_tpl,
        initialize: function (options) {
            BackboneCompositeView.add(this);
            this.options = options;
            if (this.options.showSecurityCodeForm) {
                this.model.set('hasSecurityCode', true);
                this.bindings = { '[name="ccsecuritycode"]': 'ccsecuritycode' };
                this.events = { 'submit form': 'doNothing' };
                BackboneFormView.add(this);
            }
        },
        childViews: {
            'CreditCard.Edit.Form.SecurityCode': function () {
                return new CreditCardEditFormSecurityCodeView({
                    error: this.options.securityNumberError,
                    showCreditCardHelp: this.options.showCreditCardHelp,
                    creditCardHelpTitle: this.options.creditCardHelpTitle
                });
            }
        },
        doNothing: function (e) {
            e.preventDefault();
        }    //@method getContext @return CreditCard.View
,
        getContext: function () {
            var payment_methods = Configuration.get('siteSettings.paymentmethods'), payment_method = this.model.get('paymentmethod').key ? _.findWhere(payment_methods, { key: this.model.get('paymentmethod').key }) : _.findWhere(payment_methods, { internalid: this.model.get('paymentmethod').internalid }), icon = payment_method && payment_method.imagesrc && payment_method.imagesrc[0], expiration_month = this.model.get('expmonth');
            console.log(payment_methods);
            //@class CreditCard.View
            return {
                //@property {String} creditCartId
                creditCartId: this.model.get('internalid')    //@property {Boolean} showSecurityCodeForm
,
                showSecurityCodeForm: !!this.options.showSecurityCodeForm,
                showCreditCardImage: !!icon    // @property {String} creditCardImageUrl
,
                creditCardImageUrl: icon || ''    //@property {String} paymentName
,
                paymentName: this.model.get('paymentmethod').name,
                ccnumber: this.model.get('ccnumber').substring(this.model.get('ccnumber').length - 4)    //@property {String} ccname
,
                ccname: this.model.get('ccname')    //@property {String} expirationDate
,
                expirationDate: (expiration_month < 10 ? '0' : '') + expiration_month + '/' + this.model.get('expyear')    //@property {Boolean} showDefaults
,
                showDefaults: !!this.options.showDefaults,
                isDefaultCreditCard: this.model.get('ccdefault') === 'T'    //@property {Boolean} showSelect
,
                showSelect: !!this.options.showSelect,
                selectMessage: this.options.selectMessage,
                showActions: !!this.options.showActions
            };
        }
    });
});



/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard.Module.PaymentMethod
define('OrderWizard.Module.PaymentMethod.Creditcard', [
    'OrderWizard.Module.PaymentMethod',
    'CreditCard.Edit.View',
    'CreditCard.Model',
    'Transaction.Paymentmethod.Model',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'CreditCard.View',
    'SC.Configuration',
    'GlobalViews.Confirmation.View',
    'order_wizard_paymentmethod_creditcard_module.tpl',
    'backbone_collection_view_cell.tpl',
    'backbone_collection_view_row.tpl',
    'Backbone',
    'underscore',
    'jQuery',
    'Profile.Model'
], function (OrderWizardModulePaymentMethod, CreditCardEditView, CreditCardModel, TransactionPaymentmethodModel, BackboneCompositeView, BackboneCollectionView, CreditCardView, Configuration, GlobalViewsConfirmationView, order_wizard_paymentmethod_creditcard_module_tpl, backbone_collection_view_cell_tpl, backbone_collection_view_row_tpl, Backbone, _, jQuery, ProfileModel) {
    'use strict';
    //@class OrderWizard.Module.PaymentMethod.Creditcard @extends OrderWizard.Module.PaymentMethod
    return OrderWizardModulePaymentMethod.extend({
        //@property {Function} template
        template: order_wizard_paymentmethod_creditcard_module_tpl    //@property {Object} securityNumberErrorMessage
,
        securityNumberErrorMessage: {
            errorCode: 'ERR_CHK_INCOMPLETE_SECURITY_NUMBER',
            errorMessage: undefined
        }    //@property {String} selectMessage
,
        selectMessage: _('Use this Card').translate()    //@events {Object} events
,
        events: {
            'click [data-action="select"]': 'selectCreditCard',
            'click [data-action="change-creditcard"]': 'changeCreditCard',
            'click [data-action="remove"]': 'removeCreditCard',
            'mouseover [data-toggle="popover"]': 'openPopover',
            'click [data-action="show-safe-secure-info"]': 'showSecureInfo'
        }    //@property {Array<String>} errors
,
        errors: [
            'ERR_CHK_INCOMPLETE_CREDITCARD',
            'ERR_CHK_SELECT_CREDITCARD',
            'ERR_CHK_EXPIRED_CREDITCARD',
            'ERR_CHK_INCOMPLETE_SECURITY_NUMBER',
            'ERR_WS_INVALID_PAYMENT'
        ]    //@method initialize
             //@return {Vodi}
,
        initialize: function () {
            OrderWizardModulePaymentMethod.prototype.initialize.apply(this, arguments);
            BackboneCompositeView.add(this);
        }    //@method isActive Indicate if in the current state this module is active to be shown or not
             //@return {Boolean}
,
        isActive: function () {
            var a_credit_card = _.findWhere(Configuration.get('siteSettings.paymentmethods', []), { creditcard: 'T' });
            return a_credit_card && a_credit_card.internalid;
        }    //@method part Override default implementation to clean the saves credit card verification code
             //@return {Void}
,
        past: function () {
            this.ccsecuritycode = '';
            this.unsetSecurityNumber();
        }    //@method render
,
        render: function () {
            var self = this    // currently we only support 1 credit card as payment method
, order_payment_method = this.model.get('paymentmethods').findWhere({ type: 'creditcard' });
            this.creditcard = null;
            this.paymentMethod = order_payment_method || new TransactionPaymentmethodModel({ type: 'creditcard' });
            var order_creditcard = this.paymentMethod.get('creditcard');
            this.requireccsecuritycode = Configuration.get('siteSettings.checkout.requireccsecuritycode', 'T') === 'T';
            // credit-card set up
            this.creditcards = ProfileModel.getInstance().get('creditcards');
            // Removes previously added events on the address collection
            this.creditcards.off(null, null, this);
            this.creditcards.on('reset destroy change add remove', function () {
                //search for the paymentmethod in the order that is creditcard
                var order_payment_method = self.model.get('paymentmethods').findWhere({ type: 'creditcard' }), order_creditcard_id = order_payment_method && order_payment_method.get('creditcard') && order_payment_method.get('creditcard').internalid;
                //if the order has a credit card and that credit card exists on the profile we set it (making sure it is the same as in the profile)
                if (order_creditcard_id && self.creditcards.get(order_creditcard_id)) {
                    self.setCreditCard({ id: order_creditcard_id });
                }    // if the credit-card in the order is not longer in the profile we delete it.
                else if (order_creditcard_id) {
                    self.unsetCreditCard();
                }
                self.render();
            }, this);
            if (!this.creditcards.length) {
                this.creditcard = new CreditCardModel({}, { paymentMethdos: Configuration.get('siteSettings.paymentmethods') });
            } else {
                if (order_creditcard && order_creditcard.internalid) {
                    this.creditcard = this.creditcards.get(order_creditcard.internalid);
                } else if (ProfileModel.getInstance().get('isGuest') === 'T') {
                    // if the order is empty and is a guest use the first credit card in the list
                    this.creditcard = this.creditcards.at(0);
                    this.setCreditCard({ id: this.creditcard.id });
                } else if (!this.unset) {
                    this.creditcard = this.creditcards.findWhere({ ccdefault: 'T' });
                    if (this.creditcard && this.creditcard.id) {
                        this.setCreditCard({ id: this.creditcard.id });
                    }
                }
            }
            this._render();
            this.isValid().done(function () {
                self.trigger('ready', !self.requireccsecuritycode);
            });
        }    //@method removeCreditCard dispatch the remove event
,
        removeCreditCard: function (e) {
            e.preventDefault();
            var deleteConfirmationView = new GlobalViewsConfirmationView({
                callBack: this._removeCreditCardFromCollection,
                callBackParameters: {
                    context: this,
                    creditcardId: jQuery(e.target).data('id')
                },
                title: _('Remove Credit Card').translate(),
                body: _('Are you sure you want to remove this Credit Card?').translate(),
                autohide: true
            });
            return this.wizard.application.getLayout().showInModal(deleteConfirmationView);
        },
        _removeCreditCardFromCollection: function (options) {
            if (options.creditcardId !== '-temporal-') {
                options.context.creditcards.get(options.creditcardId).destroy({ wait: true });
            } else {
                options.context.creditcards.remove(options.creditcardId);
                options.context.wizard.model.save();
            }
        }    //@method changeCreditCard
,
        changeCreditCard: function (e) {
            if (ProfileModel.getInstance().get('isGuest') !== 'T' || this.creditcard.get('internalid') === '-temporal-') {
                if (this.creditcard.get('internalid') === '-temporal-') {
                    var internalid = this.creditcard.get('internalid');
                    this.creditcards.remove(internalid);
                    ProfileModel.getInstance().get('creditcards').remove(internalid);
                }
                this.unsetCreditCard(e);
            } else {
                var self = this;
                e.preventDefault();
                e.stopPropagation();
                this.creditcard.destroy({ wait: true }).then(function () {
                    self.creditcards.reset([]);
                    ProfileModel.getInstance().get('creditcards').reset([]);
                });
            }
        }    //@method openPopover
,
        openPopover: function (e) {
            e.preventDefault();
            e.stopPropagation();
            var $link = this.$(e.target);
            $link.popover({
                trigger: 'manual',
                html: true
            }).popover('toggle');
            // add more close popover
            this.closePopover($link);
        }    //@method closePopover
,
        closePopover: function (link) {
            // close mouseout
            link.on('mouseout', function (e) {
                e.preventDefault();
                link.popover('hide');
            });
            // close for mobile
            this.$el.one('click', '[data-type="close-popover"]', function (e) {
                e.preventDefault();
                link.popover('hide');
            });
        }    //@method selectCreditCard
,
        selectCreditCard: function (e) {
            this.setCreditCard({ id: jQuery(e.target).data('id') });
            // As we alreay set the credit card, we let the step know that we are ready
            this.trigger('ready', !this.requireccsecuritycode);
        }    //@method setSecurityNumber
,
        setSecurityNumber: function () {
            if (this.requireccsecuritycode) {
                var creditcard = this.paymentMethod.get('creditcard');
                if (creditcard) {
                    creditcard.ccsecuritycode = this.ccsecuritycode;
                }
            }
        }    //@method unsetSecurityNumber
,
        unsetSecurityNumber: function () {
            var creditcard = this.paymentMethod && this.paymentMethod.get('creditcard');
            if (creditcard) {
                creditcard.ccsecuritycode = null;
            }
        },
        isExpiredCreditCard: function (credit_card) {
            var credit_card_expire_year = parseInt(credit_card.expyear, 10), credit_card_expire_month = parseInt(credit_card.expmonth, 10), today = new Date(), today_year = today.getFullYear(), today_month = today.getMonth() + 1;
            return credit_card_expire_year < today_year || credit_card_expire_year === today_year && credit_card_expire_month < today_month;
        },
        getExpiredCreditCardError: function () {
            return {
                errorCode: 'ERR_CHK_EXPIRED_CREDITCARD',
                errorMessage: _('Your credit card has expired, please select another one.').translate()
            };
        }    //@method setCreditCard
,
        setCreditCard: function (options) {
            var credit_card = options.model || this.creditcards.get(options.id) && this.creditcards.get(options.id).attributes;
            this.paymentMethod = new TransactionPaymentmethodModel({
                type: 'creditcard',
                creditcard: credit_card
            });
            this.setSecurityNumber();
            OrderWizardModulePaymentMethod.prototype.submit.apply(this, arguments);
            // We re render so if there is changes to be shown they are represented in the view
            this.render();
            //when credit card is expired we immediately show a message
            if (credit_card && this.isExpiredCreditCard(credit_card)) {
                var error = this.getExpiredCreditCardError();
                OrderWizardModulePaymentMethod.prototype.manageError.call(this, error);
            }
        }    //@method unsetCreditCard
,
        unsetCreditCard: function (e) {
            if (e) {
                e.preventDefault();
                e.stopPropagation();
            }
            this.unset = true;
            this.paymentMethod = new TransactionPaymentmethodModel({ type: 'creditcard' });
            this.ccsecuritycode = null;
            OrderWizardModulePaymentMethod.prototype.submit.apply(this, arguments);
            // We re render so if there is changes to be shown they are represented in the view
            this.render();
        }    //@method submit
,
        submit: function () {
            // This order is bing payed with some other method (Gift Cert probably)
            if (this.wizard.hidePayment()) {
                return jQuery.Deferred().resolve();
            }
            var self = this;
            if (this.requireccsecuritycode) {
                this.isSecurityNumberInvalid = false;
                // we need to store this temporally (frontend) in case a module in the same step
                // fails validation, making the credit card section re-rendered.
                // We don't want the user to have to type the security number multiple times
                this.ccsecuritycode = this.$('input[name="ccsecuritycode"]').val();
            }
            // if we are adding a new credit card
            if (this.creditcardView) {
                var fake_event = jQuery.Event('click', { target: this.creditcardView.$('form').get(0) }), result = this.creditcardView.saveForm(fake_event);
                if (!result || result.frontEndValidationError) {
                    // There were errors so we return a rejected promise
                    return jQuery.Deferred().reject({
                        errorCode: 'ERR_CHK_INCOMPLETE_CREDITCARD',
                        errorMessage: _('The Credit Card is incomplete').translate()
                    });
                }
                var save_result = jQuery.Deferred();
                result.done(function (model) {
                    self.creditcardView = null;
                    ProfileModel.getInstance().get('creditcards').add(model, { silent: true });
                    self.setCreditCard({ model: model });
                    save_result.resolve();
                }).fail(function (error) {
                    save_result.reject(error.responseJSON);
                });
                return save_result;
            }    // if there are already credit cards
            else {
                this.setSecurityNumber();
                OrderWizardModulePaymentMethod.prototype.submit.apply(this, arguments);
                this.setCreditCard({ model: this.paymentMethod.get('creditcard') });
                return this.isValid().fail(function (error) {
                    if (error === self.securityNumberErrorMessage) {
                        self.isSecurityNumberInvalid = true;
                    }
                }).done(function () {
                    self.isSecurityNumberInvalid = false;
                }).always(function () {
                    // Call self.render() instead of self._render() because the last one didn't asign the events to the DOM
                    self.render();
                });
            }
        }    //@method isValid
,
        isValid: function () {
            // This order is bing payed with some other method (Gift Cert probably)
            if (this.wizard.hidePayment()) {
                return jQuery.Deferred().resolve();
            }
            // user's credit cards
            var creditcards = ProfileModel.getInstance().get('creditcards')    // current order payment method
, order_payment_method = this.model.get('paymentmethods').findWhere({ type: 'creditcard' })    // current order credit card
, order_creditcard = order_payment_method && order_payment_method.get('creditcard');
            // Order is using a credit card
            // and there is a collection of creditcards
            // and the order's creditcard is on that collection
            if (order_creditcard && creditcards.length && creditcards.get(order_creditcard.internalid)) {
                this.securityNumberErrorMessage.errorMessage = _.validateSecurityCode(order_creditcard.ccsecuritycode);
                if (this.isExpiredCreditCard(order_creditcard)) {
                    var error = this.getExpiredCreditCardError();
                    return jQuery.Deferred().reject(error);
                }
                if (!this.requireccsecuritycode || !this.securityNumberErrorMessage.errorMessage) {
                    return jQuery.Deferred().resolve();
                } else {
                    return jQuery.Deferred().reject(this.securityNumberErrorMessage);
                }
            } else {
                // if it not set, then lets reject it
                return jQuery.Deferred().reject({
                    errorCode: 'ERR_CHK_SELECT_CREDITCARD',
                    errorMessage: _('Please select a credit card').translate()
                });
            }
        }    //@method manageError
,
        manageError: function (error) {
            if (error && error.errorCode !== 'ERR_CHK_INCOMPLETE_CREDITCARD') {
                var control_error = this.$('.creditcard-edit-form-securitycode-group'), errorBlock = {
                        attr: 'data-validation-error',
                        value: 'block'
                    };
                if (error.errorCode === 'ERR_CHK_INCOMPLETE_SECURITY_NUMBER') {
                    control_error.attr('data-validation-error', '');
                    this.$('.creditcard-edit-form-securitycode-controls').append('<p ' + errorBlock.attr + '="' + errorBlock.value + '">' + error.errorMessage + '</p>');
                } else {
                    if (error.errorCode === 'ERR_WS_INVALID_PAYMENT') {
                        this.unsetCreditCard();
                    }
                    OrderWizardModulePaymentMethod.prototype.manageError.apply(this, arguments);
                }
            }
        }    // @method showSecureInfo Shows
,
        showSecureInfo: function () {
            var view = new Backbone.View({ application: this.wizard.application }), self = this;
            view.title = _('Safe and Secure Shopping').translate();
            view.render = function () {
                this.$el.html(_(self.wizard.application.getConfig('creditCard.creditCardShowSecureInfo')).translate());
                return this;
            };
            view.showInModal();
        },
        prepopulateCreditCardModel: function () {
            if (this.wizard.isAutoPopulateEnabled && this.wizard.isAutoPopulateEnabled()) {
                this.creditcard.set('ccname', this.wizard.options.profile.get('firstname') + ' ' + this.wizard.options.profile.get('lastname'));
            }
            return this.creditcard;
        }    //@property {Object} childViews
,
        childViews: {
            'CreditCard.List': function () {
                return new BackboneCollectionView({
                    collection: this.creditcards,
                    childView: CreditCardView,
                    childViewOptions: {
                        showActions: true,
                        showDefaults: this.showDefaults,
                        showSelect: true,
                        selectMessage: this.selectMessage
                    },
                    viewsPerRow: this.itemsPerRow || 2,
                    cellTemplate: backbone_collection_view_cell_tpl,
                    rowTemplate: backbone_collection_view_row_tpl
                });
            },
            'CreditCard.Form': function () {
                this.creditcardView = new CreditCardEditView({
                    model: this.prepopulateCreditCardModel(),
                    isCreditCardCollectionEmpty: true    //This view is only render when there is no credit cards at all
,
                    hideHeader: true,
                    hideFooter: true,
                    showSecurityCodeForm: this.requireccsecuritycode
                });
                return this.creditcardView;
            },
            'SelectedCreditCard': function () {
                return new CreditCardView({
                    model: this.creditcard,
                    showSecurityCodeForm: this.requireccsecuritycode,
                    securityNumberError: this.isSecurityNumberInvalid && this.securityNumberErrorMessage,
                    ccsecuritycode: this.ccsecuritycode,
                    showCreditCardHelp: Configuration.get('creditCard.showCreditCardHelp', true),
                    creditCardHelpTitle: _(Configuration.get('creditCard.creditCardHelpTitle', true)).translate(),
                    collapseElements: Configuration.get('sca.collapseElements', true)
                });
            }
        }    //@method getContext @returns {OrderWizard.Module.PaymentMethod.Creditcard.Context}
,
        getContext: function () {
            var showForm = this.creditcards.length === 0 && (!this.creditcard || this.creditcard && this.creditcard.isNew());
            if (!showForm) {
                // Skip_Login fix, because when starting the wizard, the user is guest, he has no credit cards so we show the CreditCard.Form and we set it on this.creditCardView
                // But then when the user logs in, this.creditCardView still exists and the submit thinks it's a new credit card
                this.creditcardView = null;
            }
            //@class OrderWizard.Module.PaymentMethod.Creditcard.Context
            return {
                //@property {Boolean} showForm
                showForm: showForm    //@property {Boolean} showList
,
                showList: !!(this.creditcards.length >= 1 && !this.creditcard)    //@property {Boolean} showSelectedCreditCard
,
                showSelectedCreditCard: !!(this.creditcard && !this.creditcard.isNew())    //@property {Boolean} showTitle
,
                showTitle: !!this.getTitle()    //@property {String} title
,
                title: this.getTitle()    //@property {CreditCard.Model} selectedCreditCard
,
                selectedCreditCard: this.creditcard,
                creditCards: this.creditcards
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// OrderWizard.Module.PaymentMethod.Invoice.js
// --------------------------------
//
define('OrderWizard.Module.PaymentMethod.Invoice', [
    'OrderWizard.Module.PaymentMethod',
    'Transaction.Paymentmethod.Model',
    'order_wizard_paymentmethod_invoice_module.tpl',
    'Backbone',
    'underscore'
], function (OrderWizardModulePaymentMethod, TransactionPaymentmethodModel, order_wizard_paymentmethod_invoice_module_tpl, Backbone, _) {
    'use strict';
    return OrderWizardModulePaymentMethod.extend({
        template: order_wizard_paymentmethod_invoice_module_tpl,
        events: { 'click [data-toggle="show-terms"]': 'showTerms' },
        errors: [
            'ERR_WS_INVALID_PAYMENT',
            'ERR_CHK_INVOICE_CREDIT_LIMIT'
        ],
        showTerms: function () {
            var self = this, TermsView = Backbone.View.extend({
                    title: _('Terms and Conditions').translate(),
                    render: function () {
                        this.$el.html(_(self.wizard.application.getConfig('checkoutApp.invoiceTermsAndConditions')).translate());
                        return this;
                    }
                });
            this.wizard.application.getLayout().showInModal(new TermsView());
        },
        isActive: function () {
            var terms = this.terms = this.getProfile().get('paymentterms');
            return terms && terms.internalid;
        },
        getProfile: function () {
            return this.wizard.options.profile;
        },
        render: function () {
            if (this.isActive()) {
                return this._render();
            }
        },
        submit: function () {
            var self = this;
            return this.isValid().done(function () {
                self.paymentMethod = new TransactionPaymentmethodModel({
                    type: 'invoice',
                    terms: self.wizard.options.profile.get('paymentterms')
                });
                OrderWizardModulePaymentMethod.prototype.submit.apply(self);
            });
        },
        getContext: function () {
            return {
                //@property {String} termsName
                termsName: this.terms.name,
                showTerms: this.wizard.application.getConfig('siteSettings.checkout.requiretermsandconditions') === 'T'    //@property {String} balanceAvailable
,
                balanceAvailable: this.wizard.options.profile.get('balance_available_formatted') || ''
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module OrderWizard @class OrderWizard.Module.PaymentMethod.Paypal @extends OrderWizard.Module.PaymentMethod
define('OrderWizard.Module.PaymentMethod.PayPal', [
    'OrderWizard.Module.PaymentMethod',
    'Session',
    'Transaction.Paymentmethod.Model',
    'order_wizard_paymentmethod_paypal_module.tpl',
    'Backbone',
    'underscore'
], function (OrderWizardModulePaymentMethod, Session, TransactionPaymentmethodModel, order_wizard_paymentmethod_paypal_module_tpl, Backbone, _) {
    'use strict';
    return OrderWizardModulePaymentMethod.extend({
        template: order_wizard_paymentmethod_paypal_module_tpl,
        isActive: function () {
            var paypal = _.findWhere(this.wizard.application.getConfig('siteSettings.paymentmethods', []), { ispaypal: 'T' });
            return !!(paypal && paypal.internalid);
        },
        past: function () {
            if (this.isActive() && !this.wizard.isPaypalComplete() && !this.wizard.hidePayment() && this.wizard.model.get('confirmation').isNew()) {
                var checkout_url = Session.get('touchpoints.checkout'), joint = ~checkout_url.indexOf('?') ? '&' : '?', previous_step_url = this.wizard.getPreviousStepUrl();
                checkout_url += joint + 'paypal=T&next_step=' + previous_step_url;
                Backbone.history.navigate(previous_step_url, {
                    trigger: false,
                    replace: true
                });
                document.location.href = checkout_url;
                throw new Error('This is not an error. This is just to abort javascript');
            }
        },
        render: function () {
            if (this.isActive()) {
                this.paymentMethod = new TransactionPaymentmethodModel({ type: 'paypal' });
                this._render();
                if (this.wizard.isPaypalComplete()) {
                    this.paymentMethod.set('primary', null);
                    this.paymentMethod.set('complete', true);
                    var is_ready = this.options && this.options.backFromPaypalBehavior !== 'stay';
                    this.trigger('ready', is_ready);
                }
            }
        },
        getContext: function () {
            return {
                //@property {Boolean} isPaypalComplete
                isPaypalComplete: !!this.model.get('isPaypalComplete')    //@property {String} paypalImageUrl
,
                paypalImageUrl: this.wizard.application.getConfig('checkoutApp.paypalLogo')
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module OrderWizard
define('OrderWizard.Module.PaymentMethod.External', [
    'OrderWizard.Module.PaymentMethod',
    'Transaction.Paymentmethod.Model',
    'order_wizard_paymentmethod_external_module.tpl',
    'Backbone',
    'underscore',
    'SC.Configuration',
    'Utils'
], function (OrderWizardModulePaymentMethod, TransactionPaymentmethodModel, order_wizard_paymentmethod_external_module_tpl, Backbone, _, Configuration, Utils) {
    'use strict';
    // @class OrderWizard.Module.PaymentMethod.External @extends OrderWizard.Module.PaymentMethod
    return OrderWizardModulePaymentMethod.extend({
        template: order_wizard_paymentmethod_external_module_tpl,
        render: function render() {
            var n = Configuration.get('siteSettings.id'), status_accept_value = Configuration.get('siteSettings.externalCheckout.' + this.options.record_type.toUpperCase() + '.statusAcceptValue', 'ACCEPT'), status_reject_value = Configuration.get('siteSettings.externalCheckout.' + this.options.record_type.toUpperCase() + '.statusRejectValue', 'REJECT'), status_parameter_name = Configuration.get('siteSettings.externalCheckout.' + this.options.record_type.toUpperCase() + '.statusParameterName', 'status'), url = Utils.getAbsoluteUrl('external_payment.ssp'), current_touchpoint = Configuration.get('currentTouchpoint'), thankyouurl_parameters = {
                    n: n,
                    externalPaymentDone: 'T',
                    touchpoint: current_touchpoint,
                    recordType: this.options.record_type || 'salesorder'
                }, errorurl_parameters = {
                    n: n,
                    externalPaymentDone: 'T',
                    touchpoint: current_touchpoint,
                    recordType: this.options.record_type || 'salesorder'
                }, returnurl_parameters = {
                    n: n,
                    externalPaymentDone: 'T',
                    touchpoint: current_touchpoint,
                    recordType: this.options.record_type || 'salesorder'
                };
            thankyouurl_parameters[status_parameter_name] = status_accept_value;
            errorurl_parameters[status_parameter_name] = status_reject_value;
            if (this.options.prevent_default) {
                var prevent_default_parameter_name = Configuration.get('siteSettings.externalCheckout.' + this.options.record_type.toUpperCase() + '.preventDefaultParameterName', 'preventDefault'), prevent_default_value = Configuration.get('siteSettings.externalCheckout.' + this.options.record_type.toUpperCase() + '.preventDefaultValue', 'T');
                thankyouurl_parameters[prevent_default_parameter_name] = prevent_default_value;
                errorurl_parameters[prevent_default_parameter_name] = prevent_default_value;
                returnurl_parameters[prevent_default_parameter_name] = prevent_default_value;
            }
            this.paymentMethod = new TransactionPaymentmethodModel({
                type: 'external_checkout_' + this.options.paymentmethod.key,
                isexternal: 'T',
                internalid: this.options.paymentmethod.internalid,
                merchantid: this.options.paymentmethod.merchantid,
                key: this.options.paymentmethod.key,
                thankyouurl: Utils.addParamsToUrl(url, thankyouurl_parameters)    // Commerce API
,
                errorurl: Utils.addParamsToUrl(url, errorurl_parameters)    // Commerce API
,
                returnurl: Utils.addParamsToUrl(url, returnurl_parameters)    // SuiteScript
            });
            this._render();
        },
        getContext: function getContext() {
            return {
                //@property {String} imageUrl
                imageUrl: this.options.paymentmethod.imagesrc[0]    //@property {String} name
,
                name: this.options.paymentmethod.name,
                description: this.options.description || _('You will be redirected to your external payment site after reviewing your order on next step. Once your order is placed, you will return to our site to see the confirmation of your purchase.').translate()
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard.Module.PaymentMethod
define('OrderWizard.Module.PaymentMethod.Selector', [
    'Wizard.Module',
    'OrderWizard.Module.PaymentMethod.Creditcard',
    'OrderWizard.Module.PaymentMethod.Invoice',
    'OrderWizard.Module.PaymentMethod.PayPal',
    'OrderWizard.Module.PaymentMethod.External',
    'SC.Configuration',
    'order_wizard_paymentmethod_selector_module.tpl',
    'underscore',
    'jQuery'
], function (WizardModule, OrderWizardModulePaymentMethodCreditcard, OrderWizardModulePaymentMethodInvoice, OrderWizardModulePaymentMethodPayPal, OrderWizardModulePaymentMethodExternal, Configuration, order_wizard_paymentmethod_selector_module_tpl, _, jQuery) {
    'use strict';
    //@class OrderWizard.Module.PaymentMethod.Selector @extends Wizard.Module
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_paymentmethod_selector_module_tpl    //@property {String} className
,
        className: 'OrderWizard.Module.PaymentMethod.Selector'    //@property {Object} selectedPaymentErrorMessage
,
        selectedPaymentErrorMessage: {
            errorCode: 'ERR_CHK_SELECT_PAYMENT',
            errorMessage: _('Please select a payment option').translate()
        }    //@property {Object} externalPaymentErrorMessage
,
        externalPaymentErrorMessage: {
            errorCode: 'ERR_CHK_EXTERNAL_PAYMENT_FAIL',
            errorMessage: _('Payment processing failed. Try again or choose a different payment method.').translate()
        }    //@property {Boolean} showExternalPaymentErrorMessage
,
        showExternalPaymentErrorMessage: true    //@property {Array} errors
,
        errors: [
            'ERR_CHK_SELECT_PAYMENT',
            'ERR_WS_SET_PAYMENT',
            'ERR_CHK_EXTERNAL_PAYMENT_FAIL',
            'ERR_WS_INVALID_PAYMENT'
        ]    //@property {Object} events
,
        events: { 'change [data-action="select-payment-method"]': 'selectPaymentMethod' }    //@method initialize
,
        initialize: function (options) {
            var self = this;
            WizardModule.prototype.initialize.apply(this, arguments);
            this.modules = options.modules || [
                {
                    classModule: OrderWizardModulePaymentMethodCreditcard,
                    name: _('Credit / Debit Card').translate(),
                    type: 'creditcard',
                    options: {}
                },
                {
                    classModule: OrderWizardModulePaymentMethodInvoice,
                    name: _('Invoice').translate(),
                    type: 'invoice',
                    options: {}
                },
                {
                    classModule: OrderWizardModulePaymentMethodPayPal,
                    name: _('PayPal').translate(),
                    type: 'paypal',
                    options: {}
                }
            ];
            if (!options.disableExternalPaymentMethods) {
                var payment_methods = Configuration.get('siteSettings.paymentmethods', []), payment_methods_configuration = Configuration.get('paymentmethods', []), external_payment_methods = _.where(payment_methods, { isexternal: 'T' });
                _.each(external_payment_methods, function (payment_method) {
                    var payment_method_configuration = _.find(payment_methods_configuration, { key: payment_method.key });
                    self.modules.push(self.getExternalPaymentMethodModule(payment_method, options, payment_method_configuration));
                });
                this.wizard.model.on('change:confirmation', function (model, confirmation) {
                    if (confirmation && confirmation.statuscode === 'redirect') {
                        window.location.href = _.addParamsToUrl(confirmation.redirecturl, { touchpoint: Configuration.get('currentTouchpoint') });
                        throw new Error('This is not an error. This is just to abort javascript');
                    }
                });
            }
            _.each(this.modules, function (module) {
                // var ModuleClass = require(module.classModule);
                var ModuleClass = module.classModule;
                module.instance = new ModuleClass(_.extend({
                    wizard: self.wizard,
                    step: self.step,
                    stepGroup: self.stepGroup
                }, module.options));
                module.instance.on('ready', function (is_ready) {
                    self.moduleReady(is_ready);
                });
            });
        },
        getExternalPaymentMethodModule: function (payment_method, options, payment_method_configuration) {
            return {
                classModule: OrderWizardModulePaymentMethodExternal,
                name: payment_method.name,
                type: 'external_checkout_' + payment_method.key,
                options: {
                    paymentmethod: payment_method,
                    thankyouurl: options.external_checkout_thank_you_url,
                    errorurl: options.external_checkout_error_url,
                    description: payment_method_configuration ? payment_method_configuration.description : '',
                    record_type: options.record_type,
                    prevent_default: options.prevent_default
                }
            };
        }    //@method moduleReady
,
        moduleReady: function (is_ready) {
            this.trigger('ready', is_ready);
        }    //@method past
,
        past: function () {
            this.state = 'past';
            if (!this.selectedModule) {
                var primary_paymentmethod = this.model.get('paymentmethods').findWhere({ primary: true });
                this.setModuleByType(primary_paymentmethod && primary_paymentmethod.get('type'));
            }
            this.selectedModule && this.selectedModule.instance.past && this.selectedModule.instance.past();
            this.model.off('change', this.totalChange, this);
        }    //@method present
,
        present: function () {
            this.state = 'present';
            this.selectedModule && this.selectedModule.instance.present && this.selectedModule.instance.present();
            this.model.off('change', this.totalChange, this);
            this.model.on('change', this.totalChange, this);
        }    //@method future
,
        future: function () {
            this.state = 'future';
            this.selectedModule && this.selectedModule.instance.future && this.selectedModule.instance.future();
            this.model.off('change', this.totalChange, this);
        }    //@method totalChange
,
        totalChange: function () {
            if (this.model.previous('summary') && this.model.get('summary')) {
                var was = this.model.previous('summary').total, is = this.model.get('summary').total;
                // Changed from or to 0
                if (was === 0 && is !== 0 || was !== 0 && is === 0) {
                    this.render();
                }
            }
        }    //@method setModuleByType
,
        setModuleByType: function (type, no_render) {
            this.selectedModule = _.findWhere(this.modules, { type: type });
            if (!this.selectedModule) {
                this.selectedModule = _.first(this.modules);
            }
            // set continue button label.
            if (this.selectedModule.type === 'paypal' && !this.model.get('isPaypalComplete')) {
                this.trigger('change_label_continue', _('Continue to Paypal').translate());
            } else {
                this.trigger('change_label_continue');
            }
            if (this.state === 'present' && !no_render) {
                this.render();
            }
        }    //@method render
,
        render: function () {
            if (this.wizard.hidePayment()) {
                this.$el.empty();
                this.trigger('change_label_continue');
                return;
            }
            if (!this.selectedModule) {
                var selected_payment = this.model.get('paymentmethods').findWhere({ primary: true }), selected_type;
                if (selected_payment) {
                    selected_type = selected_payment.get('type');
                } else if (this.wizard.options.profile.get('paymentterms')) {
                    selected_type = 'invoice';
                }
                this.setModuleByType(selected_type, true);
            } else if (this.selectedModule.type === 'paypal' && !this.model.get('isPaypalComplete')) {
                this.trigger('change_label_continue', _('Continue to Paypal').translate());
            } else {
                this.trigger('change_label_continue');
            }
            // We do this here so we give time for information to be bootstrapped
            _.each(this.modules, function (module) {
                module.isActive = module.instance.isActive();
            });
            this._render();
            if (_.getParameterByName(window.location.href, 'externalPayment') === 'FAIL' && this.showExternalPaymentErrorMessage) {
                this.showExternalPaymentErrorMessage = false;
                this.manageError(this.externalPaymentErrorMessage);
            }
            var self = this;
            _.each(this.modules, function (module) {
                if (module.isSelected) {
                    module.instance.isReady = false;
                    module.instance.render();
                    self.$('#payment-method-selector-content').empty().append(module.instance.$el);
                }
            });
        }    //@method selectPaymentMethod
,
        selectPaymentMethod: function (e) {
            this.setModuleByType(jQuery(e.target).val());
        }    //@method submit
,
        submit: function () {
            this.clearError();
            // This order is bing payed with some other method (Gift Cert probably)
            if (this.wizard.hidePayment()) {
                return jQuery.Deferred().resolve();
            }
            if (this.selectedModule && this.selectedModule.instance) {
                return this.selectedModule.instance.submit();
            } else {
                return jQuery.Deferred().reject(this.selectedPaymentErrorMessage);
            }
        }    //@method isValid
,
        isValid: function () {
            // This order is being payed with some other method (Gift Cert probably)
            if (this.wizard.hidePayment()) {
                return jQuery.Deferred().resolve();
            }
            if (this.selectedModule && this.selectedModule.instance) {
                return this.selectedModule.instance.isValid();
            } else {
                return jQuery.Deferred().reject(this.selectedPaymentErrorMessage);
            }
        }    //@method getContext
,
        getContext: function () {
            var self = this, active_modules = _.map(this.modules, function (module) {
                    if (module.isActive) {
                        module.isSelected = self.selectedModule.type === module.type;
                        module.isActive = true;
                        return {
                            isActive: true,
                            isSelected: module.isSelected,
                            name: module.name,
                            options: module.options,
                            type: module.type
                        };
                    }
                });
            active_modules = _.compact(active_modules);
            return {
                //@property {Array} activeModules
                activeModules: _.compact(active_modules)    //@property {Boolean} activeModulesLengthGreaterThan1
,
                activeModulesLengthGreaterThan1: active_modules.length,
                firstActiveModuleName: active_modules[0] && active_modules[0].name,
                showTitle: !this.options.hide_title,
                title: this.options.title || _('Payment Method').translate()
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard.Module.PaymentMethod
define('OrderWizard.Module.PaymentMethod.PurchaseNumber', [
    'Wizard.Module',
    'SC.Configuration',
    'order_wizard_paymentmethod_purchasenumber_module.tpl',
    'jQuery'
], function (WizardModule, Configuration, order_wizard_paymentmethod_purchasenumber_module_tpl, jQuery) {
    'use strict';
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_paymentmethod_purchasenumber_module_tpl    //@property {String} className
,
        className: 'OrderWizard.Module.PaymentMethod.PurchaseNumber',
        isActive: function () {
            return Configuration.get('siteSettings.checkout.showpofieldonpayment', 'T') === 'T';
        },
        submit: function () {
            var purchase_order_number = this.$('[name=purchase-order-number]').val() || '';
            this.wizard.model.set('purchasenumber', purchase_order_number);
            return jQuery.Deferred().resolve();
        }    //@method getContext 
             //@returns {OrderWizard.Module.PaymentMethod.Creditcard.Context}
,
        getContext: function () {
            return {
                //@property {String} purchaseNumber
                purchaseNumber: this.wizard.model.get('purchasenumber')
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard
define('OrderWizard.Module.Address.Billing', [
    'OrderWizard.Module.Address',
    'GlobalViews.Confirmation.View',
    'underscore',
    'Utils'
], function (OrderWizardModuleAddress, GlobalViewsConfirmationView, _) {
    'use strict';
    //@class OrderWizard.Module.Address.Billing @extend OrderWizard.Module.Address
    return OrderWizardModuleAddress.extend({
        manage: 'billaddress',
        sameAsManage: 'shipaddress',
        className: 'OrderWizard.Module.Address.Billing',
        errors: [
            'ERR_CHK_INCOMPLETE_ADDRESS',
            'ERR_CHK_SELECT_BILLING_ADDRESS',
            'ERR_CHK_INVALID_BILLING_ADDRESS',
            'ERR_WS_INVALID_BILLING_ADDRESS'
        ],
        sameAsMessage: _('Same as shipping address').translate(),
        selectAddressErrorMessage: {
            errorCode: 'ERR_CHK_SELECT_BILLING_ADDRESS',
            errorMessage: _('Please select a billing address').translate()
        },
        invalidAddressErrorMessage: {
            errorCode: 'ERR_CHK_INVALID_BILLING_ADDRESS',
            errorMessage: _('The selected billing address is invalid').translate()
        }    // @method reRenderOnFirstAddressCreation Handle the case in OPC MST where there is not address at all and a new one is created, if there current address form does not have any
             // data entered we should re-render in order to reflect the new options (the new address created)
,
        reRenderOnFirstAddressCreation: function () {
            // if the address form (the one to create a new address) is empty
            if (!this.wizard.model.get('temp' + this.manage)) {
                this.render();
            }
        }    // @method getIsCurrentUserGuest We override here to give support to guest user with Multi Ship To. The default implementation will notice that the current user is guest, and will select the first entered address
             // to be used in the in-line address form
,
        getIsCurrentUserGuest: function () {
            if (this.wizard.model.get('ismultishipto')) {
                return false;
            }
            return OrderWizardModuleAddress.prototype.getIsCurrentUserGuest.apply(this, arguments);
        }    // @method onEventHandlersOn Attach to extra events
,
        onEventHandlersOn: function () {
            //In OPC is require to re-render when changing between SST and MST to hide or show the same as checkbox
            this.wizard.model.on('ismultishiptoUpdated', function () {
                this.sameAs = false;
                this.render();
            }, this);
            this.wizard.model.on('address_added', this.reRenderOnFirstAddressCreation, this);    // This event is triggered by MST.Select.Addresses.Shipping module
        }    // @method isAddressIdValidForRemoval Override the address removal control to take into account Multi Ship To scenario @return {Boolean}
,
        isAddressIdValidForRemoval: function (address_id) {
            if (!this.wizard.model.get('ismultishipto')) {
                return OrderWizardModuleAddress.prototype.isAddressIdValidForRemoval.apply(this, arguments);
            }
            return !_.find(this.wizard.model.getSetLines(), function (line) {
                return +line.get('shipaddress') === +address_id;
            });
        }    // @method onEventHandlersOff Detach from extra added event handlers
,
        onEventHandlersOff: function () {
            this.wizard.model.off('ismultishiptoUpdated', null, this);
            this.wizard.model.off('address_added', null, this);
        }    // @method getAddressListOptions Redefined the base getAddressListOptions method to add an option that checks if an address cannot be removed when the order has an item asigned to it
             // @return {showSelect:Boolean,selectMessage:String,hideDefaults:Boolean,disableRemoveButton:Function<String> => Boolean}
,
        getAddressListOptions: function () {
            var self = this, base_result = OrderWizardModuleAddress.prototype.getAddressListOptions.apply(this, arguments);
            return _.extend(base_result, {
                disableRemoveButton: function (address_id) {
                    return !self.isAddressIdValidForRemoval(address_id);
                }
            });
        }    // @method validateAddressRemoval Redefined validateAddressRemoval so user can not delete an address that is set as a shipping address
             // @param {String} address_id
,
        validateAddressRemoval: function (address_id) {
            if (this.isAddressIdValidForRemoval(address_id)) {
                var deleteConfirmationView = new GlobalViewsConfirmationView({
                    callBack: this.removeAddress,
                    callBackParameters: {
                        context: this,
                        addressId: address_id
                    },
                    title: _('Remove Address').translate(),
                    body: _('Are you sure you want to delete this address?').translate(),
                    autohide: true
                });
                this.wizard.application.getLayout().showInModal(deleteConfirmationView);
            }
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard
define('OrderWizard.Module.RegisterEmail', [
    'Wizard.Module',
    'Profile.Model',
    'order_wizard_registeremail_module.tpl',
    'SC.Configuration',
    'Backbone.Validation',
    'underscore',
    'jQuery',
    'Backbone',
    'Utils'
], function (WizardModule, ProfileModel, order_wizard_registeremail_module_tpl, Configuration, BackboneValidation, _, jQuery, Backbone) {
    'use strict';
    return WizardModule.extend({
        template: order_wizard_registeremail_module_tpl,
        className: 'OrderWizard.Module.RegisterEmail',
        invalidEmailErrorMessage: {
            errorCode: 'ERR_CHK_INVALID_EMAIL',
            errorMessage: _('Invalid email address').translate()
        },
        errors: ['ERR_CHK_INVALID_EMAIL'],
        render: function () {
            if (!this.isActive()) {
                return this.$el.empty();
            }
            this._render();
            if (this.profileModel.get('email') && this.wizard.isPaypalComplete()) {
                this.trigger('ready', true);
            }
        },
        initialize: function () {
            this.profileModel = ProfileModel.getInstance();
            WizardModule.prototype.initialize.apply(this, arguments);
        },
        submit: function () {
            var fake_promise = jQuery.Deferred(), self = this, email = this.$('input[name=email]').val(), emailsubscribe = this.$('input[name=sign-up-newsletter]').is(':checked') ? 'T' : 'F';
            // if the module is not active or if the module is active and not change the current values we just resolve the promise
            if (!this.isActive() || this.isActive() && this.profileModel.get('email') === email && this.profileModel.get('emailsubscribe') === emailsubscribe) {
                return this.isValid();
            }
            this.profileModel.set({
                email: email,
                confirm_email: email
            });
            this.isValid().then(function () {
                self.profileModel.set({
                    emailsubscribe: emailsubscribe,
                    skipLoginDontUpdateProfile: [
                        'email',
                        'confirm_email',
                        'emailsubscribe'
                    ]
                }).save().then(function () {
                    self.profileModel.unset('skipLoginDontUpdateProfile', { silent: true });
                    self.render();
                    fake_promise.resolve();
                }, function (message) {
                    fake_promise.reject(message);
                });
            }, function (message) {
                fake_promise.reject(message);
            });
            return fake_promise;
        },
        isValid: function () {
            var promise = jQuery.Deferred();
            if (Backbone.Validation.patterns.email.test(this.profileModel.get('email'))) {
                return promise.resolve();
            }
            return promise.reject(this.invalidEmailErrorMessage);
        },
        showError: function () {
            this.$('.control-group').removeClass('error');
            this.$('.control-group').addClass('error');
            WizardModule.prototype.showError.apply(this, arguments);
        },
        isActive: function () {
            return (this.profileModel.get('isGuest') === 'T' || this.profileModel.get('isGuest') === 'F' && this.profileModel.get('isLoggedIn') === 'F' && this.profileModel.get('isRecognized') === 'F') && (this.wizard.application.getConfig('checkout.skipLogin') || !Configuration.get('forms.loginAsGuest.showEmail'));
        }    // @method getContext
             // @return {OrderWizard.Module.RegisterEmail.Context}
,
        getContext: function () {
            // @class OrderWizard.Module.RegisterEmail.Context
            return {
                // @property {String} email
                email: this.profileModel.get('email') || ''    // @property {Boolean} isEmailSubcribe
,
                isEmailSubcribe: this.profileModel.get('emailsubscribe') === 'T'
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard.Module.PaymentMethod
define('OrderWizard.Module.ShowPayments', [
    'Wizard.Module',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'Address.Details.View',
    'GlobalViews.FormatPaymentMethod.View',
    'order_wizard_showpayments_module.tpl',
    'underscore'
], function (WizardModule, BackboneCompositeView, BackboneCollectionView, AddressDetailsView, GlobalViewsFormatPaymentMethodView, order_wizard_showpayments_module_tpl, _) {
    'use strict';
    //@class OrderWizard.Module.ShowPayments @extends Wizard.Module
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_showpayments_module_tpl    //@property {String} className
,
        className: 'OrderWizard.Module.ShowPayments'    //@method initialize
,
        initialize: function () {
            WizardModule.prototype.initialize.apply(this, arguments);
            this.application = this.wizard.application;
            this.profile = this.wizard.options.profile;
            this.addressSource = this.options.useModelAddresses ? this.model.get('addresses') : this.profile.get('addresses');
            BackboneCompositeView.add(this);
        }    //@method getPaymentmethods
,
        getPaymentmethods: function () {
            return _.reject(this.model.get('paymentmethods').models, function (paymentmethod) {
                return paymentmethod.get('type') === 'giftcertificate';
            });
        }    //@method getGiftCertificates
,
        getGiftCertificates: function () {
            return this.model.get('paymentmethods').where({ type: 'giftcertificate' });
        }    //@method past
,
        past: function () {
            this.model.off('change', this.totalChange, this);
            this.addressSource.off('change', this.render, this);
        }    //@method present
,
        present: function () {
            this.model.off('change', this.totalChange, this);
            this.addressSource.off('change', this.render, this);
            this.model.on('change', this.totalChange, this);
            this.addressSource.on('change', this.render, this);
        }    //@method future
,
        future: function () {
            this.model.off('change', this.totalChange, this);
            this.addressSource.off('change', this.render, this);
        }    //@method totalChange
,
        totalChange: function () {
            var was = this.model.previous('summary').total, was_confirmation = this.model.previous('confirmation'), is = this.model.get('summary') && this.model.get('summary').total;
            // Changed from or to 0
            if ((was === 0 && is !== 0 || was !== 0 && is === 0) && !was_confirmation) {
                this.render();
            }
        }    //@property {Object} childViews
,
        childViews: {
            'Billing.Address': function () {
                return new AddressDetailsView({
                    model: this.addressSource.get(this.model.get('billaddress')),
                    hideActions: true,
                    hideDefaults: true,
                    manage: 'billaddress'
                });
            },
            'GiftCertificates.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.getGiftCertificates(),
                    viewsPerRow: 1,
                    childView: GlobalViewsFormatPaymentMethodView
                });
            },
            'PaymentMethods.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.getPaymentmethods(),
                    viewsPerRow: 1,
                    childView: GlobalViewsFormatPaymentMethodView
                });
            }
        }    //@method showPayments Indicate if in the rendering process payment method must be shown or not
             //@return {Boolean}
,
        showPayments: function () {
            if (this.options.hidePayment) {
                return false;
            }
            return !!(this.getGiftCertificates().length || this.getPaymentmethods().length || !this.wizard.hidePayment());
        }    //@method getContext
             //@returns {OrderWizard.Module.ShowPayments.Context}
,
        getContext: function () {
            var billing_address = this.addressSource.get(this.model.get('billaddress')), giftcertificates = this.getGiftCertificates(), edit_url_billing = _.isFunction(this.options.edit_url_billing) ? this.options.edit_url_billing.apply(this) : this.options.edit_url_billing;
            //@class OrderWizard.Module.ShowPayments.Context
            return {
                //@property {Boolean} showBilling
                showBilling: !this.options.hideBilling,
                showBillingAddress: !!billing_address    //@property {Boolean} showEditBillingButton
,
                showEditBillingButton: !!(billing_address && edit_url_billing)    //@property {String} editBillingUrl
,
                editBillingUrl: edit_url_billing    //@property {Boolean} showPayments
,
                showPayments: this.showPayments()    //@property {Boolean} showGuestEmail
,
                showGuestEmail: this.profile.get('isGuest') === 'T'    //@property {String} guestEmail
,
                guestEmail: this.profile.get('email')    //@property {Boolean} showGiftcertificates
,
                showGiftcertificates: !!giftcertificates.length
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @Module OrderWizard.Module.SubmitButton
define('OrderWizard.Module.SubmitButton', [
    'Wizard.Module',
    'order_wizard_submitbutton_module.tpl',
    'underscore',
    'Utils'
], function (WizardModule, order_wizard_submitbutton_module_tpl, _) {
    'use strict';
    // @class OrderWizard.Module.SubmitButton @extends WizardModule
    return WizardModule.extend({
        template: order_wizard_submitbutton_module_tpl,
        render: function () {
            this._render();
            this.trigger('ready', true);
        }    // @method getContinueButtonLabel @returns {String}
,
        getContinueButtonLabel: function () {
            var current_step = this.wizard.getCurrentStep(), label = _('Place Order').translate();
            if (current_step) {
                label = current_step.getContinueButtonLabel();
            }
            return label;
        }    // @method getContext @return OrderWizard.Module.SubmitButton.Context
,
        getContext: function () {
            // @class OrderWizard.Module.SubmitButton.Context
            return {
                //@property {Boolean} showWrapper
                showWrapper: !!this.options.showWrapper,
                wrapperClass: this.options.wrapperClass,
                continueButtonLabel: this.getContinueButtonLabel() || ''
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @Module OrderWizard.Module.TermsAndConditions
define('OrderWizard.Module.TermsAndConditions', [
    'SC.Configuration',
    'Wizard.Module',
    'order_wizard_termsandconditions_module.tpl',
    'Backbone',
    'underscore',
    'jQuery',
    'Utils'
], function (Configuration, WizardModule, order_wizard_termsandconditions_module_tpl, Backbone, _, jQuery) {
    'use strict';
    // @class OrderWizard.Module.TermsAndConditions @extends WizardModule
    return WizardModule.extend({
        template: order_wizard_termsandconditions_module_tpl,
        events: {
            'click [data-toggle="show-terms"]': 'showTerms',
            'click input[name="termsandconditions"]': 'acceptTerms'
        },
        errors: ['ERR_CHK_ACCEPT_TERMS'],
        initialize: function (options) {
            this.wizard = options.wizard;
            this.step = options.step;
            this.model = options.wizard.model;
            this.options = _.extend({ show_checkbox: true }, this.options || {});
        },
        render: function () {
            // the module is rendered only if the site requires agreement to the terms and conditions
            if (Configuration.get('siteSettings.checkout.requiretermsandconditions') === 'T') {
                this._render();
                var is_ready = Configuration.get('siteSettings.checkout.requiretermsandconditions') !== 'T' || !this.options.show_checkbox || this.$('input[name=termsandconditions]').is(':checked');
                this.trigger('ready', is_ready);
            } else {
                this.trigger('ready', true);
            }
        },
        submit: function () {
            var value = Configuration.get('siteSettings.checkout.requiretermsandconditions') !== 'T' || !this.options.show_checkbox || this.$('input[name=termsandconditions]').is(':checked');
            this.model.set('agreetermcondition', value);
            return this.isValid();
        },
        showTerms: function () {
            var TermsView = Backbone.View.extend({
                title: _('Terms and Conditions').translate(),
                render: function () {
                    this.$el.html(Configuration.get('siteSettings.checkout.termsandconditionshtml'));
                    return this;
                }
            });
            this.wizard.application.getLayout().showInModal(new TermsView());
        },
        acceptTerms: function (data) {
            var isSelected = jQuery(data.target).prop('checked'), boxes = jQuery('input[name=termsandconditions]');
            jQuery.each(boxes, function (index) {
                jQuery(boxes[index]).prop('checked', isSelected);
            });
        },
        isValid: function () {
            var promise = jQuery.Deferred(), value = Configuration.get('siteSettings.checkout.requiretermsandconditions') !== 'T' || !this.options.show_checkbox || this.model.get('agreetermcondition');
            if (!value) {
                return promise.reject({
                    errorCode: 'ERR_CHK_ACCEPT_TERMS',
                    errorMessage: _('You must accept the Terms and Conditions').translate()
                });
            } else {
                return promise.resolve();
            }
        }    // @method getContext @return OrderWizard.Module.TermsAndConditions.Context
,
        getContext: function () {
            // @class OrderWizard.Module.TermsAndConditions.Context
            return {
                // @property {Boolean} showCheckbox
                showCheckbox: this.options.show_checkbox,
                isAgreeTermCondition: this.wizard.model.get('agreetermcondition')    //@property {Boolean} showWrapper
,
                showWrapper: !!this.options.showWrapper,
                wrapperClass: this.options.wrapperClass
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module OrderWizard.Module.Confirmation
define('OrderWizard.Module.Confirmation', [
    'SC.Configuration',
    'Wizard.Module',
    'Tracker',
    'order_wizard_confirmation_module.tpl',
    'Backbone',
    'underscore',
    'jQuery',
    'Utils'
], function (Configuration, WizardModule, Tracker, order_wizard_confirmation_module_tpl, Backbone, _, jQuery, Utils) {
    'use strict';
    // @class OrderWizard.Module.Confirmation @extends Wizard.Module
    return WizardModule.extend({
        template: order_wizard_confirmation_module_tpl,
        className: 'OrderWizard.Module.Confirmation',
        render: function () {
            var confirmation = this.model.get('confirmation')    // store current order id in the hash so it is available even when the checkout process ends.
, new_hash;
            if (!_.parseUrlOptions(Backbone.history.fragment).last_order_id) {
                this.trackTransaction(confirmation);
                new_hash = Utils.addParamsToUrl(Backbone.history.fragment, { last_order_id: confirmation.get('internalid') });
                Backbone.history.navigate(new_hash, { trigger: false });
            }
            this.confirmation_number = confirmation.get('tranid') || confirmation.get('confirmationnumber');
            this.order_id = confirmation.get('internalid');
            this._render();
            if (!(this.model.get('confirmation') && this.model.get('confirmation').get('internalid'))) {
                this.$el.html('<h3>' + _('Your Order has been placed').translate() + '</h3>');
                this.$el.append('<p>' + _('Continue Shopping on our <a href="/" data-touchpoint="home">Home Page</a>. ').translate() + '</p>');
            }
        }    //@method trackTransaction Convert the LiveOrder.Model into Track.Transaction.Model until we unified it with the Transaction.Model
,
        trackTransaction: function (confirmation) {
            var summary = confirmation.get('summary'), transaction = {
                    confirmationNumber: confirmation.get('tranid'),
                    subTotal: summary.subtotal,
                    total: summary.total,
                    taxTotal: summary.taxtotal,
                    shippingCost: summary.shippingcost,
                    handlingCost: summary.handlingcost,
                    products: new Backbone.Collection()
                }, transactionModel = new Backbone.Model(transaction);
            confirmation.get('lines').each(function (line) {
                var options = [];
                line.get('options').each(function (option) {
                    if (option.get('value').label) {
                        options.push(option.get('value').label);
                    }
                });
                transactionModel.get('products').add(new Backbone.Model({
                    sku: line.getSku(),
                    name: line.get('item').get('_name'),
                    category: line.get('item').get('category'),
                    rate: line.get('rate'),
                    quantity: line.get('quantity'),
                    options: options.sort().join(', ')
                }));
            });
            Tracker.getInstance().trackTransaction(transactionModel);
        }    // @method getContext @return OrderWizard.Module.Confirmation.Context
,
        getContext: function () {
            var continue_url = '/', touchpoint = true;
            if (Configuration.get('siteSettings.iswsdk') && Configuration.get('siteSettings.wsdkcancelcarturl')) {
                continue_url = Configuration.get('siteSettings.wsdkcancelcarturl');
                touchpoint = false;
            }
            // @class OrderWizard.Module.Confirmation.Context
            return {
                // @property {String} continueURL
                continueURL: continue_url    // @property {Boolean} isGuestAndCustomerCenter
,
                isGuestAndCustomerCenter: !!(this.wizard.profileModel.get('isGuest') === 'F' && Configuration.get('siteSettings.touchpoints.customercenter'))    // @property {String} additionalConfirmationMessage
,
                additionalConfirmationMessage: this.options.additional_confirmation_message,
                touchPoint: touchpoint    // @property {String} confirmationNumber
,
                confirmationNumber: this.confirmation_number,
                orderId: this.order_id,
                pdfUrl: _.getDownloadPdfUrl({
                    asset: 'order-details',
                    id: this.order_id
                })
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Account
define('Account.Register.Model', [
    'Backbone',
    'underscore',
    'Utils'
], function (Backbone, _, Utils) {
    'use strict';
    //@class Account.Register.Model
    // Sends user input data to the register service
    // validating fields before they are sent
    // [Backbone.validation](https://github.com/thedersen/backbone.validation)
    //@extend Backbone.Model
    return Backbone.Model.extend({
        //@property {String} urlRoot
        urlRoot: Utils.getAbsoluteUrl('services/Account.Register.Service.ss')    //@property {Object} validation. Backbone.Validation attribute used for validating the form before submit.
,
        validation: {
            firstname: {
                required: true,
                msg: _('First Name is required').translate()
            },
            lastname: {
                required: true,
                msg: _('Last Name is required').translate()
            },
            email: {
                required: true,
                pattern: 'email',
                msg: _('Valid Email is required').translate()
            },
            company: {
                required: SC.ENVIRONMENT.siteSettings.registration.companyfieldmandatory === 'T',
                msg: _('Company Name is required').translate()
            },
            password: {
                required: true,
                msg: _('Please enter a valid password').translate()
            },
            password2: [
                {
                    required: true,
                    msg: _('Confirm password is required').translate()
                },
                {
                    equalTo: 'password',
                    msg: _('New Password and Confirm Password do not match').translate()
                }
            ]
        }
    });
});


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ErrorManagement
define('ErrorManagement.View', ['Backbone'], function (Backbone) {
    'use strict';
    return Backbone.View.extend({ isErrorView: true });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/* global nsglobal:true */
// @module ErrorManagement
define('ErrorManagement.ExpiredLink.View', [
    'error_management_expired_link.tpl',
    'ErrorManagement.View',
    'Backbone',
    'underscore',
    'Utils'
], function (error_management_expired_link_tpl, ErrorManagementView, Backbone, _) {
    'use strict';
    // @class ErrorManagement.ExpiredLink.View @extends Backbone.View
    return ErrorManagementView.extend({
        template: error_management_expired_link_tpl,
        attributes: {
            'id': 'expired_link',
            'class': 'expired_link'
        },
        initialize: function (options) {
            if (options.title) {
                this.title = options.title;
            }
            if (options.page_header) {
                this.page_header = options.page_header;
            }
            if (options.message) {
                this.message = options.message;
            }
            if (SC.ENVIRONMENT.jsEnvironment === 'server') {
                nsglobal.statusCode = 500;
            }
        }    // @method getContext @returns {ErrorManagement.ExpiredLink.View.Context}
,
        getContext: function () {
            // @class ErrorManagement.ExpiredLink.View.Context
            return {
                // @property {String} pageHeader 
                pageHeader: this.page_header || ''    // @property {String} message 
,
                message: this.message || _('Sorry, we could not load the content you requested.').translate()
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/* global nsglobal:true */
// @module ErrorManagement
define('ErrorManagement.ForbiddenError.View', [
    'error_management_forbidden_error.tpl',
    'ErrorManagement.View',
    'Backbone',
    'underscore',
    'Utils'
], function (error_management_forbidden_error_tpl, ErrorManagementView, Backbone, _) {
    'use strict';
    // @class ErrorManagement.ForbiddenError.View @extends Backbone.View
    return ErrorManagementView.extend({
        template: error_management_forbidden_error_tpl,
        attributes: {
            'id': 'forbidden-error',
            'class': 'forbidden-error'
        },
        title: _('NOT ALLOWED').translate(),
        page_header: _('NOT ALLOWED').translate(),
        initialize: function () {
            if (SC.ENVIRONMENT.jsEnvironment === 'server') {
                nsglobal.statusCode = 403;
            }
        }    // @method getContext @returns {ErrorManagement.ForbiddenError.View.Context}
,
        getContext: function () {
            // @class ErrorManagement.ForbiddenError.View.Context
            return {
                // @property {String} title 
                title: this.title,
                pageHeader: this.page_header
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/* global nsglobal:true */
// @module ErrorManagement
define('ErrorManagement.InternalError.View', [
    'error_management_internal_error.tpl',
    'ErrorManagement.View',
    'Backbone',
    'underscore',
    'Utils'
], function (error_management_internal_error_tpl, ErrorManagementView, Backbone, _) {
    'use strict';
    // @class ErrorManagement.InternalError.View @extends Backbone.View
    return ErrorManagementView.extend({
        template: error_management_internal_error_tpl,
        attributes: {
            'id': 'internal-error',
            'class': 'internal-error'
        },
        title: _('Internal Error').translate(),
        page_header: _('Internal Error').translate(),
        initialize: function (options) {
            if (options.title) {
                this.title = options.title;
            }
            if (options.page_header || options.pageHeader) {
                this.page_header = options.page_header || options.pageHeader;
            }
            if (options.message) {
                this.message = options.message;
            }
            if (SC.ENVIRONMENT.jsEnvironment === 'server') {
                nsglobal.statusCode = 500;
            }
        }    // @method getContext @returns {ErrorManagement.InternalError.View.Context}
,
        getContext: function () {
            // @class ErrorManagement.InternalError.View.Context
            return {
                // @property {String} pageHeader 
                pageHeader: this.page_header,
                message: this.message || _('Sorry, we could not load the content you requested.').translate()
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ErrorManagement
define('ErrorManagement.LoggedOut.View', [
    'error_management_logged_out.tpl',
    'ErrorManagement.View',
    'Backbone',
    'underscore',
    'Utils'
], function (error_management_logged_out_tpl, ErrorManagementView, Backbone, _) {
    'use strict';
    // @class ErrorManagement.LoggedOut.View @extends Backbone.View
    return ErrorManagementView.extend({
        template: error_management_logged_out_tpl,
        attributes: { 'id': 'logged-out' },
        title: _('Logged out').translate(),
        initialize: function () {
            this.labels = {
                title: _('You have been logged out').translate(),
                explanation: _('Your session expired or someone else logged in another device with your account. You must log in again to continue.').translate(),
                login: _('Log in').translate()
            };
        },
        showError: function () {
        },
        render: function () {
            var res = Backbone.View.prototype.render.apply(this, arguments);
            this.$containerModal.find('[data-dismiss="modal"]').remove();
            return res;
        }    // @method getContext @returns {ErrorManagement.LoggedOut.View.Context}
,
        getContext: function () {
            // @class ErrorManagement.LoggedOut.View.Context
            return {
                // @property {Object} labels 
                labels: this.labels
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/* global nsglobal:true */
// @module ErrorManagement
define('ErrorManagement.PageNotFound.View', [
    'error_management_page_not_found.tpl',
    'ErrorManagement.View',
    'Backbone',
    'underscore',
    'Utils'
], function (error_management_page_not_found_tpl, ErrorManagementView, Backbone, _) {
    'use strict';
    // @class ErrorManagement.PageNotFound.View @extends Backbone.View
    return ErrorManagementView.extend({
        template: error_management_page_not_found_tpl,
        attributes: {
            'id': 'page-not-found',
            'class': 'page-not-found'
        },
        title: _('Page not found').translate(),
        page_header: _('Page not found').translate(),
        initialize: function () {
            if (SC.ENVIRONMENT.jsEnvironment === 'server') {
                nsglobal.statusCode = 404;
            }
        }    // @method getContext @returns {ErrorManagement.PageNotFound.View.Context}
,
        getContext: function () {
            // @class ErrorManagement.PageNotFound.View.Context
            return {
                // @property {String} title 
                title: this.title,
                pageHeader: this.page_header
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module ErrorManagement
define('ErrorManagement.ResponseErrorParser', ['underscore'], function (_) {
    'use strict';
    //@function ErrorManagementErrorParser Parse an error message form the back-end
    //@param {jQuery.XHR} jqXhr Response obtains from a Backbone.Model/Collection AJAX
    //@param {Array<String>} messageKeys List of properties to look for a error message response in the first parameter
    //@return {String}
    return function ErrorManagementErrorParser(jqXhr, messageKeys) {
        var message = null, current_key;
        try {
            // Tries to parse the responseText and try to read the most common keys for error messages
            var response = JSON.parse(jqXhr.responseText);
            if (response) {
                for (var i = 0; i < messageKeys.length; i++) {
                    current_key = messageKeys[i];
                    if (response[current_key]) {
                        message = _.isArray(response[current_key]) ? response[current_key][0] : response[current_key];
                        break;
                    }
                }
            }
        } catch (err) {
            console.error('Impossible to parse backend error', jqXhr);
        }
        return message;
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module ErrorManagement

Extends Bakcbone.View to provide showError and hideError. Also extends the applicatoin's layout with high level error methods.

Handles all errors related to api calls and provides a 404 and 500 error pages.

Also it manages 401 error (session expires) and do the redirect to login
*/
define('ErrorManagement', [
    'SC.Configuration',
    'Session',
    'ErrorManagement.ExpiredLink.View',
    'ErrorManagement.ForbiddenError.View',
    'ErrorManagement.InternalError.View',
    'ErrorManagement.LoggedOut.View',
    'ErrorManagement.PageNotFound.View',
    'ErrorManagement.ResponseErrorParser',
    'GlobalViews.Message.View',
    'jQuery',
    'Backbone',
    'underscore',
    'Profile.Model',
    'Utils'
], function (Configuration, Session, ExpiredLinkView, ForbiddenErrorView, InternalErrorView, LoggedOutView, PageNotFoundView, ErrorManagementResponseErrorParser, GlobalViewsMessageView, jQuery, Backbone, _, ProfileModel, Utils) {
    'use strict';
    //@module Backbone @class Backbone.View
    _.extend(Backbone.View.prototype, {
        // @method hideError we empty all of the error placeholders of the view
        hideError: function () {
            this.$('[data-type="alert-placeholder"]').empty();
        }    /* @method showError @param {String} message @param {String} type @param {Boolean} closable 
		@param {Boolean} disableElements */,
        showError: function (message, type, closable, disableElements) {
            this.hideError();
            // Finds or create the placeholder for the error message
            var placeholder = this.$('[data-type="alert-placeholder"]');
            if (!placeholder.length) {
                placeholder = jQuery('<div/>', { 'data-type': 'alert-placeholder' });
                this.$el.prepend(placeholder);
            }
            var global_view_message = new GlobalViewsMessageView({
                message: message,
                type: type ? type : 'error',
                closable: !_.isUndefined(closable) ? !!closable : false
            });
            // Renders the error message and into the placeholder
            placeholder.append(global_view_message.render().$el.html());
            // Re Enables all posible disableded buttons of the view
            if (!disableElements) {
                this.$(':disabled').attr('disabled', false);
            }
            //If the backToTop module is loaded, we scroll to the top of the view to show the error.
            if (this.application) {
                _.result(this.application.getLayout(), 'backToTop');
            }
        }    //@method showErrorInModal @param  {String} message
,
        showErrorInModal: function (message) {
            var view = new Backbone.View({ application: this.application });
            view.title = _('Error').translate();
            view.render = function () {
                this.$el.append('<p class="error-message">' + message + '</p>');
            };
            view.showInModal();
        }
    });
    //@class ErrorManagement @extends ApplicationModule
    return {
        parseErrorMessage: ErrorManagementResponseErrorParser,
        mountToApp: function (application) {
            var Layout = application.getLayout();
            // @module ApplicationSkeleton @class ApplicationSkeleton.Layout
            _.extend(Layout, {
                // @property {Array<String>} errorMessageKeys
                // They will be use to try to get the error message of a failed AJAX call. Extend this as needed
                errorMessageKeys: [
                    'errorMessage',
                    'errors',
                    'error',
                    'message'
                ]    // @method notFound Shortcut to display the PageNotFoundView
,
                notFound: function () {
                    var view = new PageNotFoundView({ application: application });
                    view.showContent();
                }    // @method internalError Shortcut to display the InternalErrorView
,
                internalError: function (message, pageHeader, title) {
                    var view = new InternalErrorView({
                        application: application,
                        message: message,
                        pageHeader: pageHeader,
                        title: title
                    });
                    view.showContent();
                }    // @method expiredLink @param {String} message
,
                expiredLink: function (message) {
                    var view = new ExpiredLinkView({
                        application: application,
                        pageHeader: message,
                        title: message
                    });
                    view.showContent();
                }    // @method forbiddenError
,
                forbiddenError: function () {
                    var view = new ForbiddenErrorView({ application: application });
                    view.showContent();
                }    // @method unauthorizedError
                     // @param {Boolean?} user_session_timedOut Indicate if the error is thanks to a session time-out or not
                     // @return {Void}
,
                unauthorizedError: function (user_session_timedOut) {
                    if (Configuration.get('currentTouchpoint', '') === 'login') {
                        //This case can happen when more than one concurrent XHR is made and both
                        //return a user session time-out error
                        return;
                    }
                    ProfileModel.getInstance().set({
                        isLoggedIn: 'F',
                        isGuest: 'F'
                    });
                    var base_url = Utils.setUrlParameter(Session.get('touchpoints.login'), 'origin', Configuration.get('currentTouchpoint'));
                    base_url = Utils.setUrlParameter(base_url, 'origin_hash', Backbone.history.fragment);
                    Configuration.currentTouchpoint = 'login';
                    window.location = user_session_timedOut ? Utils.setUrlParameter(base_url, 'timeout', 'T') : base_url;
                }
            });
            jQuery(document).ajaxError(function (e, jqXhr, options, error_text) {
                var intStatus = parseInt(jqXhr.status, 10);
                if (error_text === 'abort' || intStatus === 0) {
                    return;
                }
                // Unauthorized Error, customer must be logged in - we pass origin parameter with the right touchpoint for redirect the user after login
                // 206 is returned when someone else has logged in another browser
                // with the same user. In this case the first response is a 206
                // And the following are 401
                if (intStatus === 401 || intStatus === 206) {
                    Layout.unauthorizedError(jqXhr.responseJSON && jqXhr.responseJSON.errorCode === 'ERR_USER_SESSION_TIMED_OUT');
                    return;
                }
                // You can bypass all this logic by capturing the error callback on the fetch using preventDefault = true on your jqXhr object
                if (!jqXhr.preventDefault) {
                    // if its a write operation we will call the showError of the currentView or of the modal if presetn
                    var message = ErrorManagementResponseErrorParser(jqXhr, Layout.errorMessageKeys);
                    if (!message || _.isObject(message) && !message.errorCode) {
                        message = _('An internal error has occurred').translate();
                    }
                    if (options.type === 'GET' && options.killerId) {
                        if (intStatus === 403) {
                            // Not Found error, we show that error
                            Layout.forbiddenError();
                        }    // Its a read operation that was ment to show a page
                        else if (intStatus === 404) {
                            // Not Found error, we show that error
                            Layout.notFound();
                        } else {
                            // Other ways we just show an internal error page
                            Layout.internalError(message);
                        }
                    } else if (Layout.currentView) {
                        //Do not show error message if forbidden
                        if (intStatus !== 403) {
                            // Calls the showError of the modal if present or the one of the currentView (content view)
                            if (Layout.modalCurrentView) {
                                Layout.modalCurrentView.showError(message);
                            } else {
                                var childViewInstances = Layout.currentView.getChildViewInstances();
                                var activeView = _.find(childViewInstances, function (childView) {
                                    return childView && (childView.$('.focused-form-view').length > 0 || childView.$el.is('.focused-form-view'));
                                });
                                activeView = activeView || Layout.currentView;
                                activeView.showError(message);
                            }
                        } else {
                            var view = Layout.modalCurrentView || Layout.currentView;
                            if (view && _.isFunction(view.forbiddenError)) {
                                view.forbiddenError();
                            } else {
                                Layout.forbiddenError();
                            }
                        }
                    } else {
                        // We allways default to showing the internalError of the layout
                        Layout.internalError();
                    }
                }
            });
            var control_valid_navigation = function control_valid_navigation() {
                //find a router for the current fragment
                if (!Backbone.history.started) {
                    return;
                }
                var fragment = Backbone.history.getFragment(), match = _(Backbone.history.handlers).some(function (handler) {
                        if (handler.callback && handler.route.exec(fragment)) {
                            return true;
                        }
                    });
                //if not found a router for the current fragment the page not found is displayed.
                if (!match) {
                    Layout.notFound();
                }
            };
            jQuery(window).on('hashchange', control_valid_navigation);
            application.once('afterStart', control_valid_navigation);
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module jQueryExtras
#jQuery.serializeObject
jQuery plugin used to transform a $form's data into an object literal with 'name: value' pairs. Usage: 

	this.model.save(this.$savingForm.serializeObject()).done(...)
*/
define('jQuery.serializeObject', ['jQuery'], function (jQuery) {
    'use strict';
    jQuery.fn.serializeObject = function () {
        var o = {}    // http://api.jquery.com/serializeArray/
, a = this.serializeArray();
        // When a checkbox is not checked, we need to send the "unchecked value"
        // that value is held as a data attribute: "data-unchecked-value"
        this.find('input[type=checkbox]:not(:checked)[data-unchecked-value]').each(function () {
            var $this = jQuery(this);
            a.push({
                name: $this.prop('name'),
                value: $this.data('unchecked-value')
            });
        });
        // Then we just loop through the array to create the object
        jQuery.each(a, function () {
            if (o[this.name] !== undefined) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };
    return jQuery.fn.serializeObject;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('LoginRegister.Utils', [
    'underscore',
    'jQuery',
    'Backbone',
    'ErrorManagement',
    'SC.Configuration',
    'Utils',
    'jQuery.serializeObject'
], function (_, jQuery, Backbone, ErrorManagement, Configuration) {
    'use strict';
    return {
        skipLoginCloseModal: function () {
            if (this.$containerModal && Configuration.get('checkoutApp.skipLogin')) {
                this.$containerModal.modal('hide');
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module LoginRegister
define('LoginRegister.Register.View', [
    'login_register_register.tpl',
    'SC.Configuration',
    'Account.Register.Model',
    'LoginRegister.Utils',
    'Tracker',
    'Profile.Model',
    'LiveOrder.Model',
    'Backbone.FormView',
    'Backbone',
    'underscore',
    'Utils'
], function (register_tpl, Configuration, AccountRegisterModel, LoginRegisterUtils, Tracker, ProfileModel, LiveOrderModel, BackboneFormView, Backbone, _) {
    'use strict';
    // @clasd LoginRegister.Register.View @extend Backbone.View
    return Backbone.View.extend({
        template: register_tpl,
        attributes: { 'id': 'register' },
        events: { 'submit form': 'saveForm' },
        bindings: {
            '[name="firstname"]': 'firstname',
            '[name="lastname"]': 'lastname',
            '[name="company"]': 'company',
            '[name="email"]': 'email',
            '[name="password"]': 'password',
            '[name="password2"]': 'password2'
        },
        initialize: function (options) {
            this.options = options;
            this.application = options.application;
            this.parentView = options.parentView;
            this.model = options.model || new AccountRegisterModel();
            // on save we redirect the user out of the registration page
            // as we know there hasn't been an error
            this.model.on('save', _.bind(this.redirect, this));
            BackboneFormView.add(this);
        }    // @method trackEvent tracks the 'create-account' event using the global Tracker instance
             // @param {Function} callback
,
        trackEvent: function (callback) {
            Tracker.getInstance().trackEvent({
                category: 'create-account',
                action: 'click',
                value: 1,
                callback: callback
            });
        }    // @method redirect redirects the user after successful account registration taking into account redirect (origin and origin_hash) parameters.
             // @param {Object} response the http response data object result of calling the account-register service.
,
        redirect: function (context, response) {
            var url_options = _.parseUrlOptions(window.location.search), touchpoints = response.touchpoints, application = this.application;
            if (url_options.is && url_options.is === 'checkout') {
                var profile_model = ProfileModel.getInstance();
                response.user && profile_model.set(response.user);
                response.cart && LiveOrderModel.getInstance().set(response.cart);
                response.address && profile_model.get('addresses').reset(response.address);
                response.creditcard && profile_model.get('creditcards').reset(response.creditcard);
                // Track Guest Checkout Event
                this.trackEvent(function () {
                    application.Configuration.currentTouchpoint = 'checkout';
                    Backbone.history.navigate('', { trigger: true });
                });
            } else {
                // Track Login Event
                this.trackEvent(function () {
                    // if we know from which touchpoint the user is coming from
                    if (url_options.origin && touchpoints[url_options.origin]) {
                        // we save the url to that touchpoint
                        var url = touchpoints[url_options.origin];
                        // if there is an specific hash
                        if (url_options.origin_hash) {
                            // we add it to the url as a fragment
                            url = _.addParamsToUrl(url, { fragment: url_options.origin_hash });
                        }
                        window.location.href = url;
                    } else {
                        //We've got to disable passwordProtectedSite feature if customer registration is disabled.
                        if (Configuration.getRegistrationType() !== 'disabled' && SC.ENVIRONMENT.siteSettings.siteloginrequired === 'T') {
                            window.location.href = touchpoints.home;
                        } else {
                            // otherwise we need to take it to the customer center
                            window.location.href = touchpoints.customercenter;
                        }
                    }
                });
            }
        }    // @method getContext @return {LoginRegister.Register.View.Context}
,
        getContext: function () {
            var url_options = _.parseUrlOptions(window.location.search);
            //@class LoginRegister.Register.View.Context
            return {
                // @property {Boolean} showCompanyField
                showCompanyField: SC.ENVIRONMENT.siteSettings.registration.showcompanyfield === 'T'    // @property {Boolean} isCompanyFieldRequire
,
                isCompanyFieldRequire: SC.ENVIRONMENT.siteSettings.registration.companyfieldmandatory === 'T'    // @property {Boolean} isEmailSubscribeChecked
,
                isEmailSubscribeChecked: this.options.isEmailSubscribeChecked || SC.ENVIRONMENT.siteSettings.defaultSubscriptionStatus,
                siteName: SC.ENVIRONMENT.siteSettings.displayname,
                showFormFieldsOnly: this.options.showFormFieldsOnly || false    // @property {Boolean} isRedirect
,
                isRedirect: !!(url_options.is !== 'checkout' && url_options.origin !== 'checkout')    // @property {Boolean} hasAutoFocus
,
                hasAutoFocus: url_options.is === 'register' && _.isDesktopDevice()
            };
        }    // @class LoginRegister.Register.View
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard
define('OrderWizard.Module.RegisterGuest', [
    'Wizard.Module',
    'Account.Register.Model',
    'Profile.Model',
    'LoginRegister.Register.View',
    'GlobalViews.Message.View',
    'SC.Configuration',
    'Tracker',
    'order_wizard_register_guest_module.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'underscore',
    'jQuery',
    'Utils'
], function (WizardModule, AccountRegisterModel, ProfileModel, LoginRegisterRegisterView, GlobalViewsMessageView, Configuration, Tracker, order_wizard_register_guest_module_tpl, Backbone, BackboneCompositeView, _, jQuery) {
    'use strict';
    // @class OrderWizard.Module.RegisterGuest @extends WizardModule.extend
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_register_guest_module_tpl    //@property {String} className
,
        className: 'OrderWizard.Module.RegisterGuest'    //@property {Object} events
,
        events: {
            'submit form': 'saveForm',
            'click [data-action="remove-button"]': 'removeButton'
        }    //@method initialize Defines this module as a composite view
,
        initialize: function () {
            WizardModule.prototype.initialize.apply(this, arguments);
            BackboneCompositeView.add(this);
            var self = this;
            this.model = new AccountRegisterModel();
            Backbone.Validation.bind(this);
            this.profileModel = this.profileModel || ProfileModel.getInstance();
            // when user is successfully registered we re-render the header
            this.profileModel.on('change', function (profileModel) {
                if (profileModel.get('isLoggedIn') === 'T') {
                    self.wizard.application.getLayout().updateHeader();
                }
            });
        },
        destroy: function () {
            WizardModule.prototype.destroy.apply(this, arguments);
            this.profileModel.off(null, null, this);
        }    //@method removeButton Removed the remove button
,
        removeButton: function () {
            this.$el.find('[data-action="remove-button"]').remove();
        }    //@property {Array<String>} errors List of errors handle by this module
,
        errors: [
            'AN_ACCOUNT_WITH_THAT_NAME_AND_EMAIL_ADDRESS_ALREADY_EXISTS',
            'ERR_WS_CUSTOMER_REGISTRATION',
            'ERR_WS_INVALID_EMAIL',
            'USER_ERROR'
        ]    //@method showSuccess Method called when the save operation finish successfully to show a confirmation message
,
        showSuccess: function () {
            var global_view_message = new GlobalViewsMessageView({
                message: _('Account successfully created').translate(),
                type: 'success'
            });
            this.$('form').empty().html(global_view_message.render().$el.html());
        }    //@method trackEvent Track the creation of a user account
             //@param {Function} callback
,
        trackEvent: function (callback) {
            Tracker.getInstance().trackEvent({
                category: 'create-account',
                action: 'click',
                value: 1,
                callback: callback
            });
        }    //@method saveForm Handle the submit event of the account form
             //@param {HTMLEvent} e
,
        saveForm: function (e) {
            e.preventDefault();
            this.clearError();
            var self = this, $target = jQuery(e.target), user_data = $target.serializeObject();
            this.model.set(user_data, { silent: true });
            if (this.model.isValid(true)) {
                this.profileModel = this.profileModel || ProfileModel.getInstance();
                this.$savingForm = $target.closest('form');
                var button = $target.find('button');
                button && button.prop('disabled', true);
                var promise = this.model.save(user_data);
                if (promise) {
                    promise.done(function () {
                        self.trackEvent();
                        self.profileModel.set(self.model.get('user'));
                        self.showSuccess();
                    }).fail(function (jqXhr) {
                        button && button.prop('disabled', false);
                        jqXhr.preventDefault = true;
                        self.wizard.manageError(JSON.parse(jqXhr.responseText));
                    });
                }
            }
        }    //@method saveForm Override default implementation to handle the case when the error code indicate duplicated user email
,
        showError: function () {
            if (this.error && this.error.errorCode === 'AN_ACCOUNT_WITH_THAT_NAME_AND_EMAIL_ADDRESS_ALREADY_EXISTS') {
                this.error.errorMessage = this.error.errorMessage.replace('href=\'{1}\'', 'href="#" data-touchpoint="login"');
            }
            WizardModule.prototype.showError.apply(this, arguments);
        }    //@method isActive Override default implementation to be active when the user is guest and registration type is not disabled
             //@return {Boolean}
,
        isActive: function () {
            return this.profileModel.get('isGuest') === 'T' && Configuration.getRegistrationType() !== 'disabled';
        }    // @property {Object} childViews
,
        childViews: {
            'RegisterGuestForm': function () {
                this.model.set({
                    firstname: this.profileModel.get('firstname'),
                    lastname: this.profileModel.get('lastname'),
                    email: this.profileModel.get('email'),
                    password: '',
                    password2: ''
                }, { silent: true });
                return new LoginRegisterRegisterView({
                    showFormFieldsOnly: true,
                    model: this.model
                });
            }
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Cart
define('Cart.PromocodeForm.View', [
    'ErrorManagement',
    'GlobalViews.Message.View',
    'cart_promocode_form.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'jQuery',
    'underscore',
    'Utils'
], function (ErrorManagement, GlobalViewsMessageView, cart_promocode_form_tpl, Backbone, BackboneCompositeView, jQuery, _) {
    'use strict';
    // @class Cart.PromocodeForm.View @extends Backbone.View
    return Backbone.View.extend({
        // @property {Function} template
        template: cart_promocode_form_tpl,
        events: { 'submit form[data-action="apply-promocode"]': 'applyPromocode' }    // @method initialize Override default method to define internal state and make this View composite
                                                                              // @param {Cart.PromocodeForm.View.Initialization.options} options
                                                                              // @return {Void}
,
        initialize: function (options) {
            this.promocode = options.promocode || {};
            this.state = {
                errorMessage: null,
                code: '',
                isSaving: false
            };
            this.applying_promocode = _.bind(this.applying_promocode, this);
            this.apply_promocode_succeeded = _.bind(this.apply_promocode_succeeded, this);
            this.apply_promocode_finished = _.bind(this.apply_promocode_finished, this);
            this.apply_promocode_failed = _.bind(this.apply_promocode_failed, this);
            this.model.cancelableOn('before:LiveOrder.addPromotion', this.applying_promocode);
            this.model.cancelableOn('after:LiveOrder.addPromotion', this.apply_promocode_succeeded);
            this.model.on('apply_promocode_finished', this.apply_promocode_finished);
            this.model.on('apply_promocode_failed', this.apply_promocode_failed);
            BackboneCompositeView.add(this);
        },
        destroy: function () {
            this.model.cancelableOff('before:LiveOrder.addPromotion', this.applying_promocode);
            this.model.cancelableOff('after:LiveOrder.addPromotion', this.apply_promocode_succeeded);
            this.model.off('apply_promocode_finished', this.apply_promocode_finished);
            this.model.off('apply_promocode_failed', this.apply_promocode_failed);
            this._destroy();
        },
        applying_promocode: function applying_promocode() {
            //@event {Void} applying_promocode
            this.trigger('applying_promocode');
        },
        apply_promocode_succeeded: function apply_promocode_succeeded() {
            //@event {Void} apply_promocode_succeeded
            this.trigger('apply_promocode_succeeded');
        },
        apply_promocode_finished: function apply_promocode_finished() {
            //@event {Void} apply_promocode_finished
            this.trigger('apply_promocode_finished');
        },
        apply_promocode_failed: function apply_promocode_failed() {
            //@event {Void} apply_promocode_failed
            this.trigger('apply_promocode_failed');
        }    //@method applyPromocode Adds a new promocode into the current model (LiveOrder.Model)
             //@param {DOMEvent} e
             //@return {Void}
,
        applyPromocode: function applyPromocode(e) {
            e.preventDefault();
            e.stopPropagation();
            var self = this, $target = this.$(e.target), options = $target.serializeObject();
            if (!options.promocode) {
                this.state.errorMessage = _('Promo Code is required').translate();
            } else {
                this.state.errorMessage = null;
                this.state.isSaving = true;
                this.model.addPromotion(options.promocode).fail(function savePromocodeFailed(jqXhr) {
                    jqXhr.preventDefault = true;
                    self.state.errorMessage = ErrorManagement.parseErrorMessage(jqXhr, self.options.application.getLayout().errorMessageKeys);
                }).always(function savePromocodeEnded() {
                    self.state.isSaving = false;
                    self.state.code = '';
                    self.render();
                });
            }
            this.render();
        },
        childViews: {
            'GlobalsViewErrorMessage': function () {
                var placeholder = jQuery('[data-type="promocode-error-placeholder"]');
                var global_view_message = new GlobalViewsMessageView({
                    message: this.state.errorMessage,
                    type: 'error',
                    closable: true
                });
                placeholder.html(global_view_message.render().$el.html());
            }
        }    // @method getContext
             // @return {Cart.PromocodeForm.View.Context}
,
        getContext: function getContext() {
            // @class Cart.PromocodeForm.View.Context
            return {
                // @property {Boolean} showErrorMessage
                showErrorMessage: !!this.state.errorMessage,
                errorMessage: this.state.errorMessage,
                promocodeCode: this.state.code,
                isSaving: this.state.isSaving
            };    // @class Cart.PromocodeForm.View
        }
    });
});    //@class Cart.PromocodeForm.View.Initialization.options
       //@property {LiveOrder.Model} model
       //@property {ApplicationSkeleton} application


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module OrderWizard.Module.PromocodeForm
define('OrderWizard.Module.PromocodeForm', [
    'Wizard.Module',
    'SC.Configuration',
    'Backbone.CompositeView',
    'Cart.PromocodeForm.View',
    'order_wizard_promocodeform.tpl'
], function (WizardModule, Configuration, BackboneCompositeView, CartPromocodeFormView, order_wizard_promocodeform_tpl) {
    'use strict';
    // @class OrderWizard.Module.PromocodeForm @extends Wizard.Module
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_promocodeform_tpl    //@property {Object} events
,
        events: { 'shown [data-action="show-promo-code-container"]': 'onPromocodeFormShown' }    //@method initialize
,
        initialize: function initialize() {
            WizardModule.prototype.initialize.apply(this, arguments);
            BackboneCompositeView.add(this);
            this.promocodeFormComponent = new CartPromocodeFormView({
                model: this.wizard.model,
                application: this.wizard.application
            });
            this.promocodeFormComponent.on('applying_promocode', function () {
                this.isSaving = true;
                this.trigger('change_enable_continue', false);
            }, this);
            // this.promocodeFormComponent.on('apply_promocode_finished', function ()
            this.promocodeFormComponent.on('apply_promocode_failed', function () {
                this.isSaving = false;
                this.trigger('change_enable_continue', true);
            }, this);
            this.promocodeFormComponent.on('apply_promocode_succeeded', function () {
                this.isSaving = false;
                this.trigger('change_enable_continue', true);
                this.render();
            }, this);
            this.wizard.model.on('change:promocodes', this.render, this);
        }    //@method render
             //@return {Void}
,
        render: function render() {
            if (this.state === 'present' && !this.isSaving) {
                this._render();
                this.trigger('ready', true);
            }
        }    // @method onPromocodeFormShown Handles the shown of promocode form
             // @param {jQuery.Element} e
             // @return {Void}
,
        onPromocodeFormShown: function onPromocodeFormShown(e) {
            this.$(e.target).find('input[name="promocode"]').focus();
        }    //@property {Object} childViews
,
        childViews: {
            'Cart.PromocodeForm': function () {
                return this.promocodeFormComponent;
            }
        }    //@method getContext
             //@returns {OrderWizard.Module.PromocodeForm.Context}
,
        getContext: function getContext() {
            //@class OrderWizard.Module.PromocodeForm.Context
            return {
                //@property {LiveOrder.Model} model
                model: this.wizard.model,
                showPromocodeForm: Configuration.get('promocodes.allowMultiples', true) || !this.wizard.model.get('promocodes').length
            };    //@class OrderWizard.Module.PromocodeForm
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Cart
define('Cart.Promocode.Notifications.View', [
    'GlobalViews.Message.View',
    'cart_promocode_notifications.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'underscore'
], function (GlobalViewsMessageView, cart_promocode_notifications, Backbone, BackboneCompositeView, _) {
    'use strict';
    //@class Cart.Promocode.Notification.View @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: cart_promocode_notifications    //@method initialize
                                        //@return {Void}
,
        initialize: function initialize() {
            BackboneCompositeView.add(this);
            this.on('afterCompositeViewRender', this.afterViewRender, this);
        }    // @property {ChildViews} childViews
,
        childViews: {
            'Promocode.Notification': function () {
                var notification;
                if (this.model.get('type') === 'FREEGIFT' && !!this.model.get('freegiftinfo')) {
                    notification = this.getFreeGiftNotification(this.model.get('freegiftinfo')[0], this.model.get('freegiftinfo')[1]);
                } else {
                    notification = this.getNotification();
                }
                return new GlobalViewsMessageView({
                    message: notification.message,
                    type: notification.type,
                    closable: true
                });
            }
        }    // @method afterViewRender lets parent model know the promotion already shwoed its current notification
             // @return {Void}
,
        afterViewRender: function () {
            this.options.parentModel.trigger('promocodeNotificationShown', this.model.get('internalid'));
        }    // @method getNotification 
             // @return {Notification}
,
        getNotification: function () {
            var notification = {};
            if (this.model.get('applicabilitystatus') === 'APPLIED') {
                notification.type = 'success';
                notification.message = _('Promotion <strong>$(0)</strong> is now discounting your order.').translate(this.model.get('code'));
            } else if (this.model.get('applicabilityreason') === 'CRITERIA_NOT_MET') {
                notification.type = !this.model.get('isautoapplied') ? 'warning' : 'info';
                notification.message = _('Promotion <strong>$(0)</strong> is not discounting your order. $(1)').translate(this.model.get('code'), this.model.get('errormsg'));
            } else if (this.model.get('applicabilityreason') === 'DISCARDED_BEST_OFFER') {
                notification.type = 'info';
                notification.message = _('We have chosen the best possible offer for you. Promotion <strong>$(0)</strong> is not discounting your order.').translate(this.model.get('code'));
            }
            return notification;
        }    // @method getFreeGiftNotification
             // @return {Notification}
,
        getFreeGiftNotification: function (free_gift_info_old, free_gift_info_current) {
            if (!free_gift_info_old) {
                return this.setFreeGifttNotification('success', free_gift_info_current.qtygiven);
            } else if (!free_gift_info_current) {
                return this.setFreeGifttNotification('warning', free_gift_info_old.qtygiven);
            } else {
                var qty_diff = free_gift_info_current.qtygiven - free_gift_info_old.qtygiven;
                if (qty_diff > 0) {
                    return this.setFreeGifttNotification('success', qty_diff);
                } else {
                    return this.setFreeGifttNotification('warning', qty_diff * -1);
                }
            }
        },
        setFreeGifttNotificationText: function (message_type, gift_quantity) {
            var notification = {};
            notification.type = message_type;
            if (message_type === 'success') {
                if (gift_quantity > 1) {
                    notification.message = _('Congratulations! $(0) FREE $(1) were added to your cart.').translate(gift_quantity, this.model.get('freegiftname'));
                } else {
                    notification.message = _('Congratulations! $(0) FREE $(1) was added to your cart.').translate(gift_quantity, this.model.get('freegiftname'));
                }
            } else if (message_type === 'warning') {
                var errormsg = !!this.model.get('errormsg') ? this.model.get('errormsg') : '';
                if (gift_quantity > 1) {
                    notification.message = _('$(0) $(1) were removed from your cart. $(2)').translate(gift_quantity, this.model.get('freegiftname'), errormsg);
                } else {
                    notification.message = _('$(0) $(1) was removed from your cart. $(2)').translate(gift_quantity, this.model.get('freegiftname'), errormsg);
                }
            }
            return notification;
        }    //@method getContext
             //@return {Cart.Promocode.Notifications.View.context}
,
        getContext: function getContext() {
            //@class Cart.Promocode.Notifications.View.context
            return {};    //@class Cart.Promocode.Notifications.View
        }
    });
});


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module OrderWizard.Module.PromocodeNotifications
define('OrderWizard.Module.PromocodeNotifications', [
    'Wizard.Module',
    'SC.Configuration',
    'Backbone.CollectionView',
    'Cart.Promocode.Notifications.View',
    'order_wizard_promocodenotifications.tpl',
    'notifications.tpl',
    'underscore',
    'jQuery'
], function (WizardModule, Configuration, BackboneCollectionView, CartPromocodeNotificationsView, order_wizard_promocodenotifications_tpl, notifications_tpl, _, jQuery) {
    'use strict';
    // @class OrderWizard.Module.PromocodeNotifications @extends Wizard.Module
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_promocodenotifications_tpl    //@method initialize
,
        initialize: function initialize() {
            WizardModule.prototype.initialize.apply(this, arguments);
            if (this.isActive()) {
                this.wizard.model.on('change:promocodes', this.render, this);
                this.wizard.model.on('promocodeNotificationShown', this.removePromocodeNotification, this);
            }
        },
        isActive: function isActive() {
            return !notifications_tpl && !!order_wizard_promocodenotifications_tpl;
        },
        render: function () {
            if (this.isActive()) {
                if (!this.was_rendered) {
                    this.was_rendered = true;
                    this._render();
                }
                var promocodes = _.filter(this.wizard.model.get('promocodes') || [], function (promocode) {
                    return promocode.notification === true;
                });
                if (promocodes.length) {
                    var message_collection_view = new BackboneCollectionView({
                        collection: promocodes,
                        viewsPerRow: 1,
                        childView: CartPromocodeNotificationsView,
                        childViewOptions: { parentModel: this.wizard.model }
                    });
                    message_collection_view.render();
                    jQuery('[data-type="Promocode.Notifications"]').html(message_collection_view.$el.html());
                }
            }
        }    // @method removePromocodeNotification 
             // @param String promocode_id
             // @return {Void}
,
        removePromocodeNotification: function (promocode_id) {
            var promocode = _.findWhere(this.wizard.model.get('promocodes'), { internalid: promocode_id });
            delete promocode.notification;
        }    //@method getContext
             //@returns {OrderWizard.Module.PromocodeNotifications.Context}
,
        getContext: function getContext() {
            //@class OrderWizard.Module.PromocodeNotifications.Context
            return {};    //@class OrderWizard.Module.PromocodeNotifications
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module OrderWizard
define('OrderWizard.Module.MultiShipTo.Select.Addresses.Shipping', [
    'OrderWizard.Module.Address',
    'Address.Collection',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'GlobalViews.Message.View',
    'order_wizard_msr_addresses_module.tpl',
    'underscore',
    'jQuery',
    'Utils'
], function (OrderWizardModuleAddress, AddressCollection, BackboneCompositeView, BackboneCollectionView, GlobalViewsMessageView, order_wizard_msr_addresses_module_tpl, _, jQuery) {
    'use strict';
    // @class OrderWizard.Module.MultiShipTo.Select.Addresses.Shipping @extend OrderWizard.Module.Address
    return OrderWizardModuleAddress.extend({
        //@property {Function} template
        template: order_wizard_msr_addresses_module_tpl    //@property {String} manage Defines the address being edited by the current view
,
        manage: 'shipaddress'    //@property {String} sameAsManage
,
        sameAsManage: 'billaddress'    //@property {Boolean} isSameAsEnabled
,
        isSameAsEnabled: false    //@property {Object<errorMessage:String,errorCode:String>} atLeastTwoValidAddressesErrorMessage
,
        atLeastTwoValidAddressesErrorMessage: {
            errorMessage: _('You need at least 2 valid shipping addresses').translate(),
            errorCode: 'ERR_MST_MIN_ADDRESSES'
        }    //@property {Array<String>} errors List of errors being handle by this module
,
        errors: [
            'ERR_CHK_INCOMPLETE_ADDRESS',
            'ERR_CHK_INVALID_ADDRESS',
            'NOT_ERR_SAVE_ADDR',
            'ERR_MST_MIN_ADDRESSES'
        ]    //@property {Object<errorCode:String>} saveAddressFakeErrorMessage
,
        saveAddressFakeErrorMessage: { errorCode: 'NOT_ERR_SAVE_ADDR' }    //@property {Object} newEvents List of event to add to the base class
,
        newEvents: { 'click [data-action="add-edit-addreses-link"]': 'showAllAddresses' }    // @method initialize  We override this method in order to mark as checked each address that is already checked from back-end
,
        initialize: function () {
            _.extend(this.events, this.newEvents);
            _.extend(this.childViews, this.extraChildViews);
            OrderWizardModuleAddress.prototype.initialize.apply(this, arguments);
            var self = this;
            this.wizard.is_editing_addresses = false;
            this.addresses = this.wizard.options.profile.get('addresses');
            //When by options is specified that when there are enough valid addresses only show a link, this flag control if render addresses or not
            self.hide_addresses = true;
            self.showSaveButton = self.options.showSaveButton;
            self.wizard.model.on('ismultishiptoUpdated', this.render, this);
            this.addresses.once('reset', function () {
                self.hide_addresses = self.hasEnoughValidAddresses();
            });
            this.addresses.on('destroy remove', function (model) {
                _.each(self.wizard.model.get('lines').where({ shipaddress: model.id }), function (line) {
                    line.unset('shipaddress');
                    line.unset('shipmethod');
                });
            });
            self.atLeastTwoValidAddressesErrorMessage.errorMessage = _('You need at least $(0) valid shipping addresses').translate(this.minValidAddressesQuantity);
            this.wizard.model.on('ismultishiptoUpdated', _.bind(this.render, this));
        }    //As we always want to render the complete list of addresses we never set one address
,
        setAddress: jQuery.noop,
        minValidAddressesQuantity: 1    //@property {Number} minSkipAddressesQuantity
,
        minSkipAddressesQuantity: 2    // @method getIsCurrentUserGuest In the case of Multi Ship To we need to return false to support adding multiple addresses with a inline form without generating duplicated values
             // IF guest user are not supported in Multi Ship To, this should be controlled in the OrderWizard.Module.MultiShipto.EnableLink.js
             //@return {Boolean}
,
        getIsCurrentUserGuest: function () {
            return false;
        }    // @method newAddressCreated When there is no address created at all, and a new one is made this method is called by super with the id if the new address created
,
        newAddressCreated: function (id, add_options) {
            this.trigger('change_enable_continue', true);
            if (!add_options || add_options.silent)
                //This occur on guest or when the first address is created (no previous address exists)
                {
                    //This event is fire in order to update/notify the MST.Addresses.Packages Module to re-render itself
                    // and Address.Billing to show the new addresses created
                    this.wizard.model.trigger('address_added');
                }
        }    // @method showAllAddresses In OPC expand all this module in case it's collapsed in one link
,
        showAllAddresses: function (e) {
            e.preventDefault();
            this.hide_addresses = false;
            this.render();
        }    // @method isActive Indicate if the current module need to be shown or not.
             // @return {Boolean}
,
        isActive: function () {
            if (~window.location.hash.indexOf(this.options.edit_addresses_url)) {
                this.showModule = true;
            }
            return this.wizard.isMultiShipTo() && (this.showModule || this.wizard.model.shippingAddressIsRequired() && !this.hasEnoughtSkipAddresses());
        },
        render: function () {
            if (this.isActive()) {
                jQuery('.wizard-content .alert-error').hide();
                return OrderWizardModuleAddress.prototype.render.apply(this, arguments);
            }
            this.$el.empty();
            if (!this.isMultShipToAddressListMandatory) {
                this.trigger('change_visible_back', false);
            }
            if (this.wizard.is_editing_addresses) {
                this.wizard.is_editing_addresses = false;
            }
        }    // @method submit Save the current model
             // @return {jQuery.Deferred}
,
        submit: function () {
            jQuery('.wizard-content .alert-error').hide();
            this.$('.multishipto-save-address-btn').attr('disabled', true);
            var super_result = OrderWizardModuleAddress.prototype.submit.apply(this, arguments), self = this, result = jQuery.Deferred();
            super_result.always(function () {
                self.$('.multishipto-save-address-btn').attr('disabled', false);
            });
            if (this.addressView) {
                super_result.then(function () {
                    result.reject(self.saveAddressFakeErrorMessage);
                }, result.reject);
                return result;
            }
            return super_result;
        }    // @method getValidAddreses Returns the list of valid addresses
             // @return {Address.Model}
,
        getValidAddreses: function () {
            return this.addresses.where({ isvalid: 'T' });
        }    // @method hasEnoughtSkipAddresses Determines if the quantity of valid addresses is enough to skip this module, used by the proxy to not show this step
             // @return {Boolean}
,
        hasEnoughtSkipAddresses: function () {
            return this.getValidAddreses().length >= this.minSkipAddressesQuantity;
        }    // @method hasEnoughValidAddresses Determines if the quantity of valid addresses is enough to validate this module
,
        hasEnoughValidAddresses: function () {
            return this.getValidAddreses().length >= this.minValidAddressesQuantity;
        }    // @method isValid This module will be valid only if MSR is NOT enable OR at least one address is valid and selected
             // @return {jQuery.Deferred}
,
        isValid: function () {
            if (!this.wizard.model.get('ismultishipto') || this.hasEnoughValidAddresses()) {
                return jQuery.Deferred().resolve();
            }
            return jQuery.Deferred().reject(this.atLeastTwoValidAddressesErrorMessage);
        }    // @method manageError Handle the fake error throw by the Save method
,
        manageError: function (error) {
            if (error && error.errorCode !== 'NOT_ERR_SAVE_ADDR') {
                OrderWizardModuleAddress.prototype.manageError.apply(this, arguments);
            }
        }    // @method getAddressListOptions Get the object containing the options to be passed to the Address.Details view when rendering the list of available addresses
             // @return {showSelect:Boolean,showMultiSelect:Boolean,selectMessage:String,hideDefaults:Boolean,showError:Boolean}
,
        getAddressListOptions: function () {
            return {
                showSelect: false,
                showMultiSelect: false,
                selectMessage: this.selectMessage || '',
                hideDefaults: true,
                showError: true
            };
        }    // @method getContext
             // @return {OrderWizard.Module.MultiShipTo.Select.Addresses.Shipping.Context}
,
        getContext: function () {
            var has_enough_valid_addresses = this.hasEnoughValidAddresses();
            // @class OrderWizard.Module.MultiShipTo.Select.Addresses.Shipping
            return {
                // @property {Boolean} showTitle
                showTitle: !!(!this.options.hide_title && this.getTitle())    // @property {Stirng} title
,
                title: this.getTitle()    // @property {Boolean} showCollapsedView
,
                showCollapsedView: !!(this.options.hide_if_valid_addresses && has_enough_valid_addresses && this.hide_addresses)    // @property {Boolean} isAddressListLengthGreaterThan0
,
                isAddressListLengthGreaterThan0: this.getAddressesToShow().length > 0    // @property {Boolean} showManageValue
,
                showManageValue: !!this.manage,
                manageValue: this.manage,
                hasEnoughValidAddresses: has_enough_valid_addresses    // @property {Boolean} showSaveButton
,
                showSaveButton: this.showSaveButton
            };    // @class OrderWizard.Module.MultiShipTo.Select.Addresses.Shipping
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Transaction.Line.Views
define('Transaction.Line.Views.Option.View', [
    'SC.Configuration',
    'Backbone',
    'underscore',
    'backbone.stickit'
], function (Configuration, Backbone, _) {
    'use strict';
    //@class Transaction.Line.Views.Option.View.initialize
    //@property {Transaction.Line.Model} line
    //@property {String} templateName As this view can be used to show options in all state (selected or to be selected) it is required to specify
    //what template should be used from the list of templates in configuration. If not value is given 'selector' is used, note that this value
    //is used to select option (in the PDP for instance)
    //@property {Backbone.Model<Transaction.Line.Option.Model>} model
    // @class Transaction.Line.Views.Option.View @extends Backbone.View
    return Backbone.View.extend({
        //@initialize initialize Set the option template and values availability
        //@param {Transaction.Line.Views.Option.View.initialize} options
        //@return {Void}
        initialize: function () {
            this.config = _.findWhere(Configuration.get('ItemOptions.optionsConfiguration', []), { cartOptionId: this.model.get('cartOptionId') }) || { templates: {} };
            this.config.templates = this.config.templates || {};
            this.line_model = this.options.line;
            var item_options_default_templates = Configuration.get('ItemOptions.defaultTemplates', {});
            if (item_options_default_templates && item_options_default_templates.selectorByType) {
                // Sets templates for this option
                if (!this.config.templates.selector) {
                    var option_selector_template = item_options_default_templates.selectorByType[this.model.get('type')], default_option_selector_template = item_options_default_templates.selectorByType['default'];
                    this.config.templates.selector = option_selector_template || default_option_selector_template;
                }
                if (!this.config.templates.selected) {
                    var selected_option_template = item_options_default_templates.selectedByType[this.model.get('type')], default_selected_option_template = item_options_default_templates.selectedByType['default'];
                    this.config.templates.selected = selected_option_template || default_selected_option_template;
                }
            }
            this.options.templateName = this.options.templateName || 'selector';
            this.template = this.config.templates[this.options.templateName];
        },
        render: function () {
            if (!this.model.get('value') || !this.model.get('value').internalid) {
                return this;
            }
            return this._render();
        }    //@method getContext
             //@returns {Transaction.Line.Views.Option.View.Context}
,
        getContext: function () {
            var self = this, selected_value = this.model.get('value') || {}, values = _.map(this.model.get('values') || [], function (value) {
                    var color = '', is_color_tile = false, image = {}, is_image_tile = false;
                    if (self.model.get('colors')) {
                        color = self.model.get('colors')[value.label] || self.model.get('colors').defaultColor;
                        if (_.isObject(color)) {
                            image = color;
                            color = '';
                            is_image_tile = true;
                        } else {
                            is_color_tile = true;
                        }
                    }
                    //@class ItemOptions.Option.View.Value
                    return {
                        // @property {String} internalid
                        internalid: value.internalid,
                        isAvailable: value.isAvailable,
                        label: value.label,
                        isActive: value.internalid === selected_value.internalid,
                        color: color    // @property {Boolean} isColorTile
,
                        isColorTile: is_color_tile    // @property {Boolean} isImageTile
,
                        isImageTile: is_image_tile    // @property {Object} image
,
                        image: image    // @property {Boolean} isLightColor
,
                        isLightColor: _.contains(Configuration.get('layout.lightColors', []), value.label)
                    };    //@class Transaction.Line.Views.Option.View
                });
            selected_value = _.extend({}, selected_value, _.findWhere(values, { internalid: selected_value.internalid }) || {});
            selected_value.label = selected_value.label || selected_value.internalid;
            // @class Transaction.Line.Views.Option.View.Context
            return {
                // @property {Transaction.Line.Option.Model} model
                model: this.model,
                values: values    // @property {Boolean} showSelectedValue
,
                showSelectedValue: !!selected_value    // @property {Boolean} isMandatory
,
                isMandatory: this.model.get('isMandatory')    // @property {String} itemOptionId
,
                itemOptionId: this.model.get('itemOptionId')    // @property {String} cartOptionId
,
                cartOptionId: this.model.get('cartOptionId')    // @property {String} label
,
                label: this.config && this.config.label || this.model.get('label')    // @property {ItemViews.Option.View.Option} selectedValue
,
                selectedValue: selected_value    // @property {Boolean} isTextArea
,
                isTextArea: this.model.get('type') === 'textarea'    // @property {Boolean} isEmail
,
                isEmail: this.model.get('type') === 'email'    // @property {Boolean} isText
,
                isText: this.model.get('type') === 'text'    // @property {Boolean} isSelect
,
                isSelect: this.model.get('type') === 'select'    // @property {Boolean} isCheckbox
,
                isCheckbox: this.model.get('type') === 'checkbox'    // @property {Boolean} idDate
,
                isDate: this.model.get('type') === 'date'    // @property {String} htmlId
,
                htmlId: 'option-' + this.model.get('cartOptionId')    // @property {String} htmlIdContainer
,
                htmlIdContainer: this.model.get('cartOptionId') + '-container'
            };    // @class Transaction.Line.Views.Option.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Transaction.Line.Views
define('Transaction.Line.Views.Options.Selected.View', [
    'Transaction.Line.Views.Option.View',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'transaction_line_views_options_selected.tpl',
    'Backbone'
], function (TransactionLineViewsOptionView, BackboneCompositeView, BackboneCollectionView, transaction_line_views_options_selected_tpl, Backbone) {
    'use strict';
    //@class ItemOptions.Options.View.initialize
    //@property {Transaction.Line.Model} model
    //@class ItemOptions.Options.View
    return Backbone.View.extend({
        //@property {Function} template
        template: transaction_line_views_options_selected_tpl    //@method initialize Override default method to made current view composite
                                                       //@param {ItemOptions.Options.View.initialize} options
                                                       //@return {Void}
,
        initialize: function () {
            BackboneCompositeView.add(this);
        }    //@property {ChildViews} childViews
,
        childViews: {
            'Options.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.model.getVisibleOptions(),
                    childView: TransactionLineViewsOptionView,
                    viewsPerRow: 1,
                    childViewOptions: {
                        line: this.model,
                        templateName: 'selected'
                    }
                });
            }
        }    //@method getContext
             //@return {ItemOptions.Options.View.Context}
,
        getContext: function () {
            //@class ItemOptions.Options.View.Context
            return { model: this.model };    //@class ItemOptions.Options.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductLine
define('ProductLine.Stock.View', [
    'product_line_stock.tpl',
    'Backbone'
], function (product_line_stock_tpl, Backbone) {
    'use strict';
    // @class ProductLine.Stock.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_line_stock_tpl    //@method initialize Override default method to attach model's change event to re-render
                                  //@param {ProductLine.Stock.View.Initialize.options} options
                                  //@return {Void}
,
        initialize: function () {
            this.model.on('change', this.render, this);
        }    //@method destroy Override default method to detach from model's change event
             //@return {Void}
,
        destroy: function destroy() {
            Backbone.View.prototype.destroy.apply(this, arguments);
            this.model.off('change', this.render, this);
        }    //@method getContext
             //@return {ProductLine.Stock.View.Context}
,
        getContext: function () {
            this.stock_info = this.model.getStockInfo();
            //@class ProductLine.Stock.View.Context
            return {
                //@property {Boolean} showOutOfStockMessage
                showOutOfStockMessage: !!(!this.stock_info.isInStock && this.stock_info.showOutOfStockMessage)    //@property {Item.Model.StockInfo} stockInfo
,
                stockInfo: this.stock_info,
                model: this.model,
                showInStockMessage: !(!this.stock_info.isInStock && this.stock_info.showOutOfStockMessage) && !!this.stock_info.showInStockMessage,
                isNotAvailableInStore: this.stock_info.isNotAvailableInStore
            };    //@class ProductLine.Stock.View
        }
    });
});    //@class ProductLine.Stock.View.Initialize.options
       //@property {Transaction.Line.Model|Item.Model|Product.Model} model


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductLine
define('ProductLine.Sku.View', [
    'product_line_sku.tpl',
    'Backbone'
], function (product_line_sku_tpl, Backbone) {
    'use strict';
    // @class ProductLine.Sku.View @extends Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: product_line_sku_tpl    //@method initialize Override default method to attach model's change event to re-render
                                //@param {ProductLine.Sku.View.Initialize.options} options
                                //@return {Void}
,
        initialize: function () {
            this.model.on('change', this.render, this);
        }    //@method destroy Override default method to detach from model's change event
             //@return {Void}
,
        destroy: function destroy() {
            Backbone.View.prototype.destroy.apply(this, arguments);
            this.model.off('change', this.render, this);
        }    // @method getContext
             // @returns {ProductLine.Sku.View.Context}
,
        getContext: function () {
            //@class ProductLine.Sku.View.Context
            return {
                //@property {Product.Model|Transaction.Line.Model|Item.Model} model
                model: this.model,
                sku: this.model.getSku()
            };    //@class ProductLine.Sku.View
        }
    });
});    //@class ProductLine.Sku.View.Initialize.options
       //@property {Transaction.Line.Model|Item.Model|Product.Model} model


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductLine
define('ProductLine.StockDescription.View', [
    'product_line_stock_description.tpl',
    'Backbone'
], function (product_line_stock_description_tpl, Backbone) {
    'use strict';
    // @class ProductLine.StockDescription.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_line_stock_description_tpl    //@method initialize Override default method to attach model's change event to re-render
,
        initialize: function () {
            this.model.on('change', this.render, this);
        }    //@method getContext
             //@return {ProductLine.StockDescription.View.Context}
,
        getContext: function () {
            this.stock_info = this.model.getStockInfo();
            //@class ProductLine.Stock.View.Context
            return {
                //@property {Boolean} showStockDescription
                showStockDescription: !!(this.stock_info.showStockDescription && this.stock_info.stockDescription)    //@property {Item.Model.StockInfo} stockInfo
,
                stockInfo: this.stock_info
            };    //@class ProductLine.StockDescription.View
        }
    });
});    //@class ProductLine.StockDescription.View.Initialize.options


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Transaction.Line.Views
define('Transaction.Line.Views.Cell.Selectable.View', [
    'Transaction.Line.Views.Options.Selected.View',
    'ProductLine.Stock.View',
    'ProductLine.Sku.View',
    'ProductLine.StockDescription.View',
    'Backbone.CompositeView',
    'transaction_line_views_cell_selectable.tpl',
    'Backbone',
    'underscore'
], function (TransactionLineViewsOptionsSelectedView, ProductLineStockView, ProductLineSkuView, ProductLineStockDescriptionView, BackboneCompositeView, transaction_line_views_cell_selectable_tpl, Backbone, _) {
    'use strict';
    //@class Transaction.Line.Views.Selectable.View @extend Backbone.View
    return Backbone.View.extend({
        template: transaction_line_views_cell_selectable_tpl,
        initialize: function (options) {
            this.options = options;
            this.application = options.application;
            this.model = options.model;
            BackboneCompositeView.add(this);
        },
        childViews: {
            'Item.Options': function () {
                return new TransactionLineViewsOptionsSelectedView({ model: this.model });
            },
            'Detail1.View': function () {
                var View = this.options.detail1, detail1_options = _.extend({ model: this.model }, this.options.detail1Options || {});
                return new View(detail1_options);
            },
            'ItemViews.Stock.View': function () {
                return new ProductLineStockView({ model: this.model.get('item') });
            },
            'Item.Sku': function () {
                return new ProductLineSkuView({ model: this.model });
            },
            'StockDescription': function () {
                return new ProductLineStockDescriptionView({ model: this.model.get('item') });
            }
        }    //@method getContext
             //@return {Transaction.Line.Views.Selectable.View.Context}
,
        getContext: function () {
            var item = this.model.get('item'), line = this.model;
            //@class Transaction.Line.Views.Selectable.View.Context
            return {
                //@property {String} itemId
                itemId: item.get('internalid')    //@property {String} itemType
,
                itemType: item.get('itemtype')    //@property {String} itemName
,
                itemName: item.get('_name')    //@property {String} lineId
,
                lineId: line.id,
                isLineSelected: line.get('check')    //@property {String} rateFormatted
,
                rateFormatted: line.get('rate_formatted')    //@property {Boolean} showOptions
,
                showOptions: !!(line.get('options') && line.get('options').length)    //@property {Boolean} isNavigable
,
                isNavigable: !!this.options.navigable,
                itemURLAttributes: this.model.getFullLink({
                    quantity: null,
                    location: null,
                    fulfillmentChoice: null
                })    //@property {Boolean} showDetail1Title
,
                showDetail1Title: !!this.options.detail1Title,
                detail1Title: this.options.detail1Title,
                detail1: line.get(this.options.detail1)    //@property {Boolean} isDetail1Composite
,
                isDetail1Composite: _.isFunction(this.options.detail1)    //@property {Boolean} showDetail2Title
,
                showDetail2Title: !!this.options.detail2Title,
                detail2Title: this.options.detail2Title,
                detail2: line.get(this.options.detail2)    //@property {Boolean} showDetail3Title
,
                showDetail3Title: !!this.options.detail3Title,
                detail3Title: this.options.detail3Title,
                detail3: line.get(this.options.detail3)    // @property {ImageContainer} thumbnail
,
                thumbnail: this.model.getThumbnail()
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard
define('OrderWizard.Module.MultiShipTo.Package.Creation.EditQuantity', [
    'Backbone',
    'order_wizard_msr_package_creation_edit_quantity.tpl',
    'underscore',
    'Utils'
], function (Backbone, order_wizard_msr_package_creation_edit_quantity_tpl, _) {
    'use strict';
    //@class OrderWizard.Module.MultiShipTo.Package.Creation.EditQuantity @extend Backbone.View
    return Backbone.View.extend({
        template: order_wizard_msr_package_creation_edit_quantity_tpl    //@method getContext @return {OrderWizard.Module.MultiShipTo.Package.Creation.EditQuantity.Context}
,
        getContext: function () {
            var quantity = this.model.get('quantity'), min_quantity = this.model.get('minimumquantity') || 1, has_minimum_quantity_constrain = min_quantity > 1 && quantity < 2 * min_quantity;
            //@class OrderWizard.Module.MultiShipTo.Package.Creation.EditQuantity.Context
            return {
                //@property {Boolean} totalQuantityGreaterThan1
                totalQuantityGreaterThan1: quantity > 1    //@property {Number} totalQuantity
,
                totalQuantity: quantity    //@property {Boolean} isReadOnly
,
                isReadOnly: !this.model.get('check') || quantity === 1 || has_minimum_quantity_constrain    //@property {String} itemId
,
                itemId: this.model.get('item').id,
                selectedQuantity: this.model.get('splitquantity') || quantity    //@property {Boolean} isDesktop
,
                isDesktop: _.isDesktopDevice()    //@property {Boolean} showMinimumQuantity
,
                showMinimumQuantity: min_quantity > 1    //@property {Integer} minimumQuantity
,
                minQuantity: min_quantity
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard
define('OrderWizard.Module.MultiShipTo.Package.Creation', [
    'Wizard.Module',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'Transaction.Line.Views.Cell.Selectable.View',
    'OrderWizard.Module.MultiShipTo.Package.Creation.EditQuantity',
    'Address.Details.View',
    'order_wizard_msr_package_creation.tpl',
    'underscore',
    'jQuery',
    'Utils'
], function (WizardModule, BackboneCompositeView, BackboneCollectionView, TransactionLineViewsCellSelectableView, OrderWizardModuleMultiShipToSetAddressesPackageEditQuantity, AddressDetailsView, order_wizard_msr_package_creation_tpl, _, jQuery) {
    'use strict';
    //@class OrderWizard.Module.MultiShipTo.Package.Creation @extend Wizard.Module
    return WizardModule.extend({
        template: order_wizard_msr_package_creation_tpl,
        allItemShouldBelongToAPackage: {
            errorMessage: _('Some of your items are not assigned to a shipping address. Please, go back to shipping step.').translate(),
            errorCode: 'ERR_MST_ITEM_WITHOUT_PACKAGE'
        },
        errors: ['ERR_MST_ITEM_WITHOUT_PACKAGE'],
        events: {
            'click [data-action="select-unselected-item"]': 'selectLine',
            'click [data-action="sub-quantity"]': 'subQuantity',
            'click [data-action="add-quantity"]': 'addQuantity',
            'change [data-action="split-quantity"]': 'updateLineQuantity',
            'change [data-action="set-shipments-address-selector"]': 'setSelectedAddressId',
            'click [data-action="select-unselect-all"]': 'selectUnselectAll',
            'click [data-action="create-shipments"]': 'applyCurrentAddress'
        },
        initialize: function (options) {
            this.options = options;
            WizardModule.prototype.initialize.apply(this, arguments);
            var self = this;
            this.selected_address_id = null;
            this.createShipmentLabel = '';
            this.createShipmentEnabled = false;
            this.wizard.model.on('multishipto-line-updated', function () {
                self.selected_address_id = self.getFirstAddressIdWithoutShipments();
                self.render();
            });
            self.wizard.options.profile.get('addresses').once('reset', function () {
                self.selected_address_id = self.getFirstAddressIdWithoutShipments();
            });
            BackboneCompositeView.add(this);
        },
        updateLineQuantity: function (event) {
            var target = jQuery(event.currentTarget), target_control_group = target.closest('[data-validation="control-group"]'), message_placeholder = target_control_group.find('[data-validation="error-placeholder"]'), create_shippment_button = this.$('[data-action="create-shipments"]'), line_id = target.closest('[data-type="row"]').data('lineId'), selected_line = this.wizard.model.get('lines').get(line_id), min_quantity = selected_line.get('minimumquantity') || 1, quantity = selected_line.get('quantity'), new_quantity = parseInt(target.val(), 10);
            //invalid values return to default quantity
            if (isNaN(new_quantity) || new_quantity > quantity) {
                target.val(quantity);
                return;
            }
            if (min_quantity > new_quantity) {
                target.val(min_quantity);
                return;
            }
            if (quantity - new_quantity >= min_quantity || new_quantity === quantity) {
                target_control_group.removeAttr('data-validation-error');
                create_shippment_button.removeAttr('disabled');
                message_placeholder.empty().hide();
                selected_line.set('splitquantity', new_quantity);
            } else {
                target_control_group.attr('data-validation-error', '');
                create_shippment_button.attr('disabled', '');
                selected_line.unset('splitquantity');
                var message = _('The remaining quantity of items ($(0)) should be more than the minimum quantity required').translate(quantity - new_quantity);
                message_placeholder.text(message).show();
            }
        }    // @method addQuantity plus/minus Quantity
,
        addQuantity: function (e) {
            e.stopPropagation();
            var $line = jQuery(e.target).closest('[data-type="row"]'), quantity_edit = $line.find('[data-action="split-quantity"]'), new_quantity = parseFloat(quantity_edit.val(), 10) + 1;
            quantity_edit.val(new_quantity);
            quantity_edit.trigger('change');
        },
        subQuantity: function (e) {
            e.stopPropagation();
            var $line = jQuery(e.target).closest('[data-type="row"]'), quantity_edit = $line.find('[data-action="split-quantity"]'), new_quantity = parseFloat(quantity_edit.val()) - 1;
            quantity_edit.val(new_quantity);
            quantity_edit.trigger('change');
        }    // Returns the first address id without a shipment associated to it
,
        getFirstAddressIdWithoutShipments: function () {
            var set_lines = this.wizard.model.getSetLines(), addresses = this.getValidAddresses(), default_shipping_address = _.find(addresses, function (address) {
                    return address.get('defaultshipping') === 'T';
                }), is_default_shipping_address_valid, selected_address = _.find(addresses, function (address) {
                    return !_.find(set_lines, function (line) {
                        return line.get('shipaddress') === address.id;
                    });
                });
            if (default_shipping_address) {
                is_default_shipping_address_valid = !_.find(set_lines, function (line) {
                    return line.get('shipaddress') === default_shipping_address.id;
                });
                if (is_default_shipping_address_valid) {
                    return default_shipping_address.id;
                }
            }
            return selected_address ? selected_address.id : addresses && addresses.length ? _.first(addresses).id : null;
        }    // Manage the selection or unselection of all items
,
        selectUnselectAll: function () {
            var unset_lines = this.wizard.model.getUnsetLines(), check_lines = _.filter(unset_lines, function (line) {
                    return line.get('check');
                });
            check_lines.length === unset_lines.length ? this.unselectAllItems() : this.selectAllItems();
            this.render();
        }    // Returns the count of items selected
,
        getSelectedItemsLength: function () {
            return _.filter(this.wizard.model.getUnsetLines(), function (line) {
                return line.get('check');
            }).length;
        }    // Select all items
,
        selectAllItems: function () {
            _.each(this.wizard.model.getUnsetLines(), function (line) {
                line.set('check', true);
            });
        }    // Unselect all items
,
        unselectAllItems: function () {
            _.each(this.wizard.model.getUnsetLines(), function (line) {
                line.set('check', false);
                line.unset('splitquantity');
            });
        },
        isActive: function () {
            return this.wizard.model.get('ismultishipto') && this.wizard.model.shippingAddressIsRequired();
        }    // Returns the list of address available to be part of Multi Ship To
,
        getValidAddresses: function () {
            return this.wizard.options.profile.get('addresses').where({ isvalid: 'T' });
        }    // Override Render in order to update Continue and back buttons
,
        render: function () {
            if (this.isActive()) {
                this.updateContinueButtonState();
                return WizardModule.prototype.render.apply(this, arguments);
            }
            this.$el.empty();
        }    // Returns the current address id. Used when the page is re-render to avoid losing the selected address in the combo-box
,
        getSelectedAddressId: function () {
            if (!this.selected_address_id || !this.wizard.options.profile.get('addresses').where({ internalid: this.selected_address_id }).length) {
                this.selected_address_id = this.getFirstAddressIdWithoutShipments();
            }
            return this.selected_address_id;
        }    // Set the selected address to retrieved it later
,
        setSelectedAddressId: function (e) {
            this.selected_address_id = jQuery(e.target).val();
            this.render();
        }    // Select and un-select an item
,
        selectLine: function selectLine(e) {
            //ignore clicks on anchors, buttons, etc
            if (_.isTargetActionable(e)) {
                return;
            }
            var marked_line_id = jQuery(e.currentTarget).data('lineId'), selected_line = this.wizard.model.get('lines').get(marked_line_id);
            selected_line.set('check', !selected_line.get('check'));
            if (!selected_line.get('check')) {
                selected_line.unset('splitquantity');
            }
            this.render();
        }    // Determines if the passed in address id has already created at one shipment
,
        addressHasShipments: function (address_id) {
            return !!_.find(this.wizard.model.getShippableLines(), function (item) {
                return item.get('shipaddress') === address_id;
            });
        }    // Update Continue button, enable/disable and change its label
,
        updateContinueButtonState: function () {
            var unapplied_items_length = this.wizard.model.getUnsetLines().length, selected_items_length = this.wizard.model.get('lines').filter(function (line) {
                    return !!line.get('check');
                }).length, selected_address_id = jQuery('[data-action="set-shipments-address-selector"]').val(), continue_enabled;
            continue_enabled = _.all(this.wizard.model.getShippableLines(), function (item) {
                return !!item.get('shipaddress');
            });
            this.createShipmentEnabled = !(unapplied_items_length > 0 && selected_items_length <= 0);
            if (selected_items_length > 0 && this.addressHasShipments(selected_address_id)) {
                this.createShipmentLabel = _('Add to Shipment').translate();
            } else {
                this.createShipmentLabel = _('Create Shipment').translate();
            }
            this.trigger('change_enable_continue', continue_enabled, {
                onlyContinue: true,
                notDisableTouchs: true
            });
        },
        isValid: function () {
            return this.wizard.model.getUnsetLines().length && this.isActive() ? jQuery.Deferred().reject(this.allItemShouldBelongToAPackage) : jQuery.Deferred().resolve();
        },
        restoreModelBeforeApplyAddress: function () {
            var self = this;
            _.each(this.linesBeforeApplyAddress, function (value, id) {
                var line = self.wizard.model.get('lines').findWhere({ internalid: id });
                line.set('shipaddress', value.shipaddress);
                line.set('check', value.check);
            });
        }    // Apply for all selected lines the current address
,
        applyCurrentAddress: function () {
            this.clearGeneralMessages();
            var selected_address_id = jQuery('[data-action="set-shipments-address-selector"]').val(), self = this, selected_items_length = this.wizard.model.get('lines').filter(function (line) {
                    return !!line.get('check');
                }).length, selected_address = this.wizard.options.profile.get('addresses').get(selected_address_id), item_for_address = this.wizard.model.get('lines').groupBy(function (line) {
                    return line.get('shipaddress');
                })[selected_address_id], result, notify_success_message = function () {
                    var message = selected_items_length > 1 ? _('$(0) items was added to Shipment: $(1)').translate(selected_items_length, selected_address.get('fullname')) : _('$(0) item was added to Shipment: $(1)').translate(selected_items_length, selected_address.get('fullname'));
                    self.showGeneralMessage(message, false);
                };
            if (selected_address_id && selected_address) {
                if (!selected_address.get('check')) {
                    selected_address.set('check', true);
                    this.wizard.model.get('addresses').add(selected_address);
                }
                this.linesBeforeApplyAddress = {};
                _.each(this.wizard.model.get('lines').where({ check: true }), function (line) {
                    self.linesBeforeApplyAddress[line.id] = {
                        shipaddress: line.get('shipaddress'),
                        check: line.get('check')
                    };
                    line.set('shipaddress', selected_address_id);
                    line.set('check', false);
                });
                result = this.wizard.model.save().fail(function () {
                    self.restoreModelBeforeApplyAddress();
                }).then(function () {
                    self.selected_address_id = self.getFirstAddressIdWithoutShipments();
                }).then(function () {
                    self.wizard.model.trigger('multishipto-address-applied');
                }).then(_.bind(this.render, this));
                //There are already shipments created
                if (item_for_address && item_for_address.length) {
                    result.then(notify_success_message);
                } else {
                    result.then(function () {
                        self.clearGeneralMessages();
                    });
                }
                return result;
            } else {
                return jQuery.Deferred().resolve();
            }
        },
        childViews: {
            'ShippableItems.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.wizard.model.getUnsetLines(),
                    childView: TransactionLineViewsCellSelectableView,
                    viewsPerRow: 1,
                    childViewOptions: {
                        navigable: false,
                        detail1Title: _('Qty:').translate(),
                        detail1: OrderWizardModuleMultiShipToSetAddressesPackageEditQuantity,
                        detail2Title: _('Unit price:').translate(),
                        detail2: 'rate_formatted',
                        detail3Title: _('Amount:').translate(),
                        detail3: 'amount_formatted'
                    }
                });
            },
            'Address.Details': function () {
                return new AddressDetailsView({
                    model: this.wizard.options.profile.get('addresses').get(this.getSelectedAddressId()),
                    hideActions: true,
                    hideDefaults: true,
                    manage: 'shipaddress'
                });
            }
        }    //@method getContext @return {OrderWizard.Module.MultiShipTo.Package.Creation.Context}
,
        getContext: function () {
            var addresses = this.getValidAddresses(), current_selected_address_id = this.getSelectedAddressId(), addresses_map = _.map(addresses, function (address) {
                    //@class AddressObject
                    return {
                        //@property {String} addressId
                        addressId: address.get('internalid')    //@property {Boolean} isSelected
,
                        isSelected: address.get('internalid') === current_selected_address_id    //@property {String} addressText
,
                        addressText: address.get('fullname') + ' - ' + address.get('addr1')
                    };
                }), unset_lines = this.wizard.model.getUnsetLines(), all_items_length = unset_lines.length, selected_items_length = this.getSelectedItemsLength(), are_all_items_selected = selected_items_length === all_items_length;
            //@class OrderWizard.Module.MultiShipTo.Package.Creation.Context
            return {
                //@property {Boolean} isAnyUnsetLine
                isAnyUnsetLine: !!unset_lines.length,
                addresses: addresses_map    //@property {Boolean} areAllItemSelected
,
                areAllItemSelected: are_all_items_selected    //@property {Number} allItemsLength
,
                allItemsLength: all_items_length    //@property {Boolean} isAnySelectedItem
,
                isAnySelectedItem: !!selected_items_length    //@property {Boolean} isSelectedItemLengthGreaterThan1
,
                isSelectedItemsLengthGreaterThan1: selected_items_length > 1    //@property {Number} selectedItemsLength
,
                selectedItemsLength: selected_items_length    //@property {Boolean} isCreateShipmentEnabled
,
                isCreateShipmentEnabled: this.createShipmentEnabled,
                createShipmentLabel: this.createShipmentLabel,
                editAddressesUrl: this.options.edit_addresses_url || ''    //@property {Boolean} hasMultipleUnsetLines
,
                hasMultipleUnsetLines: unset_lines.length > 1
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Transaction.Line.Views
define('Transaction.Line.Views.Price.View', [
    'Profile.Model',
    'Session',
    'SC.Configuration',
    'transaction_line_views_price.tpl',
    'Backbone'
], function (ProfileModel, Session, Configuration, transaction_line_views_price_tpl, Backbone) {
    'use strict';
    // @class Transaction.Line.Views.Price.View @extends Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: transaction_line_views_price_tpl    //@method initialize
                                            //@param {Transaction.Line.Views.Price.View.Options} options
                                            //@return {Void}
,
        initialize: function () {
            this.profileModel = ProfileModel.getInstance();
            this.isPriceEnabled = !ProfileModel.getInstance().hidePrices();
            if (this.isPriceEnabled) {
                this.model.on('change:quantity', function () {
                    this.render();
                }, this);
            }
        }    //@method getUrlLogin Get the login URL contains an origin hash parameter indicating the current URL to came back after login
             //@return {String}
,
        getUrlLogin: function () {
            var url = Session.get('touchpoints.login') + '&origin=' + (Configuration.get('currentTouchpoint') || 'home') + '&origin_hash=';
            return url + encodeURIComponent(this.options.origin === 'PDPQUICK' ? this.model.generateURL().replace('/', '') : Backbone.history.fragment);
        }    // @method getContext
             // @returns {Transaction.Line.Views.Price.View.Context}
,
        getContext: function () {
            var price_container_object = this.model.getPrice(), showComparePrice = this.options.showComparePrice && price_container_object.price < price_container_object.compare_price;
            //@class Transaction.Line.Views.Price.View.Context
            return {
                // @property {Transaction.Line.Model} model
                model: this.model,
                showComparePrice: showComparePrice    // @property {Boolean} isInStock
,
                isInStock: !!this.model.getStockInfo().isInStock,
                currencyCode: SC.getSessionInfo('currency').code || ''    // @property {String} comparePriceFormatted
,
                comparePriceFormatted: price_container_object.compare_price_formatted || ''    // @property {Number} price
,
                price: price_container_object.price || 0    // @property {String} rateFormatted
,
                rateFormatted: this.model.get('rate_formatted') || price_container_object.price_formatted || ''    // @property {Boolean} isPriceEnabled
,
                isPriceEnabled: this.isPriceEnabled,
                urlLogin: this.getUrlLogin()
            };    //@class Transaction.Line.Views.Price.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Transaction.Line.Views.Tax
define('Transaction.Line.Views.Tax', [
    'transaction_line_views_tax.tpl',
    'Backbone'
], function (transaction_line_views_tax_tpl, Backbone) {
    'use strict';
    // @class Transaction.Line.Views.Tax @extends Backbone.View
    return Backbone.View.extend({
        template: transaction_line_views_tax_tpl    //@method initialize
                                          //@param {Transaction.Line.Views.Tax.Options} options
                                          //@return {Void}
,
        initialize: function () {
            this.model.on('change:quantity', function () {
                this.render();
            }, this);
        }    //@method getContext
             //@return {Transaction.Line.Views.Tax.Context}
,
        getContext: function () {
            //@class Transaction.Line.Views.Tax.Context
            return {
                showTax: !!this.model.get('tax1_amount') || !!this.model.get('tax_amount'),
                taxRate: this.model.get('tax_rate1') || this.model.get('tax_rate'),
                taxAmount: this.model.get('tax1_amount_formatted') || this.model.get('tax_amount_formatted')
            };    //@class Transaction.Line.Views.Tax.Context
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Transaction.Line.Views
define('Transaction.Line.Views.Cell.Actionable.View', [
    'Transaction.Line.Views.Price.View',
    'Transaction.Line.Views.Options.Selected.View',
    'ProductLine.Stock.View',
    'ProductLine.Sku.View',
    'ProductLine.StockDescription.View',
    'Transaction.Line.Views.Tax',
    'Backbone.CollectionView',
    'Backbone.CompositeView',
    'transaction_line_views_cell_actionable.tpl',
    'Backbone',
    'underscore'
], function (TransactionLineViewsPriceView, TransactionLineViewsOptionsSelectedView, ProductLineStockView, ProductLineSkuView, ProductLineStockDescriptionView, TransactionLineViewsTax, BackboneCollectionView, BackboneCompositeView, transaction_line_views_cell_actionable_tpl, Backbone, _) {
    'use strict';
    //@class Transaction.Line.Views.Actionable.View @extend Backbone.View
    return Backbone.View.extend({
        template: transaction_line_views_cell_actionable_tpl    //@method initialize
                                                      //@param {Transaction.Line.Views.Cell.Actionable.Initialize.Options} options
                                                      //@return {Void}
,
        initialize: function () {
            BackboneCompositeView.add(this);
        },
        childViews: {
            'Item.Price': function () {
                return new TransactionLineViewsPriceView({
                    model: this.model,
                    showComparePrice: this.options.showComparePrice
                });
            },
            'Item.Sku': function () {
                return new ProductLineSkuView({ model: this.model });
            },
            'Item.Tax.Info': function () {
                if (this.options.showTaxDetails) {
                    return new TransactionLineViewsTax({ model: this.model });
                }
            },
            'Item.SelectedOptions': function () {
                return new TransactionLineViewsOptionsSelectedView({ model: this.model });
            },
            'ItemViews.Stock.View': function () {
                return new ProductLineStockView({ model: this.model });
            },
            'Item.Summary.View': function () {
                return new this.options.SummaryView(_.extend({
                    model: this.model,
                    application: this.options.application
                }, this.options.summaryOptions || {}));
            },
            'Item.Actions.View': function () {
                return new this.options.ActionsView(_.extend({
                    model: this.model,
                    application: this.options.application
                }, this.options.actionsOptions || {}));
            },
            'StockDescription': function () {
                return new ProductLineStockDescriptionView({ model: this.model });
            }
        }    //@method getContext
             //@return {Transaction.Line.Views.Actionable.View.Context}
,
        getContext: function () {
            var item = this.model.get('item');
            //@class Transaction.Line.Views.Actionable.View.Context
            return {
                //@property {OrderLine.Model|Transaction.Line.Model} line
                line: this.model,
                model: this.model,
                lineId: this.model.get('internalid')    //@property {Item.Model} item
,
                item: item    //@property {String} itemId
,
                itemId: item.get('internalid')    //@property {String} linkAttributes
,
                linkAttributes: this.model.getFullLink({
                    quantity: null,
                    location: null,
                    fulfillmentChoice: null
                })    //@property {Boolean} isNavigable
,
                isNavigable: !!this.options.navigable && !!item.get('_isPurchasable')    //@property {Boolean} showCustomAlert
,
                showCustomAlert: !!item.get('_cartCustomAlert')    //@property {String} customAlertType
,
                customAlertType: item.get('_cartCustomAlertType') || 'info'    //@property {Boolean} showActionsView
,
                showActionsView: !!this.options.ActionsView,
                showSummaryView: !!this.options.SummaryView,
                showAlert: !_.isUndefined(this.options.showAlert) ? !!this.options.showAlert : true    //@property {Boolean} showGeneralClass
,
                showGeneralClass: !!this.options.generalClass,
                generalClass: this.options.generalClass,
                thumbnail: this.model.getThumbnail()    // @property {Boolean} isFreeGift
,
                isFreeGift: this.model.get('free_gift') === true
            };    //@class Transaction.Line.Views.Actionable.View
        }
    });
});    //@class Transaction.Line.Views.Cell.Actionable.Initialize.Options
       //@property {Transaction.Line.Model} model
       //@property {String} generalClass Class name used in the generated HTML
       //@property {Backbone.View} SummaryView View to show details
       //@property {Backbone.View} ActionsView View to show actions buttons
       //@property {Object} actionsOptions Any object used to extend the options sent to the Action View
       //@property {Object} summaryOptions Any object used to extend the options sent to the Summary View
       //@property {Boolean} navigable
       //@property {Boolean} showAlert Indicate if a place holder is added in the final HTML, used when the action can generate errors
       //@property {ApplicationSkeleton} application
       //@property {Boolean} hideComparePrice Property used to bypass to the TransactionLineViewsPriceView


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard
define('OrderWizard.Module.MultiShipTo.Package.Details.Quantity', [
    'Backbone',
    'order_wizard_msr_package_details_quantity.tpl'
], function (Backbone, order_wizard_msr_package_details_quantity_tpl) {
    'use strict';
    //@class OrderWizard.Module.MultiShipTo.Package.Details.Quantity @extend Backbone.View
    return Backbone.View.extend({
        template: order_wizard_msr_package_details_quantity_tpl    //@method getContext @return {OrderWizard.Module.MultiShipTo.Package.Details.Quantity.Context}
,
        getContext: function () {
            //@class OrderWizard.Module.MultiShipTo.Package.Details.Quantity.Context
            return {
                //@property {Number} lineQuantity
                lineQuantity: this.model.get('quantity')    //@property {String} lineTotalFormatted
,
                lineTotalFormatted: this.model.get('total_formatted')    //@property {String} lineAmountFormatted
,
                lineAmountFormatted: this.model.get('amount_formatted')    //@property {Boolean} isAmountGreaterThanTotal
,
                isAmountGreaterThanTotal: this.model.get('amount') > this.model.get('total')
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard
define('OrderWizard.Module.MultiShipTo.Package.Details.Actions', [
    'Backbone',
    'order_wizard_msr_package_details_actions.tpl'
], function (Backbone, order_wizard_msr_package_details_actions_tpl) {
    'use strict';
    //@class OrderWizard.Module.MultiShipTo.Package.Details.Quantity @extend Backbone.View
    return Backbone.View.extend({
        template: order_wizard_msr_package_details_actions_tpl    //@method getContext @return {OrderWizard.Module.MultiShipTo.Package.Details.Actions.Context}
,
        getContext: function () {
            //@class OrderWizard.Module.MultiShipTo.Package.Details.Actions.Context
            return {
                //@property {String} lineId
                lineId: this.model.id
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard
define('OrderWizard.Module.MultiShipTo.Package.Details', [
    'Wizard.Module',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'Address.Details.View',
    'Transaction.Line.Views.Cell.Actionable.View',
    'OrderWizard.Module.MultiShipTo.Package.Details.Quantity',
    'OrderWizard.Module.MultiShipTo.Package.Details.Actions',
    'order_wizard_msr_package_details.tpl',
    'underscore',
    'Utils'
], function (WizardModule, BackboneCompositeView, BackboneCollectionView, AddressDetailsView, TransactionLineViewsCellActionableView, OrderWizardModuleMultiShipToPackageDetailsQuantity, OrderWizardModuleMultiShipToPackageDetailsActions, order_wizard_msr_package_details_tpl, _) {
    'use strict';
    //@class OrderWizard.Module.MultiShipTo.Package.Details @extend Wizard.Module
    return WizardModule.extend({
        template: order_wizard_msr_package_details_tpl,
        initialize: function () {
            BackboneCompositeView.add(this);
        },
        childViews: {
            'Address.Details': function () {
                return new AddressDetailsView({
                    model: this.model.get('address'),
                    hideActions: true,
                    hideDefaults: true,
                    manage: 'shipaddress'
                });
            },
            'Items.Collection': function () {
                return new BackboneCollectionView({
                    childView: TransactionLineViewsCellActionableView,
                    viewsPerRow: 1,
                    collection: this.model.get('lines'),
                    childViewOptions: {
                        navigable: false    // ,	useLinePrice: true
,
                        application: this.options.application,
                        SummaryView: OrderWizardModuleMultiShipToPackageDetailsQuantity,
                        ActionsView: OrderWizardModuleMultiShipToPackageDetailsActions
                    }
                });
            }
        }    //@method getContext @return {OrderWizard.Module.MultiShipTo.Package.Details.Context}
,
        getContext: function () {
            var item_count = _.countItems(this.model.get('lines'));
            //@class OrderWizard.Module.MultiShipTo.Package.Details.Context
            return {
                //@property {String} packageTitle
                packageTitle: this.model.get('packageTitle')    //@property {Boolean} totalItemsGreaterThan1
,
                itemCountGreaterThan1: item_count > 1    //@property {Number} totalItems
,
                itemCount: item_count    //@property {Boolean} isPackageExpanded
,
                isPackageExpanded: !!this.model.get('isPackageExpanded')    //@property {String} addressId
,
                addressId: this.model.get('address').id,
                addressName: this.model.get('address').get('fullname')    //@property {String} address
,
                address: this.model.get('address').get('addr1')
            };
        }
    });
});


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard
define('OrderWizard.Module.MultiShipTo.Package.List', [
    'Wizard.Module',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'OrderWizard.Module.MultiShipTo.Package.Details',
    'Transaction.Line.Collection',
    'Transaction.Shipmethod.Collection',
    'order_wizard_msr_package_list.tpl',
    'order_wizard_msr_package_details_cell.tpl',
    'underscore',
    'jQuery',
    'Backbone'
], function (WizardModule, BackboneCompositeView, BackboneCollectionView, OrderWizardModuleMultiShipToPackageDetails, TransactionLineCollection, TransactionShipmethodCollection, order_wizard_msr_package_list_tpl, order_wizard_msr_package_details_cell_tpl, _, jQuery, Backbone) {
    'use strict';
    //@class OrderWizard.Module.MultiShipTo.Packages @extend Wizard.Module
    return WizardModule.extend({
        template: order_wizard_msr_package_list_tpl,
        events: {
            'click [data-action="remove-item"]': 'removeItemHandle',
            'click [data-action="items-expander"]': 'expandCollapsePackage'
        },
        initialize: function () {
            WizardModule.prototype.initialize.apply(this, arguments);
            var self = this;
            this.wizard.model.on('multishipto-address-applied', function () {
                self.render();
            });
            this.wizard.model.on('ismultishiptoUpdated', _.bind(this.render, this));
            this.expanded_packages = [];
            BackboneCompositeView.add(this);
        },
        isActive: function () {
            return this.wizard.model.get('ismultishipto') && this.wizard.model.shippingAddressIsRequired();
        }    // Return the array of line set with the same address id
,
        getLinesForAddressId: function (address_id) {
            return this.wizard.model.get('lines').groupBy(function (line) {
                return line.get('shipaddress');
            })[address_id];
        }    // Conserve the state (expanded/collapsed) of each package when re-rendering
,
        expandCollapsePackage: function (e) {
            var package_id = jQuery(e.target).closest('[data-address-id]').data('address-id'), package_index = _.indexOf(this.expanded_packages, package_id);
            !~package_index ? this.expanded_packages.push(package_id) : this.expanded_packages.splice(package_index, 1);
        }    // Handle the remove click event, and delegate the real logic to the father view
,
        removeItemHandle: function (e) {
            this.clearGeneralMessages();
            var $selected_button = jQuery(e.target), selected_item_id = $selected_button.data('item-id');
            this.removeItem(selected_item_id);
        }    // Mange the action of removing an item from a package, which means unset the shipaddress property of the item
,
        removeItem: function (item_id) {
            var self = this, model = this.wizard.model, selected_item = model.get('lines').get(item_id), package_address_id = selected_item.get('shipaddress');
            selected_item.unset('shipaddress');
            model.save().then(function () {
                if (!self.getLinesForAddressId(package_address_id)) {
                    self.wizard.options.profile.get('addresses').get(package_address_id).set('check', false);
                    self.expanded_packages.splice(_.indexOf(self.expanded_packages, +package_address_id), 1);
                    self.showGeneralMessage(_('Shipment has no more items').translate(), false);
                }
                self.render();
                model.trigger('multishipto-line-updated');
            });
        },
        childViews: {
            'Packages.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.getPackages(),
                    childView: OrderWizardModuleMultiShipToPackageDetails,
                    cellTemplate: order_wizard_msr_package_details_cell_tpl,
                    viewsPerRow: 1,
                    childViewOptions: { application: this.wizard.application }
                });
            }
        }    //@method getPackages Returns the lists of packages (items grouped by address) created
             //@return {Backbone.Collection<MultiShipTo.Package>}
,
        getPackages: function () {
            var result = [], package_item, package_address, self = this, items_with_address = _.filter(this.wizard.model.getShippableLines(), function (line) {
                    return !!line.get('shipaddress');
                }), items_per_address = _.groupBy(items_with_address, function (line) {
                    return line.get('shipaddress');
                }), addresses = this.wizard.options.profile.get('addresses'), shipping_methods = this.wizard.model.get('multishipmethods');
            _.each(_.keys(items_per_address), function (address_id) {
                package_address = addresses.get(address_id);
                //@class MultiShipTo.Package @extend Backbone.Model
                package_item = new Backbone.Model({
                    //@property {Transaction.Line.Collection} lines
                    lines: new TransactionLineCollection(items_per_address[address_id])    //@property {Address.Model} address
,
                    address: package_address    //@property {OrderShipmethod.Collection} shippingMethods
,
                    shippingMethods: new TransactionShipmethodCollection(shipping_methods[address_id])    //@property {String} packageTitle
,
                    packageTitle: package_address.get('fullname') + ' - ' + package_address.get('addr1')    //@property {Boolean} isPackageExpanded
,
                    isPackageExpanded: _(self.expanded_packages).indexOf(+address_id) >= 0
                });
                result.push(package_item);
            });
            return result;
        },
        render: function () {
            this._render();
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Transaction.Line.Views
define('Transaction.Line.Views.Cell.Navigable.View', [
    'Transaction.Line.Views.Options.Selected.View',
    'ProductLine.Stock.View',
    'Transaction.Line.Views.Price.View',
    'ProductLine.Sku.View',
    'ProductLine.StockDescription.View',
    'Transaction.Line.Views.Tax',
    'Backbone.CollectionView',
    'Backbone.CompositeView',
    'transaction_line_views_cell_navigable.tpl',
    'Backbone'
], function (TransactionLineViewsOptionsSelectedView, ProductLineStockView, TransactionLineViewsPriceView, ProductLineSkuView, ProductLineStockDescriptionView, TransactionLineViewsTax, BackboneCollectionView, BackboneCompositeView, transaction_line_views_cell_navigable_tpl, Backbone) {
    'use strict';
    //@class Transaction.Line.Views.Navigable.View @extend Backbone.View
    return Backbone.View.extend({
        template: transaction_line_views_cell_navigable_tpl,
        initialize: function (options) {
            this.options = options;
            this.application = options.application;
            this.model = options.model;
            BackboneCompositeView.add(this);
        },
        childViews: {
            'Item.Options': function () {
                return new TransactionLineViewsOptionsSelectedView({ model: this.model });
            },
            'ItemViews.Stock.View': function () {
                return new ProductLineStockView({ model: this.model.get('item') });
            },
            'Item.Price': function () {
                return new TransactionLineViewsPriceView({ model: this.model });
            },
            'Item.Sku': function () {
                return new ProductLineSkuView({ model: this.model });
            },
            'Item.Tax.Info': function () {
                if (this.options.showTaxDetails) {
                    return new TransactionLineViewsTax({ model: this.model });
                }
            },
            'StockDescription': function () {
                return new ProductLineStockDescriptionView({ model: this.model.get('item') });
            }
        }    //@method getContext
             //@return {Transaction.Line.Views.Navigable.View.Context}
,
        getContext: function () {
            var item = this.model.get('item'), line = this.model;
            //@class Transaction.Line.Views.Navigable.View.Context
            return {
                //@property {Transaction.Line.Model} model
                model: this.model,
                itemId: item.get('internalid')    //@property {String} itemName
,
                itemName: item.get('_name')    //@property {String} cellClassName
,
                cellClassName: this.options.cellClassName,
                isNavigable: !!this.options.navigable && !!item.get('_isPurchasable')    //@property {String} rateFormatted
,
                rateFormatted: line.get('rate_formatted')    //@property {Boolean} showOptions
,
                showOptions: !!(line.get('options') && line.get('options').length)    //@property {String} itemURLAttributes
,
                itemURLAttributes: line.getFullLink({
                    quantity: null,
                    location: null,
                    fulfillmentChoice: null
                })    //@property {Number} quantity
,
                quantity: line.get('quantity')    //@property {Boolean} showDetail2Title
,
                showDetail2Title: !!this.options.detail2Title,
                detail2Title: this.options.detail2Title,
                detail2: line.get(this.options.detail2)    //@property {Boolean} showBlockDetail2
,
                showBlockDetail2: !!line.get(this.options.detail2)    //@property {Boolean} showDetail3Title
,
                showDetail3Title: !!this.options.detail3Title,
                detail3Title: this.options.detail3Title,
                detail3: line.get(this.options.detail3)    //@property {Boolean} showComparePrice
,
                showComparePrice: line.get('amount') > line.get('total')    //@property {String} comparePriceFormatted
,
                comparePriceFormatted: line.get('amount_formatted')    // @property {ImageContainer} thumbnail
,
                thumbnail: this.model.getThumbnail()    // @property {Boolean} isFreeGift
,
                isFreeGift: line.get('free_gift') === true
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard
define('OrderWizard.Module.NonShippableItems', [
    'Wizard.Module',
    'Transaction.Line.Views.Cell.Navigable.View',
    'Backbone.CollectionView',
    'Backbone.CompositeView',
    'order_wizard_non_shippable_items_module.tpl',
    'underscore',
    'Utils'
], function (WizardModule, TransactionLineViewsCellNavigableView, BackboneCollectionView, BackboneCompositeView, order_wizard_non_shippable_items_module_tpl, _) {
    'use strict';
    //@class OrderWizard.Module.NonShippalbeItems @extend Wizard.Module
    return WizardModule.extend({
        template: order_wizard_non_shippable_items_module_tpl,
        initialize: function (options) {
            WizardModule.prototype.initialize.apply(this, arguments);
            this.wizard.model.on('ismultishiptoUpdated', this.render, this);
            this.options = options;
            BackboneCompositeView.add(this);
        }    // Returns the list of non shippable items/lines
,
        getLinesNotShippable: function () {
            return this.wizard.model.getNonShippableLines();
        },
        isActive: function () {
            return this.getLinesNotShippable().length;
        },
        render: function () {
            if (this.isActive()) {
                this._render();
            } else {
                this.$el.empty();
            }
        },
        childViews: {
            'NonShippableItems.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.getLinesNotShippable(),
                    childView: TransactionLineViewsCellNavigableView,
                    viewsPerRow: 1,
                    childViewOptions: {
                        navigable: false,
                        detail1Title: _('Qty:').translate(),
                        detail1: 'quantity',
                        detail2Title: _('Unit price').translate(),
                        detail2: 'rate_formatted',
                        detail3Title: _('Amount:').translate(),
                        detail3: 'amount_formatted'
                    }
                });
            }
        }    //@method getContext @return {OrderWizard.Module.NonShippalbeItems.Context}
,
        getContext: function () {
            var lines_not_shippable = this.getLinesNotShippable();
            //@class OrderWizard.Module.NonShippalbeItems.Context
            return {
                //@property {Boolean} showNonShippableLines
                showNonShippableLines: !!(lines_not_shippable && lines_not_shippable.length)    //@property {Number} nonShippableLinesLength
,
                nonShippableLinesLength: lines_not_shippable.length,
                title: this.options.title,
                showCustomTitle: !!this.options.title,
                showEditCartButton: !!this.options.show_edit_cart_button,
                showMobile: !!this.options.showMobile,
                showTableHeader: !!this.options.show_table_header,
                showOpenedAccordion: !!this.options.show_opened_accordion
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('OrderWizard.Module.MultiShipTo.Shipmethod.Package.View', [
    'Backbone.CompositeView',
    'Address.Details.View',
    'Backbone.CollectionView',
    'Transaction.Line.Views.Cell.Navigable.View',
    'order_wizard_msr_shipmethod_package.tpl',
    'Backbone',
    'underscore',
    'Utils'
], function (BackboneCompositeView, AddressDetailsView, BackboneCollectionView, TransactionLineViewsCellNavigableView, order_wizard_msr_shipmethod_package_tpl, Backbone, _) {
    'use strict';
    return Backbone.View.extend({
        template: order_wizard_msr_shipmethod_package_tpl,
        initialize: function () {
            BackboneCompositeView.add(this);
        },
        childViews: {
            'Shipping.Address': function () {
                return new AddressDetailsView({
                    model: this.model.get('address'),
                    hideActions: true,
                    hideDefaults: true,
                    manage: 'shipaddress'
                });
            },
            'Items.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.model.get('lines'),
                    childView: TransactionLineViewsCellNavigableView,
                    viewsPerRow: 1,
                    childViewOptions: {
                        navigable: !this.options.hide_item_link,
                        detail1Title: _('Qty:').translate(),
                        detail1: 'quantity',
                        detail2Title: _('Unit price').translate(),
                        detail2: 'rate_formatted',
                        detail3Title: _('Amount:').translate(),
                        detail3: 'total_formatted'
                    }
                });
            }
        },
        getContext: function () {
            /*var packages = view.getPackages()
			,	non_shippable_lines = view.wizard.model.getNonShippableLines()
			,	general_collapse_elements =  view.getDefaultCollapseItem()
			,	show_edit_address_url = !!view.options.show_edit_address_url
			,	show_combo = view.options.show_combo
			,	is_read_only = view.is_read_only
			,	hide_accordion = view.options.hide_accordion
			,	show_items = !view.options.hide_items
			,	application = view.wizard.application;

			var items = package.lines
			,	selected_address = package.address
			,	delivery_methods = package.deliveryMethods
			,	collapse_elements = _.isUndefined(package.collapse_elements) ? general_collapse_elements : package.collapse_elements;
			*/
            var shipping_methods = this.model.get('deliveryMethods').map(function (shipmethod) {
                    return {
                        name: shipmethod.get('name'),
                        rate_formatted: shipmethod.get('rate_formatted'),
                        internalid: shipmethod.get('internalid'),
                        isActive: shipmethod.get('check')
                    };
                }), selected_shipmethod = _.findWhere(shipping_methods, { isActive: true }), lines = this.model.get('lines'), total_items = _.countItems(lines);
            return {
                //@property {String} addressId
                addressId: this.model.get('address').get('internalid')    //@property {Boolean} showEditButton
,
                showEditAddressButton: !!this.options.show_edit_address_url,
                editUrl: this.options.edit_url,
                showDeliveryMethods: !!shipping_methods.length,
                showCombo: this.options.show_combo,
                shippingMethods: shipping_methods    //@property {Object} selectedShipmethod
,
                selectedShipmethod: selected_shipmethod    //@property {Boolean} showSelectedShipmethod
,
                showSelectedShipmethod: !!selected_shipmethod    //@property {Boolean} showActions
,
                showActions: !this.options.is_read_only,
                showAccordion: !this.options.hide_accordion,
                showItems: !this.options.hide_items,
                showLines: !!lines.length,
                lines: lines    //@property {Number} totalItems
,
                totalItems: total_items    //@property {Boolean} linesLengthGreaterThan1
,
                totalItemsGreaterThan1: total_items > 1    //@property {Boolean} collapseElements
,
                collapseElements: _.isUndefined(this.model.get('collapse_elements')) ? !!this.options.general_collapse_elements : !!this.model.get('collapse_elements')    //@property {Boolean} showEditShipment
,
                showEditShipmentButton: !!this.options.edit_shipment_url,
                editShipmentUrl: this.options.edit_shipment_url
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard.Module.Shipmethod
define('OrderWizard.Module.MultiShipTo.Shipmethod', [
    'Wizard.Module',
    'Transaction.Shipmethod.Collection',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'OrderWizard.Module.MultiShipTo.Shipmethod.Package.View',
    'order_wizard_msr_shipmethod_module.tpl',
    'underscore',
    'jQuery',
    'Utils'
], function (WizardModule, TransactionShipmethodCollection, BackboneCompositeView, BackboneCollectionView, OrderWizardModuleMultiShipToShipmethodPackageView, order_wizard_msr_shipmethod_module_tpl, _, jQuery) {
    'use strict';
    //@class OrderWizard.Module.MultiShipTo.Shipmethod @extends Wizard.Module
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_msr_shipmethod_module_tpl    //@property
,
        events: {
            'click [data-action="items-expander"]': 'changeExpandedState',
            'change [data-type="address-selector"]': 'selectDeliveryMethodComboHandler'
        }    //@property {Array} errors
,
        errors: ['ERR_MST_NOT_SET_SHIPPING_METHODS']    //@property {Object} shipmethoIsRequireErrorMessage
,
        shipmethoIsRequireErrorMessage: {
            errorMessage: _('Please select a delivery method for each package').translate(),
            errorCode: 'ERR_MST_NOT_SET_SHIPPING_METHODS'
        }    //@method initialize
,
        initialize: function (options) {
            WizardModule.prototype.initialize.apply(this, arguments);
            this.packages_items_collapsed = {};
            this.is_read_only = _.isBoolean(options.is_read_only) ? options.is_read_only : true;
            this.submit_promise = null;
            this.profile = this.wizard.options.profile;
            var self = this;
            this.model.get('lines').on('change', function () {
                if (self.isValid() && self.state === 'past') {
                    self.error = null;
                }
            });
            this.eventHandlersOn();
            BackboneCompositeView.add(this);
        }    // @method present
,
        present: function () {
            this.eventHandlersOn();
        }    // @method future
             // Detect when is not require attach to events
,
        future: function () {
            this.eventHandlersOff();
        }    // @method past
             // Detect when is not require attach to events
,
        past: function () {
            this.eventHandlersOff();
        }    // @method eventHandlersOn
             // Attach to events that keep the current state updated
,
        eventHandlersOn: function () {
            this.eventHandlersOff();
            this.profile.get('addresses').on('change', this.shippingAddressChange, this);
            this.model.on('change:multishipmethods', this.render, this);
        }    // @method eventHandlersOff
             // Detach from any event
,
        eventHandlersOff: function () {
            this.model.off('change:multishipmethods', null, this);
            this.profile.get('addresses').off('change', null, this);
        }    // @method shippingAddressChange
             // Handle on shipping address change
,
        shippingAddressChange: function (updated_address) {
            var addrress_model = this.wizard.model.get('addresses').get(updated_address.id);
            //If the address is not in the order we omit it
            if (addrress_model) {
                var change_zip = addrress_model.get('zip') !== updated_address.get('zip'), change_country = addrress_model.get('country') !== updated_address.get('country'), change_state = addrress_model.get('state') !== updated_address.get('state');
                if (change_zip || change_country || change_state) {
                    this.reloadShppingMethodForAddress(updated_address.id);
                } else {
                    this.render();
                }
            }
        }    // @method reloadShppingMethodForAddress
             // Reload the group of available shipping method for a package (loading the entire model - of course)
,
        reloadShppingMethodForAddress: function (address_id) {
            // This only remove the current selected shipping method and save the model, doing this the template when rendering
            // will offer select a new shipping method if any, or display an error if there is none.
            var affected_lines = this.wizard.model.get('lines').where({ 'shipaddress': address_id });
            if (affected_lines.length) {
                _.each(affected_lines, function (line) {
                    line.unset('shipmethod');
                });
                this.wizard.model.save();
            }
        }    // @method getDefaultCollapseItem
,
        getDefaultCollapseItem: function () {
            return _.isBoolean(this.options.collapse_items) ? this.options.collapse_items : this.wizard.application.getConfig('sca.collapseElements', false);
        }    // @method changeExpandedState
             // Update the state of the items accordion, remembering if it is expanded or collapsed
,
        changeExpandedState: function (e) {
            var selected_address_id = jQuery(e.target).closest('[data-type="package"]').data('address-id');
            this.packages_items_collapsed[selected_address_id] = !_.isUndefined(this.packages_items_collapsed[selected_address_id]) ? !this.packages_items_collapsed[selected_address_id] : !this.getDefaultCollapseItem();
        }    // @method isActive
             // Determines if the current module is valid to be shown, all items have set a ship address id
,
        isActive: function () {
            var shipping_methods = this.wizard.model.get('multishipmethods'), result = this.wizard.model.get('ismultishipto') && this.wizard.model.getIfThereAreDeliverableItems() && _.keys(shipping_methods).length;
            if (result) {
                var all_item_has_shipping_address_selected = this.wizard.model.get('lines').all(function (line) {
                    return !line.get('item').isshippable || line.get('shipaddress');
                });
                result = all_item_has_shipping_address_selected;
                if (this.is_read_only) {
                    var all_item_has_shipping_method_selected = this.wizard.model.get('lines').all(function (line) {
                        return !line.get('item').isshippable || line.get('shipmethod');
                    });
                    result = result && all_item_has_shipping_method_selected;
                }
            }
            return result;
        }    // @method selectDeliveryMethodComboHandler
             // Handle the delivery method selection when this action is caused by a combo box
,
        selectDeliveryMethodComboHandler: function (e) {
            var $selected_combo = jQuery(e.target), selected_delivery_mehtod_id = $selected_combo.val(), selected_address_id = $selected_combo.data('address-id');
            this.selectDeliveryMethod(selected_delivery_mehtod_id, selected_address_id, true);
        }    // @method selectDeliveryMethod
             // Unset the specified package (address id) and for that address id, mark the specified delivery method
,
        selectDeliveryMethod: function (selected_delivery_method_id, selected_address_id, save_changes) {
            if (this.canSaveChanges()) {
                var items_per_address = this.wizard.model.get('lines').groupBy(function (line) {
                        return line.get('shipaddress');
                    }), delivery_methods = this.wizard.model.get('multishipmethods')[selected_address_id];
                _.each(items_per_address[selected_address_id], function (item) {
                    item.unset('shipmethod');
                });
                _.each(delivery_methods.where({ check: true }), function (delivery_method) {
                    delivery_method.unset('check');
                });
                delivery_methods.get(selected_delivery_method_id).set('check', true);
                if (save_changes) {
                    this.step.disableNavButtons();
                    jQuery('[data-type="shipments-list"] input[type="radio"]').attr('disabled', 'disabled');
                    this.saveChanges(true).then(function () {
                        jQuery('[data-type="shipments-list"] input[type="radio"]').removeAttr('disabled');
                    }).then(_.bind(this.step.enableNavButtons, this.step));
                }
            }
        }    // @method submit
             // Set for each line the selected shipmethod of the continaer package
,
        submit: function () {
            // If the view is being displayed in review mode (after place order)
            if (this.is_read_only || this.state !== 'present' || !this.isActive()) {
                return jQuery.Deferred().resolve();
            }
            // The real action of submitting a shipping method for a package is made when you select an options, clicking continue (which call this method) just validate
            // the current state.
            return this.isValid();
        }    // @method canSaveChanges
             // Determine if not previous save operation is in progress
,
        canSaveChanges: function () {
            return !this.submit_promise || this.submit_promise.state() !== 'pending';
        }    // @method saveChanges
             // Actually submit the selected shipping method to the server
             // @param {Boolean} submit_server
             // @return {jQuery.Deferred}
,
        saveChanges: function (submit_server) {
            this.clearError();
            if (this.canSaveChanges()) {
                var lines = this.wizard.model.get('lines'), shipping_methods = this.wizard.model.get('multishipmethods');
                lines.each(function (line) {
                    var ship_address = line.get('shipaddress');
                    if (ship_address) {
                        var selected_ship_method = shipping_methods[ship_address].findWhere({ check: true });
                        if (selected_ship_method) {
                            line.set('shipmethod', selected_ship_method.id);
                        }
                    }
                }, this);
                if (submit_server) {
                    this.submit_promise = this.wizard.model.save();
                    return this.submit_promise;
                }
                return jQuery.Deferred().resolve();
            }
        }    // @method isValid
             // Check that all packages have a shipping method selected
             // @return {jQuery.Deferred}
,
        isValid: function () {
            var lines = this.wizard.model.getSetLines(), has_error = false;
            has_error = !!_.find(lines, function (line) {
                return !line.get('shipmethod');
            });
            if (!has_error) {
                this.error = null;
            }
            return has_error ? jQuery.Deferred().reject(this.shipmethoIsRequireErrorMessage) : jQuery.Deferred().resolve();
        }    // @method getPackages
             // Returns the lists of packages (items grouped by address) created
,
        getPackages: function () {
            if (this.isActive() && this.state === 'present') {
                var result = [], self = this, items_per_address = this.wizard.model.get('lines').groupBy(function (line) {
                        return line.get('shipaddress');
                    }), addresses = this.profile.get('addresses')    //Get the addresses from profile because when updating just the user's address are updated
, selected_delivery_methods = [], shipping_methods = this.wizard.model.get('multishipmethods');
                _.each(_.keys(items_per_address), function (address_id) {
                    if (address_id === 'null' || !shipping_methods[address_id]) {
                        return;
                    }
                    if (!self.is_read_only) {
                        var item_set = _.find(items_per_address[address_id], function (item) {
                            return !!item.get('shipmethod');
                        });
                        //If in this package there is any item already set (this occur when in a next step press back) use that as selected delivery method
                        if (item_set) {
                            shipping_methods[address_id].get(item_set.get('shipmethod')).set('check', true);
                        }
                        selected_delivery_methods = shipping_methods[address_id];
                    } else {
                        //Get THE selected ship method for the entire package
                        var ship_method_group_id = _.first(items_per_address[address_id]).get('shipmethod'), ship_method = shipping_methods[address_id].get(ship_method_group_id);
                        if (ship_method) {
                            ship_method.set('check', true);
                            selected_delivery_methods = new TransactionShipmethodCollection([ship_method]);
                        }
                    }
                    result.push({
                        lines: items_per_address[address_id],
                        address: addresses.get(address_id) || self.wizard.model.get('addresses').get(address_id),
                        collapse_elements: self.packages_items_collapsed[address_id],
                        summary: {},
                        deliveryMethods: selected_delivery_methods
                    });
                });
                return result;
            }
            return [];
        },
        childViews: {
            'Packages.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.getPackages(),
                    viewsPerRow: 1,
                    childView: OrderWizardModuleMultiShipToShipmethodPackageView,
                    childViewOptions: {
                        hide_items: this.options.hide_items,
                        hide_accordion: this.options.hide_accordion,
                        show_edit_address_url: this.options.show_edit_address_url,
                        edit_url: this.options.edit_shipment_address_url,
                        show_combo: this.options.show_combo,
                        edit_shipment_url: this.options.edit_shipment_url,
                        is_read_only: this.is_read_only,
                        hide_item_link: this.options.hide_item_link,
                        general_collapse_elements: this.getDefaultCollapseItem()
                    }
                });
            }
        }    // @method getContext @returns OrderWizard.Module.MultiShipTo.Shipmethod.Context
,
        getContext: function () {
            //@class OrderWizard.Module.MultiShipTo.Shipmethod.Context
            return {
                //@property {Boolean} showPackages
                showPackages: !!this.getPackages().length
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard.Module.Shipmethod
define('OrderWizard.Module.Shipmethod', [
    'Wizard.Module',
    'Profile.Model',
    'GlobalViews.Message.View',
    'order_wizard_shipmethod_module.tpl',
    'underscore',
    'jQuery'
], function (WizardModule, ProfileModel, GlobalViewsMessageView, order_wizard_shipmethod_module_tpl, _, jQuery) {
    'use strict';
    //@class OrderWizard.Module.Shipmethod @extends Wizard.Module
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_shipmethod_module_tpl    //@property {Object} events
,
        events: {
            'change [data-action="select-delivery-option"]': 'changeDeliveryOptions',
            'click [data-action="select-delivery-option-radio"]': 'changeDeliveryOptions'
        }    //@property {Array} errors
,
        errors: [
            'ERR_CHK_SELECT_SHIPPING_METHOD',
            'ERR_WS_INVALID_SHIPPING_METHOD'
        ]    //@method initialize
,
        initialize: function () {
            this.waitShipmethod = SC.ENVIRONMENT.CART ? !SC.ENVIRONMENT.CART.shipmethod : !(this.model && this.model.get('shipmethod'));
            this.profileModel = ProfileModel.getInstance();
            this.addresses = this.profileModel.get('addresses');
            WizardModule.prototype.initialize.apply(this, arguments);
            // So we allways have a the reload promise
            this.reloadMethodsPromise = jQuery.Deferred().resolve();
            this.wizard.model.on('ismultishiptoUpdated', _.bind(this.render, this));
        },
        isActive: function () {
            var is_shipping_required = this.wizard.model.shippingAddressIsRequired();
            if (!is_shipping_required) {
                this.wizard.model.unset('shipmethod');
            }
            return is_shipping_required && !this.wizard.model.get('ismultishipto');
        }    //@method present
,
        present: function () {
            this.currentAddress = this.previousAddress = this.model.get('shipaddress');
            this.eventHandlersOn();
        }    //@method future
,
        future: function () {
            this.currentAddress = this.previousAddress = this.model.get('shipaddress');
            this.eventHandlersOn();
        }    //@method past
,
        past: function () {
            this.waitShipmethod = !this.model.get('shipmethod');
            this.currentAddress = this.previousAddress = this.model.get('shipaddress');
            this.eventHandlersOn();
        }    //@method eventHandlersOn
,
        eventHandlersOn: function () {
            // Removes any leftover observer
            this.eventHandlersOff();
            // Adds the observer for this step
            this.model.on('change:shipaddress', this.shipAddressChange, this);
            this.model.on('change:shipmethods', function () {
                _.defer(_.bind(this.render, this));
            }, this);
            var selected_address = this.addresses.get(this.currentAddress);
            if (selected_address) {
                selected_address.on('sync', jQuery.proxy(this, 'reloadMethods'), this);
            }
        }    //@method eventHandlersOff
,
        eventHandlersOff: function () {
            // removes observers
            this.model.off('change:shipmethods', null, this);
            this.model.off('change:shipaddress', this.shipAddressChange, this);
            var current_address = this.addresses.get(this.currentAddress), previous_address = this.addresses.get(this.previousAddress);
            if (current_address) {
                current_address.off('change:country change:zip', null, this);
                current_address.off('sync');
            }
            if (previous_address && previous_address !== current_address) {
                previous_address.off('change:country change:zip', null, this);
            }
        }    //@method render
,
        render: function () {
            if (this.state === 'present') {
                if (this.model.get('shipmethod') && !this.waitShipmethod) {
                    this.trigger('ready', true);
                }
                this._render();
            }
        }    //@method shipAddressChange
,
        shipAddressChange: function (model, value) {
            this.currentAddress = value;
            var order_address = this.model.get('addresses'), previous_address = this.previousAddress && (order_address.get(this.previousAddress) || this.addresses.get(this.previousAddress)), current_address = this.currentAddress && order_address.get(this.currentAddress) || this.addresses.get(this.currentAddress), changed_zip = previous_address && current_address && previous_address.get('zip') !== current_address.get('zip'), changed_state = previous_address && current_address && previous_address.get('state') !== current_address.get('state'), changed_country = previous_address && current_address && previous_address.get('country') !== current_address.get('country');
            // if previous address is equal to current address we compare the previous values on the model.
            if (previous_address && current_address && previous_address === current_address) {
                changed_zip = current_address.previous('zip') !== current_address.get('zip');
                changed_country = current_address.previous('country') !== current_address.get('country');
                changed_state = current_address.previous('state') !== current_address.get('state');
            }
            // reload ship methods only if there is no previous address or when change the country or zipcode
            if (!previous_address && current_address || changed_zip || changed_country || changed_state) {
                // if its selected a valid address, reload Methods
                if (this.model.get('isEstimating') || this.addresses.get(this.model.get('shipaddress'))) {
                    this.reloadMethods();
                }
            } else {
                this.render();
            }
            if (value) {
                this.previousAddress = value;
            }
            // if we select a new address, bind the sync method for possible address edits
            if (this.currentAddress) {
                var selected_address = this.addresses.get(this.currentAddress);
                if (selected_address) {
                    selected_address.on('sync', jQuery.proxy(this, 'reloadMethods'), this);
                }
                // if there was a different previous address, remove the sync handler
                if (this.previousAddress && this.previousAddress !== this.currentAddress) {
                    var previous_selected_address = this.addresses.get(this.previousAddress);
                    if (previous_selected_address) {
                        previous_selected_address.off('sync');
                    }
                }
            }
        }    //@method reloadMethods
,
        reloadMethods: function reloadMethods() {
            if (this.model.get('confirmation').internalid || this.model.get('confirmation').id) {
                return;
            }
            // to reload the shipping methods we just save the order
            var self = this, $container = this.$el;
            $container.addClass('loading');
            // Abort the previous ajax call
            this.reloadMethodsPromise.abort && this.reloadMethodsPromise.abort();
            this.reloadingMethods = true;
            this.render();
            this.reloadMethodsPromise = this.model.save(null, {
                parse: false,
                success: function (model, attributes) {
                    model.set({
                        shipmethods: attributes.shipmethods,
                        shipmethod: attributes.shipmethod,
                        summary: attributes.summary
                    });
                }
            }).always(function (xhr) {
                // .always() method is excecuted even if the ajax call was aborted
                if (xhr.statusText !== 'abort') {
                    $container.removeClass('loading');
                    self.render();
                    self.step.enableNavButtons();
                    self.reloadingMethods = false;
                }
            });
            if (this.reloadMethodsPromise.state() === 'pending') {
                self.step.disableNavButtons();
            }
        }    //@method submit
,
        submit: function submit() {
            return this.isValid();
        }    //@method isValid
,
        isValid: function isValid() {
            var model = this.model, valid_promise = jQuery.Deferred();
            this.reloadMethodsPromise.always(function () {
                if (model.get('shipmethod') && model.get('shipmethods').get(model.get('shipmethod'))) {
                    valid_promise.resolve();
                } else {
                    valid_promise.reject({
                        errorCode: 'ERR_CHK_SELECT_SHIPPING_METHOD',
                        errorMessage: _('Please select a delivery method').translate()
                    });
                }
            });
            return valid_promise;
        }    //@method changeDeliveryOptions
,
        changeDeliveryOptions: function changeDeliveryOptions(e) {
            var self = this, target = jQuery(e.currentTarget), targetValue = target.val() || target.attr('data-value');
            this.waitShipmethod = true;
            this.model.set('shipmethod', targetValue);
            this.step.disableNavButtons();
            this.model.save().always(function () {
                self.clearError();
                self.step.enableNavButtons();
            });
        }    //@method showError render the error message
,
        showError: function showError() {
            var global_view_message = new GlobalViewsMessageView({
                message: this.error.errorMessage,
                type: 'error',
                closable: true
            });
            // Note: in special situations (like in payment-selector), there are modules inside modules, so we have several place holders, so we only want to show the error in the first place holder.
            this.$('[data-type="alert-placeholder-module"]:first').html(global_view_message.render().$el.html());
            this.error = null;
        }    //@method getContext
             //@returns {OrderWizard.Module.Shipmethod.Context}
,
        getContext: function getContext() {
            var self = this, show_enter_shipping_address_first = !this.model.get('isEstimating') && !this.profileModel.get('addresses').get(this.model.get('shipaddress')), shipping_methods = this.model.get('shipmethods').map(function (shipmethod) {
                    return {
                        name: shipmethod.get('name'),
                        rate_formatted: shipmethod.get('rate_formatted'),
                        internalid: shipmethod.get('internalid'),
                        isActive: shipmethod.get('internalid') === self.model.get('shipmethod')
                    };
                });
            //@class OrderWizard.Module.Shipmethod.Context
            return {
                //@property {LiveOrder.Model} model
                model: this.model,
                showEnterShippingAddressFirst: show_enter_shipping_address_first    //@property {Boolean} showLoadingMethods
,
                showLoadingMethods: this.reloadingMethods,
                hasShippingMethods: !!shipping_methods.length,
                showSelectForShippingMethod: shipping_methods.length > 5    //@property {Array} shippingMethods
,
                shippingMethods: shipping_methods    //@property {Boolean} showTitle
,
                showTitle: !this.options.hide_title,
                title: this.options.title || _('Delivery Method').translate()
            };    //@class OrderWizard.Module.Shipmethod
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard.Module.CartItems
define('OrderWizard.Module.CartItems.Ship', [
    'Wizard.Module',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'Transaction.Line.Views.Cell.Navigable.View',
    'SC.Configuration',
    'Address.Details.View',
    'order_wizard_cartitems_module_ship.tpl',
    'underscore',
    'Utils'
], function (WizardModule, BackboneCompositeView, BackboneCollectionView, TransactionLineViewsCellNavigableView, Configuration, AddressDetailsView, order_wizard_cartitems_module_ship_tpl, _) {
    'use strict';
    //@class OrderWizard.Module.CartItems.Ship @extends Wizard.Module
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_cartitems_module_ship_tpl,
        initialize: function () {
            var self = this;
            WizardModule.prototype.initialize.apply(this, arguments);
            this.wizard.model.on('ismultishiptoUpdated', function () {
                self.render();
            });
            this.wizard.model.on('promocodeUpdated', function () {
                self.render();
            });
            this.wizard.model.on('change:lines', function () {
                self.lines = self.wizard.model.getShippableLines();
                self.render();
            });
            this.lines = this.wizard.model.getShippableLines();
            BackboneCompositeView.add(this);
            this.options = this.options || {};
            this.options.exclude_on_skip_step = true;
            this.wizard.model.on('change:shipaddress', function () {
                self.initializeAddress();
            });
            this.initializeAddress(true);
        },
        initializeAddress: function (no_render) {
            if (this.address) {
                this.address.off('change', null, null);
            }
            this.address = this.wizard.options.profile.get('addresses').get(this.wizard.model.get('shipaddress'));
            if (this.address) {
                this.address.on('change', this.render, this);
            }
            if (!no_render) {
                this.render();
            }
        },
        isActive: function isActive() {
            return this.lines.length;
        }    //@property {Object} childViews
,
        childViews: {
            'Items.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.lines,
                    childView: TransactionLineViewsCellNavigableView,
                    viewsPerRow: 1,
                    childViewOptions: {
                        navigable: false,
                        detail1Title: _('Qty:').translate(),
                        detail1: 'quantity',
                        detail2Title: _('Unit price:').translate(),
                        detail2: 'rate_formatted',
                        detail3Title: _('Amount:').translate(),
                        detail3: 'total_formatted'
                    }
                });
            },
            'Address.Details': function () {
                if (this.address) {
                    return new AddressDetailsView({
                        model: this.address,
                        hideActions: true,
                        hideDefaults: true
                    });
                }
            }
        }    //@method render
,
        render: function () {
            this.application = this.wizard.application;
            this.profile = this.wizard.options.profile;
            this.options.application = this.wizard.application;
            if (this.isActive()) {
                this._render();
            }
        }    //@method getContext @returns {OrderWizard.Module.CartItems.Context}
,
        getContext: function () {
            var lines = this.lines, item_count = _.countItems(lines);
            //@class OrderWizard.Module.CartItems.Context
            return {
                //@property {LiveOrder.Model} model
                model: this.model,
                itemCount: item_count    //@property {Boolean} showOpenedAccordion
,
                showOpenedAccordion: !!this.options.show_opened_accordion,
                isAccordionPrimary: !!this.options.is_accordion_primary,
                showEditCartButton: !!this.options.show_edit_cart_button,
                showHeaders: !!this.options.show_headers,
                showMobile: !!this.options.show_mobile,
                address: this.address,
                showAddress: !!this.address && this.options.hide_address !== true && !this.wizard.isMultiShipTo()
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard.Module.Shipmethod
define('OrderWizard.Module.ShowShipments', [
    'Wizard.Module',
    'Address.Details.View',
    'OrderWizard.Module.CartItems.Ship',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'order_wizard_showshipments_module.tpl',
    'underscore',
    'jQuery',
    'Utils'
], function (WizardModule, AddressDetailsView, OrderWizardModuleCartItemsShip, BackboneCompositeView, BackboneCollectionView, order_wizard_showshipments_module_tpl, _, jQuery) {
    'use strict';
    //@class OrderWizard.Module.ShowShipments @extends Wizard.Module
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_showshipments_module_tpl    //@property {Array} errors
,
        errors: [
            'ERR_NOT_SET_SHIPPING_METHODS',
            'ERR_NOT_SET_SHIPPING_ADDRESS'
        ],
        shipMethodIsRequire: {
            errorMessage: _('Please select a delivery method').translate(),
            errorCode: 'ERR_NOT_SET_SHIPPING_METHODS'
        },
        shipAddressIsRequire: {
            errorMessage: _('Please select a shipping address').translate(),
            errorCode: 'ERR_NOT_SET_SHIPPING_ADDRESS'
        }    //@property {Object} events
,
        events: { 'change [data-action="change-delivery-options"]': 'changeDeliveryOptions' },
        initialize: function () {
            WizardModule.prototype.initialize.apply(this, arguments);
            this.application = this.wizard.application;
            this.options.application = this.wizard.application;
            this.addressSource = this.options.useModelAddresses ? this.model.get('addresses') : this.wizard.options.profile.get('addresses');
            BackboneCompositeView.add(this);
            this.wizard.model.on('ismultishiptoUpdated', this.render, this);
            this.wizard.model.on('promocodeUpdated', this.render, this);
        }    //@method isActive
             //@return {Boolean}
,
        isActive: function () {
            return !this.model.get('ismultishipto') && this.model.getIfThereAreDeliverableItems();
        },
        isValid: function () {
            if (this.model.shippingAddressIsRequired()) {
                if (!this.model.get('shipmethod')) {
                    return jQuery.Deferred().reject(this.shipMethodIsRequire);
                } else if (!this.model.get('shipaddress')) {
                    return jQuery.Deferred().reject(this.shipAddressIsRequire);
                }
            }
            return jQuery.Deferred().resolve();
        }    //@method changeDeliveryOptions
,
        changeDeliveryOptions: function (e) {
            var value = this.$(e.target).val(), self = this;
            this.model.set('shipmethod', value);
            this.step.disableNavButtons();
            this.model.save().always(function () {
                self.render();
                self.step.enableNavButtons();
            });
        }    //@property {Object} childViews
,
        childViews: {
            'Shipping.Address': function () {
                return new AddressDetailsView({
                    hideActions: !!this.options.hide_edit_address_button,
                    hideDefaults: true,
                    hideRemoveButton: true,
                    manage: 'shipaddress',
                    model: this.addressSource.get(this.model.get('shipaddress'))
                });
            },
            'Items.Collection': function () {
                return new OrderWizardModuleCartItemsShip({
                    wizard: this.wizard,
                    exclude_on_skip_step: true,
                    hide_address: true,
                    show_opened_accordion: _.isDesktopDevice(),
                    is_accordion_primary: true,
                    show_edit_cart_button: !this.options.hide_edit_cart_button,
                    show_headers: false,
                    show_mobile: true
                });
            }
        }    //@method getContext
             //@returns {OrderWizard.Module.ShowShipments.Context}
,
        getContext: function () {
            var self = this, selected_shipmethod = this.model.get('shipmethods').findWhere({ internalid: this.model.get('shipmethod') }), shipping_methods = this.model.get('shipmethods').map(function (shipmethod) {
                    return {
                        name: shipmethod.get('name'),
                        rate_formatted: shipmethod.get('rate_formatted'),
                        internalid: shipmethod.get('internalid'),
                        isActive: shipmethod.get('internalid') === self.model.get('shipmethod')
                    };
                }), address_source = this.addressSource.get(this.model.get('shipaddress'));
            //@class OrderWizard.Module.ShowShipments.Context
            return {
                //@property {LiveOrder.Model} model
                model: this.model,
                showShippingInformation: !!this.model.shippingAddressIsRequired()    //@property {Boolean} showShippingAddress
,
                showShippingAddress: !!address_source    //@property {String} editUrl
,
                editUrl: this.options.edit_url,
                showEditButton: !!this.options.edit_url,
                showSelectedShipmethod: !!selected_shipmethod    //@property {Object} selectedShipmethod
,
                selectedShipmethod: selected_shipmethod    //@property {Array} shippingMethods
,
                shippingMethods: shipping_methods    //@property {Boolean} showShippingMetod
,
                showShippingMetod: !this.options.hideShippingMethod,
                shippingAddress: !!address_source && address_source.get('fullname')
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard.Module.CartItems
define('OrderWizard.Module.CartItems', [
    'Wizard.Module',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'Transaction.Line.Views.Cell.Navigable.View',
    'order_wizard_cartitems_module.tpl',
    'underscore',
    'Utils'
], function (WizardModule, BackboneCompositeView, BackboneCollectionView, TransactionLineViewsCellNavigableView, order_wizard_cartitems_module_tpl, _) {
    'use strict';
    //@class OrderWizard.Module.CartItems @extends Wizard.Module
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_cartitems_module_tpl    //@method render
,
        render: function () {
            this.application = this.wizard.application;
            this.profile = this.wizard.options.profile;
            this.options.application = this.wizard.application;
            if (this.isActive()) {
                this._render();
            }
        },
        initialize: function () {
            var self = this;
            WizardModule.prototype.initialize.apply(this, arguments);
            this.wizard.model.on('ismultishiptoUpdated', function () {
                self.render();
            });
            this.wizard.model.on('promocodeUpdated', function () {
                self.render();
            });
            BackboneCompositeView.add(this);
        }    //@property {Object} childViews
,
        childViews: {
            'Items.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.model.get('lines'),
                    childView: TransactionLineViewsCellNavigableView,
                    viewsPerRow: 1,
                    childViewOptions: {
                        navigable: !this.options.hide_item_link,
                        detail1Title: _('Qty:').translate(),
                        detail1: 'quantity',
                        detail2Title: _('Unit price:').translate(),
                        detail2: 'rate_formatted',
                        detail3Title: _('Amount:').translate(),
                        detail3: 'amount_formatted'
                    }
                });
            }
        }    //@method getContext @returns {OrderWizard.Module.CartItems.Context}
,
        getContext: function () {
            var lines = this.model.get('lines'), item_count = _.countItems(lines);
            //@class OrderWizard.Module.CartItems.Context
            return {
                //@property {LiveOrder.Model} model
                model: this.model,
                itemCountGreaterThan1: item_count > 1    //@property {Number} itemCount
,
                itemCount: item_count    //@property {Boolean} showOpenedAccordion
,
                showOpenedAccordion: _.result(this.options || {}, 'showOpenedAccordion', false)    //@property {Boolean} showEditCartButton
,
                showEditCartButton: !this.options.hide_edit_cart_button,
                showHeaders: !this.options.hideHeaders,
                showMobile: this.options.showMobile
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Locator
define('Location.VenueDetails.View', [
    'locator_venue_details.tpl',
    'underscore',
    'Backbone.CompositeView',
    'Backbone'
], function (locator_venue_details_tpl, _, BackboneCompositeView, Backbone) {
    'use strict';
    return Backbone.View.extend({
        template: locator_venue_details_tpl    //@method initialize
                                     //@params {Object} options
,
        initialize: function initialize(options) {
            this.model = options.model;
            this.application = options.application;
            this.show_address = options.showAddress;
            this.hide_cutoff_time = options.hideCutoffTime;
            BackboneCompositeView.add(this);
        }    //@method setOpeningHours
,
        setOpeningHours: function setOpeningHours() {
            var opening_hours = this.model.get('servicehours'), opening_hours_str_list = [];
            _.each(opening_hours, function (row) {
                var hours = row.starttime + _.translate(' to ') + row.endtime, days_list = [
                        row.monday === 'T',
                        row.tuesday === 'T',
                        row.wednesday === 'T',
                        row.thursday === 'T',
                        row.friday === 'T',
                        row.saturday === 'T',
                        row.sunday === 'T'
                    ], days_name = [
                        _.translate('Monday'),
                        _.translate('Tuesday'),
                        _.translate('Wednesday'),
                        _.translate('Thursday'),
                        _.translate('Friday'),
                        _.translate('Saturday'),
                        _.translate('Sunday')
                    ], days = '', sequence_days = [], discontinuous_days = [], sequence_active = false, sequence_finish = false;
                _.each(days_list, function (day, key) {
                    if (day) {
                        if (sequence_days.length === 0) {
                            sequence_active = true;
                        }
                        if (sequence_active && !sequence_finish) {
                            sequence_days.push(days_name[key]);
                        } else {
                            discontinuous_days.push(days_name[key]);
                        }
                    } else if (sequence_active) {
                        if (sequence_days.length < 3) {
                            sequence_active = false;
                            discontinuous_days = discontinuous_days.concat(sequence_days);
                            sequence_days = [];
                        } else {
                            sequence_finish = true;
                        }
                    }
                });
                if (sequence_days.length < 3) {
                    sequence_active = false;
                    discontinuous_days = discontinuous_days.concat(sequence_days);
                }
                if (sequence_active) {
                    days = sequence_days[0] + _.translate(' to ') + sequence_days[sequence_days.length - 1];
                }
                _.each(discontinuous_days, function (discontinuous_day, key) {
                    if (key === 0 && !sequence_active) {
                        days = days + discontinuous_day;
                    } else if (key === discontinuous_days.length - 1) {
                        days = days + _.translate(' and ') + discontinuous_day;
                    } else {
                        days = days + ', ' + discontinuous_day;
                    }
                });
                var open_hours_row = { row: days + ' - ' + hours };
                opening_hours_str_list.push(open_hours_row);
            });
            return opening_hours_str_list;
        }    //@method getContext
,
        getContext: function getContext() {
            var model = this.model;
            return {
                //@property {StoreLocator.Model} model
                location: model    //@property {Boolean} showAddress 
,
                showAddress: this.show_address,
                showStoreAddress: !!model.get('address1')    //@property {Boolean} showCity
,
                showCity: !!model.get('city')    //@property {Boolean} showZipCode
,
                showZipCode: !!model.get('zip')    //@property {Boolean} showStoreState
,
                showStoreState: !!model.get('state')    //@property {Boolean} showPhone
,
                showPhone: !!model.get('phone')    //@property {Boolean} showServiceHours
,
                showServiceHours: !!(model.get('servicehours') && model.get('servicehours').length)    //@property {Array} serviceHours
,
                serviceHours: this.setOpeningHours()    //@property {Boolean} showCutoffTime
,
                showCutoffTime: !this.hide_cutoff_time && !!model.get('nextpickupday')    //@property {Boolean} showCutoffTime
,
                nextPickupDayIsToday: this.model.get('nextpickupday') === 'today'    //@property {Boolean} nextPickupDayIsToday
,
                nextPickupDayIsTomorrow: this.model.get('nextpickupday') === 'tomorrow'    //@property {Boolean} nextPickupDayIsTomorrow
,
                nextPickupDayIsSunday: this.model.get('nextpickupday') === 'sunday'    //@property {Boolean} nextPickupDayIsSunday
,
                nextPickupDayIsMonday: this.model.get('nextpickupday') === 'monday'    //@property {Boolean} nextPickupDayIsMonday
,
                nextPickupDayIsTuesday: this.model.get('nextpickupday') === 'tuesday'    //@property {Boolean} nextPickupDayIsTuesday
,
                nextPickupDayIsWednesday: this.model.get('nextpickupday') === 'wednesday'    //@property {Boolean} nextPickupDayIsWednesday
,
                nextPickupDayIsThursday: this.model.get('nextpickupday') === 'thursday'    //@property {Boolean} nextPickupDayIsThursday
,
                nextPickupDayIsFriday: this.model.get('nextpickupday') === 'friday'    //@property {Boolean} nextPickupDayIsFriday
,
                nextPickupDayIsSaturday: this.model.get('nextpickupday') === 'saturday'
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard.Module.CartItems
define('OrderWizard.Module.CartItems.PickupInStore.Package.View', [
    'Location.VenueDetails.View',
    'Backbone',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'Transaction.Line.Views.Cell.Navigable.View',
    'SC.Configuration',
    'order_wizard_cartitems_module_pickup_in_store_package.tpl',
    'underscore',
    'Utils'
], function (LocationVenueDetailsView, Backbone, BackboneCompositeView, BackboneCollectionView, TransactionLineViewsCellNavigableView, Configuration, order_wizard_cartitems_module_pickup_in_store_package_tpl, _) {
    'use strict';
    //@class OrderWizard.Module.CartItems.PickupInStore.Package @extends Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: order_wizard_cartitems_module_pickup_in_store_package_tpl,
        initialize: function (options) {
            this.model = options.model;
            this.lines = options.model.get('lines');
            this.location = this.lines[0].get('location');
            BackboneCompositeView.add(this);
            this.location.on('change', this.render, this);
        }    //@property {Object} childViews
,
        childViews: {
            'Items.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.lines,
                    childView: TransactionLineViewsCellNavigableView,
                    viewsPerRow: 1,
                    childViewOptions: {
                        navigable: false,
                        detail1Title: _('Qty:').translate(),
                        detail1: 'quantity',
                        detail2Title: _('Unit price:').translate(),
                        detail2: 'rate_formatted',
                        detail3Title: _('Amount:').translate(),
                        detail3: 'total_formatted'
                    }
                });
            },
            'PickupInStore.StoreLocationInfo': function () {
                return new LocationVenueDetailsView({
                    model: this.location,
                    application: this.application,
                    showAddress: true
                });
            }
        }    //@method getContext @returns {OrderWizard.Module.CartItems.Context}
,
        getContext: function () {
            var lines = this.lines, item_count = _.countItems(lines);
            //@class OrderWizard.Module.CartItems.Context
            return {
                //@property {LiveOrder.Model} model
                model: this.model,
                itemCountGreaterThan1: item_count > 1    //@property {Number} itemCount
,
                itemCount: item_count    //@property {Boolean} showOpenedAccordion
,
                showOpenedAccordion: !!this.options.show_opened_accordion,
                isAccordionPrimary: !!this.options.is_accordion_primary,
                showEditCartButton: !!this.options.show_edit_cart_button,
                showHeaders: !!this.options.show_headers,
                showMobile: !!this.options.show_mobile,
                location: this.location,
                showLocation: !!this.location.get('name') && !this.options.hide_location
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard.Module.CartItems
define('OrderWizard.Module.CartItems.PickupInStore', [
    'Wizard.Module',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'Transaction.Line.Views.Cell.Navigable.View',
    'OrderWizard.Module.CartItems.PickupInStore.Package.View',
    'SC.Configuration',
    'order_wizard_cartitems_module_pickup_in_store.tpl',
    'underscore',
    'Utils'
], function (WizardModule, BackboneCompositeView, BackboneCollectionView, TransactionLineViewsCellNavigableView, OrderWizardModuleCartItemsPickupInStorePackageView, Configuration, order_wizard_cartitems_module_pickup_in_store_tpl, _) {
    'use strict';
    //@class OrderWizard.Module.CartItems.PickupInStore @extends Wizard.Module
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_cartitems_module_pickup_in_store_tpl,
        initialize: function () {
            var self = this;
            WizardModule.prototype.initialize.apply(this, arguments);
            this.wizard.model.on('ismultishiptoUpdated', function () {
                self.render();
            });
            this.wizard.model.on('promocodeUpdated', function () {
                self.render();
            });
            this.wizard.model.on('change:lines', function () {
                self.lines = self.wizard.model.getPickupInStoreLines();
                self.render();
            });
            this.lines = this.model.getPickupInStoreLines();
            BackboneCompositeView.add(this);
            this.options = this.options || {};
            this.options.exclude_on_skip_step = true;
        },
        isActive: function isActive() {
            return Configuration.get('siteSettings.isPickupInStoreEnabled') && this.lines.length;
        }    //@property {Object} childViews
,
        childViews: {
            'Packages.Collection': function () {
                var lines_for_pickup = this.model.getPickupInStoreLines(), lines_by_location = _.groupBy(lines_for_pickup, function (line) {
                        return line.get('location');
                    });
                lines_by_location = _.map(lines_by_location, function (lines, location_id) {
                    return {
                        lines: lines,
                        location: location_id
                    };
                });
                return new BackboneCollectionView({
                    collection: lines_by_location,
                    childView: OrderWizardModuleCartItemsPickupInStorePackageView,
                    viewsPerRow: 1,
                    childViewOptions: {
                        hide_location: this.options.hide_location,
                        show_opened_accordion: this.options.show_opened_accordion,
                        show_edit_cart_button: this.options.show_edit_cart_button,
                        show_headers: this.options.show_headers,
                        show_mobile: this.options.show_mobile
                    }
                });
            }
        }    //@method render
,
        render: function () {
            this.application = this.wizard.application;
            this.profile = this.wizard.options.profile;
            this.options.application = this.wizard.application;
            if (this.isActive()) {
                this._render();
            }
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard.Module.CartItems
define('OrderWizard.Module.CartItems.PickupInStore.Details.View', [
    'Location.VenueDetails.View',
    'Backbone',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'OrderWizard.Module.CartItems.PickupInStore.Package.View',
    'SC.Configuration',
    'order_wizard_cartitems_pickup_in_store_details.tpl',
    'Utils'
], function (LocationVenueDetailsView, Backbone, BackboneCompositeView, BackboneCollectionView, OrderWizardModuleCartItemsPickupInStorePackageView, Configuration, order_wizard_cartitems_pickup_in_store_details) {
    'use strict';
    //@class OrderWizard.Module.CartItems.PickupInStore.Details @extends Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: order_wizard_cartitems_pickup_in_store_details    //@method initialize
,
        initialize: function (options) {
            this.model = options.model;
            this.lines = options.model.get('lines');
            this.location = this.lines[0].get('location');
            BackboneCompositeView.add(this);
            this.location.on('change', this.render, this);
        }    //@property {Object} childViews
,
        childViews: {
            'Items.Collection': function () {
                return new OrderWizardModuleCartItemsPickupInStorePackageView({
                    model: this.model,
                    hide_location: true,
                    show_opened_accordion: this.options.show_opened_accordion,
                    is_accordion_primary: this.options.is_accordion_primary,
                    show_edit_cart_button: this.options.show_edit_cart_button,
                    show_headers: this.options.show_headers,
                    show_mobile: this.options.show_mobile
                });
            },
            'PickupInStore.StoreLocationInfo': function () {
                return new LocationVenueDetailsView({
                    model: this.location,
                    application: this.application,
                    showAddress: true
                });
            }
        }    //@method getContext @return OrderWizard.Module.CartItems.PickupInStore.Details.View.Context
,
        getContext: function () {
            //@class OrderWizard.Module.CartItems.PickupInStore.Details.View.Context
            return {
                //@property {Boolean} showLocation
                showLocation: !!this.location.get('name')    //@property {StoreLocation.Model} location
,
                location: this.location
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard.Module.CartItems
define('OrderWizard.Module.CartItems.PickupInStore.List', [
    'Wizard.Module',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'OrderWizard.Module.CartItems.PickupInStore.Details.View',
    'SC.Configuration',
    'order_wizard_cartitems_pickup_in_store_list.tpl',
    'underscore',
    'Utils'
], function (WizardModule, BackboneCompositeView, BackboneCollectionView, OrderWizardModuleCartItemsPickupInStoreDetailsView, Configuration, order_wizard_cartitems_pickup_in_store_list, _) {
    'use strict';
    //@class OrderWizard.Module.CartItems.PickupInStore.List @extends Wizard.Module
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_cartitems_pickup_in_store_list    //@method initialize
,
        initialize: function () {
            var self = this;
            WizardModule.prototype.initialize.apply(this, arguments);
            this.wizard.model.on('ismultishiptoUpdated', function () {
                self.render();
            });
            this.wizard.model.on('promocodeUpdated', function () {
                self.render();
            });
            this.lines = this.model.getPickupInStoreLines();
            this.model.on('change', function () {
                self.lines = self.model.getPickupInStoreLines();
            });
            BackboneCompositeView.add(this);
        }    //@property {Boolean} isActive
,
        isActive: function isActive() {
            return Configuration.get('siteSettings.isPickupInStoreEnabled') && this.lines.length;
        }    //@property {Object} childViews
,
        childViews: {
            'Packages.Collection': function () {
                var lines_for_pickup = this.lines, lines_by_location = _.groupBy(lines_for_pickup, function (line) {
                        return line.get('location');
                    });
                lines_by_location = _.map(lines_by_location, function (lines, location_id) {
                    return {
                        lines: lines,
                        location: location_id
                    };
                });
                return new BackboneCollectionView({
                    collection: lines_by_location,
                    childView: OrderWizardModuleCartItemsPickupInStoreDetailsView,
                    viewsPerRow: 1,
                    childViewOptions: {
                        show_opened_accordion: this.options.show_opened_accordion,
                        is_accordion_primary: this.options.is_accordion_primary,
                        show_edit_cart_button: this.options.show_edit_cart_button,
                        show_headers: this.options.show_headers,
                        show_mobile: this.options.show_mobile
                    }
                });
            }
        }    //@method render
,
        render: function () {
            this.application = this.wizard.application;
            this.profile = this.wizard.options.profile;
            this.options.application = this.wizard.application;
            if (this.isActive()) {
                this._render();
            }
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Header
define('Header.Logo.View', [
    'SC.Configuration',
    'header_logo.tpl',
    'Backbone',
    'Utils'
], function (Configuration, header_logo_tpl, Backbone, Utils) {
    'use strict';
    // @class Header.Logo.View @extends Backbone.View
    return Backbone.View.extend({
        // @property {Function} template
        template: header_logo_tpl    // @method initialize
                           // @param {Header.LogoView.Initialize.Options} options
                           // @return {Void}
                           // @method getContext @return {Header.Logo.View.Context}
,
        getContext: function () {
            // @class Header.Logo.View.Context
            return {
                // @property {String} logoUrl
                logoUrl: Utils.getAbsoluteUrlOfNonManagedResources(Configuration.get('header.logoUrl'))    // @property {String} headerLinkHref
,
                headerLinkHref: this.options.headerLinkHref || '/'    // @property {String} headerLinkTouchPoint
,
                headerLinkTouchPoint: this.options.headerLinkTouchPoint || 'home'    // @property {String} headerLinkHashtag
,
                headerLinkHashtag: this.options.headerLinkHashtag || '#'    // @property {String} headerLinkTitle
,
                headerLinkTitle: this.options.headerLinkTitle || SC.ENVIRONMENT.siteSettings.displayname
            };
        }
    });
});    // @class Header.LogoView.Initialize.Options
       // @property {String} headerLinkHref This is the URL the header uses
       // @property {String} headerLinkTouchPoint
       // @property {String} headerLinkHashtag
       // @property {String} headerLinkTitle


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Header
define('Header.MiniCartSummary.View', [
    'LiveOrder.Model',
    'header_mini_cart_summary.tpl',
    'Backbone',
    'underscore'
], function (LiveOrderModel, header_mini_cart_summary_tpl, Backbone, _) {
    'use strict';
    // @class Header.MiniCartSummary.View @extends Backbone.View
    return Backbone.View.extend({
        template: header_mini_cart_summary_tpl,
        initialize: function () {
            var self = this;
            this.itemsInCart = 0;
            this.showPluraLabel = true;
            this.isLoading = true;
            LiveOrderModel.loadCart().done(function () {
                var cart = LiveOrderModel.getInstance();
                self.itemsInCart = _.reduce(cart.get('lines').pluck('quantity'), function (memo, quantity) {
                    return memo + (parseFloat(quantity) || 1);
                }, 0);
                self.showPluraLabel = self.itemsInCart !== 1;
                self.isLoading = false;
                self.render();
                cart.on('change', function () {
                    self.render();
                });
            });
            this.on('afterViewRender', function () {
                self.isLoading && _.ellipsis('.header-mini-cart-summary-cart-ellipsis');
            });
        }    // @method getContext @return {Header.MiniCart.View.Context}
,
        getContext: function () {
            // @class Header.MiniCartSummary.View.Context
            return {
                // @property {Number} itemsInCart
                itemsInCart: this.itemsInCart,
                showPluraLabel: this.showPluraLabel,
                isLoading: this.isLoading
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Header
define('Header.MiniCartItemCell.View', [
    'Transaction.Line.Views.Options.Selected.View',
    'Profile.Model',
    'header_mini_cart_item_cell.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'Backbone.CollectionView'
], function (TransactionLineViewsOptionsSelectedView, ProfileModel, header_mini_cart_item_cell_tpl, Backbone, BackboneCompositeView) {
    'use strict';
    // @class Header.MiniCart.View @extends Backbone.View
    return Backbone.View.extend({
        template: header_mini_cart_item_cell_tpl,
        initialize: function () {
            BackboneCompositeView.add(this);
        },
        childViews: {
            'Item.SelectedOptions': function () {
                return new TransactionLineViewsOptionsSelectedView({ model: this.model });
            }
        }    // @method getContext
             // @return {Header.MiniCart.View.Context}
,
        getContext: function () {
            // @class Header.MiniCart.View.Context
            return {
                line: this.model,
                itemId: this.model.get('item').id,
                itemType: this.model.get('item').get('itemtype')    //@property {String} linkAttributes
,
                linkAttributes: this.model.getFullLink({
                    quantity: null,
                    location: null,
                    fulfillmentChoice: null
                })    // @property {ImageContainer} thumbnail
,
                thumbnail: this.model.getThumbnail()    // @property {Boolean} isPriceEnabled
,
                isPriceEnabled: !ProfileModel.getInstance().hidePrices()    // @property {Boolean} isFreeGift
,
                isFreeGift: this.model.get('free_gift') === true
            };    // @class Header.MiniCart.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Header
define('Header.MiniCart.View', [
    'LiveOrder.Model',
    'Header.MiniCartSummary.View',
    'Header.MiniCartItemCell.View',
    'Profile.Model',
    'SC.Configuration',
    'header_mini_cart.tpl',
    'underscore',
    'Backbone',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'underscore',
    'Utils'
], function (LiveOrderModel, HeaderMiniCartSummaryView, HeaderMiniCartItemCellView, ProfileModel, Configuration, header_mini_cart_tpl, _, Backbone, BackboneCompositeView, BackboneCollectionView) {
    'use strict';
    // @class Header.MiniCart.View @extends Backbone.View
    return Backbone.View.extend({
        template: header_mini_cart_tpl    //@property {Object} attributes List of HTML attributes applied by Backbone into the $el
,
        attributes: {
            'id': 'Header.MiniCart.View',
            'data-root-component-id': 'Header.MiniCart.View'
        },
        initialize: function initialize() {
            BackboneCompositeView.add(this);
            var self = this;
            this.isLoading = true;
            this.itemsInCart = 0;
            this.model = LiveOrderModel.getInstance();
            LiveOrderModel.loadCart().done(function () {
                self.isLoading = false;
                self.render();
            });
            this.model.on('change', this.render, this);
            this.model.get('lines').on('add remove', this.render, this);
        },
        render: function render() {
            this.itemsInCart = this.model.getTotalItemCount();
            Backbone.View.prototype.render.apply(this, arguments);
            //on tablet or desktop make the minicart dropdown
            if (_.isTabletDevice() || _.isDesktopDevice()) {
                this.$('[data-type="mini-cart"]').attr('data-toggle', 'dropdown');
            }
        },
        destroy: function destroy() {
            this._destroy();
            this.model.off('change', this.render, this);
            this.model.get('lines').off('add remove', this.render, this);
        },
        childViews: {
            'Header.MiniCartSummary': function () {
                return new HeaderMiniCartSummaryView();
            },
            'Header.MiniCartItemCell': function () {
                return new BackboneCollectionView({
                    collection: !this.isLoading ? this.model.get('lines') : new Backbone.Collection(),
                    childView: HeaderMiniCartItemCellView,
                    viewsPerRow: 1
                });
            }
        }    // @method getContext
             // @return {Header.MiniCart.View.Context}
,
        getContext: function () {
            var summary = this.model.get('summary');
            // @class Header.MiniCart.View.Context
            return {
                // @property {LiveOrder.Model} model
                model: this.model,
                itemsInCart: this.itemsInCart,
                showPluraLabel: this.itemsInCart !== 1    // @property {Boolean} showLines
,
                showLines: this.itemsInCart > 0    // @property {Boolean} isLoading
,
                isLoading: this.isLoading,
                subtotalFormatted: !this.isLoading ? summary && summary.subtotal_formatted : ''    // @property {String} cartTouchPoint
,
                cartTouchPoint: Configuration.get('modulesConfig.Cart.startRouter', false) ? Configuration.get('currentTouchpoint') : 'viewcart'    // @property {Boolean} isPriceEnabled
,
                isPriceEnabled: !ProfileModel.getInstance().hidePrices()
            };    // @class Header.MiniCart.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Product
define('Product.Option.Model', [
    'ProductLine.Option.Model',
    'Backbone',
    'underscore',
    'Utils'
], function (ProductLineOptionModel, Backbone, _, Utils) {
    'use strict';
    //@class Product.Option.Model @extend ProductLine.Option.Model
    return ProductLineOptionModel.extend({
        //@method initialize Override default method to convert the current model "validate-able"
        //@return {Void}
        initialize: function initialize() {
            ProductLineOptionModel.prototype.initialize.apply(this, arguments);
            // Extend the model with Backbone.Validation.mixin to validate it without a View
            _.extend(this, Backbone.Validation.mixin);
        }    //@property {Object} validation
,
        validation: {
            'value.internalid': {
                fn: function optionValueValidator() {
                    var value = this.get('value') && this.get('value').internalid;
                    if (this.get('isMandatory') && !value) {
                        return _('Please specify a value for this option').translate();
                    } else if (value) {
                        var max_length = 160;
                        if (this.get('type') === 'text' || this.get('type') === 'textarea') {
                            if (this.get('isMandatory') && (!Utils.trim(value) || value.length > max_length)) {
                                return _('Please enter a valid input for this string').translate();
                            } else if (value.length > max_length) {
                                return _('Please enter a string shorter (maximum length: $(0))').translate(max_length);
                            }
                        } else if (this.get('type') === 'email' && !Backbone.Validation.patterns.email.test(value)) {
                            return _('Please enter a valid email').translate();
                        } else if (this.get('type') === 'integer' && !Backbone.Validation.patterns.netsuiteInteger.test(value)) {
                            return _('Please enter a valid integer number').translate();
                        } else if (this.get('type') === 'float' && !Backbone.Validation.patterns.netsuiteFloat.test(value)) {
                            return _('Please enter a valid decimal number').translate();
                        } else if (this.get('type') === 'currency' && !Backbone.Validation.patterns.netsuiteFloat.test(value)) {
                            return _('Please enter a valid currency number').translate();
                        } else if (this.get('type') === 'phone' && !Backbone.Validation.patterns.netsuitePhone.test(value)) {
                            return _('Please enter a valid phone').translate();
                        } else if (this.get('type') === 'percent' && !Backbone.Validation.patterns.netsuitePercent.test(value)) {
                            return _('Please enter a valid percent').translate();
                        } else if (this.get('type') === 'url' && !Backbone.Validation.patterns.netsuiteUrl.test(value)) {
                            return _('Please enter a valid url').translate();
                        } else if (this.get('type') === 'select' && !_.findWhere(this.get('values'), { internalid: value })) {
                            return _('Please select a valid value for this option').translate();
                        }
                    }
                }
            }
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Product
define('Product.Option.Collection', [
    'Product.Option.Model',
    'ProductLine.Option.Collection'
], function (ProductOptionModel, ProductLineOptionCollection) {
    'use strict';
    //@class Product.Option.Collection @extend ProductLine.Option.Collection
    return ProductLineOptionCollection.extend({
        // @property {Product.Options.Model} model
        model: ProductOptionModel
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Product
define('Product.Model', [
    'Item.Model',
    'Product.Option.Collection',
    'ProductLine.Common',
    'PluginContainer',
    'SC.Configuration',
    'underscore',
    'Backbone',
    'Utils',
    'jQuery'
], function (ItemModel, ProductOptionCollection, ProductLineCommon, PluginContainer, Configuration, _, Backbone, Utils, jQuery) {
    'use strict';
    // @class Product.Model A product is an item with state (options selection, quantity, etc) @extends Backbone.Model
    var ProductModel = Backbone.Model.extend({
        //@property {Object} validation
        validation: {
            'quantity': {
                fn: function quantityValidator(new_quantity) {
                    var current_quantity = parseInt(new_quantity, 10), maximum_quantity = this.getItem().get('_maximumQuantity');
                    if (!_.isNumber(current_quantity) || _.isNaN(current_quantity) || current_quantity < 1) {
                        return _.translate('Invalid quantity value');
                    } else if (current_quantity < this.getItem().get('_minimumQuantity')) {
                        return _.translate('Please add $(0) or more of this item', this.getItem().get('_minimumQuantity'));
                    } else if (maximum_quantity && current_quantity > maximum_quantity) {
                        return _.translate('Please add $(0) or less of this item', maximum_quantity);
                    }
                }
            },
            'options': {
                fn: function optionsValidator() {
                    var are_options_with_error = false;
                    this.get('options').each(function (option) {
                        are_options_with_error = are_options_with_error || !!option.validate();
                    });
                    return are_options_with_error && _.translate('Invalid options values');
                }
            }
        }    //@method initialize Override default initialize method to assure the correct data structure
             //@param {Object} attributes
             //@return {Void}
,
        initialize: function initialize(attributes) {
            //Setting options should be done with care of the possible next cases:
            //clone			self.get('options') is a collection
            //new lines		self.get('options') is undefined
            //change item	self.get('options') is a collection
            var self = this;
            Backbone.Model.prototype.initialize.apply(this, arguments);
            //We clone the validation object as we need it to be per instance instead of being a class property
            this.validation = _.extend({}, this.validation);
            this.on('change:item', function (model, item) {
                model.set('item', item instanceof ItemModel ? item : new ItemModel(item), { silent: true });
                self.initializeOptions(model.isNew() ? self.get('item').get('options').toJSON() : attributes.options);
            });
            this.trigger('change:item', this, attributes && attributes.item || {});
            //Take into account that as we treat the item as a read-only model, this event should only be triggered when the associated item is fetched
            //ITEM FETCHED
            this.get('item').on('change', this.onItemChangeUpdateLine, this);
            if (this.isNew()) {
                //NEW TRANSACTION LINE
                this.initializeOptions(attributes && attributes.options || this.get('item').get('options').toJSON() || []);
            } else {
                //TRANSACTION LINE LOADED
                this.initializeOptions(this.get('options'));
            }
            // Extend the model with Backbone.Validation.mixin to validate it without a View
            _.extend(this, Backbone.Validation.mixin);
        }    //@method _setQuantity Set the product's quantity in a cancelable way
             //@private
             //@param {Number} quantity
             //@param {Array<Object>} args All the parameters of the original set call
             //@return {jQuery.Deferred}
,
        _setQuantity: function _setQuantity(quantity, args) {
            var self = this;
            return this.cancelableTrigger('beforeChangeQuantity', quantity).then(function () {
                Backbone.Model.prototype.set.apply(self, args);
                self.cancelableTrigger('afterChangeQuantity');
            }, function () {
                //Notify stickIt that the quantity was NOT changed
                self.trigger('change:quantity', self);
                return jQuery.Deferred().reject();
            });
        }    //@method set Override default method to provide control over the setting of the quantity attribute. This allows to cancel this action and perform async operation before it.
             //@param {Object|String} attributes For documentation on this refer to @link http://backbonejs.org/#Model-set
             //@return {Product.Model|jQuery.Deferred}
,
        set: function set(attributes, value, options) {
            var args = Array.prototype.slice.call(arguments);
            if (_.isString(attributes) && attributes === 'quantity' && (!options || !options.silent)) {
                return this._setQuantity(value, args);
            } else if (_.isObject(attributes) && _.isNumber(attributes.quantity) && (!value || !value.silent)) {
                return this._setQuantity(attributes.quantity, args);
            } else {
                return Backbone.Model.prototype.set.apply(this, arguments);
            }
        },
        onItemChangeUpdateLine: function onItemChangeUpdateLine() {
            if (this.isNew()) {
                this.initializeMinimumQuantity();
            }
            this.initializeOptions(this.get('item').get('options').toJSON());
        }    //@method initializeOptions Set the options passed in as parameter to the options property of the current model
             //@param {Array<Product.Option.Model.Attributes|Item.Option.Model.Attributes>} options
             //@return {Void}
,
        initializeOptions: function initializeOptions(options) {
            this.set('options', options instanceof ProductOptionCollection ? options : new ProductOptionCollection(options), { silent: true });
            this.extendOptionsFromItem(this.get('item'), this);
            this.setOptionsValidation();
        }    //@method initializeMinimumQuantity Internal method called when the line's item is fetched, change or when the line is initialized, to set the line quantity
             //based on the item minimum quantity
             //@return {Void}
,
        initializeMinimumQuantity: function initializeMinimumQuantity() {
            //Set minimum quantity
            var line_quantity = this.get('quantity'), minimum_quantity = this.get('item').get('_minimumQuantity') || 1;
            if (!_.isNumber(line_quantity) || _.isNaN(line_quantity) || line_quantity < minimum_quantity) {
                line_quantity = minimum_quantity;
            }
            this.set('quantity', line_quantity, { silent: true });
        }    //@method setOptionsValidation Set the validation property of the current line based on the options collection
             //@return {Void}
,
        setOptionsValidation: function setOptionsValidation() {
            var self = this;
            self.get('options').each(function (option) {
                self.validation[option.get('cartOptionId')] = {
                    fn: function optionValidationFunction(value, cartOptionId, computedState) {
                        var selected_option = computedState.options.findWhere({ cartOptionId: cartOptionId }), validation = selected_option.validate();
                        //We use 'value.internalid' as we are validating the complex object 'value' which is of the form {internalid,label}
                        if (validation && validation['value.internalid']) {
                            return validation['value.internalid'];
                        }
                    }
                };
            });
        }    //@method areAttributesValid
             //@param {Array<String>} attributes List of attributes to be validated
             //@param {Object} validators Object containing the Backbone.Validation validators to apply for the current validation
             //@return {Boolean}
,
        areAttributesValid: function areAttributesValid(attributes, validators) {
            var current_validation = _.extend({}, this.validation);
            _.extend(this.validation, validators || {});
            var result = this.isValid(attributes);
            this.validation = current_validation;
            return result;
        }    // @method setOption Takes care of setting an option to the current model. This method is needed as we use StickIt and Backbone.Validation.
             // We "need" to emulate at the line level some temporal properties to make the validation of the PDP.
             // Apart from the options collection the line has one property per option set, we use the cartOptionId as the property in the line.
             // @param {String} option_cart_id
             // @param {String} value Internalid of the selection option in case the selection is over an select type option, otherwise the string value specified
             // @return {jQuery.Deferred<Product.Option.Model|Boolean>} If the option and the value specified are valid, the selected option is returned, false otherwise
,
        setOption: function setOption(option_cart_id, value) {
            var self = this;
            return this.cancelableTrigger('beforeChangeOption', option_cart_id, value).then(function () {
                var selected_option = self.get('options').findWhere({ cartOptionId: option_cart_id }), selected_value = selected_option && _.findWhere(selected_option.get('values'), { internalid: value });
                if (selected_option) {
                    if (selected_value) {
                        selected_option.set('value', {
                            internalid: selected_value.internalid,
                            label: selected_value.label
                        });
                        self.set(option_cart_id, value);
                    } else if (value !== null && value !== undefined && value !== '' && selected_option.get('type') !== 'select') {
                        selected_option.set('value', {
                            internalid: value,
                            label: value
                        });
                        self.set(option_cart_id, value);
                    } else {
                        selected_option.unset('value');
                        self.unset(option_cart_id);
                    }
                    // If it's a matrix, checks for valid combinations
                    if (selected_option.get('isMatrixDimension') && value && selected_option.get('value')) {
                        var valid_values_for_selected_option = self.getValidValuesForOption(selected_option), reset = !_.contains(valid_values_for_selected_option, selected_option.get('value').label);
                        _.each(self.get('options').where({ 'isMatrixDimension': true }), function (option) {
                            if (reset && option_cart_id !== option.get('cartOptionId')) {
                                self.setOption(option.get('cartOptionId'), null);
                            }
                        });
                        _.each(self.get('options').where({ 'isMatrixDimension': true }), function (option) {
                            var valid_values_for_option = self.getValidValuesForOption(option);
                            _.each(option.get('values'), function (value) {
                                if (value.isAvailable !== _.contains(valid_values_for_option, value.label)) {
                                    value.isAvailable = !value.isAvailable;
                                    self.trigger('change:' + option.get('cartOptionId'), self, self.get(option.get('cartOptionId')));
                                }
                            });
                        });
                    }
                }
                self.cancelableTrigger('afterChangeOption', _.isUndefined(self.get(option_cart_id)) ? false : selected_option.toJSON());
                //if the option and the value specified are valid, the selected option is returned, false otherwise
                return jQuery.Deferred().resolve(_.isUndefined(self.get(option_cart_id)) ? false : selected_option);
            });
        }    //@method isEqual
             //@param {Product.Model|Transaction.Line.Model} other_line
             //@return {Boolean}
,
        isEqual: function isEqual(other_line) {
            var other_line_internalid = _.isFunction(other_line.getItem) ? other_line.getItem().get('internalid') : other_line.get('item').get('internalid');
            if (other_line && this.getItem().get('internalid') === other_line_internalid) {
                var extract_options = function (option) {
                    return {
                        cartOptionId: option.cartOptionId,
                        value: option.value
                    };
                };
                var options_this_line = _.map(this.get('options').toJSON(), extract_options);
                var options_other_line = _.map(other_line.get('options').toJSON(), extract_options);
                return _.isEqual(options_this_line, options_other_line);
            }
            return false;
        }    //@method getImages Get the images of the the product taking into account the current options selection
             //@return {Array<ImageContainer>}
,
        getImages: function getImages() {
            var item = this.get('item'), item_images_detail = item.get('itemimages_detail') || {};
            item_images_detail = item_images_detail.media || item_images_detail;
            var image_filters = Configuration.get('productline.multiImageOption', []), images_container = this.filterImages(item_images_detail, image_filters), result = Utils.imageFlatten(images_container);
            return result.length ? result : [{
                    url: Utils.getThemeAbsoluteUrlOfNonManagedResources('img/no_image_available.jpeg', Configuration.get('imageNotAvailable')),
                    altimagetext: item.get('_name')
                }];
        }    // @method isSelectionComplete
             // @returns {Boolean} true if all mandatory options are set and valid
,
        isSelectionComplete: function isSelectionComplete() {
            var options = this.get('options').where({ isMandatory: true });
            return _.all(options, function (option) {
                return option.isValid(true);
            });
        }    // @method getSelectedOptions
             // @returns {Array<ProductLine.Option.Value>} An array of all the selected option's value
,
        getSelectedOptions: function getSelectedOptions() {
            var selected_options = [];
            this.get('options').each(function (option) {
                if (!option.validate()) {
                    selected_options.push(option.get('value'));
                }
            });
            return selected_options;
        }    // @method getValidValuesForOption Given an <<option ID?>> this method return  GIVEN AN OPTION IDE WHAT ARE THE AVAILABLE VALUES
             // @param {Product.Option.Model} option
             // @returns {Array<Product.Option>} The list of all valid <<<options for the option you passed in>>>
,
        getValidValuesForOption: function getValidValuesForOption(option) {
            var matrix_options = this.getMatrixOptionsSelection();
            //from all item matrix options selection remove the current dimension
            delete matrix_options[option.get('itemOptionId')];
            return _.uniq(_.map(this.getSelectedMatrixChilds(matrix_options), function (model) {
                return model.get(option.get('itemOptionId'));
            }));
        }    // @method getMatrixOptionsSelection Get all selected option by using sourcefrom and label
             // @returns {Product.OptionHelper.MatrixSelection} an object of all the matrix options with its values set (DICTIONARY <STRING: OPTION_ID, STRING: VALUE.LABEL>)
,
        getMatrixOptionsSelection: function getMatrixOptionsSelection() {
            //@class Product.OptionHelper.MatrixSelection @extend Dictionary<String,String>
            // #Description
            // This class represents the selected option in the current line.
            // IMPORTANT: When the Search API returns Matrix Items the property matrixchilditems_detail contains all valid children. These children
            // are identified by its itemid (like itemid = "Mendelevium-N-N") or by the list of properties it has. Given an Item that is a matrix child it will
            // contains one property for each dimension (option), THE KEY POINT IS THAT EACH OF THIS PROPERTIES is the sourcefrom property of each option.
            // Item Returned from the search API:
            // 	...
            // 	displayname: "Mendelevium"
            // 	featureddescription: ""
            // 	internalid: 320
            // 	itemid: "Mendelevium"
            // 	itemimages_detail: {}
            // 	itemoptions_detail: {matrixtype: "parent",…}
            // 		fields: [										<< ITEM OPTIONS
            // 			{
            // 				internalid: "custcol7"
            // 				ismandatory: true
            // 				ismatrixdimension: true
            // 				label: "Radioactive level"
            // 				sourcefrom: "custitem7"					<< OPTION sourcefrom
            // 				type: "select"
            // 				values: [{label: "- Select -"},…]
            // 			1: {…}
            // 		]
            // 	matrixtype: "parent"
            // 	itemtype: "NonInvtPart"
            // 	matrixchilditems_detail: [
            // 		{
            // 			custitem7: "None"							<<< THIS PROPERTY custitem7 is obtained from the item options. The value is the LABE of the related option
            // 			custitem8: "Healthy"
            // 			internalid: 321
            // 			isbackorderable: true
            // 			isinstock: true
            // 			ispurchasable: true
            // 			itemid: "Mendelevium-N-H"
            // 			itemtype: "NonInvtPart"
            // 			onlinecustomerprice_detail: {onlinecustomerprice_formatted: "$12.00", onlinecustomerprice: 12,…}
            // 			outofstockmessage: ""
            // 			showoutofstockmessage: false
            // 		1: {isinstock: true, itemid: "Men...
            //
            // 	#Class Properties
            // 	Key: Option sourcefrom
            // 	Value: Selected option value label
            var matrix_options = this.get('options').where({ isMatrixDimension: true }), result = {};
            _.each(matrix_options, function (matrix_option) {
                // var set_value = self.get(matrix_option.get('cartOptionId'));
                var set_value = matrix_option.get('value');
                // if this option have been set in the current line
                if (set_value) {
                    //Remember that at each option the property itemOptionId is in fact the sourcefrom. See the class Product.Option
                    //This line set the label of the selected option (based on he fact the we set option by setting its internalid)
                    // result[matrix_option.itemOptionId] = _.findWhere(matrix_option.values, {internalid: set_value}).label;
                    result[matrix_option.get('itemOptionId')] = set_value.label;
                }
            });
            // <OPTION:SOURCE ID, SELECTED LABEL>
            return result;
        }    // @method getSelectedMatrixChilds Returns all child item that apply for the passed in selection
             // @param {Product.OptionHelper.MatrixSelection} matrix_options
             // @returns {Array<Item.Model>} All the children of a matrix that complies with the current or passed in selection
,
        getSelectedMatrixChilds: function getSelectedMatrixChilds(matrix_options) {
            var item_matrix_children = this.get('item').get('_matrixChilds');
            //This is a collection of items!!
            //but these items only have a subset of the item options (only those options on the matrixchilditems_detail field set!)
            if (!item_matrix_children) {
                return [];
            }
            matrix_options = matrix_options || this.getMatrixOptionsSelection();
            var selection_key = JSON.stringify(matrix_options);
            this.matrixSelectionCache = this.matrixSelectionCache || {};
            // Caches the entry for the item
            if (!this.matrixSelectionCache[selection_key]) {
                //IF there are option selected THEN get all child items that complies for the current selection ELSE get ALL child items
                this.matrixSelectionCache[selection_key] = _.values(matrix_options).length ? item_matrix_children.where(matrix_options) : item_matrix_children.models;
            }
            return this.matrixSelectionCache[selection_key];
        }    //@method getItemId Gets the id of the current selected item
             //@return {Sting}
,
        getItemId: function getItemId() {
            return this.getItem().get('_id');
        }    //@method getItem Gets the current selected item
             //@return {Item.Model}
,
        getItem: function getItem() {
            var item = this.get('item'), children = this.getSelectedMatrixChilds();
            if (children && children.length === 1) {
                item = children[0];
            }
            return item;
        }    //@method getStockInfo
             //@return {Item.StockInfo}
,
        getStockInfo: function getStockInfo() {
            return this.get('item').getStockInfo(this.getSelectedMatrixChilds(), this.getMatrixOptionsSelection());
        }    //@method getPrice Returns the object specifying the price of the current selection
             //@return {ItemPrice}
,
        getPrice: function getPrice() {
            return this.get('item').getPrice(this.get('quantity'), this.getSelectedMatrixChilds());
        }
    }, {
        //@method createFromTransactionLine Creates a new product from a transaction line
        //@param {Transaction.Line.Model} transaction_line
        //@return {Product.Model}
        //@static
        createFromTransactionLine: function createFromTransactionLine(transaction_line) {
            var attributes = transaction_line.toJSON();
            delete attributes.internalid;
            _.each(attributes.options, function (option) {
                option.values = transaction_line.get('options').findWhere({ cartOptionId: option.cartOptionId }).get('values');
            });
            return new ProductModel(attributes);
        }
    });
    ProductModel.prototype = _.extend(ProductModel.prototype, ProductLineCommon);
    return ProductModel;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
// ProductList.Item.Model
define('ProductList.Item.Model', [
    'Product.Model',
    'Item.Model',
    'underscore',
    'Backbone',
    'Utils'
], function (ProductModel, Item, _, Backbone) {
    'use strict';
    function validateLength(value, name) {
        var max_length = 300;
        if (value && value.length > max_length) {
            return _('$(0) must be at most $(1) characters').translate(name, max_length);
        }
    }
    // @class ProductList.Item.Model @extends Product.Model
    var ProductListItemModel = ProductModel.extend({
        urlRoot: _.getAbsoluteUrl('services/ProductList.Item.Service.ss'),
        defaults: {
            priority: {
                id: '2',
                name: 'medium'
            },
            options: ''
        }    // Name is required
,
        validation: _.extend({}, ProductModel.prototype.validation, {
            name: {
                required: true,
                msg: _('Name is required').translate()
            },
            description: { fn: validateLength }
        }),
        className: 'ProductList.Item.Model'    // redefine url to avoid possible cache problems from browser
,
        url: function () {
            var base_url = Backbone.Model.prototype.url.apply(this, arguments), product_list = this.get('productList'), url_params = { t: new Date().getTime() };
            if (product_list && product_list.owner) {
                url_params.user = product_list.owner;
            }
            return _.addParamsToUrl(base_url, url_params);
        }    // @method initialize Overrides default method because in vinson optional item options with undefined value
             // were not accepted and now they are.
             // @constructor
,
        initialize: function (attributes) {
            // This work around was made to maintain the compatility with product lists saving the child item in the record
            if (attributes && attributes.item && attributes.item.matrix_parent) {
                attributes.item = _.extend(attributes.item, attributes.item.matrix_parent);
                delete attributes.item.matrix_parent;
            }
            var item_aux = new Item(attributes.item), item_options = item_aux.get('options');
            item_options.each(function (item_option, i) {
                var option = _.findWhere(attributes.options, { 'cartOptionId': item_option.get('cartOptionId') });
                if (!option) {
                    attributes.options.push(item_option.toJSON());
                } else if (_.isObject(option.value) && _.isEmpty(option.value)) {
                    attributes.options[i] = item_option.toJSON();
                }
            });
            ProductModel.prototype.initialize.apply(this, arguments);
        }    // @method getOptionsArray Returns options as an array. This is the way ItemDetailModel expects when initialized. @return {Array<Object>}
,
        getOptionsArray: function () {
            // Iterate on the stored Product List Item options and create an id/value object compatible with the existing options renderer...
            var option_values = [], selected_options = this.get('options');
            _.each(selected_options, function (value, key) {
                option_values.push({
                    id: key,
                    value: value.value,
                    displayvalue: value.displayvalue
                });
            });
            return option_values;
        }    // @method fulfillsMinimumQuantityRequirement Returns true if a product can be purchased due to minimum quantity requirements. @returns {Boolean}
,
        fulfillsMinimumQuantityRequirement: function () {
            return this.get('item').get('_minimumQuantity') <= this.get('quantity');
        },
        fulfillsMaximumQuantityRequirement: function () {
            return this.get('item').get('_maximumQuantity') ? this.get('item').get('_maximumQuantity') >= this.get('quantity') : true;
        }    // @method getItemForCart Gets the ProductModel for the cart options_details should be passed together with options values,
             // otherwise they will not be validated and not set!!!
             // @return {internalid:String,quantity:Number,options:Object,options:Object}
,
        getItemForCart: function (id, qty, options_details, options) {
            return new ProductModel({
                internalid: id,
                quantity: qty,
                _optionsDetails: options_details,
                options: options
            });
        }    // @method getMatrixItem Gets the subitem which properties has the values passed as parameters
             // @return matrix subitem model
,
        getMatrixItem: function (optionsSelected, optionsAvailable) {
            var objSearch = {};
            _.each(_.keys(optionsSelected), function (option) {
                var optionName = _.findWhere(optionsAvailable, { 'cartOptionId': option }).itemOptionId;
                objSearch[optionName] = optionsSelected[option].label;
            });
            return _.findWhere(this.item.matrixchilditems_detail, objSearch);
        }    // @method isMatrixChild
             // @return true if this item is matrix
,
        isMatrixChild: function () {
            return this.item && this.item.matrix_parent && this.item.itemoptions_detail ? true : false;
        },
        clone: function clone() {
            return new ProductListItemModel(this.toJSON());
        },
        toJSON: function toJSON() {
            var result = ProductModel.prototype.toJSON.apply(this, arguments), self = this;
            result.description = this.get('description');
            result.productList = this.get('productList');
            result.priority = this.get('priority');
            result.created = this.get('created');
            result.createddate = this.get('createddate');
            result.lastmodified = this.get('lastmodified');
            result.item.internalid = this.getItem().get('internalid');
            _.each(result.options, function (option) {
                var opt = self.get('options').findWhere({ cartOptionId: option.cartOptionId });
                option.values = opt && opt.get('values');
            });
            return result;
        },
        getItemId: function () {
            //We override this method from the Product.Model so when generating the JSON representation of this model
            //we always return the parent item id
            return this.get('item').get('internalid');
        }
    }, {
        //@method createFromProduct
        //@param {Product.Model} product
        //@return {ProductList.Item.Model}
        createFromProduct: function (product) {
            var attributes = product.toJSON();
            delete attributes.internalid;
            _.each(attributes.options, function (option) {
                option.values = product.get('options').findWhere({ cartOptionId: option.cartOptionId }).get('values');
            });
            attributes.item = product.get('item').toJSON();
            return new ProductListItemModel(attributes);
        }    //@method createFromProduct
             //@param {Product.Model} product
             //@return {ProductList.Item.Model}
,
        createFromTransactionLine: function (transaction_line) {
            var attributes = transaction_line.toJSON();
            delete attributes.internalid;
            _.each(attributes.options, function (option) {
                option.values = transaction_line.get('options').findWhere({ cartOptionId: option.cartOptionId }).get('values');
            });
            return new ProductListItemModel(attributes);
        }
    });
    return ProductListItemModel;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Product
define('Product.Collection', [
    'Product.Model',
    'Backbone'
], function (ProductModel, Backbone) {
    'use strict';
    // @class Product.Collection @extends Backbone.Collection
    return Backbone.Collection.extend({
        // @property {Product.Model} model
        model: ProductModel
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
// ProductList.Item.Collection.js
// -----------------------
// Product List collection
define('ProductList.Item.Collection', [
    'ProductList.Item.Model',
    'Product.Collection',
    'underscore',
    'Utils'
], function (ProductListItemModel, ProductCollection, _) {
    'use strict';
    // @class ProductList.Item.Collection @extends Product.Collection
    return ProductCollection.extend({
        model: ProductListItemModel,
        url: _.getAbsoluteUrl('services/ProductList.Item.Service.ss'),
        initialize: function (options) {
            ProductCollection.prototype.initialize.apply(this, arguments);
            this.options = options;
        }    // @method update custom method called by ListHeader view it receives the currently applied filter, currently applied sort and currently applied order
,
        update: function (options) {
            this.fetch({
                data: {
                    productlistid: this.productListId,
                    internalid: null,
                    sort: options.sort.value,
                    order: options.order,
                    page: options.page
                },
                reset: true,
                killerId: options.killerId
            });
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.Model', [
    'ProductList.Item.Collection',
    'underscore',
    'Backbone',
    'Utils'
], function (ProductListItemCollection, _, Backbone) {
    'use strict';
    function validateLength(value, name) {
        var max_length = 300;
        if (value && value.length > max_length) {
            return _('$(0) must be at most $(1) characters').translate(name, max_length);
        }
    }
    function validateName(value, name) {
        if (!value) {
            return _('Name is required').translate();
        }
        return validateLength(value, name);
    }
    // @class ProductList.Model Model for handling Product Lists (CRUD) @extends Backbone.Model
    return Backbone.Model.extend({
        urlRoot: _.getAbsoluteUrl('services/ProductList.Service.ss'),
        defaults: {
            name: '',
            description: '',
            items: new ProductListItemCollection(),
            scopeId: '2',
            scopeName: 'private',
            typeId: '1',
            typeName: 'default'
        },
        validation: {
            name: { fn: validateName },
            description: { fn: validateLength }
        }    // redefine url to avoid possible cache problems from browser
,
        url: function () {
            var base_url = Backbone.Model.prototype.url.apply(this, arguments), url_params = { t: new Date().getTime() };
            return _.addParamsToUrl(base_url, url_params);
        },
        initialize: function (attributes) {
            this.on('change:items', function (model, items) {
                if (model.previous('items') instanceof ProductListItemCollection) {
                    model.set('items', model.previous('items'), { silent: true });
                    model.get('items').reset(items);
                } else {
                    model.set('items', new ProductListItemCollection(items), { silent: true });
                }
            });
            this.trigger('change:items', this, attributes && attributes.items || []);
        }    // @method checked Returns true if an item with id: pli_to_add_id and options: pli_to_add_options is already in this product list. Options could be empty. @param {String} item_to_add_id @param {Object}item_to_add_options
,
        checked: function (line) {
            return !!this.get('items').find(function (product_list_line) {
                return product_list_line.isEqual(line);
            });
        }    // @method getOutOfStockItems Returns all the items which are out of stock.
             // @param {ProductList.Item.Collection} items_to_check
             // @returns {ProductList.Item.Collection}
,
        getOutOfStockItems: function (items_to_check) {
            var items = !_.isUndefined(items_to_check) ? items_to_check : this.get('items');
            return items.filter(function (product_list_item) {
                return !product_list_item.get('item').get('_isPurchasable');
            });
        }    // @method getNotPurchasableItemsDueToMinimumQuantity @param {ProductList.Item.Collection} items_to_check @returns {ProductList.Item.Collection} Returns all the items which do not fulfill minimum quantity requirements.
,
        getNotPurchasableItemsDueToMinimumQuantity: function (items_to_check) {
            var items = !_.isUndefined(items_to_check) ? items_to_check : this.get('items');
            return items.filter(function (product_list_item) {
                return !product_list_item.fulfillsMinimumQuantityRequirement();
            });
        }    // @method someCheckedItemsExist Returns true if at least one item is checked. @return{Boolean}
,
        someCheckedItemsExist: function () {
            return this.get('items').some(function (product_list_item) {
                return product_list_item.get('checked');
            });
        }    // @method canBeAddedToCart Returns true if the the items in the product list can be added to the cart by the following conditions:
             // 1.- Items > 0
             // 2.- No out of stock items
             // 3.- No items which do not fulfill minimum quantity items
             // only_checked_items determines if we are considering only checked items.
             // @param {Boolean} only_checked_items @return {Boolean}
,
        canBeAddedToCart: function (only_checked_items) {
            var items = !_.isUndefined(only_checked_items) ? new Backbone.Collection(this.get('items').filter(function (product_list_item) {
                return product_list_item.get('checked');
            })) : this.get('items');
            return items.length && this.getOutOfStockItems(items).length === 0 && this.getNotPurchasableItemsDueToMinimumQuantity(items).length === 0;
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.Collection', [
    'ProductList.Model',
    'underscore',
    'Backbone',
    'Utils'
], function (ProductListModel, _, Backbone) {
    'use strict';
    // @class ProductList.Collection @extends Backbone.Collection
    return Backbone.Collection.extend({
        url: _.getAbsoluteUrl('services/ProductList.Service.ss'),
        model: ProductListModel    // Filter based on the iterator and return a collection of the same type
,
        filtered: function (iterator) {
            return new this.constructor(this.filter(iterator));
        }
    });
});


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.ControlItem.View', [
    'product_list_control_item.tpl',
    'jQuery',
    'Backbone'
], function (product_list_control_item_tpl, jQuery, Backbone) {
    'use strict';
    // @class ProductList.ControlItem.View @extends Backbone.View
    return Backbone.View.extend({
        tagName: 'li',
        template: product_list_control_item_tpl,
        events: { 'click [data-action="product-list-item"]': 'pListItemHandler' },
        initialize: function (options) {
            this.model = options.model;
            //	ProductList.Model
            this.line = options.product;
            //	Product.Model
            this.application = options.application;
            this.parentView = options.parentView;
        }    // @method checked Determines if an item is checked if the item belongs the list
             // Whilst on move mode, returns always false @return {Boolean}
,
        checked: function () {
            return this.parentView.mode !== 'move' ? this.model.checked(this.line) : false;
        }    // @method pListItemHandler dispatch mouse event - if move mode enabled, move the item, if not, an item is added/removed from a list
,
        pListItemHandler: function (e) {
            var self = this, checkbox = jQuery(e.target);
            if (self.parentView.mode === 'move') {
                self.moveProduct();
            } else {
                self.addRemoveProduct(checkbox);
            }
        }    // @method moveProduct Moves an item to another list
,
        moveProduct: function () {
            this.parentView.moveProductHandler(this.model);
        }    // @method addRemoveProduct Adds/removes an item from a list @param {jQuery} checkbox
,
        addRemoveProduct: function ($checkbox) {
            if ($checkbox.is(':checked')) {
                // add to list
                this.parentView.addItemToList(this.line, this.model);
            } else {
                // remove from list
                this.removeItemFromList(this.line);
            }
        }    // @method removeItemFromList Remove a line list item from the product list
             // @param {Item.Model} product
,
        removeItemFromList: function (line) {
            var self = this, selected_line = self.model.get('items').find(function (product_list_line) {
                    return product_list_line.isEqual(line);
                });
            if (selected_line) {
                selected_line.set('productList', {
                    id: self.model.get('internalid'),
                    owner: self.model.get('owner').id
                });
                self.model.get('items').remove(selected_line);
                selected_line.destroy().done(function () {
                    self.model.collection.trigger('changed');
                    self.parentView.render();
                    self.parentView.hideConfirmationMessage();
                });
            } else {
                self.parentView.render();
            }
        }    // @method getContext @return {ProductList.ControlItem.View.Context}
,
        getContext: function () {
            return {
                // @class ProductList.ControlItem.View.Context
                // @property {Boolean} isMoving
                isMoving: this.parentView.mode === 'move'    // @property {Boolean} isChecked
,
                isChecked: this.checked()    // @property {Boolean} isTypePredefined
,
                isTypePredefined: this.model.get('typeName') === 'predefined'    // @property {String} itemName
,
                itemName: this.model.get('name')    // @property {String} listId
,
                listId: this.model.get('internalid')
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.ControlNewItem.View', [
    'ProductList.Item.Collection',
    'product_list_control_new_item.tpl',
    'jQuery',
    'Backbone',
    'Backbone.FormView'
], function (ProductListItemCollection, product_list_control_new_item_tpl, jQuery, Backbone, BackboneFormView) {
    'use strict';
    // @class ProductList.ControlNewItem.View @extends Backbone.View
    return Backbone.View.extend({
        tagName: 'div',
        template: product_list_control_new_item_tpl,
        events: {
            'submit [data-action="create-and-move"]': 'createMoveList',
            'click [data-action="show-add-new-list-form"]': 'showNewListForm'
        },
        bindings: { '[name="name"]': 'name' },
        initialize: function (options) {
            this.application = options.application;
            this.model = options.model;
            this.parentView = options.parentView;
            BackboneFormView.add(this);
        }    // Handle save new product list form postback
,
        createMoveList: function (event) {
            if (!this.parentView.validateGiftCertificate(this.parentView.product)) {
                return;
            }
            var self = this, save_promise = this.saveForm(event);
            if (!save_promise) {
                return;
            }
            save_promise.done(function () {
                var new_product_list = self.model, parent_view = self.parentView;
                new_product_list.set('items', new ProductListItemCollection(new_product_list.get('items').toJSON()));
                // add the product list item
                if (parent_view.mode === 'move') {
                    // create new list
                    parent_view.moveProductHandler(new_product_list);
                    parent_view.collection.add(self.model, { merge: true });
                } else {
                    parent_view.collection.add(new_product_list);
                    parent_view.addNewProductToList(new_product_list);
                }
            });
        }    // @method showNewListForm Shows the create new list form
,
        showNewListForm: function (e) {
            e && e.stopPropagation();
            var $el = jQuery(this.el);
            var new_list_form = $el.find('form[data-type="product-list-control-add-new-list-form"]');
            if (new_list_form) {
                new_list_form.show();
                this.$('[data-type="new-product-list-name"]').focus();
                $el.find(e.target).hide();
            }
        }    // @method getContext @return {ProductList.ControlNewItem.View.Context}
,
        getContext: function () {
            return {
                // @class ProductList.ControlNewItem.View.Context
                // @property {Boolean} isMoving
                isMoving: this.parentView.mode === 'move'
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module MenuTree
define('MenuTree.Node.View', [
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'menu_tree_node.tpl',
    'Backbone'
], function (BackboneCompositeView, BackboneCollectionView, menu_tree_node_tpl, Backbone) {
    'use strict';
    //@class MenuTree.Node.View @extends Backbone.View
    var MenuTreeNodeView = Backbone.View.extend({
        //@propery {Function} template
        template: menu_tree_node_tpl    //@method initialize
,
        initialize: function (options) {
            this.node = options.model;
            this.level = options.level;
            BackboneCompositeView.add(this);
        }    //@propery {Object} childViews
,
        childViews: {
            'MenuItems.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.node.get('children'),
                    childView: MenuTreeNodeView,
                    viewsPerRow: 1,
                    childViewOptions: { level: this.level + 1 }
                });
            }
        }    //@method getContext @returns MenuTree.Node.View.Context
,
        getContext: function () {
            // @class MenuTree.Node.View.Context
            return {
                //@propery {Model} node
                node: this.node,
                level: this.level
            };
        }
    });
    return MenuTreeNodeView;
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module MenuTree
define('MenuTree.View', [
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'MenuTree.Node.View',
    'Singleton',
    'menu_tree.tpl',
    'Backbone',
    'underscore',
    'jQuery'
], function (BackboneCompositeView, BackboneCollectionView, MenuTreeNodeView, Singleton, menu_tree_tpl, Backbone, _, jQuery) {
    'use strict';
    // @class MenuTree.View Implements the tree menu items that is present in MyAccount. It's a Singleton. @extends Backbone.View
    return Backbone.View.extend({
        // @property {Function} template
        template: menu_tree_tpl    /*@property {Array<MenuItem>} menuItems

		My Account has support for a gloabally accesible Menu. See *MenuItem methods.
		Modules are able to publish their own menu entries without the need to update a central list
		The format of a menu item is the following. Note that all property values support a function
		that accepts this application and returns the native value (useful for dynamic values):
		
			id: 'mymodule1'
			
			name: _('My Module 1').translate() // the label for this module.
			
			url: 'mymodule1' // if not null the item will be represented with an anchor that will navigate
					to this url. If falsy there will be no navigation for this item (useful for multi-level menues).
			
			index: 9 // index number in the menu from top to bottom, lower values are on top.
			
			children: // [{name: 'Child1', url: '/child1'}, ...] an array of children menu items. Notice that,
					for children declarations, all these properties are taken in account recursively, including
					'index' and more (sub)'childrens'. By default, this is presented in a tree-view.

		while this.menuItems are the original user values (that can contain functions yet to evaluate)
		this.fixedMenuItems = this.getFixedMenuItems() is a clone of the entire tree but with the fixed
		values and sorted, this is, with functions already evaluated so safe to use in the UI.

		Notice that this calculation is made in render() so dynamic re-calcalculations are supported. See this.updateMenuItemsUI()

		@class MenuItem menu item definitions for myaccount nav bar. Al properties can be a function that accepts the current application instance for supporting dynamic values.
		@property {String|Function} id the id for this menu item
		@property {String|Function} name the id for this menu item the label for this module.
		@property {String|Function} url if not null the item will be represented with an anchor that will navigate to this url. ç
		If falsy there will be no navigation for this item (useful for multi-level menus).
		@property {Number|Function} index the id for this menu item
		@property {Array<MenuItem>} children an array of children menu items. Notice that, for children declarations, all these properties are taken in account recursively, including
		'index' and more (sub)'childrens'. By default, this is presented in a tree-view.
		*/,
        menuItems: [],
        events: { 'click [data-action="expander"]': 'menuClick' }    // @method initialize
,
        initialize: function () {
            BackboneCompositeView.add(this);
        },
        render: function () {
            this.fixedMenuItems = this.getFixedMenuItems();
            Backbone.View.prototype.render.apply(this, arguments);
        }    // @method menuClick Note: cant use bootstrap collapse due to the divs introduced by collection view. @param {HTMLEvent} e
,
        menuClick: function (e, synthetic) {
            var target = jQuery(e.currentTarget), this_expander = target.next('[data-type="menu-tree-node-expander"]'), this_expander_is_opened = this_expander.hasClass('in'), this_expandable = target.closest('[data-type="menu-tree-node-expandable"]'), all_expandables = this.$('[data-type="menu-tree-node-expandable"]');
            all_expandables.removeClass('open');
            this_expandable.addClass('open');
            //if inside a closed expander: close others open this one
            var expanding_expander = this.$(target.data('target'));
            if (!this_expander_is_opened) {
                var open_expanders = this.$('[data-type="menu-tree-node-expander"].in');
                jQuery.fn.collapse.call(open_expanders, 'hide');
                jQuery.fn.collapse.call(expanding_expander, 'show');
            }
            if (synthetic === undefined && this_expander_is_opened) {
                jQuery.fn.collapse.call(expanding_expander, 'hide');
                this_expandable.removeClass('open');
            }
        }    // @method updateSidebar @param {String} label
,
        updateSidebar: function (label) {
            this.currentLabel = label || this.currentLabel;
            var target = this.$('[data-id="' + this.currentLabel + '"]'), target_expandable = target.closest('[data-type="menu-tree-node-expandable"]'), anchors = this.$('[data-id]');
            //remove active for all anchors and add for this one
            anchors.removeClass('active');
            target.addClass('active');
            //triggers click for the correct expander
            target_expandable.find('[data-action="expander"]:first').trigger('click', { synthetic: true });
            //edge case for home, should close other expanders
            if (label === 'home') {
                var all_expandables = this.$('[data-type="menu-tree-node-expandable"]'), open_expanders = this.$('[data-type="menu-tree-node-expander"].in');
                all_expandables.removeClass('open');
                jQuery.fn.collapse.call(open_expanders, 'hide');
            }
        }    // @method getFixedMenuItems @return {Array<Object>}
,
        getFixedMenuItems: function () {
            var self = this, fixed = null, parent = null, parsed_menu_items = [], menu_items_with_parent = [];
            _.each(this.menuItems, function (item) {
                // we are ignoring no-value menu item definitions
                fixed = item && self.fixMenuItems(item);
                if (fixed) {
                    parsed_menu_items.push(fixed);
                    if (fixed.parent) {
                        menu_items_with_parent.push(fixed);
                    }
                }
            });
            // Add outsider children to parent menu items.
            _.each(menu_items_with_parent, function (menu_item) {
                parent = _.findWhere(parsed_menu_items, { id: menu_item.parent });
                if (parent) {
                    if (!_.findWhere(parent.children, { id: menu_item.id })) {
                        parent.children.push(menu_item);
                        parent.children = self.sortMenuItems(parent.children);
                    }
                    parsed_menu_items = _.without(parsed_menu_items, menu_item);
                }
            });
            return this.sortMenuItems(parsed_menu_items);
        }    // @method sortMenuItems sorts menu items by index and then by name @return {Array<MenuItem>}
,
        sortMenuItems: function (menu_items) {
            return menu_items.sort(function (item1, item2) {
                if (item1.index !== item2.index) {
                    return item1.index - item2.index;
                } else {
                    return item1.name > item2.name ? 1 : -1;
                }
            });
        }    // @method addMenuItem Appends an menu item to the collection @param {Array<MenuItem>} items
,
        addMenuItem: function (items) {
            var self = this;
            items = _.isArray(items) ? items : [items];
            _.each(items, function (item) {
                self.menuItems.push(item);
            });
        }    // method fixMenuItems recursive! @param {MenuItem} item_
,
        fixMenuItems: function (item_) {
            var self = this, item = self.fixMenuItem(item_);
            if (item && _.isArray(item.children)) {
                item.children = _.map(item.children, function (children_item) {
                    return self.fixMenuItems(children_item);
                });
            }
            return item;
        }    // @method menuItemValue every menu item config property is evaluated using this function. @param {Function|String} value
,
        menuItemValue: function (value) {
            return _.isFunction(value) ? value.apply(this, [this.application]) : value;
        }    // @method fixMenuItem normalizes the passed menuitem object setting its properties to its native types. @param {MenuItem} item_
,
        fixMenuItem: function (item_) {
            var item = null;
            item_ = this.menuItemValue(item_);
            if (!item_) {
                return undefined;
            }
            item = _.clone(item_);
            item.parent = this.menuItemValue(item.parent);
            item.name = this.menuItemValue(item.name);
            item.index = this.menuItemValue(item.index);
            item.url = this.menuItemValue(item.url) ? '/' + this.menuItemValue(item.url) : '';
            item.id = this.menuItemValue(item.id);
            item.children = this.menuItemValue(item.children) || [];
            item.showChildren = !!item.children.length;
            if (item.showChildren) {
                item.children = this.sortMenuItems(item.children);
            }
            return item;
        }    // @method removeMenuItem Removes the item from the menu @param {String} id
,
        removeMenuItem: function (id) {
            this.menuItems = _.reject(this.menuItems, function (item) {
                return item.id === id;
            });
        }    // @method updateMenuItemsUI re-render the menu items menu - useful for dynamic menu items that need to re-render when something changes. Each module is responsible of calling this method when appropiate.
,
        updateMenuItemsUI: function () {
            this.render();
            this.updateSidebar();
        }    // @method replaceMenuItem Given a filter, replaces an existing menu item with a new one @param {Function} filter @param {MenuItem} new_menu_item
,
        replaceMenuItem: function (filter, new_menu_item) {
            for (var i = 0; i < this.menuItems.length; i++) {
                if (filter(this.fixMenuItem(this.menuItems[i]))) {
                    this.menuItems[i] = new_menu_item;
                }
            }
        }    // @method getContext @returns MenuTree.View.Context
,
        getContext: function () {
            // @class MenuTree.View.Context
            return {
                // @propery {Array} menuItems
                menuItems: this.fixedMenuItems
            };    // @class MenuTree.View
        },
        childViews: {
            'MenuItems.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.fixedMenuItems,
                    childView: MenuTreeNodeView,
                    viewsPerRow: 1,
                    childViewOptions: { level: 1 }
                });
            }
        }
    }, Singleton);
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.Control.View', [
    'product_list_control.tpl',
    'ProductList.ControlItem.View',
    'ProductList.ControlNewItem.View',
    'Profile.Model',
    'ProductList.Model',
    'ProductList.Item.Model',
    'Session',
    'ProductList.Item.Collection',
    'MenuTree.View',
    'underscore',
    'jQuery',
    'Backbone'
], function (product_list_control_tpl, ControlItemView, ControlNewItemView, ProfileModel, ProductListModel, ProductListItemModel, Session, ProductListItemCollection, MenuTreeView, _, jQuery, Backbone) {
    'use strict';
    // @class ProductList.Control.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_list_control_tpl,
        attributes: { 'class': 'dropdown product-lists' },
        events: {
            'click [data-action="show-productlist-control"]': 'validateLogin',
            'click [data-toggle="showFlyout"]': 'showFlyout',
            'click': 'contentClick',
            'mouseup': 'contentMouseUp'
        },
        initialize: function (options) {
            this.product = options.product;
            this.collection = options.collection;
            this.application = options.application;
            this.moveOptions = options.moveOptions;
            this.countedClicks = options.countedClicks;
            if (this.moveOptions) {
                this.mode = 'move';
            }
            // need to hide the menu (data-type="productlist-control") when clicked outside, so we register here a click handler on the document.:
            jQuery(document).click(function (event) {
                var outside = jQuery(event.target).parents().index(jQuery(event.target).closest('[data-type^="productlist-control"]')) === -1;
                outside = outside && jQuery(event.target).data('action') !== 'show-productlist-control';
                if (outside) {
                    if (jQuery('[data-type="productlist-control"]').is(':visible')) {
                        var $control = jQuery('[data-type="productlist-control"]');
                        // return the control to its initial state
                        $control.find('form').hide();
                        $control.find('[data-action="show-add-new-list-form"]').show();
                        $control.slideUp();
                    }
                }
            });
            this.product.on('change', this.render, this);
        }    // Render the control view, appending the items views and add new list form
,
        render: function () {
            // if the control is currently visible then we remember that !
            this.is_visible = this.$('[data-type="productlist-control"]').is(':visible');
            Backbone.View.prototype.render.apply(this);
            var self = this;
            self.collection.each(function (model) {
                var view = new ControlItemView({
                    model: model,
                    product: self.product,
                    application: self.application,
                    parentView: self
                });
                self.$('ul').prepend(view.render().el);
            });
            var new_product_list_model = this.getNewProductListModel(), new_item_view = new ControlNewItemView({
                    model: new_product_list_model,
                    application: self.application,
                    parentView: self
                });
            self.$('[data-type="new-item-container"]').html(new_item_view.render().el);
            // also we don't want to erase any previous confirmation messages
            self.confirm_message && self.saveAndShowConfirmationMessage(self.confirm_message);
        }    // This method is overridden in POS.
,
        getNewProductListModel: function () {
            return new ProductListModel();
        }    // if the user is not logged in we redirect it to login page and then back to the PDP.
,
        validateLogin: function (e) {
            if (ProfileModel.getInstance().get('isLoggedIn') === 'T') {
                return true;
            }
            e.stopPropagation();
            e.stopImmediatePropagation();
            e.preventDefault();
            var login = Session.get('touchpoints.login');
            login += '&origin=' + this.application.getConfig('currentTouchpoint');
            if (this.$el.closest('.modal-product-detail').size() > 0)
                //we are in the quick view
                {
                    var hashtag = this.product.generateURL();
                    login += '&origin_hash=' + encodeURIComponent(hashtag.replace('#/', ''));
                }
            else {
                login += '&origin_hash=' + encodeURIComponent(Backbone.history.fragment);
            }
            window.location.href = login;
        }    // validates the passed gift cert item and return false and render an error message if invalid.
,
        validateGiftCertificate: function validateGiftCertificate(line) {
            var line_option_email = line.get('options') && line.get('options').findWhere({ cartOptionId: 'GIFTCERTRECIPIENTEMAIL' });
            if (line_option_email && !line_option_email.isValid(true)) {
                this.render();
                //for unchecking the just checked checkbox
                this.showError(this.application.getErrorMessage('recipientEmailIsInvalid'));
                return false;
            }
            return true;
        },
        getItemOptions: function (line) {
            var selected_options = line.get('options').filter(function (option) {
                return !!option.get('value');
            });
            return _.reduce(selected_options, function (acc, option) {
                var value = option.get('value') || {};
                acc[option.get('cartOptionId')] = {
                    value: value.internalid,
                    displayvalue: value.label
                };
                return acc;
            }, {});
        }    // Adds the product to the newly created list, renders the control and shows a confirmation msg
,
        addNewProductToList: function (newList) {
            this.addItemToList(this.product, newList, true);
            this.saveAndShowConfirmationMessage(this.$('.ul-product-lists [type="checkbox"]:checked').length > 1 ? _('Good! You added this item to your product lists').translate() : _('Good! You added this item to your product list').translate());
        }    // Add a new product list item into a product list
,
        addItemToList: function (line, productList, dontShowMessage) {
            if (line.isValid(true)) {
                var self = this;
                if (!productList.get('internalid'))
                    //this is a predefined list
                    {
                        productList.save().done(function (data) {
                            var new_model = new ProductListModel(data);
                            self.application.ProductListModule.Utils.getProductLists().add(new_model, { merge: true });
                            self.doAddItemToList(line, new_model, dontShowMessage);
                        });
                    }
                else {
                    self.doAddItemToList(line, productList, dontShowMessage);
                }
            }
        }    // This method is overridden in POS
,
        getNewItemData: function (line, productList) {
            var product_list_line = ProductListItemModel.createFromProduct(line);
            product_list_line.set('productList', {
                id: productList.get('internalid'),
                owner: productList.get('owner').id
            });
            return product_list_line;
        }    // Adds the new item to the collection
,
        doAddItemToList: function (product, productList, dontShowMessage) {
            var self = this, product_list_line_to_save = this.getNewItemData(product, productList);
            product_list_line_to_save.save(null, {
                //Note this is lack of validation is require to not validate the JSON returned from the services as it will lack the Model/Collection structure required
                //to run the validation. for example the list of options will be an array and not a collection as the event handle that parse them didn't run yet
                validate: false,
                success: function (product_list_line_to_save_saved) {
                    productList.get('items').add(product_list_line_to_save_saved);
                    self.collection.trigger('changed');
                    self.render();
                    if (!dontShowMessage) {
                        self.saveAndShowConfirmationMessage(self.$('.ul-product-lists [type="checkbox"]:checked').length > 1 ? _('Good! You added this item to your product lists').translate() : _('Good! You added this item to your product list').translate());
                    }
                }
            });
        }    // Check for predefined list before moving
,
        moveProductHandler: function (destination) {
            var self = this;
            if (!destination.get('internalid'))
                //this is a predefined list
                {
                    destination.save().done(function (data) {
                        var new_product_list = new ProductListModel(data);
                        self.application.ProductListModule.Utils.getProductLists().add(new_product_list, { merge: true });
                        self.moveProduct(new_product_list);
                    });
                }
            else {
                self.application.ProductListModule.Utils.getProductLists().add(destination, { merge: true });
                self.moveProduct(destination);
            }
        }    // Moves the item to the destination list
,
        moveProduct: function (destination) {
            var self = this, original_item = this.moveOptions.productListItem, original_item_clone = original_item.clone(), details_view = this.moveOptions.parentView;
            original_item_clone.set('productList', { id: destination.get('internalid') });
            destination.get('items').create(original_item_clone, {
                validate: false,
                success: function (saved_model) {
                    var app = details_view.application, from_list = self.application.ProductListModule.Utils.getProductLists().findWhere({ internalid: self.moveOptions.parentView.model.get('internalid') }), to_list = self.application.ProductListModule.Utils.getProductLists().findWhere({ internalid: destination.get('internalid') });
                    self.doMoveProduct(from_list, to_list, original_item, saved_model);
                    details_view.model.get('items').remove(original_item);
                    details_view.render();
                    jQuery('.sc-flyout-bg').remove();
                    MenuTreeView.getInstance().updateMenuItemsUI();
                    app.getLayout().currentView.showConfirmationMessage(_('<div class="product-list-control-message">Good! You successfully moved the item from this to <a href="/wishlist/$(0)">$(1)</a></div>').translate(destination.get('internalid'), destination.get('name')));
                }
            });
        }    // Adds the item clone to the destination list and removes the original from its list
,
        doMoveProduct: function (from, to, original_model, saved_model) {
            // if add not defined, create the collection
            if (to.get('items') instanceof Array) {
                to.set('items', new ProductListItemCollection());
            }
            // add the item to the application collection
            to.get('items').add(saved_model);
            from.get('items').remove(original_model);
            this.collection.trigger('changed');
        }    // Gets the internal product id for a store item considering it could be a matrix child.
,
        getProductId: function (line) {
            if (line.getItemId) {
                return line.getItemId();
            } else if (this.application.ProductListModule) {
                return this.application.ProductListModule.Utils.internalGetProductId(line);
            } else {
                return line.get('_id') + '';
            }
        }    // Determines if the control is visible
,
        isAvailable: function () {
            //if you want to disable the product list experience you instead can return: ProfileModel.getInstance().get('isLoggedIn') === 'T';
            return true;
        }    // Renders a confirmation message storing message parameter and also stores the message
,
        saveAndShowConfirmationMessage: function (message) {
            this.confirm_message = message;
            this.showConfirmationMessage(this.confirm_message, true);
        }    // Hides the confirmation message
,
        hideConfirmationMessage: function () {
            this.confirm_message = null;
            this.$('[data-confirm-message]').hide();
        }    // @method showFlyout Handle showing/hiding (toggle) data-toggle="showFlyout" elements
             // @param {jQuery.Event} e
             //@return {Void}
,
        showFlyout: function (e) {
            e.stopPropagation();
            //Here no extra validation is specified as those are not required to add an item into a product list
            if (this.product.areAttributesValid([
                    'options',
                    'quantity'
                ], {})) {
                // Hide any other open flyout instances...
                jQuery('.product-list-control-flyout').hide();
                this.countedClicks[e.pageX + '|' + e.pageY] = false;
                var self = jQuery(e.target);
                if (_.isPhoneDevice()) {
                    self.next().toggle();
                    var body = jQuery('body');
                    var scrollvalue = self.offset();
                    body.animate({ scrollTop: scrollvalue.top }, '500', function () {
                        jQuery('#main').append('<div class="sc-flyout-bg"></div>');
                        jQuery('.sc-flyout-bg').on('click', function () {
                            jQuery('.sc-flyout-bg').remove();
                        });
                    });
                } else {
                    self.next().toggle();
                }
            }
        }    // @method contentClick
             // Keeps track of the clicks you have made onto the view, so the contentMouseUp
             // knows if it needs to trigger the click event once again
             // @param {jQuery.Event} e
             //@return {Void}
,
        contentClick: function (e) {
            this.countedClicks[e.pageX + '|' + e.pageY] = true;
        }    // @method contentMouseUp
             // this is used just to register a delayed function to check if the click went through
             // if it didn't we fire the click once again on the top most element
             // @param {jQuery.Event} e
             // @return {Void}
,
        contentMouseUp: function (e) {
            if (e.which !== 2 && e.which !== 3) {
                var self = this;
                _.delay(function () {
                    if (!self.countedClicks[e.pageX + '|' + e.pageY]) {
                        jQuery(document.elementFromPoint(e.clientX, e.clientY)).click();
                    }
                    delete self.countedClicks[e.pageX + '|' + e.pageY];
                }, 100);
            }
        }    // @method getContext @return {ProductList.Control.View.Context}
,
        getContext: function () {
            //@class ProductList.Control.View.Context
            return {
                // @property {Boolean} isMoving
                isMoving: this.mode === 'move'    // @property {Boolean} showControl
,
                showControl: this.is_visible,
                isEmpty: this.collection.length === 0    // @property {Boolean} hasOneProductList
,
                hasOneProductList: this.collection.length === 1    // @property {Boolean} hasProductLists
,
                hasProductLists: this.collection.length > 0    // @property {Integer} productListLength
,
                productListLength: this.collection.length
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.ControlSingle.View', [
    'ProductList.Control.View',
    'ProductList.Item.Collection',
    'product_list_control_single.tpl',
    'underscore',
    'Backbone',
    'Backbone.View',
    'Backbone.View.render'
], function (ControlView, ProductListItemCollection, product_list_control_single_tpl, _, Backbone) {
    'use strict';
    // @class ProductList.ControlSingle.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_list_control_single_tpl,
        attributes: { 'class': 'product-lists-single' },
        events: { 'click [data-type="add-product-to-single-list"]': 'addItemToSingleList' },
        addItemToList: ControlView.prototype.addItemToList,
        doAddItemToList: ControlView.prototype.doAddItemToList,
        saveAndShowConfirmationMessage: ControlView.prototype.saveAndShowConfirmationMessage,
        validateGiftCertificate: ControlView.prototype.validateGiftCertificate,
        getItemOptions: ControlView.prototype.getItemOptions,
        validateLogin: ControlView.prototype.validateLogin,
        getProductId: ControlView.prototype.getProductId,
        getNewItemData: ControlView.prototype.getNewItemData,
        initialize: function (options) {
            this.product = options.product;
            this.collection = options.collection;
            this.application = options.application;
            // single list
            this.single_list = this.collection.at(0);
        },
        render: function () {
            this._render();
        }    // @method isProductAlreadyAdded Determines if the current product with the selected options is already in the product list
             // @return {Boolean} Indicate is the product is already added into the current single list
,
        isProductAlreadyAdded: function () {
            return this.single_list.checked(this.product);
        }    // @method getProductsInternalid Get list internal ids @returns {Array<String>}
,
        getProductsInternalid: function () {
            return _(this.single_list.get('items').models).map(function (item) {
                return item.get('item').internalid;
            });
        }    // @method addItemToSingleList Before adding item to the list, checks for not created predefined list
,
        addItemToSingleList: function (e) {
            e.preventDefault();
            if (!this.validateLogin(e)) {
                return;
            }
            var self = this;
            if (self.product.isValid(true)) {
                // Check if predefined list was not created yet
                if (!self.single_list.get('internalid')) {
                    self.single_list.save().done(function () {
                        self.single_list.set('items', new ProductListItemCollection([]));
                        self.renderAfterAdded(self);
                    });
                } else {
                    self.renderAfterAdded(self);
                }
            }
        }    // @method renderAfterAdded Adds the item to the list
,
        renderAfterAdded: function (self) {
            if (!this.validateGiftCertificate(self.product)) {
                return;
            }
            self.addItemToList(self.product, self.single_list);
            self.render();
            self.saveAndShowConfirmationMessage(_('Good! You added this item to your product list').translate());
            this.$('[data-action="add-product-to-single-list"]').attr('disabled', 'true');
        }    // @method getContext @return {ProductList.ControlSingle.View.Context}
,
        getContext: function getContext() {
            var model = this.single_list;
            // @class ProductList.ControlSingle.View.Context
            return {
                // @property {Boolean} isProductAlreadyAdded
                isProductAlreadyAdded: this.isProductAlreadyAdded()    // @property {String} name
,
                name: model.get('name')    // @property {String} id
,
                id: model.get('internalid')
            };
        }
    });
});


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductViews
define('ProductViews.Price.View', [
    'Profile.Model',
    'Session',
    'SC.Configuration',
    'product_views_price.tpl',
    'Backbone',
    'underscore'
], function (ProfileModel, Session, Configuration, product_views_price_tpl, Backbone, _) {
    'use strict';
    // @class ProductViews.Price.View @extends Backbone.View
    var ProductViewsPriceView = Backbone.View.extend({
        //@property {Function} template
        template: product_views_price_tpl    //@method initialize
                                   //@param {ProductViews.Price.View.Initialize.Options} options
                                   //@return {Void}
,
        initialize: function () {
            this.model.on('change', this.render, this);
        }    //@method getUrlLogin Get the login URL contains an origin hash parameter indicating the current URL to came back after login
             //@return {String}
,
        getUrlLogin: function () {
            var url = Session.get('touchpoints.login') + '&origin=' + (Configuration.get('currentTouchpoint') || 'home') + '&origin_hash=';
            return url + encodeURIComponent(this.options.origin === 'PDPQUICK' ? this.model.generateURL().replace('/', '') : Backbone.history.fragment);
        }    // @method getContext
             // @returns {ProductViews.Price.View.Context}
,
        getContext: function () {
            var price_container_object = this.model.getPrice(), is_price_range = !!(price_container_object.min && price_container_object.max), showComparePrice = false;
            if (!this.options.hideComparePrice) {
                showComparePrice = is_price_range ? price_container_object.max.price < price_container_object.compare_price : price_container_object.price < price_container_object.compare_price;
            }
            //@class ProductViews.Price.View.Context
            return {
                // @property {Boolean} isPriceEnabled
                isPriceEnabled: !ProfileModel.getInstance().hidePrices()    // @property {String} urlLogin
,
                urlLogin: this.getUrlLogin()    // @property {Boolean} isPriceRange
,
                isPriceRange: is_price_range    // @property {Boolean} showComparePrice
,
                showComparePrice: showComparePrice    // @property {Boolean} isInStock
,
                isInStock: this.model.getStockInfo().isInStock,
                model: this.model,
                currencyCode: SC.getSessionInfo('currency') ? SC.getSessionInfo('currency').code : ''    // @property {String} priceFormatted
,
                priceFormatted: price_container_object.price_formatted || ''    // @property {String} comparePriceFormatted
,
                comparePriceFormatted: price_container_object.compare_price_formatted || ''    // @property {String} minPriceFormatted
,
                minPriceFormatted: price_container_object.min ? price_container_object.min.price_formatted : ''    // @property {String} maxPriceFormatted
,
                maxPriceFormatted: price_container_object.max ? price_container_object.max.price_formatted : ''    // @property {Number} price
,
                price: price_container_object.price ? price_container_object.price : 0    // @property {Number} comparePrice
,
                comparePrice: price_container_object.compare_price ? price_container_object.compare_price : 0    // @property {Number} minPrice
,
                minPrice: price_container_object.min ? price_container_object.min.price : 0    // @property {Number} maxPrice
,
                maxPrice: price_container_object.max ? price_container_object.max.price : 0    // @property {Boolean} showHighlightedMessage
,
                showHighlightedMessage: _.indexOf(ProductViewsPriceView.highlightedViews, this.options.origin) >= 0
            };    //@class ProductViews.Price.View
        }
    }, {
        //@property {Array<String>} highlightedViews Contains the list of all origins that in case of using the "LOGIN TO SEE PRICES" feature must render a highlighted notification message
        //@static
        highlightedViews: [
            'PDPQUICK',
            'PDPFULL'
        ]
    });
    return ProductViewsPriceView;
});    //@class ProductViews.Price.View.Initialize.Options
       //@property {String?} origin Possible values are:
       //	PDPCONFIRMATION 		For the PDP confirmation message
       //	ITEMCELL 				For each item being shown in the item list (ex your-domain.com/search)
       //	PDPQUICK 				For a PDP being shown on a quick view form
       //	PDPFULL 				Full PDP view
       //	RELATEDITEM				Related Item
       //	PRODUCTLISTDETAILSLATER	Used to render each item that was saved for later
       //	PRODUCTLISTDETAILSFULL	Used to render each item that is shown inside My Account in the details of a particular Product List
       //	PRODUCTLISTDETAILSEDIT	Used when rendering the form to edit an item inside a product list
       //	ITEMVIEWCELL			For all list where items are rendered
       //
       //@property {Number?} linePrice Specify this value if you want to use a different price rather than the one of the line
       //@property {String?} linePriceFormatted This string valid must be present if you want to use a custom price containing the formatted value of linePrice
       //@property {Boolean?} hideComparePrice
       //@property {Item.Model|Product.Model} model


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.DetailsMinQuantity.View', [
    'product_list_details_min_quantity.tpl',
    'Backbone'
], function (product_list_details_min_quantity_tpl, Backbone) {
    'use strict';
    // @class ProductList.DetailsMinQuantity.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_list_details_min_quantity_tpl    // @method getContext
                                                 // @return {ProductList.DetailsMinQuantity.View.Context}
,
        getContext: function () {
            var item_model = this.model.get('item');
            // @class ProductList.DetailsMinQuantity.View.Context
            return {
                // @property {Boolean} fulfillsMinQuantityRequirements
                fulfillsMinQuantityRequirements: this.model.fulfillsMinimumQuantityRequirement()    // @property {Number} minimumQuantity
,
                minimumQuantity: item_model.get('_minimumQuantity')    // @property {Boolean} fulfillsMaxQuantityRequirements
,
                fulfillsMaxQuantityRequirements: this.model.fulfillsMaximumQuantityRequirement()    // @property {Number} maximumQuantity
,
                maximumQuantity: item_model.get('_maximumQuantity')    // @property {Number} quantity
,
                quantity: this.model.get('quantity')    // @property {String} id
,
                id: this.model.get('internalid')
            };    // @class ProductList.DetailsMinQuantity.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.DetailsLaterMacro.View', [
    'ProductViews.Price.View',
    'ProductLine.Stock.View',
    'ProductList.DetailsMinQuantity.View',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'Transaction.Line.Views.Options.Selected.View',
    'ProductLine.StockDescription.View',
    'product_list_details_later_macro.tpl',
    'underscore',
    'Backbone'
], function (ProductViewsPriceView, ProductLineStockView, ProductListDetailsMinQuantityView, BackboneCompositeView, BackboneCollectionView, TransactionLineViewsOptionsSelectedView, ProductLineStockDescriptionView, product_list_details_later_macro_tpl, _, Backbone) {
    'use strict';
    // @class ProductList.DetailsLaterMacro.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_list_details_later_macro_tpl,
        initialize: function () {
            BackboneCompositeView.add(this);
        },
        childViews: {
            'ItemViews.Price': function () {
                return new ProductViewsPriceView({
                    model: this.model,
                    origin: 'PRODUCTLISTDETAILSLATER'
                });
            },
            'Item.SelectedOptions': function () {
                return new TransactionLineViewsOptionsSelectedView({ model: this.model });
            },
            'ItemViews.Stock': function () {
                return new ProductLineStockView({ model: this.model });
            },
            'ProductList.DetailsMinQuantity': function () {
                return new ProductListDetailsMinQuantityView({ model: this.model });
            },
            'StockDescription': function () {
                return new ProductLineStockDescriptionView({ model: this.model });
            }
        }    // @method getContext
             // @return {ProductList.DetailsLaterMacro.View.Context}
,
        getContext: function () {
            var item = this.model.get('item');
            // @class ProductList.DetailsLaterMacro.View.Context
            return {
                // @property {ProductList.Item.Model} model
                model: this.model,
                quantity: this.model.get('quantity')    // @property {String} itemId
,
                itemId: item.get('internalid')    // @property {Boolean} canBeAddedToCart
,
                canBeAddedToCart: item.get('ispurchasable') && this.model.fulfillsMinimumQuantityRequirement() && this.model.fulfillsMaximumQuantityRequirement()    // @property {String} itemDetailsUrl
,
                itemDetailsUrl: this.model.generateURL()    // @property {Boolean} isGiftCertificate
,
                isGiftCertificate: item.get('itemtype') === 'GiftCert'    // @property {Boolean} showActions
,
                showActions: !this.options.hide_actions,
                thumbnail: this.model.getThumbnail()
            };    // @class ProductList.DetailsLaterMacro.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.Edit.View', [
    'ProductList.Model',
    'ProductList.Item.Collection',
    'MenuTree.View',
    'Backbone.FormView',
    'product_list_new.tpl',
    'underscore',
    'Backbone',
    'Backbone.View',
    'Backbone.View.render',
    'Utils'
], function (ProductListModel, ProductListItemCollection, MenuTreeView, BackboneFormView, product_list_new_tpl, _, Backbone) {
    'use strict';
    // @class ProductList.Edit.View View to handle Product Lists creation @extends Backbone.View
    return Backbone.View.extend({
        template: product_list_new_tpl,
        attributes: { 'class': 'product-list-new-wrapper' },
        events: {
            'submit form': 'saveForm',
            '[data-action="prevent-enter"]': 'preventEnter'
        },
        bindings: { '[name="name"]': 'name' },
        initialize: function (options) {
            this.application = options.application;
            this.parentView = options.parentView;
            this.model = options.model;
            this.isEdit = this.model.get('internalid');
            this.page_header = this.getTitle();
            this.inModal = options.inModal;
            BackboneFormView.add(this);
            this.model.once('saveCompleted', _.bind(this.onSaveComplete, this));
        }    // @method preventEnter Prevents not desired behavior when hitting enter
,
        preventEnter: function (event) {
            if (event.keyCode === 13) {
                event.preventDefault();
            }
        }    // Sets focus on the name field and returns the correct title text
,
        getTitle: function () {
            this.$('[name="name"]').focus();
            var editLabel = _('Edit your list').translate();
            var newLabel = _('Edit your list').translate();
            return this.isEdit ? editLabel : newLabel;
        }    // Handles the form submit on save
,
        onSaveComplete: function () {
            var self = this;
            if (_.isArray(self.model.get('items'))) {
                self.model.set('items', new ProductListItemCollection(self.model.get('items')));
            }
            self.$containerModal && self.$containerModal.modal('hide');
            if (self.isEdit) {
                self.application.ProductListModule.Utils.getProductLists().add(self.model, { merge: true });
                MenuTreeView.getInstance().updateMenuItemsUI();
                self.parentView.render();
                if (self.parentView.$el.hasClass('ProductListDetailsView')) {
                    self.parentView.showConfirmationMessage(_('Good! The list was successfully updated. ').translate());
                } else {
                    self.parentView.showConfirmationMessage(_('Good! Your <a href="/wishlist/$(0)">$(1)</a> list was successfully updated. ').translate(self.model.get('internalid'), self.model.get('name')));
                }
            } else {
                self.application.ProductListModule.Utils.getProductLists().add(self.model);
                MenuTreeView.getInstance().updateMenuItemsUI();
                self.parentView.render();
                self.parentView.showConfirmationMessage(_('Good! Your <a href="/wishlist/$(0)">$(1)</a> list was successfully created. ').translate(self.model.get('internalid'), self.model.get('name')));
            }
            self.parentView.highlightList && self.parentView.highlightList(self.model.get('internalid'));
        }    // @method getName Get new list name
,
        getName: function () {
            return this.$('.product-list-new-name-input input').val();
        }    // @method getNotes Get new list notes
,
        getNotes: function () {
            return this.$('.product-list-new-notes-input textarea').val();
        }    // @method getContext @return {ProductList.Edit.View.Context}
,
        getContext: function () {
            var model = this.model;
            // @class ProductList.Edit.View.Context
            return {
                // @property {Boolean} inModal
                inModal: !!this.inModal,
                isEdit: !!this.isEdit,
                name: model.get('name')    // @property {String} description
,
                description: model.get('description')
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module GlobalViews
define('GlobalViews.StarRating.View', [
    'SC.Configuration',
    'global_views_star_rating.tpl',
    'Backbone',
    'jQuery',
    'underscore'
], function (Configuration, global_views_star_rating_tpl, Backbone, jQuery, _) {
    'use strict';
    // @class GlobalViews.StarRating.View @extends Backbone.View
    return Backbone.View.extend({
        template: global_views_star_rating_tpl,
        initialize: function () {
            if (!this.model) {
                return;
            }
            this.options.value = this.model.get('_rating') || this.model.get('rating') || 0;
            this.options.ratingCount = this.model.get('_ratingsCount') || 0;
            this.options.label = this.model.get('label') || '';
            this.options.name = this.model.get('name');
        }    // @method getContext
             // @returns {GlobalViews.StarRating.View.Context}
,
        getContext: function () {
            var fill_value = Math.round(this.options.value * 2) / 2, max_value = this.options.max || Configuration.get('productReviews.maxRate', 5);
            //@class GlobalViews.StarRating.View.Context
            return {
                //@property {Boolean} showLabelRating
                showLabelRating: this.options.showLabelRating || false    //@property {Boolean} showLabel
,
                showLabel: !!this.options.label    //@property {String} label
,
                label: this.options.label || ''    //@property {String} name
,
                name: this.options.name || ''    //@property {Number} maxValue
,
                maxValue: max_value    //@property {Number} value
,
                value: this.options.value,
                fillValue: fill_value    //@property {Number} filledBy
,
                filledBy: fill_value * 100 / max_value    //@property {Boolean} isWritable
,
                isWritable: !!this.options.isWritable,
                buttons: _.range(max_value)    //@property {Boolean} showValue
,
                showValue: !!this.options.showValue,
                showRatingCount: !!this.options.showRatingCount,
                ratingCount: this.options.ratingCount,
                className: this.options.className ? '-' + this.options.className : ''    //@property {Boolean} ratingCountGreaterThan0
,
                ratingCountGreaterThan0: this.options.ratingCount > 0    //@property {Boolean} hasOneReview
,
                hasOneReview: this.options.ratingCount === 1
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.DisplayFull.View', [
    'ProductViews.Price.View',
    'ProductLine.Stock.View',
    'GlobalViews.StarRating.View',
    'ProductList.DetailsMinQuantity.View',
    'Backbone.CompositeView',
    'Transaction.Line.Views.Options.Selected.View',
    'ProductLine.StockDescription.View',
    'product_list_display_full.tpl',
    'underscore',
    'Backbone'
], function (ProductViewsPriceView, ProductLineStockView, GlobalViewsStarRatingView, ProductListDetailsMinQuantityView, BackboneCompositeView, TransactionLineViewsOptionsSelectedView, ProductLineStockDescriptionView, product_list_display_full_tpl, _, Backbone) {
    'use strict';
    // @class ProductList.DisplayFull.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_list_display_full_tpl,
        initialize: function () {
            BackboneCompositeView.add(this);
        },
        childViews: {
            'ItemViews.Price': function () {
                return new ProductViewsPriceView({
                    model: this.model,
                    origin: 'PRODUCTLISTDETAILSFULL'
                });
            },
            'Item.SelectedOptions': function () {
                return new TransactionLineViewsOptionsSelectedView({ model: this.model });
            },
            'ItemViews.Stock': function () {
                return new ProductLineStockView({ model: this.model });
            },
            'GlobalViews.StarRating': function () {
                return new GlobalViewsStarRatingView({ model: this.model.get('item') });
            },
            'ProductList.DetailsMinQuantity': function () {
                return new ProductListDetailsMinQuantityView({ model: this.model });
            },
            'StockDescription': function () {
                return new ProductLineStockDescriptionView({ model: this.model });
            }
        }    // @method getContext
             // @return {ProductList.DisplayFull.View.Context}
,
        getContext: function getContext() {
            var line = this.model, options = this.options || {}, priority = line.get('priority'), item = line.get('item'), description = line.get('description');
            // @class ProductList.DisplayFull.View.Context
            return {
                // @property {String} lineId
                lineId: line.get('internalid')    // @property {Boolean} isChecked
,
                isChecked: !!line.get('checked')    // @property {Integer} quantity
,
                quantity: line.get('quantity')    // @property {String} description
,
                description: description    // @property {Boolean} hasDescription
,
                hasDescription: !!description    // @property {Boolean} showEdit
,
                showEdit: options.show_edit_action,
                showMoveAction: options.show_move_action,
                showAddedOn: !options.hide_added_on,
                itemId: line.getItemId()    // @property {Boolean} isAvailableForCart
,
                isAvailableForCart: item.get('_isPurchasable') && line.fulfillsMinimumQuantityRequirement() && line.fulfillsMaximumQuantityRequirement()    // @property {Boolean} showRating
,
                showRating: !options.hide_rating,
                showCheckbox: !options.hide_checkbox,
                productName: item.get('_name')    // @property {String} priorityName
,
                priorityName: priority.name,
                itemCreatedDate: line.get('createddate')    // @property {String} linkAttributes
,
                linkAttributes: line.getFullLink()    // @property {ImageContainer} thumbnail
,
                thumbnail: this.model.getThumbnail()
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.AddedToCart.View', [
    'Backbone.CollectionView',
    'Backbone.CompositeView',
    'ProductList.DisplayFull.View',
    'product_list_added_to_cart.tpl',
    'underscore',
    'Backbone',
    'Backbone.View',
    'Backbone.View.render',
    'Utils'
], function (BackboneCollectionView, BackboneCompositeView, ProductListDisplayFullView, product_list_added_to_cart_tpl, _, Backbone) {
    'use strict';
    // @class ProductList.AddedToCart.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_list_added_to_cart_tpl,
        attributes: { 'class': 'product-list-added-to-cart' },
        title: _('Added to Cart').translate(),
        initialize: function (options) {
            this.application = options.application;
            BackboneCompositeView.add(this);
        }    // Render the view and show warning message if any item is not available to be added to the cart
,
        render: function () {
            Backbone.View.prototype.render.apply(this);
            var list = this.options.list, not_purchasable_items_count = this.options.not_purchasable_items_count;
            if (list && not_purchasable_items_count > 0) {
                var warning_message = not_purchasable_items_count === 1 ? _('One item not available for purchase was not added to the cart.').translate() : _('$(0) items not available for purchase were not added to the cart.').translate(not_purchasable_items_count);
                this.showWarningMessage(warning_message);
            }
        },
        showWarningMessage: function (message) {
            this.$('[data-warning-message]').empty().append(message);
        },
        isPurchasable: function (model) {
            return model.get('item').get('_isPurchasable');
        },
        childViews: {
            'ProductList.ItemsAddedToCart': function () {
                var list = this.options.list, isItem = !list;
                return new BackboneCollectionView({
                    childView: ProductListDisplayFullView,
                    childViewOptions: {
                        application: this.application,
                        hide_rating: true,
                        hide_added_on: true,
                        hide_checkbox: true,
                        id: 'list',
                        name: 'List',
                        icon: 'icon-th-list',
                        isDefault: true
                    },
                    viewsPerRow: 1,
                    collection: isItem ? [this.options.item] : list.get('items').models.filter(this.isPurchasable)
                });
            }
        }    // @method getContext @return ProductList.AddedToCart.View.Context
,
        getContext: function () {
            var list = this.options.list, isItem = !list, models = isItem ? [this.options.item] : list.get('items').models.filter(this.isPurchasable);
            return {
                // @property {Boolean} isItem
                isItem: isItem    // @property {Boolean} hasMoreThanOneModel
,
                hasMoreThanOneModel: models.length > 1    // @property {String} listName
,
                listName: list.get('name')    // @property {Integer} modelsLength
,
                modelsLength: models.length
            };
        }
    });
});


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.ListDetails.View', [
    'product_list_list_details.tpl',
    'underscore',
    'Backbone'
], function (product_list_list_details_tpl, _, Backbone) {
    'use strict';
    // @class ProductList.ListDetails.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_list_list_details_tpl    // @method getContext @return {ProductList.ListDetails.View.Context}
,
        getContext: function () {
            var list = this.options.model, items = list.get('items'), outOfStockItems = list.getOutOfStockItems();
            var minimumQuantityItems = list.getNotPurchasableItemsDueToMinimumQuantity();
            var last_product_item = _.sortBy(items.models, function (it) {
                    return new Date(it.get('created'));
                }).reverse()[0], list_description = list.get('description');
            // @class ProductList.ListDetails.View.Context
            var result = {
                // @property {Boolean} isChecked
                isChecked: list.get('checked')    // @property {String} internalId
,
                internalId: list.get('internalid')    // @property {Boolean} isAvailableForCart
,
                isAvailableForCart: list.canBeAddedToCart()    // @property {String} templateId
,
                templateId: list.get('templateId')    // @property {Boolean} isTypePredefined
,
                isTypePredefined: list.get('typeName') === 'predefined'    // @property {String} listName
,
                listName: list.get('name')    // @property {Boolean} hasItems
,
                hasItems: !!items.length,
                itemsLength: items.length,
                hasOneItem: items.length === 1    // @property {Boolean} hasLastItem
,
                hasLastItem: false    // @property {String} lastProductItemUrl
,
                lastProductItemUrl: null    // @property {String} lastItemDisplayName
,
                lastItemDisplayName: null    // @property {Boolean} hasOutOfStockItems
,
                hasOutOfStockItems: outOfStockItems.length > 0    // @property {Boolean} hasMinimumQuantityItems
,
                hasMinimumQuantityItems: minimumQuantityItems.length > 0    // @property {String} lastModifiedDate
,
                lastModifiedDate: list.get('lastmodifieddate')    // @property {String} listDescription
,
                listDescription: list_description    // @property {Boolean} hasListDescription
,
                hasListDescription: !!list_description    // @property {Boolean} isListPrivate
,
                isListPrivate: list.get('scopeName') === 'private'
            };
            if (last_product_item) {
                result.hasLastItem = !!last_product_item.get('item');
                result.lastProductItemUrl = last_product_item.getFullLink();
                result.lastItemDisplayName = last_product_item.get('item').get('_name');
            }
            return result;
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.Lists.View', [
    'ProductList.Model',
    'ProductList.Item.Collection',
    'ProductList.Edit.View',
    'MenuTree.View',
    'ProductList.AddedToCart.View',
    'GlobalViews.Confirmation.View',
    'product_list_lists.tpl',
    'LiveOrder.Model',
    'ProductList.ListDetails.View',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'SC.Configuration',
    'underscore',
    'jQuery',
    'Backbone',
    'Backbone.View',
    'Backbone.View.render',
    'Utils'
], function (ProductListModel, ProductListItemCollection, ProductListCreationView, MenuTreeView, ProductListAddedToCartView, GlobalViewsConfirmationView, product_list_lists_tpl, LiveOrderModel, ProductListListDetailsView, BackboneCompositeView, BackboneCollectionView, Configuration, _, jQuery, Backbone) {
    'use strict';
    // @class ProductList.Lists.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_list_lists_tpl,
        title: _('Wishlist').translate(),
        className: 'ProductListListsView',
        attributes: { 'class': 'ProductListListsView' },
        events: {
            'change [data-action="sort-by"]': 'sortBy',
            'click [data-action="add-list"]': 'createProductList',
            'click [data-action="delete-list"]': 'askDeleteList',
            'click [data-action="edit-list"]': 'editListHandler',
            'click [data-action="share-list"]': 'shareList',
            'click [data-action="add-to-cart"]': 'addListToCartHandler',
            'click [data-action="select"]': 'toggleProductListHandler',
            'click [data-action="navigate"]': 'navigateToItems'
        },
        initialize: function (options) {
            this.options = options;
            this.application = options.application;
            BackboneCompositeView.add(this);
        },
        render: function () {
            Backbone.View.prototype.render.apply(this, arguments);
            //if there are no list we show the list creation form
            if (!this.collection.length) {
                this.newProductListView = new ProductListCreationView({
                    application: this.application,
                    parentView: this,
                    model: new ProductListModel()    //create!
                });
                this.newProductListView.render();
                this.$('[data-type="new-product-list"]').append(this.newProductListView.$el);
            }
        }    // @method createProductList Show create new product list modal form
,
        createProductList: function () {
            this.newProductListView = new ProductListCreationView({
                application: this.application,
                parentView: this,
                model: new ProductListModel()    //create!
            });
            this.application.getLayout().showInModal(this.newProductListView);
        }    // @method askDeleteList starts the 'delete a list' use case
,
        askDeleteList: function (e) {
            this.deleteConfirmationView = new GlobalViewsConfirmationView({
                callBackParameters: {
                    target: e.target,
                    context: this
                },
                callBack: this.deleteListHandler,
                title: _('Delete list').translate(),
                autohide: false,
                body: _('Are you sure you want to remove this list?').translate()
            });
            this.application.getLayout().showInModal(this.deleteConfirmationView);
        }    // @method deleteListHandler called from the sub view when the user confirms he wants to delete the product list.
,
        deleteListHandler: function (options) {
            var self = options.context, target = options.target, list = self.getListFromDom(jQuery(target));
            self.collection.remove(list);
            list.url = ProductListModel.prototype.url;
            list.destroy().done(function () {
                MenuTreeView.getInstance().updateMenuItemsUI();
                self.render();
                self.showConfirmationMessage(_('Your <span class="product-list-name">$(0)</span> list was removed').translate(list.get('name')));
                self.deleteConfirmationView.$containerModal.modal('hide');
            });
        }    // @method highlightList temporarily highlights a list that has been recently added or edited
,
        highlightList: function (internalid) {
            var $list_dom = jQuery(this.el).find('article[data-product-list-id=' + internalid + ']');
            if ($list_dom) {
                $list_dom.addClass('new-list');
                setTimeout(function () {
                    $list_dom.removeClass('new-list');
                }, 3000);
            }
        }    // @method addListToCartHandler Add list to cart click handler
,
        addListToCartHandler: function (e) {
            var list = this.getCurrentList(e);
            this.addListToCart(list);
        }    // @method Adds an entire list to the cart @param {ProductList.Model} list
,
        addListToCart: function (list) {
            // collect the items data to add to cart
            var lines_to_add = [], self = this, not_purchasable_items_count = 0;
            list.get('items').each(function (pli) {
                if (pli.get('item').get('_isPurchasable')) {
                    lines_to_add.push(pli);
                } else {
                    not_purchasable_items_count++;
                }
            });
            if (lines_to_add.length === 0) {
                var errorMessage = _('All items in the list are not available for purchase.').translate();
                self.showWarningMessage(errorMessage);
                return;
            }
            // add the items to the cart and when its done show the confirmation view
            LiveOrderModel.getInstance().addProducts(lines_to_add).done(function () {
                // before showing the confirmation view we need to fetch the items of the list with all the data.
                self.application.ProductListModule.Utils.getProductList(list.get('internalid')).done(function (model) {
                    self.addedToCartView = new ProductListAddedToCartView({
                        application: self.application,
                        parentView: self,
                        list: new ProductListModel(model)    //pass the model with all the data
,
                        not_purchasable_items_count: not_purchasable_items_count
                    });
                    // also show a confirmation message
                    var confirmMessage;
                    if (list.get('items').length > 1) {
                        confirmMessage = _('Good! $(0) items from your <a class="product-list-name" href="/wishlist/$(1)">$(2)</a> list were successfully added to your cart. You can continue to <a href="">view your cart and checkout</a>').translate(list.get('items').length, list.get('internalid'), list.get('name'));
                    } else {
                        confirmMessage = _('Good! $(0) item from your <a class="product-list-name" href="/wishlist/$(1)">$(2)</a> list was successfully added to your cart. You can continue to <a href="" data-touchpoint="viewcart">view your cart and checkout</a>').translate(list.get('items').length, list.get('internalid'), list.get('name'));
                    }
                    self.showConfirmationMessage(confirmMessage);
                    self.application.getLayout().showInModal(self.addedToCartView);
                });
            });
        }    // @method editListHandler Edit list click handler
,
        editListHandler: function (e) {
            var list = this.getListFromDom(jQuery(e.target));
            this.editList(list);
        }    // @method getListFromDom Get the list (collection) from DOM @return {ProductList.Model}
,
        getListFromDom: function ($target) {
            var list_id = $target.closest('[data-product-list-id]').data('product-list-id') + '';
            return this.options.collection.where({ internalid: list_id })[0];
        }    // @method editList Edit list click handler (displays edit list modal view) @param {ProductList.Model} list
,
        editList: function (list) {
            this.newProductListView = new ProductListCreationView({
                application: this.application,
                parentView: this,
                model: list,
                inModal: true
            });
            this.application.getLayout().showInModal(this.newProductListView);
        }    //@method getSelectedMenu
,
        getSelectedMenu: function () {
            return 'productlist_all';
        }    // @method getBreadcrumbPages
,
        getBreadcrumbPages: function () {
            return {
                text: _('Wishlist').translate(),
                href: '/wishlist'
            };
        }    // @method toggleProductListItemHandler
,
        toggleProductListItemHandler: function (e) {
            this.toggleProductListItem(jQuery(e.target).closest('article').data('id'));
        }    // @method toggleProductListHandler
,
        toggleProductListHandler: function (e) {
            this.toggleProductList(jQuery(e.target).closest('article').data('id'));
        }    // @method toggleProductList @param {String} pl_internalid
,
        toggleProductList: function (pl_internalid) {
            var pl = this.collection.get(pl_internalid);
            if (pl) {
                this[pl.get('checked') ? 'unselectProductList' : 'selectProductList'](pl);
                this.render();
            }
        }    // @method selectProductList @param {ProductList.Model} pl
,
        selectProductList: function (pl) {
            if (pl) {
                pl.set('checked', true);
            }
        }    // @method unselectProductList @param {ProductList.Model} pl
,
        unselectProductList: function (pl) {
            if (pl) {
                pl.set('checked', false);
            }
        }    // @method getCurrentList @returns {ProductList.Model}
,
        getCurrentList: function (e) {
            var list_id = jQuery(e.target).closest('[data-product-list-id]').data('product-list-id') + '', list = this.options.collection.findWhere({ internalid: list_id });
            return list;
        }    // @method navigateToItems
,
        navigateToItems: function (e) {
            //ignore clicks on anchors and buttons
            if (_.isTargetActionable(e)) {
                return;
            }
            var list = this.getCurrentList(e), internalid = list.get('internalid'), url = '/wishlist/' + (internalid ? internalid : 'tmpl_' + list.get('templateid'));
            Backbone.history.navigate(url, { trigger: true });
        },
        childViews: {
            'ProductList.ListDetails': function () {
                return new BackboneCollectionView({
                    childView: ProductListListDetailsView,
                    viewsPerRow: 1,
                    collection: this.collection
                });
            }
        }    // @method getContext @return {ProductList.Lists.View.Context}
,
        getContext: function () {
            // @class ProductList.Lists.View.Context
            return {
                // @property {Boolean} hasLists
                hasLists: this.collection.length,
                showBackToAccount: Configuration.get('siteSettings.sitetype') === 'STANDARD'    //@property {Boolean} isSingleList
,
                isSingleList: this.application.ProductListModule.Utils.isSingleList()
            };
        }
    });
});
/*!
 * Bootstrap v3.3.7 (http://getbootstrap.com)
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under the MIT license
 */
define('bootstrap', ['jQuery'], function () {
    if (typeof jQuery === 'undefined') {
        throw new Error('Bootstrap\'s JavaScript requires jQuery');
    }
    +function ($) {
        'use strict';
        var version = $.fn.jquery.split(' ')[0].split('.');
        if (version[0] < 2 && version[1] < 9 || version[0] == 1 && version[1] == 9 && version[2] < 1 || version[0] > 3) {
            throw new Error('Bootstrap\'s JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4');
        }
    }(jQuery);
    /* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
    +function ($) {
        'use strict';
        // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
        // ============================================================
        function transitionEnd() {
            var el = document.createElement('bootstrap');
            var transEndEventNames = {
                WebkitTransition: 'webkitTransitionEnd',
                MozTransition: 'transitionend',
                OTransition: 'oTransitionEnd otransitionend',
                transition: 'transitionend'
            };
            for (var name in transEndEventNames) {
                if (el.style[name] !== undefined) {
                    return { end: transEndEventNames[name] };
                }
            }
            return false    // explicit for ie8 (  ._.)
;
        }
        // http://blog.alexmaccaw.com/css-transitions
        $.fn.emulateTransitionEnd = function (duration) {
            var called = false;
            var $el = this;
            $(this).one('bsTransitionEnd', function () {
                called = true;
            });
            var callback = function () {
                if (!called)
                    $($el).trigger($.support.transition.end);
            };
            setTimeout(callback, duration);
            return this;
        };
        $(function () {
            $.support.transition = transitionEnd();
            if (!$.support.transition)
                return;
            $.event.special.bsTransitionEnd = {
                bindType: $.support.transition.end,
                delegateType: $.support.transition.end,
                handle: function (e) {
                    if ($(e.target).is(this))
                        return e.handleObj.handler.apply(this, arguments);
                }
            };
        });
    }(jQuery);
    /* ========================================================================
 * Bootstrap: alert.js v3.3.7
 * http://getbootstrap.com/javascript/#alerts
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
    +function ($) {
        'use strict';
        // ALERT CLASS DEFINITION
        // ======================
        var dismiss = '[data-dismiss="alert"]';
        var Alert = function (el) {
            $(el).on('click', dismiss, this.close);
        };
        Alert.VERSION = '3.3.7';
        Alert.TRANSITION_DURATION = 150;
        Alert.prototype.close = function (e) {
            var $this = $(this);
            var selector = $this.attr('data-target');
            if (!selector) {
                selector = $this.attr('href');
                selector = selector && selector.replace(/.*(?=#[^\s]*$)/, '')    // strip for ie7
;
            }
            var $parent = $(selector === '#' ? [] : selector);
            if (e)
                e.preventDefault();
            if (!$parent.length) {
                $parent = $this.closest('.alert');
            }
            $parent.trigger(e = $.Event('close.bs.alert'));
            if (e.isDefaultPrevented())
                return;
            $parent.removeClass('in');
            function removeElement() {
                // detach from parent, fire event then clean up data
                $parent.detach().trigger('closed.bs.alert').remove();
            }
            $.support.transition && $parent.hasClass('fade') ? $parent.one('bsTransitionEnd', removeElement).emulateTransitionEnd(Alert.TRANSITION_DURATION) : removeElement();
        };
        // ALERT PLUGIN DEFINITION
        // =======================
        function Plugin(option) {
            return this.each(function () {
                var $this = $(this);
                var data = $this.data('bs.alert');
                if (!data)
                    $this.data('bs.alert', data = new Alert(this));
                if (typeof option == 'string')
                    data[option].call($this);
            });
        }
        var old = $.fn.alert;
        $.fn.alert = Plugin;
        $.fn.alert.Constructor = Alert;
        // ALERT NO CONFLICT
        // =================
        $.fn.alert.noConflict = function () {
            $.fn.alert = old;
            return this;
        };
        // ALERT DATA-API
        // ==============
        $(document).on('click.bs.alert.data-api', dismiss, Alert.prototype.close);
    }(jQuery);
    /* ========================================================================
 * Bootstrap: button.js v3.3.7
 * http://getbootstrap.com/javascript/#buttons
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
    +function ($) {
        'use strict';
        // BUTTON PUBLIC CLASS DEFINITION
        // ==============================
        var Button = function (element, options) {
            this.$element = $(element);
            this.options = $.extend({}, Button.DEFAULTS, options);
            this.isLoading = false;
        };
        Button.VERSION = '3.3.7';
        Button.DEFAULTS = { loadingText: 'loading...' };
        Button.prototype.setState = function (state) {
            var d = 'disabled';
            var $el = this.$element;
            var val = $el.is('input') ? 'val' : 'html';
            var data = $el.data();
            state += 'Text';
            if (data.resetText == null)
                $el.data('resetText', $el[val]());
            // push to event loop to allow forms to submit
            setTimeout($.proxy(function () {
                $el[val](data[state] == null ? this.options[state] : data[state]);
                if (state == 'loadingText') {
                    this.isLoading = true;
                    $el.addClass(d).attr(d, d).prop(d, true);
                } else if (this.isLoading) {
                    this.isLoading = false;
                    $el.removeClass(d).removeAttr(d).prop(d, false);
                }
            }, this), 0);
        };
        Button.prototype.toggle = function () {
            var changed = true;
            var $parent = this.$element.closest('[data-toggle="buttons"]');
            if ($parent.length) {
                var $input = this.$element.find('input');
                if ($input.prop('type') == 'radio') {
                    if ($input.prop('checked'))
                        changed = false;
                    $parent.find('.active').removeClass('active');
                    this.$element.addClass('active');
                } else if ($input.prop('type') == 'checkbox') {
                    if ($input.prop('checked') !== this.$element.hasClass('active'))
                        changed = false;
                    this.$element.toggleClass('active');
                }
                $input.prop('checked', this.$element.hasClass('active'));
                if (changed)
                    $input.trigger('change');
            } else {
                this.$element.attr('aria-pressed', !this.$element.hasClass('active'));
                this.$element.toggleClass('active');
            }
        };
        // BUTTON PLUGIN DEFINITION
        // ========================
        function Plugin(option) {
            return this.each(function () {
                var $this = $(this);
                var data = $this.data('bs.button');
                var options = typeof option == 'object' && option;
                if (!data)
                    $this.data('bs.button', data = new Button(this, options));
                if (option == 'toggle')
                    data.toggle();
                else if (option)
                    data.setState(option);
            });
        }
        var old = $.fn.button;
        $.fn.button = Plugin;
        $.fn.button.Constructor = Button;
        // BUTTON NO CONFLICT
        // ==================
        $.fn.button.noConflict = function () {
            $.fn.button = old;
            return this;
        };
        // BUTTON DATA-API
        // ===============
        $(document).on('click.bs.button.data-api', '[data-toggle^="button"]', function (e) {
            var $btn = $(e.target).closest('.btn');
            Plugin.call($btn, 'toggle');
            if (!$(e.target).is('input[type="radio"], input[type="checkbox"]')) {
                // Prevent double click on radios, and the double selections (so cancellation) on checkboxes
                e.preventDefault();
                // The target component still receive the focus
                if ($btn.is('input,button'))
                    $btn.trigger('focus');
                else
                    $btn.find('input:visible,button:visible').first().trigger('focus');
            }
        }).on('focus.bs.button.data-api blur.bs.button.data-api', '[data-toggle^="button"]', function (e) {
            $(e.target).closest('.btn').toggleClass('focus', /^focus(in)?$/.test(e.type));
        });
    }(jQuery);
    /* ========================================================================
 * Bootstrap: carousel.js v3.3.7
 * http://getbootstrap.com/javascript/#carousel
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
    +function ($) {
        'use strict';
        // CAROUSEL CLASS DEFINITION
        // =========================
        var Carousel = function (element, options) {
            this.$element = $(element);
            this.$indicators = this.$element.find('.carousel-indicators');
            this.options = options;
            this.paused = null;
            this.sliding = null;
            this.interval = null;
            this.$active = null;
            this.$items = null;
            this.options.keyboard && this.$element.on('keydown.bs.carousel', $.proxy(this.keydown, this));
            this.options.pause == 'hover' && !('ontouchstart' in document.documentElement) && this.$element.on('mouseenter.bs.carousel', $.proxy(this.pause, this)).on('mouseleave.bs.carousel', $.proxy(this.cycle, this));
        };
        Carousel.VERSION = '3.3.7';
        Carousel.TRANSITION_DURATION = 600;
        Carousel.DEFAULTS = {
            interval: 5000,
            pause: 'hover',
            wrap: true,
            keyboard: true
        };
        Carousel.prototype.keydown = function (e) {
            if (/input|textarea/i.test(e.target.tagName))
                return;
            switch (e.which) {
            case 37:
                this.prev();
                break;
            case 39:
                this.next();
                break;
            default:
                return;
            }
            e.preventDefault();
        };
        Carousel.prototype.cycle = function (e) {
            e || (this.paused = false);
            this.interval && clearInterval(this.interval);
            this.options.interval && !this.paused && (this.interval = setInterval($.proxy(this.next, this), this.options.interval));
            return this;
        };
        Carousel.prototype.getItemIndex = function (item) {
            this.$items = item.parent().children('.item');
            return this.$items.index(item || this.$active);
        };
        Carousel.prototype.getItemForDirection = function (direction, active) {
            var activeIndex = this.getItemIndex(active);
            var willWrap = direction == 'prev' && activeIndex === 0 || direction == 'next' && activeIndex == this.$items.length - 1;
            if (willWrap && !this.options.wrap)
                return active;
            var delta = direction == 'prev' ? -1 : 1;
            var itemIndex = (activeIndex + delta) % this.$items.length;
            return this.$items.eq(itemIndex);
        };
        Carousel.prototype.to = function (pos) {
            var that = this;
            var activeIndex = this.getItemIndex(this.$active = this.$element.find('.item.active'));
            if (pos > this.$items.length - 1 || pos < 0)
                return;
            if (this.sliding)
                return this.$element.one('slid.bs.carousel', function () {
                    that.to(pos);
                });
            // yes, "slid"
            if (activeIndex == pos)
                return this.pause().cycle();
            return this.slide(pos > activeIndex ? 'next' : 'prev', this.$items.eq(pos));
        };
        Carousel.prototype.pause = function (e) {
            e || (this.paused = true);
            if (this.$element.find('.next, .prev').length && $.support.transition) {
                this.$element.trigger($.support.transition.end);
                this.cycle(true);
            }
            this.interval = clearInterval(this.interval);
            return this;
        };
        Carousel.prototype.next = function () {
            if (this.sliding)
                return;
            return this.slide('next');
        };
        Carousel.prototype.prev = function () {
            if (this.sliding)
                return;
            return this.slide('prev');
        };
        Carousel.prototype.slide = function (type, next) {
            var $active = this.$element.find('.item.active');
            var $next = next || this.getItemForDirection(type, $active);
            var isCycling = this.interval;
            var direction = type == 'next' ? 'left' : 'right';
            var that = this;
            if ($next.hasClass('active'))
                return this.sliding = false;
            var relatedTarget = $next[0];
            var slideEvent = $.Event('slide.bs.carousel', {
                relatedTarget: relatedTarget,
                direction: direction
            });
            this.$element.trigger(slideEvent);
            if (slideEvent.isDefaultPrevented())
                return;
            this.sliding = true;
            isCycling && this.pause();
            if (this.$indicators.length) {
                this.$indicators.find('.active').removeClass('active');
                var $nextIndicator = $(this.$indicators.children()[this.getItemIndex($next)]);
                $nextIndicator && $nextIndicator.addClass('active');
            }
            var slidEvent = $.Event('slid.bs.carousel', {
                relatedTarget: relatedTarget,
                direction: direction
            });
            // yes, "slid"
            if ($.support.transition && this.$element.hasClass('slide')) {
                $next.addClass(type);
                $next[0].offsetWidth;
                // force reflow
                $active.addClass(direction);
                $next.addClass(direction);
                $active.one('bsTransitionEnd', function () {
                    $next.removeClass([
                        type,
                        direction
                    ].join(' ')).addClass('active');
                    $active.removeClass([
                        'active',
                        direction
                    ].join(' '));
                    that.sliding = false;
                    setTimeout(function () {
                        that.$element.trigger(slidEvent);
                    }, 0);
                }).emulateTransitionEnd(Carousel.TRANSITION_DURATION);
            } else {
                $active.removeClass('active');
                $next.addClass('active');
                this.sliding = false;
                this.$element.trigger(slidEvent);
            }
            isCycling && this.cycle();
            return this;
        };
        // CAROUSEL PLUGIN DEFINITION
        // ==========================
        function Plugin(option) {
            return this.each(function () {
                var $this = $(this);
                var data = $this.data('bs.carousel');
                var options = $.extend({}, Carousel.DEFAULTS, $this.data(), typeof option == 'object' && option);
                var action = typeof option == 'string' ? option : options.slide;
                if (!data)
                    $this.data('bs.carousel', data = new Carousel(this, options));
                if (typeof option == 'number')
                    data.to(option);
                else if (action)
                    data[action]();
                else if (options.interval)
                    data.pause().cycle();
            });
        }
        var old = $.fn.carousel;
        $.fn.carousel = Plugin;
        $.fn.carousel.Constructor = Carousel;
        // CAROUSEL NO CONFLICT
        // ====================
        $.fn.carousel.noConflict = function () {
            $.fn.carousel = old;
            return this;
        };
        // CAROUSEL DATA-API
        // =================
        var clickHandler = function (e) {
            var href;
            var $this = $(this);
            var $target = $($this.attr('data-target') || (href = $this.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, ''));
            // strip for ie7
            if (!$target.hasClass('carousel'))
                return;
            var options = $.extend({}, $target.data(), $this.data());
            var slideIndex = $this.attr('data-slide-to');
            if (slideIndex)
                options.interval = false;
            Plugin.call($target, options);
            if (slideIndex) {
                $target.data('bs.carousel').to(slideIndex);
            }
            e.preventDefault();
        };
        $(document).on('click.bs.carousel.data-api', '[data-slide]', clickHandler).on('click.bs.carousel.data-api', '[data-slide-to]', clickHandler);
        $(window).on('load', function () {
            $('[data-ride="carousel"]').each(function () {
                var $carousel = $(this);
                Plugin.call($carousel, $carousel.data());
            });
        });
    }(jQuery);
    /* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
    /* jshint latedef: false */
    +function ($) {
        'use strict';
        // COLLAPSE PUBLIC CLASS DEFINITION
        // ================================
        var Collapse = function (element, options) {
            this.$element = $(element);
            this.options = $.extend({}, Collapse.DEFAULTS, options);
            this.$trigger = $('[data-toggle="collapse"][href="#' + element.id + '"],' + '[data-toggle="collapse"][data-target="#' + element.id + '"]');
            this.transitioning = null;
            if (this.options.parent) {
                this.$parent = this.getParent();
            } else {
                this.addAriaAndCollapsedClass(this.$element, this.$trigger);
            }
            if (this.options.toggle)
                this.toggle();
        };
        Collapse.VERSION = '3.3.7';
        Collapse.TRANSITION_DURATION = 350;
        Collapse.DEFAULTS = { toggle: true };
        Collapse.prototype.dimension = function () {
            var hasWidth = this.$element.hasClass('width');
            return hasWidth ? 'width' : 'height';
        };
        Collapse.prototype.show = function () {
            if (this.transitioning || this.$element.hasClass('in'))
                return;
            var activesData;
            var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing');
            if (actives && actives.length) {
                activesData = actives.data('bs.collapse');
                if (activesData && activesData.transitioning)
                    return;
            }
            var startEvent = $.Event('show.bs.collapse');
            this.$element.trigger(startEvent);
            if (startEvent.isDefaultPrevented())
                return;
            if (actives && actives.length) {
                Plugin.call(actives, 'hide');
                activesData || actives.data('bs.collapse', null);
            }
            var dimension = this.dimension();
            this.$element.removeClass('collapse').addClass('collapsing')[dimension](0).attr('aria-expanded', true);
            this.$trigger.removeClass('collapsed').attr('aria-expanded', true);
            this.transitioning = 1;
            var complete = function () {
                this.$element.removeClass('collapsing').addClass('collapse in')[dimension]('');
                this.transitioning = 0;
                this.$element.trigger('shown.bs.collapse');
            };
            if (!$.support.transition)
                return complete.call(this);
            var scrollSize = $.camelCase([
                'scroll',
                dimension
            ].join('-'));
            this.$element.one('bsTransitionEnd', $.proxy(complete, this)).emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize]);
        };
        Collapse.prototype.hide = function () {
            if (this.transitioning || !this.$element.hasClass('in'))
                return;
            var startEvent = $.Event('hide.bs.collapse');
            this.$element.trigger(startEvent);
            if (startEvent.isDefaultPrevented())
                return;
            var dimension = this.dimension();
            this.$element[dimension](this.$element[dimension]())[0].offsetHeight;
            this.$element.addClass('collapsing').removeClass('collapse in').attr('aria-expanded', false);
            this.$trigger.addClass('collapsed').attr('aria-expanded', false);
            this.transitioning = 1;
            var complete = function () {
                this.transitioning = 0;
                this.$element.removeClass('collapsing').addClass('collapse').trigger('hidden.bs.collapse');
            };
            if (!$.support.transition)
                return complete.call(this);
            this.$element[dimension](0).one('bsTransitionEnd', $.proxy(complete, this)).emulateTransitionEnd(Collapse.TRANSITION_DURATION);
        };
        Collapse.prototype.toggle = function () {
            this[this.$element.hasClass('in') ? 'hide' : 'show']();
        };
        Collapse.prototype.getParent = function () {
            return $(this.options.parent).find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]').each($.proxy(function (i, element) {
                var $element = $(element);
                this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element);
            }, this)).end();
        };
        Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
            var isOpen = $element.hasClass('in');
            $element.attr('aria-expanded', isOpen);
            $trigger.toggleClass('collapsed', !isOpen).attr('aria-expanded', isOpen);
        };
        function getTargetFromTrigger($trigger) {
            var href;
            var target = $trigger.attr('data-target') || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '');
            // strip for ie7
            return $(target);
        }
        // COLLAPSE PLUGIN DEFINITION
        // ==========================
        function Plugin(option) {
            return this.each(function () {
                var $this = $(this);
                var data = $this.data('bs.collapse');
                var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option);
                if (!data && options.toggle && /show|hide/.test(option))
                    options.toggle = false;
                if (!data)
                    $this.data('bs.collapse', data = new Collapse(this, options));
                if (typeof option == 'string')
                    data[option]();
            });
        }
        var old = $.fn.collapse;
        $.fn.collapse = Plugin;
        $.fn.collapse.Constructor = Collapse;
        // COLLAPSE NO CONFLICT
        // ====================
        $.fn.collapse.noConflict = function () {
            $.fn.collapse = old;
            return this;
        };
        // COLLAPSE DATA-API
        // =================
        $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
            var $this = $(this);
            if (!$this.attr('data-target'))
                e.preventDefault();
            var $target = getTargetFromTrigger($this);
            var data = $target.data('bs.collapse');
            var option = data ? 'toggle' : $this.data();
            Plugin.call($target, option);
        });
    }(jQuery);
    /* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
    +function ($) {
        'use strict';
        // DROPDOWN CLASS DEFINITION
        // =========================
        var backdrop = '.dropdown-backdrop';
        var toggle = '[data-toggle="dropdown"]';
        var Dropdown = function (element) {
            $(element).on('click.bs.dropdown', this.toggle);
        };
        Dropdown.VERSION = '3.3.7';
        function getParent($this) {
            var selector = $this.attr('data-target');
            if (!selector) {
                selector = $this.attr('href');
                selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '')    // strip for ie7
;
            }
            var $parent = selector && $(selector);
            return $parent && $parent.length ? $parent : $this.parent();
        }
        function clearMenus(e) {
            if (e && e.which === 3)
                return;
            $(backdrop).remove();
            $(toggle).each(function () {
                var $this = $(this);
                var $parent = getParent($this);
                var relatedTarget = { relatedTarget: this };
                if (!$parent.hasClass('open'))
                    return;
                if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target))
                    return;
                $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget));
                if (e.isDefaultPrevented())
                    return;
                $this.attr('aria-expanded', 'false');
                $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget));
            });
        }
        Dropdown.prototype.toggle = function (e) {
            var $this = $(this);
            if ($this.is('.disabled, :disabled'))
                return;
            var $parent = getParent($this);
            var isActive = $parent.hasClass('open');
            clearMenus();
            if (!isActive) {
                if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
                    // if mobile we use a backdrop because click events don't delegate
                    $(document.createElement('div')).addClass('dropdown-backdrop').insertAfter($(this)).on('click', clearMenus);
                }
                var relatedTarget = { relatedTarget: this };
                $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget));
                if (e.isDefaultPrevented())
                    return;
                $this.trigger('focus').attr('aria-expanded', 'true');
                $parent.toggleClass('open').trigger($.Event('shown.bs.dropdown', relatedTarget));
            }
            return false;
        };
        Dropdown.prototype.keydown = function (e) {
            if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName))
                return;
            var $this = $(this);
            e.preventDefault();
            e.stopPropagation();
            if ($this.is('.disabled, :disabled'))
                return;
            var $parent = getParent($this);
            var isActive = $parent.hasClass('open');
            if (!isActive && e.which != 27 || isActive && e.which == 27) {
                if (e.which == 27)
                    $parent.find(toggle).trigger('focus');
                return $this.trigger('click');
            }
            var desc = ' li:not(.disabled):visible a';
            var $items = $parent.find('.dropdown-menu' + desc);
            if (!$items.length)
                return;
            var index = $items.index(e.target);
            if (e.which == 38 && index > 0)
                index--;
            // up
            if (e.which == 40 && index < $items.length - 1)
                index++;
            // down
            if (!~index)
                index = 0;
            $items.eq(index).trigger('focus');
        };
        // DROPDOWN PLUGIN DEFINITION
        // ==========================
        function Plugin(option) {
            return this.each(function () {
                var $this = $(this);
                var data = $this.data('bs.dropdown');
                if (!data)
                    $this.data('bs.dropdown', data = new Dropdown(this));
                if (typeof option == 'string')
                    data[option].call($this);
            });
        }
        var old = $.fn.dropdown;
        $.fn.dropdown = Plugin;
        $.fn.dropdown.Constructor = Dropdown;
        // DROPDOWN NO CONFLICT
        // ====================
        $.fn.dropdown.noConflict = function () {
            $.fn.dropdown = old;
            return this;
        };
        // APPLY TO STANDARD DROPDOWN ELEMENTS
        // ===================================
        $(document).on('click.bs.dropdown.data-api', clearMenus).on('click.bs.dropdown.data-api', '.dropdown form', function (e) {
            e.stopPropagation();
        }).on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle).on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown).on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown);
    }(jQuery);
    /* ========================================================================
 * Bootstrap: modal.js v3.3.7
 * http://getbootstrap.com/javascript/#modals
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
    +function ($) {
        'use strict';
        // MODAL CLASS DEFINITION
        // ======================
        var Modal = function (element, options) {
            this.options = options;
            this.$body = $(document.body);
            this.$element = $(element);
            this.$dialog = this.$element.find('.modal-dialog');
            this.$backdrop = null;
            this.isShown = null;
            this.originalBodyPad = null;
            this.scrollbarWidth = 0;
            this.ignoreBackdropClick = false;
            if (this.options.remote) {
                this.$element.find('.modal-content').load(this.options.remote, $.proxy(function () {
                    this.$element.trigger('loaded.bs.modal');
                }, this));
            }
        };
        Modal.VERSION = '3.3.7';
        Modal.TRANSITION_DURATION = 300;
        Modal.BACKDROP_TRANSITION_DURATION = 150;
        Modal.DEFAULTS = {
            backdrop: true,
            keyboard: true,
            show: true
        };
        Modal.prototype.toggle = function (_relatedTarget) {
            return this.isShown ? this.hide() : this.show(_relatedTarget);
        };
        Modal.prototype.show = function (_relatedTarget) {
            var that = this;
            var e = $.Event('show.bs.modal', { relatedTarget: _relatedTarget });
            this.$element.trigger(e);
            if (this.isShown || e.isDefaultPrevented())
                return;
            this.isShown = true;
            this.checkScrollbar();
            this.setScrollbar();
            this.$body.addClass('modal-open');
            this.escape();
            this.resize();
            this.$element.on('click.dismiss.bs.modal', '[data-dismiss="modal"]', $.proxy(this.hide, this));
            this.$dialog.on('mousedown.dismiss.bs.modal', function () {
                that.$element.one('mouseup.dismiss.bs.modal', function (e) {
                    if ($(e.target).is(that.$element))
                        that.ignoreBackdropClick = true;
                });
            });
            this.backdrop(function () {
                var transition = $.support.transition && that.$element.hasClass('fade');
                if (!that.$element.parent().length) {
                    that.$element.appendTo(that.$body)    // don't move modals dom position
;
                }
                that.$element.show().scrollTop(0);
                that.adjustDialog();
                if (transition) {
                    that.$element[0].offsetWidth;
                }
                that.$element.addClass('in');
                that.enforceFocus();
                var e = $.Event('shown.bs.modal', { relatedTarget: _relatedTarget });
                transition ? that.$dialog.one('bsTransitionEnd', function () {
                    that.$element.trigger('focus').trigger(e);
                }).emulateTransitionEnd(Modal.TRANSITION_DURATION) : that.$element.trigger('focus').trigger(e);
            });
        };
        Modal.prototype.hide = function (e) {
            if (e)
                e.preventDefault();
            e = $.Event('hide.bs.modal');
            this.$element.trigger(e);
            if (!this.isShown || e.isDefaultPrevented())
                return;
            this.isShown = false;
            this.escape();
            this.resize();
            $(document).off('focusin.bs.modal');
            this.$element.removeClass('in').off('click.dismiss.bs.modal').off('mouseup.dismiss.bs.modal');
            this.$dialog.off('mousedown.dismiss.bs.modal');
            $.support.transition && this.$element.hasClass('fade') ? this.$element.one('bsTransitionEnd', $.proxy(this.hideModal, this)).emulateTransitionEnd(Modal.TRANSITION_DURATION) : this.hideModal();
        };
        Modal.prototype.enforceFocus = function () {
            $(document).off('focusin.bs.modal')    // guard against infinite focus loop
.on('focusin.bs.modal', $.proxy(function (e) {
                if (document !== e.target && this.$element[0] !== e.target && !this.$element.has(e.target).length) {
                    this.$element.trigger('focus');
                }
            }, this));
        };
        Modal.prototype.escape = function () {
            if (this.isShown && this.options.keyboard) {
                this.$element.on('keydown.dismiss.bs.modal', $.proxy(function (e) {
                    e.which == 27 && this.hide();
                }, this));
            } else if (!this.isShown) {
                this.$element.off('keydown.dismiss.bs.modal');
            }
        };
        Modal.prototype.resize = function () {
            if (this.isShown) {
                $(window).on('resize.bs.modal', $.proxy(this.handleUpdate, this));
            } else {
                $(window).off('resize.bs.modal');
            }
        };
        Modal.prototype.hideModal = function () {
            var that = this;
            this.$element.hide();
            this.backdrop(function () {
                that.$body.removeClass('modal-open');
                that.resetAdjustments();
                that.resetScrollbar();
                that.$element.trigger('hidden.bs.modal');
            });
        };
        Modal.prototype.removeBackdrop = function () {
            this.$backdrop && this.$backdrop.remove();
            this.$backdrop = null;
        };
        Modal.prototype.backdrop = function (callback) {
            var that = this;
            var animate = this.$element.hasClass('fade') ? 'fade' : '';
            if (this.isShown && this.options.backdrop) {
                var doAnimate = $.support.transition && animate;
                this.$backdrop = $(document.createElement('div')).addClass('modal-backdrop ' + animate).appendTo(this.$body);
                this.$element.on('click.dismiss.bs.modal', $.proxy(function (e) {
                    if (this.ignoreBackdropClick) {
                        this.ignoreBackdropClick = false;
                        return;
                    }
                    if (e.target !== e.currentTarget)
                        return;
                    this.options.backdrop == 'static' ? this.$element[0].focus() : this.hide();
                }, this));
                if (doAnimate)
                    this.$backdrop[0].offsetWidth;
                // force reflow
                this.$backdrop.addClass('in');
                if (!callback)
                    return;
                doAnimate ? this.$backdrop.one('bsTransitionEnd', callback).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION) : callback();
            } else if (!this.isShown && this.$backdrop) {
                this.$backdrop.removeClass('in');
                var callbackRemove = function () {
                    that.removeBackdrop();
                    callback && callback();
                };
                $.support.transition && this.$element.hasClass('fade') ? this.$backdrop.one('bsTransitionEnd', callbackRemove).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION) : callbackRemove();
            } else if (callback) {
                callback();
            }
        };
        // these following methods are used to handle overflowing modals
        Modal.prototype.handleUpdate = function () {
            this.adjustDialog();
        };
        Modal.prototype.adjustDialog = function () {
            var modalIsOverflowing = this.$element[0].scrollHeight > document.documentElement.clientHeight;
            this.$element.css({
                paddingLeft: !this.bodyIsOverflowing && modalIsOverflowing ? this.scrollbarWidth : '',
                paddingRight: this.bodyIsOverflowing && !modalIsOverflowing ? this.scrollbarWidth : ''
            });
        };
        Modal.prototype.resetAdjustments = function () {
            this.$element.css({
                paddingLeft: '',
                paddingRight: ''
            });
        };
        Modal.prototype.checkScrollbar = function () {
            var fullWindowWidth = window.innerWidth;
            if (!fullWindowWidth) {
                // workaround for missing window.innerWidth in IE8
                var documentElementRect = document.documentElement.getBoundingClientRect();
                fullWindowWidth = documentElementRect.right - Math.abs(documentElementRect.left);
            }
            this.bodyIsOverflowing = document.body.clientWidth < fullWindowWidth;
            this.scrollbarWidth = this.measureScrollbar();
        };
        Modal.prototype.setScrollbar = function () {
            var bodyPad = parseInt(this.$body.css('padding-right') || 0, 10);
            this.originalBodyPad = document.body.style.paddingRight || '';
            if (this.bodyIsOverflowing)
                this.$body.css('padding-right', bodyPad + this.scrollbarWidth);
        };
        Modal.prototype.resetScrollbar = function () {
            this.$body.css('padding-right', this.originalBodyPad);
        };
        Modal.prototype.measureScrollbar = function () {
            // thx walsh
            var scrollDiv = document.createElement('div');
            scrollDiv.className = 'modal-scrollbar-measure';
            this.$body.append(scrollDiv);
            var scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;
            this.$body[0].removeChild(scrollDiv);
            return scrollbarWidth;
        };
        // MODAL PLUGIN DEFINITION
        // =======================
        function Plugin(option, _relatedTarget) {
            return this.each(function () {
                var $this = $(this);
                var data = $this.data('bs.modal');
                var options = $.extend({}, Modal.DEFAULTS, $this.data(), typeof option == 'object' && option);
                if (!data)
                    $this.data('bs.modal', data = new Modal(this, options));
                if (typeof option == 'string')
                    data[option](_relatedTarget);
                else if (options.show)
                    data.show(_relatedTarget);
            });
        }
        var old = $.fn.modal;
        $.fn.modal = Plugin;
        $.fn.modal.Constructor = Modal;
        // MODAL NO CONFLICT
        // =================
        $.fn.modal.noConflict = function () {
            $.fn.modal = old;
            return this;
        };
        // MODAL DATA-API
        // ==============
        $(document).on('click.bs.modal.data-api', '[data-toggle="modal"]', function (e) {
            var $this = $(this);
            var href = $this.attr('href');
            var $target = $($this.attr('data-target') || href && href.replace(/.*(?=#[^\s]+$)/, ''));
            // strip for ie7
            var option = $target.data('bs.modal') ? 'toggle' : $.extend({ remote: !/#/.test(href) && href }, $target.data(), $this.data());
            if ($this.is('a'))
                e.preventDefault();
            $target.one('show.bs.modal', function (showEvent) {
                if (showEvent.isDefaultPrevented())
                    return;
                // only register focus restorer if modal will actually get shown
                $target.one('hidden.bs.modal', function () {
                    $this.is(':visible') && $this.trigger('focus');
                });
            });
            Plugin.call($target, option, this);
        });
    }(jQuery);
    /* ========================================================================
 * Bootstrap: tooltip.js v3.3.7
 * http://getbootstrap.com/javascript/#tooltip
 * Inspired by the original jQuery.tipsy by Jason Frame
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
    +function ($) {
        'use strict';
        // TOOLTIP PUBLIC CLASS DEFINITION
        // ===============================
        var Tooltip = function (element, options) {
            this.type = null;
            this.options = null;
            this.enabled = null;
            this.timeout = null;
            this.hoverState = null;
            this.$element = null;
            this.inState = null;
            this.init('tooltip', element, options);
        };
        Tooltip.VERSION = '3.3.7';
        Tooltip.TRANSITION_DURATION = 150;
        Tooltip.DEFAULTS = {
            animation: true,
            placement: 'top',
            selector: false,
            template: '<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',
            trigger: 'hover focus',
            title: '',
            delay: 0,
            html: false,
            container: false,
            viewport: {
                selector: 'body',
                padding: 0
            }
        };
        Tooltip.prototype.init = function (type, element, options) {
            this.enabled = true;
            this.type = type;
            this.$element = $(element);
            this.options = this.getOptions(options);
            this.$viewport = this.options.viewport && $($.isFunction(this.options.viewport) ? this.options.viewport.call(this, this.$element) : this.options.viewport.selector || this.options.viewport);
            this.inState = {
                click: false,
                hover: false,
                focus: false
            };
            if (this.$element[0] instanceof document.constructor && !this.options.selector) {
                throw new Error('`selector` option must be specified when initializing ' + this.type + ' on the window.document object!');
            }
            var triggers = this.options.trigger.split(' ');
            for (var i = triggers.length; i--;) {
                var trigger = triggers[i];
                if (trigger == 'click') {
                    this.$element.on('click.' + this.type, this.options.selector, $.proxy(this.toggle, this));
                } else if (trigger != 'manual') {
                    var eventIn = trigger == 'hover' ? 'mouseenter' : 'focusin';
                    var eventOut = trigger == 'hover' ? 'mouseleave' : 'focusout';
                    this.$element.on(eventIn + '.' + this.type, this.options.selector, $.proxy(this.enter, this));
                    this.$element.on(eventOut + '.' + this.type, this.options.selector, $.proxy(this.leave, this));
                }
            }
            this.options.selector ? this._options = $.extend({}, this.options, {
                trigger: 'manual',
                selector: ''
            }) : this.fixTitle();
        };
        Tooltip.prototype.getDefaults = function () {
            return Tooltip.DEFAULTS;
        };
        Tooltip.prototype.getOptions = function (options) {
            options = $.extend({}, this.getDefaults(), this.$element.data(), options);
            if (options.delay && typeof options.delay == 'number') {
                options.delay = {
                    show: options.delay,
                    hide: options.delay
                };
            }
            return options;
        };
        Tooltip.prototype.getDelegateOptions = function () {
            var options = {};
            var defaults = this.getDefaults();
            this._options && $.each(this._options, function (key, value) {
                if (defaults[key] != value)
                    options[key] = value;
            });
            return options;
        };
        Tooltip.prototype.enter = function (obj) {
            var self = obj instanceof this.constructor ? obj : $(obj.currentTarget).data('bs.' + this.type);
            if (!self) {
                self = new this.constructor(obj.currentTarget, this.getDelegateOptions());
                $(obj.currentTarget).data('bs.' + this.type, self);
            }
            if (obj instanceof $.Event) {
                self.inState[obj.type == 'focusin' ? 'focus' : 'hover'] = true;
            }
            if (self.tip().hasClass('in') || self.hoverState == 'in') {
                self.hoverState = 'in';
                return;
            }
            clearTimeout(self.timeout);
            self.hoverState = 'in';
            if (!self.options.delay || !self.options.delay.show)
                return self.show();
            self.timeout = setTimeout(function () {
                if (self.hoverState == 'in')
                    self.show();
            }, self.options.delay.show);
        };
        Tooltip.prototype.isInStateTrue = function () {
            for (var key in this.inState) {
                if (this.inState[key])
                    return true;
            }
            return false;
        };
        Tooltip.prototype.leave = function (obj) {
            var self = obj instanceof this.constructor ? obj : $(obj.currentTarget).data('bs.' + this.type);
            if (!self) {
                self = new this.constructor(obj.currentTarget, this.getDelegateOptions());
                $(obj.currentTarget).data('bs.' + this.type, self);
            }
            if (obj instanceof $.Event) {
                self.inState[obj.type == 'focusout' ? 'focus' : 'hover'] = false;
            }
            if (self.isInStateTrue())
                return;
            clearTimeout(self.timeout);
            self.hoverState = 'out';
            if (!self.options.delay || !self.options.delay.hide)
                return self.hide();
            self.timeout = setTimeout(function () {
                if (self.hoverState == 'out')
                    self.hide();
            }, self.options.delay.hide);
        };
        Tooltip.prototype.show = function () {
            var e = $.Event('show.bs.' + this.type);
            if (this.hasContent() && this.enabled) {
                this.$element.trigger(e);
                var inDom = $.contains(this.$element[0].ownerDocument.documentElement, this.$element[0]);
                if (e.isDefaultPrevented() || !inDom)
                    return;
                var that = this;
                var $tip = this.tip();
                var tipId = this.getUID(this.type);
                this.setContent();
                $tip.attr('id', tipId);
                this.$element.attr('aria-describedby', tipId);
                if (this.options.animation)
                    $tip.addClass('fade');
                var placement = typeof this.options.placement == 'function' ? this.options.placement.call(this, $tip[0], this.$element[0]) : this.options.placement;
                var autoToken = /\s?auto?\s?/i;
                var autoPlace = autoToken.test(placement);
                if (autoPlace)
                    placement = placement.replace(autoToken, '') || 'top';
                $tip.detach().css({
                    top: 0,
                    left: 0,
                    display: 'block'
                }).addClass(placement).data('bs.' + this.type, this);
                this.options.container ? $tip.appendTo(this.options.container) : $tip.insertAfter(this.$element);
                this.$element.trigger('inserted.bs.' + this.type);
                var pos = this.getPosition();
                var actualWidth = $tip[0].offsetWidth;
                var actualHeight = $tip[0].offsetHeight;
                if (autoPlace) {
                    var orgPlacement = placement;
                    var viewportDim = this.getPosition(this.$viewport);
                    placement = placement == 'bottom' && pos.bottom + actualHeight > viewportDim.bottom ? 'top' : placement == 'top' && pos.top - actualHeight < viewportDim.top ? 'bottom' : placement == 'right' && pos.right + actualWidth > viewportDim.width ? 'left' : placement == 'left' && pos.left - actualWidth < viewportDim.left ? 'right' : placement;
                    $tip.removeClass(orgPlacement).addClass(placement);
                }
                var calculatedOffset = this.getCalculatedOffset(placement, pos, actualWidth, actualHeight);
                this.applyPlacement(calculatedOffset, placement);
                var complete = function () {
                    var prevHoverState = that.hoverState;
                    that.$element.trigger('shown.bs.' + that.type);
                    that.hoverState = null;
                    if (prevHoverState == 'out')
                        that.leave(that);
                };
                $.support.transition && this.$tip.hasClass('fade') ? $tip.one('bsTransitionEnd', complete).emulateTransitionEnd(Tooltip.TRANSITION_DURATION) : complete();
            }
        };
        Tooltip.prototype.applyPlacement = function (offset, placement) {
            var $tip = this.tip();
            var width = $tip[0].offsetWidth;
            var height = $tip[0].offsetHeight;
            // manually read margins because getBoundingClientRect includes difference
            var marginTop = parseInt($tip.css('margin-top'), 10);
            var marginLeft = parseInt($tip.css('margin-left'), 10);
            // we must check for NaN for ie 8/9
            if (isNaN(marginTop))
                marginTop = 0;
            if (isNaN(marginLeft))
                marginLeft = 0;
            offset.top += marginTop;
            offset.left += marginLeft;
            // $.fn.offset doesn't round pixel values
            // so we use setOffset directly with our own function B-0
            $.offset.setOffset($tip[0], $.extend({
                using: function (props) {
                    $tip.css({
                        top: Math.round(props.top),
                        left: Math.round(props.left)
                    });
                }
            }, offset), 0);
            $tip.addClass('in');
            // check to see if placing tip in new offset caused the tip to resize itself
            var actualWidth = $tip[0].offsetWidth;
            var actualHeight = $tip[0].offsetHeight;
            if (placement == 'top' && actualHeight != height) {
                offset.top = offset.top + height - actualHeight;
            }
            var delta = this.getViewportAdjustedDelta(placement, offset, actualWidth, actualHeight);
            if (delta.left)
                offset.left += delta.left;
            else
                offset.top += delta.top;
            var isVertical = /top|bottom/.test(placement);
            var arrowDelta = isVertical ? delta.left * 2 - width + actualWidth : delta.top * 2 - height + actualHeight;
            var arrowOffsetPosition = isVertical ? 'offsetWidth' : 'offsetHeight';
            $tip.offset(offset);
            this.replaceArrow(arrowDelta, $tip[0][arrowOffsetPosition], isVertical);
        };
        Tooltip.prototype.replaceArrow = function (delta, dimension, isVertical) {
            this.arrow().css(isVertical ? 'left' : 'top', 50 * (1 - delta / dimension) + '%').css(isVertical ? 'top' : 'left', '');
        };
        Tooltip.prototype.setContent = function () {
            var $tip = this.tip();
            var title = this.getTitle();
            $tip.find('.tooltip-inner')[this.options.html ? 'html' : 'text'](title);
            $tip.removeClass('fade in top bottom left right');
        };
        Tooltip.prototype.hide = function (callback) {
            var that = this;
            var $tip = $(this.$tip);
            var e = $.Event('hide.bs.' + this.type);
            function complete() {
                if (that.hoverState != 'in')
                    $tip.detach();
                if (that.$element) {
                    // TODO: Check whether guarding this code with this `if` is really necessary.
                    that.$element.removeAttr('aria-describedby').trigger('hidden.bs.' + that.type);
                }
                callback && callback();
            }
            this.$element.trigger(e);
            if (e.isDefaultPrevented())
                return;
            $tip.removeClass('in');
            $.support.transition && $tip.hasClass('fade') ? $tip.one('bsTransitionEnd', complete).emulateTransitionEnd(Tooltip.TRANSITION_DURATION) : complete();
            this.hoverState = null;
            return this;
        };
        Tooltip.prototype.fixTitle = function () {
            var $e = this.$element;
            if ($e.attr('title') || typeof $e.attr('data-original-title') != 'string') {
                $e.attr('data-original-title', $e.attr('title') || '').attr('title', '');
            }
        };
        Tooltip.prototype.hasContent = function () {
            return this.getTitle();
        };
        Tooltip.prototype.getPosition = function ($element) {
            $element = $element || this.$element;
            var el = $element[0];
            var isBody = el.tagName == 'BODY';
            var elRect = el.getBoundingClientRect();
            if (elRect.width == null) {
                // width and height are missing in IE8, so compute them manually; see https://github.com/twbs/bootstrap/issues/14093
                elRect = $.extend({}, elRect, {
                    width: elRect.right - elRect.left,
                    height: elRect.bottom - elRect.top
                });
            }
            var isSvg = window.SVGElement && el instanceof window.SVGElement;
            // Avoid using $.offset() on SVGs since it gives incorrect results in jQuery 3.
            // See https://github.com/twbs/bootstrap/issues/20280
            var elOffset = isBody ? {
                top: 0,
                left: 0
            } : isSvg ? null : $element.offset();
            var scroll = { scroll: isBody ? document.documentElement.scrollTop || document.body.scrollTop : $element.scrollTop() };
            var outerDims = isBody ? {
                width: $(window).width(),
                height: $(window).height()
            } : null;
            return $.extend({}, elRect, scroll, outerDims, elOffset);
        };
        Tooltip.prototype.getCalculatedOffset = function (placement, pos, actualWidth, actualHeight) {
            return placement == 'bottom' ? {
                top: pos.top + pos.height,
                left: pos.left + pos.width / 2 - actualWidth / 2
            } : placement == 'top' ? {
                top: pos.top - actualHeight,
                left: pos.left + pos.width / 2 - actualWidth / 2
            } : placement == 'left' ? {
                top: pos.top + pos.height / 2 - actualHeight / 2,
                left: pos.left - actualWidth
            } : /* placement == 'right' */
            {
                top: pos.top + pos.height / 2 - actualHeight / 2,
                left: pos.left + pos.width
            };
        };
        Tooltip.prototype.getViewportAdjustedDelta = function (placement, pos, actualWidth, actualHeight) {
            var delta = {
                top: 0,
                left: 0
            };
            if (!this.$viewport)
                return delta;
            var viewportPadding = this.options.viewport && this.options.viewport.padding || 0;
            var viewportDimensions = this.getPosition(this.$viewport);
            if (/right|left/.test(placement)) {
                var topEdgeOffset = pos.top - viewportPadding - viewportDimensions.scroll;
                var bottomEdgeOffset = pos.top + viewportPadding - viewportDimensions.scroll + actualHeight;
                if (topEdgeOffset < viewportDimensions.top) {
                    // top overflow
                    delta.top = viewportDimensions.top - topEdgeOffset;
                } else if (bottomEdgeOffset > viewportDimensions.top + viewportDimensions.height) {
                    // bottom overflow
                    delta.top = viewportDimensions.top + viewportDimensions.height - bottomEdgeOffset;
                }
            } else {
                var leftEdgeOffset = pos.left - viewportPadding;
                var rightEdgeOffset = pos.left + viewportPadding + actualWidth;
                if (leftEdgeOffset < viewportDimensions.left) {
                    // left overflow
                    delta.left = viewportDimensions.left - leftEdgeOffset;
                } else if (rightEdgeOffset > viewportDimensions.right) {
                    // right overflow
                    delta.left = viewportDimensions.left + viewportDimensions.width - rightEdgeOffset;
                }
            }
            return delta;
        };
        Tooltip.prototype.getTitle = function () {
            var title;
            var $e = this.$element;
            var o = this.options;
            title = $e.attr('data-original-title') || (typeof o.title == 'function' ? o.title.call($e[0]) : o.title);
            return title;
        };
        Tooltip.prototype.getUID = function (prefix) {
            do
                prefix += ~~(Math.random() * 1000000);
            while (document.getElementById(prefix));
            return prefix;
        };
        Tooltip.prototype.tip = function () {
            if (!this.$tip) {
                this.$tip = $(this.options.template);
                if (this.$tip.length != 1) {
                    throw new Error(this.type + ' `template` option must consist of exactly 1 top-level element!');
                }
            }
            return this.$tip;
        };
        Tooltip.prototype.arrow = function () {
            return this.$arrow = this.$arrow || this.tip().find('.tooltip-arrow');
        };
        Tooltip.prototype.enable = function () {
            this.enabled = true;
        };
        Tooltip.prototype.disable = function () {
            this.enabled = false;
        };
        Tooltip.prototype.toggleEnabled = function () {
            this.enabled = !this.enabled;
        };
        Tooltip.prototype.toggle = function (e) {
            var self = this;
            if (e) {
                self = $(e.currentTarget).data('bs.' + this.type);
                if (!self) {
                    self = new this.constructor(e.currentTarget, this.getDelegateOptions());
                    $(e.currentTarget).data('bs.' + this.type, self);
                }
            }
            if (e) {
                self.inState.click = !self.inState.click;
                if (self.isInStateTrue())
                    self.enter(self);
                else
                    self.leave(self);
            } else {
                self.tip().hasClass('in') ? self.leave(self) : self.enter(self);
            }
        };
        Tooltip.prototype.destroy = function () {
            var that = this;
            clearTimeout(this.timeout);
            this.hide(function () {
                that.$element.off('.' + that.type).removeData('bs.' + that.type);
                if (that.$tip) {
                    that.$tip.detach();
                }
                that.$tip = null;
                that.$arrow = null;
                that.$viewport = null;
                that.$element = null;
            });
        };
        // TOOLTIP PLUGIN DEFINITION
        // =========================
        function Plugin(option) {
            return this.each(function () {
                var $this = $(this);
                var data = $this.data('bs.tooltip');
                var options = typeof option == 'object' && option;
                if (!data && /destroy|hide/.test(option))
                    return;
                if (!data)
                    $this.data('bs.tooltip', data = new Tooltip(this, options));
                if (typeof option == 'string')
                    data[option]();
            });
        }
        var old = $.fn.tooltip;
        $.fn.tooltip = Plugin;
        $.fn.tooltip.Constructor = Tooltip;
        // TOOLTIP NO CONFLICT
        // ===================
        $.fn.tooltip.noConflict = function () {
            $.fn.tooltip = old;
            return this;
        };
    }(jQuery);
    /* ========================================================================
 * Bootstrap: popover.js v3.3.7
 * http://getbootstrap.com/javascript/#popovers
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
    +function ($) {
        'use strict';
        // POPOVER PUBLIC CLASS DEFINITION
        // ===============================
        var Popover = function (element, options) {
            this.init('popover', element, options);
        };
        if (!$.fn.tooltip)
            throw new Error('Popover requires tooltip.js');
        Popover.VERSION = '3.3.7';
        Popover.DEFAULTS = $.extend({}, $.fn.tooltip.Constructor.DEFAULTS, {
            placement: 'right',
            trigger: 'click',
            content: '',
            template: '<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'
        });
        // NOTE: POPOVER EXTENDS tooltip.js
        // ================================
        Popover.prototype = $.extend({}, $.fn.tooltip.Constructor.prototype);
        Popover.prototype.constructor = Popover;
        Popover.prototype.getDefaults = function () {
            return Popover.DEFAULTS;
        };
        Popover.prototype.setContent = function () {
            var $tip = this.tip();
            var title = this.getTitle();
            var content = this.getContent();
            $tip.find('.popover-title')[this.options.html ? 'html' : 'text'](title);
            $tip.find('.popover-content').children().detach().end()[// we use append for html objects to maintain js events
            this.options.html ? typeof content == 'string' ? 'html' : 'append' : 'text'](content);
            $tip.removeClass('fade top bottom left right in');
            // IE8 doesn't accept hiding via the `:empty` pseudo selector, we have to do
            // this manually by checking the contents.
            if (!$tip.find('.popover-title').html())
                $tip.find('.popover-title').hide();
        };
        Popover.prototype.hasContent = function () {
            return this.getTitle() || this.getContent();
        };
        Popover.prototype.getContent = function () {
            var $e = this.$element;
            var o = this.options;
            return $e.attr('data-content') || (typeof o.content == 'function' ? o.content.call($e[0]) : o.content);
        };
        Popover.prototype.arrow = function () {
            return this.$arrow = this.$arrow || this.tip().find('.arrow');
        };
        // POPOVER PLUGIN DEFINITION
        // =========================
        function Plugin(option) {
            return this.each(function () {
                var $this = $(this);
                var data = $this.data('bs.popover');
                var options = typeof option == 'object' && option;
                if (!data && /destroy|hide/.test(option))
                    return;
                if (!data)
                    $this.data('bs.popover', data = new Popover(this, options));
                if (typeof option == 'string')
                    data[option]();
            });
        }
        var old = $.fn.popover;
        $.fn.popover = Plugin;
        $.fn.popover.Constructor = Popover;
        // POPOVER NO CONFLICT
        // ===================
        $.fn.popover.noConflict = function () {
            $.fn.popover = old;
            return this;
        };
    }(jQuery);
    /* ========================================================================
 * Bootstrap: scrollspy.js v3.3.7
 * http://getbootstrap.com/javascript/#scrollspy
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
    +function ($) {
        'use strict';
        // SCROLLSPY CLASS DEFINITION
        // ==========================
        function ScrollSpy(element, options) {
            this.$body = $(document.body);
            this.$scrollElement = $(element).is(document.body) ? $(window) : $(element);
            this.options = $.extend({}, ScrollSpy.DEFAULTS, options);
            this.selector = (this.options.target || '') + ' .nav li > a';
            this.offsets = [];
            this.targets = [];
            this.activeTarget = null;
            this.scrollHeight = 0;
            this.$scrollElement.on('scroll.bs.scrollspy', $.proxy(this.process, this));
            this.refresh();
            this.process();
        }
        ScrollSpy.VERSION = '3.3.7';
        ScrollSpy.DEFAULTS = { offset: 10 };
        ScrollSpy.prototype.getScrollHeight = function () {
            return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight);
        };
        ScrollSpy.prototype.refresh = function () {
            var that = this;
            var offsetMethod = 'offset';
            var offsetBase = 0;
            this.offsets = [];
            this.targets = [];
            this.scrollHeight = this.getScrollHeight();
            if (!$.isWindow(this.$scrollElement[0])) {
                offsetMethod = 'position';
                offsetBase = this.$scrollElement.scrollTop();
            }
            this.$body.find(this.selector).map(function () {
                var $el = $(this);
                var href = $el.data('target') || $el.attr('href');
                var $href = /^#./.test(href) && $(href);
                return $href && $href.length && $href.is(':visible') && [[
                        $href[offsetMethod]().top + offsetBase,
                        href
                    ]] || null;
            }).sort(function (a, b) {
                return a[0] - b[0];
            }).each(function () {
                that.offsets.push(this[0]);
                that.targets.push(this[1]);
            });
        };
        ScrollSpy.prototype.process = function () {
            var scrollTop = this.$scrollElement.scrollTop() + this.options.offset;
            var scrollHeight = this.getScrollHeight();
            var maxScroll = this.options.offset + scrollHeight - this.$scrollElement.height();
            var offsets = this.offsets;
            var targets = this.targets;
            var activeTarget = this.activeTarget;
            var i;
            if (this.scrollHeight != scrollHeight) {
                this.refresh();
            }
            if (scrollTop >= maxScroll) {
                return activeTarget != (i = targets[targets.length - 1]) && this.activate(i);
            }
            if (activeTarget && scrollTop < offsets[0]) {
                this.activeTarget = null;
                return this.clear();
            }
            for (i = offsets.length; i--;) {
                activeTarget != targets[i] && scrollTop >= offsets[i] && (offsets[i + 1] === undefined || scrollTop < offsets[i + 1]) && this.activate(targets[i]);
            }
        };
        ScrollSpy.prototype.activate = function (target) {
            this.activeTarget = target;
            this.clear();
            var selector = this.selector + '[data-target="' + target + '"],' + this.selector + '[href="' + target + '"]';
            var active = $(selector).parents('li').addClass('active');
            if (active.parent('.dropdown-menu').length) {
                active = active.closest('li.dropdown').addClass('active');
            }
            active.trigger('activate.bs.scrollspy');
        };
        ScrollSpy.prototype.clear = function () {
            $(this.selector).parentsUntil(this.options.target, '.active').removeClass('active');
        };
        // SCROLLSPY PLUGIN DEFINITION
        // ===========================
        function Plugin(option) {
            return this.each(function () {
                var $this = $(this);
                var data = $this.data('bs.scrollspy');
                var options = typeof option == 'object' && option;
                if (!data)
                    $this.data('bs.scrollspy', data = new ScrollSpy(this, options));
                if (typeof option == 'string')
                    data[option]();
            });
        }
        var old = $.fn.scrollspy;
        $.fn.scrollspy = Plugin;
        $.fn.scrollspy.Constructor = ScrollSpy;
        // SCROLLSPY NO CONFLICT
        // =====================
        $.fn.scrollspy.noConflict = function () {
            $.fn.scrollspy = old;
            return this;
        };
        // SCROLLSPY DATA-API
        // ==================
        $(window).on('load.bs.scrollspy.data-api', function () {
            $('[data-spy="scroll"]').each(function () {
                var $spy = $(this);
                Plugin.call($spy, $spy.data());
            });
        });
    }(jQuery);
    /* ========================================================================
 * Bootstrap: tab.js v3.3.7
 * http://getbootstrap.com/javascript/#tabs
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
    +function ($) {
        'use strict';
        // TAB CLASS DEFINITION
        // ====================
        var Tab = function (element) {
            // jscs:disable requireDollarBeforejQueryAssignment
            this.element = $(element)    // jscs:enable requireDollarBeforejQueryAssignment
;
        };
        Tab.VERSION = '3.3.7';
        Tab.TRANSITION_DURATION = 150;
        Tab.prototype.show = function () {
            var $this = this.element;
            var $ul = $this.closest('ul:not(.dropdown-menu)');
            var selector = $this.data('target');
            if (!selector) {
                selector = $this.attr('href');
                selector = selector && selector.replace(/.*(?=#[^\s]*$)/, '')    // strip for ie7
;
            }
            if ($this.parent('li').hasClass('active'))
                return;
            var $previous = $ul.find('.active:last a');
            var hideEvent = $.Event('hide.bs.tab', { relatedTarget: $this[0] });
            var showEvent = $.Event('show.bs.tab', { relatedTarget: $previous[0] });
            $previous.trigger(hideEvent);
            $this.trigger(showEvent);
            if (showEvent.isDefaultPrevented() || hideEvent.isDefaultPrevented())
                return;
            var $target = $(selector);
            this.activate($this.closest('li'), $ul);
            this.activate($target, $target.parent(), function () {
                $previous.trigger({
                    type: 'hidden.bs.tab',
                    relatedTarget: $this[0]
                });
                $this.trigger({
                    type: 'shown.bs.tab',
                    relatedTarget: $previous[0]
                });
            });
        };
        Tab.prototype.activate = function (element, container, callback) {
            var $active = container.find('> .active');
            var transition = callback && $.support.transition && ($active.length && $active.hasClass('fade') || !!container.find('> .fade').length);
            function next() {
                $active.removeClass('active').find('> .dropdown-menu > .active').removeClass('active').end().find('[data-toggle="tab"]').attr('aria-expanded', false);
                element.addClass('active').find('[data-toggle="tab"]').attr('aria-expanded', true);
                if (transition) {
                    element[0].offsetWidth;
                    // reflow for transition
                    element.addClass('in');
                } else {
                    element.removeClass('fade');
                }
                if (element.parent('.dropdown-menu').length) {
                    element.closest('li.dropdown').addClass('active').end().find('[data-toggle="tab"]').attr('aria-expanded', true);
                }
                callback && callback();
            }
            $active.length && transition ? $active.one('bsTransitionEnd', next).emulateTransitionEnd(Tab.TRANSITION_DURATION) : next();
            $active.removeClass('in');
        };
        // TAB PLUGIN DEFINITION
        // =====================
        function Plugin(option) {
            return this.each(function () {
                var $this = $(this);
                var data = $this.data('bs.tab');
                if (!data)
                    $this.data('bs.tab', data = new Tab(this));
                if (typeof option == 'string')
                    data[option]();
            });
        }
        var old = $.fn.tab;
        $.fn.tab = Plugin;
        $.fn.tab.Constructor = Tab;
        // TAB NO CONFLICT
        // ===============
        $.fn.tab.noConflict = function () {
            $.fn.tab = old;
            return this;
        };
        // TAB DATA-API
        // ============
        var clickHandler = function (e) {
            e.preventDefault();
            Plugin.call($(this), 'show');
        };
        $(document).on('click.bs.tab.data-api', '[data-toggle="tab"]', clickHandler).on('click.bs.tab.data-api', '[data-toggle="pill"]', clickHandler);
    }(jQuery);
    /* ========================================================================
 * Bootstrap: affix.js v3.3.7
 * http://getbootstrap.com/javascript/#affix
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
    +function ($) {
        'use strict';
        // AFFIX CLASS DEFINITION
        // ======================
        var Affix = function (element, options) {
            this.options = $.extend({}, Affix.DEFAULTS, options);
            this.$target = $(this.options.target).on('scroll.bs.affix.data-api', $.proxy(this.checkPosition, this)).on('click.bs.affix.data-api', $.proxy(this.checkPositionWithEventLoop, this));
            this.$element = $(element);
            this.affixed = null;
            this.unpin = null;
            this.pinnedOffset = null;
            this.checkPosition();
        };
        Affix.VERSION = '3.3.7';
        Affix.RESET = 'affix affix-top affix-bottom';
        Affix.DEFAULTS = {
            offset: 0,
            target: window
        };
        Affix.prototype.getState = function (scrollHeight, height, offsetTop, offsetBottom) {
            var scrollTop = this.$target.scrollTop();
            var position = this.$element.offset();
            var targetHeight = this.$target.height();
            if (offsetTop != null && this.affixed == 'top')
                return scrollTop < offsetTop ? 'top' : false;
            if (this.affixed == 'bottom') {
                if (offsetTop != null)
                    return scrollTop + this.unpin <= position.top ? false : 'bottom';
                return scrollTop + targetHeight <= scrollHeight - offsetBottom ? false : 'bottom';
            }
            var initializing = this.affixed == null;
            var colliderTop = initializing ? scrollTop : position.top;
            var colliderHeight = initializing ? targetHeight : height;
            if (offsetTop != null && scrollTop <= offsetTop)
                return 'top';
            if (offsetBottom != null && colliderTop + colliderHeight >= scrollHeight - offsetBottom)
                return 'bottom';
            return false;
        };
        Affix.prototype.getPinnedOffset = function () {
            if (this.pinnedOffset)
                return this.pinnedOffset;
            this.$element.removeClass(Affix.RESET).addClass('affix');
            var scrollTop = this.$target.scrollTop();
            var position = this.$element.offset();
            return this.pinnedOffset = position.top - scrollTop;
        };
        Affix.prototype.checkPositionWithEventLoop = function () {
            setTimeout($.proxy(this.checkPosition, this), 1);
        };
        Affix.prototype.checkPosition = function () {
            if (!this.$element.is(':visible'))
                return;
            var height = this.$element.height();
            var offset = this.options.offset;
            var offsetTop = offset.top;
            var offsetBottom = offset.bottom;
            var scrollHeight = Math.max($(document).height(), $(document.body).height());
            if (typeof offset != 'object')
                offsetBottom = offsetTop = offset;
            if (typeof offsetTop == 'function')
                offsetTop = offset.top(this.$element);
            if (typeof offsetBottom == 'function')
                offsetBottom = offset.bottom(this.$element);
            var affix = this.getState(scrollHeight, height, offsetTop, offsetBottom);
            if (this.affixed != affix) {
                if (this.unpin != null)
                    this.$element.css('top', '');
                var affixType = 'affix' + (affix ? '-' + affix : '');
                var e = $.Event(affixType + '.bs.affix');
                this.$element.trigger(e);
                if (e.isDefaultPrevented())
                    return;
                this.affixed = affix;
                this.unpin = affix == 'bottom' ? this.getPinnedOffset() : null;
                this.$element.removeClass(Affix.RESET).addClass(affixType).trigger(affixType.replace('affix', 'affixed') + '.bs.affix');
            }
            if (affix == 'bottom') {
                this.$element.offset({ top: scrollHeight - height - offsetBottom });
            }
        };
        // AFFIX PLUGIN DEFINITION
        // =======================
        function Plugin(option) {
            return this.each(function () {
                var $this = $(this);
                var data = $this.data('bs.affix');
                var options = typeof option == 'object' && option;
                if (!data)
                    $this.data('bs.affix', data = new Affix(this, options));
                if (typeof option == 'string')
                    data[option]();
            });
        }
        var old = $.fn.affix;
        $.fn.affix = Plugin;
        $.fn.affix.Constructor = Affix;
        // AFFIX NO CONFLICT
        // =================
        $.fn.affix.noConflict = function () {
            $.fn.affix = old;
            return this;
        };
        // AFFIX DATA-API
        // ==============
        $(window).on('load', function () {
            $('[data-spy="affix"]').each(function () {
                var $spy = $(this);
                var data = $spy.data();
                data.offset = data.offset || {};
                if (data.offsetBottom != null)
                    data.offset.bottom = data.offsetBottom;
                if (data.offsetTop != null)
                    data.offset.top = data.offsetTop;
                Plugin.call($spy, data);
            });
        });
    }(jQuery);
    return;
});
/* =========================================================
 * bootstrap-datepicker.js
 * Repo: https://github.com/eternicode/bootstrap-datepicker/
 * Demo: http://eternicode.github.io/bootstrap-datepicker/
 * Docs: http://bootstrap-datepicker.readthedocs.org/
 * Forked from http://www.eyecon.ro/bootstrap-datepicker
 * =========================================================
 * Started by Stefan Petre; improvements by Andrew Rowls + contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================= */
define('bootstrap-datepicker', [
    'jQuery',
    'bootstrap'
], function () {
    (function ($, undefined) {
        var $window = $(window);
        function UTCDate() {
            return new Date(Date.UTC.apply(Date, arguments));
        }
        function UTCToday() {
            var today = new Date();
            return UTCDate(today.getFullYear(), today.getMonth(), today.getDate());
        }
        function alias(method) {
            return function () {
                return this[method].apply(this, arguments);
            };
        }
        var DateArray = function () {
            var extras = {
                get: function (i) {
                    return this.slice(i)[0];
                },
                contains: function (d) {
                    // Array.indexOf is not cross-browser;
                    // $.inArray doesn't work with Dates
                    var val = d && d.valueOf();
                    for (var i = 0, l = this.length; i < l; i++)
                        if (this[i].valueOf() === val)
                            return i;
                    return -1;
                },
                remove: function (i) {
                    this.splice(i, 1);
                },
                replace: function (new_array) {
                    if (!new_array)
                        return;
                    if (!$.isArray(new_array))
                        new_array = [new_array];
                    this.clear();
                    this.push.apply(this, new_array);
                },
                clear: function () {
                    this.length = 0;
                },
                copy: function () {
                    var a = new DateArray();
                    a.replace(this);
                    return a;
                }
            };
            return function () {
                var a = [];
                a.push.apply(a, arguments);
                $.extend(a, extras);
                return a;
            };
        }();
        // Picker object
        var Datepicker = function (element, options) {
            this.dates = new DateArray();
            this.viewDate = UTCToday();
            this.focusDate = null;
            this._process_options(options);
            this.element = $(element);
            this.isInline = false;
            this.isInput = this.element.is('input');
            this.component = this.element.is('.date') ? this.element.find('.add-on, .input-group-addon, .btn') : false;
            this.hasInput = this.component && this.element.find('input').length;
            if (this.component && this.component.length === 0)
                this.component = false;
            this.picker = $(DPGlobal.template);
            this._buildEvents();
            this._attachEvents();
            if (this.isInline) {
                this.picker.addClass('datepicker-inline').appendTo(this.element);
            } else {
                this.picker.addClass('datepicker-dropdown dropdown-menu');
            }
            if (this.o.rtl) {
                this.picker.addClass('datepicker-rtl');
            }
            this.viewMode = this.o.startView;
            if (this.o.calendarWeeks)
                this.picker.find('tfoot th.today, tfoot th.clear').attr('colspan', function (i, val) {
                    return parseInt(val) + 1;
                });
            this._allow_update = false;
            this.setStartDate(this._o.startDate);
            this.setEndDate(this._o.endDate);
            this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled);
            this.fillDow();
            this.fillMonths();
            this._allow_update = true;
            this.update();
            this.showMode();
            if (this.isInline) {
                this.show();
            }
        };
        Datepicker.prototype = {
            constructor: Datepicker,
            _process_options: function (opts) {
                // Store raw options for reference
                this._o = $.extend({}, this._o, opts);
                // Processed options
                var o = this.o = $.extend({}, this._o);
                // Check if "de-DE" style date is available, if not language should
                // fallback to 2 letter code eg "de"
                var lang = o.language;
                if (!dates[lang]) {
                    lang = lang.split('-')[0];
                    if (!dates[lang])
                        lang = defaults.language;
                }
                o.language = lang;
                switch (o.startView) {
                case 2:
                case 'decade':
                    o.startView = 2;
                    break;
                case 1:
                case 'year':
                    o.startView = 1;
                    break;
                default:
                    o.startView = 0;
                }
                switch (o.minViewMode) {
                case 1:
                case 'months':
                    o.minViewMode = 1;
                    break;
                case 2:
                case 'years':
                    o.minViewMode = 2;
                    break;
                default:
                    o.minViewMode = 0;
                }
                o.startView = Math.max(o.startView, o.minViewMode);
                // true, false, or Number > 0
                if (o.multidate !== true) {
                    o.multidate = Number(o.multidate) || false;
                    if (o.multidate !== false)
                        o.multidate = Math.max(0, o.multidate);
                    else
                        o.multidate = 1;
                }
                o.multidateSeparator = String(o.multidateSeparator);
                o.weekStart %= 7;
                o.weekEnd = (o.weekStart + 6) % 7;
                var format = DPGlobal.parseFormat(o.format);
                if (o.startDate !== -Infinity) {
                    if (!!o.startDate) {
                        if (o.startDate instanceof Date)
                            o.startDate = this._local_to_utc(this._zero_time(o.startDate));
                        else
                            o.startDate = DPGlobal.parseDate(o.startDate, format, o.language);
                    } else {
                        o.startDate = -Infinity;
                    }
                }
                if (o.endDate !== Infinity) {
                    if (!!o.endDate) {
                        if (o.endDate instanceof Date)
                            o.endDate = this._local_to_utc(this._zero_time(o.endDate));
                        else
                            o.endDate = DPGlobal.parseDate(o.endDate, format, o.language);
                    } else {
                        o.endDate = Infinity;
                    }
                }
                o.daysOfWeekDisabled = o.daysOfWeekDisabled || [];
                if (!$.isArray(o.daysOfWeekDisabled))
                    o.daysOfWeekDisabled = o.daysOfWeekDisabled.split(/[,\s]*/);
                o.daysOfWeekDisabled = $.map(o.daysOfWeekDisabled, function (d) {
                    return parseInt(d, 10);
                });
                var plc = String(o.orientation).toLowerCase().split(/\s+/g), _plc = o.orientation.toLowerCase();
                plc = $.grep(plc, function (word) {
                    return /^auto|left|right|top|bottom$/.test(word);
                });
                o.orientation = {
                    x: 'auto',
                    y: 'auto'
                };
                if (!_plc || _plc === 'auto');
                else if (plc.length === 1) {
                    switch (plc[0]) {
                    case 'top':
                    case 'bottom':
                        o.orientation.y = plc[0];
                        break;
                    case 'left':
                    case 'right':
                        o.orientation.x = plc[0];
                        break;
                    }
                } else {
                    _plc = $.grep(plc, function (word) {
                        return /^left|right$/.test(word);
                    });
                    o.orientation.x = _plc[0] || 'auto';
                    _plc = $.grep(plc, function (word) {
                        return /^top|bottom$/.test(word);
                    });
                    o.orientation.y = _plc[0] || 'auto';
                }
            },
            _events: [],
            _secondaryEvents: [],
            _applyEvents: function (evs) {
                for (var i = 0, el, ch, ev; i < evs.length; i++) {
                    el = evs[i][0];
                    if (evs[i].length === 2) {
                        ch = undefined;
                        ev = evs[i][1];
                    } else if (evs[i].length === 3) {
                        ch = evs[i][1];
                        ev = evs[i][2];
                    }
                    el.on(ev, ch);
                }
            },
            _unapplyEvents: function (evs) {
                for (var i = 0, el, ev, ch; i < evs.length; i++) {
                    el = evs[i][0];
                    if (evs[i].length === 2) {
                        ch = undefined;
                        ev = evs[i][1];
                    } else if (evs[i].length === 3) {
                        ch = evs[i][1];
                        ev = evs[i][2];
                    }
                    el.off(ev, ch);
                }
            },
            _buildEvents: function () {
                if (this.isInput) {
                    // single input
                    this._events = [[
                            this.element,
                            {
                                focus: $.proxy(this.show, this),
                                keyup: $.proxy(function (e) {
                                    if ($.inArray(e.keyCode, [
                                            27,
                                            37,
                                            39,
                                            38,
                                            40,
                                            32,
                                            13,
                                            9
                                        ]) === -1)
                                        this.update();
                                }, this),
                                keydown: $.proxy(this.keydown, this)
                            }
                        ]];
                } else if (this.component && this.hasInput) {
                    // component: input + button
                    this._events = [
                        // For components that are not readonly, allow keyboard nav
                        [
                            this.element.find('input'),
                            {
                                focus: $.proxy(this.show, this),
                                keyup: $.proxy(function (e) {
                                    if ($.inArray(e.keyCode, [
                                            27,
                                            37,
                                            39,
                                            38,
                                            40,
                                            32,
                                            13,
                                            9
                                        ]) === -1)
                                        this.update();
                                }, this),
                                keydown: $.proxy(this.keydown, this)
                            }
                        ],
                        [
                            this.component,
                            { click: $.proxy(this.show, this) }
                        ]
                    ];
                } else if (this.element.is('div')) {
                    // inline datepicker
                    this.isInline = true;
                } else {
                    this._events = [[
                            this.element,
                            { click: $.proxy(this.show, this) }
                        ]];
                }
                this._events.push(// Component: listen for blur on element descendants
                [
                    this.element,
                    '*',
                    {
                        blur: $.proxy(function (e) {
                            this._focused_from = e.target;
                        }, this)
                    }
                ], // Input: listen for blur on element
                [
                    this.element,
                    {
                        blur: $.proxy(function (e) {
                            this._focused_from = e.target;
                        }, this)
                    }
                ]);
                this._secondaryEvents = [
                    [
                        this.picker,
                        { click: $.proxy(this.click, this) }
                    ],
                    [
                        $(window),
                        { resize: $.proxy(this.place, this) }
                    ],
                    [
                        $(document),
                        {
                            'mousedown touchstart': $.proxy(function (e) {
                                // Clicked outside the datepicker, hide it
                                if (!(this.element.is(e.target) || this.element.find(e.target).length || this.picker.is(e.target) || this.picker.find(e.target).length)) {
                                    this.hide();
                                }
                            }, this)
                        }
                    ]
                ];
            },
            _attachEvents: function () {
                this._detachEvents();
                this._applyEvents(this._events);
            },
            _detachEvents: function () {
                this._unapplyEvents(this._events);
            },
            _attachSecondaryEvents: function () {
                this._detachSecondaryEvents();
                this._applyEvents(this._secondaryEvents);
            },
            _detachSecondaryEvents: function () {
                this._unapplyEvents(this._secondaryEvents);
            },
            _trigger: function (event, altdate) {
                var date = altdate || this.dates.get(-1), local_date = this._utc_to_local(date);
                this.element.trigger({
                    type: event,
                    date: local_date,
                    dates: $.map(this.dates, this._utc_to_local),
                    format: $.proxy(function (ix, format) {
                        if (arguments.length === 0) {
                            ix = this.dates.length - 1;
                            format = this.o.format;
                        } else if (typeof ix === 'string') {
                            format = ix;
                            ix = this.dates.length - 1;
                        }
                        format = format || this.o.format;
                        var date = this.dates.get(ix);
                        return DPGlobal.formatDate(date, format, this.o.language);
                    }, this)
                });
            },
            show: function () {
                if (!this.isInline)
                    this.picker.appendTo('body');
                this.picker.show();
                this.place();
                this._attachSecondaryEvents();
                this._trigger('show');
            },
            hide: function () {
                if (this.isInline)
                    return;
                if (!this.picker.is(':visible'))
                    return;
                this.focusDate = null;
                this.picker.hide().detach();
                this._detachSecondaryEvents();
                this.viewMode = this.o.startView;
                this.showMode();
                if (this.o.forceParse && (this.isInput && this.element.val() || this.hasInput && this.element.find('input').val()))
                    this.setValue();
                this._trigger('hide');
            },
            remove: function () {
                this.hide();
                this._detachEvents();
                this._detachSecondaryEvents();
                this.picker.remove();
                delete this.element.data().datepicker;
                if (!this.isInput) {
                    delete this.element.data().date;
                }
            },
            _utc_to_local: function (utc) {
                return utc && new Date(utc.getTime() + utc.getTimezoneOffset() * 60000);
            },
            _local_to_utc: function (local) {
                return local && new Date(local.getTime() - local.getTimezoneOffset() * 60000);
            },
            _zero_time: function (local) {
                return local && new Date(local.getFullYear(), local.getMonth(), local.getDate());
            },
            _zero_utc_time: function (utc) {
                return utc && new Date(Date.UTC(utc.getUTCFullYear(), utc.getUTCMonth(), utc.getUTCDate()));
            },
            getDates: function () {
                return $.map(this.dates, this._utc_to_local);
            },
            getUTCDates: function () {
                return $.map(this.dates, function (d) {
                    return new Date(d);
                });
            },
            getDate: function () {
                return this._utc_to_local(this.getUTCDate());
            },
            getUTCDate: function () {
                return new Date(this.dates.get(-1));
            },
            setDates: function () {
                var args = $.isArray(arguments[0]) ? arguments[0] : arguments;
                this.update.apply(this, args);
                this._trigger('changeDate');
                this.setValue();
            },
            setUTCDates: function () {
                var args = $.isArray(arguments[0]) ? arguments[0] : arguments;
                this.update.apply(this, $.map(args, this._utc_to_local));
                this._trigger('changeDate');
                this.setValue();
            },
            setDate: alias('setDates'),
            setUTCDate: alias('setUTCDates'),
            setValue: function () {
                var formatted = this.getFormattedDate();
                if (!this.isInput) {
                    if (this.component) {
                        this.element.find('input').val(formatted).change();
                    }
                } else {
                    this.element.val(formatted).change();
                }
            },
            getFormattedDate: function (format) {
                if (format === undefined)
                    format = this.o.format;
                var lang = this.o.language;
                return $.map(this.dates, function (d) {
                    return DPGlobal.formatDate(d, format, lang);
                }).join(this.o.multidateSeparator);
            },
            setStartDate: function (startDate) {
                this._process_options({ startDate: startDate });
                this.update();
                this.updateNavArrows();
            },
            setEndDate: function (endDate) {
                this._process_options({ endDate: endDate });
                this.update();
                this.updateNavArrows();
            },
            setDaysOfWeekDisabled: function (daysOfWeekDisabled) {
                this._process_options({ daysOfWeekDisabled: daysOfWeekDisabled });
                this.update();
                this.updateNavArrows();
            },
            place: function () {
                if (this.isInline)
                    return;
                var calendarWidth = this.picker.outerWidth(), calendarHeight = this.picker.outerHeight(), visualPadding = 10, windowWidth = $window.width(), windowHeight = $window.height(), scrollTop = $window.scrollTop();
                var parentsZindex = [];
                this.element.parents().each(function () {
                    var itemZIndex = $(this).css('z-index');
                    if (itemZIndex !== 'auto' && itemZIndex !== 0)
                        parentsZindex.push(parseInt(itemZIndex));
                });
                var zIndex = Math.max.apply(Math, parentsZindex) + 10;
                var offset = this.component ? this.component.parent().offset() : this.element.offset();
                var height = this.component ? this.component.outerHeight(true) : this.element.outerHeight(false);
                var width = this.component ? this.component.outerWidth(true) : this.element.outerWidth(false);
                var left = offset.left, top = offset.top;
                this.picker.removeClass('datepicker-orient-top datepicker-orient-bottom ' + 'datepicker-orient-right datepicker-orient-left');
                if (this.o.orientation.x !== 'auto') {
                    this.picker.addClass('datepicker-orient-' + this.o.orientation.x);
                    if (this.o.orientation.x === 'right')
                        left -= calendarWidth - width;
                }    // auto x orientation is best-placement: if it crosses a window
                     // edge, fudge it sideways
                else {
                    // Default to left
                    this.picker.addClass('datepicker-orient-left');
                    if (offset.left < 0)
                        left -= offset.left - visualPadding;
                    else if (offset.left + calendarWidth > windowWidth)
                        left = windowWidth - calendarWidth - visualPadding;
                }
                // auto y orientation is best-situation: top or bottom, no fudging,
                // decision based on which shows more of the calendar
                var yorient = this.o.orientation.y, top_overflow, bottom_overflow;
                if (yorient === 'auto') {
                    top_overflow = -scrollTop + offset.top - calendarHeight;
                    bottom_overflow = scrollTop + windowHeight - (offset.top + height + calendarHeight);
                    if (Math.max(top_overflow, bottom_overflow) === bottom_overflow)
                        yorient = 'top';
                    else
                        yorient = 'bottom';
                }
                this.picker.addClass('datepicker-orient-' + yorient);
                if (yorient === 'top')
                    top += height;
                else
                    top -= calendarHeight + parseInt(this.picker.css('padding-top'));
                this.picker.css({
                    top: top,
                    left: left,
                    zIndex: zIndex
                });
            },
            _allow_update: true,
            update: function () {
                if (!this._allow_update)
                    return;
                var oldDates = this.dates.copy(), dates = [], fromArgs = false;
                if (arguments.length) {
                    $.each(arguments, $.proxy(function (i, date) {
                        if (date instanceof Date)
                            date = this._local_to_utc(date);
                        dates.push(date);
                    }, this));
                    fromArgs = true;
                } else {
                    dates = this.isInput ? this.element.val() : this.element.data('date') || this.element.find('input').val();
                    if (dates && this.o.multidate)
                        dates = dates.split(this.o.multidateSeparator);
                    else
                        dates = [dates];
                    delete this.element.data().date;
                }
                dates = $.map(dates, $.proxy(function (date) {
                    return DPGlobal.parseDate(date, this.o.format, this.o.language);
                }, this));
                dates = $.grep(dates, $.proxy(function (date) {
                    return date < this.o.startDate || date > this.o.endDate || !date;
                }, this), true);
                this.dates.replace(dates);
                if (this.dates.length)
                    this.viewDate = new Date(this.dates.get(-1));
                else if (this.viewDate < this.o.startDate)
                    this.viewDate = new Date(this.o.startDate);
                else if (this.viewDate > this.o.endDate)
                    this.viewDate = new Date(this.o.endDate);
                if (fromArgs) {
                    // setting date by clicking
                    this.setValue();
                } else if (dates.length) {
                    // setting date by typing
                    if (String(oldDates) !== String(this.dates))
                        this._trigger('changeDate');
                }
                if (!this.dates.length && oldDates.length)
                    this._trigger('clearDate');
                this.fill();
            },
            fillDow: function () {
                var dowCnt = this.o.weekStart, html = '<tr>';
                if (this.o.calendarWeeks) {
                    var cell = '<th class="cw">&nbsp;</th>';
                    html += cell;
                    this.picker.find('.datepicker-days thead tr:first-child').prepend(cell);
                }
                while (dowCnt < this.o.weekStart + 7) {
                    html += '<th class="dow">' + dates[this.o.language].daysMin[dowCnt++ % 7] + '</th>';
                }
                html += '</tr>';
                this.picker.find('.datepicker-days thead').append(html);
            },
            fillMonths: function () {
                var html = '', i = 0;
                while (i < 12) {
                    html += '<span class="month">' + dates[this.o.language].monthsShort[i++] + '</span>';
                }
                this.picker.find('.datepicker-months td').html(html);
            },
            setRange: function (range) {
                if (!range || !range.length)
                    delete this.range;
                else
                    this.range = $.map(range, function (d) {
                        return d.valueOf();
                    });
                this.fill();
            },
            getClassNames: function (date) {
                var cls = [], year = this.viewDate.getUTCFullYear(), month = this.viewDate.getUTCMonth(), today = new Date();
                if (date.getUTCFullYear() < year || date.getUTCFullYear() === year && date.getUTCMonth() < month) {
                    cls.push('old');
                } else if (date.getUTCFullYear() > year || date.getUTCFullYear() === year && date.getUTCMonth() > month) {
                    cls.push('new');
                }
                if (this.focusDate && date.valueOf() === this.focusDate.valueOf())
                    cls.push('focused');
                // Compare internal UTC date with local today, not UTC today
                if (this.o.todayHighlight && date.getUTCFullYear() === today.getFullYear() && date.getUTCMonth() === today.getMonth() && date.getUTCDate() === today.getDate()) {
                    cls.push('today');
                }
                if (this.dates.contains(date) !== -1)
                    cls.push('active');
                if (date.valueOf() < this.o.startDate || date.valueOf() > this.o.endDate || $.inArray(date.getUTCDay(), this.o.daysOfWeekDisabled) !== -1) {
                    cls.push('disabled');
                }
                if (this.range) {
                    if (date > this.range[0] && date < this.range[this.range.length - 1]) {
                        cls.push('range');
                    }
                    if ($.inArray(date.valueOf(), this.range) !== -1) {
                        cls.push('selected');
                    }
                }
                return cls;
            },
            fill: function () {
                var d = new Date(this.viewDate), year = d.getUTCFullYear(), month = d.getUTCMonth(), startYear = this.o.startDate !== -Infinity ? this.o.startDate.getUTCFullYear() : -Infinity, startMonth = this.o.startDate !== -Infinity ? this.o.startDate.getUTCMonth() : -Infinity, endYear = this.o.endDate !== Infinity ? this.o.endDate.getUTCFullYear() : Infinity, endMonth = this.o.endDate !== Infinity ? this.o.endDate.getUTCMonth() : Infinity, todaytxt = dates[this.o.language].today || dates['en'].today || '', cleartxt = dates[this.o.language].clear || dates['en'].clear || '', tooltip;
                if (isNaN(year) || isNaN(month))
                    return;
                this.picker.find('.datepicker-days thead th.datepicker-switch').text(dates[this.o.language].months[month] + ' ' + year);
                this.picker.find('tfoot th.today').text(todaytxt).toggle(this.o.todayBtn !== false);
                this.picker.find('tfoot th.clear').text(cleartxt).toggle(this.o.clearBtn !== false);
                this.updateNavArrows();
                this.fillMonths();
                var prevMonth = UTCDate(year, month - 1, 28), day = DPGlobal.getDaysInMonth(prevMonth.getUTCFullYear(), prevMonth.getUTCMonth());
                prevMonth.setUTCDate(day);
                prevMonth.setUTCDate(day - (prevMonth.getUTCDay() - this.o.weekStart + 7) % 7);
                var nextMonth = new Date(prevMonth);
                nextMonth.setUTCDate(nextMonth.getUTCDate() + 42);
                nextMonth = nextMonth.valueOf();
                var html = [];
                var clsName;
                while (prevMonth.valueOf() < nextMonth) {
                    if (prevMonth.getUTCDay() === this.o.weekStart) {
                        html.push('<tr>');
                        if (this.o.calendarWeeks) {
                            // ISO 8601: First week contains first thursday.
                            // ISO also states week starts on Monday, but we can be more abstract here.
                            var
                                // Start of current week: based on weekstart/current date
                                ws = new Date(+prevMonth + (this.o.weekStart - prevMonth.getUTCDay() - 7) % 7 * 86400000),
                                // Thursday of this week
                                th = new Date(Number(ws) + (7 + 4 - ws.getUTCDay()) % 7 * 86400000),
                                // First Thursday of year, year from thursday
                                yth = new Date(Number(yth = UTCDate(th.getUTCFullYear(), 0, 1)) + (7 + 4 - yth.getUTCDay()) % 7 * 86400000),
                                // Calendar week: ms between thursdays, div ms per day, div 7 days
                                calWeek = (th - yth) / 86400000 / 7 + 1;
                            html.push('<td class="cw">' + calWeek + '</td>');
                        }
                    }
                    clsName = this.getClassNames(prevMonth);
                    clsName.push('day');
                    if (this.o.beforeShowDay !== $.noop) {
                        var before = this.o.beforeShowDay(this._utc_to_local(prevMonth));
                        if (before === undefined)
                            before = {};
                        else if (typeof before === 'boolean')
                            before = { enabled: before };
                        else if (typeof before === 'string')
                            before = { classes: before };
                        if (before.enabled === false)
                            clsName.push('disabled');
                        if (before.classes)
                            clsName = clsName.concat(before.classes.split(/\s+/));
                        if (before.tooltip)
                            tooltip = before.tooltip;
                    }
                    clsName = $.unique(clsName);
                    html.push('<td class="' + clsName.join(' ') + '"' + (tooltip ? ' title="' + tooltip + '"' : '') + '>' + prevMonth.getUTCDate() + '</td>');
                    tooltip = null;
                    if (prevMonth.getUTCDay() === this.o.weekEnd) {
                        html.push('</tr>');
                    }
                    prevMonth.setUTCDate(prevMonth.getUTCDate() + 1);
                }
                this.picker.find('.datepicker-days tbody').empty().append(html.join(''));
                var months = this.picker.find('.datepicker-months').find('th:eq(1)').text(year).end().find('span').removeClass('active');
                $.each(this.dates, function (i, d) {
                    if (d.getUTCFullYear() === year)
                        months.eq(d.getUTCMonth()).addClass('active');
                });
                if (year < startYear || year > endYear) {
                    months.addClass('disabled');
                }
                if (year === startYear) {
                    months.slice(0, startMonth).addClass('disabled');
                }
                if (year === endYear) {
                    months.slice(endMonth + 1).addClass('disabled');
                }
                html = '';
                year = parseInt(year / 10, 10) * 10;
                var yearCont = this.picker.find('.datepicker-years').find('th:eq(1)').text(year + '-' + (year + 9)).end().find('td');
                year -= 1;
                var years = $.map(this.dates, function (d) {
                        return d.getUTCFullYear();
                    }), classes;
                for (var i = -1; i < 11; i++) {
                    classes = ['year'];
                    if (i === -1)
                        classes.push('old');
                    else if (i === 10)
                        classes.push('new');
                    if ($.inArray(year, years) !== -1)
                        classes.push('active');
                    if (year < startYear || year > endYear)
                        classes.push('disabled');
                    html += '<span class="' + classes.join(' ') + '">' + year + '</span>';
                    year += 1;
                }
                yearCont.html(html);
            },
            updateNavArrows: function () {
                if (!this._allow_update)
                    return;
                var d = new Date(this.viewDate), year = d.getUTCFullYear(), month = d.getUTCMonth();
                switch (this.viewMode) {
                case 0:
                    if (this.o.startDate !== -Infinity && year <= this.o.startDate.getUTCFullYear() && month <= this.o.startDate.getUTCMonth()) {
                        this.picker.find('.prev').css({ visibility: 'hidden' });
                    } else {
                        this.picker.find('.prev').css({ visibility: 'visible' });
                    }
                    if (this.o.endDate !== Infinity && year >= this.o.endDate.getUTCFullYear() && month >= this.o.endDate.getUTCMonth()) {
                        this.picker.find('.next').css({ visibility: 'hidden' });
                    } else {
                        this.picker.find('.next').css({ visibility: 'visible' });
                    }
                    break;
                case 1:
                case 2:
                    if (this.o.startDate !== -Infinity && year <= this.o.startDate.getUTCFullYear()) {
                        this.picker.find('.prev').css({ visibility: 'hidden' });
                    } else {
                        this.picker.find('.prev').css({ visibility: 'visible' });
                    }
                    if (this.o.endDate !== Infinity && year >= this.o.endDate.getUTCFullYear()) {
                        this.picker.find('.next').css({ visibility: 'hidden' });
                    } else {
                        this.picker.find('.next').css({ visibility: 'visible' });
                    }
                    break;
                }
            },
            click: function (e) {
                e.preventDefault();
                var target = $(e.target).closest('span, td, th'), year, month, day;
                if (target.length === 1) {
                    switch (target[0].nodeName.toLowerCase()) {
                    case 'th':
                        switch (target[0].className) {
                        case 'datepicker-switch':
                            this.showMode(1);
                            break;
                        case 'prev':
                        case 'next':
                            var dir = DPGlobal.modes[this.viewMode].navStep * (target[0].className === 'prev' ? -1 : 1);
                            switch (this.viewMode) {
                            case 0:
                                this.viewDate = this.moveMonth(this.viewDate, dir);
                                this._trigger('changeMonth', this.viewDate);
                                break;
                            case 1:
                            case 2:
                                this.viewDate = this.moveYear(this.viewDate, dir);
                                if (this.viewMode === 1)
                                    this._trigger('changeYear', this.viewDate);
                                break;
                            }
                            this.fill();
                            break;
                        case 'today':
                            var date = new Date();
                            date = UTCDate(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0);
                            this.showMode(-2);
                            var which = this.o.todayBtn === 'linked' ? null : 'view';
                            this._setDate(date, which);
                            break;
                        case 'clear':
                            var element;
                            if (this.isInput)
                                element = this.element;
                            else if (this.component)
                                element = this.element.find('input');
                            if (element)
                                element.val('').change();
                            this.update();
                            this._trigger('changeDate');
                            if (this.o.autoclose)
                                this.hide();
                            break;
                        }
                        break;
                    case 'span':
                        if (!target.is('.disabled')) {
                            this.viewDate.setUTCDate(1);
                            if (target.is('.month')) {
                                day = 1;
                                month = target.parent().find('span').index(target);
                                year = this.viewDate.getUTCFullYear();
                                this.viewDate.setUTCMonth(month);
                                this._trigger('changeMonth', this.viewDate);
                                if (this.o.minViewMode === 1) {
                                    this._setDate(UTCDate(year, month, day));
                                }
                            } else {
                                day = 1;
                                month = 0;
                                year = parseInt(target.text(), 10) || 0;
                                this.viewDate.setUTCFullYear(year);
                                this._trigger('changeYear', this.viewDate);
                                if (this.o.minViewMode === 2) {
                                    this._setDate(UTCDate(year, month, day));
                                }
                            }
                            this.showMode(-1);
                            this.fill();
                        }
                        break;
                    case 'td':
                        if (target.is('.day') && !target.is('.disabled')) {
                            day = parseInt(target.text(), 10) || 1;
                            year = this.viewDate.getUTCFullYear();
                            month = this.viewDate.getUTCMonth();
                            if (target.is('.old')) {
                                if (month === 0) {
                                    month = 11;
                                    year -= 1;
                                } else {
                                    month -= 1;
                                }
                            } else if (target.is('.new')) {
                                if (month === 11) {
                                    month = 0;
                                    year += 1;
                                } else {
                                    month += 1;
                                }
                            }
                            this._setDate(UTCDate(year, month, day));
                        }
                        break;
                    }
                }
                if (this.picker.is(':visible') && this._focused_from) {
                    $(this._focused_from).focus();
                }
                delete this._focused_from;
            },
            _toggle_multidate: function (date) {
                var ix = this.dates.contains(date);
                if (!date) {
                    this.dates.clear();
                }
                if (this.o.multidate === 1 && ix === 0) {
                } else if (ix !== -1) {
                    this.dates.remove(ix);
                } else {
                    this.dates.push(date);
                }
                if (typeof this.o.multidate === 'number')
                    while (this.dates.length > this.o.multidate)
                        this.dates.remove(0);
            },
            _setDate: function (date, which) {
                if (!which || which === 'date')
                    this._toggle_multidate(date && new Date(date));
                if (!which || which === 'view')
                    this.viewDate = date && new Date(date);
                this.fill();
                this.setValue();
                this._trigger('changeDate');
                var element;
                if (this.isInput) {
                    element = this.element;
                } else if (this.component) {
                    element = this.element.find('input');
                }
                if (element) {
                    element.change();
                }
                if (this.o.autoclose && (!which || which === 'date')) {
                    this.hide();
                }
            },
            moveMonth: function (date, dir) {
                if (!date)
                    return undefined;
                if (!dir)
                    return date;
                var new_date = new Date(date.valueOf()), day = new_date.getUTCDate(), month = new_date.getUTCMonth(), mag = Math.abs(dir), new_month, test;
                dir = dir > 0 ? 1 : -1;
                if (mag === 1) {
                    test = dir === -1    // If going back one month, make sure month is not current month
                         // (eg, Mar 31 -> Feb 31 == Feb 28, not Mar 02)
 ? function () {
                        return new_date.getUTCMonth() === month;
                    }    // If going forward one month, make sure month is as expected
                         // (eg, Jan 31 -> Feb 31 == Feb 28, not Mar 02)
 : function () {
                        return new_date.getUTCMonth() !== new_month;
                    };
                    new_month = month + dir;
                    new_date.setUTCMonth(new_month);
                    // Dec -> Jan (12) or Jan -> Dec (-1) -- limit expected date to 0-11
                    if (new_month < 0 || new_month > 11)
                        new_month = (new_month + 12) % 12;
                } else {
                    // For magnitudes >1, move one month at a time...
                    for (var i = 0; i < mag; i++)
                        // ...which might decrease the day (eg, Jan 31 to Feb 28, etc)...
                        new_date = this.moveMonth(new_date, dir);
                    // ...then reset the day, keeping it in the new month
                    new_month = new_date.getUTCMonth();
                    new_date.setUTCDate(day);
                    test = function () {
                        return new_month !== new_date.getUTCMonth();
                    };
                }
                // Common date-resetting loop -- if date is beyond end of month, make it
                // end of month
                while (test()) {
                    new_date.setUTCDate(--day);
                    new_date.setUTCMonth(new_month);
                }
                return new_date;
            },
            moveYear: function (date, dir) {
                return this.moveMonth(date, dir * 12);
            },
            dateWithinRange: function (date) {
                return date >= this.o.startDate && date <= this.o.endDate;
            },
            keydown: function (e) {
                if (this.picker.is(':not(:visible)')) {
                    if (e.keyCode === 27)
                        // allow escape to hide and re-show picker
                        this.show();
                    return;
                }
                var dateChanged = false, dir, newDate, newViewDate, focusDate = this.focusDate || this.viewDate;
                switch (e.keyCode) {
                case 27:
                    // escape
                    if (this.focusDate) {
                        this.focusDate = null;
                        this.viewDate = this.dates.get(-1) || this.viewDate;
                        this.fill();
                    } else
                        this.hide();
                    e.preventDefault();
                    break;
                case 37:
                // left
                case 39:
                    // right
                    if (!this.o.keyboardNavigation)
                        break;
                    dir = e.keyCode === 37 ? -1 : 1;
                    if (e.ctrlKey) {
                        newDate = this.moveYear(this.dates.get(-1) || UTCToday(), dir);
                        newViewDate = this.moveYear(focusDate, dir);
                        this._trigger('changeYear', this.viewDate);
                    } else if (e.shiftKey) {
                        newDate = this.moveMonth(this.dates.get(-1) || UTCToday(), dir);
                        newViewDate = this.moveMonth(focusDate, dir);
                        this._trigger('changeMonth', this.viewDate);
                    } else {
                        newDate = new Date(this.dates.get(-1) || UTCToday());
                        newDate.setUTCDate(newDate.getUTCDate() + dir);
                        newViewDate = new Date(focusDate);
                        newViewDate.setUTCDate(focusDate.getUTCDate() + dir);
                    }
                    if (this.dateWithinRange(newDate)) {
                        this.focusDate = this.viewDate = newViewDate;
                        this.setValue();
                        this.fill();
                        e.preventDefault();
                    }
                    break;
                case 38:
                // up
                case 40:
                    // down
                    if (!this.o.keyboardNavigation)
                        break;
                    dir = e.keyCode === 38 ? -1 : 1;
                    if (e.ctrlKey) {
                        newDate = this.moveYear(this.dates.get(-1) || UTCToday(), dir);
                        newViewDate = this.moveYear(focusDate, dir);
                        this._trigger('changeYear', this.viewDate);
                    } else if (e.shiftKey) {
                        newDate = this.moveMonth(this.dates.get(-1) || UTCToday(), dir);
                        newViewDate = this.moveMonth(focusDate, dir);
                        this._trigger('changeMonth', this.viewDate);
                    } else {
                        newDate = new Date(this.dates.get(-1) || UTCToday());
                        newDate.setUTCDate(newDate.getUTCDate() + dir * 7);
                        newViewDate = new Date(focusDate);
                        newViewDate.setUTCDate(focusDate.getUTCDate() + dir * 7);
                    }
                    if (this.dateWithinRange(newDate)) {
                        this.focusDate = this.viewDate = newViewDate;
                        this.setValue();
                        this.fill();
                        e.preventDefault();
                    }
                    break;
                case 32:
                    // spacebar
                    // Spacebar is used in manually typing dates in some formats.
                    // As such, its behavior should not be hijacked.
                    break;
                case 13:
                    // enter
                    focusDate = this.focusDate || this.dates.get(-1) || this.viewDate;
                    if (this.o.keyboardNavigation) {
                        this._toggle_multidate(focusDate);
                        dateChanged = true;
                    }
                    this.focusDate = null;
                    this.viewDate = this.dates.get(-1) || this.viewDate;
                    this.setValue();
                    this.fill();
                    if (this.picker.is(':visible')) {
                        e.preventDefault();
                        if (this.o.autoclose)
                            this.hide();
                    }
                    break;
                case 9:
                    // tab
                    this.focusDate = null;
                    this.viewDate = this.dates.get(-1) || this.viewDate;
                    this.fill();
                    this.hide();
                    break;
                }
                if (dateChanged) {
                    if (this.dates.length)
                        this._trigger('changeDate');
                    else
                        this._trigger('clearDate');
                    var element;
                    if (this.isInput) {
                        element = this.element;
                    } else if (this.component) {
                        element = this.element.find('input');
                    }
                    if (element) {
                        element.change();
                    }
                }
            },
            showMode: function (dir) {
                if (dir) {
                    this.viewMode = Math.max(this.o.minViewMode, Math.min(2, this.viewMode + dir));
                }
                this.picker.find('>div').hide().filter('.datepicker-' + DPGlobal.modes[this.viewMode].clsName).css('display', 'block');
                this.updateNavArrows();
            }
        };
        var DateRangePicker = function (element, options) {
            this.element = $(element);
            this.inputs = $.map(options.inputs, function (i) {
                return i.jquery ? i[0] : i;
            });
            delete options.inputs;
            $(this.inputs).datepicker(options).bind('changeDate', $.proxy(this.dateUpdated, this));
            this.pickers = $.map(this.inputs, function (i) {
                return $(i).data('datepicker');
            });
            this.updateDates();
        };
        DateRangePicker.prototype = {
            updateDates: function () {
                this.dates = $.map(this.pickers, function (i) {
                    return i.getUTCDate();
                });
                this.updateRanges();
            },
            updateRanges: function () {
                var range = $.map(this.dates, function (d) {
                    return d.valueOf();
                });
                $.each(this.pickers, function (i, p) {
                    p.setRange(range);
                });
            },
            dateUpdated: function (e) {
                // `this.updating` is a workaround for preventing infinite recursion
                // between `changeDate` triggering and `setUTCDate` calling.  Until
                // there is a better mechanism.
                if (this.updating)
                    return;
                this.updating = true;
                var dp = $(e.target).data('datepicker'), new_date = dp.getUTCDate(), i = $.inArray(e.target, this.inputs), l = this.inputs.length;
                if (i === -1)
                    return;
                $.each(this.pickers, function (i, p) {
                    if (!p.getUTCDate())
                        p.setUTCDate(new_date);
                });
                if (new_date < this.dates[i]) {
                    // Date being moved earlier/left
                    while (i >= 0 && new_date < this.dates[i]) {
                        this.pickers[i--].setUTCDate(new_date);
                    }
                } else if (new_date > this.dates[i]) {
                    // Date being moved later/right
                    while (i < l && new_date > this.dates[i]) {
                        this.pickers[i++].setUTCDate(new_date);
                    }
                }
                this.updateDates();
                delete this.updating;
            },
            remove: function () {
                $.map(this.pickers, function (p) {
                    p.remove();
                });
                delete this.element.data().datepicker;
            }
        };
        function opts_from_el(el, prefix) {
            // Derive options from element data-attrs
            var data = $(el).data(), out = {}, inkey, replace = new RegExp('^' + prefix.toLowerCase() + '([A-Z])');
            prefix = new RegExp('^' + prefix.toLowerCase());
            function re_lower(_, a) {
                return a.toLowerCase();
            }
            for (var key in data)
                if (prefix.test(key)) {
                    inkey = key.replace(replace, re_lower);
                    out[inkey] = data[key];
                }
            return out;
        }
        function opts_from_locale(lang) {
            // Derive options from locale plugins
            var out = {};
            // Check if "de-DE" style date is available, if not language should
            // fallback to 2 letter code eg "de"
            if (!dates[lang]) {
                lang = lang.split('-')[0];
                if (!dates[lang])
                    return;
            }
            var d = dates[lang];
            $.each(locale_opts, function (i, k) {
                if (k in d)
                    out[k] = d[k];
            });
            return out;
        }
        var old = $.fn.datepicker;
        $.fn.datepicker = function (option) {
            var args = Array.apply(null, arguments);
            args.shift();
            var internal_return;
            this.each(function () {
                var $this = $(this), data = $this.data('datepicker'), options = typeof option === 'object' && option;
                if (!data) {
                    var elopts = opts_from_el(this, 'date'),
                        // Preliminary otions
                        xopts = $.extend({}, defaults, elopts, options), locopts = opts_from_locale(xopts.language),
                        // Options priority: js args, data-attrs, locales, defaults
                        opts = $.extend({}, defaults, locopts, elopts, options);
                    if ($this.is('.input-daterange') || opts.inputs) {
                        var ropts = { inputs: opts.inputs || $this.find('input').toArray() };
                        $this.data('datepicker', data = new DateRangePicker(this, $.extend(opts, ropts)));
                    } else {
                        $this.data('datepicker', data = new Datepicker(this, opts));
                    }
                }
                if (typeof option === 'string' && typeof data[option] === 'function') {
                    internal_return = data[option].apply(data, args);
                    if (internal_return !== undefined)
                        return false;
                }
            });
            if (internal_return !== undefined)
                return internal_return;
            else
                return this;
        };
        var defaults = $.fn.datepicker.defaults = {
            autoclose: false,
            beforeShowDay: $.noop,
            calendarWeeks: false,
            clearBtn: false,
            daysOfWeekDisabled: [],
            endDate: Infinity,
            forceParse: true,
            format: 'mm/dd/yyyy',
            keyboardNavigation: true,
            language: 'en',
            minViewMode: 0,
            multidate: false,
            multidateSeparator: ',',
            orientation: 'auto',
            rtl: false,
            startDate: -Infinity,
            startView: 0,
            todayBtn: false,
            todayHighlight: false,
            weekStart: 0
        };
        var locale_opts = $.fn.datepicker.locale_opts = [
            'format',
            'rtl',
            'weekStart'
        ];
        $.fn.datepicker.Constructor = Datepicker;
        var dates = $.fn.datepicker.dates = {
            en: {
                days: [
                    'Sunday',
                    'Monday',
                    'Tuesday',
                    'Wednesday',
                    'Thursday',
                    'Friday',
                    'Saturday',
                    'Sunday'
                ],
                daysShort: [
                    'Sun',
                    'Mon',
                    'Tue',
                    'Wed',
                    'Thu',
                    'Fri',
                    'Sat',
                    'Sun'
                ],
                daysMin: [
                    'Su',
                    'Mo',
                    'Tu',
                    'We',
                    'Th',
                    'Fr',
                    'Sa',
                    'Su'
                ],
                months: [
                    'January',
                    'February',
                    'March',
                    'April',
                    'May',
                    'June',
                    'July',
                    'August',
                    'September',
                    'October',
                    'November',
                    'December'
                ],
                monthsShort: [
                    'Jan',
                    'Feb',
                    'Mar',
                    'Apr',
                    'May',
                    'Jun',
                    'Jul',
                    'Aug',
                    'Sep',
                    'Oct',
                    'Nov',
                    'Dec'
                ],
                today: 'Today',
                clear: 'Clear'
            }
        };
        var DPGlobal = {
            modes: [
                {
                    clsName: 'days',
                    navFnc: 'Month',
                    navStep: 1
                },
                {
                    clsName: 'months',
                    navFnc: 'FullYear',
                    navStep: 1
                },
                {
                    clsName: 'years',
                    navFnc: 'FullYear',
                    navStep: 10
                }
            ],
            isLeapYear: function (year) {
                return year % 4 === 0 && year % 100 !== 0 || year % 400 === 0;
            },
            getDaysInMonth: function (year, month) {
                return [
                    31,
                    DPGlobal.isLeapYear(year) ? 29 : 28,
                    31,
                    30,
                    31,
                    30,
                    31,
                    31,
                    30,
                    31,
                    30,
                    31
                ][month];
            },
            validParts: /dd?|DD?|mm?|MM?|yy(?:yy)?/g,
            nonpunctuation: /[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,
            parseFormat: function (format) {
                // IE treats \0 as a string end in inputs (truncating the value),
                // so it's a bad format delimiter, anyway
                var separators = format.replace(this.validParts, '\0').split('\0'), parts = format.match(this.validParts);
                if (!separators || !separators.length || !parts || parts.length === 0) {
                    throw new Error('Invalid date format.');
                }
                return {
                    separators: separators,
                    parts: parts
                };
            },
            parseDate: function (date, format, language) {
                if (!date)
                    return undefined;
                if (date instanceof Date)
                    return date;
                if (typeof format === 'string')
                    format = DPGlobal.parseFormat(format);
                var part_re = /([\-+]\d+)([dmwy])/, parts = date.match(/([\-+]\d+)([dmwy])/g), part, dir, i;
                if (/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(date)) {
                    date = new Date();
                    for (i = 0; i < parts.length; i++) {
                        part = part_re.exec(parts[i]);
                        dir = parseInt(part[1]);
                        switch (part[2]) {
                        case 'd':
                            date.setUTCDate(date.getUTCDate() + dir);
                            break;
                        case 'm':
                            date = Datepicker.prototype.moveMonth.call(Datepicker.prototype, date, dir);
                            break;
                        case 'w':
                            date.setUTCDate(date.getUTCDate() + dir * 7);
                            break;
                        case 'y':
                            date = Datepicker.prototype.moveYear.call(Datepicker.prototype, date, dir);
                            break;
                        }
                    }
                    return UTCDate(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), 0, 0, 0);
                }
                parts = date && date.match(this.nonpunctuation) || [];
                date = new Date();
                var parsed = {}, setters_order = [
                        'yyyy',
                        'yy',
                        'M',
                        'MM',
                        'm',
                        'mm',
                        'd',
                        'dd'
                    ], setters_map = {
                        yyyy: function (d, v) {
                            return d.setUTCFullYear(v);
                        },
                        yy: function (d, v) {
                            return d.setUTCFullYear(2000 + v);
                        },
                        m: function (d, v) {
                            if (isNaN(d))
                                return d;
                            v -= 1;
                            while (v < 0)
                                v += 12;
                            v %= 12;
                            d.setUTCMonth(v);
                            while (d.getUTCMonth() !== v)
                                d.setUTCDate(d.getUTCDate() - 1);
                            return d;
                        },
                        d: function (d, v) {
                            return d.setUTCDate(v);
                        }
                    }, val, filtered;
                setters_map['M'] = setters_map['MM'] = setters_map['mm'] = setters_map['m'];
                setters_map['dd'] = setters_map['d'];
                date = UTCDate(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0);
                var fparts = format.parts.slice();
                // Remove noop parts
                if (parts.length !== fparts.length) {
                    fparts = $(fparts).filter(function (i, p) {
                        return $.inArray(p, setters_order) !== -1;
                    }).toArray();
                }
                // Process remainder
                function match_part() {
                    var m = this.slice(0, parts[i].length), p = parts[i].slice(0, m.length);
                    return m === p;
                }
                if (parts.length === fparts.length) {
                    var cnt;
                    for (i = 0, cnt = fparts.length; i < cnt; i++) {
                        val = parseInt(parts[i], 10);
                        part = fparts[i];
                        if (isNaN(val)) {
                            switch (part) {
                            case 'MM':
                                filtered = $(dates[language].months).filter(match_part);
                                val = $.inArray(filtered[0], dates[language].months) + 1;
                                break;
                            case 'M':
                                filtered = $(dates[language].monthsShort).filter(match_part);
                                val = $.inArray(filtered[0], dates[language].monthsShort) + 1;
                                break;
                            }
                        }
                        parsed[part] = val;
                    }
                    var _date, s;
                    for (i = 0; i < setters_order.length; i++) {
                        s = setters_order[i];
                        if (s in parsed && !isNaN(parsed[s])) {
                            _date = new Date(date);
                            setters_map[s](_date, parsed[s]);
                            if (!isNaN(_date))
                                date = _date;
                        }
                    }
                }
                return date;
            },
            formatDate: function (date, format, language) {
                if (!date)
                    return '';
                if (typeof format === 'string')
                    format = DPGlobal.parseFormat(format);
                var val = {
                    d: date.getUTCDate(),
                    D: dates[language].daysShort[date.getUTCDay()],
                    DD: dates[language].days[date.getUTCDay()],
                    m: date.getUTCMonth() + 1,
                    M: dates[language].monthsShort[date.getUTCMonth()],
                    MM: dates[language].months[date.getUTCMonth()],
                    yy: date.getUTCFullYear().toString().substring(2),
                    yyyy: date.getUTCFullYear()
                };
                val.dd = (val.d < 10 ? '0' : '') + val.d;
                val.mm = (val.m < 10 ? '0' : '') + val.m;
                date = [];
                var seps = $.extend([], format.separators);
                for (var i = 0, cnt = format.parts.length; i <= cnt; i++) {
                    if (seps.length)
                        date.push(seps.shift());
                    date.push(val[format.parts[i]]);
                }
                return date.join('');
            },
            headTemplate: '<thead>' + '<tr>' + '<th class="prev">&laquo;</th>' + '<th colspan="5" class="datepicker-switch"></th>' + '<th class="next">&raquo;</th>' + '</tr>' + '</thead>',
            contTemplate: '<tbody><tr><td colspan="7"></td></tr></tbody>',
            footTemplate: '<tfoot>' + '<tr>' + '<th colspan="7" class="today"></th>' + '</tr>' + '<tr>' + '<th colspan="7" class="clear"></th>' + '</tr>' + '</tfoot>'
        };
        DPGlobal.template = '<div class="datepicker">' + '<div class="datepicker-days">' + '<table class=" table-condensed">' + DPGlobal.headTemplate + '<tbody></tbody>' + DPGlobal.footTemplate + '</table>' + '</div>' + '<div class="datepicker-months">' + '<table class="table-condensed">' + DPGlobal.headTemplate + DPGlobal.contTemplate + DPGlobal.footTemplate + '</table>' + '</div>' + '<div class="datepicker-years">' + '<table class="table-condensed">' + DPGlobal.headTemplate + DPGlobal.contTemplate + DPGlobal.footTemplate + '</table>' + '</div>' + '</div>';
        $.fn.datepicker.DPGlobal = DPGlobal;
        /* DATEPICKER NO CONFLICT
	* =================== */
        $.fn.datepicker.noConflict = function () {
            $.fn.datepicker = old;
            return this;
        };
        /* DATEPICKER DATA-API
	* ================== */
        $(document).on('focus.datepicker.data-api click.datepicker.data-api', '[data-provide="datepicker"]', function (e) {
            var $this = $(this);
            if ($this.data('datepicker'))
                return;
            e.preventDefault();
            // component click requires us to explicitly show it
            $this.datepicker('show');
        });
        $(function () {
            $('[data-provide="datepicker-inline"]').datepicker();
        });
    }(window.jQuery));
    return;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductViews
define('ProductViews.Option.View', [
    'SC.Configuration',
    'Backbone',
    'underscore',
    'bootstrap-datepicker'
], function (Configuration, Backbone, _) {
    'use strict';
    //@class ProductViews.Option.View.initialize
    //@property {Transaction.Line.Model} line
    //@property {String} templateName As this view can be used to show options in all state (selected or to be selected) it is required to specify
    //what template should be used from the list of templates in configuration. If not value is given 'selector' is used, note that this value
    //is used to select option (in the PDP for instance)
    //@property {Backbone.Model<Transaction.Line.Option.Model>} model
    // @class ProductViews.Option.View @extends Backbone.View
    return Backbone.View.extend({
        //@method initialize Set the option template and values availability
        //@param {ProductViews.Option.View.initialize} options
        //@return {Void}
        initialize: function () {
            this.config = _.findWhere(Configuration.get('ItemOptions.optionsConfiguration', []), { cartOptionId: this.model.get('cartOptionId') }) || { templates: {} };
            this.config.templates = this.config.templates || {};
            var item_options_default_templates = Configuration.get('ItemOptions.defaultTemplates', {});
            if (item_options_default_templates && item_options_default_templates.selectorByType) {
                // Sets templates for this option
                if (!this.config.templates.selector) {
                    var option_selector_template = item_options_default_templates.selectorByType[this.model.get('type')], default_option_selector_template = item_options_default_templates.selectorByType['default'];
                    this.config.templates.selector = option_selector_template || default_option_selector_template;
                }
                if (!this.config.templates.selected) {
                    var option_selected_template = item_options_default_templates.selectedByType[this.model.get('type')], default_option_selected_template = item_options_default_templates.selectedByType['default'];
                    this.config.templates.selected = option_selected_template || default_option_selected_template;
                }
                if (!this.config.templates.facetCell) {
                    var option_facetcell_template = item_options_default_templates.facetCellByType[this.model.get('type')], default_option_facetcell_template = item_options_default_templates.facetCellByType['default'];
                    this.config.templates.facetCell = option_facetcell_template || default_option_facetcell_template;
                }
            }
            this.options.templateName = this.options.templateName || 'selector';
            this.template = this.config.templates[this.options.templateName];
        }    //@method getContext
             //@returns {ProductViews.Option.View.Context}
,
        getContext: function () {
            var self = this, selected_value = this.model.get('value') || {}, values = _.map(this.model.get('values'), function (value) {
                    var color = '', is_color_tile = true, image = {};
                    if (self.model.get('colors')) {
                        color = self.model.get('colors')[value.label] || self.model.get('colors').defaultColor;
                        if (_.isObject(color)) {
                            image = color;
                            color = '';
                            is_color_tile = false;
                        }
                    }
                    //@class ProductViews.Option.View.Value
                    return {
                        // @property {String} internalId
                        internalId: value.internalid,
                        isAvailable: value.isAvailable,
                        url: value.url,
                        label: value.label,
                        isActive: value.internalid === selected_value.internalid,
                        color: color    // @property {Boolean} isColorTile Indicate if a simple colored box should be shown or an image object is aimed
,
                        isColorTile: is_color_tile    // @property {Color.Configuration>|String} image
,
                        image: image    // @property {Boolean} isLightColor
,
                        isLightColor: _.contains(Configuration.get('layout.lightColors', []), value.label)
                    };    //@class ProductViews.Option.View
                });
            // @class ProductViews.Option.View.Context
            return {
                // @property {Transaction.Line.Option.Model} model
                model: this.model,
                values: values    // @property {Boolean} showSelectedValue
,
                showSelectedValue: !!selected_value    // @propery {Boolean} showRequiredLabel
,
                showRequiredLabel: this.options.show_required_label && this.model.get('isMandatory')    // @property {String} itemOptionId
,
                itemOptionId: this.model.get('itemOptionId')    // @property {String} cartOptionId
,
                cartOptionId: this.model.get('cartOptionId')    // @property {String} label
,
                label: this.model.get('label')    // @property {ItemViews.Option.View.Option} selectedValue
,
                selectedValue: selected_value    // @property {Boolean} isTextArea
,
                isTextArea: this.model.get('type') === 'textarea'    // @property {Boolean} isEmail
,
                isEmail: this.model.get('type') === 'email'    // @property {Boolean} isText
,
                isText: this.model.get('type') === 'text'    // @property {Boolean} isCheckbox
,
                isCheckbox: this.model.get('type') === 'checkbox'    // @property {Boolean} idDate
,
                isDate: this.model.get('type') === 'date'    // @property {Boolean} isSelect
,
                isSelect: this.model.get('type') === 'select'    // @property {String} showLabel
,
                showLabel: !this.options.hideLabel,
                showSmall: !!this.options.showSmall
            };    // @class ProductViews.Option.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductDetails
define('ProductDetails.Options.Selector.Pusher.View', [
    'product_details_options_selector_pusher.tpl',
    'Backbone'
], function (product_details_options_selector_pusher_tpl, Backbone) {
    'use strict';
    //@class ProductDetails.Options.Selector.Pusher.View
    return Backbone.View.extend({
        //@property {Function} template
        template: product_details_options_selector_pusher_tpl    //@property {Function} initialize
,
        initialize: function () {
            Backbone.View.prototype.initialize.apply(this, arguments);
            this.model.on('change', this.render, this);
        }    //@method getContext
             //@return {ProductDetails.Options.Selector.View.Context}
,
        getContext: function () {
            var selected_options = this.model.getSelectedOptions();
            //@class ProductDetails.Options.Selector.View.Context
            return {
                //@property {ProductModel} model
                model: this.model,
                isSelectionCompleted: this.model.isSelectionComplete()    //@property {Boolean} hasSelectedOptions Indicate if the current line has options selected
,
                hasSelectedOptions: !!selected_options.length,
                selectedOptions: selected_options
            };    //@class ProductDetails.Options.Selector.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductDetails
define('ProductDetails.Options.Selector.View', [
    'ProductViews.Option.View',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'ProductViews.Price.View',
    'ProductLine.Stock.View',
    'ProductLine.StockDescription.View',
    'ProductDetails.Options.Selector.Pusher.View',
    'product_details_options_selector.tpl',
    'Backbone'
], function (ProductViewsOptionView, BackboneCompositeView, BackboneCollectionView, ProductViewsPriceView, ProductLineStockView, ProductLineStockDescriptionView, ProductDetailsOptionsSelectorPusherView, product_details_options_selector_tpl, Backbone) {
    'use strict';
    //@class ProductDetails.Options.Selector.View.initialize
    //@property {Transaction.Line.Model} model
    return Backbone.View.extend({
        //@property {Function} template
        template: product_details_options_selector_tpl    //@method initialize Override default method to made current view composite
                                                //@param {ProductDetails.Options.Selector.View.initialize} options
                                                //@return {Void}
,
        initialize: function () {
            Backbone.View.prototype.initialize.apply(this, arguments);
            BackboneCompositeView.add(this);
        }    //@method render Override default method to made current view composite
             //@param {ProductDetails.Options.Selector.View.render}
             //@return {Void}
,
        render: function () {
            if (!this.model.get('options').length) {
                return;
            }
            this._render();
        }    //@property {ChildViews} childViews
,
        childViews: {
            'Pusher': function () {
                return new ProductDetailsOptionsSelectorPusherView({ model: this.model });
            },
            'Options.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.model.getVisibleOptions(),
                    childView: ProductViewsOptionView,
                    viewsPerRow: 1,
                    childViewOptions: {
                        line: this.model,
                        item: this.model.get('item'),
                        templateName: 'selector',
                        show_required_label: this.options.show_required_label
                    }
                });
            },
            'Item.Price': function () {
                return new ProductViewsPriceView({
                    model: this.model,
                    origin: 'PDPOPTIONS'
                });
            },
            'Item.Stock': function () {
                return new ProductLineStockView({ model: this.model });
            },
            'StockDescription': function () {
                return new ProductLineStockDescriptionView({ model: this.model });
            }
        }    //@method getContext
             //@return {ProductDetails.Options.Selector.View.Context}
,
        getContext: function () {
            //@class ProductDetails.Options.Selector.View.Context
            return {
                //@property {ProductModel} model
                model: this.model,
                showPusher: this.options.show_pusher,
                showRequiredLabel: this.options.show_required_label
            };    //@class ProductDetails.Options.Selector.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.Item.Edit.View', [
    'ProductList.Item.Model',
    'GlobalViews.StarRating.View',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'ProductViews.Price.View',
    'ProductDetails.Options.Selector.View',
    'product_list_edit_item.tpl',
    'underscore',
    'jQuery',
    'Backbone',
    'Backbone.FormView',
    'Utils'
], function (ProductListItemModel, GlobalViewsStarRatingView, BackboneCompositeView, BackboneCollectionView, ProductViewsPriceView, ProductDetailsOptionsSelectorView, product_list_edit_item_tpl, _, jQuery, Backbone, BackboneFormView, Utils) {
    'use strict';
    // @class ProductList.Item.Edit.View View to handle Product Lists Item edition. @extends Backbone.View
    return Backbone.View.extend({
        template: product_list_edit_item_tpl,
        title: _('Edit item').translate(),
        page_header: _('Edit item').translate(),
        modalClass: 'global-views-modal-large',
        events: {
            'submit form': 'submitForm',
            'blur [data-toggle="text-option"]': 'setOption',
            'click [data-toggle="set-option"]': 'setOption',
            'change [data-toggle="select-option"]': 'setOption',
            'change [name="quantity"]': 'updateQuantity',
            'keypress [name="quantity"]': 'ignoreEnter',
            'click [data-ui-action="add"]': 'addQuantity',
            'click [data-ui-action="minus"]': 'subQuantity',
            'change [name="description"]': 'updateDescription',
            'keypress [name="description"]': 'ignoreEnter',
            'change [name="priority"]': 'updatePriority',
            'keydown [data-toggle="text-option"]': 'tabNavigationFix',
            'focus [data-toggle="text-option"]': 'tabNavigationFix'
        },
        bindings: { '[name="description"]': 'description' },
        initialize: function (options) {
            this.application = options.application;
            this.parentView = options.parentView;
            this.target = options.target;
            this.title = options.title;
            this.page_header = options.title;
            this.confirm_edit_method = options.confirm_edit_method;
            BackboneCompositeView.add(this);
            BackboneFormView.add(this);
        }    // Edit the current item
,
        submitForm: function (e) {
            e.preventDefault();
            if (this.model.areAttributesValid([
                    'quantity',
                    'options'
                ], {})) {
                var self = this;
                this.$('[data-action="edit"]').attr('disabled', 'true');
                this.model.save(null, { validate: false }).done(function (new_attributes) {
                    self.parentView[self.confirm_edit_method](new_attributes);
                    var item_list = _.findWhere(self.application.ProductListModule.Utils.getProductLists().models, { id: self.parentView.model.id });
                    item_list && item_list.get('items').get(self.model.id).set('quantity', new_attributes.quantity);
                    if (self.inModal && self.$containerModal) {
                        self.$containerModal.modal('hide');
                        self.destroy();
                    }
                });
            }
        }    // Updates the quantity of the model
,
        updateQuantity: function (e) {
            var new_quantity = parseInt(jQuery(e.target).val(), 10), min_quantity = this.getMinimumQuantity(), max_quantity = this.getMaximumQuantity(), current_quantity = this.model.get('quantity');
            new_quantity = new_quantity >= min_quantity ? new_quantity : min_quantity;
            new_quantity = max_quantity !== 0 && new_quantity > max_quantity ? max_quantity : new_quantity;
            jQuery(e.target).val(new_quantity);
            if (new_quantity !== current_quantity) {
                this.model.set('quantity', new_quantity);
                this.storeFocus(e);
                this.render();
            }
        }    // @method addQuantity Increase the product's Quantity by 1
             // @param {HTMLEvent} e
,
        addQuantity: function (e) {
            e.preventDefault();
            var $element = jQuery(e.target), oldValue = $element.parent().find('input').val(), newVal = parseInt(oldValue, 10) + 1;
            var input = $element.parent().find('input');
            input.val(newVal);
            input.trigger('change');
        }    // @method subQuantity Decreases the product's Quantity by 1
             // @param {HTMLEvent} e
,
        subQuantity: function (e) {
            e.preventDefault();
            var $element = jQuery(e.target), oldValue = $element.parent().find('input').val(), newVal = parseInt(oldValue, 10) - 1;
            newVal = Math.max(1, newVal);
            var input = $element.parent().find('input');
            input.val(newVal);
            input.trigger('change');
        }    // @method getMinimumQuantity Returns the minimum purchasable quantity of the active item
,
        getMinimumQuantity: function () {
            return this.getMinMaxQuantity('_minimumQuantity', 1);
        }    // @method getMaximumQuantity Returns the minimum purchasable quantity of the active item
,
        getMaximumQuantity: function () {
            return this.getMinMaxQuantity('_maximumQuantity', 0);
        },
        getMinMaxQuantity: function (minMax, minMaxNumber) {
            if (this.model.isMatrixChild()) {
                var optionsSelected = this.model.get('itemDetails').itemOptions, optionsAvailable = this.model.get('itemDetails').getPosibleOptions(), activeItem = this.model.getMatrixItem(optionsSelected, optionsAvailable);
                return activeItem && activeItem.get(minMax) ? activeItem.get(minMax) : minMaxNumber;
            } else {
                return this.model.get('item').get(minMax) ? this.model.get('item').get(minMax) : minMaxNumber;
            }
        }    // Updates the description of the model
,
        updateDescription: function (e) {
            var new_description = jQuery(e.target).val(), current_description = this.model.get('description');
            if (new_description !== current_description) {
                this.model.set('description', new_description);
                this.storeFocus(e);
            }
        }    // Updates the priority of the model
,
        updatePriority: function (e) {
            var new_priority = jQuery(e.target).val(), current_priority = this.model.get('priority');
            if (new_priority !== current_priority) {
                this.model.set('priority', { id: new_priority });
                this.storeFocus(e);
            }
        }    // Sets an item option (matrix or custom)
,
        setOption: function (e) {
            var $target = jQuery(e.currentTarget), value = $target.val() || $target.data('value') || null, cart_option_id = $target.closest('[data-type="option"]').data('cart-option-id');
            // Prevent from going away
            e.preventDefault();
            // if option is selected, remove the value
            if ($target.data('active')) {
                value = null;
            }
            this.model.setOption(cart_option_id, value);
            this.storeFocus(e);
            this.render();
        }    // view.storeFocus
             // Computes and store the current state of the item and refresh the whole view, re-rendering the view at the end
             // This also updates the url, but it does not generates a history point
,
        storeFocus: function () {
            var focused_element = this.$(':focus').get(0);
            this.focusedElement = focused_element ? Utils.getFullPathForElement(focused_element) : null;
        }    // view.tabNavigationFix:
             // When you blur on an input field the whole page gets rendered,
             // so the function of hitting tab to navigate to the next input stops working
             // This solves that problem by storing a a ref to the current input
,
        tabNavigationFix: function (e) {
            this.hideError();
            // If the user is hitting tab we set tabNavigation to true, for any other event we turn ir off
            this.tabNavigation = e.type === 'keydown' && e.which === 9;
            this.tabNavigationUpsidedown = e.shiftKey;
            this.tabNavigationCurrent = Utils.getFullPathForElement(e.target);
        },
        afterAppend: function () {
            this.focusedElement && this.$(this.focusedElement).focus();
            if (this.tabNavigation) {
                var current_index = this.$(':input').index(this.$(this.tabNavigationCurrent).get(0)), next_index = this.tabNavigationUpsidedown ? current_index - 1 : current_index + 1;
                this.$(':input:eq(' + next_index + ')').focus();
            }
        }    // view.showInModal:
             // Takes care of showing the pdp in a modal, and changes the template, doesn't trigger the
             // after events because those are triggered by showContent
,
        showInModal: function (options) {
            this.template = 'product_list_edit_item';
            return this.application.getLayout().showInModal(this, options);
        }    // don't want to trigger form submit when user presses enter when in the quantity input text
,
        ignoreEnter: function (e) {
            if (e.keyCode === 13) {
                e.preventDefault();
                e.stopPropagation();
            }
        },
        childViews: {
            'ItemViews.Price': function () {
                return new ProductViewsPriceView({
                    model: this.model,
                    origin: 'PRODUCTLISTDETAILSEDIT'
                });
            },
            'GlobalViews.StarRating': function () {
                return new GlobalViewsStarRatingView({ model: this.model.get('item') });
            },
            'ItemDetails.Options': function () {
                return new ProductDetailsOptionsSelectorView({ model: this.model });
            }
        }    // @method getContext
             // @return {ProductList.Item.Edit.View.Context}
,
        getContext: function () {
            var line = this.model, item = line.get('item'), min_quantity = item.get('_minimumQuantity'), max_quantity = this.getMaximumQuantity(), priority = line.get('priority');
            //@class ProductList.Item.Edit.View.Context
            return {
                //@property {Boolean} showRating
                showRating: SC.ENVIRONMENT.REVIEWS_CONFIG && SC.ENVIRONMENT.REVIEWS_CONFIG.enabled,
                quantity: line.get('quantity')    //@property {Boolean} showMinimumQuantity
,
                showMinimumQuantity: min_quantity > 1    //@property {Number} minQuantity
,
                minQuantity: min_quantity    //@property {Boolean} showMaximumQuantity
,
                showMaximumQuantity: max_quantity > 0    //@property {Number} maxQuantity
,
                maxQuantity: max_quantity    // @property {String} description
,
                description: line.get('description')    // @property {String} productId
,
                productId: item.get('internalid')    // @property {String} productName
,
                productName: item.get('_name')    // @property {String} itemCreatedDate
,
                itemCreatedDate: line.get('created')    // @property {Boolean} isSelectionCompleteForEdit
,
                isSelectionCompleteForEdit: line.areAttributesValid([
                    'quantity',
                    'options'
                ], {})    // @property {Boolean} isPriority1
,
                isPriority1: priority.id === '1'    // @property {Boolean} isPriority2
,
                isPriority2: priority.id === '2'    // @property {Boolean} isPriority3
,
                isPriority3: priority.id === '3'    // @property {ImageContainer} thumbnail
,
                thumbnail: this.model.getThumbnail()
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module GlobalViews.Pagination.View
define('GlobalViews.Pagination.View', [
    'global_views_pagination.tpl',
    'Backbone',
    'underscore',
    'Utils'
], function (global_views_pagination_tpl, Backbone, _) {
    'use strict';
    // @class GlobalViews.Pagination.View @extends Backbone.View
    return Backbone.View.extend({
        template: global_views_pagination_tpl,
        initialize: function () {
            //State definition
            this.current_page;
            this.pages;
            this.pager;
            this.range_start = 1;
            this.range_end;
            this.show_page_list;
            this.precalculateValues();
        }    // @method pager @param {String} url_value @returns {String}
,
        _pager: function (url_value) {
            var page_number = parseInt(url_value, 10), url = Backbone.history.fragment;
            return isNaN(page_number) || page_number === 1 ? _.removeUrlParameter(url, 'page') : _.setUrlParameter(url, 'page', page_number);
        },
        _getCurrentPage: function () {
            var url_options = _.parseUrlOptions(Backbone.history.fragment);
            return this._getPageFromUrl(url_options.page);
        }    // @method getPageFromUrl @param {String} url_value @returns {Number}
,
        _getPageFromUrl: function (url_value) {
            var page_number = parseInt(url_value, 10);
            return !isNaN(page_number) && page_number > 0 ? page_number : 1;
        }    //@method precalculateValues Internal method to precalculate paginator state once and being able to use it many times
,
        precalculateValues: function () {
            this.current_page = this._getCurrentPage();
            this.total_pages = parseInt(this.options.totalPages, 10);
            this.pager = this.options.pager || this._pager;
            this.range_end = this.total_pages + 1;
            this.show_page_list = _.isBoolean(this.options.showPageList) ? this.options.showPageList : true;
            var pages_to_show = parseInt(this.options.pagesToShow, 10) || 4, padding_left = pages_to_show % 2 === 0 ? pages_to_show / 2 - 1 : parseInt(pages_to_show / 2, 10);
            if (this.show_page_list && pages_to_show < this.total_pages) {
                // if we are getting closer to the end we need to compute from the end to the beginig
                if (pages_to_show - padding_left > this.total_pages - this.current_page) {
                    this.range_start = this.total_pages + 1 - pages_to_show;
                } else {
                    this.range_start = this.current_page - padding_left < 1 ? 1 : this.current_page - padding_left;
                    this.range_end = this.range_start + pages_to_show > this.total_pages ? this.total_pages : this.range_start + pages_to_show;
                }
            }
            var self = this;
            this.pages = _.map(_.range(this.range_start, this.range_end), function (page_index) {
                //@class GlobalViews.Pagination.View.PageItem
                return {
                    //@property {Boolean} isCurrentPageActivePage
                    isCurrentPageActivePage: page_index === self.current_page,
                    URL: self.pager(page_index)    //@property {String} fixedURL
,
                    fixedURL: _(self.pager(page_index)).fixUrl()    //@property {Number} pageIndex
,
                    pageIndex: page_index
                };    //@class GlobalViews.Pagination.View
            });
        }    // @method getContext @return {GlobalViews.Pagination.View.Content}
,
        getContext: function () {
            //@class GlobalViews.Pagination.View
            return {
                //@property {Boolean} currentPageLowerThanTotalPagesAndCurrentPageGreaterThan0AndPagesCountGreaterThan1
                currentPageLowerThanTotalPagesAndCurrentPageGreaterThan0AndPagesCountGreaterThan1: this.total_pages >= this.current_page && this.current_page > 0 && this.pages.length > 1    //@property {Boolean} showPageIndicator
,
                showPageIndicator: this.options.showPageIndicator || true    //@property {String} paginatorClass
,
                paginatorClass: this.options.extraClass || ''    //@property {Number} currentPage
,
                currentPage: this.current_page,
                totalPages: this.total_pages,
                isCurrentPageDifferentThan1: this.current_page !== 1    //@property {String} currentPageURL
,
                currentPageURL: _(this.pager(this.current_page)).fixUrl()    //@property {String} previousPageURL
,
                previousPageURL: _(this.pager(this.current_page - 1)).fixUrl()    //@property {String} nextPageURL
,
                nextPageURL: _(this.pager(this.current_page + 1)).fixUrl()    //@property {Boolean} showPageList
,
                showPageList: this.show_page_list,
                showPaginationLinksCompactClass: !this.show_page_list,
                isRangeStartGreaterThan1: this.range_start > 1    //@property {Boolean} isRangeEndLowerThanTotalPages
,
                isRangeEndLowerThanTotalPages: this.range_end < this.total_pages,
                isCurrentPageLast: this.current_page === this.total_pages,
                pages: this.pages
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module GlobalViews
define('GlobalViews.ShowingCurrent.View', [
    'global_views_showing_current.tpl',
    'Backbone',
    'underscore'
], function (global_views_showing_current_tpl, Backbone, _) {
    'use strict';
    // @class GlobalViews.ShowingCurrent.View @extends Backbone.View
    return Backbone.View.extend({
        template: global_views_showing_current_tpl,
        _getCurrentPage: function () {
            var url_options = _.parseUrlOptions(Backbone.history.fragment);
            return this._getPageFromUrl(url_options.page);
        }    // @method getPageFromUrl @param {String} url_value @returns {Number}
,
        _getPageFromUrl: function (url_value) {
            var page_number = parseInt(url_value, 10);
            return !isNaN(page_number) && page_number > 0 ? page_number : 1;
        }    // @method getContext @return GlobalViews.ShowingCurrent.View.Content
,
        getContext: function () {
            this.options.current_page = this._getCurrentPage();
            var lastItem = this.options.current_page * this.options.items_per_page;
            //@class GlobalViews.ShowingCurrent.View.Content
            return {
                //@property {String} orderText
                orderText: this.options.order_id ? ' ' + _('for <a href="/ordershistory/view/$(0)">  Order Number: #$(1)</a>').translate(this.options.order_id, this.options.order_number) : ''    //@property {String} extraClass
,
                extraClass: this.options.extraClass,
                firstItem: (this.options.current_page - 1) * this.options.items_per_page + 1    //@property {Number} lastItem
,
                lastItem: lastItem > this.options.total_items ? this.options.total_items : lastItem    //@property {Number} totalItems
,
                totalItems: this.options.total_items
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ListHeader
define('ListHeader.View', [
    'SC.Configuration',
    'GlobalViews.Pagination.View',
    'GlobalViews.ShowingCurrent.View',
    'AjaxRequestsKiller',
    'list_header_view.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'underscore',
    'jQuery',
    'Utils',
    'bootstrap-datepicker',
    'UrlHelper'
], function (Configuration, GlobalViewsPaginationView, GlobalViewsShowingCurrentView, AjaxRequestsKiller, list_header_view_tpl, Backbone, BackboneCompositeView, _, jQuery) {
    'use strict';
    // @class ListHeader.View
    // View used to manipulate a collection by adding sorting and filtering capabilities
    // based on the sort and filter options from the collection
    // @extend Backbone.View
    var ListHeader = Backbone.View.extend({
        //@property {Function} template
        template: list_header_view_tpl    //@property {Object} events
,
        events: {
            'change [data-action="filter"]': 'filterHandler',
            'change [data-action="sort"]': 'sortHandler',
            'click [data-action="toggle-sort"]': 'toggleSortHandler',
            'change [data-action="select-all"]': 'selectAll',
            'change [data-action="unselect-all"]': 'unselectAll'    /*
			 * range-filter focus/blur work together to update the date range when:
			 * Blur happens on a field and user don't focus on the other during a defined interval
			*/,
            'focus [data-action="range-filter"]': 'clearRangeFilterTimeout',
            'blur [data-action="range-filter"]': 'rangeFilterBlur',
            'click [data-action="toggle-filters"]': 'toggleFilters',
            'click [data-action="clear-value"]': 'clearRangeValue'
        }    //@method initialize
             //@param {ListHeader.View.initialize.Options} options
             //@return {Void}
,
        initialize: function (options) {
            BackboneCompositeView.add(this);
            var view = options.view;
            _.extend(this, options);
            // @property {Boolean} avoidFirstFetch true only if the module using list header is the one responsible of fetching the collection for the first time (optional)
            this.avoidFirstFetch = options.avoidFirstFetch;
            // @property {Number} totalCount the original count of items of the collection without filtering (optional)
            this.totalCount = options.totalCount;
            // @property {Object} rangeFilterOptions store the range (date) filter options
            this.rangeFilterOptions = view.rangeFilterOptions || {};
            // @property {String} rangeFilterLabel Label for range filter (optional)
            this.rangeFilterLabel = options.rangeFilterLabel;
            // @property {String} expandedStatePath default value of filter collapse
            this.expandedStatePath = this.view.className ? this.view.className + '.expanded' : 'state.expanded';
            ListHeader.setPersistedState(this.expandedStatePath, ListHeader.getPersistedState(this.expandedStatePath, false));
            // @property {Boolean} enable the eventName trigger
            this.eventFilter = options.eventFilter;
            // @property {String} to handle filter behavior in particular view
            this.eventName = options.eventName;
            // @property {Boolean} to allows if "from" or "to" date filters can be empty
            this.allowEmptyBoundaries = options.allowEmptyBoundaries;
        },
        destroy: function () {
            this.clearRangeFilterTimeout();
            this._destroy();
        },
        childViews: {
            'GlobalViews.Pagination': function () {
                return new GlobalViewsPaginationView(_.extend({
                    currentPage: this.page,
                    totalPages: Math.ceil(this.collection.totalRecordsFound / this.collection.recordsPerPage),
                    pager: this.pager
                }, Configuration.defaultPaginationSettings));
            },
            'GlobalViews.ShowCurrentPage': function () {
                return new GlobalViewsShowingCurrentView({
                    current_page: this.page,
                    items_per_page: this.collection.recordsPerPage,
                    total_items: this.collection.totalRecordsFound,
                    total_pages: Math.ceil(this.collection.totalRecordsFound / this.collection.recordsPerPage),
                    extraClass: 'pull-right'
                });
            }
        }    // @method getContext @returns {ListHeader.View.Context}
,
        getContext: function () {
            var self = this, hideHeaderExpandable = _.isFunction(this.hideFilterExpandable) ? this.hideFilterExpandable() : this.hideFilterExpandable, selected_filter, selected_sort;
            if (this.selectedFilter) {
                selected_filter = _.isFunction(this.selectedFilter.value) ? this.selectedFilter.value.apply(this.view) : this.selectedFilter.value;
            }
            if (this.selectedSort) {
                selected_sort = this.selectedSort.value;
            }
            _.each(this.displays, function (display) {
                display.url = _(self.displayer(display.id)).fixUrl();
                display.activeClassName = self.selectedDisplay.id === display.id ? 'active' : '';
            });
            _.each(this.filters, function (filter) {
                var item_value = _.isFunction(filter.value) ? filter.value.apply(self.view) : filter.value;
                filter.cssClassName = filter.className || '';
                filter.itemValue = item_value;
                filter.selected = selected_filter === item_value ? true : false;
            });
            _.each(this.sorts, function (sort) {
                sort.selected = selected_sort === sort.value ? true : false;
            });
            // @class ListHeader.View.Context
            return {
                // @property {Boolean} showHeader
                showHeader: !!(this.displays || this.rangeFilter || this.filters || this.collection.length)    // @property {String} headerMarkup
,
                headerMarkup: _.isFunction(this.headerMarkup) ? this.headerMarkup() : this.headerMarkup,
                classes: this.classes || ''    // @property {Boolean} showHeaderExpandable
,
                showHeaderExpandable: !hideHeaderExpandable    // @property {Array} displays
,
                displays: this.displays,
                rangeFilter: this.rangeFilter,
                selectedRangeFrom: this.selectedRange && this.selectedRange.from,
                rangeFilterLabel: _.isUndefined(this.rangeFilterLabel) ? _('From').translate() : _(this.rangeFilterLabel).translate()    // @property {String} rangeFilterFromMin
,
                rangeFilterFromMin: this.rangeFilterOptions.fromMin || ''    // @property {String} rangeFilterFromMax
,
                rangeFilterFromMax: this.rangeFilterOptions.fromMax || ''    // @property {Number} selectedRangeTo
,
                selectedRangeTo: this.selectedRange && this.selectedRange.to,
                rangeFilterToMin: this.rangeFilterOptions.toMin || ''    // @property {String} rangeFilterToMax
,
                rangeFilterToMax: this.rangeFilterOptions.toMax || ''    // @property {Array} filters
,
                filters: this.filters,
                sorts: this.sorts,
                sortIconUp: this.order > 0 ? 'listheader-filter-sortorder-arrow-selected' : ''    // @property {String} sortIconDown
,
                sortIconDown: this.order < 0 ? 'listheader-filter-sortorder-arrow-selected' : ''    // @property {Boolean} showSelectAll
,
                showSelectAll: this.selectable && this.collection.length > 1    // @property {Number} unselectedLength
,
                unselectedLength: this.getUnselectedLength()    // @property {Number} collectionLength
,
                collectionLength: this.getCollectionLength()    // @property {Boolean} showPagination
,
                showPagination: !this.options.hidePagination ? !!(this.collection.totalRecordsFound && this.collection.recordsPerPage) : false    // @property {Boolean} showCurrentPage
,
                showCurrentPage: !!this.options.showCurrentPage,
                initiallyCollapsed: _.isPhoneDevice() || _.isTabletDevice() ? 'collapse' : ''
            };    // @class ListHeader.View
        }    // @method toggleFilters
,
        toggleFilters: function (e) {
            e.preventDefault();
            var current_target = jQuery(e.currentTarget), filter_icon = current_target.find('.filter-icon'), is_expanded = ListHeader.getPersistedState(this.expandedStatePath, false);
            is_expanded ? filter_icon.addClass('icon-chevron-down').removeClass('icon-chevron-up') : filter_icon.removeClass('icon-chevron-down').addClass('icon-chevron-up');
            ListHeader.setPersistedState(this.expandedStatePath, !is_expanded);
            current_target.parents('[data-type="accordion"]').toggleClass('well').toggleClass('facet-header-white-well').find('[data-type="accordion-body"]').stop().slideToggle().removeClass('collapse');
        }    // @method clearRangeValue
,
        clearRangeValue: function (e) {
            var input = jQuery(e.currentTarget).parent().find('[data-action="range-filter"]');
            input.val('');
            this.rangeFilterHandler();
        }    // @method getExpanded
,
        getExpanded: function () {
            return ListHeader.getPersistedState(this.expandedStatePath, false);
        }    //@method getInitialDateRange
             //@param  {String} url_range
             //@returns {from:string,to:string} the initial date range to apply
,
        getInitialDateRange: function (url_range) {
            if (this.rangeFilter) {
                var date_range_fromUrl = this.getRangeFromUrl(url_range);
                if (date_range_fromUrl.from || date_range_fromUrl.to) {
                    // By doing this, I can be sure I'm not entering out of range values in the filter input fields.
                    // However, if invalid values are entered, they are not considered for filtering.
                    this.validateDateRange(date_range_fromUrl);
                    return date_range_fromUrl;
                } else {
                    var quantityDays = this.notUseDefaultDateRange ? this.quantityDaysRange : this.application.getConfig('listHeader.filterRangeQuantityDays');
                    if (quantityDays) {
                        var from = new Date(), to = new Date();
                        from.setDate(from.getDate() - quantityDays);
                        return {
                            from: _.dateToString(from),
                            to: _.dateToString(to)
                        };
                    }
                }
            }
        }    // @method getUnselectedLength @returns {Number}the number of unselected items
,
        getUnselectedLength: function () {
            return this.collection.filter(function (record) {
                return !record.get('checked');
            }).length;
        }    // @method getCollectionLength @returns {Number} the length of the current collection. This is a function so it can be overriden be any client of the list header
,
        getCollectionLength: function () {
            return this.collection.length;
        }    // @method setSelecteds set the selected rows from url information
,
        setSelecteds: function () {
            var url_options = _.parseUrlOptions(Backbone.history.fragment);
            this.selectedFilter = this.getFilterFromUrl(url_options.filter);
            this.selectedRange = this.getInitialDateRange(url_options.range) || {};
            this.selectedSort = this.getSortFromUrl(url_options.sort);
            this.order = this.getOrderFromUrl(url_options.order);
            this.page = this.getPageFromUrl(url_options.page);
            this.selectedDisplay = this.getDisplayFromUrl(url_options.display);
        }    // when rendering we need to check
             // if there are options already set up in the url
,
        render: function () {
            // if there are no items in the collection, avoid rendering the list header
            if (this.totalCount === 0) {
                return;
            }
            if (!this.selectedFilter && !this.selectedSort && !this.order && !this.selectedRange && !this.selectedDisplay) {
                this.setSelecteds();
                // after we set the current status
                // we update the collection
                if (!this.avoidFirstFetch) {
                    this.updateCollection();
                }
            }
            this._render();
            this.updateCalendarButtons();
            if (this.options.customFilterHandler) {
                this.options.customFilterHandler(this.selectedFilter, this.getElementSort());
            }
        }    // @method updateCollection
             // the collection used by the view MUST have an update method
             // this method is going to be called whenever a sort/filter value changes
             // @return {ListHeader.View} Returns itself
,
        updateCollection: function () {
            var range = null, collection = this.collection;
            if (this.selectedRange) {
                //@class RangeFilter
                //If there is no date selected i keep the range empty in order to get "transactions" dated in the future
                range = {
                    //@property {String} from
                    from: this.selectedRange.from || (this.allowEmptyBoundaries ? '' : this.rangeFilterOptions.fromMin)    //@property {String} to
,
                    to: this.selectedRange.to || (this.allowEmptyBoundaries ? '' : this.rangeFilterOptions.toMax)
                };
            }
            //@lass Collection.Filter
            collection.update && collection.update({
                //@property {value:String} filter
                filter: this.selectedFilter,
                range: range    //@property {value:String} sort
,
                sort: this.selectedSort,
                order: this.order,
                page: this.page,
                killerId: AjaxRequestsKiller.getKillerId()
            }, this);
            //@class ListHeader.View
            return this;
        }    // @method getFilter @param {String} value @returns {Object} a specific filter
,
        getFilter: function (value) {
            return _(this.filters).find(function (filter) {
                return _.isFunction(filter.value) ? filter.value.apply(this.view) === value : filter.value === value;
            }, this);
        }    // @method getSort @param {String} value @returns {Object} returns a specific sort
,
        getSort: function (value) {
            return _.findWhere(this.sorts, { value: value });
        }    // @metod getElementSort @returns {object} returns specific element from view
,
        getElementSort: function () {
            return this.$('select[name=sort]');
        }    // @method getDisplay @param {String} value @returns {Object} a specific display
,
        getDisplay: function (value) {
            return _.findWhere(this.displays, { id: value });
        }    // @method getFilterFromUrl @param {String} url_value @returns {Object} the selected filter from the url
             // or the default filter if no value set up
,
        getFilterFromUrl: function (url_value) {
            return this.getFilter(url_value) || this.getDefaultFilter();
        }    // @method getRangeFromUrl @param {String} url_value @returns {from:String,to:String}
,
        getRangeFromUrl: function (url_value) {
            var split = url_value ? url_value.split('to') : [];
            return {
                from: split[0],
                to: split[1]
            };
        }    // @method getSortFromUrl @param {String} url_value @returns the selected sort from the url
             // or the default sort if no value set up
,
        getSortFromUrl: function (url_value) {
            return this.getSort(url_value) || this.getDefaultSort();
        }    // @method getOrderFromUrl @param {String} url_value @returns the selected order from the url
             // this could be inverse or nothing
,
        getOrderFromUrl: function (url_value) {
            return url_value === 'inverse' ? -1 : 1;
        }    // @method getDisplayFromUrl Retrieve current selected display option or 'list' by default @param {String} url_value @returns {String}
,
        getDisplayFromUrl: function (url_value) {
            return this.getDisplay(url_value) || this.getDefaultDisplay();
        }    // @method getPageFromUrl @param {String} url_value @returns {Number}
,
        getPageFromUrl: function (url_value) {
            var page_number = parseInt(url_value, 10);
            return !isNaN(page_number) && page_number > 0 ? page_number : 1;
        }    // @method pager @param {String} url_value @returns {String}
,
        pager: function (url_value) {
            var page_number = parseInt(url_value, 10), url = Backbone.history.fragment;
            return isNaN(page_number) || page_number === 1 ? _.removeUrlParameter(url, 'page') : _.setUrlParameter(url, 'page', page_number);
        }    // @method displayer @param {String} display_option @returns {String}
,
        displayer: function (display_option) {
            var url = Backbone.history.fragment;
            return display_option === this.getDefaultDisplay().id ? _.removeUrlParameter(url, 'display') : _.setUrlParameter(url, 'display', display_option);
        }    // @method getDefaultFilter if there's already a default filter, return that
             // otherwise find the one selected on the filter list @return {String}
,
        getDefaultFilter: function () {
            return this.defaultFilter || (this.defaultFilter = _.findWhere(this.filters, { selected: true }) || _.first(this.filters));
        }    // @method getDefaultSort if there's already a default sort, return that
             // otherwise find the one selected on the sort list @return {String}
,
        getDefaultSort: function () {
            return this.defaultSort || (this.defaultSort = _.findWhere(this.sorts, { selected: true }) || _.first(this.sorts));
        }    // @method getDefaultDisplay
,
        getDefaultDisplay: function () {
            return this.defaultDisplay || (this.defaultDisplay = _.findWhere(this.displays, { selected: true }) || _.first(this.displays));
        }    // @method isDefaultFilter @returns {Boolean}
,
        isDefaultFilter: function (filter) {
            return this.getDefaultFilter() === filter;
        }    // @method isDefaultSort @returns {Boolean}
,
        isDefaultSort: function (sort) {
            return this.getDefaultSort() === sort;
        }    // @method isDefaultDisplay @returns {Boolean}
,
        isDefaultDisplay: function (display) {
            return this.getDefaultDisplay() === display;
        }    // @method filterHandler method called when dom dropdown change
,
        filterHandler: function (e) {
            // unselect all elements
            this.unselectAll({ silent: true });
            // sets the selected filter
            this.selectedFilter = this.getFilter(e.target.value);
            // updates the url and the collection
            this.updateUrl();
        }    // @method sortHandler method called when dom dropdown change
,
        sortHandler: function (e) {
            // sets the selected sort
            this.selectedSort = this.getSort(e.target.value);
            // updates the url and the collection
            this.updateUrl();
        }    // @method toggleSortHandler method called when dom button clicked
,
        toggleSortHandler: function (e) {
            if (e) {
                e.preventDefault();
            }
            // toggles the selected order
            this.order *= -1;
            // updates the url and the collection
            this.updateUrl();
        }    // @method selectAll selects all in collection
,
        selectAll: function () {
            if ('selectAll' in this.view) {
                this.view.selectAll();
            }
            return this;
        }    // @method unselectAll unselects in collection
,
        unselectAll: function (options) {
            if ('unselectAll' in this.view) {
                this.view.unselectAll(options);
            }
            return this;
        }    // @method rangeFilterBlur
,
        rangeFilterBlur: function () {
            this.clearRangeFilterTimeout();
            this.rangeFilterTimeout = setTimeout(_.bind(this.rangeFilterHandler, this), 1000);
        }    // @method clearRangeFilterTimeout
,
        clearRangeFilterTimeout: function () {
            if (this.rangeFilterTimeout) {
                clearTimeout(this.rangeFilterTimeout);
                this.rangeFilterTimeout = null;
            }
        }    // @method rangeFilterHandler
,
        rangeFilterHandler: function () {
            var selected_range = this.selectedRange, $ranges = this.$('[data-action="range-filter"]');
            $ranges.each(function () {
                if (this.value) {
                    selected_range[this.name] = this.value;
                } else {
                    delete selected_range[this.name];
                }
            });
            if (this.validateDateRange(selected_range)) {
                // updates the url and the collection
                this.updateUrl();
            } else {
                this.showError(this.application.getErrorMessage('invalidDateFormat'));
            }
            return this;
        }    // @method validateDateRange Indicate if a certain range is valid or not
             // @param {} selected_range
             // @return {Boolean} If the selected range if valid or not
,
        validateDateRange: function (selected_range) {
            var options = this.rangeFilterOptions, is_valid = true, to = new Date(selected_range.to), from = new Date(selected_range.from), toMin = new Date(options.toMin), toMax = new Date(options.toMax), fromMin = new Date(options.fromMin), fromMax = new Date(options.fromMax), validateRange = {};
            if (options.toMin && _.isDateValid(toMin) && _.isDateValid(to) && to.getTime() < toMin.getTime()) {
                validateRange.to = options.toMin;
            } else if (!selected_range.to || options.toMax && _.isDateValid(toMax) && _.isDateValid(to) && to.getTime() > toMax.getTime()) {
                validateRange.to = options.toMax;
            }
            if (!selected_range.from || options.fromMin && _.isDateValid(fromMin) && _.isDateValid(from) && from.getTime() < fromMin.getTime()) {
                validateRange.from = options.fromMin;
            } else if (options.fromMax && _.isDateValid(fromMax) && _.isDateValid(from) && from.getTime() > fromMax.getTime()) {
                validateRange.from = options.fromMax;
            }
            if (validateRange.to && !_.isDateValid(_.stringToDate(validateRange.to))) {
                is_valid = false;
                delete selected_range.to;
            }
            if (validateRange.from && !_.isDateValid(_.stringToDate(validateRange.from))) {
                is_valid = false;
                delete selected_range.from;
            }
            return is_valid;
        }    // @method updateUrl Updates the URL with the new applied filters
             // @return {ListHeader.View} Return itself
,
        updateUrl: function () {
            var url = Backbone.history.fragment;
            // if the selected filter is the default one
            //   remove the filter parameter
            // else change it for the selected value
            url = this.isDefaultFilter(this.selectedFilter) ? _.removeUrlParameter(url, 'filter') : _.setUrlParameter(url, 'filter', _.isFunction(this.selectedFilter.value) ? this.selectedFilter.value.apply(this.view) : this.selectedFilter.value);
            // if the selected sort is the default one
            //   remove the sort parameter
            // else change it for the selected value
            url = this.isDefaultSort(this.selectedSort) ? _.removeUrlParameter(url, 'sort') : _.setUrlParameter(url, 'sort', this.selectedSort.value);
            // if the selected order is the default one
            //   remove the order parameter
            // else change it for the selected value
            url = this.order === 1 ? _.removeUrlParameter(url, 'order') : _.setUrlParameter(url, 'order', 'inverse');
            // if range from and range to are set up
            //   change them in the url
            // else remove the parameter
            if (this.selectedRange) {
                url = this.selectedRange.from || this.selectedRange.to ? _.setUrlParameter(url, 'range', (this.selectedRange.from || '') + 'to' + (this.selectedRange.to || '')) : _.removeUrlParameter(url, 'range');
            }
            url = _.removeUrlParameter(url, 'page');
            this.page = 1;
            // just go there already, but warn no one
            Backbone.history.navigate(url, { trigger: false });
            return this.updateCollection();
        }    // @method updateCalendarButtons
             // @return {Void}
,
        updateCalendarButtons: function () {
            var $ranges = this.$('[data-action="range-filter"]');
            $ranges.each(function () {
                var parent = jQuery(this).parent(), calendar_icon = parent.find('.list-header-view-accordion-body-calendar-icon'), clear_button = parent.find('.list-header-view-accordion-body-clear');
                if (this.value) {
                    calendar_icon.hide();
                    clear_button.show();
                } else {
                    calendar_icon.show();
                    clear_button.hide();
                }
            });
        }
    });
    //class methods (static)
    ListHeader = _.extend(ListHeader, {
        // @method setPersistedState Allow save STATICALY any value to be shared by all ListHeader instances
        // @param {String} path @param {String} value @static
        setPersistedState: function (path, value) {
            return _.setPathFromObject(this.state = this.state || {}, path, value);
        }    // @method getPersistedState Allow get STATICALY any value to be shared by all ListHeader instances
             // @param {String} path @param {String} default_value @static
,
        getPersistedState: function (path, default_value) {
            return _.getPathFromObject(this.state = this.state || {}, path, default_value);
        }
    });
    return ListHeader;
});    //@class ListHeader.View.initialize.Options
       //@property {Backbone.View} view
       //@property {Boolean} avoidFirstFetch True only if the module using list header is the one responsible of fetching the collection for the first time (optional)
       //@property {Number} totalCount
       //@class ListHeader.View.FilterOption
       //@property {String} value
       //@property {String} name
       //@property {Boolean} selected
       //@class ListHeader.View.SortOption
       //@property {String} value
       //@property {String} name
       //@property {Boolean} selected



/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.BulkActions.View', [
    'product_list_bulk_actions.tpl',
    'Backbone'
], function (product_list_bulk_actions_tpl, Backbone) {
    'use strict';
    // @class ProductList.BulkActions.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_list_bulk_actions_tpl    // @method getContext @return ProductList.BulkActions.View.Context
,
        getContext: function () {
            var model = this.options.model, isAtLeastOneItemChecked = model.someCheckedItemsExist();
            return {
                // @property {Boolean} isAtLeastOneItemChecked
                isAtLeastOneItemChecked: isAtLeastOneItemChecked    // @property {Boolean} hasItems
,
                hasItems: model.get('items').length,
                isAddToCartEnabled: isAtLeastOneItemChecked && model.canBeAddedToCart(true)    // @property {Boolean} isTypePredefined
,
                isTypePredefined: model.get('typeName') === 'predefined'
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
// -----------------------
// Views for handling Product Lists (CRUD)
define('ProductList.Details.View', [
    'ProductList.Item.Collection',
    'ProductList.Model',
    'ProductList.Lists.View',
    'ProductList.AddedToCart.View',
    'ProductList.Item.Edit.View',
    'ProductList.Item.Model',
    'ProductList.Control.View',
    'ListHeader.View',
    'MenuTree.View',
    'product_list_details.tpl',
    'LiveOrder.Model',
    'Backbone.CollectionView',
    'ProductList.DisplayFull.View',
    'ProductList.BulkActions.View',
    'Backbone.CompositeView',
    'Handlebars',
    'underscore',
    'jQuery',
    'Backbone',
    'Backbone.View',
    'Backbone.View.render',
    'Utils'
], function (ProductListItemCollection, ProductListModel, ProductListListsView, ProductListAddedToCartView, ProductListItemEditView, ProductListItemModel, ProductListControlView, ListHeaderView, MenuTreeView, product_list_details_tpl, LiveOrderModel, BackboneCollectionView, ProductListDisplayFullView, ProductListBulkActionsView, BackboneCompositeView, Handlebars, _, jQuery, Backbone) {
    'use strict';
    // @class ProductList.Details.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_list_details_tpl,
        className: 'ProductListDetailsView',
        attributes: { 'class': 'ProductListDetailsView' },
        events: {
            // items events
            'click [data-action="add-to-cart"]': 'addItemToCartHandler',
            'click [data-action="add-items-to-cart"]': 'addItemsToCartBulkHandler',
            'click [data-action="delete-items"]': 'deleteItemsHandler',
            'click [data-action="edit-item"]': 'askEditListItem',
            'click [data-action="update-item-quantity"]': 'updateListItemQuantity',
            'click [data-action="update-item-quantity-max"]': 'updateListItemMaxQuantity',
            'click [data-ui-action="show-edit-notes"]': 'showEditNotes',
            'click [data-ui-action="cancel-edit-notes-form"]': 'showViewNotes',
            'click [data-action="add-list-to-cart"]': 'addListToCart_',
            'click [data-action="edit-list"]': 'editListHandler',
            'change [data-action="change-quantity"]': 'updateItemQuantity',
            'keyup [data-action="change-quantity"]': 'updateItemQuantity',
            'submit [data-action="update-quantity-item-list"]': 'updateItemQuantityFormSubmit',
            'click [data-action="product-list-item"]': 'toggleProductListItemHandler'
        },
        sortOptions: [
            {
                value: 'sku',
                name: _('Sort by name').translate(),
                selected: true
            },
            {
                value: 'price',
                name: _('Sort by price').translate()
            },
            {
                value: 'created',
                name: _('Sort by date Added').translate()
            },
            {
                value: 'priority',
                name: _('Sort by priority').translate()
            }
        ],
        initialize: function (options) {
            this.options = options;
            this.model = options.model;
            this.application = options.application;
            this.cart = LiveOrderModel.getInstance();
            this.displayOptions = this.application.getConfig('productList.templates');
            this.includeSortingFilteringHeader = options.includeSortingFilteringHeader;
            this.title = this.model.get('name');
            this.collection = this.model.get('items');
            this.collection.productListId = this.model.get('internalid');
            this.setupListHeader(this.collection);
            this.on('afterCompositeViewRender', function () {
                var self = this, out_of_stock_items = [], items = this.model.get('items'), is_single_list = this.application.ProductListModule.Utils.isSingleList();
                items.each(function (item) {
                    if (!item.get('item').get('_isPurchasable')) {
                        out_of_stock_items.push(item);
                    }
                    if (!is_single_list) {
                        self.renderMove(item);
                    }
                });
                var warning_message = null;
                if (out_of_stock_items.length === 1) {
                    warning_message = _('$(0) of $(1) items in your list is currently not available for purchase. If you decide to add the list to your cart, only available products will be added.').translate(out_of_stock_items.length, items.length);
                } else if (out_of_stock_items.length > 1) {
                    warning_message = _('$(0) of $(1) items in your list are currently not available for purchase. If you decide to add the list to your cart, only available products will be added.').translate(out_of_stock_items.length, items.length);
                }
                if (warning_message) {
                    self.showWarningMessage(warning_message);
                }
            });
            BackboneCompositeView.add(this);
            this.collection.on('reset', jQuery.proxy(this, 'render'));
        }    // @method setupListHeader @param {Backbone.Collection} collection
,
        setupListHeader: function (collection) {
            if (!this.includeSortingFilteringHeader) {
                return;
            }
            var self = this;
            this.listHeader = new ListHeaderView({
                view: this,
                application: this.application,
                avoidFirstFetch: true,
                headerMarkup: function () {
                    var view = new ProductListBulkActionsView({ model: self.model });
                    view.render();
                    return new Handlebars.SafeString(view.$el.html());
                },
                hideFilterExpandable: function () {
                    return this.collection.length < 2;
                },
                selectable: true,
                collection: collection,
                sorts: this.sortOptions
            });
        }    // @method addListToCart_ add this list to cart handler
,
        addListToCart_: function () {
            this.addListToCart(this.model);
        }    // @method addListToCart
,
        addListToCart: ProductListListsView.prototype.addListToCart,
        addItemToCartHandler: function (e) {
            e.stopPropagation();
            e.preventDefault();
            var self = this, selected_product_list_item_id = self.$(e.target).closest('article').data('id'), selected_product_list_item = self.model.get('items').findWhere({ internalid: selected_product_list_item_id.toString() }), selected_item = selected_product_list_item.get('item'), selected_item_internalid = selected_item.internalid, item_detail = selected_product_list_item.getItemForCart(selected_item_internalid, selected_product_list_item.get('quantity'), selected_item.itemoptions_detail, selected_product_list_item.getOptionsArray());
            var add_to_cart_promise = this.addItemToCart(item_detail), whole_promise = jQuery.when(add_to_cart_promise).then(jQuery.proxy(this, 'showConfirmationHelper', selected_product_list_item));
            if (whole_promise) {
                this.disableElementsOnPromise(whole_promise, 'article[data-item-id="' + selected_item_internalid + '"] a, article[data-item-id="' + selected_item_internalid + '"] button');
            }
        }    // @method _getSelection @return {items:ProductList.Item.Collection,items_for_cart:Array<Backbone.Model>,button_selector:String}
,
        _getSelection: function () {
            var items = [], button_selector = [];
            //Filter items for bulk operation
            _.each(this.collection.models, function (pli) {
                //irrelevant items: no-op
                if (pli.get('checked') !== true) {
                    return;
                }
                items.push(pli);
                var item_internal_id = pli.getItemId();
                button_selector.push('article[data-item-id="' + item_internal_id + '"] a, article[data-item-id="' + item_internal_id + '"] button');
            });
            return {
                items: new ProductListItemCollection(items),
                button_selector: button_selector
            };
        }    //@method addItemsToCartBulkHandler
,
        addItemsToCartBulkHandler: function (e) {
            e.preventDefault();
            var self = this, selected_models = this._getSelection();
            //no items selected: no opt
            if (selected_models.items.length < 1) {
                return;
            }
            var button_selector = selected_models.button_selector.join(',')    //add items to cart
, add_to_cart_promise = this.cart.addProducts(selected_models.items.models);
            add_to_cart_promise.then(function () {
                self.unselectAll();
                self.showConfirmationHelper();
            });
            this.disableElementsOnPromise(add_to_cart_promise, button_selector);
        }    // @method deleteItemsHandler
,
        deleteItemsHandler: function (e) {
            e.preventDefault();
            var self = this, selected_models = this._getSelection(), delete_promises = [];
            if (selected_models.items.length < 1) {
                return;
            }
            //there are two collections with the same information this.model and the one on application
            //should remove the item on both
            var app_item_list = _.findWhere(self.application.ProductListModule.Utils.getProductLists().models, { id: self.model.id });
            _.each([].concat(selected_models.items.models), function (item) {
                //fix already used in "deleteListItem"
                item.url = ProductListItemModel.prototype.url;
                app_item_list && app_item_list.get('items').remove(item);
                delete_promises.push(item.destroy().promise());
            });
            jQuery.when.apply(jQuery, delete_promises).then(function () {
                self.render();
                MenuTreeView.getInstance().updateMenuItemsUI();
                self.showConfirmationMessage(_('The selected items were removed from your product list').translate());
            });
        }    // @method selectAll this is called from the ListHeader when you check select all.
,
        selectAll: function () {
            _.each(this.collection.models, function (item) {
                item.set('checked', true);
            });
            this.render();
        }    // @method unselectAll
,
        unselectAll: function () {
            _.each(this.collection.models, function (item) {
                item.set('checked', false);
            });
            this.render();
        }    // @method showConfirmationHelper
,
        showConfirmationHelper: function (selected_item) {
            this.showConfirmationMessage(_('Good! The items were successfully added to your cart. You can continue to <a href="#" data-touchpoint="viewcart">view cart and checkout</a>').translate());
            //selected item may be undefined
            if (_.isUndefined(selected_item) === true) {
                return;
            }
            this.addedToCartView = new ProductListAddedToCartView({
                application: this.application,
                parentView: this,
                item: selected_item
            });
            this.application.getLayout().showInModal(this.addedToCartView);
        }    // @method addItemToCart Adds the item to the cart
,
        addItemToCart: function (item) {
            return this.cart.addItem(item);
        }    // @method deleteListItem Remove an product list item from the current list @param {ProductList.Item.Model} product_list_item @param {Function} successFunc
,
        deleteListItem: function (product_list_item, successFunc) {
            this.model.get('items').remove(product_list_item);
            product_list_item.url = ProductListItemModel.prototype.url;
            var promise = product_list_item.destroy();
            promise && successFunc && promise.done(function () {
                successFunc();
            });
        }    // @method askEditListItem Edit a product list item from the current list
,
        askEditListItem: function (e) {
            e.stopPropagation();
            var product_list_itemid = this.$(e.target).closest('[data-id]').data('id'), selected_item = this.model.get('items').get(product_list_itemid), editView = new ProductListItemEditView({
                    application: this.application,
                    parentView: this,
                    model: selected_item,
                    title: _('Edit Item').translate(),
                    confirm_edit_method: 'editListItemHandler'
                });
            this.application.getLayout().showInModal(editView);
        }    // @method updateListItemQuantity Updates product list item quantity from the current list
,
        updateListItemQuantity: function (e) {
            this.updateListItemMinMaxQuantity(e, '_minimumQuantity');
        },
        updateListItemMaxQuantity: function (e) {
            this.updateListItemMinMaxQuantity(e, '_maximumQuantity');
        },
        updateListItemMinMaxQuantity: function (e, minMax) {
            e.preventDefault();
            var self = this, product_list_itemid = this.$(e.target).data('id'), selected_pli = this.model.get('items').findWhere({ internalid: product_list_itemid.toString() }), quantity = selected_pli.get('item').get(minMax), promise = this.updateItemQuantityHelper(selected_pli, quantity);
            promise && promise.done(function () {
                self.render();
            });
        }    // @method editListItemHandler Product list item edition handler
,
        editListItemHandler: function (new_attributes) {
            var new_model = new ProductListItemModel(new_attributes), products = this.model.get('items'), original_model = products.get(new_attributes.internalid), original_model_index = products.indexOf(original_model);
            this.model.get('items').remove(new_attributes.internalid, { silent: true });
            this.model.get('items').add(new_model, { at: original_model_index });
            this.render();
        }    // @method getDisplayOption Retrieve the current (if any) items display option
,
        getDisplayOption: function () {
            var search = this.options.params && this.options.params.display || 'list';
            return _(this.displayOptions).findWhere({ id: search });
        }    // @method renderMove Renders the move control for a product list
             // @param {ProductList.Model} product_list_model
,
        renderMove: function (product_list_model) {
            var self = this, container = this.$('[data-id="' + product_list_model.id + '"]').find('[data-type="productlist-control-move"]'), control = new ProductListControlView({
                    collection: self.getMoveLists(self.application.ProductListModule.Utils.getProductLists(), self.model, product_list_model),
                    product: product_list_model,
                    application: self.application,
                    countedClicks: {},
                    moveOptions: {
                        parentView: self,
                        productListItem: product_list_model
                    }
                });
            jQuery(container).empty().append(control.$el);
            control.render();
        }    // @method getMoveLists Filters all lists so it does not include the current list and the lists where the item is already present
,
        getMoveLists: function (all_lists, current_list, list_item) {
            return all_lists.filtered(function (model) {
                return model.get('internalid') !== current_list.get('internalid') && !model.get('items').find(function (product_item) {
                    // return product_item.get('item').id === list_item.get('item').id;
                    return product_item.isEqual(list_item);
                });
            });
        }    // @method editListHandler Shows the edit modal view
,
        editListHandler: function (event) {
            event.preventDefault();
            ProductListListsView.prototype.editList.apply(this, [this.model]);
        }    // @method getSelectedMenu
,
        getSelectedMenu: function () {
            return 'productlist_' + (this.model.get('internalid') ? this.model.get('internalid') : 'tmpl_' + this.model.get('templateid'));
        }    // @method getBreadcrumbPages
,
        getBreadcrumbPages: function () {
            var breadcrumb = [
                {
                    text: _('Wishlist').translate(),
                    href: '/wishlist'
                },
                {
                    text: this.model.get('name'),
                    href: '/wishlist/' + (this.model.get('internalid') ? this.model.get('internalid') : 'tmpl_' + this.model.get('templateid'))
                }
            ];
            if (this.application.ProductListModule.Utils.isSingleList()) {
                breadcrumb.splice(0, 1);    //remove first
            }
            return breadcrumb;
        }    // @method updateItemQuantityFormSubmit Updates quantity on form submit.
,
        updateItemQuantityFormSubmit: function (e) {
            e.preventDefault();
            this.updateItemQuantity(e);
        }    // @method updateItemQuantityHelper Helper function. Used in updateItemQuantity and updateListItemQuantity functions.
,
        updateItemQuantityHelper: function (selected_item, new_quantity) {
            selected_item.set('quantity', new_quantity);
            var self = this, edit_result = selected_item.save(null, { validate: false });
            if (edit_result) {
                edit_result.done(function (new_attributes) {
                    var new_model = new ProductListItemModel(new_attributes);
                    self.model.get('items').add(new_model, { merge: true });
                    var item_list = self.application.ProductListModule.Utils.getProductLists().findWhere({ id: self.model.id });
                    item_list && item_list.get('items').get(selected_item.id).set('quantity', new_quantity);
                });
            }
            return edit_result;
        }    // @method updateItemQuantity executes on blur of the quantity input. Finds the item in the product list, updates its quantity and saves the list model
,
        updateItemQuantity: _.debounce(function (e) {
            e.preventDefault();
            var product_list_itemid = this.$(e.target).closest('article').data('id'), selected_item = this.model.get('items').findWhere({ internalid: product_list_itemid.toString() }), options = jQuery(e.target).closest('form').serializeObject(), $input = jQuery(e.target).closest('form').find('[name="item_quantity"]'), new_quantity = parseInt(options.item_quantity, 10), current_quantity = parseInt(selected_item.get('quantity'), 10), minimum_quantity = parseInt(selected_item.get('item').get('_minimumQuantity'), 10) || 0, maximum_quantity = parseInt(selected_item.get('item').get('_maximumQuantity'), 10);
            new_quantity = new_quantity > 0 && new_quantity > minimum_quantity ? new_quantity : minimum_quantity || current_quantity;
            new_quantity = !!maximum_quantity && new_quantity > maximum_quantity ? maximum_quantity : new_quantity;
            $input.val(new_quantity);
            if (new_quantity === current_quantity) {
                return;
            }
            $input.val(new_quantity).prop('disabled', true);
            var edit_promise = this.updateItemQuantityHelper(selected_item, new_quantity);
            if (!edit_promise) {
                return;
            }
            edit_promise.always(function () {
                $input.prop('disabled', false);
            });
        }, 600)    // @method toggleProductListItemHandler
,
        toggleProductListItemHandler: function toggleProductListItemHandler(e) {
            this.toggleProductListItem(jQuery(e.target).closest('[data-id]').data('id'));
        }    // @method toggleProductListItem
,
        toggleProductListItem: function (pli) {
            pli = this.collection.get(pli);
            if (pli) {
                this[pli.get('checked') ? 'unselectProductListItem' : 'selectProductListItem'](pli);
                this.render();
            }
        }    // @method toggleProductListItem
,
        selectProductListItem: function (pli) {
            if (pli) {
                pli.set('checked', true);
            }
        }    // @method unselectProductListItem
,
        unselectProductListItem: function (pli) {
            if (pli) {
                pli.set('checked', false);
            }
        },
        childViews: {
            'ListHeader': function () {
                return this.listHeader;
            },
            'ProductList.DynamicDisplay': function () {
                var displayOption = this.getDisplayOption(), rows = parseInt(displayOption.columns, 10) || 3;
                return new BackboneCollectionView({
                    childView: ProductListDisplayFullView,
                    collection: this.model.get('items').models,
                    viewsPerRow: rows,
                    childViewOptions: {
                        application: this.application,
                        show_edit_action: true,
                        show_move_action: true
                    }
                });
            }
        }    // @method getContext @return {ProductList.Details.View.Context}
,
        getContext: function () {
            var items = this.model.get('items');
            // @class ProductList.Details.View.Context
            return {
                // @property {Boolean} showListHeader
                showListHeader: !(items.length === 0 && this.model.get('typeName') === 'predefined')    // @property {Boolean} isTypePredefined
,
                isTypePredefined: this.model.get('typeName') === 'predefined'    // @property {String} name
,
                name: this.model.get('name')    // @property {Boolean} hasItems
,
                hasItems: items.length > 0    // @property {Integer} itemsLength
,
                itemsLength: items.length,
                hasOneItem: items.length === 1
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
// ProductList.Deletion.Views.js
// -----------------------
// View to handle Product Lists (lists and items) deletion
define('ProductList.Deletion.View', [
    'product_list_deletion.tpl',
    'underscore',
    'Backbone',
    'Backbone.View',
    'Backbone.View.render',
    'Utils'
], function (product_list_deletion_tpl, _, Backbone) {
    'use strict';
    // @class ProductList.Deletion.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_list_deletion_tpl,
        title: _('Delete item').translate(),
        attributes: { 'class': 'view product-list-deletion-confirm' },
        page_header: _('Delete item').translate(),
        events: { 'click [data-action="delete"]': 'confirmDelete' },
        initialize: function (options) {
            this.application = options.application;
            this.parentView = options.parentView;
            this.target = options.target;
            this.title = options.title;
            this.page_header = options.title;
            this.body = options.body;
            this.confirm_delete_method = options.confirm_delete_method;
            this.confirmLabel = options.confirmLabel || _('Yes, Remove It').translate();
        },
        render: function () {
            Backbone.View.prototype.render.apply(this, arguments);
            var self = this;
            this.$containerModal.on('shown.bs.modal', function () {
                self.$('[data-action="delete"]').focus();
            });
        }    // @method confirmDelete Invokes parent view delete confirm callback function
,
        confirmDelete: function () {
            this.parentView[this.confirm_delete_method](this.target);
        }    // @method getTitle Sets focus con cancel button and returns the title text
,
        getTitle: function () {
            return _('Delete product list').translate();
        }    // @method getContext @return {ProductList.Deletion.View.Context}
,
        getContext: function () {
            return {
                // @class ProductList.Deletion.View.Context
                // @property {String} body
                body: this.body,
                hasConfirmLabel: !!this.confirmLabel,
                confirmLabel: this.confirmLabel,
                hasCancelLabel: !!this.cancelLabel,
                cancelLabel: this.cancelLabel
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.DetailsLater.View', [
    'product_list_details_later.tpl',
    'ProductList.DetailsLaterMacro.View',
    'ProductList.Details.View',
    'ProductList.Deletion.View',
    'LiveOrder.Model',
    'Profile.Model',
    'Backbone.CollectionView',
    'Backbone.CompositeView',
    'products_detail_later_cell.tpl',
    'backbone_collection_view_row.tpl',
    'underscore',
    'jQuery',
    'Backbone',
    'Backbone.View',
    'Backbone.View.render'
], function (product_list_details_later_tpl, ProductListDetailsLaterMacroView, ProductListDetailsView, ProductListDeletionView, LiveOrderModel, ProfileModel, BackboneCollectionView, BackboneCompositeView, products_detail_later_cell_tpl, backbone_collection_view_row_tpl, _, jQuery, Backbone) {
    'use strict';
    var product_list_promise;
    // @class ProductList.DetailsLater.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_list_details_later_tpl,
        events: {
            // items events
            'click [data-action="add-to-cart"]': 'addItemToCartHandler',
            'click [data-action="delete-item"]': 'askDeleteListItem',
            'change [data-action="change-quantity"]': 'updateItemQuantity',
            'keyup [data-action="change-quantity"]': 'updateItemQuantity',
            'click [data-ui-action="add"]': 'addQuantity',
            'click [data-ui-action="minus"]': 'subQuantity'
        },
        initialize: function (options) {
            //this.loadProductList();
            BackboneCompositeView.add(this);
            this.options = options;
            this.application = options.application;
            this.cart = LiveOrderModel.getInstance();
            this.model.on('change', this.render, this);
            this.model.get('items').on('add remove change reset', this.render, this);
            this.promise = this.loadProductList();
        },
        render: function () {
            if (ProfileModel.getInstance().get('isLoggedIn') === 'T') {
                this._render();
                this.$('[data-action="pushable"]').scPush();
            } else {
                this.$el.empty();
            }
            return this;
        },
        loadProductList: function () {
            var self = this;
            if (!product_list_promise) {
                ProfileModel.getPromise().done(function () {
                    if (ProfileModel.getInstance().get('isLoggedIn') === 'T') {
                        product_list_promise = self.options.application.ProductListModule.Utils.getSavedForLaterProductList().done(function (attributes) {
                            self.model.set(attributes);
                        });
                    }
                });
            }
            return product_list_promise;
        }    // @method addItemToCartHandler Add a particular item into the cart
,
        addItemToCartHandler: function (e) {
            e.stopPropagation();
            e.preventDefault();
            var selected_product_list_item_id = this.$(e.target).closest('article').data('id'), selected_product_list_item = this.model.get('items').get(selected_product_list_item_id), add_to_cart_promise = this.cart.addLine(selected_product_list_item), whole_promise = jQuery.when(add_to_cart_promise, this.deleteListItem(selected_product_list_item));
            //.then(jQuery.proxy(this, 'executeAddToCartCallback'));
            this.disableElementsOnPromise(whole_promise, this.$(e.target).closest('article').find('button'));
        }    // @method addQuantity Increase the product's Quantity by 1
             // @param {HTMLEvent} e 
,
        addQuantity: function (e) {
            e.preventDefault();
            var $element = jQuery(e.target), oldValue = $element.parent().find('input').val(), newVal = parseFloat(oldValue) + 1;
            var input = $element.parent().find('input');
            input.val(newVal);
            input.trigger('change');
        }    // @method subQuantity Decreases the product's Quantity by 1
             // @param {HTMLEvent} e
,
        subQuantity: function (e) {
            e.preventDefault();
            var $element = jQuery(e.target), oldValue = $element.parent().find('input').val(), newVal = parseFloat(oldValue) - 1;
            newVal = Math.max(1, newVal);
            var input = $element.parent().find('input');
            input.val(newVal);
            input.trigger('change');
        }    // @method askDeleteListItem opens a confirmation dialog for deleting an item from the Saved for Later list.
             // @param {HTMLEvent} e
,
        askDeleteListItem: function (e) {
            e.stopPropagation();
            this.deleteConfirmationView = new ProductListDeletionView({
                application: this.application,
                parentView: this,
                target: e.target,
                title: _('Delete selected items').translate(),
                body: _('Are you sure you want to remove selected items?').translate(),
                confirmLabel: _('Yes').translate(),
                confirm_delete_method: 'deleteListItemHandler'
            });
            this.deleteConfirmationView.showInModal();
        }    // @method deleteListItemHandler deletes a single item from the Saved for Later list.
             // @param {HTMLEvent} e
,
        deleteListItemHandler: function (target) {
            var self = this, itemid = jQuery(target).closest('article').data('id'), product_list_item = this.model.get('items').findWhere({ internalid: itemid + '' }), success = function () {
                    if (self.application.getLayout().updateMenuItemsUI) {
                        self.application.getLayout().updateMenuItemsUI();
                    }
                    self.deleteConfirmationView.$containerModal.modal('hide');
                    self.render();
                    self.showConfirmationMessage(_('The item was removed from your product list').translate(), true);
                };
            self.model.get('items').remove(product_list_item);
            self.deleteListItem(product_list_item, success);
        },
        deleteListItem: ProductListDetailsView.prototype.deleteListItem,
        disableElementsOnPromise: ProductListDetailsView.prototype.disableElementsOnPromise,
        updateItemQuantity: ProductListDetailsView.prototype.updateItemQuantity,
        updateItemQuantityHelper: ProductListDetailsView.prototype.updateItemQuantityHelper,
        childViews: {
            'ProductList.DetailsLater.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.model.get('items'),
                    childView: ProductListDetailsLaterMacroView,
                    viewsPerRow: 4,
                    cellTemplate: products_detail_later_cell_tpl,
                    rowTemplate: backbone_collection_view_row_tpl,
                    childViewOptions: { application: this.application }
                });
            }
        }    // @method getContext @return {ProductList.DetailsLater.View.Context}
,
        getContext: function () {
            var items = this.model.get('items'), itemsLength = items.length;
            // @class ProductList.DetailsLater.View.Context
            return {
                // @property {Integer} itemsLength
                itemsLength: itemsLength    // @property {Boolean} hasItems
,
                hasItems: itemsLength > 0    // @property {Boolean} isEmpty
,
                isEmpty: itemsLength === 0    // @property {Boolean} hasMoreThanOneItem
,
                hasMoreThanOneItem: itemsLength > 1
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Transaction.Line.Views
define('Cart.Lines.View', [
    'Transaction.Line.Views.Price.View',
    'Transaction.Line.Views.Options.Selected.View',
    'ProductLine.Stock.View',
    'ProductLine.Sku.View',
    'ProductLine.StockDescription.View',
    'Transaction.Line.Views.Tax',
    'Backbone.CollectionView',
    'Backbone.CompositeView',
    'cart_lines.tpl',
    'Backbone',
    'underscore',
    'SC.Configuration'
], function (TransactionLineViewsPriceView, TransactionLineViewsOptionsSelectedView, ProductLineStockView, ProductLineSkuView, ProductLineStockDescriptionView, TransactionLineViewsTax, BackboneCollectionView, BackboneCompositeView, cart_lines_tpl, Backbone, _, Configuration) {
    'use strict';
    //@class Cart.Lines.View @extend Backbone.View
    return Backbone.View.extend({
        template: cart_lines_tpl    //@method initialize
                          //@param {Transaction.Line.Views.Cell.Actionable.Initialize.Options} options
                          //@return {Void}
,
        initialize: function () {
            BackboneCompositeView.add(this);
        },
        childViews: {
            'Item.Price': function () {
                return new TransactionLineViewsPriceView({
                    model: this.model,
                    showComparePrice: true
                });
            },
            'Item.Sku': function () {
                return new ProductLineSkuView({ model: this.model });
            },
            'Item.SelectedOptions': function () {
                return new TransactionLineViewsOptionsSelectedView({ model: this.model });
            },
            'Product.Stock.Info': function () {
                return new ProductLineStockView({ model: this.model });
            },
            'Item.Tax.Info': function () {
                if (Configuration.get('showTaxDetailsPerLine')) {
                    return new TransactionLineViewsTax({ model: this.model });
                }
            },
            'Item.Summary.View': function () {
                return new this.options.SummaryView(_.extend({
                    model: this.model,
                    application: this.options.application
                }, this.options.summaryOptions || {}));
            },
            'Item.Actions.View': function () {
                return new this.options.ActionsView(_.extend({
                    model: this.model,
                    application: this.options.application
                }, this.options.actionsOptions || {}));
            },
            'StockDescription': function () {
                return new ProductLineStockDescriptionView({ model: this.model });
            }
        }    //@method getContext
             //@return {Transaction.Line.Views.Actionable.View.Context}
,
        getContext: function () {
            var item = this.model.get('item');
            //@class Transaction.Line.Views.Actionable.View.Context
            return {
                //@property {OrderLine.Model|Transaction.Line.Model} line
                line: this.model,
                lineId: this.model.get('internalid')    //@property {Item.Model} item
,
                item: item    //@property {String} itemId
,
                itemId: item.get('internalid')    //@property {String} linkAttributes
,
                linkAttributes: this.model.getFullLink({
                    quantity: null,
                    location: null,
                    fulfillmentChoice: null
                })    //@property {Boolean} isNavigable
,
                isNavigable: !!this.options.navigable && !!item.get('_isPurchasable')    //@property {Boolean} showCustomAlert
,
                showCustomAlert: !!item.get('_cartCustomAlert')    //@property {String} customAlertType
,
                customAlertType: item.get('_cartCustomAlertType') || 'info'    //@property {Boolean} showActionsView
,
                showActionsView: !!this.options.ActionsView,
                showSummaryView: !!this.options.SummaryView,
                showAlert: !_.isUndefined(this.options.showAlert) ? !!this.options.showAlert : true    //@property {Boolean} showGeneralClass
,
                showGeneralClass: !!this.options.generalClass,
                generalClass: this.options.generalClass,
                thumbnail: this.model.getThumbnail()
            };    //@class Transaction.Line.Views.Actionable.View
        }
    });
});    //@class Cart.Lines.Initialize.Options
       //@property {Transaction.Line.Model} model
       //@property {String} generalClass Class name used in the generated HTML
       //@property {Backbone.View} SummaryView View to show details
       //@property {Backbone.View} ActionsView View to show actions buttons
       //@property {Object} actionsOptions Any object used to extend the options sent to the Action View
       //@property {Object} summaryOptions Any object used to extend the options sent to the Summary View
       //@property {Boolean} navigable
       //@property {Boolean} showAlert Indicate if a place holder is added in the final HTML, used when the action can generate errors
       //@property {ApplicationSkeleton} application
       //@property {Boolean} hideComparePrice Property used to bypass to the TransactionLineViewsPriceView


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Transaction.Line.Views
define('Cart.Lines.Free.View', [
    'LiveOrder.Model',
    'Transaction.Line.Views.Price.View',
    'Transaction.Line.Views.Options.Selected.View',
    'ProductLine.Stock.View',
    'ProductLine.Sku.View',
    'ProductLine.StockDescription.View',
    'Transaction.Line.Views.Tax',
    'GlobalViews.Message.View',
    'Backbone.CollectionView',
    'Backbone.CompositeView',
    'cart_lines_free.tpl',
    'Backbone',
    'underscore',
    'SC.Configuration'
], function (LiveOrderModel, TransactionLineViewsPriceView, TransactionLineViewsOptionsSelectedView, ProductLineStockView, ProductLineSkuView, ProductLineStockDescriptionView, TransactionLineViewsTax, GlobalViewsMessageView, BackboneCollectionView, BackboneCompositeView, cart_lines_free_tpl, Backbone, _, Configuration) {
    'use strict';
    //@class Cart.Lines.Free.View @extend Backbone.View
    return Backbone.View.extend({
        template: cart_lines_free_tpl    //@method initialize
                               //@param {Transaction.Line.Views.Cell.Actionable.Initialize.Options} options
                               //@return {Void}
,
        initialize: function () {
            BackboneCompositeView.add(this);
            this.cart = LiveOrderModel.getInstance();
        },
        events: {
            'click [data-action="plus"]': 'addQuantity',
            'click [data-action="minus"]': 'subQuantity',
            'click [data-action="remove-free-gift"]': 'removeGift',
            'change [data-type="cart-free-item-quantity-input"]': 'changeQuantity'
        }    // @method addQuantity Add 1 to the quantity field
             // @return {Void}
,
        addQuantity: function () {
            var old_value = this.$('[name="quantity"]').val(), new_val = Math.min(this.model.get('free_gift_info').qtyelegible, parseFloat(old_value) + 1);
            this.$('[name="quantity"]').val(new_val);
            this.changeQuantity();
        }    // @method subQuantity Subtract 1 from the quantity field
             // @return {Void}
,
        subQuantity: function () {
            var old_value = this.$('[name="quantity"]').val(), new_val = Math.max(1, parseFloat(old_value) - 1);
            this.$('[name="quantity"]').val(new_val);
            this.changeQuantity();
        },
        removeGift: function () {
            this.cart.removeLine(this.model);
        },
        updateGift: function (quantity) {
            this.$('[name="quantity"]').prop('disabled', false);
            var line = this.model, current_quantity = line.get('quantity');
            line.set('quantity', quantity);
            var invalid = line.validate(), placeholder = this.$el.find('[data-type="alert-placeholder"]');
            placeholder.empty();
            if (!invalid) {
                this.cart.updateLine(line);
            } else {
                _.each(invalid, function (value) {
                    var global_view_message = new GlobalViewsMessageView({
                        message: value,
                        type: 'error',
                        closable: true
                    });
                    placeholder.append(global_view_message.render().$el.html());
                });
                line.set('quantity', current_quantity);
            }
            this.$('[name="quantity"]').prop('disabled', false);
        },
        changeQuantity: _.debounce(function () {
            var $input = this.$('[name="quantity"]'), current_quantity = parseInt(this.model.get('quantity'), 10), new_quantity = $input.val() <= this.model.get('free_gift_info').eligible_quantity && $input.val() > 0 ? parseInt($input.val()) : current_quantity;
            $input.val(new_quantity);
            if (new_quantity && new_quantity !== current_quantity) {
                this.updateGift(new_quantity);
            }
        }, 1000),
        childViews: {
            'Item.Price': function () {
                return new TransactionLineViewsPriceView({
                    model: this.model,
                    showComparePrice: true
                });
            },
            'Item.Sku': function () {
                return new ProductLineSkuView({ model: this.model });
            },
            'Item.SelectedOptions': function () {
                return new TransactionLineViewsOptionsSelectedView({ model: this.model });
            },
            'Product.Stock.Info': function () {
                return new ProductLineStockView({ model: this.model });
            },
            'Item.Tax.Info': function () {
                if (Configuration.get('showTaxDetailsPerLine')) {
                    return new TransactionLineViewsTax({ model: this.model });
                }
            },
            'StockDescription': function () {
                return new ProductLineStockDescriptionView({ model: this.model });
            }
        }    //@method getContext
             //@return {Transaction.Line.Views.Actionable.View.Context}
,
        getContext: function () {
            var item = this.model.get('item');
            //@class Transaction.Line.Views.Actionable.View.Context
            return {
                //@property {OrderLine.Model|Transaction.Line.Model} line
                line: this.model,
                lineId: this.model.get('internalid')    //@property {Item.Model} item
,
                item: item    //@property {String} itemId
,
                itemId: item.get('internalid')    //@property {String} linkAttributes
,
                linkAttributes: this.model.getFullLink({
                    quantity: null,
                    location: null,
                    fulfillmentChoice: null
                })    //@property {Boolean} isNavigable
,
                isNavigable: !!this.options.navigable && !!item.get('_isPurchasable')    // @property {ImageContainer} thumbnail
,
                thumbnail: this.model.getThumbnail()    // @property {Boolean} isQtyEditable
,
                isQtyEditable: this.model.get('free_gift_info').eligible_quantity > 1    // @property {Number} qtyElegible
,
                qtyElegible: this.model.get('free_gift_info').eligible_quantity
            };    //@class Transaction.Line.Views.Actionable.View
        }
    });
});    //@class Cart.Lines.Initialize.Options
       //@property {Transaction.Line.Model} model
       //@property {String} generalClass Class name used in the generated HTML
       //@property {Backbone.View} SummaryView View to show details
       //@property {Backbone.View} ActionsView View to show actions buttons
       //@property {Object} actionsOptions Any object used to extend the options sent to the Action View
       //@property {Object} summaryOptions Any object used to extend the options sent to the Summary View
       //@property {Boolean} navigable
       //@property {Boolean} showAlert Indicate if a place holder is added in the final HTML, used when the action can generate errors
       //@property {ApplicationSkeleton} application
       //@property {Boolean} hideComparePrice Property used to bypass to the TransactionLineViewsPriceView


/*
    © 2017 NetSuite Inc.
    User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
    provided, however, if you are an authorized user with a NetSuite account or log-in, you
    may use this code subject to the terms that govern your access and use.
*/
//@module Cart
define('Cart.Promocode.Reason.View', [
    'cart_promo_reason.tpl',
    'Backbone',
    'underscore'
], function (cart_promo_reason_tpl, Backbone, _) {
    'use strict';
    //@class Cart.Promocode.List.Item.View @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: cart_promo_reason_tpl    //@method getContext
                                 //@return {Cart.Promocode.List.Item.View.Context}
,
        getContext: function getContext() {
            console.log(this.model);
            var reason = this.model.get('applicabilityreason');
            var status = this.model.get('applicabilitystatus');
            var reasonmsg = '', statusmsg = '';
            if (status == 'APPLIED') {
                statusmsg = _('Promotion is applied for this item.').translate();
            } else if (status == 'NOT_APPLIED') {
                statusmsg = _('Sorry, no discount is added to your order').translate();
            } else if (status == 'NOT_AVAILABLE') {
                statusmsg = _('Status of this promotion is not available.').translate();
            }
            if (reason == 'DISCARDED_BEST_OFFER') {
                reasonmsg = _('Promotion is not applied as there is another promocode or a combination of promocodes that is giving you a better discount.').translate();
            } else if (reason == 'CRITERIA_NOT_MET') {
                reasonmsg = _('Sorry, the promocode is not applied as it does not meet the criteria.').translate();
            }
            return {
                reasonmsg: reasonmsg,
                statusmsg: statusmsg
            };    //@class Cart.Promocode.List.Item.View
        }
    });
});    //@class Cart.Promocode.List.Item.View.Initialize.Options
       //@property {Backbone.Model<{code:String,internalid:String}>} model
       //@property {Boolean?} isReadOnly


/*
    © 2017 NetSuite Inc.
    User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
    provided, however, if you are an authorized user with a NetSuite account or log-in, you
    may use this code subject to the terms that govern your access and use.
*/
//@module Cart
define('Cart.Item.Summary.View', [
    'Cart.Promocode.List.Item.View',
    'Cart.Promocode.Reason.View',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'Profile.Model',
    'cart_item_summary.tpl',
    'Backbone',
    'underscore'
], function (CartPromocodeListItemView, CartPromocodeReasonView, BackboneCompositeView, BackboneCollectionView, ProfileModel, cart_item_summary_tpl, Backbone, _) {
    'use strict';
    //@class Cart.Item.Summary.View @extend Backbone.View
    return Backbone.View.extend({
        // @property {Function} template
        template: cart_item_summary_tpl    //@method initialize Defines this view as composite
                                 //@return {Void}
,
        initialize: function initialize(options) {
            BackboneCompositeView.add(this);
            if (options.amodel != undefined && options.amodel != null && options.amodel != '') {
                this.AllPromo = _.filter(options.amodel.get('promocodes') || [], function (promocode) {
                    return promocode.internalid;
                });
            }
        }    // @property {Object} events
,
        events: {
            'click [data-action="plus"]': 'addQuantity',
            'click [data-action="minus"]': 'subQuantity'
        }    // @method addQuantity Add 1 to the quantity field
             // @param {jQuery.Event} e
             // @return {Void}
,
        addQuantity: function (e) {
            e.preventDefault();
            var $element = this.$(e.target), quantity_input = $element.parent().find('input'), old_value = quantity_input.val(), max_quantity = this.model.get('item').get('_maximumQuantity', true), new_val = parseFloat(old_value) + 1;
            new_val = !!max_quantity ? Math.min(max_quantity, new_val) : new_val;
            quantity_input.val(new_val);
            quantity_input.change();
        }    // @method subQuantity Subtract 1 from the quantity field
             // @param {jQuery.Event} e
             // @return {Void}
,
        subQuantity: function (e) {
            e.preventDefault();
            var $element = this.$(e.target), quantity_input = $element.parent().find('input'), old_value = quantity_input.val(), new_val = parseFloat(old_value) - 1;
            new_val = Math.max(this.model.get('item').get('_minimumQuantity', true), new_val);
            quantity_input.val(new_val);
            quantity_input.change();
        },
        childViews: {
            'PromocodeList': function () {
                if (!!this.model.get('discounts_impact')) {
                    var discounts = _.filter(this.model.get('discounts_impact').discounts, function (discount) {
                        return !!discount.promotion_couponcode;
                    });
                    return new BackboneCollectionView({
                        collection: discounts,
                        viewsPerRow: 1,
                        childView: CartPromocodeListItemView,
                        childViewOptions: {
                            isReadOnly: true,
                            source: 'item_summary'
                        }
                    });
                }
            },
            'PromoReason': function () {
                var test;
                setOptions:
                    function setOptions(options) {
                        test = options.amodel || this.model;
                    }
                console.log(test);
                return new BackboneCollectionView({
                    collection: this.AllPromo,
                    viewsPerRow: 1,
                    childView: CartPromocodeReasonView,
                    childViewOptions: {
                        isReadOnly: this.options.isReadOnly,
                        source: 'summary'
                    }
                });
            }
        }    // @method getContext
             // @return {Cart.Item.Summary.View.Context}
,
        getContext: function () {
            var minimum_quantity = this.model.get('item').get('_minimumQuantity', true) || 1, maximum_quantity = this.model.get('item').get('_maximumQuantity', true);
            //@class Cart.Item.Summary.View.Context
            return {
                //@property {Model} line
                line: this.model,
                lineId: this.model.get('internalid')    //@property {Boolean} isMinusButtonDisabled
,
                isMinusButtonDisabled: this.model.get('item').get('quantity') <= minimum_quantity || this.model.get('item').get('quantity') === 1    //@property {Boolean} isPlusButtonDisabled
,
                isPlusButtonDisabled: !!maximum_quantity && this.model.get('item').get('quantity') >= maximum_quantity    //@property {Boolean} showQuantity
,
                showQuantity: this.model.get('item').get('_itemType') === 'GiftCert'    //@property {Boolean} showComparePrice
,
                showComparePrice: this.model.get('amount') > this.model.get('total')    //@property {Boolean} showMinimumQuantity
,
                showMinimumQuantity: minimum_quantity > 1    //@property {Integer} minimumQuantity
,
                minimumQuantity: minimum_quantity    //@property {Boolean} showMaximumQuantity
,
                showMaximumQuantity: !!maximum_quantity    //@property {Integer} maximumQuantity
,
                maximumQuantity: maximum_quantity    // @property {Boolean} isPriceEnabled
,
                isPriceEnabled: !ProfileModel.getInstance().hidePrices()
            };    //@class Cart.Item.Summary.View
        }
    });
});

/*
    © 2017 NetSuite Inc.
    User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
    provided, however, if you are an authorized user with a NetSuite account or log-in, you
    may use this code subject to the terms that govern your access and use.
*/
// @module Cart
define('Cart.Summary.View', [
    'SC.Configuration',
    'Cart.PromocodeForm.View',
    'Cart.Item.Summary.View',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'GlobalViews.FormatPaymentMethod.View',
    'Profile.Model',
    'Cart.Promocode.List.View',
    'Session',
    'cart_summary.tpl',
    'cart_summary_gift_certificate_cell.tpl',
    'underscore',
    'Backbone'
], function (Configuration, CartPromocodeFormView, CartItemSummaryView, BackboneCompositeView, BackboneCollectionView, GlobalViewsFormatPaymentMethodView, ProfileModel, CartPromocodeListView, Session, cart_summary_tpl, cart_summary_gift_certificate_cell_tpl, _, Backbone) {
    'use strict';
    // @class Cart.Summary.View @extends Backbone.View
    return Backbone.View.extend({
        // @property {Function} template
        template: cart_summary_tpl    // @method initialize
,
        initialize: function initialize(options) {
            this.model = options.model;
            BackboneCompositeView.add(this);
            this.promocodeFormComponent = new CartPromocodeFormView({
                model: this.model,
                application: this.options.application
            });
            return new CartItemSummaryView({
                amodel: this.model,
                isReadOnly: false
            });
        }    // @property {Object} childViews
,
        childViews: {
            'Cart.PromocodeFrom': function () {
                return this.promocodeFormComponent;
            },
            'CartPromocodeListView': function () {
                return new CartPromocodeListView({
                    model: this.model,
                    isReadOnly: false
                });
            },
            'GiftCertificates': function () {
                var gift_certificates = this.model.get('paymentmethods').where({ type: 'giftcertificate' }) || [];
                return new BackboneCollectionView({
                    collection: gift_certificates,
                    cellTemplate: cart_summary_gift_certificate_cell_tpl,
                    viewsPerRow: 1,
                    childView: GlobalViewsFormatPaymentMethodView,
                    rowTemplate: null
                });
            }
        }    //@method getUrlLogin
             //@return {String}
,
        getUrlLogin: function getUrlLogin() {
            var login = Session.get('touchpoints.login'), currentTouchpoint = this.model.application && this.model.application.Configuration.currentTouchpoint ? this.model.application.Configuration.currentTouchpoint : 'home';
            login += '&origin=' + currentTouchpoint;
            if (this.$el.closest('.modal-product-detail').size() > 0)
                //we are in the quick view
                {
                    var hashtag = this.$el.closest('.modal-product-detail').find('[data-name="view-full-details"]').data('hashtag');
                    login += '&origin_hash=' + encodeURIComponent(hashtag.replace('#/', ''));
                }
            else {
                login += '&origin_hash=' + encodeURIComponent(Backbone.history.fragment);
            }
            return login;
        }    // @method getContext
             // @return {Cart.Summary.View.Context}
,
        getContext: function getContext() {
            var continueURL = Configuration.get('siteSettings.sitetype') === 'ADVANCED' ? Configuration.defaultSearchUrl : '', is_wsdk = false, summary = this.model.get('summary'), items_count = _.reduce(this.model.get('lines').pluck('quantity'), function (memo, quantity) {
                    return memo + (parseFloat(quantity) || 1);
                }, 0), shipping_address = this.model.get('addresses').get(this.model.get('shipaddress')) || new Backbone.Model(), default_country = shipping_address.get('country') || Configuration.get('siteSettings.defaultshipcountry'), shipping_zip_code = shipping_address.get('zip'), promocodes = this.model.get('promocodes') || [], gift_certificates = this.model.get('paymentmethods').where({ type: 'giftcertificate' }) || [], is_single_country = _.size(Configuration.get('siteSettings.countries', [])) === 1, is_zipcode_require, selected_country, countries_list, is_estimated_shipping_valid, show_estimation_form = true, countries = _.clone(Configuration.get('siteSettings.countries'));
            //Determine if the Zip Code is required and just leave selected the current address
            if (countries && default_country && countries[default_country]) {
                selected_country = _.findWhere(countries, { selected: true });
                if (selected_country) {
                    selected_country.selected = false;
                }
                countries[default_country].selected = true;
                is_zipcode_require = countries[default_country].isziprequired !== 'F';
                selected_country = countries[default_country];
                countries_list = _.toArray(countries);
            } else {
                selected_country = _.findWhere(countries, { selected: true });
                countries_list = _.toArray(countries);
                if (!selected_country) {
                    selected_country = _.first(countries_list);
                }
                is_zipcode_require = selected_country.isziprequired !== 'F';
            }
            //Determine if the current address is valid (complete)
            if (_.isString(shipping_address.id) && shipping_address.id !== '-------null') {
                is_estimated_shipping_valid = is_zipcode_require ? !!shipping_zip_code : !!shipping_address.get('country');
            } else {
                is_estimated_shipping_valid = false;
            }
            //Check if WSDK is configured
            if (Configuration.get('siteSettings.iswsdk', false) && Configuration.get('siteSettings.wsdkcancelcarturl')) {
                continueURL = Configuration.get('siteSettings.wsdkcancelcarturl');
                is_wsdk = true;
            }
            //Calculate if the estimation form should be rendered or not
            if (is_estimated_shipping_valid && is_zipcode_require) {
                show_estimation_form = false;
            } else if (is_estimated_shipping_valid) {
                show_estimation_form = !this.options.showEstimated;
            } else {
                show_estimation_form = true;
            }
            // @class Cart.Summary.View.Context
            return {
                // @property {LiveOrder.Model} model
                model: this.model,
                isWSDK: is_wsdk    // @property {String} continueURL
,
                continueURL: continueURL    // @property {Boolean} showActions
,
                showActions: true    // @property {Boolean} showLabelsAsEstimated
,
                showLabelsAsEstimated: true    // @property {Object} summary
,
                summary: summary    // @property {Number} itemCount
,
                itemCount: items_count    // @property {Boolean} isSingleItem
,
                isSingleItem: items_count === 1    // @property {Boolean} isZipCodeRequire
,
                isZipCodeRequire: is_zipcode_require    // @property {Boolean} showEstimate Shows or not the estimation form
,
                showEstimate: show_estimation_form    // @property {Boolean} showHandlingCost
,
                showHandlingCost: !!summary.handlingcost,
                showGiftCertificates: !!summary.giftcertapplied,
                showPromocodeForm: Configuration.get('promocodes.allowMultiples', true) || !promocodes.length,
                giftCertificates: gift_certificates    // @property {Boolean} showDiscountTotal
,
                showDiscountTotal: !!summary.discounttotal,
                defaultCountry: default_country    // @property {Boolean} isDefaultCountryUS
,
                isDefaultCountryUS: default_country === 'US'    // @property {Array} countries
,
                countries: countries_list    // @property {Boolean} singleCountry
,
                singleCountry: is_single_country    // @property {String} singleCountryCode
,
                singleCountryCode: is_single_country ? countries_list[0].code : ''    // @property {String} shipToText
,
                shipToText: shipping_zip_code || selected_country.name,
                singleCountryName: is_single_country ? countries_list[0].name : ''    // @property {String} shippingZipCode
,
                shippingZipCode: shipping_zip_code || ''    // @property {Boolean} showPaypalButton
,
                showPaypalButton: Configuration.get('siteSettings.checkout.paypalexpress.available', 'F') === 'T'    // @property {String} paypalButtonImageUrl
,
                paypalButtonImageUrl: Configuration.get('paypalButtonImageUrl', 'https://www.paypalobjects.com/webstatic/en_US/i/buttons/checkout-logo-large.png')    // @property {Boolean} showProceedButton
,
                showProceedButton: Configuration.get('siteSettings.sitetype') === 'STANDARD'    // @property {String} urlLogin
,
                urlLogin: this.getUrlLogin()    // @property {Boolean} isPriceEnabled
,
                isPriceEnabled: !ProfileModel.getInstance().hidePrices()    // @property {Boolean} showPickupInStoreLabel
,
                showPickupInStoreLabel: this.model.getPickupInStoreLines().length > 0    // @property {Boolean} areAllItemsPickupable
,
                areAllItemsPickupable: this.model.getPickupInStoreLines().length === this.model.get('lines').length,
                taxLabel: !!Configuration.get('summaryTaxLabel') ? Configuration.get('summaryTaxLabel') : 'Tax'
            };    // @class Cart.Summary.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Cart
define('Cart.Item.Actions.View', [
    'Backbone.CompositeView',
    'SC.Configuration',
    'cart_item_actions.tpl',
    'Backbone',
    'Utils'
], function (BackboneCompositeView, Configuration, cart_item_actions_tpl, Backbone, Utils) {
    'use strict';
    //@class Cart.Item.Actions.View @extend Backbone.View
    return Backbone.View.extend({
        template: cart_item_actions_tpl,
        initialize: function () {
            this.application = this.options.application;
            BackboneCompositeView.add(this);
        }    //@method getContext @return Cart.Item.Actions.View.Context
,
        getContext: function () {
            //@class Cart.Item.Actions.View.Context
            return {
                //@property {Model} line
                line: this.model,
                item: this.model.get('item')    //@property {String} editUrl
,
                editUrl: Utils.addParamsToUrl(this.model.generateURL(), {
                    'source': 'cart',
                    'internalid': this.model.get('internalid')
                })    //@property {Boolean} isAdvanced
,
                isAdvanced: Configuration.siteSettings.sitetype !== 'STANDARD'    //@property {Boolean} showSaveForLateButton
,
                showSaveForLateButton: this.application.ProductListModule && this.application.ProductListModule.Utils.isProductListEnabled() && Configuration.currentTouchpoint === 'home'    //@property {String} lineId
,
                lineId: this.model.get('internalid')    //@property {Boolean} showQuantity
,
                showQuantity: this.model.get('item').get('_itemType') === 'GiftCert'
            };    //@class Cart.Item.Actions.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module jQueryExtras
#jQuery.scStickyButton
A jQuery plugin that implements a sticky button behavior. Usage:

	this.$el.find('[data-action="sticky"]').scStickyButton()
*/
define('jQuery.scStickyButton', [
    'jQuery',
    'Utils'
], function (jQuery, Utils) {
    'use strict';
    var sticky_button, padding_offset = 20;
    jQuery.fn.scStickyButton = function () {
        if (canStick()) {
            init(this);
            // try to update the button position on every scroll, touch start and touch move
            jQuery(document).on('scroll touchstart touchmove', checkStickyPosition);
        }
        return this;
    };
    function canStick() {
        var viewport_width = Utils.getViewportWidth(), mobile_width_max = 768;
        return viewport_width < mobile_width_max;
    }
    // initialize the plugin generating required markup and setting the event listeners
    function init(sticky) {
        sticky_button = jQuery(sticky);
        // wrap the original button with a clone into a container. This achieves de desired behavior while scrolling the page
        var button_clone = jQuery('<div class="sticky-button-container-clone">').append(sticky_button.clone(true).removeAttr('data-action'));
        sticky_button.wrap('<div class="sticky-button-container">').parent().append(button_clone);
        // initialize with "unsticked" state
        unStickIt();
    }
    // checks if the button should be sticked or unsticked
    function checkStickyPosition() {
        var document_scroll_top = jQuery(document).scrollTop(), is_sticked = sticky_button.hasClass('sticked'), current_offset = sticky_button.offset().top - padding_offset;
        if (!is_sticked && document_scroll_top >= current_offset) {
            stickIt();
        } else if (is_sticked && document_scroll_top <= current_offset) {
            unStickIt();
        }
    }
    function stickIt() {
        var clone = sticky_button.parent().find('.sticky-button-container-clone').first();
        clone.addClass('sticked');
        sticky_button.addClass('sticked');
    }
    function unStickIt() {
        var clone = sticky_button.parent().find('.sticky-button-container-clone').first();
        clone.removeClass('sticked');
        sticky_button.removeClass('sticked');
    }
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Cart
define('Cart.Detailed.View', [
    'Backbone.CompositeView',
    'GlobalViews.Message.View',
    'Backbone.CollectionView',
    'Backbone.FormView',
    'Cart.Lines.View',
    'Cart.Lines.Free.View',
    'Cart.Promocode.Notifications.View',
    'Cart.Summary.View',
    'Cart.Item.Summary.View',
    'Cart.Item.Actions.View',
    'SC.Configuration',
    'cart_detailed.tpl',
    'cart_lines_free.tpl',
    'Utils',
    'underscore',
    'Backbone',
    'jQuery',
    'jQuery.scStickyButton'
], function (BackboneCompositeView, GlobalViewsMessageView, BackboneCollectionView, BackboneFormView, CartLinesView, CartLinesFreeView, CartPromocodeNotifications, CartSummaryView, CartItemSummaryView, CartItemActionsView, Configuration, cart_detailed_tpl, cart_lines_free_tpl, Utils, _, Backbone, jQuery) {
    'use strict';
    var colapsibles_states = {};
    // @class Cart.Detailed.View This is the Shopping Cart view @extends Backbone.View
    return Backbone.View.extend({
        // @property {Function} template
        template: cart_detailed_tpl    // @property {String} title
,
        title: _('Shopping Cart').translate()    // @property {String} page_header
,
        page_header: _('Shopping Cart').translate()    // @property {Object} attributes
,
        attributes: {
            'id': 'Cart.Detailed.View',
            'data-root-component-id': 'Cart.Detailed.View'
        },
        bindings: { '[name="zip"]': 'zip' }    // @property {Object} events
,
        events: {
            'change [data-type="cart-item-quantity-input"]': 'debouncedUpdateItemQuantity',
            'keypress [data-type="cart-item-quantity-input"]': 'debouncedUpdateItemQuantity',
            'submit [data-action="update-quantity"]': 'updateItemQuantityFormSubmit',
            'click [data-action="remove-item"]': 'removeItem',
            'submit form[data-action="estimate-tax-ship"]': 'estimateTaxShip',
            'click [data-action="remove-shipping-address"]': 'removeShippingAddress',
            'change [data-action="estimate-tax-ship-country"]': 'changeCountry'
        }    // @method initialize
             // @param {Cart.Detailed.View.InitializeParameters} options
             // @return {Void}
,
        initialize: function (options) {
            this.application = options.application;
            this.showEstimated = false;
            BackboneCompositeView.add(this);
            BackboneFormView.add(this);
            this.model.on('change', this.render, this);
            this.model.get('lines').on('add remove', this.render, this);
            this.model.on('LINE_ROLLBACK', this.render, this);
            this.model.on('promocodeNotificationShown', this.removePromocodeNotification, this);
            this.on('afterCompositeViewRender', this.resetColapsiblesState, this);
            this.on('afterCompositeViewRender', this.initPlugins, this);
            this.options = options;
        }    // @method getBreadcrumbPages
             // @return {BreadcrumbPage}
,
        getBreadcrumbPages: function () {
            return {
                href: '/cart',
                text: _('Shopping Cart').translate()
            };
        }    // @method initPlugins
             // initialize plugins
,
        initPlugins: function initPlugins() {
            if (Configuration.get('siteSettings.sitetype') === 'ADVANCED') {
                this.$('[data-action="sticky"]').scStickyButton();
            }
            Utils.initBxSlider(this.$('[data-type="carousel-items"]'), Configuration.get('bxSliderDefaults'));
        },
        render: function render() {
            this.storeColapsiblesState();
            this._render();
            return this;
        }    // @method hideError
,
        hideError: function hideError(selector) {
            var el = selector ? selector.find('[data-type="alert-placeholder"]') : this.$('[data-type="alert-placeholder"]');
            el.empty();
        }    // @method showError
,
        showError: function showError(message, line, error_details) {
            var placeholder;
            this.hideError();
            if (line) {
                // if we detect its a rolled back item, (this i an item that was deleted
                // but the new options were not valid and was added back to it original state)
                // We will move all the references to the new line id
                if (error_details && error_details.status === 'LINE_ROLLBACK') {
                    var new_line_id = error_details.newLineId;
                    line.attr('id', new_line_id);
                    line.find('[name="internalid"]').attr({
                        id: 'update-internalid-' + new_line_id,
                        value: new_line_id
                    });
                }
                placeholder = line.find('[data-type="alert-placeholder"]');
                this.hideError(line);
            } else {
                placeholder = this.$('[data-type="alert-placeholder"]');
                this.hideError();
            }
            // Finds or create the placeholder for the error message
            if (!placeholder.length) {
                placeholder = jQuery('<div/>', { 'data-type': 'alert-placeholder' });
                this.$el.prepend(placeholder);
            }
            var global_view_message = new GlobalViewsMessageView({
                message: message,
                type: 'error',
                closable: true
            });
            // Renders the error message and into the placeholder
            placeholder.append(global_view_message.render().$el.html());
            // Re Enables all posible disableded buttons of the line or the entire view
            if (line) {
                line.find(':disabled').attr('disabled', false);
            } else {
                this.$(':disabled').attr('disabled', false);
            }
        }    // @method validInputValue
             // Check if the input[type="number"] has empty string or NaN value
             // input.val() == '' && validInput == false: NaN
             // input.val() == '' && validInput == true: empty string
,
        validInputValue: function (input) {
            // html5 validation
            if (input.validity && !input.validity.valid || input.value === '') {
                return false;
            }
            // Fallback to browsers that don't yet support html5 input validation
            return !isNaN(input.value);
        }    // @method updateItemQuantity
             // Finds the item in the cart model, updates its quantity and saves the cart model
,
        updateItemQuantity: function updateItemQuantity(e) {
            var self = this, $line = null, $form = jQuery(e.target).closest('form'), options = $form.serializeObject(), internalid = options.internalid, line = this.model.get('lines').get(internalid), $input = $form.find('[name="quantity"]'), validInput = this.validInputValue($input[0]);
            if (!line || this.isRemoving) {
                return;
            }
            if (!validInput || options.quantity) {
                var new_quantity = parseInt(options.quantity, 10), item = line.get('item'), min_quantity = item ? item.get('_minimumQuantity', true) : line.get('minimumquantity'), max_quantity = item ? item.get('_maximumQuantity', true) : line.get('maximumquantity'), current_quantity = parseInt(line.get('quantity'), 10);
                new_quantity = new_quantity >= min_quantity ? new_quantity : current_quantity;
                new_quantity = !!max_quantity && new_quantity > max_quantity ? current_quantity : new_quantity;
                $input.val(new_quantity);
                if (new_quantity !== current_quantity) {
                    $line = this.$('#' + internalid);
                    $input.val(new_quantity).prop('disabled', true);
                    line.set('quantity', new_quantity);
                    var invalid = line.validate();
                    if (!invalid) {
                        var update_promise = this.model.updateLine(line);
                        this.disableElementsOnPromise(update_promise, '#' + internalid + ' button');
                        update_promise.fail(function (jqXhr) {
                            jqXhr.preventDefault = true;
                            var result = JSON.parse(jqXhr.responseText);
                            self.showError(result.errorMessage, $line, result.errorDetails);
                            line.set('quantity', current_quantity);
                        }).always(function () {
                            $input.prop('disabled', false);
                        });
                    } else {
                        var placeholder = this.$('#' + internalid + ' [data-type="alert-placeholder"]');
                        placeholder.empty();
                        _.each(invalid, function (value) {
                            var global_view_message = new GlobalViewsMessageView({
                                message: value,
                                type: 'error',
                                closable: true
                            });
                            placeholder.append(global_view_message.render().$el.html());
                        });
                        $input.prop('disabled', false);
                        line.set('quantity', current_quantity);
                    }
                }
            }
        },
        debouncedUpdateItemQuantity: _.debounce(function (e) {
            this.updateItemQuantity(e);
        }, 1000)    // @method updateItemQuantityFormSubmit
,
        updateItemQuantityFormSubmit: function updateItemQuantityFormSubmit(e) {
            e.preventDefault();
            this.updateItemQuantity(e);
        }    // @method removeItem
             // handles the click event of the remove button
             // removes the item from the cart model and saves it.
,
        removeItem: function removeItem(e) {
            var self = this, product = this.model.get('lines').get(this.$(e.target).data('internalid')), remove_promise = this.model.removeLine(product), internalid = product.get('internalid');
            this.isRemoving = true;
            this.disableElementsOnPromise(remove_promise, 'article[id="' + internalid + '"] a, article[id="' + internalid + '"] button');
            remove_promise.always(function () {
                self.isRemoving = false;
            });
            return remove_promise;
        }    // @method estimateTaxShip
             // Sets a fake address with country and zip code based on the options.
,
        estimateTaxShip: function estimateTaxShip(e) {
            e.preventDefault();
            var options = this.$(e.target).serializeObject(), self = this;
            var fake_address = {
                zip: options.zip,
                country: options.country
            };
            this.model.cancelableTrigger('before:LiveOrder.estimateShipping', fake_address).then(function () {
                var address_internalid = fake_address.zip + '-' + fake_address.country + '-null';
                fake_address.internalid = address_internalid;
                self.model.get('addresses').push(fake_address);
                self.model.set('shipaddress', address_internalid);
                var promise = self.saveForm(e);
                if (promise) {
                    self.swapEstimationStatus();
                }
                promise.done(function (lines) {
                    self.model.cancelableTrigger('after:LiveOrder.estimateShipping', _.isUndefined(lines) ? false : lines);
                });
            });
        }    // @method changeEstimationStatus
,
        swapEstimationStatus: function swapEstimationStatus() {
            this.showEstimated = !this.showEstimated;
        }    // @method removeShippingAddress
             // sets a fake null address so it gets removed by the backend
,
        removeShippingAddress: function removeShippingAddress(e) {
            var self = this, ship_address = self.model.get('addresses');
            self.model.cancelableTrigger('before:LiveOrder.clearEstimateShipping', ship_address).then(function () {
                e.preventDefault();
                self.swapEstimationStatus();
                self.model.save({
                    shipmethod: null,
                    shipaddress: null
                });
                self.model.cancelableTrigger('after:LiveOrder.clearEstimateShipping', true);
            });
        }    // @method changeCountry
,
        changeCountry: function changeCountry(e) {
            e.preventDefault();
            var options = this.$(e.target).serializeObject(), AddressModel = this.model.get('addresses').model;
            this.model.get('addresses').add(new AddressModel({
                country: options.country,
                internalid: options.country
            }));
            this.model.set({ shipaddress: options.country });
        }    // @method resetColapsiblesState
             // @return {Void}
,
        resetColapsiblesState: function resetColapsiblesState() {
            var self = this;
            _.each(colapsibles_states, function (is_in, element_selector) {
                self.$(element_selector)[is_in ? 'addClass' : 'removeClass']('in').css('height', is_in ? 'auto' : '0');
            });
        }    // @method storeColapsiblesState
             // @return {Void}
,
        storeColapsiblesState: function () {
            this.$('.collapse').each(function (index, element) {
                colapsibles_states[Utils.getFullPathForElement(element)] = jQuery(element).hasClass('in');
            });
        }    // @method removePromocodeNotification
             // @param String promocode_id
             // @return {Void}
,
        removePromocodeNotification: function (promocode_id) {
            var promocode = _.findWhere(this.model.get('promocodes'), { internalid: promocode_id });
            delete promocode.notification;
        },
        destroy: function () {
            colapsibles_states = {};
            this.model.off('change', this.render, this);
            this.model.get('lines').off('add remove', this.render, this);
            this.model.off('LINE_ROLLBACK', this.render, this);
            this.off('afterCompositeViewRender', this.resetColapsiblesState, this);
            this.off('afterCompositeViewRender', this.initPlugins, this);
            this._destroy();
        }    // @property {ChildViews} childViews
,
        childViews: {
            'Cart.Summary': function () {
                return new CartSummaryView({
                    model: this.model,
                    showEstimated: this.showEstimated,
                    application: this.application
                });
            },
            'Item.ListNavigable': function () {
                var lines = _.filter(this.model.get('lines').models || [], function (line) {
                    return line.get('free_gift') !== true;
                });
                return new BackboneCollectionView({
                    collection: lines,
                    viewsPerRow: 1,
                    childView: CartLinesView,
                    childViewOptions: {
                        navigable: true,
                        application: this.application,
                        SummaryView: CartItemSummaryView,
                        ActionsView: CartItemActionsView,
                        showAlert: false
                    }
                });
            },
            'Promocode.Notifications': function () {
                var promotions = _.filter(this.model.get('promocodes') || [], function (promocode) {
                    return promocode.notification === true;
                });
                if (promotions.length) {
                    return new BackboneCollectionView({
                        collection: promotions,
                        viewsPerRow: 1,
                        childView: CartPromocodeNotifications,
                        childViewOptions: { parentModel: this.model }
                    });
                }
            },
            'Item.FreeGift': function () {
                var free_gifts = _.filter(this.model.get('lines').models || [], function (line) {
                    return line.get('free_gift') === true;
                });
                if (free_gifts.length) {
                    return new BackboneCollectionView({
                        collection: free_gifts,
                        viewsPerRow: 1,
                        childView: CartLinesFreeView,
                        childViewOptions: { navigable: true }
                    });
                }
            },
            'FreeGift.Info': function () {
                var message, free_gifts = _.filter(this.model.get('lines').models || [], function (line) {
                        return line.get('free_gift') === true;
                    });
                if (free_gifts.length === 1) {
                    message = _.translate('The following item is free but it may generate shipping costs.');
                } else if (free_gifts.length > 1) {
                    message = _.translate('The following items are free but they may generate shipping costs.');
                }
                if (message) {
                    return new GlobalViewsMessageView({
                        message: message,
                        type: 'info',
                        closable: false
                    });
                }
            }
        }    //@method getExtraChildrenOptions Overridable method used to add params to url to open the accordion
             //@return {Cart.Detailed.View.ExtraChildrenOptions}
,
        getExtraChildrenOptions: function () {
            //@class Cart.Detailed.View.ExtraChildrenOptions
            return {
                // @property {String} urlOptions
                urlOptions: this.options.urlOptions
            };    //@class Cart.Detailed.View
        }    // @method getContext @return {Cart.Detailed.View.Context}
,
        getContext: function () {
            var lines = this.model.get('lines'), product_count = lines.length, item_count = _.reduce(lines.models, function (memo, line) {
                    return memo + line.get('quantity');
                }, 0), product_and_items_count = '';
            if (product_count === 1) {
                if (item_count === 1) {
                    product_and_items_count = _('1 Product, 1 Item').translate();
                } else {
                    product_and_items_count = _('1 Product, $(0) Items').translate(item_count);
                }
            } else {
                if (item_count === 1) {
                    product_and_items_count = _('$(0) Products, 1 Item').translate(product_count);
                } else {
                    product_and_items_count = _('$(0) Products, $(1) Items').translate(product_count, item_count);
                }
            }
            // @class Cart.Detailed.View.Context
            return {
                //@property {LiveOrder.Model} model
                model: this.model,
                showLines: !!(lines && lines.length)    //@property {Orderline.Collection} lines
,
                lines: lines    //@property {String} productsAndItemsCount
,
                productsAndItemsCount: product_and_items_count    //@property {Number} productCount
,
                productCount: product_count    //@property {Number} itemCount
,
                itemCount: item_count    //@property {String} pageHeader
,
                pageHeader: this.page_header
            };    // @class Cart.Detailed.View
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module jQueryExtras

#scPush

A jQuery plugin for manag push content that comes from the right side. To set up:

 * invoke this plugin to the content that will be pushed
 * that content must define a 'data-id' attribute (if not, it will be automatically generated)
 * add an element (button or else) to be the 'pusher' by adding data-type='sc-pusher'
 * that pusher must define a 'data-target' with the data-id of the push content
 * previously defined (if not defined, it will be automatically generated)

Available options:

	{
		target: 'mobile'/'tablet' -> only for mobile or both mobile and tablet
	}

Default options:

	{
		target: 'mobile' -> mobile only
	}
*/
define('jQuery.scPush', [
    'jQuery',
    'underscore',
    'Utils'
], function (jQuery, _, Utils) {
    'use strict';
    jQuery.fn.scPush = function (options) {
        var settings = jQuery.extend({}, jQuery.fn.push.defaults, options), $main = jQuery('.layout-container');
        // add an overlay on tablet devices to avoid unexpected behaviors (avoid navigations outside the pusher)
        setOverlay();
        // remove unnecesary styles when navigating (caused by pusher content events)
        $main.removeClass('sc-pushing');
        $main.css({
            'margin-top': '',
            'height': ''
        }).removeClass('sc-pushing-partial');
        // check if there was an opened pusher
        var opened_pusher_id = jQuery('[data-pushing]').attr('data-pushing'), opened_pusher = jQuery('[data-id="' + opened_pusher_id + '"]');
        if (opened_pusher.length > 0) {
            opened_pusher.addClass('sc-pushing-reopened');
            openPushContent(opened_pusher_id, true);
            $main.addClass('sc-pushing');
        }
        return this.each(function () {
            var self = this, $this = jQuery(this), $push_header = $this.find('.sc-pusher-header, [data-type="sc-pusher-header"]');
            if (!$push_header.length) {
                // add push header containing back button
                $push_header = jQuery('<div class="sc-pusher-header"><a href="#" class="sc-pusher-header-back" data-action="sc-pusher-dismiss">' + _('Back').translate() + '</a></div>');
                $this.prepend($push_header);
            }
            // add data-type for styling
            var push_target_size = settings.target === 'tablet' ? 'sc-pushable-md' : 'sc-pushable-xs';
            $this.attr('data-pusher', push_target_size);
            // get push content id (assign a new one if doesn't have)
            var id = $this.data('id');
            if (!id) {
                id = 'sc-pusher-' + new Date().getTime();
                $this.attr('data-id', id);
            }
            var openFn = jQuery.proxy(function (e) {
                var proxy = jQuery.proxy(openPushContent, this);
                if (options && options.beforeOpen) {
                    var res = options.beforeOpen(proxy, e);
                    if (!res) {
                        return;
                    }
                } else {
                    e.preventDefault();
                }
                // save current scroll height
                this.currentScroll = jQuery(document.body).scrollTop();
                // open the pusher content
                proxy(id);
                if (options && options.afterOpen) {
                    options.afterOpen(proxy, e);
                }
            }, this);
            var closeFn = jQuery.proxy(function (e) {
                e.preventDefault();
                $this.trigger('beforeClose');
                jQuery('#content').removeAttr('data-pushing');
                jQuery('[data-id="' + id + '"]').removeClass('sc-pushing-reopened');
                $main.removeClass('sc-pushing');
                jQuery('[data-view="Footer"]').show();
                if (Utils.getViewportWidth() < 768) {
                    this.currentScroll && jQuery(document.body).scrollTop(this.currentScroll);
                } else {
                    $main.css({
                        'margin-top': '',
                        'height': ''
                    }).removeClass('sc-pushing-partial');
                    jQuery(document.body).scrollTop(this.currentScroll);
                    jQuery('.main-push-overlay').removeClass('active');
                }
                if ($this.attr('data-action')) {
                    $this.attr('data-action', $this.attr('data-action').replace('sc-pushing', ''));
                }
                $this.trigger('afterClose');
            }, this);
            // search for pusher and add handler
            var pusher = jQuery('[data-type="sc-pusher"][data-target="' + id + '"]');
            $this.on('open', openFn);
            // open push action
            pusher.on('click', openFn);
            // close push action
            $this.on('close', closeFn);
            $push_header.find('[data-action="sc-pusher-dismiss"]').on('click', closeFn);
        });
    };
    function setOverlay() {
        if (Utils.getViewportWidth() >= 768) {
            var $main = jQuery('.layout-container'), overlay = jQuery('<div class="main-push-overlay" data-action="main-push-overlay-hide"></div>');
            $main.find('.main-push-overlay').remove();
            $main.append(overlay);
            overlay.on('click', function () {
                jQuery(this).removeClass('active');
                var pushed_content = jQuery('[data-action="sc-pushing"]');
                jQuery('#content').removeAttr('data-pushing');
                jQuery('[data-id="' + pushed_content.attr('data-id') + '"]').removeClass('sc-pushing-reopened');
                $main.removeClass('sc-pushing');
                jQuery('[data-view="Footer"]').show();
                $main.css({
                    'margin-top': '',
                    'height': ''
                }).removeClass('sc-pushing-partial');
                pushed_content.attr('data-action', pushed_content.attr('data-action').replace('sc-pushing', ''));
                // scroll back to the original scroll position
                jQuery(document.body).scrollTop(pushed_content[0].currentScroll);
            });
        }
    }
    function openPushContent(id, isStatic) {
        // let the content know what pusher is opened (useful when navigating so it remains open)
        jQuery('#content').attr('data-pushing', id);
        jQuery('[data-id="' + id + '"]').attr('data-action', 'sc-pushing');
        var open_handler = jQuery.proxy(onPushOpened, this);
        if (isStatic) {
            open_handler();
        } else {
            jQuery('[data-id="' + id + '"][data-action="sc-pushing"]').one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function (e) {
                open_handler();
                // remove handlers cause jQuery 'one' in Chrome will execute both webkitTransitionEnd and transitionend
                jQuery(this).off('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend');
            });
        }
    }
    function onPushOpened() {
        var $main = jQuery('.layout-container');
        if (Utils.getViewportWidth() < 768) {
            $main.addClass('sc-pushing');
            jQuery('[data-view="Footer"]').hide();
        } else {
            $main.css({
                'margin-top': -this.currentScroll,
                'height': '+=' + this.currentScroll
            }).addClass('sc-pushing-partial');
            jQuery('.main-push-overlay').addClass('active');
        }
    }
    jQuery.fn.push.defaults = {
        target: 'mobile',
        appendPusher: false
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.CartSaveForLater.View', [
    'SC.Configuration',
    'ErrorManagement',
    'ProductList.DetailsLater.View',
    'ProductList.Model',
    'ProductList.Item.Model',
    'Cart.Detailed.View',
    'Session',
    'Profile.Model',
    'product_list_details_later.tpl',
    'underscore',
    'jQuery',
    'Backbone',
    'Utils',
    'jQuery.scPush'
], function (Configuration, ErrorManagement, ProductListDetailsLaterView, ProductListModel, ProductListItemModel, CartDetailedView, Session, ProfileModel, product_list_details_later_tpl, _, jQuery, Backbone, Utils) {
    'use strict';
    // @class ProductList.SaveForLater.View extends the cart Detailed.View for adding save-for-later product list experience.
    // @extends Cart.Detailed.View
    var original_initialize = CartDetailedView.prototype.initialize, product_list_model = new ProductListModel();
    _.extend(CartDetailedView.prototype, {
        initialize: function () {
            var self = this;
            original_initialize.apply(this, arguments);
            this.productListModel = product_list_model;
            this.utils = this.application.ProductListModule && this.application.ProductListModule.Utils;
            ProfileModel.getPromise().done(function () {
                self.render();
            });
        },
        childViews: _.extend({}, CartDetailedView.prototype.childViews, {
            'SavedForLater': function () {
                if (this.utils && this.utils.isProductListEnabled()) {
                    return new ProductListDetailsLaterView({
                        application: this.options.application,
                        model: this.productListModel
                    });
                }
                return null;
            }
        })    // save for later:
              // handles the click event of the save for later button
              // removes the item from the cart and adds it to the saved for later list
,
        saveForLaterItem: function (e) {
            e.preventDefault();
            if (!this.validateLogin()) {
                return;
            }
            var cart_line = this.model.get('lines').get(jQuery(e.target).data('internalid')), internalid = cart_line.get('internalid'), whole_promise = jQuery.Deferred(), self = this;
            jQuery.when(this.model.removeLine(cart_line), self.addItemToList(cart_line)).then(function () {
                self.showConfirmationMessage(_('Good! You saved the item for later. If you want to add it back to your cart, see below in <b>"Saved for later"</b>').translate());
                whole_promise.resolve();
            });
            this.disableElementsOnPromise(whole_promise, '#' + internalid + ' button');
        }    // Add a new product list item into a product list
,
        addItemToList: function (cart_line) {
            var defer = jQuery.Deferred(), self = this;
            if (this.productListModel.isNew()) {
                this.productListModel.save().done(function () {
                    self.doAddItemToList(self.productListModel.get('internalid'), cart_line, defer);
                });
            } else {
                self.doAddItemToList(self.productListModel.get('internalid'), cart_line, defer);
            }
            return defer.promise();
        }    // Adds the new item to the collection
,
        doAddItemToList: function (product_list_id, cart_line, internal_promise) {
            var self = this, product_list_item_model = ProductListItemModel.createFromTransactionLine(cart_line);
            product_list_item_model.set('productList', { id: product_list_id });
            product_list_item_model.set('description', '');
            product_list_item_model.set('item', cart_line.get('item'), { silent: true });
            product_list_item_model.save(null, { validate: false }).done(function () {
                product_list_item_model.set('item', cart_line.get('item'), { silent: true });
                self.productListModel.get('items').add(product_list_item_model, { at: 0 });
                internal_promise.resolve();
            });
        },
        validateLogin: function () {
            if (ProfileModel.getInstance().get('isLoggedIn') === 'F') {
                var parameters = {
                    'origin': this.application.getConfig('currentTouchpoint'),
                    'origin_hash': encodeURIComponent(Backbone.history.fragment)
                };
                window.location.href = Utils.addParamsToUrl(Session.get('touchpoints.login'), parameters);
                return false;
            }
            return true;
        }
    });
    CartDetailedView.prototype.events = _.extend({}, CartDetailedView.prototype.events, { 'click [data-action="save-for-later-item"]': 'saveForLaterItem' });
    return CartDetailedView;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductList
define('ProductList.Utils', [
    'ProductList.Collection',
    'ProductList.Model',
    'Profile.Model',
    'ProductList.ControlSingle.View',
    'ProductList.Control.View',
    'ProductList.Item.Model',
    'MenuTree.View',
    'underscore',
    'jQuery',
    'ProductList.CartSaveForLater.View'
], function (ProductListCollection, ProductListModel, ProfileModel, ProductListControlSingleView, ProductListControlView, ProductListItemModel, MenuTreeView, _, jQuery) {
    'use strict';
    var productListsInstancePromise, productListsInstance;
    // @class ProductList.Utils an utility class to support the ProductList ApplicationModule. It will define shortcut accessors to product lists, render the controls on 'afterAppendView' and show and define the MyAccount menu items.
    return function (application) {
        return {
            // @method getProductListsPromise Loads Product Lists collection model singleton @return {jQuery.Deferred}
            getProductListsPromise: function () {
                if (!productListsInstancePromise) {
                    productListsInstancePromise = jQuery.Deferred();
                    productListsInstance = new ProductListCollection();
                    productListsInstance.application = application;
                    productListsInstance.fetch({ cache: false }).done(function (jsonCollection) {
                        productListsInstance.reset(jsonCollection);
                        productListsInstancePromise.resolve(productListsInstance);
                    });
                }
                return productListsInstancePromise;
            }    // @method productListsPromiseDone method to be called once the product lists are loaded to show the MyAccount's menu item
,
            productListsPromiseDone: function () {
                // Replace dummy menu item from My Account
                var layout = application.getLayout(), menu_tree = MenuTreeView.getInstance();
                menu_tree.replaceMenuItem(function (menuitem) {
                    return menuitem && menuitem.id === 'product_list_dummy';
                }, function (application) {
                    var utils = application.ProductListModule.Utils;
                    if (!utils.isProductListEnabled()) {
                        return undefined;
                    }
                    var product_lists = utils.getProductLists(), actual_object = {
                            id: function () {
                                // Returns the correct id of the list in the case of single list and 'productlists' otherwise.
                                var is_single_list = utils.isSingleList();
                                if (is_single_list) {
                                    var the_single_list = product_lists.at(0);
                                    // Check if it's a predefined list before return
                                    return 'productlist_' + (the_single_list.get('internalid') ? the_single_list.get('internalid') : 'tmpl_' + the_single_list.get('templateId'));
                                } else {
                                    return 'productlists';
                                }
                            },
                            name: function () {
                                // The name of the first list in the case of single list or generic 'Product Lists' otherwise
                                return utils.isSingleList() ? product_lists.at(0).get('name') : _('Wishlist').translate();
                            },
                            url: function () {
                                // Returns a link to the list in the case of single list and no link otherwise.
                                var is_single_list = utils.isSingleList();
                                if (is_single_list) {
                                    var the_single_list = product_lists.at(0);
                                    return 'wishlist/' + (the_single_list.get('internalid') ? the_single_list.get('internalid') : 'tmpl_' + the_single_list.get('templateId'));
                                } else {
                                    return '';
                                }
                            }    // Index of the menu item for menu order
,
                            index: 2    // Sub-menu items
,
                            children: function () {
                                // If it's single list, there is no sub-menu
                                if (utils.isSingleList()) {
                                    return [];
                                }
                                // The first item (if not single list) has to be a link to the landing page
                                var items = [{
                                        id: 'productlist_all',
                                        name: _('All my lists').translate(),
                                        url: 'wishlist/?',
                                        index: 1
                                    }];
                                // Then add all the lists
                                product_lists.each(function (productlist) {
                                    items.push({
                                        id: 'productlist_' + (productlist.get('internalid') || 'tmpl_' + productlist.get('templateId')),
                                        url: 'wishlist/' + (productlist.get('internalid') || 'tmpl_' + productlist.get('templateId')),
                                        name: productlist.get('name') + ' (' + productlist.get('items').length + ')',
                                        index: 2
                                    });
                                });
                                return items;
                            }
                        };
                    return actual_object;
                });
                menu_tree.updateMenuItemsUI();
                if (application.ProductListModule.Utils.isSingleList()) {
                    // Update header profile link for single product list...
                    var the_single_list = application.ProductListModule.Utils.getProductLists().at(0), product_list_menu_item = layout.$('.header-profile-single-productlist');
                    if (the_single_list && product_list_menu_item) {
                        var product_list_hashtag = '#wishlist/' + (the_single_list.get('internalid') ? the_single_list.get('internalid') : 'tmpl_' + the_single_list.get('templateId'));
                        product_list_menu_item.text(the_single_list.get('name'));
                        product_list_menu_item.attr('data-hashtag', product_list_hashtag);
                    }
                }
            }    // @method profileModelPromiseDone method to be executed once the user profile has loaded. We need this to start working with product lists.
,
            profileModelPromiseDone: function () {
                var utils = application.ProductListModule.Utils;
                // if Product Lists are not enabled, return...
                if (!utils.isProductListEnabled()) {
                    return;
                }
                var layout = application.getLayout();
                // rendering product lists
                utils.renderProductLists();
                layout.on('afterAppendView', function (view) {
                    utils.renderProductLists(view);
                });
                layout.on('afterAppendToDom', function () {
                    utils.renderProductLists();
                });
                // Put this code block outside afterAppendView to avoid infinite loop!
                utils.getProductListsPromise().done(utils.productListsPromiseDone);
                ProductListItemModel.prototype.keyMapping = application.getConfig('itemKeyMapping', {});
                ProductListItemModel.prototype.itemOptionsConfig = application.getConfig('itemOptions', []);
            }    // @method getProductLists @return {ProductList.Collection}
,
            getProductLists: function () {
                if (!productListsInstance) {
                    productListsInstance = new ProductListCollection();
                    productListsInstance.application = application;
                }
                return productListsInstance;
            }    // @method getProductList obtain a single ProductList with all its item's data @return {ProductList.Model}
,
            getProductList: function (id) {
                var productList = new ProductListModel();
                productList.set('internalid', id);
                return productList.fetch();
            }    // @method getSavedForLaterProductList obtain a single Saved for Later ProductList with all its item's data @return {jQuery.Deferred}
,
            getSavedForLaterProductList: function () {
                var productList = new ProductListModel();
                productList.set('internalid', 'later');
                return productList.fetch();
            },
            getRequestAQuoteProductList: function () {
                var productList = new ProductListModel();
                productList.set('internalid', 'quote');
                return productList.fetch();
            }    // @method isProductListEnabled is the Product-List functionality available for this application? @return {Boolean}
,
            isProductListEnabled: function () {
                return SC.ENVIRONMENT.PRODUCTLIST_ENABLED;
            }    // @method isSingleList are we in the single-list modality ? @return {Boolean}
,
            isSingleList: function () {
                return !application.getConfig('productList.additionEnabled', false) && _.filter(application.getConfig('productList.listTemplates', []), function (pl) {
                    return !pl.typeName || pl.typeName !== 'later' && pl.typeName !== 'quote';
                }).length === 1;
            }    // @method renderProductLists render all product-lists related widgets @param {Backbone.View} view
,
            renderProductLists: function (view) {
                if (!application.ProductListModule.Utils.isProductListEnabled()) {
                    return;
                }
                application.ProductListModule.Utils.renderControl(view);
            }    // @method internalGetProductId Gets the internal product id for a store item considering it could be a matrix child.
                 // @param {Item.Model} product
                 // @return {String}
,
            internalGetProductId: function (product) {
                // If its matrix its expected that only 1 item is selected, not more than one nor 0
                if (product.getPosibleOptions().length) {
                    var selected_options = product.getSelectedMatrixChilds();
                    if (selected_options.length === 1) {
                        return selected_options[0].get('internalid') + '';
                    }
                }
                return product.get('_id') + '';
            }    // @property {control:String} placeholder this application will render some of its views in existing DOM elements (placeholders)
,
            placeholder: { control: '[data-type="product-lists-control"]' }    // @method renderControl renders the control used in shopping pdp and quickview @param {Backbone.View} view
,
            renderControl: function (view_) {
                var utils = application.ProductListModule.Utils;
                jQuery(this.placeholder.control).each(function () {
                    var view = view_ || application.getLayout().currentView, is_single_list_mode = utils.isSingleList(), $container = jQuery(this), product_lists_promise = utils.getProductListsPromise();
                    product_lists_promise.done(function () {
                        // this control needs a reference to the StoreItem model !
                        if (view && view.model && view.model.getPosibleOptions) {
                            var control = null;
                            if (is_single_list_mode) {
                                control = new ProductListControlSingleView({
                                    collection: utils.getProductLists(),
                                    product: view.model,
                                    application: application
                                });
                            } else {
                                view.countedClicks = {};
                                control = new ProductListControlView({
                                    collection: utils.getProductLists(),
                                    product: view.model,
                                    application: application,
                                    isDisabledWishlistButton: !!jQuery(utils.placeholder.control).data('disabledbutton'),
                                    countedClicks: view.countedClicks
                                });
                            }
                            $container.empty().append(control.$el);
                            control.render();
                        }
                    });
                    if (product_lists_promise.state() === 'pending') {
                        $container.empty().append('<button class="product-list-control-button-wishlist">' + (is_single_list_mode ? _('Loading List...').translate() : _('Loading Lists...').translate()) + '</button>');
                    }
                });
            }
        };
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Header
define('Header.Menu.MyAccount.View', [
    'SC.Configuration',
    'header_menu_myaccount.tpl',
    'Backbone',
    'underscore',
    'jQuery',
    'ProductList.Utils'
], function (Configuration, header_menu_myaccount_tpl, Backbone, _, jQuery, ProductListUtils) {
    'use strict';
    // @class Header.Profile.View @extends Backbone.View
    return Backbone.View.extend({
        template: header_menu_myaccount_tpl,
        initialize: function () {
            this.productListModule = ProductListUtils(this.options.application);
            this.isProductListEnabled = this.productListModule.isProductListEnabled();
            if (this.isProductListEnabled) {
                this.productListsPromise = this.productListModule.getProductListsPromise();
                this.product_list_collection = this.productListModule.getProductLists();
                var self = this;
                this.debounced_render = _.debounce(_.bind(this.render, this), 250);
                this.productListsPromise.done(function () {
                    _.each(self.product_list_collection.models, function (list) {
                        list.get('items').on('add remove', function () {
                            self.debounced_render();
                        }, this);
                    }, this);
                    self.debounced_render();
                });
                this.product_list_collection.on('add remove change:name', this.debounced_render);
            } else {
                this.productListsPromise = jQuery.Deferred();
            }
        },
        render: function () {
            this._render();
            if (this.$('.header-menu-myaccount-level3-orders').children().length === 1) {
                //All children menu of the order section have been removed (lack of permissions) and only the back options is present
                this.$('.header-menu-myaccount-level2-orders').remove();
            }
        },
        destroy: function () {
            if (this.product_list_collection) {
                this.product_list_collection.off('add remove', this.debounced_render);
            }
            this._destroy();
        }    // @method getContext @return {Header.Profile.View.Context}
,
        getContext: function () {
            if (this.product_list_collection) {
                this.product_list_collection.each(function (product_list) {
                    var url = 'wishlist/' + (product_list.get('internalid') || 'tmpl_' + product_list.get('templateId'));
                    product_list.set('url', url, { silent: true });
                });
            }
            var isSCISIntegrationEnabled = Configuration.get('siteSettings.isSCISIntegrationEnabled', false);
            // @class Header.Profile.View.Context
            return {
                // @property {Boolean} isProductListsEnabled
                isProductListsEnabled: !!this.isProductListEnabled,
                isSingleList: !!this.productListModule.isSingleList()    // @property {Boolean} isCaseModuleEnabled
,
                isCaseModuleEnabled: SC && SC.ENVIRONMENT && SC.ENVIRONMENT.casesManagementEnabled,
                productListsReady: this.productListsPromise.state() === 'resolved'    // @property {ProductList.Collection|Array} productLists
,
                productLists: this.product_list_collection || []    // @property {Boolean} purchasesPermissions
,
                purchasesPermissions: isSCISIntegrationEnabled ? 'transactions.tranFind.1,transactions.tranPurchases.1' : 'transactions.tranFind.1,transactions.tranSalesOrd.1'    // @property {Boolean} returnsPermissions
,
                returnsPermissions: isSCISIntegrationEnabled ? 'transactions.tranFind.1,transactions.tranPurchasesReturns.1' : 'transactions.tranFind.1,transactions.tranRtnAuth.1'
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Header
define('Header.Profile.View', [
    'Profile.Model',
    'SC.Configuration',
    'Header.Menu.MyAccount.View',
    'header_profile.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'underscore'
], function (ProfileModel, Configuration, HeaderMenuMyAccountView, header_profile_tpl, Backbone, BackboneCompositeView, _) {
    'use strict';
    // @class Header.Profile.View
    return Backbone.View.extend({
        template: header_profile_tpl,
        initialize: function () {
            var self = this;
            BackboneCompositeView.add(this);
            ProfileModel.getPromise().done(function () {
                self.render();
            });
            this.on('afterViewRender', function () {
                _.ellipsis('.header-profile-loading-indicator');
            });
        },
        childViews: {
            'Header.Menu.MyAccount': function () {
                return new HeaderMenuMyAccountView(this.options);
            }
        }    // @method getContext @return {Header.Profile.View.Context}
,
        getContext: function () {
            var profile = ProfileModel.getInstance(), is_loading = !_.getPathFromObject(Configuration, 'performance.waitForUserProfile', true) && ProfileModel.getPromise().state() !== 'resolved', is_logged_in = (profile.get('isLoggedIn') === 'T' || profile.get('isRecognized') === 'T') && profile.get('isGuest') === 'F';
            // @class Header.Profile.View.Context
            return {
                // @property {Boolean} showExtendedMenu
                showExtendedMenu: !is_loading && is_logged_in    // @property {Boolean} showLoginMenu
,
                showLoginMenu: !is_loading && !is_logged_in    // @property {Boolean} showLoadingMenu
,
                showLoadingMenu: is_loading    // @property {Boolean} showMyAccountMenu
,
                showMyAccountMenu: !!this.options.showMyAccountMenu,
                displayName: profile.get('firstname') || profile.get('companyname')    // @property {Boolean} showLogin
,
                showLogin: Configuration.getRegistrationType() !== 'disabled'    // @property {Boolean} showRegister
,
                showRegister: Configuration.getRegistrationType() === 'optional' || Configuration.getRegistrationType() === 'required'
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module GlobalViews
define('GlobalViews.HostSelector.View', [
    'SC.Configuration',
    'global_views_host_selector.tpl',
    'Backbone',
    'Utils',
    'underscore',
    'jQuery'
], function (Configuration, global_views_host_selector_tpl, Backbone, Utils, _, jQuery) {
    'use strict';
    // @class GlobalViews.HostSelector.View @extends Backbone.View
    return Backbone.View.extend({
        template: global_views_host_selector_tpl,
        events: {
            'change select[data-toggle="host-selector"]': 'selectHost',
            'click select[data-toggle="host-selector"]': 'selectHostClick'
        }    // @method selectHostClick @param {HTMLEvent} e
,
        selectHostClick: function (e) {
            e.stopPropagation();
        }    // @method selectHost @param {HTMLEvent} e
,
        selectHost: function (e) {
            if (Configuration.currentTouchpoint === 'home') {
                this.setHost(e);
            } else {
                this.setLang(e);
            }
        }    // @method setHref @param {String} url
,
        setHref: function (url) {
            window.location.href = Utils.getAbsoluteUrl('redirections.ssp?location=' + location.protocol + '//' + url);
        }    // @method setSearch @param {String} search
,
        setSearch: function (search) {
            window.location.search = search;
        }    // @method getCurrentPath @returns {String}
,
        getCurrentPath: function () {
            return location.pathname;
        }    // @method setHost @param {HTMLEvent} e
,
        setHost: function (e) {
            var host = jQuery(e.target).val(), url;
            if (Backbone.history._hasPushState) {
                // Seo Engine is on, send him to the root
                url = host;
            } else {
                // send it to the current path, it's probably a test site
                url = host + this.getCurrentPath();
            }
            // redirects to url
            this.setHref(url);
        }    // @method setLang @param {HTMLEvent} e
,
        setLang: function (e) {
            var selected_host = jQuery(e.target).val(), available_hosts = SC.ENVIRONMENT.availableHosts, selected_language;
            for (var i = 0; i < available_hosts.length; i++) {
                var host = available_hosts[i], lang = _(host.languages).findWhere({ host: selected_host });
                if (lang && lang.locale) {
                    selected_language = lang;
                    break;
                }
            }
            // use the param **"lang"** to pass this to the ssp environment
            if (selected_language && selected_language.locale) {
                var current_search = Utils.parseUrlOptions(window.location.search);
                current_search.lang = selected_language.locale;
                var search = _.reduce(current_search, function (memo, val, name) {
                    return val ? memo + name + '=' + val + '&' : memo;
                }, '?');
                this.setSearch(search);
                return search;
            }
        }    // @method getContext @return GlobalViews.HostSelector.View.Context
,
        getContext: function () {
            var is_home_touchpoint = Configuration.currentTouchpoint === 'home';
            var use_parameter = !is_home_touchpoint, current_host = is_home_touchpoint ? SC.ENVIRONMENT.currentHostString : SC.ENVIRONMENT.currentLanguage.locale, available_hosts = _.map(SC.ENVIRONMENT.availableHosts, function (host) {
                    // @class GlobalViews.HostSelector.View.Context.Host
                    return {
                        // @property {Boolean} hasLanguages
                        hasLanguages: host.languages && host.languages.length,
                        title: host.title,
                        languages: _.map(host.languages, function (language) {
                            //@class GlobalViews.HostSelector.View.Context.Host.Language
                            return {
                                // @property {String} host
                                host: language.host,
                                displayName: language.title || language.name,
                                isSelected: !!(use_parameter && language.locale === current_host || language.host === current_host)
                            };
                        })
                    };
                });
            // @class GlobalViews.HostSelector.View.Context
            return {
                // @property {Boolean} showHosts
                showHosts: !!(available_hosts && available_hosts.length > 1)    // @property {Array<GlobalViews.HostSelector.View.Context.Host>} availableHosts
,
                availableHosts: available_hosts    // @property {String} currentHost
,
                currentHost: current_host    // @param {Boolean} useParameter
,
                useParameter: use_parameter
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module GlobalViews
define('GlobalViews.CurrencySelector.View', [
    'SC.Configuration',
    'Utils',
    'Session',
    'global_views_currency_selector.tpl',
    'Backbone',
    'underscore'
], function (Configuration, Utils, Session, global_views_currency_selector_tpl, Backbone, _) {
    'use strict';
    // @class GlobalViews.CurrencySelector.View @extends Backbone.View
    return Backbone.View.extend({
        template: global_views_currency_selector_tpl,
        events: {
            'change select[data-toggle="currency-selector"]': 'setCurrency',
            'click select[data-toggle="currency-selector"]': 'currencySelectorClick'
        }    // @method currencySelectorClick @param {HTMLEvent} e
,
        currencySelectorClick: function (e) {
            e.stopPropagation();
        }    // @method setCurrency @param {HTMLEvent} e
,
        setCurrency: function (e) {
            var currency_code = this.$(e.target).val(), selected_currency = _.find(SC.ENVIRONMENT.availableCurrencies, function (currency) {
                    return currency.code === currency_code;
                });
            window.location.href = Utils.addParamsToUrl(Session.get('touchpoints.' + Configuration.get('currentTouchpoint')), { cur: selected_currency.code });
        }    // @method getContext
             // @return {GlobalViews.CurrencySelector.View.Context}
,
        getContext: function () {
            var available_currencies = _.map(SC.ENVIRONMENT.availableCurrencies, function (currency) {
                // @class GlobalViews.CurrencySelector.View.Context.Currency
                return {
                    // @property {String} code
                    code: currency.code,
                    internalId: currency.internalid,
                    isDefault: currency.isdefault,
                    symbol: currency.symbol,
                    symbolPlacement: currency.symbolplacement,
                    displayName: currency.title || currency.name,
                    isSelected: SC.ENVIRONMENT.currentCurrency.code === currency.code
                };
            });
            // @class GlobalViews.CurrencySelector.View.Context
            return {
                // @property {Boolean} showCurrencySelector
                showCurrencySelector: !!(SC.ENVIRONMENT.availableCurrencies && SC.ENVIRONMENT.availableCurrencies.length > 1)    // @property {Array<GlobalViews.CurrencySelector.View.Context.Currency>} availableCurrencies
,
                availableCurrencies: available_currencies || []    // @property {String} currentCurrencyCode
,
                currentCurrencyCode: SC.ENVIRONMENT.currentCurrency.code,
                currentCurrencySymbol: SC.getSessionInfo('currency').symbol
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('jQuery.sidebarMenu', ['jQuery'], function (jQuery) {
    'use strict';
    function Menu(el) {
        var wrapper = el, last_opened_menu = wrapper, root_ul = wrapper.find('.header-sidebar-menu:first'), animating = false, has_animation_support = detectAnimationSupport(), class_names = {
                menuOpened: 'header-sidebar-menu-opened',
                menuPath: 'header-sidebar-menu-path',
                menuTransition: 'header-sidebar-menu-transition',
                animateIn: 'header-sidebar-menu-flyer-in',
                animateOut: 'header-sidebar-menu-flyer-out',
                flyer: 'header-sidebar-menu-flyer'
            }, height_stack = [];
        //initializing menu
        last_opened_menu.addClass(class_names.menuPath);
        last_opened_menu.addClass(class_names.menuOpened);
        jQuery(root_ul).on('click', '[data-action="push-menu"]', function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (animating === true) {
                return;
            }
            animating = true;
            var anchor = jQuery(this), parent_li = anchor.closest('li'), pushing_menu = anchor.next();
            animate(pushing_menu, class_names.animateIn, function () {
                //change the last opened menu.
                last_opened_menu.removeClass(class_names.menuOpened);
                last_opened_menu = parent_li;
                //add current opened subview
                parent_li.addClass(class_names.menuPath).addClass(class_names.menuOpened);
            });
        });
        jQuery(root_ul).on('click', '[data-action="pop-menu"]', function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (animating === true) {
                return;
            }
            animating = true;
            var anchor = jQuery(this)    //anchor is the back button
, anchor_menu = anchor.closest('ul'), opened_li = anchor.closest('.' + class_names.menuOpened);
            opened_li.removeClass(class_names.menuPath).removeClass(class_names.menuOpened);
            last_opened_menu = opened_li.closest('.' + class_names.menuPath);
            last_opened_menu.addClass(class_names.menuOpened);
            animate(anchor_menu, class_names.animateOut);
        });
        var flyer_className = '.' + class_names.flyer;
        jQuery(wrapper).on('animationend MSAnimationEnd oAnimationEnd webkitAnimationEnd', flyer_className, function () {
            var cb = jQuery(this).data('callback');
            if (cb) {
                cb();
            }
            jQuery(this).remove();
            animating = false;
            root_ul.addClass(class_names.menuTransition);    //fix ios transition glitch
        });
        function animate(sub_menu, animation_class, cb) {
            var flyer_menu = sub_menu.clone(false);
            flyer_menu.removeClass().addClass(class_names.flyer).insertAfter(root_ul).addClass(animation_class);
            if (animation_class === class_names.animateIn) {
                height_stack.push(root_ul.height());
                root_ul.css('height', flyer_menu.height());
            } else {
                root_ul.css('height', height_stack.pop());
            }
            flyer_menu.data('callback', cb);
            if (!has_animation_support) {
                if (cb) {
                    cb();
                }
                flyer_menu.remove();
                animating = false;
                root_ul.addClass(class_names.menuTransition);    //fix ios transition glitch
            }
        }
    }
    function detectAnimationSupport() {
        var domPrefixes = 'Webkit Moz O ms Khtml'.split(' '), elm = document.createElement('div');
        if (elm.style.animationName !== undefined) {
            return true;
        }
        for (var i = 0; i < domPrefixes.length; i++) {
            if (elm.style[domPrefixes[i] + 'AnimationName'] !== undefined) {
                return true;
            }
        }
        return false;
    }
    jQuery.fn.sidebarMenu = function () {
        return this.each(function () {
            Menu(jQuery(this));
        });
    };
    return jQuery.fn.sidebarMenu;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Header
define('Header.Menu.View', [
    'Profile.Model',
    'SC.Configuration',
    'Header.Profile.View',
    'Header.Menu.MyAccount.View',
    'GlobalViews.HostSelector.View',
    'GlobalViews.CurrencySelector.View',
    'header_menu.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'underscore',
    'jQuery',
    'jQuery.sidebarMenu'
], function (ProfileModel, Configuration, HeaderProfileView, HeaderMenuMyAccountView, GlobalViewsHostSelectorView, GlobalViewsCurrencySelectorView, header_menu, Backbone, BackboneCompositeView, _, jQuery) {
    'use strict';
    //@class Header.Menu.View @extends Backbone.View
    return Backbone.View.extend({
        template: header_menu,
        events: {
            'mouseenter [data-toggle="categories-menu"]': 'menuOpen',
            'mouseleave [data-toggle="categories-menu"]': 'menuClose',
            'click [data-toggle="categories-menu"]': 'menuClose'
        },
        menuOpen: function (e) {
            jQuery(e.currentTarget).addClass('open');
        },
        menuClose: function (e) {
            jQuery(e.currentTarget).removeClass('open');
        },
        initialize: function () {
            var self = this;
            BackboneCompositeView.add(this);
            this.options.application.on('Configuration.navigationData', this.render, this);
            ProfileModel.getPromise().done(function () {
                self.render();
            });
        },
        childViews: {
            'Header.Profile': function () {
                return new HeaderProfileView({
                    showMyAccountMenu: false,
                    application: this.options.application
                });
            },
            'Header.Menu.MyAccount': function () {
                return new HeaderMenuMyAccountView(this.options);
            },
            'Global.HostSelector': function () {
                return new GlobalViewsHostSelectorView();
            },
            'Global.CurrencySelector': function () {
                return new GlobalViewsCurrencySelectorView();
            }
        },
        render: function () {
            Backbone.View.prototype.render.apply(this, arguments);
            this.$('[data-type="header-sidebar-menu"]').sidebarMenu();
        }    // @method getContext
             // @return {Header.Sidebar.View.Context}
,
        getContext: function () {
            var profile = ProfileModel.getInstance(), is_loading = !Configuration.get('performance.waitForUserProfile', true) && ProfileModel.getPromise().state() !== 'resolved', is_loged_in = profile.get('isLoggedIn') === 'T' && profile.get('isGuest') === 'F', environment = SC.ENVIRONMENT, show_languages = environment.availableHosts && environment.availableHosts.length > 1, show_currencies = environment.availableCurrencies && environment.availableCurrencies.length > 1 && !Configuration.get('header.notShowCurrencySelector');
            // @class Header.Sidebar.View.Context
            return {
                // @property {Array<NavigationData>} navigationItems
                categories: Configuration.navigationData || []    // @property {Boolean} showExtendedMenu
,
                showExtendedMenu: !is_loading && is_loged_in    // @property {Boolean} showLanguages
,
                showLanguages: show_languages    // @property {Boolean} showCurrencies
,
                showCurrencies: show_currencies
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ItemsSearcher
define('ItemsSearcher.Utils', [
    'SC.Configuration',
    'underscore'
], function (Configuration, _) {
    'use strict';
    // @class ItemsSearcher.Utils
    return {
        // @method formatKeywords format a search query string according to configuration.js (searchPrefs)
        // @param {String} keywords @return {String} the formatted keywords
        // @static
        // @return {String}
        formatKeywords: function (keywords) {
            var keywordFormatter = _.getPathFromObject(Configuration, 'searchPrefs.keywordsFormatter');
            if (keywordFormatter && _.isFunction(keywordFormatter)) {
                keywords = keywordFormatter(keywords);
                var maxLength = _.getPathFromObject(Configuration, 'searchPrefs.maxLength', 99999);
                if (keywords.length > maxLength) {
                    keywords = keywords.substring(0, maxLength);
                }
            }
            return keywords;
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module BackboneExtras 
// @class Backbone.CachedCollection 
// It's just an extension of the original Backbone.Collection but it uses the Backbone.cachedSync 
// @extends Backbone.Collection
define('Backbone.CachedCollection', [
    'Backbone.CachedSync',
    'Backbone'
], function (BackboneCachedSync, Backbone) {
    'use strict';
    Backbone.CachedCollection = Backbone.Collection.extend({
        sync: BackboneCachedSync.cachedSync,
        addToCache: BackboneCachedSync.addToCache,
        isCached: BackboneCachedSync.isCached
    });
    return Backbone.CachedCollection;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Item
define('Item.Collection', [
    'Backbone.CachedCollection',
    'Item.Model',
    'Session',
    'Profile.Model',
    'underscore',
    'Utils'
], function (BackboneCachedCollection, ItemModel, Session, ProfileModel, _) {
    'use strict';
    //@class Item.Collection @extends Backbone.BackboneCachedCollection
    return BackboneCachedCollection.extend({
        url: function () {
            var profile = ProfileModel.getInstance(), url = _.addParamsToUrl(profile.getSearchApiUrl(), _.extend({}, this.searchApiMasterOptions, Session.getSearchApiParams()), profile.isAvoidingDoubleRedirect());
            return url;
        },
        model: ItemModel    // http://backbonejs.org/#Model-parse
,
        parse: function (response) {
            // NOTE: Compact is used to filter null values from response
            return _.compact(response.items) || null;
        }
    });
});
/*!
 * typeahead.js 0.10.5
 * https://github.com/twitter/typeahead.js
 * Copyright 2013-2014 Twitter, Inc. and other contributors; Licensed MIT
 */
define('typeahead', ['jQuery'], function () {
    (function ($) {
        var _ = function () {
            'use strict';
            return {
                isMsie: function () {
                    return /(msie|trident)/i.test(navigator.userAgent) ? navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2] : false;
                },
                isBlankString: function (str) {
                    return !str || /^\s*$/.test(str);
                },
                escapeRegExChars: function (str) {
                    return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, '\\$&');
                },
                isString: function (obj) {
                    return typeof obj === 'string';
                },
                isNumber: function (obj) {
                    return typeof obj === 'number';
                },
                isArray: $.isArray,
                isFunction: $.isFunction,
                isObject: $.isPlainObject,
                isUndefined: function (obj) {
                    return typeof obj === 'undefined';
                },
                toStr: function toStr(s) {
                    return _.isUndefined(s) || s === null ? '' : s + '';
                },
                bind: $.proxy,
                each: function (collection, cb) {
                    $.each(collection, reverseArgs);
                    function reverseArgs(index, value) {
                        return cb(value, index);
                    }
                },
                map: $.map,
                filter: $.grep,
                every: function (obj, test) {
                    var result = true;
                    if (!obj) {
                        return result;
                    }
                    $.each(obj, function (key, val) {
                        if (!(result = test.call(null, val, key, obj))) {
                            return false;
                        }
                    });
                    return !!result;
                },
                some: function (obj, test) {
                    var result = false;
                    if (!obj) {
                        return result;
                    }
                    $.each(obj, function (key, val) {
                        if (result = test.call(null, val, key, obj)) {
                            return false;
                        }
                    });
                    return !!result;
                },
                mixin: $.extend,
                getUniqueId: function () {
                    var counter = 0;
                    return function () {
                        return counter++;
                    };
                }(),
                templatify: function templatify(obj) {
                    return $.isFunction(obj) ? obj : template;
                    function template() {
                        return String(obj);
                    }
                },
                defer: function (fn) {
                    setTimeout(fn, 0);
                },
                debounce: function (func, wait, immediate) {
                    var timeout, result;
                    return function () {
                        var context = this, args = arguments, later, callNow;
                        later = function () {
                            timeout = null;
                            if (!immediate) {
                                result = func.apply(context, args);
                            }
                        };
                        callNow = immediate && !timeout;
                        clearTimeout(timeout);
                        timeout = setTimeout(later, wait);
                        if (callNow) {
                            result = func.apply(context, args);
                        }
                        return result;
                    };
                },
                throttle: function (func, wait) {
                    var context, args, timeout, result, previous, later;
                    previous = 0;
                    later = function () {
                        previous = new Date();
                        timeout = null;
                        result = func.apply(context, args);
                    };
                    return function () {
                        var now = new Date(), remaining = wait - (now - previous);
                        context = this;
                        args = arguments;
                        if (remaining <= 0) {
                            clearTimeout(timeout);
                            timeout = null;
                            previous = now;
                            result = func.apply(context, args);
                        } else if (!timeout) {
                            timeout = setTimeout(later, remaining);
                        }
                        return result;
                    };
                },
                noop: function () {
                }
            };
        }();
        var VERSION = '0.10.5';
        var tokenizers = function () {
            'use strict';
            return {
                nonword: nonword,
                whitespace: whitespace,
                obj: {
                    nonword: getObjTokenizer(nonword),
                    whitespace: getObjTokenizer(whitespace)
                }
            };
            function whitespace(str) {
                str = _.toStr(str);
                return str ? str.split(/\s+/) : [];
            }
            function nonword(str) {
                str = _.toStr(str);
                return str ? str.split(/\W+/) : [];
            }
            function getObjTokenizer(tokenizer) {
                return function setKey() {
                    var args = [].slice.call(arguments, 0);
                    return function tokenize(o) {
                        var tokens = [];
                        _.each(args, function (k) {
                            tokens = tokens.concat(tokenizer(_.toStr(o[k])));
                        });
                        return tokens;
                    };
                };
            }
        }();
        var LruCache = function () {
            'use strict';
            function LruCache(maxSize) {
                this.maxSize = _.isNumber(maxSize) ? maxSize : 100;
                this.reset();
                if (this.maxSize <= 0) {
                    this.set = this.get = $.noop;
                }
            }
            _.mixin(LruCache.prototype, {
                set: function set(key, val) {
                    var tailItem = this.list.tail, node;
                    if (this.size >= this.maxSize) {
                        this.list.remove(tailItem);
                        delete this.hash[tailItem.key];
                    }
                    if (node = this.hash[key]) {
                        node.val = val;
                        this.list.moveToFront(node);
                    } else {
                        node = new Node(key, val);
                        this.list.add(node);
                        this.hash[key] = node;
                        this.size++;
                    }
                },
                get: function get(key) {
                    var node = this.hash[key];
                    if (node) {
                        this.list.moveToFront(node);
                        return node.val;
                    }
                },
                reset: function reset() {
                    this.size = 0;
                    this.hash = {};
                    this.list = new List();
                }
            });
            function List() {
                this.head = this.tail = null;
            }
            _.mixin(List.prototype, {
                add: function add(node) {
                    if (this.head) {
                        node.next = this.head;
                        this.head.prev = node;
                    }
                    this.head = node;
                    this.tail = this.tail || node;
                },
                remove: function remove(node) {
                    node.prev ? node.prev.next = node.next : this.head = node.next;
                    node.next ? node.next.prev = node.prev : this.tail = node.prev;
                },
                moveToFront: function (node) {
                    this.remove(node);
                    this.add(node);
                }
            });
            function Node(key, val) {
                this.key = key;
                this.val = val;
                this.prev = this.next = null;
            }
            return LruCache;
        }();
        var PersistentStorage = function () {
            'use strict';
            var ls, methods;
            try {
                ls = window.localStorage;
                ls.setItem('~~~', '!');
                ls.removeItem('~~~');
            } catch (err) {
                ls = null;
            }
            function PersistentStorage(namespace) {
                this.prefix = [
                    '__',
                    namespace,
                    '__'
                ].join('');
                this.ttlKey = '__ttl__';
                this.keyMatcher = new RegExp('^' + _.escapeRegExChars(this.prefix));
            }
            if (ls && window.JSON) {
                methods = {
                    _prefix: function (key) {
                        return this.prefix + key;
                    },
                    _ttlKey: function (key) {
                        return this._prefix(key) + this.ttlKey;
                    },
                    get: function (key) {
                        if (this.isExpired(key)) {
                            this.remove(key);
                        }
                        return decode(ls.getItem(this._prefix(key)));
                    },
                    set: function (key, val, ttl) {
                        if (_.isNumber(ttl)) {
                            ls.setItem(this._ttlKey(key), encode(now() + ttl));
                        } else {
                            ls.removeItem(this._ttlKey(key));
                        }
                        return ls.setItem(this._prefix(key), encode(val));
                    },
                    remove: function (key) {
                        ls.removeItem(this._ttlKey(key));
                        ls.removeItem(this._prefix(key));
                        return this;
                    },
                    clear: function () {
                        var i, key, keys = [], len = ls.length;
                        for (i = 0; i < len; i++) {
                            if ((key = ls.key(i)).match(this.keyMatcher)) {
                                keys.push(key.replace(this.keyMatcher, ''));
                            }
                        }
                        for (i = keys.length; i--;) {
                            this.remove(keys[i]);
                        }
                        return this;
                    },
                    isExpired: function (key) {
                        var ttl = decode(ls.getItem(this._ttlKey(key)));
                        return _.isNumber(ttl) && now() > ttl ? true : false;
                    }
                };
            } else {
                methods = {
                    get: _.noop,
                    set: _.noop,
                    remove: _.noop,
                    clear: _.noop,
                    isExpired: _.noop
                };
            }
            _.mixin(PersistentStorage.prototype, methods);
            return PersistentStorage;
            function now() {
                return new Date().getTime();
            }
            function encode(val) {
                return JSON.stringify(_.isUndefined(val) ? null : val);
            }
            function decode(val) {
                return JSON.parse(val);
            }
        }();
        var Transport = function () {
            'use strict';
            var pendingRequestsCount = 0, pendingRequests = {}, maxPendingRequests = 6, sharedCache = new LruCache(10);
            function Transport(o) {
                o = o || {};
                this.cancelled = false;
                this.lastUrl = null;
                this._send = o.transport ? callbackToDeferred(o.transport) : $.ajax;
                this._get = o.rateLimiter ? o.rateLimiter(this._get) : this._get;
                this._cache = o.cache === false ? new LruCache(0) : sharedCache;
            }
            Transport.setMaxPendingRequests = function setMaxPendingRequests(num) {
                maxPendingRequests = num;
            };
            Transport.resetCache = function resetCache() {
                sharedCache.reset();
            };
            _.mixin(Transport.prototype, {
                _get: function (url, o, cb) {
                    var that = this, jqXhr;
                    if (this.cancelled || url !== this.lastUrl) {
                        return;
                    }
                    if (jqXhr = pendingRequests[url]) {
                        jqXhr.done(done).fail(fail);
                    } else if (pendingRequestsCount < maxPendingRequests) {
                        pendingRequestsCount++;
                        pendingRequests[url] = this._send(url, o).done(done).fail(fail).always(always);
                    } else {
                        this.onDeckRequestArgs = [].slice.call(arguments, 0);
                    }
                    function done(resp) {
                        cb && cb(null, resp);
                        that._cache.set(url, resp);
                    }
                    function fail() {
                        cb && cb(true);
                    }
                    function always() {
                        pendingRequestsCount--;
                        delete pendingRequests[url];
                        if (that.onDeckRequestArgs) {
                            that._get.apply(that, that.onDeckRequestArgs);
                            that.onDeckRequestArgs = null;
                        }
                    }
                },
                get: function (url, o, cb) {
                    var resp;
                    if (_.isFunction(o)) {
                        cb = o;
                        o = {};
                    }
                    this.cancelled = false;
                    this.lastUrl = url;
                    if (resp = this._cache.get(url)) {
                        _.defer(function () {
                            cb && cb(null, resp);
                        });
                    } else {
                        this._get(url, o, cb);
                    }
                    return !!resp;
                },
                cancel: function () {
                    this.cancelled = true;
                }
            });
            return Transport;
            function callbackToDeferred(fn) {
                return function customSendWrapper(url, o) {
                    var deferred = $.Deferred();
                    fn(url, o, onSuccess, onError);
                    return deferred;
                    function onSuccess(resp) {
                        _.defer(function () {
                            deferred.resolve(resp);
                        });
                    }
                    function onError(err) {
                        _.defer(function () {
                            deferred.reject(err);
                        });
                    }
                };
            }
        }();
        var SearchIndex = function () {
            'use strict';
            function SearchIndex(o) {
                o = o || {};
                if (!o.datumTokenizer || !o.queryTokenizer) {
                    $.error('datumTokenizer and queryTokenizer are both required');
                }
                this.datumTokenizer = o.datumTokenizer;
                this.queryTokenizer = o.queryTokenizer;
                this.reset();
            }
            _.mixin(SearchIndex.prototype, {
                bootstrap: function bootstrap(o) {
                    this.datums = o.datums;
                    this.trie = o.trie;
                },
                add: function (data) {
                    var that = this;
                    data = _.isArray(data) ? data : [data];
                    _.each(data, function (datum) {
                        var id, tokens;
                        id = that.datums.push(datum) - 1;
                        tokens = normalizeTokens(that.datumTokenizer(datum));
                        _.each(tokens, function (token) {
                            var node, chars, ch;
                            node = that.trie;
                            chars = token.split('');
                            while (ch = chars.shift()) {
                                node = node.children[ch] || (node.children[ch] = newNode());
                                node.ids.push(id);
                            }
                        });
                    });
                },
                get: function get(query) {
                    var that = this, tokens, matches;
                    tokens = normalizeTokens(this.queryTokenizer(query));
                    _.each(tokens, function (token) {
                        var node, chars, ch, ids;
                        if (matches && matches.length === 0) {
                            return false;
                        }
                        node = that.trie;
                        chars = token.split('');
                        while (node && (ch = chars.shift())) {
                            node = node.children[ch];
                        }
                        if (node && chars.length === 0) {
                            ids = node.ids.slice(0);
                            matches = matches ? getIntersection(matches, ids) : ids;
                        } else {
                            matches = [];
                            return false;
                        }
                    });
                    return matches ? _.map(unique(matches), function (id) {
                        return that.datums[id];
                    }) : [];
                },
                reset: function reset() {
                    this.datums = [];
                    this.trie = newNode();
                },
                serialize: function serialize() {
                    return {
                        datums: this.datums,
                        trie: this.trie
                    };
                }
            });
            return SearchIndex;
            function normalizeTokens(tokens) {
                tokens = _.filter(tokens, function (token) {
                    return !!token;
                });
                tokens = _.map(tokens, function (token) {
                    return token.toLowerCase();
                });
                return tokens;
            }
            function newNode() {
                return {
                    ids: [],
                    children: {}
                };
            }
            function unique(array) {
                var seen = {}, uniques = [];
                for (var i = 0, len = array.length; i < len; i++) {
                    if (!seen[array[i]]) {
                        seen[array[i]] = true;
                        uniques.push(array[i]);
                    }
                }
                return uniques;
            }
            function getIntersection(arrayA, arrayB) {
                var ai = 0, bi = 0, intersection = [];
                arrayA = arrayA.sort(compare);
                arrayB = arrayB.sort(compare);
                var lenArrayA = arrayA.length, lenArrayB = arrayB.length;
                while (ai < lenArrayA && bi < lenArrayB) {
                    if (arrayA[ai] < arrayB[bi]) {
                        ai++;
                    } else if (arrayA[ai] > arrayB[bi]) {
                        bi++;
                    } else {
                        intersection.push(arrayA[ai]);
                        ai++;
                        bi++;
                    }
                }
                return intersection;
                function compare(a, b) {
                    return a - b;
                }
            }
        }();
        var oParser = function () {
            'use strict';
            return {
                local: getLocal,
                prefetch: getPrefetch,
                remote: getRemote
            };
            function getLocal(o) {
                return o.local || null;
            }
            function getPrefetch(o) {
                var prefetch, defaults;
                defaults = {
                    url: null,
                    thumbprint: '',
                    ttl: 24 * 60 * 60 * 1000,
                    filter: null,
                    ajax: {}
                };
                if (prefetch = o.prefetch || null) {
                    prefetch = _.isString(prefetch) ? { url: prefetch } : prefetch;
                    prefetch = _.mixin(defaults, prefetch);
                    prefetch.thumbprint = VERSION + prefetch.thumbprint;
                    prefetch.ajax.type = prefetch.ajax.type || 'GET';
                    prefetch.ajax.dataType = prefetch.ajax.dataType || 'json';
                    !prefetch.url && $.error('prefetch requires url to be set');
                }
                return prefetch;
            }
            function getRemote(o) {
                var remote, defaults;
                defaults = {
                    url: null,
                    cache: true,
                    wildcard: '%QUERY',
                    replace: null,
                    rateLimitBy: 'debounce',
                    rateLimitWait: 300,
                    send: null,
                    filter: null,
                    ajax: {}
                };
                if (remote = o.remote || null) {
                    remote = _.isString(remote) ? { url: remote } : remote;
                    remote = _.mixin(defaults, remote);
                    remote.rateLimiter = /^throttle$/i.test(remote.rateLimitBy) ? byThrottle(remote.rateLimitWait) : byDebounce(remote.rateLimitWait);
                    remote.ajax.type = remote.ajax.type || 'GET';
                    remote.ajax.dataType = remote.ajax.dataType || 'json';
                    delete remote.rateLimitBy;
                    delete remote.rateLimitWait;
                    !remote.url && $.error('remote requires url to be set');
                }
                return remote;
                function byDebounce(wait) {
                    return function (fn) {
                        return _.debounce(fn, wait);
                    };
                }
                function byThrottle(wait) {
                    return function (fn) {
                        return _.throttle(fn, wait);
                    };
                }
            }
        }();
        (function (root) {
            'use strict';
            var old, keys;
            old = root.Bloodhound;
            keys = {
                data: 'data',
                protocol: 'protocol',
                thumbprint: 'thumbprint'
            };
            root.Bloodhound = Bloodhound;
            function Bloodhound(o) {
                if (!o || !o.local && !o.prefetch && !o.remote) {
                    $.error('one of local, prefetch, or remote is required');
                }
                this.limit = o.limit || 5;
                this.sorter = getSorter(o.sorter);
                this.dupDetector = o.dupDetector || ignoreDuplicates;
                this.local = oParser.local(o);
                this.prefetch = oParser.prefetch(o);
                this.remote = oParser.remote(o);
                this.cacheKey = this.prefetch ? this.prefetch.cacheKey || this.prefetch.url : null;
                this.index = new SearchIndex({
                    datumTokenizer: o.datumTokenizer,
                    queryTokenizer: o.queryTokenizer
                });
                this.storage = this.cacheKey ? new PersistentStorage(this.cacheKey) : null;
            }
            Bloodhound.noConflict = function noConflict() {
                root.Bloodhound = old;
                return Bloodhound;
            };
            Bloodhound.tokenizers = tokenizers;
            _.mixin(Bloodhound.prototype, {
                _loadPrefetch: function loadPrefetch(o) {
                    var that = this, serialized, deferred;
                    if (serialized = this._readFromStorage(o.thumbprint)) {
                        this.index.bootstrap(serialized);
                        deferred = $.Deferred().resolve();
                    } else {
                        deferred = $.ajax(o.url, o.ajax).done(handlePrefetchResponse);
                    }
                    return deferred;
                    function handlePrefetchResponse(resp) {
                        that.clear();
                        that.add(o.filter ? o.filter(resp) : resp);
                        that._saveToStorage(that.index.serialize(), o.thumbprint, o.ttl);
                    }
                },
                _getFromRemote: function getFromRemote(query, cb) {
                    var that = this, url, uriEncodedQuery;
                    if (!this.transport) {
                        return;
                    }
                    query = query || '';
                    uriEncodedQuery = encodeURIComponent(query);
                    url = this.remote.replace ? this.remote.replace(this.remote.url, query) : this.remote.url.replace(this.remote.wildcard, uriEncodedQuery);
                    return this.transport.get(url, this.remote.ajax, handleRemoteResponse);
                    function handleRemoteResponse(err, resp) {
                        err ? cb([]) : cb(that.remote.filter ? that.remote.filter(resp) : resp);
                    }
                },
                _cancelLastRemoteRequest: function cancelLastRemoteRequest() {
                    this.transport && this.transport.cancel();
                },
                _saveToStorage: function saveToStorage(data, thumbprint, ttl) {
                    if (this.storage) {
                        this.storage.set(keys.data, data, ttl);
                        this.storage.set(keys.protocol, location.protocol, ttl);
                        this.storage.set(keys.thumbprint, thumbprint, ttl);
                    }
                },
                _readFromStorage: function readFromStorage(thumbprint) {
                    var stored = {}, isExpired;
                    if (this.storage) {
                        stored.data = this.storage.get(keys.data);
                        stored.protocol = this.storage.get(keys.protocol);
                        stored.thumbprint = this.storage.get(keys.thumbprint);
                    }
                    isExpired = stored.thumbprint !== thumbprint || stored.protocol !== location.protocol;
                    return stored.data && !isExpired ? stored.data : null;
                },
                _initialize: function initialize() {
                    var that = this, local = this.local, deferred;
                    deferred = this.prefetch ? this._loadPrefetch(this.prefetch) : $.Deferred().resolve();
                    local && deferred.done(addLocalToIndex);
                    this.transport = this.remote ? new Transport(this.remote) : null;
                    return this.initPromise = deferred.promise();
                    function addLocalToIndex() {
                        that.add(_.isFunction(local) ? local() : local);
                    }
                },
                initialize: function initialize(force) {
                    return !this.initPromise || force ? this._initialize() : this.initPromise;
                },
                add: function add(data) {
                    this.index.add(data);
                },
                get: function get(query, cb) {
                    var that = this, matches = [], cacheHit = false;
                    matches = this.index.get(query);
                    matches = this.sorter(matches).slice(0, this.limit);
                    matches.length < this.limit ? cacheHit = this._getFromRemote(query, returnRemoteMatches) : this._cancelLastRemoteRequest();
                    if (!cacheHit) {
                        (matches.length > 0 || !this.transport) && cb && cb(matches);
                    }
                    function returnRemoteMatches(remoteMatches) {
                        var matchesWithBackfill = matches.slice(0);
                        _.each(remoteMatches, function (remoteMatch) {
                            var isDuplicate;
                            isDuplicate = _.some(matchesWithBackfill, function (match) {
                                return that.dupDetector(remoteMatch, match);
                            });
                            !isDuplicate && matchesWithBackfill.push(remoteMatch);
                            return matchesWithBackfill.length < that.limit;
                        });
                        cb && cb(that.sorter(matchesWithBackfill));
                    }
                },
                clear: function clear() {
                    this.index.reset();
                },
                clearPrefetchCache: function clearPrefetchCache() {
                    this.storage && this.storage.clear();
                },
                clearRemoteCache: function clearRemoteCache() {
                    this.transport && Transport.resetCache();
                },
                ttAdapter: function ttAdapter() {
                    return _.bind(this.get, this);
                }
            });
            return Bloodhound;
            function getSorter(sortFn) {
                return _.isFunction(sortFn) ? sort : noSort;
                function sort(array) {
                    return array.sort(sortFn);
                }
                function noSort(array) {
                    return array;
                }
            }
            function ignoreDuplicates() {
                return false;
            }
        }(this));
        var html = function () {
            return {
                wrapper: '<span class="twitter-typeahead"></span>',
                dropdown: '<span class="tt-dropdown-menu"></span>',
                dataset: '<div class="tt-dataset-%CLASS%"></div>',
                suggestions: '<span class="tt-suggestions"></span>',
                suggestion: '<div class="tt-suggestion"></div>'
            };
        }();
        var css = function () {
            'use strict';
            var css = {
                wrapper: {
                    position: 'relative',
                    display: 'inline-block'
                },
                hint: {
                    position: 'absolute',
                    top: '0',
                    left: '0',
                    borderColor: 'transparent',
                    boxShadow: 'none',
                    opacity: '1'
                },
                input: {
                    position: 'relative',
                    verticalAlign: 'top',
                    backgroundColor: 'transparent'
                },
                inputWithNoHint: {
                    position: 'relative',
                    verticalAlign: 'top'
                },
                dropdown: {
                    position: 'absolute',
                    top: '100%',
                    left: '0',
                    zIndex: '2000',
                    display: 'none'
                },
                suggestions: { display: 'block' },
                suggestion: {
                    whiteSpace: 'nowrap',
                    cursor: 'pointer'
                },
                suggestionChild: { whiteSpace: 'normal' },
                ltr: {
                    left: '0',
                    right: 'auto'
                },
                rtl: {
                    left: 'auto',
                    right: ' 0'
                }
            };
            if (_.isMsie()) {
                _.mixin(css.input, { backgroundImage: 'url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)' });
            }
            if (_.isMsie() && _.isMsie() <= 7) {
                _.mixin(css.input, { marginTop: '-1px' });
            }
            return css;
        }();
        var EventBus = function () {
            'use strict';
            var namespace = 'typeahead:';
            function EventBus(o) {
                if (!o || !o.el) {
                    $.error('EventBus initialized without el');
                }
                this.$el = $(o.el);
            }
            _.mixin(EventBus.prototype, {
                trigger: function (type) {
                    var args = [].slice.call(arguments, 1);
                    this.$el.trigger(namespace + type, args);
                }
            });
            return EventBus;
        }();
        var EventEmitter = function () {
            'use strict';
            var splitter = /\s+/, nextTick = getNextTick();
            return {
                onSync: onSync,
                onAsync: onAsync,
                off: off,
                trigger: trigger
            };
            function on(method, types, cb, context) {
                var type;
                if (!cb) {
                    return this;
                }
                types = types.split(splitter);
                cb = context ? bindContext(cb, context) : cb;
                this._callbacks = this._callbacks || {};
                while (type = types.shift()) {
                    this._callbacks[type] = this._callbacks[type] || {
                        sync: [],
                        async: []
                    };
                    this._callbacks[type][method].push(cb);
                }
                return this;
            }
            function onAsync(types, cb, context) {
                return on.call(this, 'async', types, cb, context);
            }
            function onSync(types, cb, context) {
                return on.call(this, 'sync', types, cb, context);
            }
            function off(types) {
                var type;
                if (!this._callbacks) {
                    return this;
                }
                types = types.split(splitter);
                while (type = types.shift()) {
                    delete this._callbacks[type];
                }
                return this;
            }
            function trigger(types) {
                var type, callbacks, args, syncFlush, asyncFlush;
                if (!this._callbacks) {
                    return this;
                }
                types = types.split(splitter);
                args = [].slice.call(arguments, 1);
                while ((type = types.shift()) && (callbacks = this._callbacks[type])) {
                    syncFlush = getFlush(callbacks.sync, this, [type].concat(args));
                    asyncFlush = getFlush(callbacks.async, this, [type].concat(args));
                    syncFlush() && nextTick(asyncFlush);
                }
                return this;
            }
            function getFlush(callbacks, context, args) {
                return flush;
                function flush() {
                    var cancelled;
                    for (var i = 0, len = callbacks.length; !cancelled && i < len; i += 1) {
                        cancelled = callbacks[i].apply(context, args) === false;
                    }
                    return !cancelled;
                }
            }
            function getNextTick() {
                var nextTickFn;
                if (window.setImmediate) {
                    nextTickFn = function nextTickSetImmediate(fn) {
                        setImmediate(function () {
                            fn();
                        });
                    };
                } else {
                    nextTickFn = function nextTickSetTimeout(fn) {
                        setTimeout(function () {
                            fn();
                        }, 0);
                    };
                }
                return nextTickFn;
            }
            function bindContext(fn, context) {
                return fn.bind ? fn.bind(context) : function () {
                    fn.apply(context, [].slice.call(arguments, 0));
                };
            }
        }();
        var highlight = function (doc) {
            'use strict';
            var defaults = {
                node: null,
                pattern: null,
                tagName: 'strong',
                className: null,
                wordsOnly: false,
                caseSensitive: false
            };
            return function hightlight(o) {
                var regex;
                o = _.mixin({}, defaults, o);
                if (!o.node || !o.pattern) {
                    return;
                }
                o.pattern = _.isArray(o.pattern) ? o.pattern : [o.pattern];
                regex = getRegex(o.pattern, o.caseSensitive, o.wordsOnly);
                traverse(o.node, hightlightTextNode);
                function hightlightTextNode(textNode) {
                    var match, patternNode, wrapperNode;
                    if (match = regex.exec(textNode.data)) {
                        wrapperNode = doc.createElement(o.tagName);
                        o.className && (wrapperNode.className = o.className);
                        patternNode = textNode.splitText(match.index);
                        patternNode.splitText(match[0].length);
                        wrapperNode.appendChild(patternNode.cloneNode(true));
                        textNode.parentNode.replaceChild(wrapperNode, patternNode);
                    }
                    return !!match;
                }
                function traverse(el, hightlightTextNode) {
                    var childNode, TEXT_NODE_TYPE = 3;
                    for (var i = 0; i < el.childNodes.length; i++) {
                        childNode = el.childNodes[i];
                        if (childNode.nodeType === TEXT_NODE_TYPE) {
                            i += hightlightTextNode(childNode) ? 1 : 0;
                        } else {
                            traverse(childNode, hightlightTextNode);
                        }
                    }
                }
            };
            function getRegex(patterns, caseSensitive, wordsOnly) {
                var escapedPatterns = [], regexStr;
                for (var i = 0, len = patterns.length; i < len; i++) {
                    escapedPatterns.push(_.escapeRegExChars(patterns[i]));
                }
                regexStr = wordsOnly ? '\\b(' + escapedPatterns.join('|') + ')\\b' : '(' + escapedPatterns.join('|') + ')';
                return caseSensitive ? new RegExp(regexStr) : new RegExp(regexStr, 'i');
            }
        }(window.document);
        var Input = function () {
            'use strict';
            var specialKeyCodeMap;
            specialKeyCodeMap = {
                9: 'tab',
                27: 'esc',
                37: 'left',
                39: 'right',
                13: 'enter',
                38: 'up',
                40: 'down'
            };
            function Input(o) {
                var that = this, onBlur, onFocus, onKeydown, onInput;
                o = o || {};
                if (!o.input) {
                    $.error('input is missing');
                }
                onBlur = _.bind(this._onBlur, this);
                onFocus = _.bind(this._onFocus, this);
                onKeydown = _.bind(this._onKeydown, this);
                onInput = _.bind(this._onInput, this);
                this.$hint = $(o.hint);
                this.$input = $(o.input).on('blur.tt', onBlur).on('focus.tt', onFocus).on('keydown.tt', onKeydown);
                if (this.$hint.length === 0) {
                    this.setHint = this.getHint = this.clearHint = this.clearHintIfInvalid = _.noop;
                }
                if (!_.isMsie()) {
                    this.$input.on('input.tt', onInput);
                } else {
                    this.$input.on('keydown.tt keypress.tt cut.tt paste.tt', function ($e) {
                        if (specialKeyCodeMap[$e.which || $e.keyCode]) {
                            return;
                        }
                        _.defer(_.bind(that._onInput, that, $e));
                    });
                }
                this.query = this.$input.val();
                this.$overflowHelper = buildOverflowHelper(this.$input);
            }
            Input.normalizeQuery = function (str) {
                return (str || '').replace(/^\s*/g, '').replace(/\s{2,}/g, ' ');
            };
            _.mixin(Input.prototype, EventEmitter, {
                _onBlur: function onBlur() {
                    this.resetInputValue();
                    this.trigger('blurred');
                },
                _onFocus: function onFocus() {
                    this.trigger('focused');
                },
                _onKeydown: function onKeydown($e) {
                    var keyName = specialKeyCodeMap[$e.which || $e.keyCode];
                    this._managePreventDefault(keyName, $e);
                    if (keyName && this._shouldTrigger(keyName, $e)) {
                        this.trigger(keyName + 'Keyed', $e);
                    }
                },
                _onInput: function onInput() {
                    this._checkInputValue();
                },
                _managePreventDefault: function managePreventDefault(keyName, $e) {
                    var preventDefault, hintValue, inputValue;
                    switch (keyName) {
                    case 'tab':
                        hintValue = this.getHint();
                        inputValue = this.getInputValue();
                        preventDefault = hintValue && hintValue !== inputValue && !withModifier($e);
                        break;
                    case 'up':
                    case 'down':
                        preventDefault = !withModifier($e);
                        break;
                    default:
                        preventDefault = false;
                    }
                    preventDefault && $e.preventDefault();
                },
                _shouldTrigger: function shouldTrigger(keyName, $e) {
                    var trigger;
                    switch (keyName) {
                    case 'tab':
                        trigger = !withModifier($e);
                        break;
                    default:
                        trigger = true;
                    }
                    return trigger;
                },
                _checkInputValue: function checkInputValue() {
                    var inputValue, areEquivalent, hasDifferentWhitespace;
                    inputValue = this.getInputValue();
                    areEquivalent = areQueriesEquivalent(inputValue, this.query);
                    hasDifferentWhitespace = areEquivalent ? this.query.length !== inputValue.length : false;
                    this.query = inputValue;
                    if (!areEquivalent) {
                        this.trigger('queryChanged', this.query);
                    } else if (hasDifferentWhitespace) {
                        this.trigger('whitespaceChanged', this.query);
                    }
                },
                focus: function focus() {
                    this.$input.focus();
                },
                blur: function blur() {
                    this.$input.blur();
                },
                getQuery: function getQuery() {
                    return this.query;
                },
                setQuery: function setQuery(query) {
                    this.query = query;
                },
                getInputValue: function getInputValue() {
                    return this.$input.val();
                },
                setInputValue: function setInputValue(value, silent) {
                    this.$input.val(value);
                    silent ? this.clearHint() : this._checkInputValue();
                },
                resetInputValue: function resetInputValue() {
                    this.setInputValue(this.query, true);
                },
                getHint: function getHint() {
                    return this.$hint.val();
                },
                setHint: function setHint(value) {
                    this.$hint.val(value);
                },
                clearHint: function clearHint() {
                    this.setHint('');
                },
                clearHintIfInvalid: function clearHintIfInvalid() {
                    var val, hint, valIsPrefixOfHint, isValid;
                    val = this.getInputValue();
                    hint = this.getHint();
                    valIsPrefixOfHint = val !== hint && hint.indexOf(val) === 0;
                    isValid = val !== '' && valIsPrefixOfHint && !this.hasOverflow();
                    !isValid && this.clearHint();
                },
                getLanguageDirection: function getLanguageDirection() {
                    return (this.$input.css('direction') || 'ltr').toLowerCase();
                },
                hasOverflow: function hasOverflow() {
                    var constraint = this.$input.width() - 2;
                    this.$overflowHelper.text(this.getInputValue());
                    return this.$overflowHelper.width() >= constraint;
                },
                isCursorAtEnd: function () {
                    var valueLength, selectionStart, range;
                    valueLength = this.$input.val().length;
                    selectionStart = this.$input[0].selectionStart;
                    if (_.isNumber(selectionStart)) {
                        return selectionStart === valueLength;
                    } else if (document.selection) {
                        range = document.selection.createRange();
                        range.moveStart('character', -valueLength);
                        return valueLength === range.text.length;
                    }
                    return true;
                },
                destroy: function destroy() {
                    this.$hint.off('.tt');
                    this.$input.off('.tt');
                    this.$hint = this.$input = this.$overflowHelper = null;
                }
            });
            return Input;
            function buildOverflowHelper($input) {
                return $('<pre aria-hidden="true"></pre>').css({
                    position: 'absolute',
                    visibility: 'hidden',
                    whiteSpace: 'pre',
                    fontFamily: $input.css('font-family'),
                    fontSize: $input.css('font-size'),
                    fontStyle: $input.css('font-style'),
                    fontVariant: $input.css('font-variant'),
                    fontWeight: $input.css('font-weight'),
                    wordSpacing: $input.css('word-spacing'),
                    letterSpacing: $input.css('letter-spacing'),
                    textIndent: $input.css('text-indent'),
                    textRendering: $input.css('text-rendering'),
                    textTransform: $input.css('text-transform')
                }).insertAfter($input);
            }
            function areQueriesEquivalent(a, b) {
                return Input.normalizeQuery(a) === Input.normalizeQuery(b);
            }
            function withModifier($e) {
                return $e.altKey || $e.ctrlKey || $e.metaKey || $e.shiftKey;
            }
        }();
        var Dataset = function () {
            'use strict';
            var datasetKey = 'ttDataset', valueKey = 'ttValue', datumKey = 'ttDatum';
            function Dataset(o) {
                o = o || {};
                o.templates = o.templates || {};
                if (!o.source) {
                    $.error('missing source');
                }
                if (o.name && !isValidName(o.name)) {
                    $.error('invalid dataset name: ' + o.name);
                }
                this.query = null;
                this.highlight = !!o.highlight;
                this.name = o.name || _.getUniqueId();
                this.source = o.source;
                this.displayFn = getDisplayFn(o.display || o.displayKey);
                this.templates = getTemplates(o.templates, this.displayFn);
                this.$el = $(html.dataset.replace('%CLASS%', this.name));
            }
            Dataset.extractDatasetName = function extractDatasetName(el) {
                return $(el).data(datasetKey);
            };
            Dataset.extractValue = function extractDatum(el) {
                return $(el).data(valueKey);
            };
            Dataset.extractDatum = function extractDatum(el) {
                return $(el).data(datumKey);
            };
            _.mixin(Dataset.prototype, EventEmitter, {
                _render: function render(query, suggestions) {
                    if (!this.$el) {
                        return;
                    }
                    var that = this, hasSuggestions;
                    this.$el.empty();
                    hasSuggestions = suggestions && suggestions.length;
                    if (!hasSuggestions && this.templates.empty) {
                        this.$el.html(getEmptyHtml()).prepend(that.templates.header ? getHeaderHtml() : null).append(that.templates.footer ? getFooterHtml() : null);
                    } else if (hasSuggestions) {
                        this.$el.html(getSuggestionsHtml()).prepend(that.templates.header ? getHeaderHtml() : null).append(that.templates.footer ? getFooterHtml() : null);
                    }
                    this.trigger('rendered');
                    function getEmptyHtml() {
                        return that.templates.empty({
                            query: query,
                            isEmpty: true
                        });
                    }
                    function getSuggestionsHtml() {
                        var $suggestions, nodes;
                        $suggestions = $(html.suggestions).css(css.suggestions);
                        nodes = _.map(suggestions, getSuggestionNode);
                        $suggestions.append.apply($suggestions, nodes);
                        that.highlight && highlight({
                            className: 'tt-highlight',
                            node: $suggestions[0],
                            pattern: query
                        });
                        return $suggestions;
                        function getSuggestionNode(suggestion) {
                            var $el;
                            $el = $(html.suggestion).append(that.templates.suggestion(suggestion)).data(datasetKey, that.name).data(valueKey, that.displayFn(suggestion)).data(datumKey, suggestion);
                            $el.children().each(function () {
                                $(this).css(css.suggestionChild);
                            });
                            return $el;
                        }
                    }
                    function getHeaderHtml() {
                        return that.templates.header({
                            query: query,
                            isEmpty: !hasSuggestions
                        });
                    }
                    function getFooterHtml() {
                        return that.templates.footer({
                            query: query,
                            isEmpty: !hasSuggestions
                        });
                    }
                },
                getRoot: function getRoot() {
                    return this.$el;
                },
                update: function update(query) {
                    var that = this;
                    this.query = query;
                    this.canceled = false;
                    this.source(query, render);
                    function render(suggestions) {
                        if (!that.canceled && query === that.query) {
                            that._render(query, suggestions);
                        }
                    }
                },
                cancel: function cancel() {
                    this.canceled = true;
                },
                clear: function clear() {
                    this.cancel();
                    this.$el.empty();
                    this.trigger('rendered');
                },
                isEmpty: function isEmpty() {
                    return this.$el.is(':empty');
                },
                destroy: function destroy() {
                    this.$el = null;
                }
            });
            return Dataset;
            function getDisplayFn(display) {
                display = display || 'value';
                return _.isFunction(display) ? display : displayFn;
                function displayFn(obj) {
                    return obj[display];
                }
            }
            function getTemplates(templates, displayFn) {
                return {
                    empty: templates.empty && _.templatify(templates.empty),
                    header: templates.header && _.templatify(templates.header),
                    footer: templates.footer && _.templatify(templates.footer),
                    suggestion: templates.suggestion || suggestionTemplate
                };
                function suggestionTemplate(context) {
                    return '<p>' + displayFn(context) + '</p>';
                }
            }
            function isValidName(str) {
                return /^[_a-zA-Z0-9-]+$/.test(str);
            }
        }();
        var Dropdown = function () {
            'use strict';
            function Dropdown(o) {
                var that = this, onSuggestionClick, onSuggestionMouseEnter, onSuggestionMouseLeave;
                o = o || {};
                if (!o.menu) {
                    $.error('menu is required');
                }
                this.isOpen = false;
                this.isEmpty = true;
                this.datasets = _.map(o.datasets, initializeDataset);
                onSuggestionClick = _.bind(this._onSuggestionClick, this);
                onSuggestionMouseEnter = _.bind(this._onSuggestionMouseEnter, this);
                onSuggestionMouseLeave = _.bind(this._onSuggestionMouseLeave, this);
                this.$menu = $(o.menu).on('click.tt', '.tt-suggestion', onSuggestionClick).on('mouseenter.tt', '.tt-suggestion', onSuggestionMouseEnter).on('mouseleave.tt', '.tt-suggestion', onSuggestionMouseLeave);
                _.each(this.datasets, function (dataset) {
                    that.$menu.append(dataset.getRoot());
                    dataset.onSync('rendered', that._onRendered, that);
                });
            }
            _.mixin(Dropdown.prototype, EventEmitter, {
                _onSuggestionClick: function onSuggestionClick($e) {
                    this.trigger('suggestionClicked', $($e.currentTarget));
                },
                _onSuggestionMouseEnter: function onSuggestionMouseEnter($e) {
                    this._removeCursor();
                    this._setCursor($($e.currentTarget), true);
                },
                _onSuggestionMouseLeave: function onSuggestionMouseLeave() {
                    this._removeCursor();
                },
                _onRendered: function onRendered() {
                    this.isEmpty = _.every(this.datasets, isDatasetEmpty);
                    this.isEmpty ? this._hide() : this.isOpen && this._show();
                    this.trigger('datasetRendered');
                    function isDatasetEmpty(dataset) {
                        return dataset.isEmpty();
                    }
                },
                _hide: function () {
                    this.$menu.hide();
                },
                _show: function () {
                    this.$menu.css('display', 'block');
                },
                _getSuggestions: function getSuggestions() {
                    return this.$menu.find('.tt-suggestion');
                },
                _getCursor: function getCursor() {
                    return this.$menu.find('.tt-cursor').first();
                },
                _setCursor: function setCursor($el, silent) {
                    $el.first().addClass('tt-cursor');
                    !silent && this.trigger('cursorMoved');
                },
                _removeCursor: function removeCursor() {
                    this._getCursor().removeClass('tt-cursor');
                },
                _moveCursor: function moveCursor(increment) {
                    var $suggestions, $oldCursor, newCursorIndex, $newCursor;
                    if (!this.isOpen) {
                        return;
                    }
                    $oldCursor = this._getCursor();
                    $suggestions = this._getSuggestions();
                    this._removeCursor();
                    newCursorIndex = $suggestions.index($oldCursor) + increment;
                    newCursorIndex = (newCursorIndex + 1) % ($suggestions.length + 1) - 1;
                    if (newCursorIndex === -1) {
                        this.trigger('cursorRemoved');
                        return;
                    } else if (newCursorIndex < -1) {
                        newCursorIndex = $suggestions.length - 1;
                    }
                    this._setCursor($newCursor = $suggestions.eq(newCursorIndex));
                    this._ensureVisible($newCursor);
                },
                _ensureVisible: function ensureVisible($el) {
                    var elTop, elBottom, menuScrollTop, menuHeight;
                    elTop = $el.position().top;
                    elBottom = elTop + $el.outerHeight(true);
                    menuScrollTop = this.$menu.scrollTop();
                    menuHeight = this.$menu.height() + parseInt(this.$menu.css('paddingTop'), 10) + parseInt(this.$menu.css('paddingBottom'), 10);
                    if (elTop < 0) {
                        this.$menu.scrollTop(menuScrollTop + elTop);
                    } else if (menuHeight < elBottom) {
                        this.$menu.scrollTop(menuScrollTop + (elBottom - menuHeight));
                    }
                },
                close: function close() {
                    if (this.isOpen) {
                        this.isOpen = false;
                        this._removeCursor();
                        this._hide();
                        this.trigger('closed');
                    }
                },
                open: function open() {
                    if (!this.isOpen) {
                        this.isOpen = true;
                        !this.isEmpty && this._show();
                        this.trigger('opened');
                    }
                },
                setLanguageDirection: function setLanguageDirection(dir) {
                    this.$menu.css(dir === 'ltr' ? css.ltr : css.rtl);
                },
                moveCursorUp: function moveCursorUp() {
                    this._moveCursor(-1);
                },
                moveCursorDown: function moveCursorDown() {
                    this._moveCursor(+1);
                },
                getDatumForSuggestion: function getDatumForSuggestion($el) {
                    var datum = null;
                    if ($el.length) {
                        datum = {
                            raw: Dataset.extractDatum($el),
                            value: Dataset.extractValue($el),
                            datasetName: Dataset.extractDatasetName($el)
                        };
                    }
                    return datum;
                },
                getDatumForCursor: function getDatumForCursor() {
                    return this.getDatumForSuggestion(this._getCursor().first());
                },
                getDatumForTopSuggestion: function getDatumForTopSuggestion() {
                    return this.getDatumForSuggestion(this._getSuggestions().first());
                },
                update: function update(query) {
                    _.each(this.datasets, updateDataset);
                    function updateDataset(dataset) {
                        dataset.update(query);
                    }
                },
                empty: function empty() {
                    _.each(this.datasets, clearDataset);
                    this.isEmpty = true;
                    function clearDataset(dataset) {
                        dataset.clear();
                    }
                },
                isVisible: function isVisible() {
                    return this.isOpen && !this.isEmpty;
                },
                destroy: function destroy() {
                    this.$menu.off('.tt');
                    this.$menu = null;
                    _.each(this.datasets, destroyDataset);
                    function destroyDataset(dataset) {
                        dataset.destroy();
                    }
                }
            });
            return Dropdown;
            function initializeDataset(oDataset) {
                return new Dataset(oDataset);
            }
        }();
        var Typeahead = function () {
            'use strict';
            var attrsKey = 'ttAttrs';
            function Typeahead(o) {
                var $menu, $input, $hint;
                o = o || {};
                if (!o.input) {
                    $.error('missing input');
                }
                this.isActivated = false;
                this.autoselect = !!o.autoselect;
                this.minLength = _.isNumber(o.minLength) ? o.minLength : 1;
                this.$node = buildDom(o.input, o.withHint);
                $menu = this.$node.find('.tt-dropdown-menu');
                $input = this.$node.find('.tt-input');
                $hint = this.$node.find('.tt-hint');
                $input.on('blur.tt', function ($e) {
                    var active, isActive, hasActive;
                    active = document.activeElement;
                    isActive = $menu.is(active);
                    hasActive = $menu.has(active).length > 0;
                    if (_.isMsie() && (isActive || hasActive)) {
                        $e.preventDefault();
                        $e.stopImmediatePropagation();
                        _.defer(function () {
                            $input.focus();
                        });
                    }
                });
                $menu.on('mousedown.tt', function ($e) {
                    $e.preventDefault();
                });
                this.eventBus = o.eventBus || new EventBus({ el: $input });
                this.dropdown = new Dropdown({
                    menu: $menu,
                    datasets: o.datasets
                }).onSync('suggestionClicked', this._onSuggestionClicked, this).onSync('cursorMoved', this._onCursorMoved, this).onSync('cursorRemoved', this._onCursorRemoved, this).onSync('opened', this._onOpened, this).onSync('closed', this._onClosed, this).onAsync('datasetRendered', this._onDatasetRendered, this);
                this.input = new Input({
                    input: $input,
                    hint: $hint
                }).onSync('focused', this._onFocused, this).onSync('blurred', this._onBlurred, this).onSync('enterKeyed', this._onEnterKeyed, this).onSync('tabKeyed', this._onTabKeyed, this).onSync('escKeyed', this._onEscKeyed, this).onSync('upKeyed', this._onUpKeyed, this).onSync('downKeyed', this._onDownKeyed, this).onSync('leftKeyed', this._onLeftKeyed, this).onSync('rightKeyed', this._onRightKeyed, this).onSync('queryChanged', this._onQueryChanged, this).onSync('whitespaceChanged', this._onWhitespaceChanged, this);
                this._setLanguageDirection();
            }
            _.mixin(Typeahead.prototype, {
                _onSuggestionClicked: function onSuggestionClicked(type, $el) {
                    var datum;
                    if (datum = this.dropdown.getDatumForSuggestion($el)) {
                        this._select(datum);
                    }
                },
                _onCursorMoved: function onCursorMoved() {
                    var datum = this.dropdown.getDatumForCursor();
                    this.input.setInputValue(datum.value, true);
                    this.eventBus.trigger('cursorchanged', datum.raw, datum.datasetName);
                },
                _onCursorRemoved: function onCursorRemoved() {
                    this.input.resetInputValue();
                    this._updateHint();
                },
                _onDatasetRendered: function onDatasetRendered() {
                    this._updateHint();
                },
                _onOpened: function onOpened() {
                    this._updateHint();
                    this.eventBus.trigger('opened');
                },
                _onClosed: function onClosed() {
                    this.input.clearHint();
                    this.eventBus.trigger('closed');
                },
                _onFocused: function onFocused() {
                    this.isActivated = true;
                    this.dropdown.open();
                },
                _onBlurred: function onBlurred() {
                    this.isActivated = false;
                    this.dropdown.empty();
                    this.dropdown.close();
                },
                _onEnterKeyed: function onEnterKeyed(type, $e) {
                    var cursorDatum, topSuggestionDatum;
                    cursorDatum = this.dropdown.getDatumForCursor();
                    topSuggestionDatum = this.dropdown.getDatumForTopSuggestion();
                    if (cursorDatum) {
                        this._select(cursorDatum);
                        $e.preventDefault();
                    } else if (this.autoselect && topSuggestionDatum) {
                        this._select(topSuggestionDatum);
                        $e.preventDefault();
                    }
                },
                _onTabKeyed: function onTabKeyed(type, $e) {
                    var datum;
                    if (datum = this.dropdown.getDatumForCursor()) {
                        this._select(datum);
                        $e.preventDefault();
                    } else {
                        this._autocomplete(true);
                    }
                },
                _onEscKeyed: function onEscKeyed() {
                    this.dropdown.close();
                    this.input.resetInputValue();
                },
                _onUpKeyed: function onUpKeyed() {
                    var query = this.input.getQuery();
                    this.dropdown.isEmpty && query.length >= this.minLength ? this.dropdown.update(query) : this.dropdown.moveCursorUp();
                    this.dropdown.open();
                },
                _onDownKeyed: function onDownKeyed() {
                    var query = this.input.getQuery();
                    this.dropdown.isEmpty && query.length >= this.minLength ? this.dropdown.update(query) : this.dropdown.moveCursorDown();
                    this.dropdown.open();
                },
                _onLeftKeyed: function onLeftKeyed() {
                    this.dir === 'rtl' && this._autocomplete();
                },
                _onRightKeyed: function onRightKeyed() {
                    this.dir === 'ltr' && this._autocomplete();
                },
                _onQueryChanged: function onQueryChanged(e, query) {
                    this.input.clearHintIfInvalid();
                    query.length >= this.minLength ? this.dropdown.update(query) : this.dropdown.empty();
                    this.dropdown.open();
                    this._setLanguageDirection();
                },
                _onWhitespaceChanged: function onWhitespaceChanged() {
                    this._updateHint();
                    this.dropdown.open();
                },
                _setLanguageDirection: function setLanguageDirection() {
                    var dir;
                    if (this.dir !== (dir = this.input.getLanguageDirection())) {
                        this.dir = dir;
                        this.$node.css('direction', dir);
                        this.dropdown.setLanguageDirection(dir);
                    }
                },
                _updateHint: function updateHint() {
                    var datum, val, query, escapedQuery, frontMatchRegEx, match;
                    datum = this.dropdown.getDatumForTopSuggestion();
                    if (datum && this.dropdown.isVisible() && !this.input.hasOverflow()) {
                        val = this.input.getInputValue();
                        query = Input.normalizeQuery(val);
                        escapedQuery = _.escapeRegExChars(query);
                        frontMatchRegEx = new RegExp('^(?:' + escapedQuery + ')(.+$)', 'i');
                        match = frontMatchRegEx.exec(datum.value);
                        match ? this.input.setHint(val + match[1]) : this.input.clearHint();
                    } else {
                        this.input.clearHint();
                    }
                },
                _autocomplete: function autocomplete(laxCursor) {
                    var hint, query, isCursorAtEnd, datum;
                    hint = this.input.getHint();
                    query = this.input.getQuery();
                    isCursorAtEnd = laxCursor || this.input.isCursorAtEnd();
                    if (hint && query !== hint && isCursorAtEnd) {
                        datum = this.dropdown.getDatumForTopSuggestion();
                        datum && this.input.setInputValue(datum.value);
                        this.eventBus.trigger('autocompleted', datum.raw, datum.datasetName);
                    }
                },
                _select: function select(datum) {
                    this.input.setQuery(datum.value);
                    this.input.setInputValue(datum.value, true);
                    this._setLanguageDirection();
                    this.eventBus.trigger('selected', datum.raw, datum.datasetName);
                    this.dropdown.close();
                    _.defer(_.bind(this.dropdown.empty, this.dropdown));
                },
                open: function open() {
                    this.dropdown.open();
                },
                close: function close() {
                    this.dropdown.close();
                },
                setVal: function setVal(val) {
                    val = _.toStr(val);
                    if (this.isActivated) {
                        this.input.setInputValue(val);
                    } else {
                        this.input.setQuery(val);
                        this.input.setInputValue(val, true);
                    }
                    this._setLanguageDirection();
                },
                getVal: function getVal() {
                    return this.input.getQuery();
                },
                destroy: function destroy() {
                    this.input.destroy();
                    this.dropdown.destroy();
                    destroyDomStructure(this.$node);
                    this.$node = null;
                }
            });
            return Typeahead;
            function buildDom(input, withHint) {
                var $input, $wrapper, $dropdown, $hint;
                $input = $(input);
                $wrapper = $(html.wrapper).css(css.wrapper);
                $dropdown = $(html.dropdown).css(css.dropdown);
                $hint = $input.clone().css(css.hint).css(getBackgroundStyles($input));
                $hint.val('').removeData().addClass('tt-hint').removeAttr('id name placeholder required').prop('readonly', true).attr({
                    autocomplete: 'off',
                    spellcheck: 'false',
                    tabindex: -1
                });
                $input.data(attrsKey, {
                    dir: $input.attr('dir'),
                    autocomplete: $input.attr('autocomplete'),
                    spellcheck: $input.attr('spellcheck'),
                    style: $input.attr('style')
                });
                $input.addClass('tt-input').attr({
                    autocomplete: 'off',
                    spellcheck: false
                }).css(withHint ? css.input : css.inputWithNoHint);
                try {
                    !$input.attr('dir') && $input.attr('dir', 'auto');
                } catch (e) {
                }
                return $input.wrap($wrapper).parent().prepend(withHint ? $hint : null).append($dropdown);
            }
            function getBackgroundStyles($el) {
                return {
                    backgroundAttachment: $el.css('background-attachment'),
                    backgroundClip: $el.css('background-clip'),
                    backgroundColor: $el.css('background-color'),
                    backgroundImage: $el.css('background-image'),
                    backgroundOrigin: $el.css('background-origin'),
                    backgroundPosition: $el.css('background-position'),
                    backgroundRepeat: $el.css('background-repeat'),
                    backgroundSize: $el.css('background-size')
                };
            }
            function destroyDomStructure($node) {
                var $input = $node.find('.tt-input');
                _.each($input.data(attrsKey), function (val, key) {
                    _.isUndefined(val) ? $input.removeAttr(key) : $input.attr(key, val);
                });
                $input.detach().removeData(attrsKey).removeClass('tt-input').insertAfter($node);
                $node.remove();
            }
        }();
        (function () {
            'use strict';
            var old, typeaheadKey, methods;
            old = $.fn.typeahead;
            typeaheadKey = 'ttTypeahead';
            methods = {
                initialize: function initialize(o, datasets) {
                    datasets = _.isArray(datasets) ? datasets : [].slice.call(arguments, 1);
                    o = o || {};
                    return this.each(attach);
                    function attach() {
                        var $input = $(this), eventBus, typeahead;
                        _.each(datasets, function (d) {
                            d.highlight = !!o.highlight;
                        });
                        typeahead = new Typeahead({
                            input: $input,
                            eventBus: eventBus = new EventBus({ el: $input }),
                            withHint: _.isUndefined(o.hint) ? true : !!o.hint,
                            minLength: o.minLength,
                            autoselect: o.autoselect,
                            datasets: datasets
                        });
                        $input.data(typeaheadKey, typeahead);
                    }
                },
                open: function open() {
                    return this.each(openTypeahead);
                    function openTypeahead() {
                        var $input = $(this), typeahead;
                        if (typeahead = $input.data(typeaheadKey)) {
                            typeahead.open();
                        }
                    }
                },
                close: function close() {
                    return this.each(closeTypeahead);
                    function closeTypeahead() {
                        var $input = $(this), typeahead;
                        if (typeahead = $input.data(typeaheadKey)) {
                            typeahead.close();
                        }
                    }
                },
                val: function val(newVal) {
                    return !arguments.length ? getVal(this.first()) : this.each(setVal);
                    function setVal() {
                        var $input = $(this), typeahead;
                        if (typeahead = $input.data(typeaheadKey)) {
                            typeahead.setVal(newVal);
                        }
                    }
                    function getVal($input) {
                        var typeahead, query;
                        if (typeahead = $input.data(typeaheadKey)) {
                            query = typeahead.getVal();
                        }
                        return query;
                    }
                },
                destroy: function destroy() {
                    return this.each(unattach);
                    function unattach() {
                        var $input = $(this), typeahead;
                        if (typeahead = $input.data(typeaheadKey)) {
                            typeahead.destroy();
                            $input.removeData(typeaheadKey);
                        }
                    }
                }
            };
            $.fn.typeahead = function (method) {
                var tts;
                if (methods[method] && method !== 'initialize') {
                    tts = this.filter(function () {
                        return !!$(this).data(typeaheadKey);
                    });
                    return methods[method].apply(tts, [].slice.call(arguments, 1));
                } else {
                    return methods.initialize.apply(this, arguments);
                }
            };
            $.fn.typeahead.noConflict = function noConflict() {
                $.fn.typeahead = old;
                return this;
            };
        }());
    }(window.jQuery));
    return;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ItemsSearcher
define('ItemsSearcher.Collection', [
    'SC.Configuration',
    'Item.Collection',
    'underscore',
    'Utils',
    'typeahead'
], function (Configuration, ItemCollection, _) {
    'use strict';
    // @class ItemsSearcher.Collection Connects to the search api to get the minimal information of the items to show on the typeahead of the search
    // A Model Contains a Collection of items and the list of facet groups with its values
    // @extends Item.Collection
    return ItemCollection.extend({
        // @class ItemsSearcher.View.Options.Collection.Option
        defaultOptions: {
            //@property {String} searcherAPIConfiguration
            searcherAPIConfiguration: 'searchApiMasterOptions.typeAhead'
        }    // @class ItemsSearcher.Collection
             //@method initialize
             //@param {Array<Item.Model>?} collection
             //@param {ItemsSearcher.View.Options.Collection.Option?} options
             //@return {Void}
,
        initialize: function (collection, options) {
            this.options = _.defaults(options || {}, this.defaultOptions);
            this.searchApiMasterOptions = Configuration.get(this.options.searcherAPIConfiguration);
            ItemCollection.prototype.initialize.apply(this, arguments);
        }    //@method fetch We need to make sure that the cache is set to true, so we wrap it
             //@param {Object} options
             //@return {jQuery.Proxy}
,
        fetch: function (options) {
            options = options || {};
            options.cache = true;
            return ItemCollection.prototype.fetch.apply(this, arguments);
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ItemsSearcher
define('ItemsSearcher.Item.View', [
    'GlobalViews.StarRating.View',
    'itemssearcher_item.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'underscore'
], function (GlobalViewsStarRatingView, itemssearcher_item_tpl, Backbone, BackboneCompositeView, _) {
    'use strict';
    // @class ItemsSearcher.Item.View @extends Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: function () {
        }    //@property {ItemsSearcher.View.Options} defaultOptions
             //@class ItemsSearcher.View.Options.Item.View.Option
,
        defaultOptions: {
            //@property {Function} template
            template: itemssearcher_item_tpl
        }    // @class ItemsSearcher.Item.View
             //@method initialize
             //@param {ItemsSearcher.View.Options.Item.View.Option?} options
             //@return {Void}
,
        initialize: function (options) {
            this.options = _.defaults(options || {}, this.defaultOptions);
            this.template = this.options.template;
            BackboneCompositeView.add(this);
        }    //@property {Object} childViews
,
        childViews: {
            'Global.StarRating': function () {
                return new GlobalViewsStarRatingView({
                    model: this.model,
                    showRatingCount: false
                });
            }
        }    // @method getContext
             // @returns {ItemsSearcher.Item.View.Context}
,
        getContext: function () {
            // @class ItemsSearcher.Item.View.Context
            return {
                // @property {Item.Model} model
                model: this.model,
                currentQuery: _(this.options.query).escape()    // @property {Boolea} isItemSelected
,
                isItemSelected: !!this.model,
                hasResults: this.options.areResults,
                isAjaxDone: this.options.isAjaxDone
            };    // @class ItemsSearcher.Item.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ItemsSearcher
define('ItemsSearcher.View', [
    'ItemsSearcher.Utils',
    'ItemsSearcher.Collection',
    'ItemsSearcher.Item.View',
    'PluginContainer',
    'itemssearcher.tpl',
    'Backbone',
    'underscore',
    'jQuery',
    'Utils'
], function (ItemsSearcherUtils, ItemsSearcherCollection, ItemsSearcherItemView, PluginContainer, itemssearcher_tpl, Backbone, _, jQuery) {
    'use strict';
    // @class ItemsSearcher.View @extends Backbone.View
    var ItemsSearcherView = Backbone.View.extend({
        //@property {Function} template
        template: function () {
        }    //@property {ItemsSearcher.View.Options} defaultOptions
             //@class ItemsSearcher.View.Options
,
        defaultOptions: {
            //@property {String} placeholderLabel
            placeholderLabel: _('Search Products...').translate()    //@property {Number} minLength
,
            minLength: 3    //@property {Number} maxLength
,
            maxLength: 10    //@property {Number} limit
,
            limit: 10    //@property {String} sort
,
            sort: 'relevance:desc'    //@property {Array} labels
,
            labels: []    //@property {ItemsSearcher.Collection} collection
,
            collection: ItemsSearcherCollection    //@property {String} query
,
            query: ''    //@property {Boolean} ajaxDone
,
            ajaxDone: false    //@property {Boolean} showMenuOnClick
,
            showMenuOnClick: false    //@property {ItemsSearcher.Item.View} itemView
,
            itemView: ItemsSearcherItemView    //@property {Boolean} highlight
,
            highlight: true    //@property {Function} template
,
            template: itemssearcher_tpl    //@property {Void} componentId
,
            componentId: void 0    //@property {Void} componentName
,
            componentName: void 0    //@property {Boolean} showSeeAll Indicate if the first result should be the "See All" option
,
            showSeeAll: true    //@property {Boolean} highlightFirst
,
            highlightFirst: true    //@property {ItemsSearcher.View.Options.Item.View.Option} itemViewOptions
,
            itemViewOptions: {}    //@property {ItemsSearcher.View.Options.Collection.Option} collectionOptions
,
            collectionOptions: {}    //@property {Function<Item.Model, String, String>} getItemDisplayName This function give the chance to
                  //change the way items display name is returned
,
            getItemDisplayName: null
        }    // @class SiteSearch.View
             //@property {Object} events
,
        events: {
            'keyup [data-type="search-input"]': 'onKeyUp',
            'keydown [data-type="search-input"]': 'onKeyDown'
        }    //@method initialize
             //@param {ItemsSearcher.View.Options?} options
             //@return {Void}
,
        initialize: function (options) {
            this.options = _.defaults(options || {}, this.defaultOptions);
            this.collection = new this.options.collection([], this.options.collectionOptions);
            this.template = this.options.template;
            this.on('afterViewRender', this.configureTypeahead, this);
            this.installPlugins();
        }    //@method installPlugins Internal method used to define the plugins this component expose
             //@return {Void}
,
        installPlugins: function () {
            //@property {PluginContainer} postItemsSuggestionObtained This hook is executed after the fetch of item of retrieved
            //Allows apply any extra transformation over the result from the Search API before those are displayed by the type ahead
            //Each execute method on this hook will receive:
            //the collection {ItemsSearcher.Collection} of items
            //the current string query
            //and it's expected to return another {ItemsSearcher.Collection} collection.
            this.postItemsSuggestionObtained = new PluginContainer();
        }    //@method getTypeAheadConfiguration Generates the type ahead configuration
             //@return {ItemsSearcher.View.TypeAheadConfiguration}
,
        getTypeAheadConfiguration: function () {
            var self = this;
            //@class ItemsSearcher.View.TypeAheadConfiguration
            return {
                //@property {Function<String,Function>} source
                source: _.debounce(_.bind(self.loadSuggestionItemsSource, self), 500)    //@property {Function<String>} displayKey Function used to return the string to be displayed on the main input after an item is selected
,
                displayKey: _.bind(self.getSelectedItemDisplayText, self)    //@property {Object<suggestion:Function>} templates
,
                templates: { suggestion: _.bind(self.getSuggestionItemTemplate, self) }
            };    // @class ItemsSearcher.View
        }    //@method configureTypeahead Configures the type ahead and loads the $searchElement attribute
             //@return {Void}
,
        configureTypeahead: function () {
            var self = this, typeaheadOptions = {
                    highlight: this.options.highlight,
                    minLength: this.options.minLength
                };
            //@property {jQuery} $searchElement
            self.$searchElement = self.$('[data-type="search-input"]');
            // after the layout has be rendered, we initialize the plugin
            if (SC.ENVIRONMENT.jsEnvironment !== 'server') {
                self.$searchElement.typeahead(typeaheadOptions, this.getTypeAheadConfiguration()).on('typeahead:selected', _.bind(self.onItemSelected, self));
                self.$searchElement.on('focus', _.bind(self.selectFirstIfRequire, self));
                //TYPE AHEAD HACKS
                var drop = self.$searchElement.data('ttTypeahead').dropdown;
                drop.$menu.off('click.tt', '.tt-suggestion').on('click.tt', '.tt-suggestion', _.bind(function ($e) {
                    $e.preventDefault();
                    $e.stopPropagation();
                    drop.trigger('suggestionClicked', jQuery($e.currentTarget));
                }, drop));
                //Display menu when selected the input hack
                if (self.options.showMenuOnClick) {
                    self.$searchElement.focus(function () {
                        var ev = jQuery.Event('keydown');
                        ev.keyCode = ev.which = 40;
                        jQuery(this).trigger(ev);
                        return true;
                    });
                }
            }
        }    //@method getCurrentQuery Get the current search. Use when triggering events
             //@return {String}
,
        getCurrentQuery: function getCurrentQuery() {
            return jQuery.trim(this.$searchElement.val());
        }    //@method cleanSearch Clean the current search and close the dropdown
             //@param {Boolean} stop_triggering_event Indicate if NOT trigger the event itemSelect indicating the unselected item
             //@return {Void}
,
        cleanSearch: function cleanSearch(stop_triggering_event) {
            this.$searchElement.data('ttTypeahead') && this.$searchElement.data('ttTypeahead').close();
            this.$searchElement.typeahead('val', '');
            this.options.query = '';
            this.options.selectedItem = null;
            if (!stop_triggering_event) {
                this.trigger('itemSelected', {
                    selectedItem: null,
                    collection: this.collection.models,
                    currentQuery: this.options.query
                });
            }
        }    //@method onItemSelected Handle the selection of an item of the type-ahead result
             //@param {HTMLEvent} e
             //@param {String} item_id
             //@return {Void}
,
        onItemSelected: function onItemSelected(e, item_id) {
            this.options.selectedItem = this.collection.get(item_id);
            // @event itemSelected
            this.trigger('itemSelected'    //@class ItemsSearcher.View.itemSelected.Properties
, {
                //@property {Item.Model?} selectedItem
                selectedItem: this.collection.get(item_id)    //@property {Array<Item.Model>} collection
,
                collection: this.collection.models,
                currentQuery: this.options.query,
                isResultCompleted: this.options.ajaxDone
            });    // @class ItemsSearcher.View
        }    //@method setFocus Set the focus to the input searcher
             //@return {Void}
,
        setFocus: function setFocus() {
            this.$searchElement.focus();
        }    //@method selectFirstIfRequire Highlights the first item of the suggest if the highlightFirst options is specified
             //@return {Void}
,
        selectFirstIfRequire: function selectFirstIfRequire() {
            if (this.options.highlightFirst) {
                var $menu_container = this.$searchElement.data('ttTypeahead').dropdown.$menu, current_cursor_index = $menu_container.find('.tt-suggestion.tt-cursor').index();
                if (current_cursor_index === -1) {
                    $menu_container.find('.tt-suggestion').first().addClass('tt-cursor');
                }
            }
        }    // @method loadSuggestionItemsSource Implements the search logic by fetching the collection of items
             // @param {String} query To string to search for
             // @param {Function<Array<String>, Void>} callback IMPORTANT Based on the values passed in to this callback the typeAhead plugin will invoke
             // the methd getSelectedItemDisplayText asking for the string of each item
             // @return {Void}
,
        loadSuggestionItemsSource: function loadSuggestionItemsSource(query, callback) {
            var self = this;
            self.options.ajaxDone = false;
            self.options.results = {};
            self.options.query = ItemsSearcherUtils.formatKeywords(query);
            // self.collection.reset(undefined, {silent:true});
            this.collection = new this.options.collection([], this.options.collectionOptions);
            // if the character length from the query is over the min length
            if (self.options.query.length >= self.options.minLength) {
                self.options.labels = ['see-all-' + self.options.query];
                callback(self.options.labels);
                self.$searchElement.data('ttTypeahead').dropdown.moveCursorDown();
            }
            // silent = true makes it invisible to any listener that is waiting for the data to load
            // We can use jQuery's .done, as the fetch method returns a promise
            // http://api.jquery.com/deferred.done/
            self.collection.fetch({
                data: {
                    q: jQuery.trim(self.options.query),
                    sort: self.options.sort,
                    limit: self.options.limit,
                    offset: 0
                },
                killerId: _.uniqueId('ajax_killer_')
            }, { silent: true }).done(function () {
                self.collection = self.postItemsSuggestionObtained.executeAll(self.collection, self.options) || self.collection;
                self.options.ajaxDone = true;
                self.options.labels = self.options.showSeeAll ? ['see-all-' + self.options.query].concat(self.getItemIds(self.collection)) : self.getItemIds(self.collection);
                // self.options.labels = self.options.showSeeAll ? ['see-all-' + self.options.query].concat(self.collection.pluck('_id')) : self.collection.pluck('_id');
                if (!self.options.labels.length) {
                    self.options.labels = ['see-all-' + self.options.query];
                }
                callback(self.options.labels);
                self.selectFirstIfRequire();
            });
        }    //@method getItemIds Given the collection of items it generates an array of Ids. This method is used so it is easy to use another model
             //rather than Item.Model (let say Product.Model)
             //@param {Item.Collection} collection
             //@return {Array<String>}
,
        getItemIds: function getItemIds(collection) {
            return collection.map(function (item) {
                return item.id;
            });
        }    //@method getSelectedItemDisplayText Returns the text shown on the input text when an item is selected by using the keyboard keys
             //@param {String} item_id
             //@return {String}
,
        getSelectedItemDisplayText: function (item_id) {
            return this.getItemDisplayName(this.collection.get(item_id), this.options.query);
        }    //@method getItemDisplayName Internal auxiliary method used to extract the display name of an item
             //@param {Item.Model} item
             //@param {String} query
             //@return {String}
,
        getItemDisplayName: function (item, query) {
            return _.isFunction(this.options.getItemDisplayName) ? this.options.getItemDisplayName(item, query) : item ? item.get('_name') : query;
        }    //@method getSuggestionItemTemplate
             //@param {String} item_id
             //@return {jQuery} Returns a jQuery elements with the template
,
        getSuggestionItemTemplate: function (item_id) {
            var item_view_options = _.extend({}, this.options.itemViewOptions, {
                    model: this.collection.get(item_id),
                    query: this.options.query,
                    areResults: !!this.collection.length,
                    isAjaxDone: this.options.ajaxDone
                }), items_searcher_item = new this.options.itemView(item_view_options);
            items_searcher_item.render();
            return items_searcher_item.$el;
        }    //@method onKeyUp Handle the visibility of the reset button, hide and show it
             //@param {jQuertEvent} e
             //@return {Void}
,
        onKeyUp: function (e) {
            // @event keyUp
            this.trigger('keyUp'    //@class ItemsSearcher.View.KeyDown.Properties
, {
                //@property {Array<Item.Model>} collection
                collection: this.collection.models,
                eventObject: e    //@property {String} currentQuery
,
                currentQuery: this.getCurrentQuery()
            });    //@class ItemsSearcher.View
        }    //@method onKeyDown Cleans the input field and hide the reset button on enter
             //@param {jQueryEvent} e
             //@return {Void}
,
        onKeyDown: function (e) {
            var current_text = this.$searchElement.typeahead('val');
            if (this.options.selectedItem && current_text !== this.getItemDisplayName(this.options.selectedItem, this.options.query)) {
                this.options.selectedItem = null;
                this.trigger('itemSelected', {
                    selectedItem: null,
                    collection: this.collection.models,
                    currentQuery: this.options.query
                });
            }
            // @event keyDown
            this.trigger('keyDown'    //@class ItemsSearcher.View.KeyDown.Properties
, {
                //@property {Array<Item.Model>} collection
                collection: this.collection.models,
                eventObject: e    //@property {String} currentQuery
,
                currentQuery: this.getCurrentQuery()
            });    //@class ItemsSearcher.View
        }    //@method destroy Override default implementation to clean up all attached events of the initialize
             //@return {Void}
,
        destroy: function () {
            this.off('afterViewRender');
            this.$searchElement.off('click');
            Backbone.View.prototype.destroy.apply(this, arguments);
        }    // @method getContext
             // @returns {ItemsSearcher.View.Context}
,
        getContext: function () {
            // @class ItemsSearcher.View.Context
            return {
                //@property {String} defaultPlaceholderLabel
                placeholderLabel: this.options.placeholderLabel,
                maxLength: this.options.maxLength,
                showId: !!this.options.componentId,
                id: this.options.componentId,
                showName: !!this.options.componentName,
                name: this.options.componentName
            };    // @class ItemsSearcher.View
        }
    });
    return ItemsSearcherView;
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module SiteSearch
define('SiteSearch.View', [
    'SC.Configuration',
    'ItemsSearcher.View',
    'Session',
    'Backbone.CompositeView',
    'site_search.tpl',
    'Backbone',
    'underscore',
    'Utils'
], function (Configuration, ItemsSearcherView, Session, BackboneCompositeView, site_search_tpl, Backbone, _, Utils) {
    'use strict';
    // @class SiteSearch.View @extends Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: site_search_tpl    //@property {Object} events
,
        events: {
            'submit [data-action="search"]': 'searchEventHandler',
            'click [data-type="search-reset"]': 'resetHandle'
        }    //@method initialize
             //@return {Void}
,
        initialize: function () {
            this.itemsSearcherComponent = new ItemsSearcherView({
                minLength: Configuration.get('typeahead.minLength', 3),
                maxLength: Configuration.get('searchPrefs.maxLength', 0),
                limit: Configuration.get('typeahead.maxResults', 10),
                sort: Configuration.get('typeahead.sort', 'relevance:desc'),
                highlight: Configuration.get('typeahead.highlight', true)
            });
            this.itemsSearcherComponent.on('itemSelected', this.onItemSelected, this);
            this.itemsSearcherComponent.on('keyUp', this.showReset, this);
            this.itemsSearcherComponent.on('keyDown', this.cleanSearchOnEnter, this);
            this.application = this.options.application;
            BackboneCompositeView.add(this);
        }    //@method showReset Handle when to show or hide the reset button
             //@param {ItemsSearcher.View.KeyDown.Properties} event_properties
             //@return {Void}
,
        showReset: function (event_properties) {
            if (event_properties.currentQuery) {
                this.$('[data-type="search-reset"]').show();
            } else {
                this.$('[data-type="search-reset"]').hide();
            }
        }    //@method cleanSearchOnEnter Cleans the current search status
             //@param {ItemsSearcher.View.KeyDown.Properties} event_properties
             //@return {Void}
,
        cleanSearchOnEnter: function (event_properties) {
            if (event_properties.eventObject.keyCode === 27) {
                this.$('[data-type="search-reset"]').hide();
                this.itemsSearcherComponent.cleanSearch();
            }
        }    //@method resetHandle Handle the reset action by hiding it and cleaning the current search status
             //@return {Void}
,
        resetHandle: function () {
            this.$('[data-type="search-reset"]').hide();
            this.itemsSearcherComponent.cleanSearch();
        }    //@method showSiteSearch Auto-show the site search form
,
        showSiteSearch: function (dontFocus) {
            this.$('[data-type="search-reset"]').hide();
            this.itemsSearcherComponent.cleanSearch(true);
            if (!dontFocus) {
                this.itemsSearcherComponent.setFocus();
            }
        }    // @method searchEventHandler Call on submit of the Search form
             // @param {jQueryElement} e
             // @return {Void}
,
        searchEventHandler: function (e) {
            e.preventDefault();
            var search_term = this.itemsSearcherComponent.getCurrentQuery();
            if (search_term.length < 1) {
                return;
            }
            this.itemsSearcherComponent.cleanSearch();
            this.executeSearch(search_term);
        }    // @method search This method handle the navigation to the search result page. This happens when the user press enter or click the 'Go' button
             // @param {String} keywords
             // @return {Void}
,
        executeSearch: function (keywords) {
            var self = this, plp_component = this.application && this.application.getComponent('PLP');
            if (!plp_component) {
                self._executeSearch(keywords);
            } else {
                plp_component.setSearchText({ searchText: keywords }).fail(function (result) {
                    if (result === false) {
                        self._executeSearch(keywords);
                    }
                });
            }
        },
        _executeSearch: function (keywords) {
            var search_url = _.getPathFromObject(Configuration, 'defaultSearchUrl'), delimiters = _.getPathFromObject(Configuration, 'facetDelimiters'), keywordsDelimited = delimiters ? delimiters.betweenFacetsAndOptions + 'keywords' + delimiters.betweenOptionNameAndValue : '?keywords=';
            // If we are not in Shopping we have to redirect to it
            if (_.getPathFromObject(Configuration, 'currentTouchpoint') !== 'home') {
                window.location.href = Session.get('touchpoints.home') + '#' + search_url + keywordsDelimited + keywords;
            }    // Else we stay in the same app
            else {
                // We navigate to the default search url passing the keywords
                Backbone.history.navigate(search_url + keywordsDelimited + keywords + this.getCurrentSearchOptions(), { trigger: true });
            }
        }    //@method onItemSelected Handle the selection of an item of the type-ahead result
             //@param {ItemsSearcher.View.itemSelected.Properties} result
             //@return {Void}
,
        onItemSelected: function (result) {
            var item = result.selectedItem, collection = result.collection, query = result.currentQuery;
            this.$('[data-type="search-reset"]').hide();
            this.itemsSearcherComponent.cleanSearch(true);
            if (item) {
                var path = item.get('_url');
                if (Configuration.get('currentTouchpoint', '') !== 'home') {
                    window.location.href = Session.get('touchpoints.home') + '#' + path;
                } else {
                    Backbone.history.navigate(path, { trigger: true });
                }
            } else {
                if (!collection.length && result.isResultCompleted) {
                    return false;
                } else {
                    this.executeSearch(query);
                }
            }
        }    //@method getCurrentSearchOptions Returns current search options formatted as query params.
             //@return {String}
,
        getCurrentSearchOptions: function () {
            var newOptions = [], currentOptions = Utils.parseUrlOptions(window.location.href);
            _.each(currentOptions, function (value, key) {
                var lowerCaseKey = key.toLowerCase();
                if (lowerCaseKey === 'order' || lowerCaseKey === 'show' || lowerCaseKey === 'display') {
                    newOptions.push(lowerCaseKey + '=' + value);
                }
            });
            var newOptionsStr = newOptions.join('&');
            if (newOptionsStr.length > 0) {
                newOptionsStr = '&' + newOptionsStr;
            }
            return newOptionsStr;
        }    //@property {Object} childViews
,
        childViews: {
            'ItemsSeacher': function () {
                return this.itemsSearcherComponent;
            }
        }    //@method getContext
             //@return {SiteSearch.View.Context}
,
        getContext: function () {
            //@class SiteSearch.View.Context
            return {};    //@class SiteSearch.View
        }    //@method destroy Override default implementation to clean up all attached events of the initialize
             //@return {Void}
,
        destroy: function () {
            Backbone.View.prototype.destroy.apply(this, arguments);
            this.itemsSearcherComponent.off('itemSelected');
            this.itemsSearcherComponent.off('keyUp');
            this.itemsSearcherComponent.off('keyDown');
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Header
define('Header.View', [
    'SC.Configuration',
    'Profile.Model',
    'Header.Logo.View',
    'Header.MiniCart.View',
    'Header.MiniCartSummary.View',
    'Header.Profile.View',
    'Header.Menu.View',
    'GlobalViews.HostSelector.View',
    'GlobalViews.CurrencySelector.View',
    'SiteSearch.View',
    'header.tpl',
    'jQuery',
    'Backbone',
    'Backbone.CompositeView',
    'underscore',
    'Utils'
], function (Configuration, ProfileModel, HeaderLogoView, HeaderMiniCartView, HeaderMiniCartSummaryView, HeaderProfileView, HeaderMenuView, GlobalViewsHostSelectorView, GlobalViewsCurrencySelectorView, SiteSearchView, header_tpl, jQuery, Backbone, BackboneCompositeView, _, Utils) {
    'use strict';
    // @class Header.View @extends Backbone.View
    return Backbone.View.extend({
        template: header_tpl,
        events: {
            'click [data-action="show-sitesearch"]': 'showSiteSearch',
            'click [data-action="header-sidebar-show"]': 'showSidebar',
            'click [data-action="header-sidebar-hide"]': 'hideSidebar',
            'click [data-type="header-sidebar-menu"]': 'hideSidebar'
        },
        initialize: function () {
            var self = this;
            BackboneCompositeView.add(this);
            ProfileModel.getPromise().done(function () {
                self.render();
            });
            Backbone.history.on('all', this.verifyShowSiteSearch, this);
        }    // @method verifyShowSiteSearch expand the site search only if hash===home and (phone or tablet)
,
        verifyShowSiteSearch: function () {
            var hash = Backbone.history.getFragment() || '';
            hash = hash.indexOf('?') === -1 ? hash : hash.substring(0, hash.indexOf('?'));
            var is_home = hash === '' || hash === '/';
            if (Utils.getDeviceType() !== 'desktop' && is_home) {
                this.showSiteSearch(null, true);
            }    // else
                 // {
                 // 	// This hide sitesearch when navigate
                 // 	this.hideSiteSearch();
                 // }
        }    // @method showSiteSearch
             // ,	showSiteSearch: function (ev)
             // 	{
             // 		ev && ev.preventDefault();
             // 		// This add a class 'active' to change button color
             // 		this.$('[data-action="show-sitesearch"]').toggleClass('active');
             // 		var self = this;
             // 		this.$('[data-type="SiteSearch"]').stop(true, false).slideToggle(function ()
             // 		{
             // 			// Set focus and cleans previous search
             // 			self.getChildViewInstance('SiteSearch').showSiteSearch();
             // 		});
             // 	}
             //@method hideSiteSearch Auto-hide the site search form
             //@return {Void}
             // , hideSiteSearch: function()
             // 	{
             // 		// This hide Sitesearch div
             // 		this.$('[data-type="SiteSearch"]').slideUp();
             // 	}
             // @method showMiniCart
             //@return {Void}
,
        showMiniCart: function () {
            this.$('[data-type="mini-cart"]').parent().addClass('open');
        }    // @method showSidebar
             //@return {Void}
,
        showSidebar: function () {
            jQuery('#main').addClass('header-sidebar-opened');
        }    // @method hideSidebar
             //@return {Void}
,
        hideSidebar: function (e) {
            if (e.target.tagName === 'A') {
                if (this.activeLink) {
                    this.activeLink.removeClass('active');
                }
                this.activeLink = jQuery(e.target);
                this.activeLink.addClass('active');
            }
            jQuery('#main').removeClass('header-sidebar-opened');
        },
        childViews: {
            'Header.MiniCart': function () {
                return new HeaderMiniCartView();
            },
            'Header.MiniCartSummary': function () {
                return new HeaderMiniCartSummaryView();
            },
            'Header.Profile': function () {
                var header_profile_view_options = _.extend({
                    showMyAccountMenu: true,
                    application: this.options.application
                }, this.options.headerProfileViewOptions || {});
                return new HeaderProfileView(header_profile_view_options);
            },
            'Header.Logo': function () {
                return new HeaderLogoView(this.options);
            },
            'Header.Menu': function () {
                var header_view_options = _.extend({ application: this.options.application }, this.options.headerProfileViewOptions || {});
                return new HeaderMenuView(header_view_options);
            },
            'Global.HostSelector': function () {
                return new GlobalViewsHostSelectorView();
            },
            'Global.CurrencySelector': function () {
                return new GlobalViewsCurrencySelectorView();
            },
            'SiteSearch': function () {
                return new SiteSearchView({ application: this.options.application });
            }
        }    // @method getContext
             // @return {Header.View.Context}
,
        getContext: function getContext() {
            var environment = SC.ENVIRONMENT, show_languages = environment.availableHosts && environment.availableHosts.length > 1, show_currencies = environment.availableCurrencies && environment.availableCurrencies.length > 1 && !Configuration.get('header.notShowCurrencySelector');
            var profile = ProfileModel.getInstance(), is_loading = !_.getPathFromObject(Configuration, 'performance.waitForUserProfile', true) && ProfileModel.getPromise().state() !== 'resolved', is_logged_in = (profile.get('isLoggedIn') === 'T' || profile.get('isRecognized') === 'T') && profile.get('isGuest') === 'F';
            // @class Header.View.Context
            return {
                // @property {Profile.Model} profileModel
                profileModel: ProfileModel.getInstance()    // @property {Boolean} showLoginMenu
,
                loggedInHome: !is_loading && is_logged_in,
                showLanguages: show_languages    // @property {Boolean} showCurrencies
,
                showCurrencies: show_currencies    // @property {Boolean} showLanguagesOrCurrencies
,
                showLanguagesOrCurrencies: show_languages || show_currencies    // @property {Boolean} showLanguagesAndCurrencies
,
                showLanguagesAndCurrencies: show_languages && show_currencies    // @property {Boolean} isHomeTouchpoint
,
                isHomeTouchpoint: Configuration.currentTouchpoint === 'home'    // @property {String} cartTouchPoint
,
                cartTouchPoint: Configuration.get('modulesConfig.Cart.startRouter', false) ? Configuration.currentTouchpoint : 'viewcart'
            };    // @class Header.View
        }    //@method destroy Override default destroy method to clean navigation event handlers
             //@return {Void}
,
        destroy: function () {
            Backbone.View.prototype.destroy.apply(this, arguments);
            Backbone.history.off('all', this.verifyShowSiteSearch);
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CheckoutApplication
// @class SCA.Checkout.Configuration.Steps.OPC
// The configuration steps so the Checkout wizard shows the Standard Flow experience
define('SC.Checkout.Configuration.Steps.Standard', [
    'underscore',
    'Utils',
    'OrderWizard.Module.MultiShipTo.EnableLink',
    'OrderWizard.Module.CartSummary',
    'OrderWizard.Module.Address.Shipping',
    'OrderWizard.Module.PaymentMethod.GiftCertificates',
    'OrderWizard.Module.PaymentMethod.Selector',
    'OrderWizard.Module.PaymentMethod.PurchaseNumber',
    'OrderWizard.Module.Address.Billing',
    'OrderWizard.Module.RegisterEmail',
    'OrderWizard.Module.ShowPayments',
    'OrderWizard.Module.SubmitButton',
    'OrderWizard.Module.TermsAndConditions',
    'OrderWizard.Module.Confirmation',
    'OrderWizard.Module.RegisterGuest',
    'OrderWizard.Module.PromocodeForm',
    'OrderWizard.Module.PromocodeNotifications',
    'OrderWizard.Module.MultiShipTo.Select.Addresses.Shipping',
    'OrderWizard.Module.MultiShipTo.Package.Creation',
    'OrderWizard.Module.MultiShipTo.Package.List',
    'OrderWizard.Module.NonShippableItems',
    'OrderWizard.Module.MultiShipTo.Shipmethod',
    'OrderWizard.Module.Shipmethod',
    'OrderWizard.Module.ShowShipments',
    'OrderWizard.Module.CartItems',
    'OrderWizard.Module.CartItems.PickupInStore',
    'OrderWizard.Module.CartItems.Ship',
    'OrderWizard.Module.CartItems.PickupInStore.List',
    'Header.View'
], function (_, Utils, OrderWizardModuleMultiShipToEnableLink, OrderWizardModuleCartSummary, OrderWizardModuleAddressShipping, OrderWizardModulePaymentMethodGiftCertificates, OrderWizardModulePaymentMethodSelector, OrderWizardModulePaymentMethodPurchaseNumber, OrderWizardModuleAddressBilling, OrderWizardModuleRegisterEmail, OrderWizardModuleShowPayments, OrderWizardModuleSubmitButton, OrderWizardModuleTermsAndConditions, OrderWizardModuleConfirmation, OrderWizardModuleRegisterGuest, OrderWizardModulePromocodeForm, OrderWizardModulePromocodeNotification, OrderWizardModuleMultiShipToSelectAddressesShipping, OrderWizardModuleMultiShipToPackageCreation, OrderWizardModuleMultiShipToPackageList, OrderWizardModuleNonShippableItems, OrderWizardModuleMultiShipToShipmethod, OrderWizardModuleShipmethod, OrderWizardModuleShowShipments, OrderWizardModuleCartItems, OrderWizardModuleCartItemsPickupInStore, OrderWizardModuleCartItemsShip, OrderWizardModuleCartItemsPickupInStoreList, HeaderView) {
    'use strict';
    var mst_delivery_options = {
            is_read_only: false,
            show_edit_address_url: false,
            hide_accordion: true,
            collapse_items: true
        }, show_shipment_options = {
            edit_url: '/shipping/address',
            show_edit_address_url: true,
            hide_title: true,
            edit_shipment_url: 'shipping/addressPackages',
            edit_shipment_address_url: 'shipping/selectAddress',
            is_read_only: false,
            show_combo: true,
            show_edit_button: true,
            hide_item_link: true
        }, cart_summary_options = {
            exclude_on_skip_step: true,
            allow_remove_promocode: true,
            container: '#wizard-step-content-right'
        }, cart_items_options_right = {
            container: '#wizard-step-content-right',
            hideHeaders: true,
            showMobile: true,
            exclude_on_skip_step: true,
            showOpenedAccordion: _.isTabletDevice() || _.isDesktopDevice() || false
        }, cart_items_non_shippable_options_right = _.extend({
            title: _('Other Items').translate(),
            show_mobile: true,
            show_table_header: false,
            show_edit_cart_button: true
        }, cart_items_options_right);
    return [
        {
            name: _('Shipping Address').translate(),
            steps: [
                {
                    name: _('Choose Shipping Address').translate(),
                    url: 'shipping/address',
                    isActive: function () {
                        return !this.wizard.isMultiShipTo();
                    },
                    modules: [
                        [
                            OrderWizardModulePromocodeNotification,
                            { exclude_on_skip_step: true }
                        ],
                        OrderWizardModuleMultiShipToEnableLink,
                        OrderWizardModuleAddressShipping,
                        [
                            OrderWizardModuleShipmethod,
                            mst_delivery_options
                        ],
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ],
                        [
                            OrderWizardModuleCartItemsShip,
                            _.extend({
                                show_opened_accordion: _.isDesktopDevice(),
                                show_edit_cart_button: true,
                                show_headers: false,
                                show_mobile: true
                            }, cart_items_options_right)
                        ],
                        [
                            OrderWizardModuleCartItemsPickupInStore,
                            _.extend({
                                show_opened_accordion: false,
                                show_edit_cart_button: true,
                                show_headers: false,
                                show_mobile: true
                            }, cart_items_options_right)
                        ],
                        [
                            OrderWizardModuleNonShippableItems,
                            cart_items_non_shippable_options_right
                        ]
                    ]
                },
                {
                    name: _('Enter Shipping Address').translate(),
                    url: 'shipping/selectAddress',
                    isActive: function () {
                        return this.wizard.isMultiShipTo();
                    },
                    modules: [
                        [
                            OrderWizardModuleMultiShipToEnableLink,
                            { exclude_on_skip_step: true }
                        ],
                        [
                            OrderWizardModuleMultiShipToSelectAddressesShipping,
                            { edit_addresses_url: 'shipping/selectAddress' }
                        ],
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ]
                    ]
                }
            ]
        },
        {
            name: _('Set shipments').translate(),
            steps: [{
                    name: _('Set shipments').translate(),
                    isActive: function () {
                        return this.wizard.isMultiShipTo();
                    },
                    url: 'shipping/addressPackages',
                    modules: [
                        [
                            OrderWizardModuleMultiShipToEnableLink,
                            { change_url: 'shipping/address' }
                        ],
                        [
                            OrderWizardModuleMultiShipToPackageCreation,
                            { edit_addresses_url: 'shipping/selectAddress' }
                        ],
                        OrderWizardModuleMultiShipToPackageList,
                        OrderWizardModuleNonShippableItems,
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ]
                    ]
                }]
        },
        {
            name: _('Delivery Method').translate(),
            steps: [{
                    name: _('Choose delivery method').translate(),
                    url: 'shipping/packages',
                    isActive: function () {
                        return this.wizard.isMultiShipTo();
                    },
                    modules: [
                        [
                            OrderWizardModuleMultiShipToShipmethod,
                            mst_delivery_options
                        ],
                        [
                            OrderWizardModuleNonShippableItems,
                            mst_delivery_options
                        ],
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ]
                    ]
                }]
        },
        {
            name: _('Payment').translate(),
            steps: [{
                    name: _('Choose Payment Method').translate(),
                    url: 'billing',
                    bottomMessage: _('You will have an opportunity to review your order on the next step.').translate(),
                    modules: [
                        [
                            OrderWizardModulePromocodeNotification,
                            { exclude_on_skip_step: true }
                        ],
                        OrderWizardModulePaymentMethodGiftCertificates,
                        [
                            OrderWizardModulePaymentMethodSelector,
                            {
                                record_type: 'salesorder',
                                prevent_default: true
                            }
                        ],
                        OrderWizardModulePaymentMethodPurchaseNumber,
                        [
                            OrderWizardModuleAddressBilling,
                            {
                                enable_same_as: function () {
                                    return !this.wizard.isMultiShipTo() && this.wizard.model.shippingAddressIsRequired();
                                },
                                title: _('Enter Billing Address').translate(),
                                select_shipping_address_url: 'shipping/selectAddress'
                            }
                        ],
                        OrderWizardModuleRegisterEmail,
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ],
                        [
                            OrderWizardModuleCartItemsPickupInStore,
                            _.extend({
                                show_opened_accordion: false,
                                show_edit_cart_button: true,
                                show_headers: false,
                                show_mobile: true
                            }, cart_items_options_right)
                        ],
                        [
                            OrderWizardModuleCartItemsShip,
                            _.extend({
                                show_opened_accordion: false,
                                show_edit_cart_button: true,
                                show_headers: false,
                                show_mobile: true
                            }, cart_items_options_right)
                        ],
                        [
                            OrderWizardModuleNonShippableItems,
                            cart_items_non_shippable_options_right
                        ]
                    ]
                }]
        },
        {
            name: _('Review').translate(),
            steps: [
                {
                    name: _('Review Your Order').translate(),
                    url: 'review',
                    continueButtonLabel: function () {
                        return this.wizard && this.wizard.isExternalCheckout() ? _('Continue to External Payment').translate() : _('Place Order').translate();
                    },
                    bottomMessage: function () {
                        return this.wizard && this.wizard.isExternalCheckout() ? _('You will be redirected to a secure site to confirm your payment.').translate() : '';
                    },
                    modules: [
                        [
                            //Mobile Top
                            OrderWizardModuleTermsAndConditions,
                            { className: 'order-wizard-termsandconditions-module-top' }
                        ],
                        [
                            //Mobile Top
                            OrderWizardModuleSubmitButton,
                            { className: 'order-wizard-submitbutton-module-top' }
                        ],
                        [
                            OrderWizardModulePromocodeNotification,
                            { exclude_on_skip_step: true }
                        ],
                        [
                            OrderWizardModuleCartItemsPickupInStoreList,
                            {
                                show_opened_accordion: _.isDesktopDevice(),
                                is_accordion_primary: true,
                                show_edit_cart_button: true,
                                show_headers: false,
                                show_mobile: true
                            }
                        ],
                        [
                            OrderWizardModuleShowShipments,
                            _.extend(_.clone(show_shipment_options), {})
                        ],
                        [
                            OrderWizardModuleMultiShipToShipmethod,
                            show_shipment_options
                        ],
                        [
                            OrderWizardModuleNonShippableItems,
                            {
                                show_mobile: false,
                                show_table_header: true,
                                show_opened_accordion: _.isDesktopDevice(),
                                is_accordion_primary: true,
                                show_edit_cart_button: true
                            }
                        ],
                        [
                            OrderWizardModuleShowPayments,
                            {
                                edit_url_billing: '/billing',
                                edit_url_address: '/billing'
                            }
                        ],
                        [
                            //Desktop Bottom
                            OrderWizardModuleTermsAndConditions,
                            { className: 'order-wizard-termsandconditions-module-default' }
                        ],
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            //Desktop Right
                            OrderWizardModuleTermsAndConditions,
                            {
                                container: '#wizard-step-content-right',
                                className: 'order-wizard-termsandconditions-module-top-summary'
                            }
                        ],
                        [
                            OrderWizardModuleSubmitButton,
                            {
                                container: '#wizard-step-content-right',
                                showWrapper: true,
                                wrapperClass: 'order-wizard-submitbutton-container'
                            }
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ],
                        [
                            //Mobile Right Bottom
                            OrderWizardModuleTermsAndConditions,
                            {
                                className: 'order-wizard-termsandconditions-module-bottom',
                                container: '#wizard-step-content-right'
                            }
                        ]
                    ],
                    save: function () {
                        if (SC.CONFIGURATION.isThreeDSecureEnabled) {
                            var promise = this.wizard.model.submit();
                            return this.wizard.start3DSecure(promise);
                        } else {
                            _.first(this.moduleInstances).trigger('change_label_continue', _('Processing...').translate());
                            var self = this, submit_operation = this.wizard.model.submit();
                            submit_operation.always(function () {
                                _.first(self.moduleInstances).trigger('change_label_continue');
                            });
                            return submit_operation;
                        }
                    }
                },
                {
                    url: 'confirmation',
                    hideContinueButton: true,
                    hideBackButton: true,
                    hideBreadcrumb: true,
                    headerView: HeaderView,
                    modules: [
                        [
                            OrderWizardModuleConfirmation,
                            { additional_confirmation_message: _('You will receive an email with this confirmation in a few minutes.').translate() }
                        ],
                        [OrderWizardModuleRegisterGuest],
                        [
                            OrderWizardModuleCartSummary,
                            _.extend({
                                hideSummaryItems: true,
                                show_promocode_form: false,
                                allow_remove_promocode: false,
                                isConfirmation: true
                            }, cart_summary_options)
                        ]
                    ]
                }
            ]
        }
    ];
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard
define('OrderWizard.Module.Title', [
    'Wizard.Module',
    'order_wizard_title.tpl',
    'underscore'
], function (WizardModule, order_wizard_title_tpl, _) {
    'use strict';
    //@class OrderWizard.Module.Title @extend WizardModule
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_title_tpl    //@method render We override render to just render this module in case the it is active
                                  //@return {Void}
,
        render: function () {
            if (this.isActive()) {
                this._render();
            } else {
                this.$el.empty();
            }
            return this.trigger('ready', true);
        }    //@method initialize
             //@param {OrderWizard.Module.Title.Initialize.Options} options
             //@return {Void}
,
        initialize: function (options) {
            WizardModule.prototype.initialize.apply(this, arguments);
            this.title = options.title;
            this.refreshOn = options.refreshOn;
            this.tag = options.tag;
            this.details = options.details;
            this.attributes = options.attributes;
            this.refresh();
        }    //@method refresh Attach to the desire refreshOn of the passed in options when this module is initialized
             //@return {Void}
,
        refresh: function () {
            if (this.refreshOn) {
                if (_(this.refreshOn).isFunction()) {
                    this.refreshOn();
                } else {
                    this.wizard.model.on(this.refreshOn, this.render, this);
                }
            }
        }    //@method getStringifyAttributes Given an object generate a string representation of it
             //@param {Object} obj Any object to convert to string
             //@return {String}
,
        getStringifyAttributes: function (obj) {
            var self = this;
            return _.reduce(obj, function (memo, value, key) {
                if (_.isObject(value)) {
                    return memo + self.getStringifyAttributes(obj[key], key + '-');
                }
                return memo + ' ' + _.escape(key) + '=' + _.escape(_.isArray(value) ? value.join(' ') : value);
            }, '');
        }    //@method getTag Evaluates the current tag and returns it final value
             //@return {String}
,
        getTag: function () {
            return _(this.tag).isFunction() ? this.tag() : this.tag || 'h2';
        }    //@method getDetails Evaluates the current details and returns it final value
             //@return {String}
,
        getDetails: function () {
            return _(this.details).isFunction() ? this.details() : this.details || '';
        }    //@method getTitle Evaluates the current title and returns it final value
             //@return {String}
,
        getTitle: function () {
            return _(this.title).isFunction() ? this.title() : this.title || '';
        }    // @method getContext
             // @return {OrderWizard.Module.Title.Context}
,
        getContext: function () {
            //@class OrderWizard.Module.Title.Context
            return {
                //@property {String} tag
                tag: this.getTag()    //@property {String} attributes
,
                attributes: this.getStringifyAttributes(this.attributes || {})    //@property {String} details
,
                details: this.getDetails()    //@property {String} title
,
                title: this.getTitle()    //@property {Boolean} showDetails
,
                showDetails: !!this.getDetails()
            };    //@class OrderWizard.Module.Title
        }    //@method destroy Override parent method to handle detaching form model event used to re-render
             //@return {Void}
,
        destroy: function () {
            if (this.refreshOn && !_(this.refreshOn).isFunction()) {
                this.wizard.model.on(this.refreshOn, this.render, this);
            }
            WizardModule.prototype.destroy.apply(this, arguments);
        }
    });
});    //@class OrderWizard.Module.Title.Initialize.Options
       //@property {String} title
       //@property {String|Function} refreshOn If it is a function you can specify when the module should be re-render.
       //If it is a string is the name of the event thrown by the wizard's model used to re-render
       //@property {String|Function} tag Name of the HTML tag to be created
       //@property {String|Function} details
       //@property {String|Function} title Title to show (main property of this module)
       //@property {Object} attributes

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CheckoutApplication
// @class SC.Checkout.Configuration.Steps.OPC
// The configuration steps so the Checkout wizard shows the One Page Checkout experience
define('SC.Checkout.Configuration.Steps.OPC', [
    'underscore',
    'Utils',
    'OrderWizard.Module.MultiShipTo.EnableLink',
    'OrderWizard.Module.CartSummary',
    'OrderWizard.Module.Address.Shipping',
    'OrderWizard.Module.PaymentMethod.GiftCertificates',
    'OrderWizard.Module.PaymentMethod.Selector',
    'OrderWizard.Module.PaymentMethod.PurchaseNumber',
    'OrderWizard.Module.Address.Billing',
    'OrderWizard.Module.RegisterEmail',
    'OrderWizard.Module.ShowPayments',
    'OrderWizard.Module.SubmitButton',
    'OrderWizard.Module.TermsAndConditions',
    'OrderWizard.Module.Confirmation',
    'OrderWizard.Module.RegisterGuest',
    'OrderWizard.Module.PromocodeForm',
    'OrderWizard.Module.PromocodeNotifications',
    'OrderWizard.Module.Title',
    'OrderWizard.Module.MultiShipTo.Select.Addresses.Shipping',
    'OrderWizard.Module.MultiShipTo.Package.Creation',
    'OrderWizard.Module.MultiShipTo.Package.List',
    'OrderWizard.Module.NonShippableItems',
    'OrderWizard.Module.MultiShipTo.Shipmethod',
    'OrderWizard.Module.Shipmethod',
    'OrderWizard.Module.ShowShipments',
    'OrderWizard.Module.CartItems',
    'OrderWizard.Module.CartItems.PickupInStore',
    'OrderWizard.Module.CartItems.Ship',
    'OrderWizard.Module.CartItems.PickupInStore.List',
    'Header.View'
], function (_, Utils, OrderWizardModuleMultiShipToEnableLink, OrderWizardModuleCartSummary, OrderWizardModuleAddressShipping, OrderWizardModulePaymentMethodGiftCertificates, OrderWizardModulePaymentMethodSelector, OrderWizardModulePaymentMethodPurchaseNumber, OrderWizardModuleAddressBilling, OrderWizardModuleRegisterEmail, OrderWizardModuleShowPayments, OrderWizardModuleSubmitButton, OrderWizardModuleTermsAndConditions, OrderWizardModuleConfirmation, OrderWizardModuleRegisterGuest, OrderWizardModulePromocodeForm, OrderWizardModulePromocodeNotification, OrderWizardModuleTitle, OrderWizardModuleMultiShipToSelectAddressesShipping, OrderWizardModuleMultiShipToPackageCreation, OrderWizardModuleMultiShipToPackageList, OrderWizardModuleNonShippableItems, OrderWizardModuleMultiShipToShipmethod, OrderWizardModuleShipmethod, OrderWizardModuleShowShipments, OrderWizardModuleCartItems, OrderWizardModuleCartItemsPickupInStore, OrderWizardModuleCartItemsShip, OrderWizardModuleCartItemsPickupInStoreList, HeaderView) {
    'use strict';
    var address_opc_options = {
            title: _('Enter Shipping Address').translate(),
            hide_title: true
        }, delivery_method_opc_options = {
            is_read_only: false,
            hide_title: true,
            hide_items: true
        }, mst_delivery_options = {
            is_read_only: false,
            show_edit_address_url: false,
            hide_accordion: true,
            collapse_items: true
        }, show_shipment_options = {
            edit_url: '/opc',
            show_edit_address_url: true,
            hide_title: true,
            is_read_only: false,
            show_combo: true,
            show_edit_button: true,
            hide_item_link: true
        }, show_mst_shipment_options = {
            edit_url: '/opc',
            show_edit_address_url: true,
            hide_title: true,
            edit_shipment_url: 'shipping/addressPackages',
            edit_shipment_address_url: 'shipping/selectAddress',
            is_read_only: false,
            show_combo: true,
            show_edit_button: true,
            hide_item_link: true
        }, cart_summary_options = {
            exclude_on_skip_step: true,
            show_promocode_form: true,
            show_edit_cart: true,
            allow_remove_promocode: true,
            hide_continue_button: true,
            hide_cart_terms: true,
            container: '#wizard-step-content-right',
            hideSummaryItems: function () {
                return this.wizard.isMultiShipTo();
            }
        }, cart_items_options_right = {
            container: '#wizard-step-content-right',
            hideHeaders: true,
            showMobile: true,
            showOpenedAccordion: _.isTabletDevice() || _.isDesktopDevice() || false
        }, cart_items_non_shippable_options_right = _.extend({
            title: _('Other Items').translate(),
            show_mobile: true,
            show_table_header: false,
            show_edit_cart_button: true
        }, cart_items_options_right);
    return [
        {
            name: _('Checkout Information').translate(),
            steps: [{
                    url: 'opc',
                    continueButtonLabel: _('Continue').translate(),
                    isActive: function () {
                        return !this.wizard.isMultiShipTo();
                    },
                    hideSecondContinueButtonOnPhone: false,
                    bottomMessage: _('You will have an opportunity to review your order on the next step.').translate(),
                    modules: [
                        [
                            OrderWizardModulePromocodeNotification,
                            { exclude_on_skip_step: true }
                        ],
                        [
                            OrderWizardModuleTitle,
                            {
                                title: _('Shipping Address').translate(),
                                exclude_on_skip_step: true,
                                isActive: function () {
                                    return this.wizard.model.shippingAddressIsRequired();
                                }
                            }
                        ],
                        OrderWizardModuleMultiShipToEnableLink,
                        [
                            OrderWizardModuleAddressShipping,
                            address_opc_options
                        ],
                        [
                            OrderWizardModuleTitle,
                            {
                                title: _('Delivery Method').translate(),
                                exclude_on_skip_step: true,
                                isActive: function () {
                                    return this.wizard.model.shippingAddressIsRequired();
                                }
                            }
                        ],
                        [
                            OrderWizardModuleShipmethod,
                            delivery_method_opc_options
                        ],
                        [
                            OrderWizardModuleTitle,
                            { title: _('Payment').translate() }
                        ],
                        [OrderWizardModulePaymentMethodGiftCertificates],
                        [
                            OrderWizardModulePaymentMethodSelector,
                            {
                                record_type: 'salesorder',
                                prevent_default: true
                            }
                        ],
                        OrderWizardModulePaymentMethodPurchaseNumber,
                        [
                            OrderWizardModuleAddressBilling,
                            {
                                title: _('Billing Address').translate(),
                                enable_same_as: function () {
                                    return !this.wizard.model.get('ismultishipto') && this.wizard.model.shippingAddressIsRequired();
                                }
                            }
                        ],
                        OrderWizardModuleRegisterEmail,
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ],
                        [
                            OrderWizardModuleCartItemsShip,
                            _.extend({
                                show_opened_accordion: true,
                                show_edit_cart_button: true,
                                show_headers: false,
                                show_mobile: true
                            }, cart_items_options_right)
                        ],
                        [
                            OrderWizardModuleCartItemsPickupInStore,
                            _.extend({
                                show_opened_accordion: false,
                                show_edit_cart_button: true,
                                show_headers: false,
                                show_mobile: true
                            }, cart_items_options_right)
                        ],
                        [
                            OrderWizardModuleNonShippableItems,
                            cart_items_non_shippable_options_right
                        ]
                    ]
                }]
        },
        {
            name: _('Shipping Address').translate(),
            steps: [{
                    name: _('Enter Shipping Address').translate(),
                    url: 'shipping/selectAddress',
                    isActive: function () {
                        return this.wizard.isMultiShipTo();
                    },
                    modules: [
                        [
                            OrderWizardModuleMultiShipToEnableLink,
                            { exclude_on_skip_step: true }
                        ],
                        [
                            OrderWizardModuleMultiShipToSelectAddressesShipping,
                            { edit_addresses_url: 'shipping/selectAddress' }
                        ],
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ]
                    ]
                }]
        },
        {
            name: _('Set shipments').translate(),
            steps: [{
                    name: _('Set shipments').translate(),
                    isActive: function () {
                        return this.wizard.isMultiShipTo();
                    },
                    url: 'shipping/addressPackages',
                    modules: [
                        OrderWizardModuleMultiShipToEnableLink,
                        [
                            OrderWizardModuleMultiShipToPackageCreation,
                            { edit_addresses_url: 'shipping/selectAddress' }
                        ],
                        OrderWizardModuleMultiShipToPackageList,
                        OrderWizardModuleNonShippableItems,
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ]
                    ]
                }]
        },
        {
            name: _('Delivery Method').translate(),
            steps: [{
                    name: _('Choose delivery method').translate(),
                    url: 'shipping/packages',
                    isActive: function () {
                        return this.wizard.isMultiShipTo();
                    },
                    modules: [
                        [
                            OrderWizardModuleMultiShipToShipmethod,
                            mst_delivery_options
                        ],
                        [
                            OrderWizardModuleNonShippableItems,
                            mst_delivery_options
                        ],
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ]
                    ]
                }]
        },
        {
            name: _('Payment').translate(),
            steps: [{
                    name: _('Choose Payment Method').translate(),
                    url: 'billing',
                    bottomMessage: _('You will have an opportunity to review your order on the next step.').translate(),
                    isActive: function () {
                        return this.wizard.isMultiShipTo();
                    },
                    modules: [
                        OrderWizardModulePaymentMethodGiftCertificates,
                        [
                            OrderWizardModulePaymentMethodSelector,
                            {
                                record_type: 'salesorder',
                                prevent_default: true
                            }
                        ],
                        OrderWizardModulePaymentMethodPurchaseNumber,
                        [
                            OrderWizardModuleAddressBilling,
                            {
                                enable_same_as: function () {
                                    return !this.wizard.isMultiShipTo();
                                },
                                title: _('Enter Billing Address').translate(),
                                select_shipping_address_url: 'shipping/selectAddress'
                            }
                        ],
                        OrderWizardModuleRegisterEmail,
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ]
                    ]
                }]
        },
        {
            name: _('Review').translate(),
            steps: [
                {
                    name: _('Review Your Order').translate(),
                    url: 'review',
                    continueButtonLabel: function () {
                        return this.wizard && this.wizard.isExternalCheckout() ? _('Continue to External Payment').translate() : _('Place Order').translate();
                    },
                    bottomMessage: function () {
                        return this.wizard && this.wizard.isExternalCheckout() ? _('You will be redirected to a secure site to confirm your payment.').translate() : '';
                    },
                    modules: [
                        [
                            //Mobile Top
                            OrderWizardModuleTermsAndConditions,
                            { className: 'order-wizard-termsandconditions-module-top' }
                        ],
                        [
                            //Mobile Top
                            OrderWizardModuleSubmitButton,
                            { className: 'order-wizard-submitbutton-module-top' }
                        ],
                        [
                            OrderWizardModulePromocodeNotification,
                            { exclude_on_skip_step: true }
                        ],
                        [
                            OrderWizardModuleCartItemsPickupInStoreList,
                            {
                                show_opened_accordion: true,
                                is_accordion_primary: true,
                                show_edit_cart_button: true,
                                show_headers: false,
                                show_mobile: true
                            }
                        ],
                        [
                            OrderWizardModuleShowShipments,
                            show_shipment_options
                        ],
                        [
                            OrderWizardModuleMultiShipToShipmethod,
                            show_mst_shipment_options
                        ],
                        [
                            OrderWizardModuleNonShippableItems,
                            {
                                show_mobile: false,
                                show_table_header: true,
                                show_opened_accordion: true,
                                show_edit_cart_button: true
                            }
                        ],
                        [
                            OrderWizardModuleShowPayments,
                            {
                                edit_url_billing: function () {
                                    if (this.wizard.isMultiShipTo()) {
                                        return '/billing';
                                    } else {
                                        return '/opc';
                                    }
                                }
                            }
                        ],
                        [
                            OrderWizardModuleTermsAndConditions,
                            { className: 'order-wizard-termsandconditions-module-default' }
                        ],
                        [
                            OrderWizardModuleCartSummary,
                            _.extend(_.clone(cart_summary_options), {
                                hideSummaryItems: true,
                                hide_continue_button: false,
                                hide_cart_terms: false
                            })
                        ],
                        [
                            //Desktop Right
                            OrderWizardModuleTermsAndConditions,
                            {
                                container: '#wizard-step-content-right',
                                className: 'order-wizard-termsandconditions-module-top-summary'
                            }
                        ],
                        [
                            OrderWizardModuleSubmitButton,
                            {
                                container: '#wizard-step-content-right',
                                showWrapper: true,
                                wrapperClass: 'order-wizard-submitbutton-container'
                            }
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ],
                        [
                            //Mobile Right Bottom
                            OrderWizardModuleTermsAndConditions,
                            {
                                className: 'order-wizard-termsandconditions-module-bottom',
                                container: '#wizard-step-content-right'
                            }
                        ]
                    ],
                    save: function () {
                        if (SC.CONFIGURATION.isThreeDSecureEnabled) {
                            var promise = this.wizard.model.submit();
                            return this.wizard.start3DSecure(promise);
                        } else {
                            _.first(this.moduleInstances).trigger('change_label_continue', _('Processing...').translate());
                            var self = this, submit_operation = this.wizard.model.submit();
                            submit_operation.always(function () {
                                _.first(self.moduleInstances).trigger('change_label_continue');
                            });
                            return submit_operation;
                        }
                    }
                },
                {
                    url: 'confirmation',
                    hideContinueButton: true,
                    hideBackButton: true,
                    hideBreadcrumb: true,
                    headerView: HeaderView,
                    modules: [
                        [
                            OrderWizardModuleConfirmation,
                            { additional_confirmation_message: _('You will receive an email with this confirmation in a few minutes.').translate() }
                        ],
                        [OrderWizardModuleRegisterGuest],
                        [
                            OrderWizardModuleCartSummary,
                            _.extend(_.clone(cart_summary_options), {
                                hideSummaryItems: true,
                                show_promocode_form: false,
                                allow_remove_promocode: false,
                                isConfirmation: true
                            })
                        ]
                    ]
                }
            ]
        }
    ];
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CheckoutApplication
// @class SCA.Checkout.Configuration.Steps.BillingFirst
// The configuration steps so the Checkout wizard shows the Billing First Flow experience
define('SC.Checkout.Configuration.Steps.BillingFirst', [
    'underscore',
    'Utils',
    'OrderWizard.Module.MultiShipTo.EnableLink',
    'OrderWizard.Module.CartSummary',
    'OrderWizard.Module.Address.Shipping',
    'OrderWizard.Module.PaymentMethod.GiftCertificates',
    'OrderWizard.Module.PaymentMethod.Selector',
    'OrderWizard.Module.PaymentMethod.PurchaseNumber',
    'OrderWizard.Module.Address.Billing',
    'OrderWizard.Module.RegisterEmail',
    'OrderWizard.Module.ShowPayments',
    'OrderWizard.Module.SubmitButton',
    'OrderWizard.Module.TermsAndConditions',
    'OrderWizard.Module.Confirmation',
    'OrderWizard.Module.RegisterGuest',
    'OrderWizard.Module.PromocodeForm',
    'OrderWizard.Module.PromocodeNotifications',
    'OrderWizard.Module.MultiShipTo.Select.Addresses.Shipping',
    'OrderWizard.Module.MultiShipTo.Package.Creation',
    'OrderWizard.Module.MultiShipTo.Package.List',
    'OrderWizard.Module.NonShippableItems',
    'OrderWizard.Module.MultiShipTo.Shipmethod',
    'OrderWizard.Module.Shipmethod',
    'OrderWizard.Module.ShowShipments',
    'OrderWizard.Module.CartItems',
    'OrderWizard.Module.CartItems.PickupInStore',
    'OrderWizard.Module.CartItems.Ship',
    'OrderWizard.Module.CartItems.PickupInStore.List',
    'Header.View'
], function (_, Utils, OrderWizardModuleMultiShipToEnableLink, OrderWizardModuleCartSummary, OrderWizardModuleAddressShipping, OrderWizardModulePaymentMethodGiftCertificates, OrderWizardModulePaymentMethodSelector, OrderWizardModulePaymentMethodPurchaseNumber, OrderWizardModuleAddressBilling, OrderWizardModuleRegisterEmail, OrderWizardModuleShowPayments, OrderWizardModuleSubmitButton, OrderWizardModuleTermsAndConditions, OrderWizardModuleConfirmation, OrderWizardModuleRegisterGuest, OrderWizardModulePromocodeForm, OrderWizardModulePromocodeNotification, OrderWizardModuleMultiShipToSelectAddressesShipping, OrderWizardModuleMultiShipToPackageCreation, OrderWizardModuleMultiShipToPackageList, OrderWizardModuleNonShippableItems, OrderWizardModuleMultiShipToShipmethod, OrderWizardModuleShipmethod, OrderWizardModuleShowShipments, OrderWizardModuleCartItems, OrderWizardModuleCartItemsPickupInStore, OrderWizardModuleCartItemsShip, OrderWizardModuleCartItemsPickupInStoreList, HeaderView) {
    'use strict';
    var mst_delivery_options = {
            is_read_only: false,
            show_edit_address_url: false,
            hide_accordion: true,
            collapse_items: true
        }, show_shipment_options = {
            edit_url: '/shipping/address',
            show_edit_address_url: true,
            hide_title: true,
            edit_shipment_url: 'shipping/addressPackages',
            edit_shipment_address_url: 'shipping/selectAddress',
            is_read_only: false,
            show_combo: true,
            show_edit_button: true,
            hide_item_link: true
        }, cart_summary_options = {
            exclude_on_skip_step: true,
            allow_remove_promocode: true,
            container: '#wizard-step-content-right'
        }, cart_items_options_right = {
            container: '#wizard-step-content-right',
            hideHeaders: true,
            showMobile: true,
            exclude_on_skip_step: true,
            showOpenedAccordion: _.isTabletDevice() || _.isDesktopDevice() || false
        }, cart_items_non_shippable_options_right = _.extend({
            title: _('Other Items').translate(),
            show_mobile: true,
            show_table_header: false,
            show_edit_cart_button: true
        }, cart_items_options_right);
    return [
        {
            name: _('Billing Address').translate(),
            steps: [{
                    name: _('Enter Billing Address').translate(),
                    url: 'billing/address',
                    isActive: function () {
                        return !this.wizard.isMultiShipTo();
                    },
                    modules: [
                        [
                            OrderWizardModulePromocodeNotification,
                            { exclude_on_skip_step: true }
                        ],
                        [
                            OrderWizardModuleMultiShipToEnableLink,
                            { exclude_on_skip_step: true }
                        ],
                        OrderWizardModuleAddressBilling,
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ],
                        [
                            OrderWizardModuleCartItemsPickupInStore,
                            _.extend({
                                show_opened_accordion: false,
                                show_edit_cart_button: true,
                                show_headers: false,
                                show_mobile: true
                            }, cart_items_options_right)
                        ],
                        [
                            OrderWizardModuleCartItemsShip,
                            _.extend({
                                show_opened_accordion: false,
                                show_edit_cart_button: true,
                                show_headers: false,
                                show_mobile: true
                            }, cart_items_options_right)
                        ],
                        [
                            OrderWizardModuleNonShippableItems,
                            cart_items_non_shippable_options_right
                        ]
                    ]
                }]
        },
        {
            name: _('Shipping Address').translate(),
            steps: [
                {
                    name: _('Choose Shipping Address').translate(),
                    url: 'shipping/address',
                    isActive: function () {
                        return !this.wizard.isMultiShipTo();
                    },
                    modules: [
                        [
                            OrderWizardModulePromocodeNotification,
                            { exclude_on_skip_step: true }
                        ],
                        OrderWizardModuleMultiShipToEnableLink,
                        [
                            OrderWizardModuleAddressShipping,
                            {
                                enable_same_as: true,
                                title: _('Shipping Address').translate()
                            }
                        ],
                        [
                            OrderWizardModuleShipmethod,
                            mst_delivery_options
                        ],
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ],
                        [
                            OrderWizardModuleCartItemsShip,
                            _.extend({
                                show_opened_accordion: _.isDesktopDevice(),
                                show_edit_cart_button: true,
                                show_headers: false,
                                show_mobile: true
                            }, cart_items_options_right)
                        ],
                        [
                            OrderWizardModuleCartItemsPickupInStore,
                            _.extend({
                                show_opened_accordion: false,
                                show_edit_cart_button: true,
                                show_headers: false,
                                show_mobile: true
                            }, cart_items_options_right)
                        ],
                        [
                            OrderWizardModuleNonShippableItems,
                            cart_items_non_shippable_options_right
                        ]
                    ]
                },
                {
                    name: _('Enter Shipping Address').translate(),
                    url: 'shipping/selectAddress',
                    isActive: function () {
                        return this.wizard.isMultiShipTo();
                    },
                    modules: [
                        [
                            OrderWizardModuleMultiShipToEnableLink,
                            { exclude_on_skip_step: true }
                        ],
                        [
                            OrderWizardModuleMultiShipToSelectAddressesShipping,
                            { edit_addresses_url: 'shipping/selectAddress' }
                        ],
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ]
                    ]
                }
            ]
        },
        {
            name: _('Set shipments').translate(),
            steps: [{
                    name: _('Set shipments').translate(),
                    isActive: function () {
                        return this.wizard.isMultiShipTo();
                    },
                    url: 'shipping/addressPackages',
                    modules: [
                        [
                            OrderWizardModuleMultiShipToEnableLink,
                            { change_url: 'shipping/address' }
                        ],
                        [
                            OrderWizardModuleMultiShipToPackageCreation,
                            { edit_addresses_url: 'shipping/selectAddress' }
                        ],
                        OrderWizardModuleMultiShipToPackageList,
                        OrderWizardModuleNonShippableItems,
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ]
                    ]
                }]
        },
        {
            name: _('Delivery Method').translate(),
            steps: [{
                    name: _('Choose delivery method').translate(),
                    url: 'shipping/packages',
                    isActive: function () {
                        return this.wizard.isMultiShipTo();
                    },
                    modules: [
                        [
                            OrderWizardModuleMultiShipToShipmethod,
                            mst_delivery_options
                        ],
                        [
                            OrderWizardModuleNonShippableItems,
                            mst_delivery_options
                        ],
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ]
                    ]
                }]
        },
        {
            name: _('Payment').translate(),
            steps: [{
                    name: _('Choose Payment Method').translate(),
                    url: 'billing',
                    bottomMessage: _('You will have an opportunity to review your order on the next step.').translate(),
                    modules: [
                        [
                            OrderWizardModulePromocodeNotification,
                            { exclude_on_skip_step: true }
                        ],
                        OrderWizardModulePaymentMethodGiftCertificates,
                        [
                            OrderWizardModulePaymentMethodSelector,
                            {
                                record_type: 'salesorder',
                                prevent_default: true
                            }
                        ],
                        OrderWizardModulePaymentMethodPurchaseNumber,
                        [
                            OrderWizardModuleAddressBilling,
                            {
                                enable_same_as: function () {
                                    return !this.wizard.isMultiShipTo() && this.wizard.model.shippingAddressIsRequired();
                                },
                                title: _('Enter Billing Address').translate(),
                                select_shipping_address_url: 'shipping/selectAddress'
                            }
                        ],
                        OrderWizardModuleRegisterEmail,
                        [
                            OrderWizardModuleCartSummary,
                            cart_summary_options
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ],
                        [
                            OrderWizardModuleCartItemsPickupInStore,
                            _.extend({
                                show_opened_accordion: false,
                                show_edit_cart_button: true,
                                show_headers: false,
                                show_mobile: true
                            }, cart_items_options_right)
                        ],
                        [
                            OrderWizardModuleCartItemsShip,
                            _.extend({
                                show_opened_accordion: false,
                                show_edit_cart_button: true,
                                show_headers: false,
                                show_mobile: true
                            }, cart_items_options_right)
                        ],
                        [
                            OrderWizardModuleNonShippableItems,
                            cart_items_non_shippable_options_right
                        ]
                    ]
                }]
        },
        {
            name: _('Review').translate(),
            steps: [
                {
                    name: _('Review Your Order').translate(),
                    url: 'review',
                    continueButtonLabel: function () {
                        return this.wizard && this.wizard.isExternalCheckout() ? _('Continue to External Payment').translate() : _('Place Order').translate();
                    },
                    bottomMessage: function () {
                        return this.wizard && this.wizard.isExternalCheckout() ? _('You will be redirected to a secure site to confirm your payment.').translate() : '';
                    },
                    modules: [
                        [
                            OrderWizardModuleTermsAndConditions,
                            { className: 'order-wizard-termsandconditions-module-top' }
                        ],
                        [
                            OrderWizardModuleSubmitButton,
                            { className: 'order-wizard-submitbutton-module-top' }
                        ],
                        [
                            OrderWizardModulePromocodeNotification,
                            { exclude_on_skip_step: true }
                        ],
                        [
                            OrderWizardModuleCartItemsPickupInStoreList,
                            {
                                show_opened_accordion: true,
                                is_accordion_primary: true,
                                show_edit_cart_button: true,
                                show_headers: false,
                                show_mobile: true
                            }
                        ],
                        [
                            OrderWizardModuleShowShipments,
                            show_shipment_options
                        ],
                        [
                            OrderWizardModuleMultiShipToShipmethod,
                            show_shipment_options
                        ],
                        [
                            OrderWizardModuleNonShippableItems,
                            {
                                show_mobile: false,
                                show_table_header: true,
                                show_opened_accordion: true,
                                show_edit_cart_button: true
                            }
                        ],
                        [
                            OrderWizardModuleShowPayments,
                            {
                                edit_url_billing: '/billing',
                                edit_url_address: '/billing'
                            }
                        ],
                        [
                            OrderWizardModuleTermsAndConditions,
                            { className: 'order-wizard-termsandconditions-module-default' }
                        ],
                        [
                            OrderWizardModuleCartSummary,
                            _.extend(_.clone(cart_summary_options), {
                                hideSummaryItems: true,
                                hide_continue_button: false,
                                hide_cart_terms: false
                            })
                        ],
                        [
                            //Desktop Right
                            OrderWizardModuleTermsAndConditions,
                            {
                                container: '#wizard-step-content-right',
                                className: 'order-wizard-termsandconditions-module-top-summary'
                            }
                        ],
                        [
                            OrderWizardModuleSubmitButton,
                            {
                                container: '#wizard-step-content-right',
                                showWrapper: true,
                                wrapperClass: 'order-wizard-submitbutton-container'
                            }
                        ],
                        [
                            OrderWizardModulePromocodeForm,
                            cart_items_options_right
                        ],
                        [
                            //Mobile Right Bottom
                            OrderWizardModuleTermsAndConditions,
                            {
                                className: 'order-wizard-termsandconditions-module-bottom',
                                container: '#wizard-step-content-right'
                            }
                        ]
                    ],
                    save: function () {
                        if (SC.CONFIGURATION.isThreeDSecureEnabled) {
                            var promise = this.wizard.model.submit();
                            return this.wizard.start3DSecure(promise);
                        } else {
                            _.first(this.moduleInstances).trigger('change_label_continue', _('Processing...').translate());
                            var self = this, submit_operation = this.wizard.model.submit();
                            submit_operation.always(function () {
                                _.first(self.moduleInstances).trigger('change_label_continue');
                            });
                            return submit_operation;
                        }
                    }
                },
                {
                    url: 'confirmation',
                    hideContinueButton: true,
                    hideBackButton: true,
                    hideBreadcrumb: true,
                    headerView: HeaderView,
                    modules: [
                        [
                            OrderWizardModuleConfirmation,
                            { additional_confirmation_message: _('You will receive an email with this confirmation in a few minutes.').translate() }
                        ],
                        [OrderWizardModuleRegisterGuest],
                        [
                            OrderWizardModuleCartSummary,
                            _.extend(_.clone(cart_summary_options), {
                                hideSummaryItems: true,
                                show_promocode_form: false,
                                allow_remove_promocode: false,
                                isConfirmation: true
                            })
                        ]
                    ]
                }
            ]
        }
    ];
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module CheckoutApplication
@class SCA.Checkout.Configuration
The front end Configuration file for Checkout application.

The most important part is the property checkoutSteps that defines the full checkout wizard experience and it is fully configurable by declaring steps and steps groups that contains WizardModules, this are, views that ask the user for a certain information required by te Checkout process.

There are three supported and well-tested checkout steps configurations: The 'Standard flow', the 'One Page Checkout' (OPC) and the 'Billing first' flow.

By defuault the Standard Flow is used, but you can easily switch to OPC by just replacing the dependency 'SC.Checkout.Steps.Standard' with 'SC.Checkout.Steps.OPC' in this file.
*/
define('SC.Checkout.Configuration', [
    /*
	Note that Backbone.View loads first, this is because of the way the dependencies are loaded after deployed (top to bottom),
	so it needs to extend the Backbone.View prototype before the SC.Checkout.Configuration.Steps dependencies use the default Backbone.View constructor.
	*/
    'Backbone.View',
    'SC.Configuration',
    'underscore',
    'jQuery',
    'Utils'    // heads up ! The three official checkout steps are all included - but only one is selected by configuration
,
    'SC.Checkout.Configuration.Steps.Standard',
    'SC.Checkout.Configuration.Steps.OPC',
    'SC.Checkout.Configuration.Steps.BillingFirst'
], function (BackboneView, BaseConfiguration, _, jQuery, Utils) {
    'use strict';
    //window.screen = false; //always comment this line on production !!
    // Calculates the width of the device, it will try to use the real screen size.
    var screen_width = Utils.getViewportWidth();
    var checkoutStepsMap = {
        'Standard': 'SC.Checkout.Configuration.Steps.Standard',
        'One Page': 'SC.Checkout.Configuration.Steps.OPC',
        'Billing First': 'SC.Checkout.Configuration.Steps.BillingFirst'
    };
    // heads up! if the user adds a new checkout step then it has to use the AMD module name:
    var configuredCheckoutStepsName = checkoutStepsMap[BaseConfiguration.get('checkoutApp.checkoutSteps')] || BaseConfiguration.get('checkoutApp.checkoutSteps');
    var configuredCheckoutSteps = Utils.requireModules(configuredCheckoutStepsName);
    if (!configuredCheckoutSteps) {
        console.log('Configured Checkout steps AMD module not found for ' + configuredCheckoutStepsName + '. Using standard flow');
        configuredCheckoutSteps = Utils.requireModules('SC.Checkout.Configuration.Steps.Standard');
    }
    var Configuration = {
        /*notShowCurrencySelector: true

		// depending on the application we are configuring, used by the NavigationHelper.js
	,*/
        currentTouchpoint: Utils.isInShopping() ? 'viewcart' : 'checkout',
        modulesConfig: {
            'Cart': { startRouter: Utils.isInShopping() },
            'LoginRegister': { startRouter: Utils.isCheckoutDomain() }
        },
        startCheckoutWizard: Utils.isCheckoutDomain()    /*
	@property {Array} checkoutSteps

	Defines the entire Checkout experience. It is based on a Wizard, this is a list of steps that the user secuentially
	complete submitting the order at the end. Each step contains one or more modules that perform a logic task like
	showing or asking the user certain information.

	There are three supported and well-tested checkoutSteps: Standard flow, One page checkout (OPC) and Billing first flow.
	These steps are defined in modules SCA.Checkout.Configuration.Steps.BillingFirst.js for example. Just change the
	dependency 'SC.Checkout.Configuration.Steps.Standard' in this file to use other checkout steps, for example
	'SC.Checkout.Configuration.Steps.BillingFirst'

	The following describes the format of the checkoutSteps property:

		checkoutSteps: [											//an array with the step groups conforming The Checkout
			{
				name: 'Step Group'									//the name of this Step Group
			,	steps: [											//an array of the steps of this step group
					{
						name: 'Step'								//literal name for this step
					,	getName: function()	{return 'a name'; }		//dynamic name for this step. If there is no getName() defined, name property will be used instead
					,	url: 'step-url'								//this step's url. Must be unique among all the steps
					,	continueButtonLabel: "Continue"				//The label of the 'Continue' button for this step, for example, for One Page Checkout it could be 'Place Order'
					,	hideBackButton: true						//if true the "Back" button will be hidden for this step
					,	hideContinueButton: true					//if true the "Continue" buttons in the page will be hidden for this step
					,	hideSecondContinueButtonOnPhone: true		//if true the second "Continue" button in the page will be hidden when displayed on a smart phone. Use this if there are too many "Continue" buttons in a step (i.e. top, bottom and summary buttons)
					,	hideSummaryItems: true						//if true the cart summary's items are not showed on this step
					,	hideBreadcrumb: true						//if true the breadcrumb in the page will be hidden for this step
					,	headerView: 'Header'						//each step can define which main site header to show when the user is placed on it. By default the simplified header is used, but the normal 'header' (or a custom one) can be used
					,	footerView: 'Footer'						//as with the header, each step can define which site footer to use, by default the simplified footer is used.
					,	bottomMessage: 'Some message at the bottom' //a message that will appear at the bottom of the step, under the "continue" and "back" buttons
					,	bottomMessageClass: 'classname'				//a class that the bottom message can have
					,	isActive: function(){return boolean;}		//Indicate if the entire step should be shown or not. The default implementation of this function check that all modules in the step are active (isActive) or not.
					,	modules: [									//Required, the list modules that form this step, the order will be respected visually from top to bottom.
							'Module.Name'							//three different module syntax are supported String, array or object.
						,	['Module2', {edit_url: '/someurl'}]		//individual modules may accept configuration parameters that will be applied to the module for this step. In this case the edit_url is accepted by those modules that ask the user to edit data from modules in ahother step, so it must be a valid step url.
						,	{name: 'Module3', title: 'My module!'}	//also modules accept the property 'title' for showing a small title on top of the module.
						]
					,	save: function()							//a custom save function which 'this' context will be the Step (a Backbone view)
						{
							return this.wizard.model.submit();
						}
					}
				]
			}
		]
	*/,
        checkoutSteps: configuredCheckoutSteps    // for new checkout steps pretty names in the configuration, user can add new names here.
,
        checkoutStepsMap: checkoutStepsMap,
        checkoutStepsName: configuredCheckoutStepsName,
        sca: { collapseElements: false }    // External Payment configuration.
                                       // You need to set the url (fragment) to redirect the customer after returns from external payment gateway.
,
        externalPayment: {
            SALESORDER: {
                // record type
                doneFragment: 'confirmation',
                failFragment: 'billing'    // for one page checkout change this value to 'opc'
            }
        }
    };
    // Phone Specific
    if (screen_width < 768) {
        _.extend(Configuration, { collapseElements: true });
    }    // Tablet Specific
    else if (screen_width >= 768 && screen_width <= 978) {
        _.extend(Configuration, {});
    }    // Desktop Specific
    else {
        _.extend(Configuration, {});
    }
    //Deep extend
    jQuery.extend(true, BaseConfiguration, Configuration);
    return BaseConfiguration;
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module GlobalViews
define('GlobalViews.Modal.View', [
    'global_views_modal.tpl',
    'Backbone.CompositeView',
    'Backbone',
    'underscore'
], function (global_views_modal_tpl, BackboneCompositeView, Backbone, _) {
    'use strict';
    // @class GlobalViews.Modal.View @extends Backbone.View
    return Backbone.View.extend({
        template: global_views_modal_tpl,
        initialize: function () {
            BackboneCompositeView.add(this);
        },
        childViews: {
            'Child.View': function () {
                return this.options.childViewIstance;
            }
        }    // @method getContext @return GlobalViews.Modal.View.Context
,
        getContext: function () {
            // @class GlobalViews.Modal.View.Context
            return {
                //@property {String} pageHeader
                pageHeader: this.options.pageHeader || ' '    //@property {Boolean} showPageHeader
,
                showPageHeader: _.isUndefined(this.options.childViewIstance.showModalPageHeader) ? !!this.options.pageHeader : this.options.childViewIstance.showModalPageHeader,
                modalDialogClass: this.options.childViewIstance.modalClass || ''
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module GlobalViews
define('GlobalViews.BackToTop.View', [
    'global_views_back_to_top.tpl',
    'Backbone',
    'jQuery'
], function (global_views_back_to_top_tpl, Backbone, jQuery) {
    'use strict';
    // @class GlobalViews.BackToTop.View @extends Backbone.View
    return Backbone.View.extend({
        template: global_views_back_to_top_tpl,
        events: { 'click [data-action="back-to-top"]': 'backToTop' }    // @method backToTop
,
        backToTop: function () {
            jQuery('html, body').animate({ scrollTop: '0px' }, 300);
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Footer
define('Footer.View', [
    'SC.Configuration',
    'GlobalViews.BackToTop.View',
    'footer.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'jQuery'
], function (Configuration, GlobalViewsBackToTopView, footer_tpl, Backbone, BackboneCompositeView, jQuery) {
    'use strict';
    // @class Footer.View @extends Backbone.View
    return Backbone.View.extend({
        template: footer_tpl,
        initialize: function (options) {
            this.application = options.application;
            BackboneCompositeView.add(this);
            //after appended to DOM, we add the footer height as the content bottom padding, so the footer doesn't go on top of the content
            //wrap it in a setTimeout because if not, calling height() can take >150 ms in slow devices - forces the browser to re-compute the layout.
            this.application.getLayout().on('afterAppendToDom', function () {
                var headerMargin = 25;
                setTimeout(function () {
                    var contentHeight = jQuery(window).innerHeight() - jQuery('#site-header')[0].offsetHeight - headerMargin - jQuery('#site-footer')[0].offsetHeight;
                    jQuery('#main-container').css('min-height', contentHeight);
                }, 10);
            });
        },
        childViews: {
            'Global.BackToTop': function () {
                return new GlobalViewsBackToTopView();
            }
        }    // @method getContext @return {Footer.View.Context}
,
        getContext: function () {
            var footerNavigationLinks = Configuration.get('footer.navigationLinks', []);
            // @class Footer.View.Context
            return {
                // @property {Boolean} showLanguages
                showFooterNavigationLinks: !!footerNavigationLinks.length,
                footerNavigationLinks: footerNavigationLinks
            };    // @class Footer.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module GlobalViews
define('GlobalViews.Breadcrumb.View', [
    'global_views_breadcrumb.tpl',
    'Backbone',
    'jQuery',
    'underscore'
], function (global_views_breadcrumb_tpl, Backbone, jQuery, _) {
    'use strict';
    // @class GlobalViews.Breadcrumb.View @extends Backbone.View
    return Backbone.View.extend({
        template: global_views_breadcrumb_tpl,
        initialize: function (options) {
            var opt_pages = options.pages;
            if (_.isUndefined(opt_pages)) {
                this.pages = [];
            } else if (_.isArray(opt_pages)) {
                this.pages = opt_pages;
            } else {
                this.pages = [opt_pages];
            }
        }    // @method getContext @return GlobalViews.Breadcrumb.View.Context
,
        getContext: function () {
            _.each(this.pages, function (page) {
                if (page['data-touchpoint']) {
                    page.hasDataTouchpoint = true;
                }
                if (page['data-hashtag']) {
                    page.hasDataHashtag = true;
                }
            });
            //@class GlobalViews.Breadcrumb.View.Context
            return {
                // @property {Array<Object>} pages
                pages: this.pages
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Notifications
define('Notifications.Order.Promocodes.View', [
    'GlobalViews.Message.View',
    'notifications_order_promocodes.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'underscore'
], function (GlobalViewsMessageView, notifications_order_promocodes, Backbone, BackboneCompositeView, _) {
    'use strict';
    //@class Notification.Order.Promocodes.View @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: notifications_order_promocodes    //@method initialize
                                          //@return {Void}
,
        initialize: function initialize() {
            BackboneCompositeView.add(this);
            this.on('afterCompositeViewRender', this.afterViewRender, this);
        }    // @property {ChildViews} childViews
,
        childViews: {
            'Promocode.Notification': function () {
                var notification;
                if (this.model.get('type') === 'FREEGIFT' && !!this.model.get('freegiftinfo')) {
                    notification = this.getFreeGiftNotification(this.model.get('freegiftinfo')[0], this.model.get('freegiftinfo')[1]);
                } else {
                    notification = this.getNotification();
                }
                if (notification && notification.message && notification.type) {
                    return new GlobalViewsMessageView({
                        message: notification.message,
                        type: notification.type,
                        closable: true
                    });
                }
            }
        }    // @method afterViewRender lets parent model know the promotion already shwoed its current notification
             // @return {Void}
,
        afterViewRender: function () {
            this.options.parentModel.trigger('promocodeNotificationShown', this.model.get('internalid'));
        }    // @method getNotification
             // @return {Notification}
,
        getNotification: function () {
            var notification = {};
            if (this.model.get('applicabilitystatus') === 'APPLIED') {
                notification.type = 'success';
                notification.message = _('Promotion <strong>$(0)</strong> is now discounting your order.').translate(this.model.get('code'));
            } else if (this.model.get('applicabilityreason') === 'CRITERIA_NOT_MET') {
                notification.type = !this.model.get('isautoapplied') ? 'warning' : 'info';
                notification.message = _('Promotion <strong>$(0)</strong> is not discounting your order. $(1)').translate(this.model.get('code'), this.model.get('errormsg'));
            } else if (this.model.get('applicabilityreason') === 'DISCARDED_BEST_OFFER') {
                notification.type = 'info';
                notification.message = _('We have chosen the best possible offer for you. Promotion <strong>$(0)</strong> is not discounting your order.').translate(this.model.get('code'));
            }
            return notification;
        }    // @method getFreeGiftNotification
             // @return {Notification}
,
        getFreeGiftNotification: function (free_gift_info_old, free_gift_info_current) {
            var gift_quantity, message_type;
            if (!free_gift_info_old) {
                gift_quantity = free_gift_info_current.added_quantity;
                message_type = 'success';
            } else if (!free_gift_info_current) {
                gift_quantity = free_gift_info_old.added_quantity;
                message_type = 'warning';
            } else {
                var qty_diff = free_gift_info_current.added_quantity - free_gift_info_old.added_quantity;
                if (qty_diff > 0) {
                    gift_quantity = qty_diff;
                    message_type = 'success';
                } else {
                    gift_quantity = qty_diff * -1;
                    message_type = 'warning';
                }
            }
            if (message_type && gift_quantity) {
                return this.setFreeGifttNotificationText(message_type, gift_quantity);
            }
        },
        setFreeGifttNotificationText: function (message_type, gift_quantity) {
            var notification = {};
            notification.type = message_type;
            if (message_type === 'success') {
                if (gift_quantity > 1) {
                    notification.message = _('Congratulations! $(0) FREE $(1) were added to your cart.').translate(gift_quantity, this.model.get('freegiftname'));
                } else {
                    notification.message = _('Congratulations! $(0) FREE $(1) was added to your cart.').translate(gift_quantity, this.model.get('freegiftname'));
                }
            } else if (message_type === 'warning') {
                var errormsg = !!this.model.get('errormsg') ? this.model.get('errormsg') : '';
                if (gift_quantity > 1) {
                    notification.message = _('$(0) $(1) were removed from your cart. $(2)').translate(gift_quantity, this.model.get('freegiftname'), errormsg);
                } else {
                    notification.message = _('$(0) $(1) was removed from your cart. $(2)').translate(gift_quantity, this.model.get('freegiftname'), errormsg);
                }
            }
            return notification;
        }    //@method getContext
             //@return {Notifications.Order.Promocodes.View.context}
,
        getContext: function getContext() {
            //@class Notifications.Order.Promocodes.View.context
            return {};    //@class Notifications.Order.Promocodes.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Notifications
define('Notifications.Order.View', [
    'Notifications.Order.Promocodes.View',
    'LiveOrder.Model',
    'notifications_order.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'jQuery',
    'underscore'
], function (NotificationsOrderPromocodesView, LiveOrderModel, notifications_order_tpl, Backbone, BackboneCompositeView, BackboneCollectionView, jQuery, _) {
    'use strict';
    // @class Notifications.Order.View @extends Backbone.View
    return Backbone.View.extend({
        template: notifications_order_tpl,
        initialize: function () {
            BackboneCompositeView.add(this);
            this.model = LiveOrderModel.getInstance();
            this.model.on('change', this.render, this);
            this.model.get('lines').on('add remove', this.render, this);
            this.model.on('promocodeNotificationShown', this.removePromocodeNotification, this);
            this.notification_shown = false;
            this.on('afterCompositeViewRender', function () {
                if (this.notification_shown) {
                    jQuery('body').animate({ scrollTop: this.$el.offset().top }, 600);
                    this.notification_shown = false;
                }
            });
        },
        removePromocodeNotification: function (promocode_id) {
            var promocode = _.findWhere(this.model.get('promocodes'), { internalid: promocode_id });
            delete promocode.notification;
        }    // @property {ChildViews} childViews
,
        childViews: {
            'Promocode.Notifications': function () {
                var promotions = _.filter(this.model.get('promocodes') || [], function (promocode) {
                    return promocode.notification === true;
                });
                if (promotions.length) {
                    this.notification_shown = true;
                    return new BackboneCollectionView({
                        collection: promotions,
                        viewsPerRow: 1,
                        childView: NotificationsOrderPromocodesView,
                        childViewOptions: { parentModel: this.model }
                    });
                }
            }
        }    // @method getContext @return Notifications.Order.View.Context
,
        getContext: function () {
            //@class Notifications.Order.View.Context
            return {};
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Notifications
define('Notifications.Profile.View', [
    'Profile.Model',
    'GlobalViews.Message.View',
    'Session',
    'notifications_profile.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'underscore'
], function (ProfileModel, GlobalViewsMessageView, Session, notifications_profile_tpl, Backbone, BackboneCompositeView, _) {
    'use strict';
    // @class Notifications.Profile.View @extends Backbone.View
    return Backbone.View.extend({
        template: notifications_profile_tpl,
        initialize: function () {
            BackboneCompositeView.add(this);
            this.model = ProfileModel.getInstance();
            if (Session.get('email_change_verification', false)) {
                this.message = {
                    text: SC.SESSION.email_change_verification === 'true' ? _('Your email has been changed successfully to <strong>').translate() + this.model.get('email') + '</strong>' : SC.SESSION.email_change_verification,
                    type: SC.SESSION.email_change_verification === 'true' ? 'success' : 'error'
                };
                delete SC.SESSION.email_change_verification;
            } else if (SC.ENVIRONMENT.email_verification_error) {
                this.message = {
                    text: _('The validation process has failed. Please login into your account and click on the validation link again.').translate(),
                    type: 'error'
                };
                delete SC.ENVIRONMENT.email_verification_error;
            } else if (SC.ENVIRONMENT.password_reset_invalid_error) {
                this.message = {
                    text: _('Your reset password link is invalid. Request a new one using the Forgot Password link.').translate(),
                    type: 'error'
                };
                delete SC.ENVIRONMENT.password_reset_invalid_error;
            } else if (SC.ENVIRONMENT.password_reset_expired_error) {
                this.message = {
                    text: _('Your reset password link has expired. Request a new one using the Forgot Password link.').translate(),
                    type: 'error'
                };
                delete SC.ENVIRONMENT.password_reset_expired_error;
            } else if (SC.ENVIRONMENT.reset_password_confirmation_email) {
                this.message = {
                    text: _('Please check your email and get instructions on how to reset your password.').translate(),
                    type: 'success'
                };
                delete SC.ENVIRONMENT.reset_password_confirmation_email;
            } else if (SC.ENVIRONMENT.updated_password_confirmation) {
                this.message = {
                    text: _('Your password has been reset.').translate(),
                    type: 'success'
                };
                delete SC.ENVIRONMENT.updated_password_confirmation;
            }
        }    // @property {ChildViews} childViews
,
        childViews: {
            'ProfileChanges.Notifications': function () {
                if (this.message) {
                    return new GlobalViewsMessageView({
                        message: this.message.text,
                        type: this.message.type,
                        closable: true
                    });
                }
            }
        }    // @method getContext @return Notifications.Order.View.Context
,
        getContext: function () {
            //@class Notifications.Order.View.Context
            return {};
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Notifications
define('Notifications.View', [
    'Notifications.Order.View',
    'Notifications.Profile.View',
    'notifications.tpl',
    'Backbone',
    'Backbone.CompositeView'
], function (NotificationsOrderView, NotificationsProfileView, notifications_tpl, Backbone, BackboneCompositeView) {
    'use strict';
    // @class Notifications.View @extends Backbone.View
    return Backbone.View.extend({
        template: notifications_tpl,
        initialize: function () {
            BackboneCompositeView.add(this);
        }    // @property {ChildViews} childViews
,
        childViews: {
            'Order.Notifications': function () {
                return new NotificationsOrderView();
            },
            'Profile.Notifications': function () {
                return new NotificationsProfileView();
            }
        }    // @method getContext @return Notifications.View.Context
,
        getContext: function () {
            //@class Notifications.View.Context
            return {};
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ApplicationSkeleton
define('ApplicationSkeleton.Layout', [
    'GlobalViews.Modal.View',
    'Header.View',
    'Footer.View',
    'Backbone.CompositeView',
    'GlobalViews.Breadcrumb.View',
    'Notifications.View',
    'Tracker',
    'Backbone',
    'underscore',
    'jQuery'
], function (GlobalViewsModalView, HeaderView, FooterView, BackboneCompositeView, GlobalViewsBreadcrumbView, NotificationsView, Tracker, Backbone, _, jQuery) {
    'use strict';
    var $current_modal_el, current_modal_view;
    // @class ApplicationSkeleton.Layout The root view of the application.
    // It is installed in a container_element HTML element that must exists in the HTML DOM (div #main)
    // Implement the concept of a currentView, this is at any time there is a MAIN view in which the use
    // case implementation is shown. When the user navigates to different application use cases the
    // currentView will change and the afterAppendView event is triggered, offering an API to Modules to
    // react when a certain use case view is shown
    // @extends Backbone.View
    return Backbone.View.extend({
        // @property {String} container_element where it will be appended
        container_element: '#main'    // @property {String} content_element where the content (views) will be appended
,
        content_element: '#content',
        events: {
            'click [data-type="post-to-touchpoint"]': 'touchpointPost',
            'click [data-action="items-expander"]': 'itemsExpander',
            'click [data-action="dropdown-expander"]': 'dropdownExpander'
        }    //@property {Array} breadcrumbPrefix
,
        breadcrumbPrefix: []    //@property {Array} breadcrumbPages
,
        breadcrumbPages: [],
        initialize: function (Application) {
            BackboneCompositeView.add(this);
            this.headerView = this.originalHeaderView = HeaderView;
            this.footerView = this.originalFooterView = FooterView;
            this.application = Application;
            this.windowWidth = jQuery(window).width();
            // @property {jQuery.Deferred} afterAppendViewPromise a promise that is resolved only if one view was shown in this layout
            this.afterAppendViewPromise = jQuery.Deferred();
            var self = this;
            this.once('afterAppendView', function () {
                self.afterAppendViewPromise.resolve();
            });
            jQuery(window).on('resize', _.throttle(function () {
                if (_.getDeviceType(self.windowWidth) === _.getDeviceType(jQuery(window).width())) {
                    return;
                }
                _.resetViewportWidth();
                self.updateHeader();
                self.updateFooter();
                self.updateLayoutSB && self.updateLayoutSB();
                self.windowWidth = jQuery(window).width();
            }, 1000));
        }    //@method getColorPalette Given a palette name it generates a Layout.ColorPalette. The returned palette can be used for any purpose.
             //@public
             //@param {String} palette_name Name of the requested palette
             //@return {Layout.ColorPalette}
,
        getColorPalette: function getColorPalette(palette_name) {
            //@class Layout.ColorPalette This class works as a dictionary, where each key is the color name (e.g. black) and each value is the color value (hexa value expressed in the configuration)
            var color_palette = {};
            //empty palette_name is not allowed
            if (!palette_name) {
                return color_palette;
            }
            _.each(this.application.getConfig('layout.colorPalette', []), function (color_item) {
                if (color_item.paletteId === palette_name) {
                    if (color_item.colorValue)
                        // if it is a color
                        {
                            color_palette[color_item.colorName] = color_item.colorValue;
                        }
                    else if (color_item.imgsrc) {
                        color_palette[color_item.colorName] = {
                            src: color_item.imgsrc,
                            height: color_item.imgheight,
                            width: color_item.imgwidth
                        };
                    }
                }
            });
            return color_palette;    // @class ApplicationSkeleton.Layout
        },
        render: function () {
            // @event beforeRender triggered before rendering this layout view
            this.trigger('beforeRender', this);
            Backbone.View.prototype.render.call(this);
            // @event afterRender triggered after rendering this layout view
            this.trigger('afterRender', this);
        }    // @method updateHeader
,
        updateHeader: function () {
            if (this.application.getConfig('siteSettings.sitetype') === 'ADVANCED') {
                this.headerViewInstance && this.headerViewInstance.render();
            }
        }    // @method updateFooter
,
        updateFooter: function () {
            if (this.application.getConfig('siteSettings.sitetype') === 'ADVANCED') {
                this.footerViewInstance && this.footerViewInstance.render();
            }
        }    //@method updateCrumbtrail Receives a collection of pages.
             //@param {Array<BreadcrumbPage>||BreadcrumbPage} pages
             //@return {Array<BreadcrumbPage>} List of all the "navigation" needed to get to the current page
,
        updateCrumbtrail: function (pages) {
            if (!_.isArray(pages)) {
                pages = [pages];
            }
            this.breadcrumbPages = _.union(this.breadcrumbPrefix, pages);
            return this.breadcrumbPages;
        }    //@method hideBreadcrumb
,
        hideBreadcrumb: function () {
            this.breadcrumbViewInstance && this.breadcrumbViewInstance.$el.empty();
        }    // @method appendToDom append this layout view to the DOM in the element pointed by property container_element
,
        appendToDom: function () {
            var self = this;
            this.afterAppendViewPromise.done(function () {
                // @event beforeAppendToDom triggered before this layout view is appended to the DOM
                self.trigger('beforeAppendToDom', self);
                jQuery(self.container_element).html(self.$el);
                // @event afterAppendToDom triggered after this layout view is appended to the DOM
                self.trigger('afterAppendToDom', self);
            });
        }    // @method getApplication
             // @return {ApplicationSkeleton} this layout's application
,
        getApplication: function () {
            return this.application;
        }    // @method touchpointPost perform a POST operation to the specified touchpoint ('post-touchpoint')
,
        touchpointPost: function (e) {
            var touchpoint = this.$(e.target).data('post-touchpoint'), touchpoints = SC.getSessionInfo('touchpoints'), target_touchpoint = (touchpoints ? touchpoints[touchpoint] : '') || '', new_url = _.fixUrl(target_touchpoint);
            _.doPost(new_url);
        }    // @method itemsExpander
,
        itemsExpander: function (e) {
            e.preventDefault();
            e.stopPropagation();
            jQuery(e.currentTarget).parent().find('[data-action="items-expander"] a i').toggleClass('icon-minus').end().find('[data-content="items-body"]').stop().slideToggle();
        }    // @method dropdownExpander
,
        dropdownExpander: function (e) {
            e.preventDefault();
            e.stopPropagation();
            jQuery(e.currentTarget).parent().find('[data-action="dropdown-expander"] a i').toggleClass('icon-chevron-up').end().find('[data-content="items-body"]').stop().slideToggle();
        }    // @method showContent use view.shoContent or layout.showContent(aView) to set the currentView
             // @param {Backbone.View} view
             // @param {Boolean} dont_scroll
,
        showContent: function showContent(view, dont_scroll) {
            return this.cancelableTriggerUnsafe('beforeAppendView', view).then(_.bind(this._showContent, this, view, dont_scroll));
        }    // @method showContent use view.showContent or layout.showContent(aView) to set the currentView
             // @param {Backbone.View} view
             // @param {Boolean} dont_scroll
,
        _showContent: function _showContent(view, dont_scroll) {
            var first_show_content = !this.currentView, current_view = this.currentView;
            if (!view.enhancedPage) {
                Tracker.getInstance().trackPageview('/' + Backbone.history.fragment);
            }
            // if the current view displays a bootstrap modal manually (without calling view.showInModal)
            // then it is necessary to clean up the modal backdrop manually here
            this.closeModal();
            if (view.inModal) {
                return view.showInModal();
            }
            // We render the layout only once, the first time showContent is called
            if (!this.rendered) {
                this.render();
                this.rendered = true;
            }
            // This line will destroy the view only if you are adding a different instance of a view
            if (current_view && current_view !== view) {
                current_view.destroy();
                if (current_view.bodyClass) {
                    this.$el.removeClass(current_view.bodyClass);
                }
            }
            // @property {Backbone.View} currentView The layout as a view can contain many child views, but there is one that is mandatory and important and is referenced by this property
            // The currentView is the one that is showing the use case  page that the user is currently being working on. While the user navigates through our
            // application the currentView will be changing.
            // {Backbone.View} the single children of the layout should have only one view, the currentView
            this.currentView = view;
            this._currentView = view;
            //update the header and footer
            this.headerView = this.currentView.getHeaderView && this.currentView.getHeaderView() ? this.currentView.getHeaderView() : this.originalHeaderView;
            this.footerView = this.currentView.getFooterView && this.currentView.getFooterView() ? this.currentView.getFooterView() : this.originalFooterView;
            if (this.headerViewInstance && !(this.headerViewInstance instanceof this.headerView) || this.footerViewInstance && !(this.footerViewInstance instanceof this.footerView)) {
                this.getChildViewInstance('Header') && this.getChildViewInstance('Header').undelegateEvents();
                this.getChildViewInstance('Footer') && this.getChildViewInstance('Footer').undelegateEvents();
                this.addChildViewInstances({
                    'Header': this.childViews.Header,
                    'Footer': this.childViews.Footer
                });
                this.render();
            }
            // update the breadcrumb
            var breadcrumb_pages = this.currentView.getBreadcrumbPages ? this.currentView.getBreadcrumbPages() : null;
            if (breadcrumb_pages && this.breadcrumbViewInstance) {
                this.breadcrumbViewInstance.pages = this.updateCrumbtrail(breadcrumb_pages || []);
                this.breadcrumbViewInstance.render();
            } else {
                this.hideBreadcrumb();
            }
            // keep the min height value to restore it later because the .empty() will mess the current scrolling.
            var minHeight;
            if (!first_show_content) {
                minHeight = this.$(this.content_element).css('min-height');
                // set the height of 'content_element' to his current height because after empty() there will be no scroll bar and the dont_scroll will not work
                this.$(this.content_element).css('min-height', this.$(this.content_element).height() + 'px');
            }
            // Empties the content first, so events don't get unbind
            this.$(this.content_element).empty();
            view.render();
            if (view.bodyClass) {
                this.$el.addClass(view.bodyClass);
            }
            //document's title
            document.title = view.title || '';
            // @event beforeAppendView
            this.trigger('beforeAppendView', view);
            this.$(this.content_element).append(view.$el);
            if (!first_show_content && minHeight) {
                this.$(this.content_element).css('min-height', minHeight);
            }
            // @event afterAppendView
            this.trigger('afterAppendView', view);
            view.isRenderedInLayout = true;
            // Sometimes we do not want to scroll top when the view is rendered
            // Eventually we might change view and dont_scroll to an option obj
            if (!dont_scroll && !first_show_content) {
                jQuery(document).scrollTop(0);
            }
            // we need to return a promise always, as show content might be async
            return jQuery.Deferred().resolveWith(this, [view]);
        }    // @method wrapModalView
             // @param {Backbone.View} view
,
        wrapModalView: function (view) {
            var $modal_body = view.$containerModal.find(['data-type="modal-body"']);
            if (view.$('.modal-body').length && $modal_body.length) {
                $modal_body.removeClass('modal-body');
            }
            return this;
        }    // @method prefixViewIds
             // @param {Backbone.View} view
             // @param {String} prefix
,
        prefixViewIds: function (view, prefix) {
            if (typeof view === 'string') {
                prefix = view;
                view = this.currentView;
            }
            if (view instanceof Backbone.View) {
                prefix = prefix || '';
                // Adding the prefix to all ids
                view.$('[id]').each(function () {
                    var el = jQuery(this);
                    if (el.parents('svg').length > 0 || !!el.data('nonprefix')) {
                        return;    // don't overwrite svg child ids & data-nonprefix="true"
                    }
                    el.attr('id', function (i, old_id) {
                        return prefix + old_id;
                    });
                });
                // Adding the prefix to all fors, so labels still work
                view.$('[for]').each(function () {
                    jQuery(this).attr('for', function (i, old_id) {
                        return prefix + old_id;
                    });
                });
            }
        }    // @method addModalListeners
             // @param {Backbone.View} view
,
        addModalListeners: function (view, current_view) {
            var self = this;
            // hidden is an even triggered by the bootstrap modal plugin
            // we obliterate anything related to the view once the modal is closed
            view.$containerModal.on('hidden.bs.modal', function () {
                self.$el.removeClass('modal-open');
                view.trigger('modal-close', view);
                current_view.destroy();
                view.$containerModal.remove();
                view.$containerModal = null;
                self.$containerModal = null;
                self.modalCurrentView = null;
                $current_modal_el = false;
                self._currentView = self.currentView;
                //After closing te modal, impose the underlying view's title
                document.title = self.currentView && self.currentView.getTitle() || '';
            });
            //Only trigger afterAppendView when finished showing the modal (has animation which causes a delay)
            view.$containerModal.on('shown.bs.modal', function () {
                if (view.focusFirstInput ? view.focusFirstInput() : true) {
                    view.$('form:first *:input[type!=hidden]:first').focus();
                }
                self.trigger('afterAppendView', view);
                view.$containerModal.modal('handleUpdate');
            });
        }    // @method getCurrentView
             // @return {Backbone.View} the current view no matter if rendered normally or in a modal.
,
        getCurrentView: function () {
            return this._currentView;
        }    // @method showInPush
             // @param {Backbone.View} view
             // @param {Object} options
,
        showInPush: function (view, options) {
            var self = this;
            options = options || {};
            if (!this.$pusher_container) {
                this.$pusher_container = jQuery('<div data-action="pushable"></div>');
                this.$el.append(this.$pusher_container);
            }
            view.$pusher_container = this.$pusher_container;
            view.render();
            this.pushCurrentView = view;
            this.$pusher_container.append(view.$el);
            this.$pusher_container.scPush();
            this.$pusher_container.trigger('open');
            this.$pusher_container.on('afterClose', function () {
                if (!options.no_destroy) {
                    if (view) {
                        view.$el.empty();
                        view.destroy();
                        self.$pusher_container.find('div:empty').remove();
                        self.pushCurrentView = null;
                    }
                }
            });
            return jQuery.Deferred().resolveWith(this, [view]);
        }    // @method closePush
,
        closePush: function removePush() {
            if (this.$pusher_container) {
                this.$pusher_container.trigger('close');
                this.$pusher_container.find('div:empty').remove();
            }
        },
        showInModal: function (view, options) {
            return this.cancelableTriggerUnsafe('beforeAppendView', view).then(_.bind(this._showInModal, this, view, options));
        }    // @method showInModal
             // @param {Backbone.View} view
             // @param {className:String,modalOptions:Object} options Optional object
             // @param {jQuery.Deferred}
,
        _showInModal: function (view, options) {
            var promise_result = jQuery.Deferred();
            options = jQuery.extend({ modalOptions: {} }, options);
            view.events = view.events || {};
            // We add the mousedown event on the 'Cancel' button to hide the modal, otherwise,
            // the validation could add a validation error and move the position of the 'Cancel' button
            // and fail to close the modal on the click event
            // Order of the events: mousedown, blur, click
            view.events['mousedown [data-dismiss="modal"]'] = function (e) {
                e.preventDefault();
            };
            // we tell the view its being shown in a Modal
            view.inModal = true;
            // we need a different variable to know if the view has already been rendered in a modal
            // this is to add the Modal container only once to the DOM
            if (!view.hasRenderedInModal) {
                var element_id = view.$el.attr('id');
                GlobalViewsModalView.prototype.attributes = {};
                GlobalViewsModalView.prototype.className = 'modal fade ' + (view.modalClass || element_id ? 'modal-' + element_id : '');
                GlobalViewsModalView.prototype.attributes.id = view.modalId || element_id ? 'modal-' + element_id : 'modal';
                current_modal_view = new GlobalViewsModalView({
                    childViewIstance: view,
                    pageHeader: view.page_header || view.title || ''
                });
                this.$containerModal = view.$containerModal = current_modal_view.$el;
                this.modalCurrentView = view;
                this._currentView = view;
                view.options.layout = this;
            }
            this.trigger('beforeAppendView', view);
            if (!view.hasRenderedInModal) {
                var self = this;
                // if there was a modal opened we wait for close it
                this.closeModal().done(function () {
                    self._showModalInDOM(view, options, current_modal_view, promise_result);
                });
            } else {
                this._renderModalView(view, current_modal_view);
                promise_result.resolveWith(this, [view]);
            }
            return promise_result;
        },
        closeModal: function () {
            var promise = jQuery.Deferred();
            if ($current_modal_el) {
                $current_modal_el.on('hidden.bs.modal', function () {
                    promise.resolve();
                });
                $current_modal_el.modal('hide');
            } else {
                promise.resolve();
            }
            return promise;
        }    //@method _renderModalView Internal method to render a view in a modal context
             //@param {Backbone.View} view
             //@param {jQuery} current_modal_view
             //@return {Void}
,
        _renderModalView: function (view, current_modal_view) {
            // Generates the HTML for the view based on its template
            // http://backbonejs.org/#View-render
            if (!view.hasRenderedInModal) {
                current_modal_view.render();
            } else {
                view.render();
            }
            this.wrapModalView(view).prefixViewIds(view, 'in-modal-');
        }    //@method _showModalInDOM Internal auxiliary method responsible for render the view and show it as a modal.
             //@param {Backbone.View} view
             //@param {Object} options
             //@param {jQuery} current_modal_view
             //@param {jQuery.Deferred} promise
             //@return {Void}
,
        _showModalInDOM: function (view, options, current_modal_view, promise) {
            this._renderModalView(view, current_modal_view);
            $current_modal_el = view.$containerModal;
            this.addModalListeners(view, current_modal_view);
            // So, now we add the wrapper modal with the view in it to the DOM - we append it to the Layout view instead of body, so modal links are managed by NavigationHelper.
            view.$containerModal.appendTo(this.el);
            // We trigger the plugin, it can be passed custom options
            // http://twitter.github.com/bootstrap/javascript.html#modals
            view.$containerModal.modal(options.modalOptions);
            //When we are in SiteBuilder all our CSS classes are wrapped up with a container (#main generally)
            //and as  bootrap add the class modal-open at the body HTML element, this makes unaccessible for boostrap selector due to the #main selector in the middle
            //In the and we need all boostrap events properly attached, so we fix it by adding this class inside the main wrapper
            this.$el.addClass('modal-open');
            if (options.className) {
                view.$containerModal.addClass(options.className);
            }
            // the view has now been rendered in a modal
            view.hasRenderedInModal = true;
            promise.resolveWith(this, [view]);
        }    // Defining the interface for this class. All modules will interact with the layout trough this methods some others may be added as well
             // @method showError
,
        showError: jQuery.noop,
        showSuccess: jQuery.noop,
        childViews: {
            'Header': function () {
                var options = { application: this.application };
                if (this.currentView && this.currentView.getHeaderViewOptions) {
                    _.extend(options, this.currentView.getHeaderViewOptions());
                }
                this.headerViewInstance = new this.headerView(options);
                return this.headerViewInstance;
            },
            'Footer': function () {
                var options = { application: this.application };
                if (this.currentView && this.currentView.getFooterViewOptions) {
                    _.extend(options, this.currentView.getFooterViewOptions());
                }
                this.footerViewInstance = new this.footerView(options);
                return this.footerViewInstance;
            },
            'Global.Breadcrumb': function () {
                this.breadcrumbViewInstance = new GlobalViewsBreadcrumbView({ pages: this.breadcrumbPages });
                return this.breadcrumbViewInstance;
            },
            'Notifications': function () {
                return new NotificationsView();
            }
        }    //@method getContext
             //@return {ApplicationSkeleton.Layout.Context}
,
        getContext: function () {
            //@class ApplicationSkeleton.Layout.Context
            return {};
        }
    });
});    //@class BreadcrumbPage
       //@property {String} text
       //@property {String} href

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module SC
define('SC.ComponentContainer', ['underscore'], function (_) {
    'use strict';
    // @function sealComponent helper method to avoid that customers overwrite the component properties
    // @param {SC.BaseComponent} component component to be sealed
    // @param {String} component_name the component name
    // @private
    function sealComponent(component, component_name) {
        try {
            _.each(component, function (value, prop) {
                Object.defineProperty(component, prop, {
                    get: function () {
                        return value;
                    },
                    set: function () {
                        throw new Error('You cannot override property ' + prop + ' of component ' + component_name);
                    }
                });
            });
        } catch (e) {
        }
        return component;
    }
    // @class SC.ComponentContainer Manager of components. Extensions can get components implementations and register new component 
    // classes. A component is referenced always by its name. Host application provides a container instance to extensions through 
    // method @?method SC.SC.ExtensionEntryPoint.mountToApp
    return {
        // @property {Object} _components All the SC.Components loaded into the current application
        // @private
        _components: {}    // @method registerComponent Allows to register a new component into the running application
              // it also seals the component, so as to not add new properties or messing up with the available
              // components APIs.
              // @param {SC.BaseComponent} component Component to be registered
              // @public @extlayer
              // @return {Void}
,
        registerComponent: function registerComponent(component) {
            if (component && component.componentName) {
                this._components[component.componentName] = sealComponent(component, component.componentName);
                return;
            }
            var error = new Error('Invalid component parameter, make sure you specify a componentName property and getProxy method');
            error.name = 'INVALID_PARAM';
            throw error;
        }    // @method getComponent Returns the requested component based on its name if there is no component with that name registered in this container
             // @public @extlayer
             // @param {String} component_name
             // @return {SC.BaseComponent|null}
,
        getComponent: function getComponent(component_name) {
            return this._components[component_name] || null;
        }
    };
});    // @class SC.ExtensionEntryPoint An extension entry point an object provided by extensions implementing the method mountToApp that the host 
       // application calls passing a @?class SS.ComponentContainer instance so the extension can get concrete Component implementations
       // (@?class SC.BaseComponent) or register new components to implement new extension points. See @?class SC.ComponentContainer
       // @method mountToApp When the host application starts, it will call this method for each activated extension, in order of activation. 
       // @param {SC.ComponentContainer} componentContainer
       // @public @extlayer

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module SC
define('SC.ComponentErrors', [], function () {
    'use strict';
    return {
        //@property {Object} notImplemented
        notImplemented: {
            // @property {String} code
            code: 'NOT_IMPLEMENTED'    // @property {String} message
,
            message: 'Not implemented.'
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module SC
define('SC.BaseComponent', [
    'SC.CancelableEvents',
    'SC.ComponentErrors',
    'Utils',
    'underscore'
], function (SCCancelableEvents, SCComponentErrors, Utils, _) {
    'use strict';
    // @class SC.BaseComponent Base abstract class for front-end components. Use method @?method SC.SC.BaseComponent.extend to build concrete components.
    // Implements helper methods for Views manipulation
    // @extends SC.CancelableEvents
    var base_component = _.extend({
        // @property {String} componentName The name which identify this kind of component. This name is used both for registering a new component and
        // getting a component implementation with @?class SC.ComponentContainer
        // @extlayer
        // @property {ApplicationSkeleton} application
        // @method extend Extends the current component to generate a child one
        // @public @extlayer
        // @param {Object} child_component Any object with properties/methods that will be used to generate the SC.Component that will be returned
        // @return {SC.BaseComponent}
        extend: function extend(child_component) {
            if (!child_component || !child_component.componentName && !this.componentName || !child_component.application) {
                return this._reportError('INVALID_PARAM', 'Invalid SC.Component. Property "componentName" and "application" are required.');
            }
            this.application = child_component.application;
            var new_component = _.extend({}, this, child_component);
            return new_component;
        }    // @method _reportError Internal method used to centrally handle error reporting
             // @private
             // @param {String} code Error code
             // @param {String} description Error description
             // @return {Error}
,
        _reportError: function _reportError(code, description) {
            var error = new Error(description);
            error.name = code;
            throw error;
        }    // @method _exposeAPIEvent Handle common code to expose private Application before and after events
             // into public Extensibility events
             // @param {String} event_name name of the private event
             // @return {jQuery.Deferred}
             // @private
,
        _exposeAPIEvent: function _exposeAPIEvent() {
            var args = Array.prototype.slice.call(arguments);
            return this.cancelableTrigger.apply(this, args);
        }    //@method _suscribeToInnerEvents subscribes to the inner events, according to the innerToOuterMap parameter, in order to trigger the outer events
             //@param {Array<String, String, Function>} innerToOuterMap Maps inner events with outer events
             //@private
,
        _suscribeToInnerEvents: function _suscribeToInnerEvents(innerToOuterMap, model) {
            var self = this;
            _.map(innerToOuterMap, function (innerToOuter) {
                var exposeInnerEvent = function exposeInnerEvent() {
                    //remove the model (first argument) and keeps the first place of the array
                    var args = Utils.deepCopy(Array.prototype.slice.call(arguments));
                    args = innerToOuter.normalize ? innerToOuter.normalize.apply(self, args) : args;
                    //prepend the event name to the arguments array
                    args = _.isArray(args) ? args : [args];
                    args.unshift(innerToOuter.outer);
                    _.each(innerToOuter.disableEvents || [], function (event_name) {
                        self.cancelableDisable(event_name);
                    });
                    _.each(innerToOuter.enableEvents || [], function (event_name) {
                        self.cancelableEnable(event_name);
                    });
                    return self._exposeAPIEvent.apply(self, args);
                };
                model.cancelableOn(innerToOuter.inner, exposeInnerEvent);
                model.on('destroy', function cancelOffInnerEvent() {
                    model.cancelableOff(innerToOuter.inner, exposeInnerEvent);
                });
            });
        }
    }, SCCancelableEvents);
    // @method on alias for @?method SC.SC.CancelableEvents.cancelableOn @extlayer @public
    base_component.on = base_component.cancelableOn;
    // @method off alias for @?method SC.SC.CancelableEvents.cancelableOff @extlayer @public
    base_component.off = base_component.cancelableOff;
    base_component.ERROR_IDENTIFIERS = SCComponentErrors;
    return base_component;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module SC
define('SC.BaseComponent.ChildViewsComponent', ['underscore'], function (_) {
    'use strict';
    var root_component_add_map = {};
    var root_component_set_map = {};
    var root_component_remove_map = {};
    // window.component = { add: root_component_add_map, set: root_component_set_map, rem: root_component_remove_map };
    return {
        _normalizeChildViews: function _normalizeChildViews(child_views) {
            _.each(child_views, function (view_name, container_name) {
                if (_.isFunction(view_name)) {
                    var childViewConstructor = view_name;
                    child_views[container_name] = {};
                    child_views[container_name][container_name] = {
                        childViewIndex: 10,
                        childViewIsExternal: true,
                        childViewConstructor: childViewConstructor
                    };
                } else {
                    _.each(view_name, function (child_view) {
                        child_view.childViewIsExternal = true;
                    });
                }
            });
            return child_views;
        },
        addChildViews: function addChildViews(component_id, child_views) {
            child_views = this._normalizeChildViews(child_views || {});
            if (!root_component_add_map[component_id]) {
                root_component_add_map[component_id] = {};
            }
            _.each(child_views, function (views, data_view) {
                if (!root_component_add_map[component_id][data_view]) {
                    root_component_add_map[component_id][data_view] = {};
                }
                _.each(views, function (generator, view_id) {
                    root_component_add_map[component_id][data_view][view_id] = generator;
                });
            });
        },
        removeChildView: function removeChildView(component_id, container_name, view_name) {
            root_component_remove_map[component_id] = root_component_remove_map[component_id] || {};
            root_component_remove_map[component_id][container_name] = root_component_remove_map[component_id][container_name] || {};
            root_component_remove_map[component_id][container_name][view_name] = true;
        },
        setChildViewIndex: function setChildViewIndex(component_id, container_name, view_name, index) {
            if (!root_component_set_map[component_id]) {
                root_component_set_map[component_id] = {};
            }
            if (!root_component_set_map[component_id][container_name]) {
                root_component_set_map[component_id][container_name] = {};
            }
            root_component_set_map[component_id][container_name][view_name] = index;
        },
        _getChildViews: function _getChildViews(map_structure, component_id, data_views) {
            if (map_structure[component_id]) {
                return _.pick(map_structure[component_id], data_views);
            }
            return {};
        },
        getModifiedChildViews: function getModifiedChildViews(component_id, data_views) {
            return {
                'addChildViews': this._getChildViews(root_component_add_map, component_id, data_views),
                'setChildViewsIndex': this._getChildViews(root_component_set_map, component_id, data_views),
                'removeChildViews': this._getChildViews(root_component_remove_map, component_id, data_views)
            };
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
	@module SC
	@class SC.BaseComponent.Plugin.RecollectDataViewSelectors

	Loads the recollectDataViewSelectors plugin that iterates through all the tags that contains data-cms in the
	template string.
*/
define('SC.BaseComponent.Plugin.RecollectDataViewSelectors', [
    'underscore',
    'SC.BaseComponent.ChildViewsComponent'
], function (_, SCBaseComponentChildViewsComponent) {
    'use strict';
    return function SCBaseComponentPluginRecollectDataViewSelectors() {
        return {
            name: 'recollectDataViewSelectors',
            priority: 10,
            execute: function (tmpl_str, view) {
                var regex = /<[^>]*(data-view)=\"([^"\s]+)\"[^>]*>/g, regexCMS = /<[^>]*(data-cms-area)=\"([^"\s]+)\"[^>]*>/g, match = regex.exec(tmpl_str), matchCMS = regexCMS.exec(tmpl_str), selectors_on_ui = [], root_component_id = view.attributes && view.attributes['data-root-component-id'] || '', component_id = view.constructor.componentId;
                while (match !== null) {
                    selectors_on_ui.push(match[2]);
                    match = regex.exec(tmpl_str);
                }
                while (matchCMS !== null) {
                    selectors_on_ui.push('cms:' + matchCMS[2]);
                    matchCMS = regexCMS.exec(tmpl_str);
                }
                var components = [
                    'Backbone.View',
                    root_component_id,
                    component_id
                ];
                if (selectors_on_ui.length > 0) {
                    _.each(components, function (component) {
                        if (component) {
                            var modifiedChildViews = SCBaseComponentChildViewsComponent.getModifiedChildViews(component, selectors_on_ui);
                            view.addChildViewInstances(modifiedChildViews.addChildViews, false);
                            _.each(modifiedChildViews.setChildViewsIndex, function (child_views, data_view) {
                                _.each(child_views, function (child_view_index, child_view_id) {
                                    view.setChildViewIndex(data_view, child_view_id, child_view_index, false);
                                });
                            });
                            _.each(modifiedChildViews.removeChildViews, function (child_views, data_view) {
                                _.each(child_views, function (value, child_view_id) {
                                    view.removeChildViewInstance(data_view, child_view_id, true);
                                });
                            });
                        }
                    });
                }
                return tmpl_str;
            }
        };
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module SC
define('SC.VisualComponent', [
    'Backbone.View.render',
    'SC.BaseComponent',
    'SC.BaseComponent.ChildViewsComponent',
    'SC.BaseComponent.Plugin.RecollectDataViewSelectors',
    'Utils',
    'underscore',
    'Backbone'
], function (BackboneView, SCBaseComponent, SCBaseComponentChildViewsComponent, SCBaseComponentPluginRecollectDataViewSelectors, Utils, _, Backbone) {
    'use strict';
    Backbone.View.postCompile.install(SCBaseComponentPluginRecollectDataViewSelectors());
    // @class SC.BaseComponent Base abstract class for front-end components. Use method @?method SC.SC.BaseComponent.extend to build concrete components.
    // Implements helper methods for Views manipulation
    // @extends SC.CancelableEvents
    var visual_component = _.extend({}, SCBaseComponent, {
        // @property {String} componentName The name which identify this kind of component. This name is used both for registering a new component and
        // getting a component implementation with @?class SC.ComponentContainer
        // @extlayer
        // @property {ApplicationSkeleton} application
        // @method extend Extends the current component to generate a child one
        // @public @extlayer
        // @param {Object} child_component Any object with properties/methods that will be used to generate the SC.Component that will be returned
        // @return {SC.BaseComponent}
        extend: function extend(child_component) {
            if (!child_component || !child_component.componentName && !this.componentName || !child_component.application) {
                return this._reportError('INVALID_PARAM', 'Invalid SC.Component. Property "componentName" and "application" are required.');
            }
            this.application = child_component.application;
            var new_component = _.extend({}, this, child_component);
            new_component.application.getLayout().cancelableOn('beforeAppendView', _.bind(new_component._onApplicationBeforeView, new_component));
            new_component.application.getLayout().on('afterAppendView', _.bind(new_component._onApplicationAfterAppendView, new_component));
            return new_component;
        }    // @method _onApplicationBeforeView Internal method used to automatically notify when views of the current component are about to be shown (BEFORE append view)
             // @private
             // @param {Backbone.View} view The view that will be shown
             // @return {jQuery.Deferred|Void}
,
        _onApplicationBeforeView: function _onApplicationBeforeView(view) {
            if (this._isViewFromComponent(view, true)) {
                try {
                    var self = this;
                    this.viewToBeRendered = view;
                    //@event {Void} showContent Trigger after a PDP is rendered.
                    //@public
                    return this.cancelableTrigger('beforeShowContent', this._getViewIdentifier(view)).always(function () {
                        self.viewToBeRendered = null;
                    });
                } catch (e) {
                    this.viewToBeRendered = null;
                    throw e;
                }
            }
        }    // @method _onApplicationAfterAppendView Internal method used to automatically notify when views of the current component where shown (AFTER append view)
             // @private
             // @param {Backbone.View} view The view that was shown
             // @return {Void}
,
        _onApplicationAfterAppendView: function _onApplicationAfterAppendView(view) {
            if (this._isViewFromComponent(view, true)) {
                this.viewToBeRendered = null;
                //@event {Void} afterShowContent Trigger after a PDP is rendered.
                //@public
                this.cancelableTrigger('afterShowContent', this._getViewIdentifier(view));
            }
        }    // @method _getViewIdentifier Given a view that belongs to the current component, returns the "type"/"kind" of view.
             // This is used to determine what view among all the view of the current component is being shown
             // @param {Backbone.View} view
             // @return {String}
             // @private
,
        _getViewIdentifier: function _getViewIdentifier() {
            return 'CURRENT_VIEW';
        }    // @method _isViewFromComponent Indicate if the passed-in the View is a View of the current component.
             // The aim of this method is to be overwritten
             // @private
             // @param {Backbone.View} view Any view of the system
             // @param {Boolean} is_instance Indicate if the passed in view is an instance or a constructor function.
             // @return {Boolean} True in case the passed in View is a view of the current Component, false otherwise
,
        _isViewFromComponent: function _isViewFromComponent() {
            return false;
        }    // @method setChildViewIndex Change the position of a Child View inside a container
             // @public @extlayer
             // @param {String} view_id The identifier of the view, of the current component, that will have the Child View to change the index
             // @param {String} placeholder_selector Identifier of the location where the view is located inside the specified View (view_id)
             // @param {String} view_name Identifier of an specific view into the placeholder
             // @param {Number} index The new index to position the Child View
             // @return {null} null if everything works as expected. An exception will be thrown otherwise.
,
        setChildViewIndex: function setChildViewIndex(view_id, placeholder_selector, view_name, index) {
            this._setChildViewIndex(view_id, placeholder_selector, view_name, index);
        },
        _setChildViewIndex: function _setChildViewIndex(view_id, placeholder_selector, view_name, index) {
            var view;
            try {
                view = Utils.requireModules(view_id);
            } catch (e) {
                return this._reportError('INVALID_PARAM', 'The specified view_id is not valid for the current component.');
            }
            if (view && _.isFunction(view.setChildViewIndex) && this._isViewFromComponent(view, false)) {
                SCBaseComponentChildViewsComponent.setChildViewIndex(view_id, placeholder_selector, view_name, index);
            }
        },
        _getDefaultView: function _getDefaultView() {
            if (this.DEFAULT_VIEW) {
                return this.DEFAULT_VIEW;
            } else {
                return this._reportError('UNDEFINED_DEFAULTVIEW', 'The "DEFAULT_VIEW" was not defined in the Component');
            }
        }    // @method addChildView Add a child view in the data-view 'data_view' passed as parameter in the default view of the component
,
        addChildView: function addChildView(data_view, view_constructor) {
            var generator = {}, view_id = _.uniqueId('view');
            generator[data_view] = {};
            generator[data_view][view_id] = { childViewConstructor: view_constructor };
            this.addChildViews(this._getDefaultView(), generator);
            return view_id;
        }    // Add a new contextData to the view of the component
             // {String} (optional) view_id The id of the view to add the new contextData
             // {String} name The name of the new contextData
             // {Function} func The function that will called when requesting the new contextData
,
        addContextData: function (view_id, name, func) {
            if (arguments.length === 2) {
                func = name;
                name = view_id;
                view_id = this._getDefaultView();
            }
            if (!_.isString(name)) {
                this._reportError('INVALID_PARAM', 'The specified name is not valid.');
            }
            if (!_.isFunction(func)) {
                this._reportError('INVALID_PARAM', 'The specified function is not valid.');
            }
            var view = Utils.requireModules(view_id);
            if (view) {
                view.contextData = view.contextData || {};
                view.contextData[name] = func;
            } else {
                this._reportError('INVALID_PARAM', 'The specified view_id is not valid for the current component.');
            }
        }    // @method addChildViews Adds a child view/child views given by the child_views parameter into the specified view of the current component
             // @public @extlayer
             // @param {String} view_id The identifier of the view, of the current component, that will be extended with an extra/s child view/s
             // @param {ChildViews} child_views Identifier of the location where the new view will be located inside the specified View (view_id)
             // @return {null} null if everything works as expected. An exception will be thrown otherwise.
,
        addChildViews: function addChildViews(view_id, child_views) {
            return this._addChildViews(view_id, child_views);
        },
        _addChildViews: function _addChildViews(view_id, child_views) {
            var view;
            try {
                view = Utils.requireModules(view_id);
            } catch (error) {
                return this._reportError('INVALID_PARAM', 'The specified view_id is not valid for the current component or the view_constructor is not a function.');
            }
            if (view && _.isFunction(view.addChildViews) && this._isViewFromComponent(view, false)) {
                view.componentId = view_id;
                SCBaseComponentChildViewsComponent.addChildViews(view_id, child_views);
            }
        }    // @method removeChildView Removes a child view for a given view id
             // @public @extlayer
             // @param {String} view_id The identifier of the view, of the current component, that will be extended with an extra child view
             // @param {String} placeholder_selector Identifier of the location where the new view will be located inside the specified View (view_id)
             // @param {string} view_name Identifier of an specific view into the placeholder
             // @return {null} null if everything works as expected. An exception will be thrown otherwise.
,
        removeChildView: function removeChildView(view_id, placeholder_selector, view_name)
            // If removeChildView is called with only 1 parameter, it will be the placeholder_selector only, and it will remove it from the default_view
            {
                if (arguments.length < 1 || arguments.length > 3) {
                    return this._reportError('INVALID_PARAM_COUNT', 'Incorrect number of parameters');
                } else if (arguments.length === 2) {
                    view_name = placeholder_selector;
                    placeholder_selector = view_id;
                    view_id = this._getDefaultView();
                } else if (arguments.length === 1) {
                    view_name = view_id;
                    placeholder_selector = view_id;
                    view_id = this._getDefaultView();
                }
                this._removeChildView(view_id, placeholder_selector, view_name);
            },
        _removeChildView: function removeChildView(view_id, placeholder_selector, view_name) {
            var view;
            try {
                view = Utils.requireModules(view_id);
            } catch (e) {
                return this._reportError('INVALID_PARAM', 'The specified view_id is not valid for the current component.');
            }
            if (view && _.isFunction(view.removeChildView) && this._isViewFromComponent(view, false)) {
                view_name = view_name || placeholder_selector;
                SCBaseComponentChildViewsComponent.removeChildView(view_id, placeholder_selector, view_name);
            }
        }    // @method addToViewContextDefinition Adds an extra property to the UI context of a view id to extend the interaction with its template
             // @public @extlayer
             // @param {String} view_id The identifier of the view, of the current component, that will have its context extended.
             // @param {String} property_name Name of the new property to be added
             // @param {String} type Name of the type of the result of the callback (function that generates the value of the new property)
             // @param {Function} callback Function in charge of generating the value for the new property.
             // @return {null} null if everything works as expected. An exception will be thrown otherwise.
,
        addToViewContextDefinition: function addToViewContextDefinition(view_id, property_name, type, callback) {
            var target_view = Utils.requireModules(view_id);
            if (target_view && _.isFunction(target_view.addExtraContextProperty) && _.isFunction(callback) && this._isViewFromComponent(target_view, false)) {
                target_view.addExtraContextProperty(property_name, type, callback);
            } else {
                return this._reportError('INVALID_PARAM', 'The specified view_id (' + view_id + ') is not valid for the current component or the callback is not a function.');
            }
        }    // @method removeToViewContextDefinition Removes an extra property to the UI context of a view.
             // @public @extlayer
             // @param {String} view_id The identifier of the view, of the current component, that will have its context extended.
             // @param {String} property_name Name of the new property to be added
             // @return {null} null if everything works as expected. An exception will be thrown otherwise.
,
        removeToViewContextDefinition: function removeToViewContextDefinition(view_id, property_name) {
            var target_view = Utils.requireModules(view_id);
            if (target_view && _.isFunction(target_view.removeExtraContextProperty) && this._isViewFromComponent(target_view, false)) {
                target_view.removeExtraContextProperty(property_name);
            } else {
                return this._reportError('INVALID_PARAM', 'The specified view_id (' + view_id + ') is not valid for the current component or operation.');
            }
        }    // @method addToViewEventsDefinition Allows to add an extra event handler over a particular view for the given event selector
             // @public @extlayer
             // @param {String} view_id The identifier of the view, of the current component, that will be extended with an extra event handler.
             // @param {String} event_selector
             // @param {Function} callback Event handler function called when the specified event occurs
             // @return {Void}
,
        addToViewEventsDefinition: function addToViewEventsDefinition(view_id, event_selector, callback) {
            var target_view = Utils.requireModules(view_id);
            if (!target_view || !_.isFunction(target_view.addExtraEventHandler) || !this._isViewFromComponent(target_view, false) || !_.isFunction(callback)) {
                return this._reportError('INVALID_PARAM', 'The specified view_id (' + view_id + ') is not valid for the current component or operation, or the callback parameter is not a function.');
            } else {
                target_view.addExtraEventHandler(event_selector, callback);
            }
        }    // @method removeToViewEventsDefinition Allows to remove and an extra event handler added previously.
             // @public @extlayer
             // @param {String} view_id The identifier of the view, of the current component.
             // @param {String} event_selector
             // @return {Void}
,
        removeToViewEventsDefinition: function removeToViewEventsDefinition(view_id, event_selector) {
            var target_view = Utils.requireModules(view_id);
            if (!target_view || !_.isFunction(target_view.addExtraEventHandler) || !this._isViewFromComponent(target_view, false)) {
                return this._reportError('INVALID_PARAM', 'The specified view_id (' + view_id + ') is not valid for the current component or operation, or the callback parameter is not a function.');
            } else {
                target_view.removeExtraEventHandler(event_selector);
            }
        }
    });
    return visual_component;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*jshint unused:false*/
// @module ApplicationSkeleton
define('SC.LayoutComponent', [
    'SC.VisualComponent',
    'underscore',
    'jQuery'
], function (SCVisualComponent, _, jQuery) {
    'use strict';
    // @class LayoutComponent Allow users to manipulate views composition, bindings, events, template context, current view, exposing
    // interesting moments as events regarding navigation and application life cycle.
    // @extends SC.BaseComponent @public @extlayer
    return function LayoutComponentGenerator(application) {
        var privateComponent = SCVisualComponent.extend({
            componentName: 'Layout',
            application: application,
            ALL_VIEWS: 'Backbone.View',
            DEFAULT_VIEW: 'Backbone.View',
            _isViewFromComponent: function _isViewFromComponent() {
                return true;
            },
            _getViewIdentifier: function _getViewIdentifier(view) {
                return view && view.attributes && view.attributes.id;
            }    // @method addChildView Add a child view in the data-view 'data_view' passed as parameter in the default view of the component
,
            addChildView: function addChildView(data_view, view_constructor) {
                var generator = {}, view_id = _.uniqueId('view');
                generator[data_view] = {};
                generator[data_view][view_id] = { childViewConstructor: view_constructor };
                this.addChildViews(this.ALL_VIEWS, generator);
                return view_id;
            },
            showContent: function showContent(view, options) {
                try {
                    if (view) {
                        if (options.showInModal) {
                            return this.application.getLayout().showInModal(view, options.options);
                        } else {
                            return this.application.getLayout().showContent(view, options.dontScroll);
                        }
                    } else {
                        this._reportError('INVALID_PARAM', 'Missing "view" parameter');
                    }
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            }
        });
        return privateComponent;
    };
});    // @class View
       // A view is a visual unit which responsibility is to show a model instance in the DOM, event binding, view composition, etc.
       // IN SuiteCommerce, Views are implemented with [Backbonejs Backbone.View](http://backbonejs.org/#View). *View* here is just
       // a name to hide implementation specific details.
       // The applicaiotn's layout have a *currentView* that implements a main feature and usually correspond to a stateless url.
       // @extlayer
       // @class Backbone.View SuiteCommerce BackboneViews implement a View so if your extension implements a Backbone.View you can pass
       // such an instance to, for example, @?method setCurrentView @extends View. See [Backbonejs Backbone.View](http://backbonejs.org/#View)
       // @extlayer

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// console.js
// ----------------------
// Defines console for IE.
// Used to prevent the application to stop working in IE 
define('Console.Polyfill', function () {
    'use strict';
    // verify if there not console
    if (typeof window.console === 'undefined') {
        window.console = {};
        var i = 0    // defining default function
, noop = function () {
            }    // defining methods names for console.
, methods = [
                'assert',
                'error',
                'clear',
                'count',
                'debug',
                'dir',
                'dirxml',
                'exception',
                'group',
                'groupCollapsed',
                'groupEnd',
                'info',
                'log',
                'profile',
                'profileEnd',
                'table',
                'time',
                'timeEnd',
                'trace',
                'warn'
            ];
        // adding all methods
        for (; i < methods.length; i++) {
            window.console[methods[i]] = noop;
        }
    }
    // adding memory object
    if (typeof window.console.memory === 'undefined') {
        window.console.memory = {};
    }
});
//  json2.js
//  2016-10-28
//  Public Domain.
//  NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.
//  See http://www.JSON.org/js.html
//  This code should be minified before deployment.
//  See http://javascript.crockford.com/jsmin.html
//  USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO
//  NOT CONTROL.
//  This file creates a global JSON object containing two methods: stringify
//  and parse. This file provides the ES5 JSON capability to ES3 systems.
//  If a project might run on IE8 or earlier, then this file should be included.
//  This file does nothing on ES5 systems.
//      JSON.stringify(value, replacer, space)
//          value       any JavaScript value, usually an object or array.
//          replacer    an optional parameter that determines how object
//                      values are stringified for objects. It can be a
//                      function or an array of strings.
//          space       an optional parameter that specifies the indentation
//                      of nested structures. If it is omitted, the text will
//                      be packed without extra whitespace. If it is a number,
//                      it will specify the number of spaces to indent at each
//                      level. If it is a string (such as "\t" or "&nbsp;"),
//                      it contains the characters used to indent at each level.
//          This method produces a JSON text from a JavaScript value.
//          When an object value is found, if the object contains a toJSON
//          method, its toJSON method will be called and the result will be
//          stringified. A toJSON method does not serialize: it returns the
//          value represented by the name/value pair that should be serialized,
//          or undefined if nothing should be serialized. The toJSON method
//          will be passed the key associated with the value, and this will be
//          bound to the value.
//          For example, this would serialize Dates as ISO strings.
//              Date.prototype.toJSON = function (key) {
//                  function f(n) {
//                      // Format integers to have at least two digits.
//                      return (n < 10)
//                          ? "0" + n
//                          : n;
//                  }
//                  return this.getUTCFullYear()   + "-" +
//                       f(this.getUTCMonth() + 1) + "-" +
//                       f(this.getUTCDate())      + "T" +
//                       f(this.getUTCHours())     + ":" +
//                       f(this.getUTCMinutes())   + ":" +
//                       f(this.getUTCSeconds())   + "Z";
//              };
//          You can provide an optional replacer method. It will be passed the
//          key and value of each member, with this bound to the containing
//          object. The value that is returned from your method will be
//          serialized. If your method returns undefined, then the member will
//          be excluded from the serialization.
//          If the replacer parameter is an array of strings, then it will be
//          used to select the members to be serialized. It filters the results
//          such that only members with keys listed in the replacer array are
//          stringified.
//          Values that do not have JSON representations, such as undefined or
//          functions, will not be serialized. Such values in objects will be
//          dropped; in arrays they will be replaced with null. You can use
//          a replacer function to replace those with JSON values.
//          JSON.stringify(undefined) returns undefined.
//          The optional space parameter produces a stringification of the
//          value that is filled with line breaks and indentation to make it
//          easier to read.
//          If the space parameter is a non-empty string, then that string will
//          be used for indentation. If the space parameter is a number, then
//          the indentation will be that many spaces.
//          Example:
//          text = JSON.stringify(["e", {pluribus: "unum"}]);
//          // text is '["e",{"pluribus":"unum"}]'
//          text = JSON.stringify(["e", {pluribus: "unum"}], null, "\t");
//          // text is '[\n\t"e",\n\t{\n\t\t"pluribus": "unum"\n\t}\n]'
//          text = JSON.stringify([new Date()], function (key, value) {
//              return this[key] instanceof Date
//                  ? "Date(" + this[key] + ")"
//                  : value;
//          });
//          // text is '["Date(---current time---)"]'
//      JSON.parse(text, reviver)
//          This method parses a JSON text to produce an object or array.
//          It can throw a SyntaxError exception.
//          The optional reviver parameter is a function that can filter and
//          transform the results. It receives each of the keys and values,
//          and its return value is used instead of the original value.
//          If it returns what it received, then the structure is not modified.
//          If it returns undefined then the member is deleted.
//          Example:
//          // Parse the text. Values that look like ISO date strings will
//          // be converted to Date objects.
//          myData = JSON.parse(text, function (key, value) {
//              var a;
//              if (typeof value === "string") {
//                  a =
//   /^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(value);
//                  if (a) {
//                      return new Date(Date.UTC(+a[1], +a[2] - 1, +a[3], +a[4],
//                          +a[5], +a[6]));
//                  }
//              }
//              return value;
//          });
//          myData = JSON.parse('["Date(09/09/2001)"]', function (key, value) {
//              var d;
//              if (typeof value === "string" &&
//                      value.slice(0, 5) === "Date(" &&
//                      value.slice(-1) === ")") {
//                  d = new Date(value.slice(5, -1));
//                  if (d) {
//                      return d;
//                  }
//              }
//              return value;
//          });
//  This is a reference implementation. You are free to copy, modify, or
//  redistribute.
/*jslint
    eval, for, this
*/
/*property
    JSON, apply, call, charCodeAt, getUTCDate, getUTCFullYear, getUTCHours,
    getUTCMinutes, getUTCMonth, getUTCSeconds, hasOwnProperty, join,
    lastIndex, length, parse, prototype, push, replace, slice, stringify,
    test, toJSON, toString, valueOf
*/
// Create a JSON object only if one does not already exist. We create the
// methods in a closure to avoid creating global variables.
define('json2', [], function () {
    if (typeof JSON !== 'object') {
        JSON = {};
    }
    (function () {
        'use strict';
        var rx_one = /^[\],:{}\s]*$/;
        var rx_two = /\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;
        var rx_three = /"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;
        var rx_four = /(?:^|:|,)(?:\s*\[)+/g;
        var rx_escapable = /[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
        var rx_dangerous = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
        function f(n) {
            // Format integers to have at least two digits.
            return n < 10 ? '0' + n : n;
        }
        function this_value() {
            return this.valueOf();
        }
        if (typeof Date.prototype.toJSON !== 'function') {
            Date.prototype.toJSON = function () {
                return isFinite(this.valueOf()) ? this.getUTCFullYear() + '-' + f(this.getUTCMonth() + 1) + '-' + f(this.getUTCDate()) + 'T' + f(this.getUTCHours()) + ':' + f(this.getUTCMinutes()) + ':' + f(this.getUTCSeconds()) + 'Z' : null;
            };
            Boolean.prototype.toJSON = this_value;
            Number.prototype.toJSON = this_value;
            String.prototype.toJSON = this_value;
        }
        var gap;
        var indent;
        var meta;
        var rep;
        function quote(string) {
            // If the string contains no control characters, no quote characters, and no
            // backslash characters, then we can safely slap some quotes around it.
            // Otherwise we must also replace the offending characters with safe escape
            // sequences.
            rx_escapable.lastIndex = 0;
            return rx_escapable.test(string) ? '"' + string.replace(rx_escapable, function (a) {
                var c = meta[a];
                return typeof c === 'string' ? c : '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
            }) + '"' : '"' + string + '"';
        }
        function str(key, holder) {
            // Produce a string from holder[key].
            var i;
            // The loop counter.
            var k;
            // The member key.
            var v;
            // The member value.
            var length;
            var mind = gap;
            var partial;
            var value = holder[key];
            // If the value has a toJSON method, call it to obtain a replacement value.
            if (value && typeof value === 'object' && typeof value.toJSON === 'function') {
                value = value.toJSON(key);
            }
            // If we were called with a replacer function, then call the replacer to
            // obtain a replacement value.
            if (typeof rep === 'function') {
                value = rep.call(holder, key, value);
            }
            // What happens next depends on the value's type.
            switch (typeof value) {
            case 'string':
                return quote(value);
            case 'number':
                // JSON numbers must be finite. Encode non-finite numbers as null.
                return isFinite(value) ? String(value) : 'null';
            case 'boolean':
            case 'null':
                // If the value is a boolean or null, convert it to a string. Note:
                // typeof null does not produce "null". The case is included here in
                // the remote chance that this gets fixed someday.
                return String(value);
            // If the type is "object", we might be dealing with an object or an array or
            // null.
            case 'object':
                // Due to a specification blunder in ECMAScript, typeof null is "object",
                // so watch out for that case.
                if (!value) {
                    return 'null';
                }
                // Make an array to hold the partial results of stringifying this object value.
                gap += indent;
                partial = [];
                // Is the value an array?
                if (Object.prototype.toString.apply(value) === '[object Array]') {
                    // The value is an array. Stringify every element. Use null as a placeholder
                    // for non-JSON values.
                    length = value.length;
                    for (i = 0; i < length; i += 1) {
                        partial[i] = str(i, value) || 'null';
                    }
                    // Join all of the elements together, separated with commas, and wrap them in
                    // brackets.
                    v = partial.length === 0 ? '[]' : gap ? '[\n' + gap + partial.join(',\n' + gap) + '\n' + mind + ']' : '[' + partial.join(',') + ']';
                    gap = mind;
                    return v;
                }
                // If the replacer is an array, use it to select the members to be stringified.
                if (rep && typeof rep === 'object') {
                    length = rep.length;
                    for (i = 0; i < length; i += 1) {
                        if (typeof rep[i] === 'string') {
                            k = rep[i];
                            v = str(k, value);
                            if (v) {
                                partial.push(quote(k) + (gap ? ': ' : ':') + v);
                            }
                        }
                    }
                } else {
                    // Otherwise, iterate through all of the keys in the object.
                    for (k in value) {
                        if (Object.prototype.hasOwnProperty.call(value, k)) {
                            v = str(k, value);
                            if (v) {
                                partial.push(quote(k) + (gap ? ': ' : ':') + v);
                            }
                        }
                    }
                }
                // Join all of the member texts together, separated with commas,
                // and wrap them in braces.
                v = partial.length === 0 ? '{}' : gap ? '{\n' + gap + partial.join(',\n' + gap) + '\n' + mind + '}' : '{' + partial.join(',') + '}';
                gap = mind;
                return v;
            }
        }
        // If the JSON object does not yet have a stringify method, give it one.
        if (typeof JSON.stringify !== 'function') {
            meta = {
                // table of character substitutions
                '\b': '\\b',
                '\t': '\\t',
                '\n': '\\n',
                '\f': '\\f',
                '\r': '\\r',
                '"': '\\"',
                '\\': '\\\\'
            };
            JSON.stringify = function (value, replacer, space) {
                // The stringify method takes a value and an optional replacer, and an optional
                // space parameter, and returns a JSON text. The replacer can be a function
                // that can replace values, or an array of strings that will select the keys.
                // A default replacer method can be provided. Use of the space parameter can
                // produce text that is more easily readable.
                var i;
                gap = '';
                indent = '';
                // If the space parameter is a number, make an indent string containing that
                // many spaces.
                if (typeof space === 'number') {
                    for (i = 0; i < space; i += 1) {
                        indent += ' ';
                    }    // If the space parameter is a string, it will be used as the indent string.
                } else if (typeof space === 'string') {
                    indent = space;
                }
                // If there is a replacer, it must be a function or an array.
                // Otherwise, throw an error.
                rep = replacer;
                if (replacer && typeof replacer !== 'function' && (typeof replacer !== 'object' || typeof replacer.length !== 'number')) {
                    throw new Error('JSON.stringify');
                }
                // Make a fake root object containing our value under the key of "".
                // Return the result of stringifying the value.
                return str('', { '': value });
            };
        }
        // If the JSON object does not yet have a parse method, give it one.
        if (typeof JSON.parse !== 'function') {
            JSON.parse = function (text, reviver) {
                // The parse method takes a text and an optional reviver function, and returns
                // a JavaScript value if the text is a valid JSON text.
                var j;
                function walk(holder, key) {
                    // The walk method is used to recursively walk the resulting structure so
                    // that modifications can be made.
                    var k;
                    var v;
                    var value = holder[key];
                    if (value && typeof value === 'object') {
                        for (k in value) {
                            if (Object.prototype.hasOwnProperty.call(value, k)) {
                                v = walk(value, k);
                                if (v !== undefined) {
                                    value[k] = v;
                                } else {
                                    delete value[k];
                                }
                            }
                        }
                    }
                    return reviver.call(holder, key, value);
                }
                // Parsing happens in four stages. In the first stage, we replace certain
                // Unicode characters with escape sequences. JavaScript handles many characters
                // incorrectly, either silently deleting them, or treating them as line endings.
                text = String(text);
                rx_dangerous.lastIndex = 0;
                if (rx_dangerous.test(text)) {
                    text = text.replace(rx_dangerous, function (a) {
                        return '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
                    });
                }
                // In the second stage, we run the text against regular expressions that look
                // for non-JSON patterns. We are especially concerned with "()" and "new"
                // because they can cause invocation, and "=" because it can cause mutation.
                // But just to be safe, we want to reject all unexpected forms.
                // We split the second stage into 4 regexp operations in order to work around
                // crippling inefficiencies in IE's and Safari's regexp engines. First we
                // replace the JSON backslash pairs with "@" (a non-JSON character). Second, we
                // replace all simple value tokens with "]" characters. Third, we delete all
                // open brackets that follow a colon or comma or that begin the text. Finally,
                // we look to see that the remaining characters are only whitespace or "]" or
                // "," or ":" or "{" or "}". If that is so, then the text is safe for eval.
                if (rx_one.test(text.replace(rx_two, '@').replace(rx_three, ']').replace(rx_four, ''))) {
                    // In the third stage we use the eval function to compile the text into a
                    // JavaScript structure. The "{" operator is subject to a syntactic ambiguity
                    // in JavaScript: it can begin a block or an object literal. We wrap the text
                    // in parens to eliminate the ambiguity.
                    j = eval('(' + text + ')');
                    // In the optional fourth stage, we recursively walk the new structure, passing
                    // each name/value pair to a reviver function for possible transformation.
                    return typeof reviver === 'function' ? walk({ '': j }, '') : j;
                }
                // If the text is not JSON parseable, then a SyntaxError is thrown.
                throw new SyntaxError('JSON.parse');
            };
        }
    }());
    return JSON;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ApplicationSkeleton
// Defines the top level components of an application like the name, layout, or the start function
define('ApplicationSkeleton', [
    'ApplicationSkeleton.Layout',
    'SC.ComponentContainer',
    'SC.LayoutComponent',
    'underscore',
    'Backbone',
    'Utils',
    'Console.Polyfill',
    'json2'
], function (Layout, SCComponentContainer, LayoutComponent, _, Backbone, Utils) {
    'use strict';
    // @class ApplicationSkeleton Defines the top level components of an application like the name, layout, or the start function
    // @extends Backbone.Events
    // @constructor Enforces new object to be created even if you do ApplicationSkeleton() (without new) @param {String} name
    function ApplicationSkeleton(name) {
        if (!(this instanceof ApplicationSkeleton)) {
            return new ApplicationSkeleton();
        }
        // @property {SCA.Configuration} Application Default settings
        this.Configuration = {};
        // @property {String} name the name of this application instance
        this.name = name;
        // @property {Array<Any>} _modulesMountToAppResult stores the results of each modules mountToApp method call
        // @private
        this._modulesMountToAppResult = [];
    }
    // @method resizeImage Wraps the Utils.resizeImage and passes in the settings it needs
    // @param {String} url
    // @param {String} size
    ApplicationSkeleton.prototype.resizeImage = function (url, size) {
        url = url || _.getThemeAbsoluteUrlOfNonManagedResources('img/no_image_available.jpeg', this.getConfig('imageNotAvailable'));
        var mapped_size = this.getConfig('imageSizeMapping.' + size, size);
        return Utils.resizeImage(this.getConfig('siteSettings.imagesizes', []), url, mapped_size);
    };
    // @property {ApplicationSkeleton.Layout} Layout
    // This View will be created and added to the dom as soon as the app starts.
    // All module's views will get into the dom through this view by calling either showContent, showContent
    ApplicationSkeleton.prototype.Layout = Layout;
    // @method getLayout @returns {ApplicationSkeleton.Layout}
    ApplicationSkeleton.prototype.getLayout = function getLayout() {
        this._layoutInstance = this._layoutInstance || new this.Layout(this);
        return this._layoutInstance;
    };
    // @method getConfig
    // @returns {Any} the configuration object of the aplication
    // if a path is applied, it returns that attribute of the config
    // if nothing is found, it returns the default value
    // @param {String} path
    // @param {String} default_value
    ApplicationSkeleton.prototype.getConfig = function getConfig(path, default_value) {
        return Utils.getPathFromObject(this.Configuration, path, default_value);
    };
    // @method start starts this application by mounting configured modules and triggering events 'afterModulesLoaded' and 'afterStart'
    // @param {Array<SubClassOf<ApplicationModule>>}
    // @param {Array<SubClassOf<ApplicationModule>>} modules
    // @param {Function} done_fn the handler to be called once the application finish starting
    ApplicationSkeleton.prototype.start = function start(modules, done_fn) {
        // @event beforeStart triggered before loading modules so users have a chance to include new modules at this point.
        this.trigger('beforeStart', self);
        var self = this;
        // @property {Array<SubClassOf<ApplicationModule>>} modules We set the modules to the application the keys are the modules_list (names)
        // and the values are the loaded modules returned in the arguments by require.js
        self.modules = modules;
        var mount_to_app_result = {};
        this.registerComponent(LayoutComponent(this));
        // we mount each module to our application
        _.each(self.modules, function (module) {
            if (module && _.isFunction(module.mountToApp)) {
                mount_to_app_result = module.mountToApp(self);
                if (mount_to_app_result && mount_to_app_result.componentName) {
                    self.registerComponent(mount_to_app_result);
                } else {
                    self._modulesMountToAppResult.push(mount_to_app_result);
                }
            }
        });
        // This checks if you have registered modules
        if (!Backbone.history) {
            throw new Error('No Backbone.Router has been initialized (Hint: Are your modules properly set?).');
        }
        // @event afterModulesLoaded triggered after all modules have been loaded
        self.trigger('afterModulesLoaded', self);
        done_fn && _.isFunction(done_fn) && done_fn(self);
        // @event afterStart triggered after the application finish starting and after the start() callback is called.
        self.trigger('afterStart', self);
    };
    // We allow ApplicationSkeleton to listen and trigger custom events
    // http://backbonejs.org/#Events
    _.extend(ApplicationSkeleton.prototype, Backbone.Events, SCComponentContainer);
    return ApplicationSkeleton;
});    // @class ApplicationModule An Application is mainly composed by modules, and those can be mounted to an application
       // instance by implementing a mountToApp it is the entry point of an application module. When the application start() it
       // will mount all its configured modules using that method.
       // @method mountToApp A module mounts itself in a given application instance, for example, initialize some Backbone.Routers
       // @param {ApplicationSkeleton}
       // @class Dictionary This class is used when we define a key/value pair (hashtable),
       // the latter being a function. For example: ChildViews

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('Application', ['ApplicationSkeleton'], function (ApplicationSkeleton) {
    'use strict';
    // Application Creation:
    // Applications will provide by default: Layout (So your views can talk to)
    // and a Router (so you can extend them with some nice defaults)
    // If you like to create extensions to the Skeleton you should extend SC.ApplicationSkeleton
    SC._applications = {};
    SC.Application = function (application_name) {
        SC._applications[application_name] = SC._applications[application_name] || new ApplicationSkeleton(application_name);
        return SC._applications[application_name];
    };
    return SC.Application;
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module CheckoutApplication
define('SC.Checkout.Layout', [
    'ApplicationSkeleton.Layout',
    'checkout_layout.tpl',
    'underscore',
    'Utils'
], function (ApplicationSkeletonLayout, checkout_layout_tpl, _) {
    'use strict';
    //@class SCA.Checkout.Layout @extend ApplicationSkeletonLayout
    return ApplicationSkeletonLayout.extend({
        //@propery {Function} template
        template: checkout_layout_tpl    //@propery {String} className 
,
        className: 'layout-container'    //@property {Array} breadcrumbPrefix
,
        breadcrumbPrefix: [
            {
                href: '#',
                'data-touchpoint': 'home',
                'data-hashtag': '#',
                text: _('Home').translate()
            },
            {
                href: '#',
                'data-touchpoint': 'checkout',
                'data-hashtag': '#',
                text: _('Checkout').translate()
            }
        ]
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module Backbone
@class Backbone.Model
Extends native Backbone.Model to make internalid the idAttribute
*/
define('Backbone.Model', [
    'Backbone',
    'underscore',
    'SC.CancelableEvents'
], function (Backbone, _, SCCancelableEvents) {
    'use strict';
    _.extend(Backbone.Model.prototype, {
        // @method url SCA Overrides @?method Backbone.Model.url to add model's 'internalid' as parameter @return {String}
        url: function () {
            var base = _.result(this, 'urlRoot') || _.result(this.collection, 'url');
            if (this.isNew()) {
                return base;
            }
            var sep = base.indexOf('?') === -1 ? '?' : '&';
            return base + sep + 'internalid=' + encodeURIComponent(this.id);
        },
        deepCopy: function deepCopy() {
            return this.attributes || {};
        }    // @method url SCA Overrides @?property Backbone.Model.idAttribute to add model's 'internalid' as parameter @return {String}
,
        idAttribute: 'internalid'
    }, SCCancelableEvents);
    return Backbone.Model;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module BackboneExtras
#Backbone.sync()
Overrides native Backbone.sync to pass company and site id on all requests
*/
define('Backbone.Sync', [
    'Backbone',
    'underscore',
    'jQuery',
    'Utils'
], function (Backbone, _, jQuery, Utils) {
    'use strict';
    // @method sync SCA Overrides @?method Backbone.Model.url to add model's 'internalid' as parameter @return {String}
    Backbone.sync = _.wrap(Backbone.sync, function (fn, method, model, options) {
        var url = options.url || _.result(model, 'url');
        if (url) {
            options = options || {};
            if (url.indexOf('&c=') < 0 && url.indexOf('?c=') < 0) {
                url = url + (~url.indexOf('?') ? '&' : '?') + jQuery.param({
                    // Account Number
                    c: SC.ENVIRONMENT.companyId
                });
            }
            if (url.indexOf('&n=') < 0 && url.indexOf('?n=') < 0) {
                url = url + (~url.indexOf('?') ? '&' : '?') + jQuery.param({
                    // Site Number
                    n: SC.ENVIRONMENT.siteSettings.siteid
                });
            }
        }
        options.url = url;
        var actionDetails = model.get('actionDetails');
        if (actionDetails) {
            //Adds extra information to improve the performance metrics
            options.url = Utils.addParamsToUrl(options.url, actionDetails);
            model.unset('actionDetails');
        }
        return fn.apply(this, [
            method,
            model,
            options
        ]);
    });
    return Backbone.sync;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module BackboneExtras

#Backbone.Validation.callbacks

This code is responsible of showing / hiding error on forms input validation.

It extends the callbacks of the Backbone Validation plugin https://github.com/thedersen/backbone.validation

##Usage

First the view must have a model or collection attribute in order to activate the validation callbacks

	MyView = Backbone.View.extend({
		template: 'my_template'
	,	model: myModel
	});

The view template must have for each control group
	- data-validation="control-group": for each control group
	- data-validation="control" : for each element where a error message is shown

Example:

	<div class="login-form-controls-group" data-validation="control-group">
		<label>
			{{translate 'Password <small>*</small>'}}
		</label>
		<div  class="login-form-controls" data-validation="control">
			<input type="password" name="password" id="login-password" >
		</div>
	</div>

*IMPORTANT* If you are using bootstrap3, be sure that you call Backbone.Validation.callbacks.setSelectorStyle('bootstrap3') or your error messages will not be shown.
*/
define('Backbone.Validation.callbacks', [
    'Backbone',
    'underscore',
    'Backbone.Validation',
    'Utils'
], function (Backbone, _) {
    'use strict';
    var selectors = {
        controlGroup: {
            attr: 'data-validation',
            value: 'control-group'
        },
        control: {
            attr: 'data-validation',
            value: 'control'
        },
        error: {
            attr: 'data-validation-error',
            value: ''
        },
        errorInline: {
            attr: 'data-validation-error',
            value: 'inline'
        },
        errorBlock: {
            attr: 'data-validation-error',
            value: 'block'
        },
        build: function (selectorName) {
            var selector = selectors[selectorName];
            return '[' + selector.attr + '="' + selector.value + '"]';
        }
    };
    _.extend(Backbone.Validation.callbacks, {
        valid: function (view, attr, selector) {
            var $control = view.$el.find('[' + selector + '="' + attr + '"]')    // if its valid we remove the error classnames
, $group = $control.closest(selectors.build('controlGroup')).removeAttr(selectors.error.attr), $target = $control.data('error-style') === 'inline' ? $group.find(selectors.build('errorInline')) : $group.find(selectors.build('errorBlock'));
            view.helpMessages = view.helpMessages || {};
            if (view.helpMessages[attr]) {
                $target.text(view.helpMessages[attr]);
            }
            // we also need to remove all of the error messages
            return $target.remove().end();
        },
        invalid: function (view, attr, error, selector) {
            //removes back-end errors
            view.hideError();
            var $target, $control = view.$el.find('[' + selector + '="' + attr + '"]'), $group = $control.closest(selectors.build('controlGroup')).attr(selectors.error.attr, selectors.error.value);
            //This case happens when calling validation on attribute setting with { validate: true; }
            if (!view.$savingForm) {
                view.$savingForm = $control.closest('form');
            }
            if ($control.data('error-style') === 'inline') {
                // if we don't have a place holder for the error
                // we need to add it. $target will be the placeholder
                if (!$group.find(selectors.build('errorInline')).length) {
                    $group.find(selectors.build('control')).append('<span ' + selectors.errorInline.attr + '="' + selectors.errorInline.value + '"></span>');
                }
                $target = $group.find(selectors.build('errorInline'));
            } else {
                // if we don't have a place holder for the error
                // we need to add it. $target will be the placeholder
                if (!$group.find(selectors.build('errorBlock')).length) {
                    $group.find(selectors.build('control')).append('<p ' + selectors.errorBlock.attr + '="' + selectors.errorBlock.value + '"></p>');
                }
                $target = $group.find(selectors.build('errorBlock'));
            }
            view.helpMessages = view.helpMessages || {};
            view.helpMessages[attr] = $target.text();
            return $target.text(error);
        }
    });
    return Backbone.Validation.callbacks;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('Backbone.Validation.patterns', [
    'Backbone',
    'underscore',
    'Backbone.Validation'
], function (Backbone, _) {
    'use strict';
    _.extend(Backbone.Validation.patterns, {
        // Same as email but is more restrictive and matches the same emails as the Netsuite backend UI
        // Source: https://system.netsuite.com/javascript/NLUtil.jsp__NS_VER=2014.1.0&minver=154&locale=en_US.nlqs
        //        (Search for NLValidationUtil_SIMPLE_EMAIL_PATTERN)
        email: /^[-a-z0-9!#$%&'*+\/=?^_`{|}~]+(?:\.[-a-z0-9!#$%&'*+\/=?^_`{|}~]+)*@(?:[a-z0-9]+(?:-+[a-z0-9]+)*\.)+(?:xn--[a-z0-9]+|[a-z]{2,16})$/i    //This validation is less restrictive than standard and matches with the used in Netsuite backend
,
        netsuiteUrl: /^(https|http|ftp|file):\/\//,
        netsuiteFloat: /^-{0,1}([0-9])+(\.{1}[0-9]+)?$/,
        netsuiteInteger: /^-{0,1}([0-9])+$/    //Allow numbers bettwen 000.00 and 000100.00 ending with optional %
,
        netsuitePercent: /^0*((([0-9]{1,2})(\.[0-9]{1,2})?%?$)|(100(\.0{1,2})?%?$))/    //Allow any character 7 or more times (this is the validation that the netsuite backend form does on phone type fields)
,
        netsuitePhone: /^.{7,}$/
    });
    return Backbone.Validation.patterns;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module BackboneExtras
#Backbone.View.saveForm
extends native Backbone.View with a custom saveForm function to be called when forms are submited
@obsolete please use Backbone.FormView
*/
define('Backbone.View.saveForm', [
    'Backbone',
    'underscore',
    'jQuery'
], function (Backbone, _, jQuery) {
    'use strict';
    _.extend(Backbone.View.prototype, {
        // @module Backbone @class Backbone.View @method saveForm
        // will serialize the input of some form and save() the given model using it
        // @param {HTMLEvent} e @param {Backbone.Model} model @param {Object} props properties to pass to model.save()
        // @return {jQuery.Deferred}
        // @obsolete Please use @?ref Backbone.FormView
        saveForm: function (e, model, props) {
            e.preventDefault();
            model = model || this.model;
            this.$savingForm = jQuery(e.target).closest('form');
            if (this.$savingForm.length) {
                // Disables all for submit buttons, to prevent double submitions
                this.$savingForm.find('input[type="submit"], button[type="submit"]').attr('disabled', true);
                // and hides reset buttons
                this.$savingForm.find('input[type="reset"], button[type="reset"]').hide();
            }
            this.hideError();
            var self = this;
            // Returns the promise of the save acction of the model
            return model.save(props || this.$savingForm.serializeObject(), {
                wait: true    // Hides error messages, re enables buttons and triggers the save event
                        // if we are in a modal this also closes it
,
                success: function (model, response) {
                    if (self.inModal && self.$containerModal) {
                        self.$containerModal.modal('hide');
                    }
                    if (self.$savingForm.length) {
                        self.hideError(self.$savingForm);
                        self.$savingForm.find('[type="submit"], [type="reset"]').attr('disabled', false);
                        model.trigger('save', model, response);
                    }
                }    // Re enables all button and shows an error message
,
                error: function (model, response) {
                    self.$savingForm.find('*[type=submit], *[type=reset]').attr('disabled', false);
                    if (response.responseText) {
                        model.trigger('error', jQuery.parseJSON(response.responseText));
                    }
                }
            });
        }
    });
    return Backbone.View.prototype.saveForm;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// Backbone.View.toggleReset.js
// -----------------------
// @module Backbone @class Backbone.View @method toggleReset
// Backbones' view extension for showing/hiding a "reset" button that restore all form's fields that have changed
// You have to assign the change event of the inputs of a form to call this function
// For example in the "events" array of a view:
//
//		'change form' : 'toggleReset'
//
define('Backbone.View.toggleReset', [
    'Backbone',
    'underscore',
    'jQuery'
], function (Backbone, _, jQuery) {
    'use strict';
    _.extend(Backbone.View.prototype, {
        // the "debounce" add a small delay between the eventr and the function triggering
        // it's useful when the user is writting so we don't trigger the event after every keypress
        toggleReset: _.debounce(function (e) {
            var $form = jQuery(e.target).closest('form'), model = this.model, attribute, value, fields_changed = _.filter($form.serializeObject(), function (item, key) {
                    attribute = model.get(key);
                    value = jQuery.trim(item);
                    return attribute ? attribute !== value : !!value;
                });
            // if some field changed, the reset button is shown
            $form.find('[data-action="reset"]')[fields_changed.length ? 'removeClass' : 'addClass']('hide');
            return this;
        }, 300)
    });
    return Backbone.View.prototype.toggleReset;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/* ====================================================================
 * SLIDER
 * We developed jQuery plugin to provide range slider functionality
 * Used on file: facet_range_macro.txt
 *
 * We tried to follow same syntax and practices as Bootstrap.js
 * so we are using Bootstrap's jsHint settings
 * http://blog.getbootstrap.com/2012/04/19/bootstrap-jshint-and-recess/
 * ==================================================================== */
define('Bootstrap.Slider', ['jQuery'], function ($) {
    'use strict';
    /* SLIDER CLASS DEFINITION
	 * ======================= */
    var Slider = function (element, options) {
        this.init(element, options);
    };
    Slider.prototype = {
        init: function (element, options) {
            var $element = $(element), $children = $element.children();
            this.$element = $element;
            this.options = options;
            this.values = this.parseValues(options.values, $element.data());
            this.$bar = $children.filter('[data-control="bar"]');
            this.controls = {
                $low: $children.filter('[data-control="low"]'),
                $high: $children.filter('[data-control="high"]')
            };
            this.slideToInitial(true);
            this.listen();
        },
        parseValues: function (defaults, dom_data) {
            var values = {
                min: dom_data.min || defaults.min,
                max: dom_data.max || defaults.max
            };
            $.extend(values, {
                low: Math.max(dom_data.low || defaults.min, values.min),
                high: Math.min(dom_data.high || defaults.high, values.max)
            });
            return values;
        },
        listen: function () {
            var proxy = jQuery.proxy;
            //handle event for stoplisten 'html'
            this.proxyHandleMouseDown = proxy(this.handleMouseDown, this);
            this.proxyHandleMouseMove = proxy(this.handleMouseMove, this);
            this.proxyHandleMouseUp = proxy(this.handleMouseUp, this);
            this.$element.on('mousedown.slider.data-api', this.proxyHandleMouseDown).on('touchstart.slider.data-api', this.proxyHandleMouseDown);
            $('html').on('mousemove.slider.data-api', this.proxyHandleMouseMove).on('touchmove.slider.data-api', this.proxyHandleMouseMove).on('mouseup.slider.data-api', this.proxyHandleMouseUp).on('touchend.slider.data-api', this.proxyHandleMouseUp).on('touchcancel.slider.data-api', this.proxyHandleMouseUp);
        },
        stopListen: function () {
            $('html').off('mousemove.slider.data-api', this.proxyHandleMouseMove).off('touchmove.slider.data-api', this.proxyHandleMouseMove).off('mouseup.slider.data-api', this.proxyHandleMouseUp).off('touchend.slider.data-api', this.proxyHandleMouseUp).off('touchcancel.slider.data-api', this.proxyHandleMouseUp);
        },
        getMinBoundary: function () {
            return this.$element.offset().left;
        },
        getMaxBoundary: function () {
            return this.getMinBoundary() + this.$element.innerWidth();
        },
        handleMouseDown: function (e) {
            if (e.which !== 1 && e.type !== 'touchstart') {
                return;
            }
            var page_x = this.getPageX(e), $target = $(e.target);
            if ($target.is('a') || $target.is('button')) {
                if (this.values.low === this.values.max || this.values.high === this.values.min) {
                    $target = this.controls['$' + (page_x < this.$element.offset().left + this.$element.innerWidth() / 2 ? 'high' : 'low')];
                }
                this.$dragging = $target;
                this.$element.trigger('start', this);
            } else {
                this.$dragging = this.getClosestControl(page_x);
                this.slideToValue(this.getSlidValue(page_x));
            }
            e.preventDefault();
        },
        handleMouseMove: function (e) {
            if (!this.$dragging) {
                return;
            }
            var page_x = this.getPageX(e), slid_value = this.getSlidValue(page_x), is_low = this.$dragging.data('control') === 'low', value = Math[is_low ? 'min' : 'max'](slid_value, this.values[is_low ? 'high' : 'low']);
            this.slideToValue(value);
            e.preventDefault();
        },
        handleMouseUp: function (e) {
            if (!this.$dragging) {
                return;
            }
            this.$dragging = null;
            this.$element.trigger('stop', this);
            e.preventDefault();
        },
        getPageX: function (e) {
            var touch = e.originalEvent && e.originalEvent.touches ? e.originalEvent.touches[0] || e.originalEvent.changedTouches[0] : null;
            return touch ? touch.pageX : e.pageX;
        },
        getSlidValue: function (page_x) {
            var minBoundary = this.getMinBoundary(), maxBoundary = this.getMaxBoundary(), location = page_x > maxBoundary ? maxBoundary : page_x < minBoundary ? minBoundary : page_x;
            return (location - minBoundary) / this.$element.innerWidth() * this.getSizeInValue() + this.values.min;
        },
        getClosestControl: function (page_x) {
            var value = this.getSlidValue(page_x), distance_low = Math.abs(this.values.low - value), distance_high = Math.abs(this.values.high - value), $low = this.controls.$low;
            if (distance_low !== distance_high) {
                return distance_low < distance_high ? $low : this.controls.$high;
            } else {
                return page_x < $low.offset().left ? $low : this.controls.$high;
            }
        },
        getSizeInValue: function () {
            return this.values.max - this.values.min;
        },
        moveControl: function ($control, value) {
            return $control.css({ left: (value - this.values.min) * 100 / this.getSizeInValue() + '%' });
        },
        resizeBar: function () {
            return this.$bar.css({
                left: (this.values.low - this.values.min) * 100 / this.getSizeInValue() + '%',
                width: (this.values.high - this.values.low) / this.getSizeInValue() * 100 + '%'
            });
        },
        slideToInitial: function (trigger) {
            this.slideControls();
            this.resizeBar();
            if (trigger) {
                this.$element.trigger('slide', this);
            }
        },
        slideControls: function () {
            this.moveControl(this.controls.$low, this.values.low);
            this.moveControl(this.controls.$high, this.values.high);
        },
        slideToValue: function (value) {
            var is_low = this.$dragging.data('control') === 'low';
            this.values[is_low ? 'low' : 'high'] = value;
            this.moveControl(this.$dragging, value);
            this.resizeBar();
            this.$element.trigger('slide', this);
        }
    };
    /* SLIDER PLUGIN DEFINITION
	 * ======================== */
    // standar jQuery plugin definition
    $.fn.slider = function (option) {
        return this.each(function () {
            var $this = $(this), data = $this.data('slider');
            // if it wasn't initialized, we do so
            if (!data) {
                // we extend the passed options with the default ones
                var options = $.extend({}, $.fn.slider.defaults, typeof option === 'object' && options);
                $this.data('slider', data = new Slider(this, options));
            }
        });
    };
    $.fn.slider.Constructor = Slider;
    $.fn.slider.defaults = {
        values: {
            min: 0,
            max: 100
        }
    };
    /* SLIDER DATA-API
	 * =============== */
    $(window).on('load', function () {
        $('[data-toggle="slider"]').slider();
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*!
* Description: SuiteCommerce Reference Checkout
*
* @copyright (c) 2000-2013, NetSuite Inc.
* @version 1.0
*/
// Application.js
// --------------
// Extends the application with Checkout specific core methods
define('SC.Checkout', [
    'SC.Checkout.Configuration',
    'Application',
    'SC.Checkout.Layout',
    'Session',
    'Backbone',
    'jQuery',
    'Utils',
    'underscore',
    'Backbone.Model',
    'Backbone.Sync',
    'Backbone.Validation.callbacks',
    'Backbone.Validation.patterns',
    'Backbone.View',
    'Backbone.View.render',
    'Backbone.View.saveForm',
    'Backbone.View.toggleReset',
    'Bootstrap.Slider',
    'jQuery.ajaxSetup',
    'jQuery.serializeObject',
    'String.format'
], function (Configuration, Application, CheckoutLayout, Session, Backbone, jQuery, Utils, _) {
    'use strict';
    var Checkout = SC.Application('Checkout');
    Checkout.Configuration = _.extend(Checkout.Configuration, Configuration);
    Checkout.Layout = CheckoutLayout;
    // This makes that Promo codes and GC travel to different servers (secure and unsecure)
    Checkout.on('afterStart', function () {
        // Fix sitebuilder links, Examines the event target to check if its a touchpoint
        // and replaces it with the new version ot the touchpoint
        function fixCrossDomainNavigation(e) {
            var $element = jQuery(e.target);
            if (!$element.closest('#main').length) {
                var href = e.target.href, touchpoints = Session.get('touchpoints')    //get the value of the "is" url parameter
, href_parameter_value_is = Utils.getParameterByName(href, 'is');
                _.each(touchpoints, function (touchpoint) {
                    var touchpoint_parameter_value_is = Utils.getParameterByName(touchpoint, 'is');
                    // If the href of the link is equal to the current touchpoint then update the link with the
                    // parameters of the touchpoint. To check if are equals is been used the url without
                    // parameters and the parameter "is"
                    if (~touchpoint.indexOf(href.split('?')[0])) {
                        // If the "is" parameter exist in the link, then must exist in the
                        // touchpoint and his values need to be equals.
                        if (!(href_parameter_value_is && (!touchpoint_parameter_value_is || touchpoint_parameter_value_is !== href_parameter_value_is))) {
                            e.target.href = touchpoint;
                        }
                    }
                });
            }
        }
        // As this fixCrossDomainNavigation only alters the href of the a we can append it
        // to the mouse down event, and not to the click thing will make us work a lot more :)
        jQuery(document.body).on('mousedown', 'a', fixCrossDomainNavigation);
        jQuery(document.body).on('touchstart', 'a', fixCrossDomainNavigation);
    });
    // Setup global cache for this application
    jQuery.ajaxSetup({ cache: false });
    return Checkout;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('Backbone.View.Plugin.ApplyPermissions', [
    'Backbone.View.render',
    'underscore',
    'jQuery'
], function (BackboneView, _, jQuery) {
    'use strict';
    return {
        mountToApp: function () {
            if (!_.result(SC, 'isPageGenerator')) {
                BackboneView.postRender.install({
                    name: 'applyPermissions',
                    priority: 10    // Given a DOM template, removes the elements from the DOM that
                          // do not comply with the list of permissions level
                          // The permission level is specified by using the data-permissions attribute and data-permissions-operator (the latter is optional)
                          // on any html tag in the following format:
                          // <permission_category>.<permission_name>.<minimum_level>
                          // permission_category and permission_name come from SC.ENVIRONMENT.permissions. (See commons.js)
                          // e.g:
                          //     <div data-permissions="transactions.tranFind.1"></div>
                          //     <div data-permissions="transactions.tranCustDep.3,transactions.tranDepAppl.1 lists.tranFind.1"></div>
                          // Notice several permissions can be separated by space or comma, by default (in case that data-permissions-operator is missing) all permission will be evaluates
                          // as AND, otherwise data-permissions-operator should have the value OR
                          // e.g:
                          //     <div data-permissions="transactions.tranFind.1"></div>
                          //     <div data-permissions="transactions.tranCustDep.3,transactions.tranDepAppl.1 lists.tranFind.1" data-permissions-operator="OR" ></div>
,
                    execute: function (template) {
                        // We need to wrap the template in a container so then we can find
                        // and remove parent nodes also (jQuery.find only works in descendants).
                        var $permissioned_elements = template.find('[data-permissions]');
                        $permissioned_elements.each(function () {
                            var $el = jQuery(this), element_permission = $el.data('permissions'), perms = element_permission.split(/[\s,]+/), perm_operator = $el.data('permissions-operator') || 'AND', perm_eval, perm_evaluation = perm_operator !== 'OR';
                            _.each(perms, function (perm) {
                                var perm_tokens = perm.split('.');
                                perm_eval = !(perm_tokens.length === 3 && perm_tokens[2] < 5 && SC.ENVIRONMENT.permissions && SC.ENVIRONMENT.permissions[perm_tokens[0]] && SC.ENVIRONMENT.permissions[perm_tokens[0]][perm_tokens[1]] < perm_tokens[2]);
                                if (perm_operator === 'OR') {
                                    perm_evaluation = perm_evaluation || perm_eval;
                                } else {
                                    perm_evaluation = perm_evaluation && perm_eval;
                                }
                            });
                            if (!perm_evaluation) {
                                $el.remove();
                            }
                        });
                        return template;
                    }
                });
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('Backbone.View.Plugin.Bootstrap', [
    'Backbone.View.render',
    'underscore'
], function (BackboneView, _) {
    'use strict';
    return {
        mountToApp: function () {
            if (!_.result(SC, 'isPageGenerator')) {
                BackboneView.postRender.install({
                    name: 'HTMLBootstrap',
                    priority: 10    //Fix all HTML bootstrap tooltips
,
                    execute: function ($el, view) {
                        view.$('[data-toggle="tooltip"]').tooltip({ html: true });
                        view.$('[data-toggle="dropdown"]').dropdown();    //view.$('[data-toggle="collapse"]').collapse();
                    }
                });
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module BackboneExtras
#Backbone.View.Plugins
Define the default plugins to execute by Backbone.View.render method. These plugins hook into the Backobne.view
render() life cycle and modify the view's output somehow, for example removing marked nodes that current user
has not permission to see, installing bootstrap widgets after a view is rendered, etc.
*/
define('Backbone.View.Plugin.DatePicker', [
    'Backbone.View.render',
    'underscore',
    'jQuery',
    'bootstrap-datepicker'
], function (BackboneView, _, jQuery) {
    'use strict';
    return {
        mountToApp: function () {
            if (!_.result(SC, 'isPageGenerator')) {
                BackboneView.postRender.install({
                    name: 'datePicker',
                    priority: 10,
                    execute: function ($el, view) {
                        if (_.isNativeDatePickerSupported() === false || _.isDesktopDevice()) {
                            view.$('input[type="date"]').each(function () {
                                var $date_picker = jQuery(this);
                                try {
                                    $date_picker.attr('type', 'text');
                                } catch (ex) {
                                }
                                $date_picker.datepicker({
                                    format: $date_picker.data('format'),
                                    startDate: $date_picker.data('start-date'),
                                    endDate: $date_picker.data('end-date'),
                                    autoclose: true,
                                    todayHighlight: $date_picker.data('todayhighlight')
                                });
                            });
                        }
                    }
                });
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('Backbone.View.Plugin.DebugTemplateName', [
    'Backbone.View.render',
    'Utils',
    'underscore'
], function (BackboneView, Utils, _) {
    'use strict';
    return {
        mountToApp: function () {
            if (!_.result(SC, 'isPageGenerator')) {
                BackboneView.postCompile.install({
                    name: 'debugTemplateName',
                    priority: 10,
                    execute: function (tmpl_str, view) {
                        var template_name = view.template.Name, prefix = Utils.isPageGenerator() ? '' : '\n\n<!-- TEMPLATE STARTS: ' + template_name + '-->\n', posfix = Utils.isPageGenerator() ? '' : '\n<!-- TEMPLATE ENDS: ' + template_name + ' -->\n';
                        tmpl_str = prefix + tmpl_str + posfix;
                        return tmpl_str;
                    }
                });
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('Backbone.View.Plugin.OldIEFix', [
    'Backbone.View.render',
    'Utils'
], function (BackboneView, Utils) {
    'use strict';
    return {
        mountToApp: function () {
            if (Utils.oldIE()) {
                BackboneView.postCompile.install({
                    name: 'oldIEFix',
                    priority: 20    // Workaround for internet explorer 7. href is overwritten with the absolute path so we save the original href
                          // in data-href (only if we are in IE7)
                          // IE7 detection courtesy of Backbone
                          // More info: http://www.glennjones.net/2006/02/getattribute-href-bug/
,
                    execute: function (tmpl_str) {
                        return (tmpl_str || '').replace(/href="(.+?)(?=")/g, '$&" data-href="$1');
                    }
                });
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('Backbone.View.Plugin.PageGeneratorImages', [
    'Backbone.View.render',
    'underscore'
], function (BackboneView, _) {
    'use strict';
    return {
        mountToApp: function () {
            // wrap all images with noscript tag in the page generator output so they are not automatically loaded by the browser and compete with our core resources.
            if (_.result(SC, 'isPageGenerator')) {
                BackboneView.postCompile.install({
                    name: 'pageGeneratorWrapImagesNoscript',
                    priority: 30,
                    execute: function (tmpl_str) {
                        return tmpl_str.replace(/(<img\s+[^>]*>\s*<\/img>|<img\s+[^>]*\/>|(?:<img\s+[^>]*>)(?!\s*<\/img>))(?!\s*<\s*\/noscript\s*>)/gim, '<noscript>$1</noscript>');
                    }
                });
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module BackboneExtras
#Backbone.View.Plugins
Define the default plugins to execute by Backbone.View.render method. These plugins hook into the Backobne.view
render() life cycle and modify the view's output somehow, for example removing marked nodes that current user
has not permission to see, installing bootstrap widgets after a view is rendered, etc.
*/
define('Backbone.View.Plugins', [
    'Backbone.View.Plugin.ApplyPermissions',
    'Backbone.View.Plugin.Bootstrap',
    'Backbone.View.Plugin.DatePicker',
    'Backbone.View.Plugin.DebugTemplateName',
    'Backbone.View.Plugin.OldIEFix',
    'Backbone.View.Plugin.PageGeneratorImages'
], function () {
    'use strict';
    var plugins = arguments;
    return {
        mountToApp: function () {
            for (var i = 0; i < plugins.length; ++i) {
                plugins[i].mountToApp.apply(this, arguments);
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module jQueryExtras

#jQuery.html

ONLY FOR PAGE GENERATOR. 

ReDefines jQuery html and appends functions to control how and what new content 
is added into the DOM. If in page generator we also override jQuery.html() and jQuery.append() so html 
output is minified. Also remove scripts - so content scripts don't appear in SEO output.

*/
define('jQuery.html', [
    'jQuery',
    'Utils'
], function (jQuery, utils) {
    'use strict';
    return {
        mountToApp: function () {
            if (utils.isPageGenerator()) {
                var jQuery_originalHtml = jQuery.fn.html;
                jQuery.fn.html = function (html) {
                    if (typeof html === 'string') {
                        html = utils.minifyMarkup(html);
                        html = utils.removeScripts(html);
                    }
                    return jQuery_originalHtml.apply(this, [html]);
                };
                var jQuery_originalAppend = jQuery.fn.append;
                jQuery.fn.append = function (html) {
                    if (typeof html === 'string') {
                        html = utils.minifyMarkup(html);
                        html = utils.removeScripts(html);
                    }
                    return jQuery_originalAppend.apply(this, [html]);
                };
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Locator
define('Location.Model', [
    'Backbone.CachedModel',
    'Utils'
], function (BackboneCachedModel, Utils) {
    'use strict';
    return BackboneCachedModel.extend({
        //@property {String} urlRoot
        urlRoot: Utils.getAbsoluteUrl('services/Location.Service.ss'),
        toString: function toString() {
            return this.get('internalid') || '';
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Location
define('Location.Collection', [
    'Location.Model',
    'underscore',
    'Backbone.CachedCollection'
], function (LocationModel, _, BackboneCachedCollection) {
    'use strict';
    //@class Location.Collection @extend Backbone.Collection
    return BackboneCachedCollection.extend({
        //@property {Location.Model} model
        model: LocationModel    //@property {String} url
,
        url: _.getAbsoluteUrl('services/Location.Service.ss')    //@method parse Transforms the JSON response to extract  the array of models from the correct
                                                            //response as to know what page is loaded
,
        parse: function parse(response) {
            if (!_.isUndefined(response.totalRecordsFound)) {
                this.totalRecordsFound = response.totalRecordsFound;
                this.recordsPerPage = response.recordsPerPage;
                return response.records;
            } else {
                return response;
            }
        }    //@method update
             //@param {Object} options
             //@param {Object} callbacks
,
        update: function update(options, callbacks) {
            return this.fetch(_.extend({
                data: {
                    //@property {String} latitude
                    latitude: options.latitude,
                    longitude: options.longitude,
                    radius: options.radius,
                    sort: options.sort,
                    page: options.page,
                    locationtype: options.locationtype,
                    results_per_page: options.results_per_page
                },
                reset: !!options.reset,
                killerId: options.killerId
            }, callbacks));
        }
    });
});
/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2006, 2014 Klaus Hartl
 * Released under the MIT license
 */
(function (factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD
        define('jquery.cookie', ['jQuery'], factory);
    } else if (typeof exports === 'object') {
        // CommonJS
        factory(require('jquery'));
    } else {
        // Browser globals
        factory(jQuery);
    }
}(function ($) {
    var pluses = /\+/g;
    function encode(s) {
        return config.raw ? s : encodeURIComponent(s);
    }
    function decode(s) {
        return config.raw ? s : decodeURIComponent(s);
    }
    function stringifyCookieValue(value) {
        return encode(config.json ? JSON.stringify(value) : String(value));
    }
    function parseCookieValue(s) {
        if (s.indexOf('"') === 0) {
            // This is a quoted cookie as according to RFC2068, unescape...
            s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
        }
        try {
            // Replace server-side written pluses with spaces.
            // If we can't decode the cookie, ignore it, it's unusable.
            // If we can't parse the cookie, ignore it, it's unusable.
            s = decodeURIComponent(s.replace(pluses, ' '));
            return config.json ? JSON.parse(s) : s;
        } catch (e) {
        }
    }
    function read(s, converter) {
        var value = config.raw ? s : parseCookieValue(s);
        return $.isFunction(converter) ? converter(value) : value;
    }
    var config = $.cookie = function (key, value, options) {
        // Write
        if (arguments.length > 1 && !$.isFunction(value)) {
            options = $.extend({}, config.defaults, options);
            if (typeof options.expires === 'number') {
                var days = options.expires, t = options.expires = new Date();
                t.setTime(+t + days * 86400000);
            }
            return document.cookie = [
                encode(key),
                '=',
                stringifyCookieValue(value),
                options.expires ? '; expires=' + options.expires.toUTCString() : '',
                // use expires attribute, max-age is not supported by IE
                options.path ? '; path=' + options.path : '',
                options.domain ? '; domain=' + options.domain : '',
                options.secure ? '; secure' : ''
            ].join('');
        }
        // Read
        var result = key ? undefined : {};
        // To prevent the for loop in the first place assign an empty array
        // in case there are no cookies at all. Also prevents odd result when
        // calling $.cookie().
        var cookies = document.cookie ? document.cookie.split('; ') : [];
        for (var i = 0, l = cookies.length; i < l; i++) {
            var parts = cookies[i].split('=');
            var name = decode(parts.shift());
            var cookie = parts.join('=');
            if (key && key === name) {
                // If second argument (value) is a function it's a converter...
                result = read(cookie, value);
                break;
            }
            // Prevent storing a cookie that we couldn't decode.
            if (!key && (cookie = read(cookie)) !== undefined) {
                result[name] = cookie;
            }
        }
        return result;
    };
    config.defaults = {};
    $.removeCookie = function (key, options) {
        if ($.cookie(key) === undefined) {
            return false;
        }
        // Must not alter options, thus extending a fresh object...
        $.cookie(key, '', $.extend({}, options, { expires: -1 }));
        return !$.cookie(key);
    };
}));
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Location
define('Location.ProductLine', [
    'Product.Model',
    'Transaction.Line.Model',
    'ProductLine.Common',
    'Location.Model',
    'underscore',
    'Backbone'
], function (ProductModel, TransactionLineModel, ProductLineCommon, LocationModel, _, Backbone) {
    'use strict';
    var initialize_location = function (attributes) {
        this.on('change:location', function (model, location) {
            var value;
            if (location instanceof LocationModel || location instanceof Backbone.Model) {
                value = location.clone();
            } else if (_.isObject(location)) {
                value = new LocationModel(location);
            } else {
                value = new LocationModel({ internalid: location });
            }
            model.set('location', value, { silent: true });
        });
        this.trigger('change:location', this, attributes && attributes.location || {});
    };
    var original_product_model_initialize_fn = ProductModel.prototype.initialize;
    ProductModel.prototype.initialize = function initialize() {
        original_product_model_initialize_fn.apply(this, arguments);
        initialize_location.apply(this, arguments);
    };
    var original_transaction_line_model_initialize_fn = TransactionLineModel.prototype.initialize;
    TransactionLineModel.prototype.initialize = function initialize() {
        original_transaction_line_model_initialize_fn.apply(this, arguments);
        initialize_location.apply(this, arguments);
    };
    var original_to_json_product_line_common_fn = ProductLineCommon.toJSON;
    ProductLineCommon.toJSON = function toJSON() {
        var result = original_to_json_product_line_common_fn.apply(this, arguments);
        //@class Transaction.Line.Model.JSON
        //@property {Object} location
        result.location = this.attributes.location && this.attributes.location.attributes && this.attributes.location.attributes.internalid || '';
        //@property {Object} fulfillmentChoice
        result.fulfillmentChoice = this.attributes.fulfillmentChoice || 'ship';
        return result;
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductDetailToQuote
define('Location', [
    'Location.Collection',
    'Location.Model',
    'Transaction.Model',
    'underscore',
    'jQuery',
    'jquery.cookie',
    'Location.ProductLine'
], function (LocationCollection, LocationModel, TransactionModel, _, jQuery) {
    'use strict';
    var locations_cache = {};
    function fetchLocations(location_ids) {
        location_ids = _.isArray(location_ids) ? location_ids : [location_ids];
        var location_id_to_fetch = _.filter(location_ids, function (internalid) {
                return !locations_cache[internalid] ? internalid : false;
            }), promise = jQuery.Deferred();
        location_ids = _.unique(_.compact(location_ids));
        if (location_id_to_fetch.length) {
            if (location_id_to_fetch.length === 1) {
                promise = new LocationModel({ internalid: location_id_to_fetch[0] }).fetch().done(function (location) {
                    locations_cache[location.internalid] = location;
                });
            } else {
                promise = new LocationCollection().fetch({ data: { internalid: location_id_to_fetch.join(',') } }).done(function (locations) {
                    _.each(locations, function (location) {
                        locations_cache[location.internalid] = location;
                    });
                });
            }
        } else {
            promise.resolve();
        }
        return promise;
    }
    //@class ProductDetailToQuote @extend ApplicationModule
    return {
        //@method get
        //@param {String} location_id
        //@return {Object}
        get: function (location_id) {
            return locations_cache[location_id] || {};
        }    //@method fetchLocations
             //@param {Array || String} location_ids
             //@return {jQuery.Deferred}
,
        fetchLocations: fetchLocations    //@method mountToApp
                          //@param {ApplicationSkeleton} application
                          //@return {Void}
,
        mountToApp: function mountToApp() {
            var original_transaction_model_fn = TransactionModel.prototype.initialize;
            TransactionModel.prototype.initialize = function initialize() {
                original_transaction_model_fn.apply(this, arguments);
                this.on('change:lines', function (model) {
                    var default_location_id = jQuery.cookie('myStore'), lines = model.get('lines'), is_cart = this.get('internalid') === 'cart', location_ids = lines.map(function (line) {
                            return line.get('location') && line.get('location').get('internalid');
                        });
                    if (!location_ids.length) {
                        return;
                    }
                    if (is_cart && default_location_id) {
                        location_ids.push(default_location_id);
                    }
                    fetchLocations(location_ids).done(function () {
                        lines.each(function (line) {
                            var internalid = line.get('location') && line.get('location').get('internalid') || (is_cart ? default_location_id : null);
                            if (internalid) {
                                line.get('location').set(locations_cache[internalid]);
                            }
                        });
                    });
                });
            };
        }
    };
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Cart
define('Cart.Confirmation.View', [
    'Transaction.Line.Views.Price.View',
    'Backbone.CompositeView',
    'Transaction.Line.Views.Options.Selected.View',
    'ProductLine.Sku.View',
    'cart_confirmation_modal.tpl',
    'Backbone',
    'underscore',
    'Utils'
], function (TransactionLineViewsPriceView, BackboneCompositeView, TransactionLineViewsOptionsSelectedView, ProductLineSkuView, cart_confirmation_modal_tpl, Backbone, _) {
    'use strict';
    // @class Cart.Confirmation.View Cart Confirmation view @extends Backbone.View
    return Backbone.View.extend({
        // @property {Function} template
        template: cart_confirmation_modal_tpl    // @property {String} title
,
        title: _('Added to Cart').translate(),
        modalClass: 'global-views-modal-large'    // @property {String} page_header
,
        page_header: _('Added to Cart').translate()    // @property {Object} attributes
,
        attributes: {
            'id': 'Cart.Confirmation.View',
            'class': 'add-to-cart-confirmation-modal shopping-cart-modal'
        }    // @method initialize
,
        initialize: function () {
            this.model.on('change', this.render, this);
            BackboneCompositeView.add(this);
        },
        destroy: function destroy() {
            this.model.off('change', this.render, this);
            this._destroy();
        }    // @property {Object} childViews
,
        childViews: {
            'Line.Price': function () {
                return new TransactionLineViewsPriceView({ model: this.model });
            },
            'Line.SelectedOptions': function () {
                return new TransactionLineViewsOptionsSelectedView({ model: this.model });
            },
            'Line.Sku': function () {
                return new ProductLineSkuView({ model: this.model });
            }
        }    // @method getContext
             // @return {Cart.Confirmation.View.Context}
,
        getContext: function () {
            var item = this.model.get('item');
            // @class Cart.Confirmation.View.Context
            return {
                // @property {LiveOrder.Line.Model} model
                model: this.model,
                thumbnail: this.model.getThumbnail()    // @property {Boolean} showQuantity
,
                showQuantity: item.get('_itemType') !== 'GiftCert' && this.model.get('quantity') > 0    // @property {String} itemName
,
                itemName: item.get('_name', true)
            };
        }    // @class Cart.Confirmation.View
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Cart
define('Cart.Confirmation.Helpers', [
    'LiveOrder.Model',
    'Cart.Confirmation.View',
    'SC.Configuration',
    'ErrorManagement.ResponseErrorParser',
    'Backbone',
    'Utils',
    'jQuery',
    'underscore'
], function (LiveOrderModel, CartConfirmationView, Configuration, ErrorManagementResponseErrorParser, Backbone, Utils, jQuery, _) {
    'use strict';
    return {
        // Cart.showCartConfirmation()
        // This reads the configuration object and execs one of the functions above
        showCartConfirmation: function showCartConfirmation(cart_promise, line, application) {
            // Available values are: goToCart, showMiniCart and showCartConfirmationModal
            this['_' + Configuration.get('addToCartBehavior', 'showCartConfirmationModal')](cart_promise, line, application);
            var layout = application.getLayout();
            cart_promise.fail(function (error) {
                var output_message = '', error_object = error && error.responseJSON || {}, error_message = ErrorManagementResponseErrorParser(error, layout.errorMessageKeys);
                //if the error was caused by an extension canceling the operation, then show the error message from the back-end
                if (error_object.errorCode === 'ERR_EXT_CANCELED_OPERATION' && error_message) {
                    output_message = error_message;
                } else {
                    output_message = _('Sorry, there is a problem with this Item and can not be purchased at this time. Please check back later.').translate();
                }
                layout.showErrorInModal(output_message);
            });
        },
        _showCartConfirmationModal: function _showCartConfirmationModal(cart_promise, line, application) {
            if (line.isNew()) {
                return this._showOptimisticCartConfirmation(cart_promise, line, application);
            } else {
                cart_promise.done(function () {
                    var view = new CartConfirmationView({
                        application: application,
                        model: LiveOrderModel.getInstance().getLatestAddition()
                    });
                    view.showInModal();
                });
            }
        },
        _showOptimisticCartConfirmation: function _showOptimisticCartConfirmation(cart_promise, line, application) {
            // search the item in the cart to merge the quantities
            if (LiveOrderModel.loadCart().state() === 'resolved') {
                var cart_model = LiveOrderModel.getInstance(), cart_line = cart_model.findLine(line);
                if (cart_line) {
                    if (line.get('source') !== 'cart') {
                        cart_line.set('quantity', cart_line.get('quantity') + parseInt(line.get('quantity'), 10));
                    } else {
                        cart_line.set('quantity', line.get('quantity'));
                    }
                    cart_promise.fail(function () {
                        cart_line.set('quantity', cart_line.previous('quantity'));
                    });
                    line = cart_line;
                } else {
                    cart_model.get('lines').add(line, { at: 0 });
                    cart_promise.fail(function () {
                        cart_model.get('lines').remove(line);
                    });
                }
            }
            var view = new CartConfirmationView({
                application: application,
                model: line
            });
            cart_promise.done(function () {
                view.model = cart_model.getLatestAddition();
                view.render();
            });
            view.showInModal();
        }    // Cart.goToCart()
,
        _goToCart: function _goToCart(cart_promise) {
            cart_promise.done(function () {
                Backbone.history.navigate('cart', { trigger: true });
            });
        },
        _showMiniCart: function _showMiniCart(cart_promise, line, application) {
            var layout = application.getLayout();
            cart_promise.done(function () {
                jQuery(document).scrollTop(0);
                layout.closeModal().done(function () {
                    layout.headerViewInstance && layout.headerViewInstance.showMiniCart();
                });
            });
        }
    };
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Cart
define('Cart.AddToCart.Button.View', [
    'LiveOrder.Model',
    'LiveOrder.Line.Model',
    'Cart.Confirmation.Helpers',
    'cart_add_to_cart_button.tpl',
    'Backbone',
    'underscore',
    'Utils'
], function (LiveOrderModel, LiveOrderLineModel, CartConfirmationHelpers, cart_add_to_cart_button_tpl, Backbone, _) {
    'use strict';
    //@class Cart.AddToCart.Button.View @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: cart_add_to_cart_button_tpl,
        events: {
            'mouseup [data-type="add-to-cart"]': 'addToCart',
            'click [data-type="add-to-cart"]': 'addToCart'
        }    //@method initialize
             //@param {ProductDeatils.AddToCart.ViewCart.AddToCart.Button.View.Initialize.Options} options
             //@return {Void}
,
        initialize: function initialize() {
            Backbone.View.prototype.initialize.apply(this, arguments);
            this.cart = LiveOrderModel.getInstance();
            this.model.on('change', this.render, this);
        }    //@method destroy Override default method to detach from change event of the current model
             //@return {Void}
,
        destroy: function destroy() {
            Backbone.View.prototype.destroy.apply(this, arguments);
            this.model.off('change', this.render, this);
        }    //@method getAddToCartValidators Returns the extra validation to add a product into the cart
             //@return {BackboneValidationObject}
,
        getAddToCartValidators: function getAddToCartValidators() {
            var self = this;
            return {
                quantity: {
                    fn: function () {
                        var line_on_cart = self.cart.findLine(self.model), quantity = self.model.get('quantity'), minimum_quantity = self.model.getItem().get('_minimumQuantity') || 1, maximum_quantity = self.model.getItem().get('_maximumQuantity');
                        if (!_.isNumber(quantity) || _.isNaN(quantity) || quantity < 1) {
                            return _.translate('Invalid quantity value');
                        } else if (!line_on_cart && quantity < minimum_quantity) {
                            return _.translate('Please add $(0) or more of this item', minimum_quantity);
                        } else if (!!maximum_quantity) {
                            maximum_quantity = !line_on_cart ? maximum_quantity : maximum_quantity - line_on_cart.quantity;
                            if (quantity > maximum_quantity) {
                                return _.translate('Please add $(0) or less of this item', maximum_quantity);
                            }
                        }
                    }
                }
            };
        }    //@method submitHandler Public method that fulfill the require interface of the Main action View of the PDP
             //@param {jQuery.Event} e
             //@return {Boolean}
,
        submitHandler: function submitHandler(e) {
            return this.addToCart(e);
        }    // @method addToCart Updates the Cart to include the current model
             // also takes care of updating the cart if the current model is already in the cart
             // @param {jQuery.Event} e
             // @return {Boolean}
,
        addToCart: function addToCart(e) {
            e.preventDefault();
            var self = this, cart_promise;
            if (!this.model.areAttributesValid([
                    'options',
                    'quantity'
                ], self.getAddToCartValidators())) {
                return;
            }
            if (!this.model.isNew() && this.model.get('source') === 'cart') {
                cart_promise = this.cart.updateProduct(this.model);
                cart_promise.done(function () {
                    self.options.application.getLayout().closeModal();
                });
            } else {
                var line = LiveOrderLineModel.createFromProduct(this.model);
                cart_promise = this.cart.addLine(line);
                CartConfirmationHelpers.showCartConfirmation(cart_promise, line, self.options.application);
            }
            cart_promise.fail(function (jqXhr) {
                var error_details = null;
                try {
                    var response = JSON.parse(jqXhr.responseText);
                    error_details = response.errorDetails;
                } finally {
                    if (error_details && error_details.status === 'LINE_ROLLBACK') {
                        self.model.set('internalid', error_details.newLineId);
                    }
                }
            });
            this.disableElementsOnPromise(cart_promise, e.target);
            return false;
        }    //@method getContext
             //@return {Cart.AddToCart.Button.View.Context}
,
        getContext: function getContext() {
            //@class Cart.AddToCart.Button.View.Context
            return {
                //@property {Boolean} isCurrentItemPurchasable Indicate if the current item is valid to be purchase or not
                isCurrentItemPurchasable: this.model.getItem().get('_isPurchasable')    //@property {Boolean} isUpdate
,
                isUpdate: !this.model.isNew() && this.model.get('source') === 'cart'
            };    //@class Cart.AddToCart.Button.View
        }
    });
});    //@class Cart.AddToCart.Button.View.Initialize.Options
       //@property {Product.Model} model This view is only capable of adding new PRODUCTs into the cart.
       //If you need to add something else please convert it into a Product.Model.
       //


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductDetails
define('ProductDetails.Information.View', [
    'SC.Configuration',
    'product_details_information.tpl',
    'Backbone',
    'Utils',
    'underscore'
], function (Configuration, product_details_information_tpl, Backbone, Utils, _) {
    'use strict';
    // @class ProductDetails.Information.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_details_information_tpl,
        events: {
            'click [data-action="show-more"]': 'showMore',
            'click [data-action="selected-tab"]': 'debouncedCheckContentHeight'
        }    //@method initialize Override default method to allow passing pre-calculated details
             //@param {ProductDetails.Information.View.InitializationOptions} options
             //@return {Void}
,
        initialize: function initialize() {
            Backbone.View.prototype.initialize.apply(this, arguments);
            this.details = this.options.details;
        },
        render: function () {
            this.details = this.details || this.computeDetailsArea();
            this._render();
            if (!SC.isPageGenerator()) {
                this.debouncedCheckContentHeight();
            }
        }    // @method computeDetailsArea
             // Process what you have configured in itemDetails as item details.
             // In the PDP extra information can be shown based on the itemDetails property in the Shopping.Configuration.
             // These are extra field extracted from the item model
             //@return {Array<ProductDetails.Information.DataContainer>}
,
        computeDetailsArea: function () {
            var self = this, details = [];
            _.each(Configuration.get('productDetailsInformation', []), function (item_information) {
                var content = '';
                if (item_information.contentFromKey) {
                    content = self.model.get('item').get(item_information.contentFromKey);
                }
                var desc = self.model.get('item').get('custitem431');
                if (content && Utils.trim(content)) {
                    //@class ProductDetails.Information.DataContainer
                    details.push({
                        //@property {String} name
                        name: item_information.name,
                        content: content    //@property {String} itemprop
,
                        itemprop: item_information.itemprop
                    });    //@class ProductDetails.Information.View
                }
            });
            return details;
        },
        debouncedCheckContentHeight: function () {
            return _.defer(_.bind(this.checkContentHeight, this));
        },
        checkContentHeight: function () {
            var content_height = this.$('.active [data-type="information-content-text"]').height();
            if (content_height <= 370) {
                this.$('[data-type="information-content-text-actions"]').hide();
            } else {
                this.$('[data-type="information-content-text-actions"]').show();
            }
        }    //@method showMore Toggle the content of an options, and change the label Show Less and Show More by adding a class
             //@return {Void}
,
        showMore: function () {
            this.$('[data-type="information-content"]').toggleClass('show');
        },
        getContext: function () {
            return {
                //@property {Boolean} showInformation
                showInformation: this.details.length > 0    //@property {Boolean} showHeader
,
                showHeader: this.details.length < 2    //@property {Array<ProductDetails.Information.DataContainer>} details
,
                details: this.details
            };
        }
    });
});    //@class ProductDetails.Information.View.InitializationOptions
       //@property {Array<ProductDetails.Information.DataContainer>?} details
       //@property {Product.Model} model
       //


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductDetails
define('ProductDetails.Quantity.View', [
    'LiveOrder.Model',
    'product_details_quantity.tpl',
    'Backbone'
], function (LiveOrderModel, product_details_quantity_tpl, Backbone) {
    'use strict';
    // @class ProductDetails.Quantity.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_details_quantity_tpl,
        events: {
            'click [data-action="updateQuantity"]': 'setQuantity',
            'click [data-action="changeQuantity"]': 'setFocus',
            'keyup [data-action="changeQuantity"]': 'disableFocus'
        }    // @method setQuantity Increase the product's Quantity by 1
             // @param {jQuery.Event} e
             // @return {Void}
,
        setQuantity: function setQuantity(e) {
            e.preventDefault();
            var value = parseInt(this.$(e.currentTarget).data('value'), 10), $input_quantity = this.$('[name="quantity"]'), old_value = parseInt($input_quantity.val(), 10), new_quantity = old_value + value;
            $input_quantity.val(new_quantity).trigger('blur');
        }    // @method setFocus sets focus on input when clicked. Needed as FF won't focus if quantity is updated from spinners
             // @return {Void}
,
        setFocus: function setFocus() {
            this.$('[name="quantity"]').focus();
        }    // @method disableFocus Blur if ENTER/RETURN key is pressed
             // @return {Void}
,
        disableFocus: function disableFocus(e) {
            if (e.keyCode === 13) {
                this.$('[name="quantity"]').blur();
            }
        }    //@method getContext
             //@return {ProductDetails.Quantity.View.Context}
,
        getContext: function getContext() {
            //@class ProductDetails.Quantity.View.Context
            return {
                //@property {Product.Model} model
                model: this.model,
                showQuantity: this.model.get('item').get('_itemType') !== 'GiftCert'    //@property {Boolean} isMinusButtonDisabled
,
                isMinusButtonDisabled: this.model.get('quantity') <= 1
            };    //@class ProductDetails.Quantity.View
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('Utilities.ResizeImage', [
    'SC.Configuration',
    'Utils',
    'underscore'
], function (Configuration, Utils, _) {
    'use strict';
    return function resizeImage(url, size) {
        url = url || Utils.getThemeAbsoluteUrlOfNonManagedResources('img/no_image_available.jpeg', Configuration.get('imageNotAvailable'));
        size = Configuration['imageSizeMapping.' + size] || size;
        var resize = _.first(_.where(Configuration.get('siteSettings.imagesizes', []), { name: size }));
        if (!!resize) {
            return url + (~url.indexOf('?') ? '&' : '?') + resize.urlsuffix;
        }
        return url;
    };
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module SocialSharing
define('SocialSharing.Flyout.Hover.View', [
    'social_sharing_flyout_hover.tpl',
    'Backbone'
], function (social_sharing_flyout_hover_tpl, Backbone) {
    'use strict';
    // @class SocialSharing.Flyout.Hover.View @extends Backbone.View
    return Backbone.View.extend({
        template: social_sharing_flyout_hover_tpl    // @method getContext @returns {SocialSharing.Flyout.Hover.View.Context}
,
        getContext: function () {
            // @class SocialSharing.Flyout.Hover.View.Context
            return {};
        }
    });
});

/*!
	Zoom 1.7.20
	license: MIT
	http://www.jacklmoore.com/zoom
*/
define('jquery.zoom', ['jQuery'], function () {
    (function ($) {
        var defaults = {
            url: false,
            callback: false,
            target: false,
            duration: 120,
            on: 'mouseover',
            // other options: grab, click, toggle
            touch: true,
            // enables a touch fallback
            onZoomIn: false,
            onZoomOut: false,
            magnify: 1
        };
        // Core Zoom Logic, independent of event listeners.
        $.zoom = function (target, source, img, magnify) {
            var targetHeight, targetWidth, sourceHeight, sourceWidth, xRatio, yRatio, offset, $target = $(target), position = $target.css('position'), $source = $(source);
            // The parent element needs positioning so that the zoomed element can be correctly positioned within.
            target.style.position = /(absolute|fixed)/.test(position) ? position : 'relative';
            target.style.overflow = 'hidden';
            img.style.width = img.style.height = '';
            $(img).addClass('zoomImg').css({
                position: 'absolute',
                top: 0,
                left: 0,
                opacity: 0,
                width: img.width * magnify,
                height: img.height * magnify,
                border: 'none',
                maxWidth: 'none',
                maxHeight: 'none'
            }).appendTo(target);
            return {
                init: function () {
                    targetWidth = $target.outerWidth();
                    targetHeight = $target.outerHeight();
                    if (source === target) {
                        sourceWidth = targetWidth;
                        sourceHeight = targetHeight;
                    } else {
                        sourceWidth = $source.outerWidth();
                        sourceHeight = $source.outerHeight();
                    }
                    xRatio = (img.width - targetWidth) / sourceWidth;
                    yRatio = (img.height - targetHeight) / sourceHeight;
                    offset = $source.offset();
                },
                move: function (e) {
                    var left = e.pageX - offset.left, top = e.pageY - offset.top;
                    top = Math.max(Math.min(top, sourceHeight), 0);
                    left = Math.max(Math.min(left, sourceWidth), 0);
                    img.style.left = left * -xRatio + 'px';
                    img.style.top = top * -yRatio + 'px';
                }
            };
        };
        $.fn.zoom = function (options) {
            return this.each(function () {
                var settings = $.extend({}, defaults, options || {}),
                    //target will display the zoomed image
                    target = settings.target && $(settings.target)[0] || this,
                    //source will provide zoom location info (thumbnail)
                    source = this, $source = $(source), img = document.createElement('img'), $img = $(img), mousemove = 'mousemove.zoom', clicked = false, touched = false;
                // If a url wasn't specified, look for an image element.
                if (!settings.url) {
                    var srcElement = source.querySelector('img');
                    if (srcElement) {
                        settings.url = srcElement.getAttribute('data-src') || srcElement.currentSrc || srcElement.src;
                    }
                    if (!settings.url) {
                        return;
                    }
                }
                $source.one('zoom.destroy', function (position, overflow) {
                    $source.off('.zoom');
                    target.style.position = position;
                    target.style.overflow = overflow;
                    img.onload = null;
                    $img.remove();
                }.bind(this, target.style.position, target.style.overflow));
                img.onload = function () {
                    var zoom = $.zoom(target, source, img, settings.magnify);
                    function start(e) {
                        zoom.init();
                        zoom.move(e);
                        // Skip the fade-in for IE8 and lower since it chokes on fading-in
                        // and changing position based on mousemovement at the same time.
                        $img.stop().fadeTo($.support.opacity ? settings.duration : 0, 1, $.isFunction(settings.onZoomIn) ? settings.onZoomIn.call(img) : false);
                    }
                    function stop() {
                        $img.stop().fadeTo(settings.duration, 0, $.isFunction(settings.onZoomOut) ? settings.onZoomOut.call(img) : false);
                    }
                    // Mouse events
                    if (settings.on === 'grab') {
                        $source.on('mousedown.zoom', function (e) {
                            if (e.which === 1) {
                                $(document).one('mouseup.zoom', function () {
                                    stop();
                                    $(document).off(mousemove, zoom.move);
                                });
                                start(e);
                                $(document).on(mousemove, zoom.move);
                                e.preventDefault();
                            }
                        });
                    } else if (settings.on === 'click') {
                        $source.on('click.zoom', function (e) {
                            if (clicked) {
                                // bubble the event up to the document to trigger the unbind.
                                return;
                            } else {
                                clicked = true;
                                start(e);
                                $(document).on(mousemove, zoom.move);
                                $(document).one('click.zoom', function () {
                                    stop();
                                    clicked = false;
                                    $(document).off(mousemove, zoom.move);
                                });
                                return false;
                            }
                        });
                    } else if (settings.on === 'toggle') {
                        $source.on('click.zoom', function (e) {
                            if (clicked) {
                                stop();
                            } else {
                                start(e);
                            }
                            clicked = !clicked;
                        });
                    } else if (settings.on === 'mouseover') {
                        zoom.init();
                        // Preemptively call init because IE7 will fire the mousemove handler before the hover handler.
                        $source.on('mouseenter.zoom', start).on('mouseleave.zoom', stop).on(mousemove, zoom.move);
                    }
                    // Touch fallback
                    if (settings.touch) {
                        $source.on('touchstart.zoom', function (e) {
                            e.preventDefault();
                            if (touched) {
                                touched = false;
                                stop();
                            } else {
                                touched = true;
                                start(e.originalEvent.touches[0] || e.originalEvent.changedTouches[0]);
                            }
                        }).on('touchmove.zoom', function (e) {
                            e.preventDefault();
                            zoom.move(e.originalEvent.touches[0] || e.originalEvent.changedTouches[0]);
                        }).on('touchend.zoom', function (e) {
                            e.preventDefault();
                            if (touched) {
                                touched = false;
                                stop();
                            }
                        });
                    }
                    if ($.isFunction(settings.callback)) {
                        settings.callback.call(img);
                    }
                };
                img.setAttribute('role', 'presentation');
                img.src = settings.url;
            });
        };
        $.fn.zoom.defaults = defaults;
    }(window.jQuery));
    return;
});
/**
 * BxSlider v4.1.1 - Fully loaded, responsive content slider
 * http://bxslider.com
 *
 * Copyright 2012, Steven Wanderski - http://stevenwanderski.com - http://bxcreative.com
 * Written while drinking Belgian ales and listening to jazz
 *
 * Released under the WTFPL license - http://sam.zoy.org/wtfpl/
 */
define('jQuery.bxSlider', ['jQuery'], function () {
    ;
    (function ($) {
        var plugin = {};
        var defaults = {
            // GENERAL
            mode: 'horizontal',
            slideSelector: '',
            infiniteLoop: true,
            hideControlOnEnd: false,
            speed: 500,
            easing: null,
            slideMargin: 0,
            startSlide: 0,
            randomStart: false,
            captions: false,
            ticker: false,
            tickerHover: false,
            adaptiveHeight: false,
            adaptiveHeightSpeed: 500,
            video: false,
            useCSS: true,
            preloadImages: 'visible',
            responsive: true,
            slideZIndex: 50,
            wrapperClass: 'bx-wrapper',
            // TOUCH
            touchEnabled: true,
            swipeThreshold: 50,
            oneToOneTouch: true,
            preventDefaultSwipeX: true,
            preventDefaultSwipeY: false,
            // PAGER
            pager: true,
            pagerType: 'full',
            pagerShortSeparator: ' / ',
            pagerSelector: null,
            buildPager: null,
            pagerCustom: null,
            // CONTROLS
            controls: true,
            nextText: 'Next',
            prevText: 'Prev',
            nextSelector: null,
            prevSelector: null,
            autoControls: false,
            startText: 'Start',
            stopText: 'Stop',
            autoControlsCombine: false,
            autoControlsSelector: null,
            // AUTO
            auto: false,
            pause: 4000,
            autoStart: true,
            autoDirection: 'next',
            autoHover: false,
            autoDelay: 0,
            autoSlideForOnePage: false,
            // CAROUSEL
            minSlides: 1,
            maxSlides: 1,
            moveSlides: 0,
            slideWidth: 0,
            // CALLBACKS
            onSliderLoad: function () {
            },
            onSlideBefore: function () {
            },
            onSlideAfter: function () {
            },
            onSlideNext: function () {
            },
            onSlidePrev: function () {
            },
            onSliderResize: function () {
            }
        };
        $.fn.bxSlider = function (options) {
            if (this.length == 0)
                return this;
            // support mutltiple elements
            if (this.length > 1) {
                this.each(function () {
                    $(this).bxSlider(options);
                });
                return this;
            }
            // create a namespace to be used throughout the plugin
            var slider = {};
            // set a reference to our slider element
            var el = this;
            plugin.el = this;
            /**
		 * Makes slideshow responsive
		 */
            // first get the original window dimens (thanks alot IE)
            var windowWidth = $(window).width();
            var windowHeight = $(window).height();
            /**
		 * ===================================================================================
		 * = PRIVATE FUNCTIONS
		 * ===================================================================================
		 */
            /**
		 * Initializes namespace settings to be used throughout plugin
		 */
            var init = function () {
                // merge user-supplied options with the defaults
                slider.settings = $.extend({}, defaults, options);
                // parse slideWidth setting
                slider.settings.slideWidth = parseInt(slider.settings.slideWidth);
                // store the original children
                slider.children = el.children(slider.settings.slideSelector);
                // check if actual number of slides is less than minSlides / maxSlides
                if (slider.children.length < slider.settings.minSlides)
                    slider.settings.minSlides = slider.children.length;
                if (slider.children.length < slider.settings.maxSlides)
                    slider.settings.maxSlides = slider.children.length;
                // if random start, set the startSlide setting to random number
                if (slider.settings.randomStart)
                    slider.settings.startSlide = Math.floor(Math.random() * slider.children.length);
                // store active slide information
                slider.active = { index: slider.settings.startSlide };
                // store if the slider is in carousel mode (displaying / moving multiple slides)
                slider.carousel = slider.settings.minSlides > 1 || slider.settings.maxSlides > 1;
                // if carousel, force preloadImages = 'all'
                if (slider.carousel)
                    slider.settings.preloadImages = 'all';
                // calculate the min / max width thresholds based on min / max number of slides
                // used to setup and update carousel slides dimensions
                slider.minThreshold = slider.settings.minSlides * slider.settings.slideWidth + (slider.settings.minSlides - 1) * slider.settings.slideMargin;
                slider.maxThreshold = slider.settings.maxSlides * slider.settings.slideWidth + (slider.settings.maxSlides - 1) * slider.settings.slideMargin;
                // store the current state of the slider (if currently animating, working is true)
                slider.working = false;
                // initialize the controls object
                slider.controls = {};
                // initialize an auto interval
                slider.interval = null;
                // determine which property to use for transitions
                slider.animProp = slider.settings.mode == 'vertical' ? 'top' : 'left';
                // determine if hardware acceleration can be used
                slider.usingCSS = slider.settings.useCSS && slider.settings.mode != 'fade' && function () {
                    // create our test div element
                    var div = document.createElement('div');
                    // css transition properties
                    var props = [
                        'WebkitPerspective',
                        'MozPerspective',
                        'OPerspective',
                        'msPerspective'
                    ];
                    // test for each property
                    for (var i in props) {
                        if (div.style[props[i]] !== undefined) {
                            slider.cssPrefix = props[i].replace('Perspective', '').toLowerCase();
                            slider.animProp = '-' + slider.cssPrefix + '-transform';
                            return true;
                        }
                    }
                    return false;
                }();
                // if vertical mode always make maxSlides and minSlides equal
                if (slider.settings.mode == 'vertical')
                    slider.settings.maxSlides = slider.settings.minSlides;
                // save original style data
                el.data('origStyle', el.attr('style'));
                el.children(slider.settings.slideSelector).each(function () {
                    $(this).data('origStyle', $(this).attr('style'));
                });
                // perform all DOM / CSS modifications
                setup();
            };
            /**
		 * Performs all DOM and CSS modifications
		 */
            var setup = function () {
                // wrap el in a wrapper
                el.wrap('<div class="' + slider.settings.wrapperClass + '"><div class="bx-viewport"></div></div>');
                // store a namspace reference to .bx-viewport
                slider.viewport = el.parent();
                // add a loading div to display while images are loading
                slider.loader = $('<div class="bx-loading" />');
                slider.viewport.prepend(slider.loader);
                // set el to a massive width, to hold any needed slides
                // also strip any margin and padding from el
                el.css({
                    width: slider.settings.mode == 'horizontal' ? slider.children.length * 100 + 215 + '%' : 'auto',
                    position: 'relative'
                });
                // if using CSS, add the easing property
                if (slider.usingCSS && slider.settings.easing) {
                    el.css('-' + slider.cssPrefix + '-transition-timing-function', slider.settings.easing);    // if not using CSS and no easing value was supplied, use the default JS animation easing (swing)
                } else if (!slider.settings.easing) {
                    slider.settings.easing = 'swing';
                }
                var slidesShowing = getNumberSlidesShowing();
                // make modifications to the viewport (.bx-viewport)
                slider.viewport.css({
                    width: '100%',
                    overflow: 'hidden',
                    position: 'relative'
                });
                slider.viewport.parent().css({ maxWidth: getViewportMaxWidth() });
                // make modification to the wrapper (.bx-wrapper)
                if (!slider.settings.pager) {
                    slider.viewport.parent().css({ margin: '0 auto 0px' });
                }
                // apply css to all slider children
                slider.children.css({
                    'float': slider.settings.mode == 'horizontal' ? 'left' : 'none',
                    listStyle: 'none',
                    position: 'relative'
                });
                // apply the calculated width after the float is applied to prevent scrollbar interference
                slider.children.css('width', getSlideWidth());
                // if slideMargin is supplied, add the css
                if (slider.settings.mode == 'horizontal' && slider.settings.slideMargin > 0)
                    slider.children.css('marginRight', slider.settings.slideMargin);
                if (slider.settings.mode == 'vertical' && slider.settings.slideMargin > 0)
                    slider.children.css('marginBottom', slider.settings.slideMargin);
                // if "fade" mode, add positioning and z-index CSS
                if (slider.settings.mode == 'fade') {
                    slider.children.css({
                        position: 'absolute',
                        zIndex: 0,
                        display: 'none'
                    });
                    // prepare the z-index on the showing element
                    slider.children.eq(slider.settings.startSlide).css({
                        zIndex: slider.settings.slideZIndex,
                        display: 'block'
                    });
                }
                // create an element to contain all slider controls (pager, start / stop, etc)
                slider.controls.el = $('<div class="bx-controls" />');
                // if captions are requested, add them
                if (slider.settings.captions)
                    appendCaptions();
                // check if startSlide is last slide
                slider.active.last = slider.settings.startSlide == getPagerQty() - 1;
                // if video is true, set up the fitVids plugin
                if (slider.settings.video)
                    el.fitVids();
                // set the default preload selector (visible)
                var preloadSelector = slider.children.eq(slider.settings.startSlide);
                if (slider.settings.preloadImages == 'all')
                    preloadSelector = slider.children;
                // only check for control addition if not in "ticker" mode
                if (!slider.settings.ticker) {
                    // if pager is requested, add it
                    if (slider.settings.pager)
                        appendPager();
                    // if controls are requested, add them
                    if (slider.settings.controls)
                        appendControls();
                    // if auto is true, and auto controls are requested, add them
                    if (slider.settings.auto && slider.settings.autoControls)
                        appendControlsAuto();
                    // if any control option is requested, add the controls wrapper
                    if (slider.settings.controls || slider.settings.autoControls || slider.settings.pager)
                        slider.viewport.after(slider.controls.el);    // if ticker mode, do not allow a pager
                } else {
                    slider.settings.pager = false;
                }
                // CUSTOM: the following 3 lines are a customization
                if (slider.settings.forceStart)
                    start();
                else
                    // preload all images, then perform final DOM / CSS modifications that depend on images being loaded
                    loadElements(preloadSelector, start);
            };
            var loadElements = function (selector, callback) {
                var total = selector.find('img, iframe').length;
                if (total == 0) {
                    callback();
                    return;
                }
                var count = 0;
                selector.find('img, iframe').each(function () {
                    // CUSTOM: remove time stamp, we want images to be cached
                    // if($(this).is('img')) $(this).attr('src', $(this).attr('src') + '?timestamp=' + new Date().getTime());
                    $(this).load(function () {
                        setTimeout(function () {
                            if (++count == total)
                                callback();
                        }, 0);
                    });
                });
            };
            /**
		 * Start the slider
		 */
            var start = function () {
                // if infinite loop, prepare additional slides
                if (slider.settings.infiniteLoop && slider.settings.mode != 'fade' && !slider.settings.ticker) {
                    var slice = slider.settings.mode == 'vertical' ? slider.settings.minSlides : slider.settings.maxSlides;
                    var sliceAppend = slider.children.slice(0, slice).clone().addClass('bx-clone');
                    var slicePrepend = slider.children.slice(-slice).clone().addClass('bx-clone');
                    el.append(sliceAppend).prepend(slicePrepend);
                }
                // remove the loading DOM element
                slider.loader.remove();
                // set the left / top position of "el"
                setSlidePosition();
                // if "vertical" mode, always use adaptiveHeight to prevent odd behavior
                if (slider.settings.mode == 'vertical')
                    slider.settings.adaptiveHeight = true;
                // set the viewport height
                slider.viewport.height(getViewportHeight());
                // make sure everything is positioned just right (same as a window resize)
                el.redrawSlider();
                // onSliderLoad callback
                slider.settings.onSliderLoad(slider.active.index);
                // slider has been fully initialized
                slider.initialized = true;
                // bind the resize call to the window
                if (slider.settings.responsive)
                    $(window).bind('resize', resizeWindow);
                // if auto is true and has more than 1 page, start the show
                if (slider.settings.auto && slider.settings.autoStart && (getPagerQty() > 1 || slider.settings.autoSlideForOnePage))
                    initAuto();
                // if ticker is true, start the ticker
                if (slider.settings.ticker)
                    initTicker();
                // if pager is requested, make the appropriate pager link active
                if (slider.settings.pager)
                    updatePagerActive(slider.settings.startSlide);
                // check for any updates to the controls (like hideControlOnEnd updates)
                if (slider.settings.controls)
                    updateDirectionControls();
                // if touchEnabled is true, setup the touch events
                if (slider.settings.touchEnabled && !slider.settings.ticker)
                    initTouch();
            };
            /**
		 * Returns the calculated height of the viewport, used to determine either adaptiveHeight or the maxHeight value
		 */
            var getViewportHeight = function () {
                var height = 0;
                // first determine which children (slides) should be used in our height calculation
                var children = $();
                // if mode is not "vertical" and adaptiveHeight is false, include all children
                if (slider.settings.mode != 'vertical' && !slider.settings.adaptiveHeight) {
                    children = slider.children;
                } else {
                    // if not carousel, return the single active child
                    if (!slider.carousel) {
                        children = slider.children.eq(slider.active.index);    // if carousel, return a slice of children
                    } else {
                        // get the individual slide index
                        var currentIndex = slider.settings.moveSlides == 1 ? slider.active.index : slider.active.index * getMoveBy();
                        // add the current slide to the children
                        children = slider.children.eq(currentIndex);
                        // cycle through the remaining "showing" slides
                        for (i = 1; i <= slider.settings.maxSlides - 1; i++) {
                            // if looped back to the start
                            if (currentIndex + i >= slider.children.length) {
                                children = children.add(slider.children.eq(i - 1));
                            } else {
                                children = children.add(slider.children.eq(currentIndex + i));
                            }
                        }
                    }
                }
                // if "vertical" mode, calculate the sum of the heights of the children
                if (slider.settings.mode == 'vertical') {
                    children.each(function (index) {
                        height += $(this).outerHeight();
                    });
                    // add user-supplied margins
                    if (slider.settings.slideMargin > 0) {
                        height += slider.settings.slideMargin * (slider.settings.minSlides - 1);
                    }    // if not "vertical" mode, calculate the max height of the children
                } else {
                    height = Math.max.apply(Math, children.map(function () {
                        return $(this).outerHeight(false);
                    }).get());
                }
                if (slider.viewport.css('box-sizing') == 'border-box') {
                    height += parseFloat(slider.viewport.css('padding-top')) + parseFloat(slider.viewport.css('padding-bottom')) + parseFloat(slider.viewport.css('border-top-width')) + parseFloat(slider.viewport.css('border-bottom-width'));
                } else if (slider.viewport.css('box-sizing') == 'padding-box') {
                    height += parseFloat(slider.viewport.css('padding-top')) + parseFloat(slider.viewport.css('padding-bottom'));
                }
                return height;
            };
            /**
		 * Returns the calculated width to be used for the outer wrapper / viewport
		 */
            var getViewportMaxWidth = function () {
                var width = '100%';
                if (slider.settings.slideWidth > 0) {
                    if (slider.settings.mode == 'horizontal') {
                        width = slider.settings.maxSlides * slider.settings.slideWidth + (slider.settings.maxSlides - 1) * slider.settings.slideMargin;
                    } else {
                        width = slider.settings.slideWidth;
                    }
                }
                return width;
            };
            /**
		 * Returns the calculated width to be applied to each slide
		 */
            var getSlideWidth = function () {
                // start with any user-supplied slide width
                var newElWidth = slider.settings.slideWidth;
                // get the current viewport width
                var wrapWidth = slider.viewport.width();
                // if slide width was not supplied, or is larger than the viewport use the viewport width
                if (slider.settings.slideWidth == 0 || slider.settings.slideWidth > wrapWidth && !slider.carousel || slider.settings.mode == 'vertical') {
                    newElWidth = wrapWidth;    // if carousel, use the thresholds to determine the width
                } else if (slider.settings.maxSlides > 1 && slider.settings.mode == 'horizontal') {
                    if (wrapWidth > slider.maxThreshold) {
                    } else if (wrapWidth < slider.minThreshold) {
                        newElWidth = (wrapWidth - slider.settings.slideMargin * (slider.settings.minSlides - 1)) / slider.settings.minSlides;
                    }
                }
                return newElWidth;
            };
            /**
		 * Returns the number of slides currently visible in the viewport (includes partially visible slides)
		 */
            var getNumberSlidesShowing = function () {
                var slidesShowing = 1;
                if (slider.settings.mode == 'horizontal' && slider.settings.slideWidth > 0) {
                    // if viewport is smaller than minThreshold, return minSlides
                    if (slider.viewport.width() < slider.minThreshold) {
                        slidesShowing = slider.settings.minSlides;    // if viewport is larger than minThreshold, return maxSlides
                    } else if (slider.viewport.width() > slider.maxThreshold) {
                        slidesShowing = slider.settings.maxSlides;    // if viewport is between min / max thresholds, divide viewport width by first child width
                    } else {
                        var childWidth = slider.children.first().width() + slider.settings.slideMargin;
                        slidesShowing = Math.floor((slider.viewport.width() + slider.settings.slideMargin) / childWidth);
                    }    // if "vertical" mode, slides showing will always be minSlides
                } else if (slider.settings.mode == 'vertical') {
                    slidesShowing = slider.settings.minSlides;
                }
                return slidesShowing;
            };
            /**
		 * Returns the number of pages (one full viewport of slides is one "page")
		 */
            var getPagerQty = function () {
                var pagerQty = 0;
                // if moveSlides is specified by the user
                if (slider.settings.moveSlides > 0) {
                    if (slider.settings.infiniteLoop) {
                        pagerQty = Math.ceil(slider.children.length / getMoveBy());
                    } else {
                        // use a while loop to determine pages
                        var breakPoint = 0;
                        var counter = 0;
                        // when breakpoint goes above children length, counter is the number of pages
                        while (breakPoint < slider.children.length) {
                            ++pagerQty;
                            breakPoint = counter + getNumberSlidesShowing();
                            counter += slider.settings.moveSlides <= getNumberSlidesShowing() ? slider.settings.moveSlides : getNumberSlidesShowing();
                        }
                    }    // if moveSlides is 0 (auto) divide children length by sides showing, then round up
                } else {
                    pagerQty = Math.ceil(slider.children.length / getNumberSlidesShowing());
                }
                return pagerQty;
            };
            /**
		 * Returns the number of indivual slides by which to shift the slider
		 */
            var getMoveBy = function () {
                // if moveSlides was set by the user and moveSlides is less than number of slides showing
                if (slider.settings.moveSlides > 0 && slider.settings.moveSlides <= getNumberSlidesShowing()) {
                    return slider.settings.moveSlides;
                }
                // if moveSlides is 0 (auto)
                return getNumberSlidesShowing();
            };
            /**
		 * Sets the slider's (el) left or top position
		 */
            var setSlidePosition = function () {
                // if last slide, not infinite loop, and number of children is larger than specified maxSlides
                if (slider.children.length > slider.settings.maxSlides && slider.active.last && !slider.settings.infiniteLoop) {
                    if (slider.settings.mode == 'horizontal') {
                        // get the last child's position
                        var lastChild = slider.children.last();
                        var position = lastChild.position();
                        // set the left position
                        setPositionProperty(-(position.left - (slider.viewport.width() - lastChild.outerWidth())), 'reset', 0);
                    } else if (slider.settings.mode == 'vertical') {
                        // get the last showing index's position
                        var lastShowingIndex = slider.children.length - slider.settings.minSlides;
                        var position = slider.children.eq(lastShowingIndex).position();
                        // set the top position
                        setPositionProperty(-position.top, 'reset', 0);
                    }    // if not last slide
                } else {
                    // get the position of the first showing slide
                    var position = slider.children.eq(slider.active.index * getMoveBy()).position();
                    // check for last slide
                    if (slider.active.index == getPagerQty() - 1)
                        slider.active.last = true;
                    // set the repective position
                    if (position != undefined) {
                        if (slider.settings.mode == 'horizontal')
                            setPositionProperty(-position.left, 'reset', 0);
                        else if (slider.settings.mode == 'vertical')
                            setPositionProperty(-position.top, 'reset', 0);
                    }
                }
            };
            /**
		 * Sets the el's animating property position (which in turn will sometimes animate el).
		 * If using CSS, sets the transform property. If not using CSS, sets the top / left property.
		 *
		 * @param value (int)
		 *  - the animating property's value
		 *
		 * @param type (string) 'slider', 'reset', 'ticker'
		 *  - the type of instance for which the function is being
		 *
		 * @param duration (int)
		 *  - the amount of time (in ms) the transition should occupy
		 *
		 * @param params (array) optional
		 *  - an optional parameter containing any variables that need to be passed in
		 */
            var setPositionProperty = function (value, type, duration, params) {
                // use CSS transform
                if (slider.usingCSS) {
                    // determine the translate3d value
                    var propValue = slider.settings.mode == 'vertical' ? 'translate3d(0, ' + value + 'px, 0)' : 'translate3d(' + value + 'px, 0, 0)';
                    // add the CSS transition-duration
                    el.css('-' + slider.cssPrefix + '-transition-duration', duration / 1000 + 's');
                    if (type == 'slide') {
                        // set the property value
                        el.css(slider.animProp, propValue);
                        // bind a callback method - executes when CSS transition completes
                        el.bind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd', function () {
                            // unbind the callback
                            el.unbind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd');
                            updateAfterSlideTransition();
                        });
                    } else if (type == 'reset') {
                        el.css(slider.animProp, propValue);
                    } else if (type == 'ticker') {
                        // make the transition use 'linear'
                        el.css('-' + slider.cssPrefix + '-transition-timing-function', 'linear');
                        el.css(slider.animProp, propValue);
                        // bind a callback method - executes when CSS transition completes
                        el.bind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd', function () {
                            // unbind the callback
                            el.unbind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd');
                            // reset the position
                            setPositionProperty(params['resetValue'], 'reset', 0);
                            // start the loop again
                            tickerLoop();
                        });
                    }    // use JS animate
                } else {
                    var animateObj = {};
                    animateObj[slider.animProp] = value;
                    if (type == 'slide') {
                        el.animate(animateObj, duration, slider.settings.easing, function () {
                            updateAfterSlideTransition();
                        });
                    } else if (type == 'reset') {
                        el.css(slider.animProp, value);
                    } else if (type == 'ticker') {
                        el.animate(animateObj, speed, 'linear', function () {
                            setPositionProperty(params['resetValue'], 'reset', 0);
                            // run the recursive loop after animation
                            tickerLoop();
                        });
                    }
                }
            };
            /**
		 * Populates the pager with proper amount of pages
		 */
            var populatePager = function () {
                var pagerHtml = '';
                var pagerQty = getPagerQty();
                // loop through each pager item
                for (var i = 0; i < pagerQty; i++) {
                    var linkContent = '';
                    // if a buildPager function is supplied, use it to get pager link value, else use index + 1
                    if (slider.settings.buildPager && $.isFunction(slider.settings.buildPager)) {
                        linkContent = slider.settings.buildPager(i);
                        slider.pagerEl.addClass('bx-custom-pager');
                    } else {
                        linkContent = i + 1;
                        slider.pagerEl.addClass('bx-default-pager');
                    }
                    // var linkContent = slider.settings.buildPager && $.isFunction(slider.settings.buildPager) ? slider.settings.buildPager(i) : i + 1;
                    // add the markup to the string
                    pagerHtml += '<div class="bx-pager-item"><a href="" data-slide-index="' + i + '" class="bx-pager-link">' + linkContent + '</a></div>';
                }
                ;
                // populate the pager element with pager links
                slider.pagerEl.html(pagerHtml);
            };
            /**
		 * Appends the pager to the controls element
		 */
            var appendPager = function () {
                if (!slider.settings.pagerCustom) {
                    // create the pager DOM element
                    slider.pagerEl = $('<div class="bx-pager" />');
                    // if a pager selector was supplied, populate it with the pager
                    if (slider.settings.pagerSelector) {
                        $(slider.settings.pagerSelector).html(slider.pagerEl);    // if no pager selector was supplied, add it after the wrapper
                    } else {
                        slider.controls.el.addClass('bx-has-pager').append(slider.pagerEl);
                    }
                    // populate the pager
                    populatePager();
                } else {
                    slider.pagerEl = $(slider.settings.pagerCustom);
                }
                // assign the pager click binding
                slider.pagerEl.on('click', 'a', clickPagerBind);
            };
            /**
		 * Appends prev / next controls to the controls element
		 */
            var appendControls = function () {
                slider.controls.next = $('<a class="bx-next" href="">' + slider.settings.nextText + '</a>');
                slider.controls.prev = $('<a class="bx-prev" href="">' + slider.settings.prevText + '</a>');
                // bind click actions to the controls
                slider.controls.next.bind('click', clickNextBind);
                slider.controls.prev.bind('click', clickPrevBind);
                // if nextSlector was supplied, populate it
                if (slider.settings.nextSelector) {
                    $(slider.settings.nextSelector).append(slider.controls.next);
                }
                // if prevSlector was supplied, populate it
                if (slider.settings.prevSelector) {
                    $(slider.settings.prevSelector).append(slider.controls.prev);
                }
                // if no custom selectors were supplied
                if (!slider.settings.nextSelector && !slider.settings.prevSelector) {
                    // add the controls to the DOM
                    slider.controls.directionEl = $('<div class="bx-controls-direction" />');
                    // add the control elements to the directionEl
                    slider.controls.directionEl.append(slider.controls.prev).append(slider.controls.next);
                    // slider.viewport.append(slider.controls.directionEl);
                    slider.controls.el.addClass('bx-has-controls-direction').append(slider.controls.directionEl);
                }
            };
            /**
		 * Appends start / stop auto controls to the controls element
		 */
            var appendControlsAuto = function () {
                slider.controls.start = $('<div class="bx-controls-auto-item"><a class="bx-start" href="">' + slider.settings.startText + '</a></div>');
                slider.controls.stop = $('<div class="bx-controls-auto-item"><a class="bx-stop" href="">' + slider.settings.stopText + '</a></div>');
                // add the controls to the DOM
                slider.controls.autoEl = $('<div class="bx-controls-auto" />');
                // bind click actions to the controls
                slider.controls.autoEl.on('click', '.bx-start', clickStartBind);
                slider.controls.autoEl.on('click', '.bx-stop', clickStopBind);
                // if autoControlsCombine, insert only the "start" control
                if (slider.settings.autoControlsCombine) {
                    slider.controls.autoEl.append(slider.controls.start);    // if autoControlsCombine is false, insert both controls
                } else {
                    slider.controls.autoEl.append(slider.controls.start).append(slider.controls.stop);
                }
                // if auto controls selector was supplied, populate it with the controls
                if (slider.settings.autoControlsSelector) {
                    $(slider.settings.autoControlsSelector).html(slider.controls.autoEl);    // if auto controls selector was not supplied, add it after the wrapper
                } else {
                    slider.controls.el.addClass('bx-has-controls-auto').append(slider.controls.autoEl);
                }
                // update the auto controls
                updateAutoControls(slider.settings.autoStart ? 'stop' : 'start');
            };
            /**
		 * Appends image captions to the DOM
		 */
            var appendCaptions = function () {
                // cycle through each child
                slider.children.each(function (index) {
                    // get the image title attribute
                    var title = $(this).find('img:first').attr('title');
                    // append the caption
                    if (title != undefined && ('' + title).length) {
                        $(this).append('<div class="bx-caption"><span>' + title + '</span></div>');
                    }
                });
            };
            /**
		 * Click next binding
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
            var clickNextBind = function (e) {
                // if auto show is running, stop it
                if (slider.settings.auto)
                    el.stopAuto();
                el.goToNextSlide();
                e.preventDefault();
            };
            /**
		 * Click prev binding
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
            var clickPrevBind = function (e) {
                // if auto show is running, stop it
                if (slider.settings.auto)
                    el.stopAuto();
                el.goToPrevSlide();
                e.preventDefault();
            };
            /**
		 * Click start binding
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
            var clickStartBind = function (e) {
                el.startAuto();
                e.preventDefault();
            };
            /**
		 * Click stop binding
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
            var clickStopBind = function (e) {
                el.stopAuto();
                e.preventDefault();
            };
            /**
		 * Click pager binding
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
            var clickPagerBind = function (e) {
                // if auto show is running, stop it
                if (slider.settings.auto)
                    el.stopAuto();
                var pagerLink = $(e.currentTarget);
                if (pagerLink.attr('data-slide-index') !== undefined) {
                    var pagerIndex = parseInt(pagerLink.attr('data-slide-index'));
                    // if clicked pager link is not active, continue with the goToSlide call
                    if (pagerIndex != slider.active.index)
                        el.goToSlide(pagerIndex);
                    e.preventDefault();
                }
            };
            /**
		 * Updates the pager links with an active class
		 *
		 * @param slideIndex (int)
		 *  - index of slide to make active
		 */
            var updatePagerActive = function (slideIndex) {
                // if "short" pager type
                var len = slider.children.length;
                // nb of children
                if (slider.settings.pagerType == 'short') {
                    if (slider.settings.maxSlides > 1) {
                        len = Math.ceil(slider.children.length / slider.settings.maxSlides);
                    }
                    slider.pagerEl.html(slideIndex + 1 + slider.settings.pagerShortSeparator + len);
                    return;
                }
                // remove all pager active classes
                slider.pagerEl.find('a').removeClass('active');
                // apply the active class for all pagers
                slider.pagerEl.each(function (i, el) {
                    $(el).find('a').eq(slideIndex).addClass('active');
                });
            };
            /**
		 * Performs needed actions after a slide transition
		 */
            var updateAfterSlideTransition = function () {
                // if infinte loop is true
                if (slider.settings.infiniteLoop) {
                    var position = '';
                    // first slide
                    if (slider.active.index == 0) {
                        // set the new position
                        position = slider.children.eq(0).position();    // carousel, last slide
                    } else if (slider.active.index == getPagerQty() - 1 && slider.carousel) {
                        position = slider.children.eq((getPagerQty() - 1) * getMoveBy()).position();    // last slide
                    } else if (slider.active.index == slider.children.length - 1) {
                        position = slider.children.eq(slider.children.length - 1).position();
                    }
                    if (position) {
                        if (slider.settings.mode == 'horizontal') {
                            setPositionProperty(-position.left, 'reset', 0);
                        } else if (slider.settings.mode == 'vertical') {
                            setPositionProperty(-position.top, 'reset', 0);
                        }
                    }
                }
                // declare that the transition is complete
                slider.working = false;
                // onSlideAfter callback
                slider.settings.onSlideAfter(slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index);
            };
            /**
		 * Updates the auto controls state (either active, or combined switch)
		 *
		 * @param state (string) "start", "stop"
		 *  - the new state of the auto show
		 */
            var updateAutoControls = function (state) {
                // if autoControlsCombine is true, replace the current control with the new state
                if (slider.settings.autoControlsCombine) {
                    slider.controls.autoEl.html(slider.controls[state]);    // if autoControlsCombine is false, apply the "active" class to the appropriate control
                } else {
                    slider.controls.autoEl.find('a').removeClass('active');
                    slider.controls.autoEl.find('a:not(.bx-' + state + ')').addClass('active');
                }
            };
            /**
		 * Updates the direction controls (checks if either should be hidden)
		 */
            var updateDirectionControls = function () {
                if (getPagerQty() == 1) {
                    slider.controls.prev.addClass('disabled');
                    slider.controls.next.addClass('disabled');
                } else if (!slider.settings.infiniteLoop && slider.settings.hideControlOnEnd) {
                    // if first slide
                    if (slider.active.index == 0) {
                        slider.controls.prev.addClass('disabled');
                        slider.controls.next.removeClass('disabled');    // if last slide
                    } else if (slider.active.index == getPagerQty() - 1) {
                        slider.controls.next.addClass('disabled');
                        slider.controls.prev.removeClass('disabled');    // if any slide in the middle
                    } else {
                        slider.controls.prev.removeClass('disabled');
                        slider.controls.next.removeClass('disabled');
                    }
                }
            };
            /**
		 * Initialzes the auto process
		 */
            var initAuto = function () {
                // if autoDelay was supplied, launch the auto show using a setTimeout() call
                if (slider.settings.autoDelay > 0) {
                    var timeout = setTimeout(el.startAuto, slider.settings.autoDelay);    // if autoDelay was not supplied, start the auto show normally
                } else {
                    el.startAuto();
                }
                // if autoHover is requested
                if (slider.settings.autoHover) {
                    // on el hover
                    el.hover(function () {
                        // if the auto show is currently playing (has an active interval)
                        if (slider.interval) {
                            // stop the auto show and pass true agument which will prevent control update
                            el.stopAuto(true);
                            // create a new autoPaused value which will be used by the relative "mouseout" event
                            slider.autoPaused = true;
                        }
                    }, function () {
                        // if the autoPaused value was created be the prior "mouseover" event
                        if (slider.autoPaused) {
                            // start the auto show and pass true agument which will prevent control update
                            el.startAuto(true);
                            // reset the autoPaused value
                            slider.autoPaused = null;
                        }
                    });
                }
            };
            /**
		 * Initialzes the ticker process
		 */
            var initTicker = function () {
                var startPosition = 0;
                // if autoDirection is "next", append a clone of the entire slider
                if (slider.settings.autoDirection == 'next') {
                    el.append(slider.children.clone().addClass('bx-clone'));    // if autoDirection is "prev", prepend a clone of the entire slider, and set the left position
                } else {
                    el.prepend(slider.children.clone().addClass('bx-clone'));
                    var position = slider.children.first().position();
                    startPosition = slider.settings.mode == 'horizontal' ? -position.left : -position.top;
                }
                setPositionProperty(startPosition, 'reset', 0);
                // do not allow controls in ticker mode
                slider.settings.pager = false;
                slider.settings.controls = false;
                slider.settings.autoControls = false;
                // if autoHover is requested
                if (slider.settings.tickerHover && !slider.usingCSS) {
                    // on el hover
                    slider.viewport.hover(function () {
                        el.stop();
                    }, function () {
                        // calculate the total width of children (used to calculate the speed ratio)
                        var totalDimens = 0;
                        slider.children.each(function (index) {
                            totalDimens += slider.settings.mode == 'horizontal' ? $(this).outerWidth(true) : $(this).outerHeight(true);
                        });
                        // calculate the speed ratio (used to determine the new speed to finish the paused animation)
                        var ratio = slider.settings.speed / totalDimens;
                        // determine which property to use
                        var property = slider.settings.mode == 'horizontal' ? 'left' : 'top';
                        // calculate the new speed
                        var newSpeed = ratio * (totalDimens - Math.abs(parseInt(el.css(property))));
                        tickerLoop(newSpeed);
                    });
                }
                // start the ticker loop
                tickerLoop();
            };
            /**
		 * Runs a continuous loop, news ticker-style
		 */
            var tickerLoop = function (resumeSpeed) {
                speed = resumeSpeed ? resumeSpeed : slider.settings.speed;
                var position = {
                    left: 0,
                    top: 0
                };
                var reset = {
                    left: 0,
                    top: 0
                };
                // if "next" animate left position to last child, then reset left to 0
                if (slider.settings.autoDirection == 'next') {
                    position = el.find('.bx-clone').first().position();    // if "prev" animate left position to 0, then reset left to first non-clone child
                } else {
                    reset = slider.children.first().position();
                }
                var animateProperty = slider.settings.mode == 'horizontal' ? -position.left : -position.top;
                var resetValue = slider.settings.mode == 'horizontal' ? -reset.left : -reset.top;
                var params = { resetValue: resetValue };
                setPositionProperty(animateProperty, 'ticker', speed, params);
            };
            /**
		 * Initializes touch events
		 */
            var initTouch = function () {
                // initialize object to contain all touch values
                slider.touch = {
                    start: {
                        x: 0,
                        y: 0
                    },
                    end: {
                        x: 0,
                        y: 0
                    }
                };
                slider.viewport.bind('touchstart', onTouchStart);
            };
            /**
		 * Event handler for "touchstart"
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
            var onTouchStart = function (e) {
                if (slider.working) {
                    e.preventDefault();
                } else {
                    // record the original position when touch starts
                    slider.touch.originalPos = el.position();
                    var orig = e.originalEvent;
                    // record the starting touch x, y coordinates
                    slider.touch.start.x = orig.changedTouches[0].pageX;
                    slider.touch.start.y = orig.changedTouches[0].pageY;
                    // bind a "touchmove" event to the viewport
                    slider.viewport.bind('touchmove', onTouchMove);
                    // bind a "touchend" event to the viewport
                    slider.viewport.bind('touchend', onTouchEnd);
                }
            };
            /**
		 * Event handler for "touchmove"
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
            var onTouchMove = function (e) {
                var orig = e.originalEvent;
                // if scrolling on y axis, do not prevent default
                var xMovement = Math.abs(orig.changedTouches[0].pageX - slider.touch.start.x);
                var yMovement = Math.abs(orig.changedTouches[0].pageY - slider.touch.start.y);
                // x axis swipe
                if (xMovement * 3 > yMovement && slider.settings.preventDefaultSwipeX) {
                    e.preventDefault();    // y axis swipe
                } else if (yMovement * 3 > xMovement && slider.settings.preventDefaultSwipeY) {
                    e.preventDefault();
                }
                if (slider.settings.mode != 'fade' && slider.settings.oneToOneTouch) {
                    var value = 0;
                    // if horizontal, drag along x axis
                    if (slider.settings.mode == 'horizontal') {
                        var change = orig.changedTouches[0].pageX - slider.touch.start.x;
                        value = slider.touch.originalPos.left + change;    // if vertical, drag along y axis
                    } else {
                        var change = orig.changedTouches[0].pageY - slider.touch.start.y;
                        value = slider.touch.originalPos.top + change;
                    }
                    setPositionProperty(value, 'reset', 0);
                }
            };
            /**
		 * Event handler for "touchend"
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
            var onTouchEnd = function (e) {
                slider.viewport.unbind('touchmove', onTouchMove);
                var orig = e.originalEvent;
                var value = 0;
                // record end x, y positions
                slider.touch.end.x = orig.changedTouches[0].pageX;
                slider.touch.end.y = orig.changedTouches[0].pageY;
                // if fade mode, check if absolute x distance clears the threshold
                if (slider.settings.mode == 'fade') {
                    var distance = Math.abs(slider.touch.start.x - slider.touch.end.x);
                    if (distance >= slider.settings.swipeThreshold) {
                        slider.touch.start.x > slider.touch.end.x ? el.goToNextSlide() : el.goToPrevSlide();
                        el.stopAuto();
                    }    // not fade mode
                } else {
                    var distance = 0;
                    // calculate distance and el's animate property
                    if (slider.settings.mode == 'horizontal') {
                        distance = slider.touch.end.x - slider.touch.start.x;
                        value = slider.touch.originalPos.left;
                    } else {
                        distance = slider.touch.end.y - slider.touch.start.y;
                        value = slider.touch.originalPos.top;
                    }
                    // if not infinite loop and first / last slide, do not attempt a slide transition
                    if (!slider.settings.infiniteLoop && (slider.active.index == 0 && distance > 0 || slider.active.last && distance < 0)) {
                        setPositionProperty(value, 'reset', 200);
                    } else {
                        // check if distance clears threshold
                        if (Math.abs(distance) >= slider.settings.swipeThreshold) {
                            distance < 0 ? el.goToNextSlide() : el.goToPrevSlide();
                            el.stopAuto();
                        } else {
                            // el.animate(property, 200);
                            setPositionProperty(value, 'reset', 200);
                        }
                    }
                }
                slider.viewport.unbind('touchend', onTouchEnd);
            };
            /**
		 * Window resize event callback
		 */
            var resizeWindow = function (e) {
                // don't do anything if slider isn't initialized.
                if (!slider.initialized)
                    return;
                // get the new window dimens (again, thank you IE)
                var windowWidthNew = $(window).width();
                var windowHeightNew = $(window).height();
                // make sure that it is a true window resize
                // *we must check this because our dinosaur friend IE fires a window resize event when certain DOM elements
                // are resized. Can you just die already?*
                if (windowWidth != windowWidthNew || windowHeight != windowHeightNew) {
                    // set the new window dimens
                    windowWidth = windowWidthNew;
                    windowHeight = windowHeightNew;
                    // update all dynamic elements
                    el.redrawSlider();
                    // Call user resize handler
                    slider.settings.onSliderResize.call(el, slider.active.index);
                }
            };
            /**
		 * ===================================================================================
		 * = PUBLIC FUNCTIONS
		 * ===================================================================================
		 */
            /**
		 * Performs slide transition to the specified slide
		 *
		 * @param slideIndex (int)
		 *  - the destination slide's index (zero-based)
		 *
		 * @param direction (string)
		 *  - INTERNAL USE ONLY - the direction of travel ("prev" / "next")
		 */
            el.goToSlide = function (slideIndex, direction) {
                // if plugin is currently in motion, ignore request
                if (slider.working || slider.active.index == slideIndex)
                    return;
                // declare that plugin is in motion
                slider.working = true;
                // store the old index
                slider.oldIndex = slider.active.index;
                // if slideIndex is less than zero, set active index to last child (this happens during infinite loop)
                if (slideIndex < 0) {
                    slider.active.index = getPagerQty() - 1;    // if slideIndex is greater than children length, set active index to 0 (this happens during infinite loop)
                } else if (slideIndex >= getPagerQty()) {
                    slider.active.index = 0;    // set active index to requested slide
                } else {
                    slider.active.index = slideIndex;
                }
                // onSlideBefore, onSlideNext, onSlidePrev callbacks
                slider.settings.onSlideBefore(slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index);
                if (direction == 'next') {
                    slider.settings.onSlideNext(slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index);
                } else if (direction == 'prev') {
                    slider.settings.onSlidePrev(slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index);
                }
                // check if last slide
                slider.active.last = slider.active.index >= getPagerQty() - 1;
                // update the pager with active class
                if (slider.settings.pager)
                    updatePagerActive(slider.active.index);
                // // check for direction control update
                if (slider.settings.controls)
                    updateDirectionControls();
                // if slider is set to mode: "fade"
                if (slider.settings.mode == 'fade') {
                    // if adaptiveHeight is true and next height is different from current height, animate to the new height
                    if (slider.settings.adaptiveHeight && slider.viewport.height() != getViewportHeight()) {
                        slider.viewport.animate({ height: getViewportHeight() }, slider.settings.adaptiveHeightSpeed);
                    }
                    // fade out the visible child and reset its z-index value
                    slider.children.filter(':visible').fadeOut(slider.settings.speed).css({ zIndex: 0 });
                    // fade in the newly requested slide
                    slider.children.eq(slider.active.index).css('zIndex', slider.settings.slideZIndex + 1).fadeIn(slider.settings.speed, function () {
                        $(this).css('zIndex', slider.settings.slideZIndex);
                        updateAfterSlideTransition();
                    });    // slider mode is not "fade"
                } else {
                    // if adaptiveHeight is true and next height is different from current height, animate to the new height
                    if (slider.settings.adaptiveHeight && slider.viewport.height() != getViewportHeight()) {
                        slider.viewport.animate({ height: getViewportHeight() }, slider.settings.adaptiveHeightSpeed);
                    }
                    var moveBy = 0;
                    var position = {
                        left: 0,
                        top: 0
                    };
                    // if carousel and not infinite loop
                    if (!slider.settings.infiniteLoop && slider.carousel && slider.active.last) {
                        if (slider.settings.mode == 'horizontal') {
                            // get the last child position
                            var lastChild = slider.children.eq(slider.children.length - 1);
                            position = lastChild.position();
                            // calculate the position of the last slide
                            moveBy = slider.viewport.width() - lastChild.outerWidth();
                        } else {
                            // get last showing index position
                            var lastShowingIndex = slider.children.length - slider.settings.minSlides;
                            position = slider.children.eq(lastShowingIndex).position();
                        }    // horizontal carousel, going previous while on first slide (infiniteLoop mode)
                    } else if (slider.carousel && slider.active.last && direction == 'prev') {
                        // get the last child position
                        var eq = slider.settings.moveSlides == 1 ? slider.settings.maxSlides - getMoveBy() : (getPagerQty() - 1) * getMoveBy() - (slider.children.length - slider.settings.maxSlides);
                        var lastChild = el.children('.bx-clone').eq(eq);
                        position = lastChild.position();    // if infinite loop and "Next" is clicked on the last slide
                    } else if (direction == 'next' && slider.active.index == 0) {
                        // get the last clone position
                        position = el.find('> .bx-clone').eq(slider.settings.maxSlides).position();
                        slider.active.last = false;    // normal non-zero requests
                    } else if (slideIndex >= 0) {
                        var requestEl = slideIndex * getMoveBy();
                        position = slider.children.eq(requestEl).position();
                    }
                    /* If the position doesn't exist
				 * (e.g. if you destroy the slider on a next click),
				 * it doesn't throw an error.
				 */
                    if ('undefined' !== typeof position) {
                        var value = slider.settings.mode == 'horizontal' ? -(position.left - moveBy) : -position.top;
                        // plugin values to be animated
                        setPositionProperty(value, 'slide', slider.settings.speed);
                    }
                }
            };
            /**
		 * Transitions to the next slide in the show
		 */
            el.goToNextSlide = function () {
                // if infiniteLoop is false and last page is showing, disregard call
                if (!slider.settings.infiniteLoop && slider.active.last)
                    return;
                var pagerIndex = parseInt(slider.active.index) + 1;
                el.goToSlide(pagerIndex, 'next');
            };
            /**
		 * Transitions to the prev slide in the show
		 */
            el.goToPrevSlide = function () {
                // if infiniteLoop is false and last page is showing, disregard call
                if (!slider.settings.infiniteLoop && slider.active.index == 0)
                    return;
                var pagerIndex = parseInt(slider.active.index) - 1;
                el.goToSlide(pagerIndex, 'prev');
            };
            /**
		 * Starts the auto show
		 *
		 * @param preventControlUpdate (boolean)
		 *  - if true, auto controls state will not be updated
		 */
            el.startAuto = function (preventControlUpdate) {
                // if an interval already exists, disregard call
                if (slider.interval)
                    return;
                // create an interval
                slider.interval = setInterval(function () {
                    slider.settings.autoDirection == 'next' ? el.goToNextSlide() : el.goToPrevSlide();
                }, slider.settings.pause);
                // if auto controls are displayed and preventControlUpdate is not true
                if (slider.settings.autoControls && preventControlUpdate != true)
                    updateAutoControls('stop');
            };
            /**
		 * Stops the auto show
		 *
		 * @param preventControlUpdate (boolean)
		 *  - if true, auto controls state will not be updated
		 */
            el.stopAuto = function (preventControlUpdate) {
                // if no interval exists, disregard call
                if (!slider.interval)
                    return;
                // clear the interval
                clearInterval(slider.interval);
                slider.interval = null;
                // if auto controls are displayed and preventControlUpdate is not true
                if (slider.settings.autoControls && preventControlUpdate != true)
                    updateAutoControls('start');
            };
            /**
		 * Returns current slide index (zero-based)
		 */
            el.getCurrentSlide = function () {
                return slider.active.index;
            };
            /**
		 * Returns current slide element
		 */
            el.getCurrentSlideElement = function () {
                return slider.children.eq(slider.active.index);
            };
            /**
		 * Returns number of slides in show
		 */
            el.getSlideCount = function () {
                return slider.children.length;
            };
            /**
		 * Update all dynamic slider elements
		 */
            el.redrawSlider = function () {
                // resize all children in ratio to new screen size
                slider.children.add(el.find('.bx-clone')).width(getSlideWidth());
                // adjust the height
                slider.viewport.css('height', getViewportHeight());
                // update the slide position
                if (!slider.settings.ticker)
                    setSlidePosition();
                // if active.last was true before the screen resize, we want
                // to keep it last no matter what screen size we end on
                if (slider.active.last)
                    slider.active.index = getPagerQty() - 1;
                // if the active index (page) no longer exists due to the resize, simply set the index as last
                if (slider.active.index >= getPagerQty())
                    slider.active.last = true;
                // if a pager is being displayed and a custom pager is not being used, update it
                if (slider.settings.pager && !slider.settings.pagerCustom) {
                    populatePager();
                    updatePagerActive(slider.active.index);
                }
            };
            /**
		 * Destroy the current instance of the slider (revert everything back to original state)
		 */
            el.destroySlider = function () {
                // don't do anything if slider has already been destroyed
                if (!slider.initialized)
                    return;
                slider.initialized = false;
                $('.bx-clone', this).remove();
                slider.children.each(function () {
                    $(this).data('origStyle') != undefined ? $(this).attr('style', $(this).data('origStyle')) : $(this).removeAttr('style');
                });
                $(this).data('origStyle') != undefined ? this.attr('style', $(this).data('origStyle')) : $(this).removeAttr('style');
                $(this).unwrap().unwrap();
                if (slider.controls.el)
                    slider.controls.el.remove();
                if (slider.controls.next)
                    slider.controls.next.remove();
                if (slider.controls.prev)
                    slider.controls.prev.remove();
                if (slider.pagerEl && slider.settings.controls)
                    slider.pagerEl.remove();
                $('.bx-caption', this).remove();
                if (slider.controls.autoEl)
                    slider.controls.autoEl.remove();
                clearInterval(slider.interval);
                if (slider.settings.responsive)
                    $(window).unbind('resize', resizeWindow);
            };
            /**
		 * Reload the slider (revert all DOM changes, and re-initialize)
		 */
            el.reloadSlider = function (settings) {
                if (settings != undefined)
                    options = settings;
                el.destroySlider();
                init();
            };
            init();
            // returns the current jQuery object
            return this;
        };
    }(jQuery));
    return;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductDetails
define('ProductDetails.ImageGallery.View', [
    'Backbone.CompositeView',
    'Utilities.ResizeImage',
    'SocialSharing.Flyout.Hover.View',
    'product_details_image_gallery.tpl',
    'Backbone',
    'underscore',
    'Utils',
    'jquery.zoom',
    'jQuery.bxSlider'
], function (BackboneCompositeView, resizeImage, SocialSharingFlyoutHoverView, product_details_image_gallery_tpl, Backbone, _, Utils) {
    'use strict';
    // @class ProductDetails.ImageGallery.View @extends Backbone.View
    return Backbone.View.extend({
        template: product_details_image_gallery_tpl,
        initialize: function initialize() {
            Backbone.View.prototype.initialize.apply(this, arguments);
            BackboneCompositeView.add(this);
            var self = this;
            this.images = this.model.getImages();
            this.model.on('change', function () {
                var model_images = this.model.getImages();
                if (!_.isEqual(this.images, model_images)) {
                    this.images = model_images;
                    this.render();
                }
            }, this);
            this.on('afterViewRender', function () {
                self.initSlider();
                self.initZoom();
            });
        }    // @method destroy
             // @returns {Void}
,
        destroy: function destroy() {
            this.model.off('change', this.render, this);
            this.off('afterViewRender');
            this._destroy();
        }    // @method initSlider Initialize the bxSlider
             // @return {Void}
,
        initSlider: function initSlider() {
            var self = this;
            if (self.images.length > 1) {
                self.$slider = Utils.initBxSlider(self.$('[data-slider]'), {
                    buildPager: _.bind(self.buildSliderPager, self),
                    startSlide: 0,
                    adaptiveHeight: true,
                    touchEnabled: true,
                    nextText: '<a class="product-details-image-gallery-next-icon" data-action="next-image"></a>',
                    prevText: '<a class="product-details-image-gallery-prev-icon" data-action="prev-image"></a>',
                    controls: true
                });
                self.$('[data-action="next-image"]').off();
                self.$('[data-action="prev-image"]').off();
                self.$('[data-action="next-image"]').click(_.bind(self.nextImageEventHandler, self));
                self.$('[data-action="prev-image"]').click(_.bind(self.previousImageEventHandler, self));
            }
        }    //@method previousImageEventHandler Handle the clicking over the previous button to show the previous main image. It does it by triggering a cancelable event.
             //@return {Void}
,
        previousImageEventHandler: function previousImageEventHandler() {
            var self = this, current_index = self.$slider.getCurrentSlide(), next_index = current_index === 0 ? self.$slider.getSlideCount() - 1 : current_index - 1;
            //IMPORTANT This event is used to notify the ProductDetails.Component that the images have changed
            //@event {ProductDetails.ImageGallery.ChangeEvent} 'afterChangeImage
            self.model.cancelableTrigger('beforeChangeImage', {
                currentIndex: current_index,
                nextIndex: next_index
            }).then(function () {
                self.$slider.goToPrevSlide();
                self.model.cancelableTrigger('afterChangeImage', next_index);
            });
        }    //@method nextImageEventHandler Handle the clicking over the next button to show the next main image. It does it by triggering a cancelable event
             //@return {Void}
,
        nextImageEventHandler: function nextImageEventHandler() {
            var self = this, current_index = self.$slider.getCurrentSlide(), next_index = current_index === self.$slider.getSlideCount() - 1 ? 0 : current_index + 1;
            //IMPORTANT This event is used to notify the ProductDetails.Component that the images have changed
            //@event {ProductDetails.ImageGallery.ChangeEvent} beforeChangeImage
            self.model.cancelableTrigger('beforeChangeImage'    //@class ProductDetails.ImageGallery.ChangeEvent Image change event information container
, {
                //@property {Number} currentIndex
                currentIndex: current_index    //@property {Number} nextIndex
,
                nextIndex: next_index
            }    // @class ProductDetails.ImageGallery.View
).then(function () {
                self.$slider.goToNextSlide();
                self.model.cancelableTrigger('afterChangeImage', next_index);
            });
        }    //@property {ChildViews} childViews
,
        childViews: {
            'SocialSharing.Flyout.Hover': function () {
                return new SocialSharingFlyoutHoverView({});
            }
        }    // @method initZoom
             // @return {Void}
,
        initZoom: function () {
            if (!SC.ENVIRONMENT.isTouchEnabled) {
                var images = this.images, self = this;
                this.$('[data-zoom]').each(function (slide_index) {
                    self.$(this).zoom({
                        url: resizeImage(images[slide_index].url, 'zoom'),
                        callback: function () {
                            var $this = self.$(this);
                            if ($this.width() <= $this.closest('[data-view="Product.ImageGallery"]').width()) {
                                $this.remove();
                            }
                            return this;
                        }
                    });
                });
            }
        }    // @method buildSliderPager
             // @param {Number} slide_index
             // @return {String}
,
        buildSliderPager: function (slide_index) {
            var image = this.images[slide_index];
            if (image) {
                return '<img src="' + resizeImage(image.url, 'tinythumb') + '" alt="' + image.altimagetext + '">';
            }
        }    //@method getContext
             //@returns {ProductDetails.ImageGallery.View.Context}
,
        getContext: function () {
            // @class ProductDetails.ImageGallery.View.Context
            return {
                // @property {String} imageResizeId
                imageResizeId: Utils.getViewportWidth() < 768 ? 'thumbnail' : 'main'    //@property {Array<ImageContainer>} images
,
                images: this.images || []    //@property {ImageContainer} firstImage
,
                firstImage: this.images[0] || {}    // @property {Boolean} showImages
,
                showImages: this.images.length > 0    // @property {Boolean} showImageSlider
,
                showImageSlider: this.images.length > 1
            };    // @class ProductDetails.ImageGallery.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ProductDetails
define('ProductDetails.AddToProductList.View', [
    'ProductList.Control.View',
    'ProductList.ControlSingle.View',
    'Profile.Model',
    'product_details_add_to_product_list.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'underscore'
], function (ProductListControlView, ProductListControlSingleView, ProfileModel, product_details_add_to_product_list_tpl, Backbone, BackboneCompositeView, _) {
    'use strict';
    return Backbone.View.extend({
        template: product_details_add_to_product_list_tpl,
        initialize: function () {
            Backbone.View.prototype.initialize.apply(this, arguments);
            this.application = this.options.application;
            this.utils = this.application.ProductListModule && this.application.ProductListModule.Utils;
            this.countedClicks = {};
            BackboneCompositeView.add(this);
            var self = this;
            this.first_time_render = true;
            ProfileModel.getPromise().done(function () {
                self.loaded_site_settings = true;
                self.render();
            });
        },
        childViews: {
            'ProductListControl': function () {
                if (this.utils.isSingleList()) {
                    return new ProductListControlSingleView({
                        collection: this.utils.getProductLists(),
                        product: this.model,
                        application: this.application
                    });
                } else {
                    return new ProductListControlView({
                        collection: this.utils.getProductLists(),
                        product: this.model,
                        application: this.application,
                        countedClicks: this.countedClicks
                    });
                }
            }
        },
        render: function () {
            if (this.loaded_site_settings && this.utils && this.utils.isProductListEnabled()) {
                if (this.first_time_render) {
                    this.utils.getProductListsPromise().done(_.bind(this.render, this));
                    this.first_time_render = false;
                    return this.$el.empty();
                }
            } else {
                return this.$el.empty();
            }
            this._render();
        }    //@method getContext
             //@return {ProductDetails.AddToProductList.View.Context}
,
        getContext: function () {
            //@class ProductDetails.AddToProductList.View.Context
            return {
                //@property {Boolean} isLoading
                isLoading: this.utils.getProductListsPromise().state() === 'pending'
            };    //@class ProductDetails.AddToProductList.View
        }
    }, {
        attributesToValidate: [
            'options',
            'quantity'
        ]
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module RecentlyViewedItems
define('RecentlyViewedItems.Collection', [
    'Singleton',
    'SC.Configuration',
    'Item.Collection',
    'jQuery',
    'underscore',
    'Utils'
], function (Singleton, Configuration, ItemCollection, jQuery, _) {
    'use strict';
    // @class RecentlyViewedItems.Collection @extends Item.Collection
    return ItemCollection.extend({
        //@method initialize
        initialize: function () {
            this.useCookie = Configuration.recentlyViewedItems && Configuration.recentlyViewedItems.useCookie;
            this.searchApiMasterOptions = Configuration.searchApiMasterOptions.Facets;
            if (this.useCookie) {
                this.promise = this.loadItemsFromCookie();
            } else {
                this.promise = jQuery.Deferred().resolveWith(this);
            }
        }    //@method addHistoryItem
,
        addHistoryItem: function (item) {
            if (this.useCookie) {
                var self = this;
                this.promise.done(function () {
                    // If the item is already in the recently viewed, we remove it
                    self.remove(item);
                    // we add the item at the beginning of a collection
                    self.unshift(item);
                    if (self.useCookie) {
                        var current_items = jQuery.cookie('recentlyViewedIds'), news_items = _.union(self.pluck('internalid'), current_items);
                        jQuery.cookie('recentlyViewedIds', news_items, { path: '/' });
                    }
                });
            }
        }    //@method loadItemsFromCookie
,
        loadItemsFromCookie: function () {
            // create an array of ID items to get only the elements that are present in the cookie but are not present in memory
            var cookie_ids = jQuery.cookie('recentlyViewedIds') || [];
            if (typeof cookie_ids === 'string') {
                cookie_ids = [cookie_ids.replace(/[\[\]]+/g, '')];
            } else if (!_.isArray(cookie_ids)) {
                cookie_ids = [cookie_ids];
            }
            var items_ids = _.difference(cookie_ids, this.pluck('internalid')).join(',');
            if (items_ids) {
                return this.fetch({ data: { id: items_ids } }, { silent: true });
            } else {
                return jQuery.Deferred().resolveWith(this);
            }
        }
    }, Singleton);
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module ProductDetails
define('ProductDetails.Base.View', [
    'Backbone.FormView',
    'GlobalViews.Message.View',
    'Cart.AddToCart.Button.View',
    'ProductLine.Stock.View',
    'ProductViews.Price.View',
    'ProductLine.Sku.View',
    'ProductDetails.Options.Selector.View',
    'ProductDetails.Information.View',
    'ProductDetails.Quantity.View',
    'ProductDetails.ImageGallery.View',
    'ProductDetails.AddToProductList.View',
    'ProductLine.StockDescription.View',
    'Profile.Model',
    'Tracker',
    'SC.Configuration',
    'Backbone.CompositeView',
    'Backbone.Validation.callbacks',
    'RecentlyViewedItems.Collection',
    'Utils',
    'Backbone',
    'jQuery',
    'underscore',
    'UrlHelper',
    'jQuery.scPush'
], function (BackboneFormView, GlobalViewsMessageView, CartAddToCartButtonView, ProductLineStockView, ProductViewsPriceView, ProductLineSkuView, ProductDetailsOptionsSelectorView, ProductDetailsInformationView, ProductDetailsQuantityView, ProductDetailsImageGalleryView, ProductDetailsAddToProductListView, ProductLineStockDescriptionView, ProfileModel, Tracker, Configuration, BackboneCompositeView, BackboneValidationCallbacks, RecentlyViewedItemsCollection, Utils, Backbone, jQuery, _) {
    'use strict';
    //@class ProductDetails.Base.View Handles the PDP and quick view @extend Backbone.View
    var ProductDetailsBaseView = Backbone.View.extend({
        //@property {String} title
        title: ''    //@property {String} page_header
,
        page_header: ''    //@property {String} modalClass
,
        modalClass: 'global-views-modal-large'    //@property {Boolean} showModalPageHeader
,
        showModalPageHeader: false    //@property {Object} baseEvents
,
        baseEvents: { 'submit [data-action="submit-form"]': 'mainActionHandler' },
        bindings: {
            //set quantity
            '[name="quantity"]': {
                observe: 'quantity',
                setOptions: {
                    validate: true,
                    silent: false
                },
                onSet: function (quantity_str) {
                    return parseInt(quantity_str, 10);
                },
                events: [
                    'blur',
                    'change'
                ]
            }    //enable/disable minus mobile quantity button
,
            '[data-type="product-details-quantity-remove"]': {
                observe: 'quantity',
                update: function ($el, value) {
                    return $el.attr('disabled', value <= 1);
                }
            }
        }    //@method initialize
             //@param {ProductDetails.Base.View.Initialize.Options} options
             //@return {Void}
,
        initialize: function initialize(options) {
            this.events = _.extend(this.events || {}, this.baseEvents);
            Backbone.View.prototype.initialize.apply(this, arguments);
            this.application = options.application;
            this.generateViewBindings();
            BackboneCompositeView.add(this);
            BackboneFormView.add(this, { noCloneModel: true });
            var self = this;
            //Here we wrap the areAttributesValid method of the transaction line so when child views or injected views validate the model using this method
            //this view is notified and can show the error messages.
            //This is thanks to the poor "API" Backbone.validation offer.
            this.model.areAttributesValid = _.wrap(this.model.areAttributesValid, function (fn, attributes, validators) {
                var are_attr_valid = fn.apply(self.model, [
                        attributes,
                        validators
                    ]), current_validation = _.extend({}, self.model.validation), attribute_validation_result;
                _.extend(self.model.validation, validators);
                //In order to properly show the validation on message in the UI we need to validate against the temporal properties on the model
                //that are those binded to the template! (See method generateViewBindings)
                if (~_.indexOf(attributes, 'options')) {
                    self.model.get('options').map(function (option) {
                        attributes.push(option.get('cartOptionId'));
                    });
                }
                _.each(attributes, function (attribute) {
                    attribute_validation_result = self.model.preValidate(attribute, self.model.get(attribute));
                    if (attribute_validation_result) {
                        //Here we assume that the default selector 'name' is being used
                        BackboneValidationCallbacks.invalid(self, attribute, attribute_validation_result, 'name');
                    } else {
                        BackboneValidationCallbacks.valid(self, attribute, 'name');
                    }
                });
                self.model.validation = current_validation;
                return are_attr_valid;
            });
            if (ProductDetailsBaseView.mainActionView) {
                this.mainActionViewInstance = new ProductDetailsBaseView.mainActionView({
                    application: this.options.application,
                    model: this.model
                });
            }
        }    //@method mainActionHandler Handle the submit action
             //@param {jQuery.Event} e
             //@return {Boolean}
,
        mainActionHandler: function mainActionHandler(e) {
            if (ProductDetailsBaseView.mainActionView) {
                return this.mainActionViewInstance.submitHandler(e);
            } else {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        }    //@method showContent Override default method to track current product, add product to viewed ones and start the pusher
             //@return {jQuery.Deferred}
,
        showContent: function showContent() {
            var self = this;
            return Backbone.View.prototype.showContent.apply(this, arguments).done(function () {
                Tracker.getInstance().trackProductView(self.model);
                RecentlyViewedItemsCollection.getInstance().addHistoryItem(self.model.get('item'));
                self.$('[data-action="pushable"]').scPush();
            });
        }    //@method generateViewBindings Extend the bindings properties by adding all the bindings to all the temporal option properties
             //@return {Void}
,
        generateViewBindings: function generateViewBindings() {
            var self = this, option_bindings = self.model.get('options').reduce(function (bindings, option) {
                    var cart_option_id = option.get('cartOptionId');
                    //Bind to set options
                    bindings['[name="' + cart_option_id + '"]'] = {
                        observe: option.get('cartOptionId')    // << TEMP PROPERTY TO MAKE EASY VALIDATION (READ HERE)
,
                        setOptions: {
                            validate: true,
                            silent: true
                        },
                        onSet: function (value, options) {
                            var view = options.view, product_model = view.model, option = product_model.get('options').findWhere({ cartOptionId: options.observe }), current_value = option.get('value') && option.get('value').internalid;
                            if (!option.get('isMandatory') && current_value === value && view.$(options.selector).attr('type') === 'radio') {
                                // unset value.
                                value = null;
                            }
                            product_model.setOption(options.observe, value);
                            return value;
                        },
                        events: [self.getBindingEventForOption(option)]
                    };
                    //Binding for the label (selected value)
                    bindings['[data-value="' + cart_option_id + '"]'] = {
                        observe: option.get('cartOptionId'),
                        onGet: function () {
                            return option.get('value') ? option.get('value').label : '';
                        }
                    };
                    _.each(option.get('values'), function (value) {
                        if (value.internalid)
                            // Exclude the " - Select -" option
                            {
                                //Bind for mute and active options
                                bindings['[data-label="label-' + cart_option_id + '"][value="' + value.internalid + '"]'] = {
                                    attributes: [{
                                            name: 'class',
                                            observe: option.get('cartOptionId'),
                                            onGet: function () {
                                                if (!_.findWhere(option.get('values'), { internalid: value.internalid }).isAvailable) {
                                                    return 'muted';
                                                } else if (value.internalid === (option.get('value') && option.get('value').internalid)) {
                                                    return 'active';
                                                } else {
                                                    return '';
                                                }
                                            }
                                        }]
                                };
                            }
                    });
                    return bindings;
                }, {});
            _.extend(this.bindings, option_bindings);
        }    //@method getBindingEventForOption Auxiliary method used to allows different bindings depending on the option type
             //@param {Transaction.Line.Option.Model} option
             //@return {String} Event name used to make the binding with stickIt
,
        getBindingEventForOption: function getBindingEventForOption(option) {
            return ProductDetailsBaseView.optionBindEventByType[option.get('type').toLowerCase()] || 'blur';
        }    //@method updateURL Updates the current URL based on the selected attributes of the current line
             //@return {Void} This method does not return nothing as it only update the URL without navigating
,
        updateURL: function updateURL() {
            Backbone.history.navigate(this.model.generateURL(), { replace: true });
            Tracker.getInstance().trackProductView(this.model);
        }    // @method getBreadcrumbPages Returns the breadcrumb for the current page based on the current item
             // @return {Array<BreadcrumbPage>} breadcrumb pages
,
        getBreadcrumbPages: function getBreadcrumbPages() {
            return this.model.get('item').get('_breadcrumb');
        }    //@method render Override default render method to initialize plugins and set page title and page_header
             //@return {Void}
,
        render: function render() {
            this.title = this.model.get('item').get('_pageTitle');
            this.page_header = this.model.get('item').get('_pageHeader');
            this._render();
        }    // @method getMetaKeywords
             // @return {String}
,
        getMetaKeywords: function getMetaKeywords() {
            // searchkeywords is for alternative search keywords that customers might use to find this item using your Web store's internal search
            // they are not for the meta keywords
            // return this.model.get('_keywords');
            return this.getMetaTags().filter('[name="keywords"]').attr('content') || '';
        }    // @method getMetaTags
             // @return {Array<HTMLElement>}
,
        getMetaTags: function getMetaTags() {
            return jQuery('<head/>').html(jQuery.trim(this.model.get('item').get('_metaTags'))).children('meta');
        }    // @method getMetaDescription
             // @return {String}
,
        getMetaDescription: function getMetaDescription() {
            return this.getMetaTags().filter('[name="description"]').attr('content') || '';
        },
        showOptionsPusher: function showOptionsPusher() {
            return false;
        },
        contextData: {
            'product': function () {
                return Utils.deepCopy(this.model);
            },
            'item': function () {
                return Utils.deepCopy(this.model.get('item'));
            }
        }    //@property {ChildViews} childViews
,
        childViews: {
            'Product.Options': function () {
                return new ProductDetailsOptionsSelectorView({
                    model: this.model,
                    application: this.application,
                    show_pusher: this.showOptionsPusher(),
                    show_required_label: this.model.get('item').get('itemtype') === 'GiftCert'
                });
            },
            'Product.Price': function () {
                return new ProductViewsPriceView({
                    model: this.model,
                    origin: this.inModal ? 'PDPQUICK' : 'PDPFULL'
                });
            },
            'MainActionView': function () {
                return this.mainActionViewInstance && this.mainActionViewInstance;
            },
            'Product.Stock.Info': function () {
                return new ProductLineStockView({ model: this.model });
            },
            'Product.Sku': function () {
                return new ProductLineSkuView({ model: this.model });
            },
            'Quantity': function () {
                return new ProductDetailsQuantityView({ model: this.model });
            },
            'Product.ImageGallery': function () {
                return new ProductDetailsImageGalleryView({ model: this.model });
            },
            'GlobalViewsMessageView.WronglyConfigureItem': function () {
                return new GlobalViewsMessageView({
                    message: _.translate('<b>Warning</b>: This item is not properly configured, please contact your administrator.'),
                    type: 'warning'
                });
            },
            'AddToProductList': function () {
                return new ProductDetailsAddToProductListView({
                    model: this.model,
                    application: this.options.application
                });
            },
            'StockDescription': function () {
                return new ProductLineStockDescriptionView({ model: this.model });
            }
        }    //@method getContext
             //@return {ProductDetails.Base.View.Context}
,
        getContext: function () {
            var item_model = this.model.get('item');
            //@class ProductDetails.Base.View.Context
            return {
                //@property {Transaction.Line.Model} model
                model: this.model,
                pageHeader: this.page_header,
                itemUrl: item_model.get('_url') + this.model.getQuery()    //@property {Boolean} isItemProperlyConfigured
,
                isItemProperlyConfigured: item_model.isProperlyConfigured()    //@property {Boolean} isPriceEnabled
,
                isPriceEnabled: !ProfileModel.getInstance().hidePrices()
            };    //@class ProductDetails.Base.View
        }
    }    //Static properties
, {
        //@property {ProductDetails.Base.View.OptionBinding} optionBindEventByType
        //@static
        optionBindEventByType: {
            //@class ProductDetails.Base.View.OptionBinding This class associated an option type with the event used to set the option's value
            // @extend Dictionary<String, String>
            'select': 'change',
            'text': 'blur',
            'date': 'change'
        }    //@class ProductDetails.Base.View
             //@method addMainActionView Allows to add a BackboneView constructor as the view that will perform the main action.
             //@param {Backbone.View} main_action_view
             //@return {Void}
             //@static
,
        addMainActionView: function (main_action_view) {
            ProductDetailsBaseView.mainActionView = main_action_view;
        }    //@method getMainActionView Allows to retrieve the current set BackboneView constructor used as the view that will perform the main action.
             //@return {Backbone.View?}
             //@static
,
        getMainActionView: function () {
            return ProductDetailsBaseView.mainActionView;
        }
    });
    ProductDetailsBaseView.addMainActionView(CartAddToCartButtonView);
    return ProductDetailsBaseView;
});    //@class ProductDetails.Base.View.Initialize.Options
       //@property {Product} model
       //@property {String} baseUrl
       //@property {ApplicationSkeleton} application


define('ProductDetails.Details.View', [
    'SC.Configuration',
    'product_details_details.tpl',
    'Backbone',
    'Utils',
    'underscore'
], function (Configuration, product_details_details_tpl, Backbone, Utils, _) {
    'use strict';
    return Backbone.View.extend({
        template: product_details_details_tpl,
        initialize: function initialize() {
            Backbone.View.prototype.initialize.apply(this, arguments);
            this.details = this.options.details;
        },
        render: function () {
            this.details = this.details || this.computeDetailsArea();
            this._render();
        },
        computeDetailsArea: function () {
            var self = this, details = [];
            var desc = self.model.get('item').get('custitem431');
            var test = self.model.get('item').get('custitem_customfield_itemaccessories');
            _.each(Configuration.get('productDetailsInformation', []), function (item_information) {
                // var itemURL = self.model.getFullLink();
                details.push({ desc: desc });
            });
            return details;
        },
        getContext: function () {
            return { details: this.details };
        }
    });
});

define('ProductDetails.Specification.View', [
    'SC.Configuration',
    'product_details_specification.tpl',
    'Backbone',
    'Utils',
    'underscore'
], function (Configuration, product_details_specification_tpl, Backbone, Utils, _) {
    'use strict';
    return Backbone.View.extend({
        template: product_details_specification_tpl,
        // events: {
        //     'click [data-action="show-more"]': 'showMore',
        //     'click [data-action="selected-tab"]': 'debouncedCheckContentHeight'
        // }
        // ,
        initialize: function initialize() {
            Backbone.View.prototype.initialize.apply(this, arguments);
            this.details = this.options.details;
        },
        render: function () {
            this.details = this.details || this.computeDetailsArea();
            this._render();    // if (!SC.isPageGenerator()) {
                               //     this.debouncedCheckContentHeight();
                               // }
        },
        computeDetailsArea: function () {
            var self = this, details = [];
            _.each(Configuration.get('productDetailsInformation', []), function (item_information) {
                var CardCompatibility = self.model.get('item').get('custitem244');
                var CardOptions = self.model.get('item').get('custitem245');
                var CardSize = self.model.get('item').get('custitem246');
                var CardType = self.model.get('item').get('custitem247');
                var Cards = self.model.get('item').get('custitem248');
                var CredentialType = self.model.get('item').get('custitem249');
                var Doors = self.model.get('item').get('custitem250');
                var Encryption = self.model.get('item').get('custitem251');
                var History = self.model.get('item').get('custitem252');
                var Holidays = self.model.get('item').get('custitem253');
                var ReadRange = self.model.get('item').get('custitem254');
                var ReaderType = self.model.get('item').get('custitem255');
                var Readers = self.model.get('item').get('custitem256');
                var Schedules = self.model.get('item').get('custitem257');
                var SlotPunch = self.model.get('item').get('custitem258');
                var Audio = self.model.get('item').get('custitem259');
                var AudioCompression = self.model.get('item').get('custitem260');
                var AudioStreaming = self.model.get('item').get('custitem261');
                var BuiltinMic = self.model.get('item').get('custitem262');
                var dB = self.model.get('item').get('custitem263');
                var AlarmOutputs = self.model.get('item').get('custitem264');
                var AudioIn = self.model.get('item').get('custitem265');
                var AudioOut = self.model.get('item').get('custitem266');
                var DigitalInputs = self.model.get('item').get('custitem267');
                var DigitalOutputs = self.model.get('item').get('custitem268');
                var RelayOutput = self.model.get('item').get('custitem269');
                var RS232 = self.model.get('item').get('custitem270');
                var RS422 = self.model.get('item').get('custitem271');
                var RS485 = self.model.get('item').get('custitem272');
                var SensorInputs = self.model.get('item').get('custitem273');
                var USBPorts = self.model.get('item').get('custitem274');
                var VideoIn = self.model.get('item').get('custitem275');
                var VideoOut = self.model.get('item').get('custitem276');
                var AspectRatio = self.model.get('item').get('custitem277');
                var Brightness = self.model.get('item').get('custitem278');
                var GraphicSearchDisplay = self.model.get('item').get('custitem279');
                var LCD = self.model.get('item').get('custitem280');
                var LED = self.model.get('item').get('custitem281');
                var Channels = self.model.get('item').get('custitem282');
                var Condition = self.model.get('item').get('custitem283');
                var Connection = self.model.get('item').get('custitem284');
                var DVRIncluded = self.model.get('item').get('custitem285');
                var FormFactor = self.model.get('item').get('custitem286');
                var Frequency = self.model.get('item').get('custitem287');
                var FullFrameIR = self.model.get('item').get('custitem288');
                var Image = self.model.get('item').get('custitem289');
                var IRRange = self.model.get('item').get('custitem290');
                var LensType = self.model.get('item').get('custitem291');
                var MegapixelLens = self.model.get('item').get('custitem292');
                var NumberofCameras = self.model.get('item').get('custitem293');
                var OutdoorUse = self.model.get('item').get('custitem294');
                var Ports = self.model.get('item').get('custitem295');
                var PowerSource = self.model.get('item').get('custitem296');
                var SignalOutput = self.model.get('item').get('custitem297');
                var StorageCapacity = self.model.get('item').get('custitem298');
                var Vandalproof = self.model.get('item').get('custitem299');
                var Infeed = self.model.get('item').get('custitem300');
                var Status = self.model.get('item').get('custitem301');
                var Visibility = self.model.get('item').get('custitem302');
                var AGCControl = self.model.get('item').get('custitem304');
                var Resolution = self.model.get('item').get('custitem303');
                var Day_NightFunction = self.model.get('item').get('custitem305');
                var DigitalImageStabilization = self.model.get('item').get('custitem306');
                var DigitalNoiseReduction = self.model.get('item').get('custitem307');
                var DigitalPTZ = self.model.get('item').get('custitem308');
                var DigitalZoom = self.model.get('item').get('custitem309');
                var DynamicRange = self.model.get('item').get('custitem310');
                var Flip = self.model.get('item').get('custitem311');
                var ImagerManufacturer = self.model.get('item').get('custitem312');
                var ImagerType = self.model.get('item').get('custitem313');
                var IRSensitive = self.model.get('item').get('custitem314');
                var IRWavelength = self.model.get('item').get('custitem315');
                var Lines = self.model.get('item').get('custitem316');
                var Megapixel = self.model.get('item').get('custitem317');
                var OSD = self.model.get('item').get('custitem318');
                var Sense_up = self.model.get('item').get('custitem319');
                var StillImageCapture = self.model.get('item').get('custitem320');
                var WideDynamic = self.model.get('item').get('custitem321');
                var Focus = self.model.get('item').get('custitem322');
                var IRCorrective = self.model.get('item').get('custitem323');
                var LensIncluded = self.model.get('item').get('custitem324');
                var LensIris = self.model.get('item').get('custitem325');
                var LensMount = self.model.get('item').get('custitem326');
                var filfocaltype = self.model.get('item').get('custitem333');
                var OpticalZoom = self.model.get('item').get('custitem327');
                var Zoom = self.model.get('item').get('custitem328');
                var EthernetInterface = self.model.get('item').get('custitem329');
                var EthernetPorts = self.model.get('item').get('custitem330');
                var Processor = self.model.get('item').get('custitem331');
                var RemoteConfiguration = self.model.get('item').get('custitem332');
                var RemoteViewable = self.model.get('item').get('custitem334');
                var SwitchingCapacity = self.model.get('item').get('custitem335');
                var fxbrand11 = self.model.get('item').get('custitem500');
                var Warranty = self.model.get('item').get('custitem336');
                var AcceptsinMountingBrackets = self.model.get('item').get('custitem337');
                var Blower = self.model.get('item').get('custitem338');
                var Chassis = self.model.get('item').get('custitem339');
                var Construction = self.model.get('item').get('custitem340');
                var DVDBurner = self.model.get('item').get('custitem341');
                var HardDriveIncluded = self.model.get('item').get('custitem342');
                var HardDriveType = self.model.get('item').get('custitem343');
                var Heater = self.model.get('item').get('custitem344');
                var IngressProtection = self.model.get('item').get('custitem345');
                var Length = self.model.get('item').get('custitem346');
                var Mount = self.model.get('item').get('custitem347');
                var MountingBracketIncluded = self.model.get('item').get('custitem348');
                var MTBF = self.model.get('item').get('custitem349');
                var NumberofDriveBays = self.model.get('item').get('custitem350');
                var Outdoor = self.model.get('item').get('custitem351');
                var PowerAWG = self.model.get('item').get('custitem352');
                var ProductColor = self.model.get('item').get('custitem353');
                var RemoteControl = self.model.get('item').get('custitem354');
                var Speakers = self.model.get('item').get('custitem355');
                var BatteryPowered = self.model.get('item').get('custitem356');
                var DualVoltage = self.model.get('item').get('custitem357');
                var OutputPowerPerPort = self.model.get('item').get('custitem358');
                var PoE = self.model.get('item').get('custitem359');
                var PowerSupplyIncluded = self.model.get('item').get('custitem360');
                var GoogleCheckout = self.model.get('item').get('custitem361');
                var ActivityLog = self.model.get('item').get('custitem362');
                var AnalogChannels = self.model.get('item').get('custitem363');
                var AnalyticsReady = self.model.get('item').get('custitem364');
                var CompressionType = self.model.get('item').get('custitem365');
                var EmailNotification = self.model.get('item').get('custitem366');
                var EventLog = self.model.get('item').get('custitem367');
                var EventNotification = self.model.get('item').get('custitem368');
                var EventSearch = self.model.get('item').get('custitem369');
                var HardwareCompression = self.model.get('item').get('custitem370');
                var IPChannels = self.model.get('item').get('custitem371');
                var MaxStorageCapacitygb = self.model.get('item').get('custitem372');
                var MaxStorageCapacityTB = self.model.get('item').get('custitem373');
                var MotionDetection = self.model.get('item').get('custitem374');
                var Pre_PostAlarmRecording = self.model.get('item').get('custitem375');
                var PrivacyVideoBlock = self.model.get('item').get('custitem376');
                var RecordingMode = self.model.get('item').get('custitem377');
                var SelectableFrameRate = self.model.get('item').get('custitem378');
                var SmartSearch = self.model.get('item').get('custitem379');
                var StorageCapacityGB = self.model.get('item').get('custitem380');
                var StorageCapacityMB = self.model.get('item').get('custitem381');
                var StorageCapacityTB = self.model.get('item').get('custitem382');
                var VideoAnalyticsCapable = self.model.get('item').get('custitem383');
                var VideoOffload = self.model.get('item').get('custitem384');
                var VideoStreaming = self.model.get('item').get('custitem385');
                var BrowserSupport = self.model.get('item').get('custitem386');
                var MobileApp = self.model.get('item').get('custitem387');
                var OS_Client = self.model.get('item').get('custitem388');
                var OS_Server = self.model.get('item').get('custitem389');
                var _802_11 = self.model.get('item').get('custitem390');
                var Antenna = self.model.get('item').get('custitem391');
                var BaudrateCommunication = self.model.get('item').get('custitem392');
                var FCC = self.model.get('item').get('custitem393');
                var Frequency_GHz = self.model.get('item').get('custitem394');
                var Frequency_MHz = self.model.get('item').get('custitem395');
                var GPS = self.model.get('item').get('custitem396');
                var TransmitsAudio = self.model.get('item').get('custitem397');
                var Wireless = self.model.get('item').get('custitem398');
                var WirelessRange = self.model.get('item').get('custitem399');
                var Connectors = self.model.get('item').get('custitem400');
                var Inputs = self.model.get('item').get('custitem401');
                var Outputs = self.model.get('item').get('custitem402');
                var Termination = self.model.get('item').get('custitem403');
                var DisplayColor = self.model.get('item').get('custitem404');
                var HorizontalViewingAngle = self.model.get('item').get('custitem405');
                var InputSignal = self.model.get('item').get('custitem406');
                var MaxContrast = self.model.get('item').get('custitem407');
                var MonitorResolution = self.model.get('item').get('custitem408');
                var ResponseTime = self.model.get('item').get('custitem409');
                var VerticalViewingAngle = self.model.get('item').get('custitem410');
                var MonitorSize = self.model.get('item').get('custitem411');
                var DealerSKU = self.model.get('item').get('custitem412');
                var Description = self.model.get('item').get('custitem413');
                var GTIN = self.model.get('item').get('custitem414');
                var KeyFeatures = self.model.get('item').get('custitem415');
                var SetProductNewfromDate = self.model.get('item').get('custitem416');
                var SetProductNewtoDate = self.model.get('item').get('custitem417');
                var URLKey = self.model.get('item').get('custitem418');
                var Weight = self.model.get('item').get('custitem419');
                var CameraResolution = self.model.get('item').get('custitem420');
                var EffectivePixels = self.model.get('item').get('custitem421');
                var ElectronicShutter = self.model.get('item').get('custitem422');
                var ImagerSize = self.model.get('item').get('custitem423');
                var IRArrayRange = self.model.get('item').get('custitem424');
                var Lux_B_W = self.model.get('item').get('custitem425');
                var Lux_Color = self.model.get('item').get('custitem426');
                var FocalLength = self.model.get('item').get('custitem427');
                var FOV = self.model.get('item').get('custitem428');
                var RelativeAperture = self.model.get('item').get('custitem429');
                var AvailabilityMessage = self.model.get('item').get('custitem430');
                var MetaDescription = self.model.get('item').get('custitem431');
                var MetaKeywords = self.model.get('item').get('custitem432');
                var Protocols = self.model.get('item').get('custitem433');
                var CardReaderType = self.model.get('item').get('custitem434');
                var Certification = self.model.get('item').get('custitem435');
                var Dimensions = self.model.get('item').get('custitem436');
                var OperatingHumidity = self.model.get('item').get('custitem437');
                var OperatingTemperature = self.model.get('item').get('custitem438');
                var TiltAngle = self.model.get('item').get('custitem439');
                var Weight_lb = self.model.get('item').get('custitem440');
                var Weight_oz = self.model.get('item').get('custitem441');
                var WeightCapacity_lb = self.model.get('item').get('custitem442');
                var AmpsAC = self.model.get('item').get('custitem443');
                var BatteryType = self.model.get('item').get('custitem444');
                var EstimatedBatteryLife = self.model.get('item').get('custitem445');
                var PowerRequirements = self.model.get('item').get('custitem446');
                var VoltsACInput = self.model.get('item').get('custitem447');
                var VoltsACOut = self.model.get('item').get('custitem448');
                var VoltsDCInput = self.model.get('item').get('custitem449');
                var VoltsDCOut = self.model.get('item').get('custitem450');
                var res_01 = self.model.get('item').get('custitem451');
                var res_02 = self.model.get('item').get('custitem452');
                var res_03 = self.model.get('item').get('custitem453');
                var res_04 = self.model.get('item').get('custitem454');
                var res_05 = self.model.get('item').get('custitem455');
                var res_06 = self.model.get('item').get('custitem456');
                var res_07 = self.model.get('item').get('custitem457');
                var res_08 = self.model.get('item').get('custitem458');
                var res_09 = self.model.get('item').get('custitem459');
                var res_10 = self.model.get('item').get('custitem460');
                var res_11 = self.model.get('item').get('custitem461');
                var res_12 = self.model.get('item').get('custitem462');
                var res_13 = self.model.get('item').get('custitem463');
                var res_14 = self.model.get('item').get('custitem464');
                var res_15 = self.model.get('item').get('custitem465');
                var res_16 = self.model.get('item').get('custitem466');
                var res_17 = self.model.get('item').get('custitem467');
                var res_18 = self.model.get('item').get('custitem468');
                var res_19 = self.model.get('item').get('custitem469');
                var res_20 = self.model.get('item').get('custitem470');
                var res_21 = self.model.get('item').get('custitem471');
                var res_22 = self.model.get('item').get('custitem472');
                var res_23 = self.model.get('item').get('custitem473');
                var res_24 = self.model.get('item').get('custitem474');
                var res_25 = self.model.get('item').get('custitem475');
                var CompareCovertCameras = self.model.get('item').get('custitem476');
                var CompareIR_LowLightTech = self.model.get('item').get('custitem477');
                var CompareLensFOVs = self.model.get('item').get('custitem478');
                var CompareVideoFrameRates = self.model.get('item').get('custitem479');
                var DVRStorageCalculator = self.model.get('item').get('custitem480');
                var LensFOVCalculator = self.model.get('item').get('custitem481');
                var NetworkCameraBandwidthCalculator = self.model.get('item').get('custitem482');
                var NVRStorageCalculator = self.model.get('item').get('custitem483');
                var SystemROICalculator = self.model.get('item').get('custitem484');
                var VoltageDropCalculator = self.model.get('item').get('custitem485');
                var V_Watts_AConverter = self.model.get('item').get('custitem486');
                var Pattern = self.model.get('item').get('custitem487');
                var Preset = self.model.get('item').get('custitem488');
                var PTZControl = self.model.get('item').get('custitem489');
                var Scan = self.model.get('item').get('custitem490');
                var Tour = self.model.get('item').get('custitem491');
                var BitRate = self.model.get('item').get('custitem492');
                var FrameRate = self.model.get('item').get('custitem493');
                var RecordingResolution = self.model.get('item').get('custitem494');
                var SearchMode = self.model.get('item').get('custitem495');
                var system_components = self.model.get('item').get('custitem496');
                var RangeLineofSight = self.model.get('item').get('custitem497');
                var PanAngle = self.model.get('item').get('custitem498');
                var SDCardIncluded = self.model.get('item').get('custitem499');
                details.push({
                    CardCompatibility: CardCompatibility,
                    CardOptions: CardOptions,
                    CardSize: CardSize,
                    CardType: CardType,
                    Cards: Cards,
                    CredentialType: CredentialType,
                    Doors: Doors,
                    Encryption: Encryption,
                    History: History,
                    Holidays: Holidays,
                    ReadRange: ReadRange,
                    ReaderType: ReaderType,
                    Readers: Readers,
                    Schedules: Schedules,
                    SlotPunch: SlotPunch,
                    Audio: Audio,
                    AudioCompression: AudioCompression,
                    AudioStreaming: AudioStreaming,
                    BuiltinMic: BuiltinMic,
                    dB: dB,
                    AlarmOutputs: AlarmOutputs,
                    AudioIn: AudioIn,
                    AudioOut: AudioOut,
                    DigitalInputs: DigitalInputs,
                    DigitalOutputs: DigitalOutputs,
                    RelayOutput: RelayOutput,
                    RS232: RS232,
                    RS422: RS422,
                    RS485: RS485,
                    SensorInputs: SensorInputs,
                    USBPorts: USBPorts,
                    VideoIn: VideoIn,
                    VideoOut: VideoOut,
                    AspectRatio: AspectRatio,
                    Brightness: Brightness,
                    GraphicSearchDisplay: GraphicSearchDisplay,
                    LCD: LCD,
                    LED: LED,
                    Channels: Channels,
                    Condition: Condition,
                    Connection: Connection,
                    DVRIncluded: DVRIncluded,
                    FormFactor: FormFactor,
                    Frequency: Frequency,
                    FullFrameIR: FullFrameIR,
                    Image: Image,
                    IRRange: IRRange,
                    LensType: LensType,
                    MegapixelLens: MegapixelLens,
                    NumberofCameras: NumberofCameras,
                    OutdoorUse: OutdoorUse,
                    Ports: Ports,
                    PowerSource: PowerSource,
                    SignalOutput: SignalOutput,
                    StorageCapacity: StorageCapacity,
                    Vandalproof: Vandalproof,
                    Infeed: Infeed,
                    Status: Status,
                    Visibility: Visibility,
                    AGCControl: AGCControl,
                    Resolution: Resolution,
                    Day_NightFunction: Day_NightFunction,
                    DigitalImageStabilization: DigitalImageStabilization,
                    DigitalNoiseReduction: DigitalNoiseReduction,
                    DigitalPTZ: DigitalPTZ,
                    DigitalZoom: DigitalZoom,
                    DynamicRange: DynamicRange,
                    Flip: Flip,
                    ImagerManufacturer: ImagerManufacturer,
                    ImagerType: ImagerType,
                    IRSensitive: IRSensitive,
                    IRWavelength: IRWavelength,
                    Lines: Lines,
                    Megapixel: Megapixel,
                    OSD: OSD,
                    Sense_up: Sense_up,
                    StillImageCapture: StillImageCapture,
                    WideDynamic: WideDynamic,
                    Focus: Focus,
                    IRCorrective: IRCorrective,
                    LensIncluded: LensIncluded,
                    LensIris: LensIris,
                    LensMount: LensMount,
                    filfocaltype: filfocaltype,
                    OpticalZoom: OpticalZoom,
                    Zoom: Zoom,
                    EthernetInterface: EthernetInterface,
                    EthernetPorts: EthernetPorts,
                    Processor: Processor,
                    RemoteConfiguration: RemoteConfiguration,
                    RemoteViewable: RemoteViewable,
                    SwitchingCapacity: SwitchingCapacity,
                    fxbrand11: fxbrand11,
                    Warranty: Warranty,
                    AcceptsinMountingBrackets: AcceptsinMountingBrackets,
                    Blower: Blower,
                    Chassis: Chassis,
                    Construction: Construction,
                    DVDBurner: DVDBurner,
                    HardDriveIncluded: HardDriveIncluded,
                    HardDriveType: HardDriveType,
                    Heater: Heater,
                    IngressProtection: IngressProtection,
                    Length: Length,
                    Mount: Mount,
                    MountingBracketIncluded: MountingBracketIncluded,
                    MTBF: MTBF,
                    NumberofDriveBays: NumberofDriveBays,
                    Outdoor: Outdoor,
                    PowerAWG: PowerAWG,
                    ProductColor: ProductColor,
                    RemoteControl: RemoteControl,
                    Speakers: Speakers,
                    BatteryPowered: BatteryPowered,
                    DualVoltage: DualVoltage,
                    OutputPowerPerPort: OutputPowerPerPort,
                    PoE: PoE,
                    PowerSupplyIncluded: PowerSupplyIncluded,
                    GoogleCheckout: GoogleCheckout,
                    ActivityLog: ActivityLog,
                    AnalogChannels: AnalogChannels,
                    AnalyticsReady: AnalyticsReady,
                    CompressionType: CompressionType,
                    EmailNotification: EmailNotification,
                    EventLog: EventLog,
                    EventNotification: EventNotification,
                    EventSearch: EventSearch,
                    HardwareCompression: HardwareCompression,
                    IPChannels: IPChannels,
                    MaxStorageCapacitygb: MaxStorageCapacitygb,
                    MaxStorageCapacityTB: MaxStorageCapacityTB,
                    MotionDetection: MotionDetection,
                    Pre_PostAlarmRecording: Pre_PostAlarmRecording,
                    PrivacyVideoBlock: PrivacyVideoBlock,
                    RecordingMode: RecordingMode,
                    SelectableFrameRate: SelectableFrameRate,
                    SmartSearch: SmartSearch,
                    StorageCapacityGB: StorageCapacityGB,
                    StorageCapacityMB: StorageCapacityMB,
                    StorageCapacityTB: StorageCapacityTB,
                    VideoAnalyticsCapable: VideoAnalyticsCapable,
                    VideoOffload: VideoOffload,
                    VideoStreaming: VideoStreaming,
                    BrowserSupport: BrowserSupport,
                    MobileApp: MobileApp,
                    OS_Client: OS_Client,
                    OS_Server: OS_Server,
                    _802_11: _802_11,
                    Antenna: Antenna,
                    BaudrateCommunication: BaudrateCommunication,
                    FCC: FCC,
                    Frequency_GHz: Frequency_GHz,
                    Frequency_MHz: Frequency_MHz,
                    GPS: GPS,
                    TransmitsAudio: TransmitsAudio,
                    Wireless: Wireless,
                    WirelessRange: WirelessRange,
                    Connectors: Connectors,
                    Inputs: Inputs,
                    Outputs: Outputs,
                    Termination: Termination,
                    DisplayColor: DisplayColor,
                    HorizontalViewingAngle: HorizontalViewingAngle,
                    InputSignal: InputSignal,
                    MaxContrast: MaxContrast,
                    MonitorResolution: MonitorResolution,
                    ResponseTime: ResponseTime,
                    VerticalViewingAngle: VerticalViewingAngle,
                    MonitorSize: MonitorSize,
                    DealerSKU: DealerSKU,
                    Description: Description,
                    GTIN: GTIN,
                    KeyFeatures: KeyFeatures,
                    SetProductNewfromDate: SetProductNewfromDate,
                    SetProductNewtoDate: SetProductNewtoDate,
                    URLKey: URLKey,
                    Weight: Weight,
                    CameraResolution: CameraResolution,
                    EffectivePixels: EffectivePixels,
                    ElectronicShutter: ElectronicShutter,
                    ImagerSize: ImagerSize,
                    IRArrayRange: IRArrayRange,
                    Lux_B_W: Lux_B_W,
                    Lux_Color: Lux_Color,
                    FocalLength: FocalLength,
                    FOV: FOV,
                    RelativeAperture: RelativeAperture,
                    AvailabilityMessage: AvailabilityMessage,
                    MetaDescription: MetaDescription,
                    MetaKeywords: MetaKeywords,
                    Protocols: Protocols,
                    CardReaderType: CardReaderType,
                    Certification: Certification,
                    Dimensions: Dimensions,
                    OperatingHumidity: OperatingHumidity,
                    OperatingTemperature: OperatingTemperature,
                    TiltAngle: TiltAngle,
                    Weight_lb: Weight_lb,
                    Weight_oz: Weight_oz,
                    WeightCapacity_lb: WeightCapacity_lb,
                    AmpsAC: AmpsAC,
                    BatteryType: BatteryType,
                    EstimatedBatteryLife: EstimatedBatteryLife,
                    PowerRequirements: PowerRequirements,
                    VoltsACInput: VoltsACInput,
                    VoltsACOut: VoltsACOut,
                    VoltsDCInput: VoltsDCInput,
                    VoltsDCOut: VoltsDCOut,
                    res_01: res_01,
                    res_02: res_02,
                    res_03: res_03,
                    res_04: res_04,
                    res_05: res_05,
                    res_06: res_06,
                    res_07: res_07,
                    res_08: res_08,
                    res_09: res_09,
                    res_10: res_10,
                    res_11: res_11,
                    res_12: res_12,
                    res_13: res_13,
                    res_14: res_14,
                    res_15: res_15,
                    res_16: res_16,
                    res_17: res_17,
                    res_18: res_18,
                    res_19: res_19,
                    res_20: res_20,
                    res_21: res_21,
                    res_22: res_22,
                    res_23: res_23,
                    res_24: res_24,
                    res_25: res_25,
                    CompareCovertCameras: CompareCovertCameras,
                    CompareIR_LowLightTech: CompareIR_LowLightTech,
                    CompareLensFOVs: CompareLensFOVs,
                    CompareVideoFrameRates: CompareVideoFrameRates,
                    DVRStorageCalculator: DVRStorageCalculator,
                    LensFOVCalculator: LensFOVCalculator,
                    NetworkCameraBandwidthCalculator: NetworkCameraBandwidthCalculator,
                    NVRStorageCalculator: NVRStorageCalculator,
                    SystemROICalculator: SystemROICalculator,
                    VoltageDropCalculator: VoltageDropCalculator,
                    V_Watts_AConverter: V_Watts_AConverter,
                    Pattern: Pattern,
                    Preset: Preset,
                    PTZControl: PTZControl,
                    Scan: Scan,
                    Tour: Tour,
                    BitRate: BitRate,
                    FrameRate: FrameRate,
                    RecordingResolution: RecordingResolution,
                    SearchMode: SearchMode,
                    system_components: system_components,
                    RangeLineofSight: RangeLineofSight,
                    PanAngle: PanAngle,
                    SDCardIncluded: SDCardIncluded
                });
            });
            return details;
        }    //     ,
             // debouncedCheckContentHeight: function() {
             //         return _.defer(_.bind(this.checkContentHeight, this));
             //     }
             //     ,
             // checkContentHeight: function() {
             //         var content_height = this.$('.active [data-type="information-content-text"]').height();
             //         if (content_height <= 370) {
             //             this.$('[data-type="information-content-text-actions"]').hide();
             //         } else {
             //             this.$('[data-type="information-content-text-actions"]').show();
             //         }
             //     }
             //     ,
             // showMore: function() {
             //         this.$('[data-type="information-content"]').toggleClass('show');
             //     }
,
        getContext: function () {
            return { details: this.details };
        }
    });
});

define('Accessories.Model', [
    'underscore',
    'Backbone.CachedModel',
    'Utils'
], function (_, CachedModel, Utils) {
    'use strict';
    return CachedModel.extend({ urlRoot: Utils.getAbsoluteUrl('services/Accessories.Service.ss') });
});
define('Accessories.View', [
    'accessories_details.tpl',
    'Accessories.Model',
    'ProductViews.Price.View',
    'Backbone.CompositeView',
    'Utils',
    'Backbone',
    'underscore'
], function (accessories_details_tpl, AccessoriesModel, ProductViewsPriceView, BackboneCompositeView, Utils, Backbone, _) {
    'use strict';
    // @class Case.Details.View @extends Backbone.View
    return Backbone.View.extend({
        template: accessories_details_tpl,
        initialize: function (options) {
            var self = this;
            self.model = new AccessoriesModel();
            self.model.fetch({ data: { internalid: options.items.get('internalid') } }).done(function () {
                self.render();
            });
        },
        getContext: function () {
            return {
                model: this.model,
                item: this.options.item
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module ItemViews
define('ItemRelations.RelatedItem.View', [
    'ProductViews.Price.View',
    'GlobalViews.StarRating.View',
    'Backbone.CompositeView',
    'Utils',
    'item_relations_related_item.tpl',
    'Backbone'
], function (ProductViewsPriceView, GlobalViewsStarRatingView, BackboneCompositeView, Utils, item_relations_related_item_tpl, Backbone) {
    'use strict';
    // @class ItemViews.RelatedItem.View Responsible for rendering an item details. The idea is that the item rendered is related to another one in the same page
    // @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: item_relations_related_item_tpl    //@method initialize Override default method to make this view composite
                                           //@param {ItemViews.RelatedItem.View.Initialize.Options} options
                                           //@return {Void}
,
        initialize: function () {
            Backbone.View.prototype.initialize.apply(this, arguments);
            BackboneCompositeView.add(this);
        },
        contextData: {
            'item': function () {
                return Utils.deepCopy(this.model);
            }
        },
        childViews: {
            'Item.Price': function () {
                return new ProductViewsPriceView({
                    model: this.model,
                    origin: 'RELATEDITEM'
                });
            },
            'Global.StarRating': function () {
                return new GlobalViewsStarRatingView({
                    model: this.model,
                    showRatingCount: false
                });
            }
        }    //@method getContext
             //@returns {ItemViews.RelatedItem.View.Context}
,
        getContext: function () {
            //@class ItemViews.RelatedItem.View.Context
            return {
                //@property {String} itemURL
                itemURL: this.model.getFullLink()    //@property {String} itemName
,
                itemName: this.model.get('_name') || this.model.Name,
                thumbnail: this.model.getThumbnail()    //@property {String} sku
,
                sku: this.model.get('_sku')    // @property {String} itemId
,
                itemId: this.model.get('_id')    // @property {Item.Model} model
,
                model: this.model,
                showRating: SC.ENVIRONMENT.REVIEWS_CONFIG && SC.ENVIRONMENT.REVIEWS_CONFIG.enabled,
                track_productlist_list: this.model.get('track_productlist_list')    //@property {String} track_productlist_position
,
                track_productlist_position: this.model.get('track_productlist_position')    //@property {String} track_productlist_category
,
                track_productlist_category: this.model.get('track_productlist_category')
            };    //@class ItemViews.RelatedItem.View
        }
    });
});    //@class ItemViews.RelatedItem.View.Initialize.Options
       //@property {Item.Model} model

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ItemRelations
define('ItemRelations.Related.Collection', [
    'SC.Configuration',
    'Item.Collection',
    'underscore',
    'Utils'
], function (Configuration, ItemCollection, _) {
    'use strict';
    //@class ItemRelations.Related.Collection @extends Item.Collection
    return ItemCollection.extend({
        initialize: function (options) {
            this.searchApiMasterOptions = Configuration.searchApiMasterOptions.relatedItems;
            this.itemsIds = _.isArray(options.itemsIds) ? _.sortBy(options.itemsIds, function (id) {
                return id;
            }) : [options.itemsIds];
        }    //@method fetchItems @return {jQuery.Deferred}
,
        fetchItems: function () {
            return this.fetch({ data: { id: this.itemsIds.join(',') } });
        },
        parse: function (response) {
            var original_items = _.compact(response.items);
            if (original_items.length === 0) {
                return [];    // No items. Return an empty array, nothing else to do here.
            }
            if (original_items.length === 1) {
                return original_items[0].relateditems_detail;    // Same order is preserved.
            }
            // This is to avoid repeated related items among different items. (Cart page)
            var self = this, items = {};
            _.each(_.pluck(original_items, 'relateditems_detail'), function (related_items) {
                _.each(related_items, function (related_item) {
                    if (!_.contains(self.itemsIds, related_item.internalid) && !items[related_item.internalid]) {
                        items[related_item.internalid] = related_item;
                    }
                });
            });
            return _.toArray(items);
        }
    });
});



/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ItemRelations
define('ItemRelations.Related.View', [
    'Backbone.CollectionView',
    'ItemRelations.RelatedItem.View',
    'ItemRelations.Related.Collection',
    'SC.Configuration',
    'Tracker',
    'item_relations_related.tpl',
    'item_relations_row.tpl',
    'item_relations_cell.tpl',
    'jQuery',
    'Backbone',
    'underscore',
    'Utils'
], function (BackboneCollectionView, ItemRelationsRelatedItemView, ItemRelationsRelatedCollection, Configuration, Tracker, item_relations_related_tpl, item_relations_row_tpl, item_relations_cell_tpl, jQuery, Backbone, _) {
    'use strict';
    // @class ItemRelations.Related.View @extends Backbone.CollectionView
    return BackboneCollectionView.extend({
        initialize: function () {
            var is_sca_advance = this.options.application.getConfig('siteSettings.sitetype') === 'ADVANCED', collection = is_sca_advance ? new ItemRelationsRelatedCollection({ itemsIds: this.options.itemsIds }) : new Backbone.Collection(), layout = this.options.application.getLayout(), self = this;
            BackboneCollectionView.prototype.initialize.call(this, {
                collection: collection,
                viewsPerRow: Infinity,
                cellTemplate: item_relations_cell_tpl,
                rowTemplate: item_relations_row_tpl,
                childView: ItemRelationsRelatedItemView,
                template: item_relations_related_tpl
            });
            if (is_sca_advance) {
                layout.once('afterAppendView', self.loadRelatedItem, self);
                layout.currentView && layout.currentView.once('afterCompositeViewRender', self.loadRelatedItem, self);
            }
        },
        loadRelatedItem: function loadRelatedItem() {
            var self = this;
            self.collection.fetchItems().done(function () {
                if (self.collection.length) {
                    Tracker.getInstance().trackProductList(self.collection, 'Related Items');
                }
                self.render();
                var carousel = self.$el.find('[data-type="carousel-items"]');
                if (_.isPhoneDevice() === false && self.options.application.getConfig('siteSettings.imagesizes', false)) {
                    var img_min_height = _.where(self.options.application.getConfig('siteSettings.imagesizes', []), { name: self.options.application.getConfig('imageSizeMapping.thumbnail', '') })[0].maxheight;
                    carousel.find('.item-relations-related-item-thumbnail').css('minHeight', img_min_height);
                }
                _.initBxSlider(carousel, Configuration.get('bxSliderDefaults', {}));
            });
        },
        destroy: function destroy() {
            this._destroy();
            var layout = this.options.application.getLayout();
            layout.off('afterAppendView', this.loadRelatedItems, this);
            layout.currentView && layout.currentView.off('afterCompositeViewRender', this.loadRelatedItems, this);
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ItemRelations
define('ItemRelations.Correlated.Collection', [
    'SC.Configuration',
    'Item.Collection',
    'underscore',
    'Utils'
], function (Configuration, ItemCollection, _) {
    'use strict';
    //@class ItemRelations.Correlated.Collection @extends Item.Collection
    return ItemCollection.extend({
        initialize: function (options) {
            this.searchApiMasterOptions = Configuration.searchApiMasterOptions.correlatedItems;
            this.itemsIds = _.isArray(options.itemsIds) ? _.sortBy(options.itemsIds, function (id) {
                return id;
            }) : [options.itemsIds];
        }    //@method fetchItems @return {jQuery.Deferred}
,
        fetchItems: function () {
            return this.fetch({ data: { id: this.itemsIds.join(',') } });
        }    // http://backbonejs.org/#Model-parse
,
        parse: function (response) {
            var original_items = _.compact(response.items) || [], self = this, items = {};
            _.each(_.pluck(original_items, 'correlateditems_detail'), function (correlated_items) {
                _.each(correlated_items, function (correlated_item) {
                    if (!_.contains(self.itemsIds, correlated_item.internalid) && !items[correlated_item.internalid]) {
                        items[correlated_item.internalid] = correlated_item;
                    }
                });
            });
            return _.toArray(items);
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ItemRelations
define('ItemRelations.Correlated.View', [
    'Backbone.CollectionView',
    'ItemRelations.RelatedItem.View',
    'ItemRelations.Correlated.Collection',
    'Tracker',
    'item_relations_correlated.tpl',
    'item_relations_row.tpl',
    'item_relations_cell.tpl',
    'SC.Configuration',
    'Backbone',
    'underscore',
    'Utils'
], function (BackboneCollectionView, ItemRelationsRelatedItemView, ItemRelationsCorrelatedCollection, Tracker, item_relations_correlated_tpl, item_relations_row_tpl, item_relations_cell_tpl, Configuration, Backbone, _) {
    'use strict';
    // @class ItemRelations.Correlated.View @extends Backbone.CollectionView
    return BackboneCollectionView.extend({
        initialize: function () {
            var is_sca_advanced = Configuration.get('siteSettings.sitetype') === 'ADVANCED', collection = is_sca_advanced ? new ItemRelationsCorrelatedCollection({ itemsIds: this.options.itemsIds }) : new Backbone.Collection(), layout = this.options.application.getLayout(), self = this;
            BackboneCollectionView.prototype.initialize.call(this, {
                collection: collection,
                viewsPerRow: Infinity,
                cellTemplate: item_relations_cell_tpl,
                rowTemplate: item_relations_row_tpl,
                childView: ItemRelationsRelatedItemView,
                template: item_relations_correlated_tpl
            });
            if (is_sca_advanced) {
                layout.once('afterAppendView', self.loadRelatedItems, self);
                layout.currentView && layout.currentView.once('afterCompositeViewRender', self.loadRelatedItems, self);
            }
        },
        loadRelatedItems: function loadRelatedItems() {
            var self = this;
            self.collection.fetchItems().done(function () {
                if (self.collection.length) {
                    Tracker.getInstance().trackProductList(self.collection, 'Correlated Items');
                }
                self.render();
                var carousel = self.$el.find('[data-type="carousel-items"]');
                if (_.isPhoneDevice() === false && self.options.application.getConfig('siteSettings.imagesizes')) {
                    var img_min_height = _.where(self.options.application.getConfig('siteSettings.imagesizes'), { name: self.options.application.getConfig('imageSizeMapping.thumbnail') })[0].maxheight;
                    carousel.find('.item-relations-related-item-thumbnail').css('minHeight', img_min_height);
                }
                _.initBxSlider(carousel, Configuration.bxSliderDefaults);
            });
        },
        destroy: function destroy() {
            this._destroy();
            var layout = this.options.application.getLayout();
            layout.off('afterAppendView', this.loadRelatedItems, this);
            layout.currentView && layout.currentView.off('afterCompositeViewRender', this.loadRelatedItems, this);
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module SocialSharing
define('SocialSharing.Flyout.View', [
    'social_sharing_flyout.tpl',
    'Backbone'
], function (social_sharing_flyout_tpl, Backbone) {
    'use strict';
    // @class SocialSharing.Flyout.View @extends Backbone.View
    return Backbone.View.extend({
        template: social_sharing_flyout_tpl    // @method getContext @returns {SocialSharing.Flyout.View.Context}
,
        getContext: function () {
            // @class SocialSharing.Flyout.View.Context
            return {};
        }
    });
});

/*
    © 2017 NetSuite Inc.
    User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
    provided, however, if you are an authorized user with a NetSuite account or log-in, you
    may use this code subject to the terms that govern your access and use.
*/
//@module ProductDetails
define('ProductDetails.Full.View', [
    'ProductDetails.Base.View',
    'SC.Configuration',
    'ProductDetails.Details.View',
    'ProductDetails.Specification.View',
    'Accessories.View',
    'ItemRelations.Related.View',
    'ItemRelations.Correlated.View',
    'ProductDetails.Information.View',
    'SocialSharing.Flyout.View',
    'product_details_full.tpl',
    'underscore'
], function (ProductDetailsBaseView, Configuration, ProductDetailsDetailsView, ProductDetailsSpecificationView, AccessoriesView, ItemRelationsRelatedView, ItemRelationsCorrelatedView, ProductDetailsInformationView, SocialSharingFlyoutView, product_details_full_tpl, _) {
    'use strict';
    //@class ProductDetails.Full.View Handles the PDP and quick view @extend Backbone.View
    return ProductDetailsBaseView.extend({
        //@property {Function} template
        template: product_details_full_tpl    //@property {Object} attributes List of HTML attributes applied by Backbone into the $el
,
        attributes: {
            'id': 'ProductDetails.Full.View',
            'class': 'view product-detail',
            'data-root-component-id': 'ProductDetails.Full.View'
        },
        bindings: _.extend({}, ProductDetailsBaseView.prototype.bindings, {})    //@method initialize Override default method to update the url on changes in the current product
                                                                       //@param {ProductDetails.Full.View.Initialize.Options} options
                                                                       //@return {Void}
,
        initialize: function initialize() {
            ProductDetailsBaseView.prototype.initialize.apply(this, arguments);
            this.model.on('change', this.updateURL, this);
        },
        childViews: _.extend({}, ProductDetailsBaseView.prototype.childViews, {
            'Correlated.Items': function () {
                return new ItemRelationsCorrelatedView({
                    itemsIds: this.model.get('item').get('internalid'),
                    application: this.application
                });
            },
            'Related.Items': function () {
                return new ItemRelationsRelatedView({
                    itemsIds: this.model.get('item').get('internalid'),
                    application: this.application
                });
            },
            'Product.Information': function () {
                return new ProductDetailsInformationView({ model: this.model });
            },
            'Product.Details': function () {
                return new ProductDetailsDetailsView({ model: this.model });
            },
            'Product.Specification': function () {
                return new ProductDetailsSpecificationView({ model: this.model });
            },
            'Show.Accessories': function () {
                return new AccessoriesView({
                    items: this.model.get('item'),
                    application: this.application
                });
            },
            'SocialSharing.Flyout': function () {
                return new SocialSharingFlyoutView({});
            }
        })    //@method destroy Override default method to detach from change event of the current product
              //@return {Void}
,
        destroy: function destroy() {
            this.model.off('change');
            return this._destroy();
        }    //@method showOptionsPusher Override parent method to allow hide/show the option's pusher on mobile depending on the configuration value: ItemOptions.maximumOptionValuesQuantityWithoutPusher
             //@return {Booelan}
,
        showOptionsPusher: function showOptionsPusher() {
            var options_values_length = _.reduce(this.model.get('options').map(function (option) {
                if (_.isArray(option.get('values'))) {
                    var invalid_values = _.filter(option.get('values'), function (value) {
                        return !value.internalid;
                    });
                    return option.get('values').length - invalid_values.length;
                }
                return 0;
            }), function (memo, num) {
                return memo + num;
            }, 0);
            return options_values_length > Configuration.get('ItemOptions.maximumOptionValuesQuantityWithoutPusher', 1);
        }    //@method getContext
             //@return {ProductDetails.Full.View.Context}
,
        getContext: function getContext() {
            //@class ProductDetails.Full.View.Context @extend ProductDetails.Base.View.Context
            return _.extend(ProductDetailsBaseView.prototype.getContext.apply(this, arguments), {});    //@class ProductDetails.Full.View
        }
    });
});    //@class ProductDetails.Full.View.Initialize.Options @extend ProductDetails.Base.View.Initialize.Options


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Cart
define('Cart.QuickAddToCart.View', [
    'SC.Configuration',
    'LiveOrder.Model',
    'Backbone.CompositeView',
    'Cart.AddToCart.Button.View',
    'ProductViews.Price.View',
    'cart_quickaddtocart.tpl',
    'Backbone',
    'underscore'
], function (Configuration, LiveOrderModel, BackboneCompositeView, CartAddToCartButtonView, ProductViewsPriceView, cart_quickaddtocart_tpl, Backbone, _) {
    'use strict';
    //@class Cart.QuickAddToCart.View @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: cart_quickaddtocart_tpl,
        events: { 'blur [data-action="setquantity"]': 'updateQuantity' }    //@method initialize Override default method to define state properties and attach to model's change event
                                                                    //@param {Cart.QuickAddToCart.View.Initialize.Options} options
                                                                    //@return {Void}
,
        initialize: function initialize() {
            BackboneCompositeView.add(this);
            this.cart = LiveOrderModel.getInstance();
            //@property {Boolean} showQuickAddToCartButton Indicate if the current model is valid to be added form the facet list and if the configuration to show this button is enabled
            this.showQuickAddToCartButton = !!(Configuration.get('addToCartFromFacetsView', false) && this.model.getItem().get('_isPurchasable') && this.model.areAttributesValid(['options']));
        }    //@method getMinimumQuantity Returns the minimum quantity taking into account how many item are in the cart
             //@return {Number}
,
        getMinimumQuantity: function getMinimumQuantity() {
            return !this.cart.findLine(this.model) ? this.model.getItem().get('_minimumQuantity') : 1;
        }    //@method getMaximumQuantity Returns the maximum quantity, if set, taking into account how many item are in the cart
             //@return {Number}
,
        getMaximumQuantity: function getMaximumQuantity() {
            var maximum_quantity = this.model.getItem().get('_maximumQuantity');
            if (!!maximum_quantity) {
                var line_in_cart = this.cart.findLine(this.model);
                maximum_quantity = !line_in_cart ? maximum_quantity : maximum_quantity - line_in_cart.quantity;
                return maximum_quantity;
            }
        }    //@method updateQuantity Set the quantity into the current line
             //@param {jQuery.Event} e
             //@return {Void}
,
        updateQuantity: function updateQuantity(e) {
            var new_quantity = parseInt(this.$(e.target).val(), 10), minimum_quantity = this.getMinimumQuantity(), maximum_quantity = this.getMaximumQuantity();
            if (_.isNaN(new_quantity) || !_.isNumber(new_quantity) || new_quantity < minimum_quantity) {
                new_quantity = minimum_quantity;
            } else if (!!maximum_quantity && new_quantity > maximum_quantity) {
                new_quantity = maximum_quantity;
            }
            this.model.set('quantity', new_quantity);
            this.render();
        },
        childViews: {
            'AddToCart': function () {
                return new CartAddToCartButtonView({
                    model: this.model,
                    application: this.options.application
                });
            },
            'ProductViewsPrice.Price': function () {
                return new ProductViewsPriceView({
                    model: this.model,
                    origin: 'ITEMCELL'
                });
            }
        }    //@method getContext
             //@return {Cart.QuickAddToCart.View.Context}
,
        getContext: function getContext() {
            var item_model = this.model.get('item');
            //@class Cart.QuickAddToCart.View.Context
            return {
                // @property {String} itemId
                itemId: item_model.get('_id')    // @property {Boolean} showQuickAddToCartButton
,
                showQuickAddToCartButton: this.showQuickAddToCartButton,
                minimumQuantity: this.getMinimumQuantity()    // @property {Boolean} maximumQuantity
,
                isMaximumQuantity: !!this.getMaximumQuantity()    // @property {Number} isMaximumQuantity
,
                maximumQuantity: this.getMaximumQuantity()    // @property {Number} quantity
,
                quantity: this.model.get('quantity')
            };    //@class Cart.QuickAddToCart.View
        }
    });
});    //@class Cart.QuickAddToCart.View.Initialize.Options
       //@property {Product.Model} model

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Facets
define('Facets.ItemCell.View', [
    'ProductLine.Stock.View',
    'Product.Model',
    'GlobalViews.StarRating.View',
    'Cart.QuickAddToCart.View',
    'ProductViews.Option.View',
    'ProductLine.StockDescription.View',
    'SC.Configuration',
    'Utils',
    'Backbone',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'underscore'
], function (ProductLineStockView, ProductModel, GlobalViewsStarRating, CartQuickAddToCartView, ProductViewsOptionView, ProductLineStockDescriptionView, Configuration, Utils, Backbone, BackboneCompositeView, BackboneCollectionView, _) {
    'use strict';
    // @class Facets.ItemCell.View @extends Backbone.View
    return Backbone.View.extend({
        //@method initialize Override default method to convert this View into Composite
        //@param {Facets.ItemCell.View.Initialize.Options} options
        //@return {Void}
        initialize: function () {
            BackboneCompositeView.add(this);
        },
        contextData: {
            'item': function () {
                return Utils.deepCopy(this.model);
            }
        },
        childViews: {
            'ItemViews.Stock': function () {
                return new ProductLineStockView({ model: this.model });
            },
            'GlobalViews.StarRating': function () {
                var view = new GlobalViewsStarRating({
                    model: this.model,
                    showRatingCount: false,
                    queryOptions: Utils.parseUrlOptions(location.href)
                });
                return this.options.showStarRating === false ? null : view;
            },
            'ItemDetails.Options': function () {
                var options_configuration = Configuration.get('ItemOptions.optionsConfiguration', []);
                return new BackboneCollectionView({
                    collection: _.filter(this.model.get('options').sortBy('index'), function (option) {
                        var option_configuration = _.findWhere(options_configuration, { cartOptionId: option.get('cartOptionId') });
                        return option_configuration && option_configuration.showSelectorInList;
                    }),
                    childView: ProductViewsOptionView,
                    viewsPerRow: 1,
                    childViewOptions: {
                        item: this.model,
                        templateName: 'facetCell',
                        showLink: true,
                        hideLabel: true,
                        showSmall: true
                    }
                });
            },
            'Cart.QuickAddToCart': function () {
                var product = new ProductModel({
                    item: this.model,
                    quantity: this.model.get('_minimumQuantity', true)
                });
                return new CartQuickAddToCartView({
                    model: product,
                    application: this.options.application
                });
            },
            'StockDescription': function () {
                return new ProductLineStockDescriptionView({ model: this.model });
            }
        }    // @method getContext @returns {Facets.ItemCell.View.Context}
,
        getContext: function () {
            //@class Facets.ItemCell.View.Context
            return {
                // @property {String} itemId
                itemId: this.model.get('_id')    // @property {String} name
,
                name: this.model.get('_name')    // @property {String} url
,
                url: this.model.get('_url')    //@property {String} sku
,
                sku: this.model.getSku()    // @property {Boolean} isEnvironmentBrowser
,
                isEnvironmentBrowser: SC.ENVIRONMENT.jsEnvironment === 'browser' && !SC.ENVIRONMENT.isTouchEnabled,
                thumbnail: this.model.getThumbnail()    // @property {Boolean} itemIsNavigable
,
                itemIsNavigable: !_.isUndefined(this.options.itemIsNavigable) ? !!this.options.itemIsNavigable : true    //@property {Boolean} showRating
,
                showRating: SC.ENVIRONMENT.REVIEWS_CONFIG && SC.ENVIRONMENT.REVIEWS_CONFIG.enabled,
                rating: this.model.get('_rating')    //@property {String} track_productlist_list
,
                track_productlist_list: this.model.get('track_productlist_list')    //@property {String} track_productlist_position
,
                track_productlist_position: this.model.get('track_productlist_position')    //@property {String} track_productlist_category
,
                track_productlist_category: this.model.get('track_productlist_category')
            };    //@class Facets.ItemCell.View
        }
    });
});    //@class Facets.ItemCell.View.Initialize.Options
       //@property {Item.Model} model
       //@property {ApplicationSkeleton} application
       //@property {Boolean?} itemIsNavigable




/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module StoreLocator
define('StoreLocator.Search.View', [
    'store_locator_search.tpl',
    'AjaxRequestsKiller',
    'underscore',
    'SC.Configuration',
    'Backbone',
    'Backbone.FormView',
    'jQuery',
    'Utils'
], function (store_locator_search_tpl, AjaxRequestsKiller, _, Configuration, Backbone, BackboneFormView, jQuery) {
    'use strict';
    return Backbone.View.extend({
        template: store_locator_search_tpl,
        events: {
            'click [data-action="use-geolocation"]': 'useGeolocation',
            'submit form': 'saveFormCustom',
            'keypress [name="city"]': 'saveFormCustom'
        }    // @method saveFormCustom Saves the form but preventing collision with google maps by using a timeout
             // @param {jQuery.Event} e jQuery event
,
        saveFormCustom: function saveFormCustom(e) {
            if (e.type === 'keypress' && e.keyCode === 13 || e.type === 'submit') {
                e.preventDefault();
                e.stopPropagation();
                var self = this, args = arguments;
                setTimeout(function () {
                    self.saveForm.apply(self, args);
                }, 500);
            }
        }    //@method initialize
             //@param {Object} options
,
        initialize: function initialize(options) {
            this.model = new Backbone.Model();
            var view = this;
            this.model.validation = {
                city: {
                    fn: function (value) {
                        var position = view.reference_map.getPosition();
                        if (!value) {
                            return _('Please select an address.').translate();
                        } else if (value && !position) {
                            return _('Address not found.').translate();
                        } else if (position.address !== value) {
                            return _('Please select a valid address.').translate();
                        }
                    }
                }
            };
            this.model.sync = _.bind(this.findStores, this);
            BackboneFormView.add(this, { noCloneModel: true });
            this.application = options.application;
            this.reference_map = options.reference_map;
            this.collection = options.collection;
            this.profileModel = options.profileModel;
            var self = this, position_promise = jQuery.Deferred(), store_locator_last_search = this.profileModel.get('storeLocator_last_search'), position = this.reference_map.getPosition();
            if (!position.refineSearch) {
                if (store_locator_last_search) {
                    this.reference_map.setPosition({
                        latitude: store_locator_last_search.latitude,
                        longitude: store_locator_last_search.longitude,
                        address: store_locator_last_search.address
                    });
                    position_promise.resolve();
                } else if (this.options.useGeolocation) {
                    this.getCurrentPositionGeolocation().done(function () {
                        position_promise.resolve();
                    });
                }
            }
            position_promise.done(function () {
                self.findStores();
            });
            this.collection.on('sync, reset', this.render, this);
            this.reference_map.on('change:position', function () {
                self.setInputValue();
            });
        }    //@method render
,
        render: function render() {
            if (!this.options.alwaysVisible && this.collection.length) {
                this.$el.empty();
                return this;
            }
            this._render();
            var self = this;
            this.$input = this.$('[data-type="autocomplete-input"]');
            this.reference_map.load().done(function () {
                self.reference_map.showAutoCompleteInput(self.$input.get(0));
                self.setInputValue();
            });
            return this;
        }    //@method setInputValue
             //@return {void}
,
        setInputValue: function setInputValue() {
            var position = this.reference_map.getPosition();
            if (position) {
                this.$input && this.$input.val(position.address);
            }
        },
        getCurrentPositionGeolocation: function getCurrentPositionGeolocation() {
            var promise = jQuery.Deferred(), self = this;
            this.reference_map.getCurrentPositionGeolocation().done(function () {
                self.reference_map.load().done(function () {
                    self.reference_map.getCityGeoCode().done(function () {
                        promise.resolveWith(self, self.reference_map.getPosition());
                    });
                });
            }).fail(function (error) {
                promise.rejectWith(self, arguments);
                self.blockPosition(error);
            });
            return promise;
        }    //@method useGeolocation
,
        useGeolocation: function useGeolocation() {
            this.reference_map.clearPointList();
            var self = this;
            this.$('[data-action="message-warning"]').hide();
            this.getCurrentPositionGeolocation().done(function () {
                self.findStores();
            });
        }    //@method blockPosition
             //@param {PositionError} error
,
        blockPosition: function blockPosition(error) {
            switch (error.code) {
            case error.PERMISSION_DENIED:
                this.$('[data-action="message-warning"]').html(_('To use this functionality enable geolocation.').translate()).show();
                break;
            case error.POSITION_UNAVAILABLE:
                this.$('[data-action="message-warning"]').html(_('Location information is unavailable.').translate()).show();
                break;
            case error.TIMEOUT:
                this.$('[data-action="message-warning"]').html(_('The request to get user location timed out.').translate()).show();
                break;
            case error.UNKNOWN_ERROR:
                this.$('[data-action="message-warning"]').html(_('An unknown error occurred.').translate()).show();
                break;
            }
        }    // @method findStores Find stores according to location
             // @param {String} method The http method used
             // @param {model} The model used in the form
             // @param {jQuery.Deferred} callbacks
,
        findStores: function findStores(method, model, callbacks) {
            this.collection.reset();
            var position = this.reference_map.getPosition();
            if (position && position.address) {
                this.profileModel.set('storeLocator_last_search', position);
                return this.collection.update({
                    latitude: position.latitude,
                    longitude: position.longitude,
                    radius: this.reference_map.configuration.getRadius(),
                    sort: 'distance',
                    page: 'all',
                    killerId: AjaxRequestsKiller.getKillerId(),
                    reset: true,
                    locationtype: Configuration.get('storeLocator.defaultTypeLocations')
                }, callbacks);
            }
        }    //@method getContext
             //@return StoreLocator.Location.View.Context
,
        getContext: function getContext() {
            return {
                showUseCurrentLocationButton: this.options.useGeolocation,
                showResults: !!this.collection.length
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module StoreLocator
define('StoreLocator.Model', [
    'Location.Model',
    'Utils'
], function (LocationModel, Utils) {
    'use strict';
    return LocationModel.extend({
        //@property {String} urlRoot
        urlRoot: Utils.getAbsoluteUrl('services/StoreLocator.Service.ss')
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module StoreLocator
define('StoreLocator.Collection', [
    'Location.Collection',
    'StoreLocator.Model',
    'underscore',
    'Utils'
], function (LocationCollection, StoreLocatorModel, _, Utils) {
    'use strict';
    //@class StoreLocator.Collection @extend Backbone.Collection
    return LocationCollection.extend({
        //@property {StoreLocator.Model} model
        model: StoreLocatorModel    //@property {String} url
,
        url: Utils.getAbsoluteUrl('services/StoreLocator.Service.ss')
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module PickupInStore
define('PickupInStore.StoreSelector.List.Row.View', [
    'pickup_in_store_store_selector_list_row.tpl',
    'Location.VenueDetails.View',
    'LiveOrder.Model',
    'Backbone.CollectionView',
    'Backbone.CompositeView',
    'Backbone',
    'jQuery',
    'jquery.cookie'
], function (pickup_in_store_store_selector_list_row_tpl, LocationVenueDetailsView, LiveOrderModel, BackboneCollectionView, BackboneCompositeView, Backbone, jQuery) {
    'use strict';
    // @class PickupInStore.StoreSelector.List.Row.View @extends Backbone.View
    return Backbone.View.extend({
        // @property {Function} template
        template: pickup_in_store_store_selector_list_row_tpl    //@property {Object} events
,
        events: {
            'click [data-store-id]': 'selectStore',
            'show.bs.dropdown': 'setFlyoutPosition'
        }    // @method initialize
,
        initialize: function initialize(options) {
            this.model = options.model;
            this.product = options.product;
            this.application = options.application;
            this.source = options.source;
            BackboneCompositeView.add(this);
        }    // @property {ChildViews} childViews
,
        childViews: {
            'PickupInStore.StoreLocationInfo': function () {
                var self = this;
                return new LocationVenueDetailsView({
                    model: self.model,
                    application: self.application,
                    showAddress: false
                });
            }
        }    // @method selectStore Sets up the store according to the user's selection
,
        selectStore: function selectStore(e) {
            e.preventDefault();
            this.product.set('location', this.model);
            this.product.set('fulfillmentChoice', 'pickup');
            jQuery.cookie('myStore', this.model.get('internalid'));
            if (this.source && this.source === 'cart') {
                var self = this, cart_promise = LiveOrderModel.getInstance().updateLine(this.product);
                cart_promise.done(function () {
                    self.options.application.getLayout().closeModal();
                });
            }
        }    // @method setFlyoutPosition Sets flyout position regarding if it should be shown up or down
,
        setFlyoutPosition: function setFlyoutPosition(e) {
            var element_link = jQuery(e.relatedTarget), element_dropdown = element_link.siblings('[data-type="opening-hours-flyout"]'), element_parent_list = element_link.closest('[data-type="store-row"]'), bottom_distance = element_parent_list.offset().top + element_parent_list.height() - (element_link.offset().top + element_link.height());
            if (bottom_distance < element_dropdown.height()) {
                element_dropdown.addClass('pickup-in-store-store-selector-list-row-opening-hours-flyout-content-up');
            } else {
                element_dropdown.removeClass('pickup-in-store-store-selector-list-row-opening-hours-flyout-content-up');
            }
        }    // @method getContext @return {PickupInStore.StoreSelector.List.Row.View.Context}
,
        getContext: function getContext() {
            var is_store_selected = parseInt(this.product.get('location').get('internalid'), 10) === parseInt(this.model.get('internalid'), 10);
            return {
                //@property {Object} location
                location: this.model,
                showStoreAddress: !!this.model.get('address1')    //@property {Boolean} areSetCityAndAddress
,
                areSetCityAndAddress: !!this.model.get('address1') && !!this.model.get('city')    //@property {Boolean} showCity
,
                showCity: !!this.model.get('city')    //@property {Boolean} showStoresState
,
                showStoreState: !!this.model.get('state')    //@property {Boolean} showZipCode
,
                showZipCode: !!this.model.get('zip')    //@property {Boolean} showServiceHours
,
                showServiceHours: !!this.model.get('servicehours') && !!this.model.get('servicehours').length && !!this.model.get('servicehours')[0].starttime,
                showPhone: !!this.model.get('phone')    //@property {Boolean} storeHasStock
,
                storeHasStock: this.model.get('qtyavailableforstorepickup') > 0    //@property {Boolean} isStoreSelected
,
                isStoreSelected: is_store_selected
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module PickupInStore
define('PickupInStore.StoreSelector.ItemDetail.View', [
    'Transaction.Line.Views.Options.Selected.View',
    'Transaction.Line.Views.Price.View',
    'ProductLine.Sku.View',
    'Backbone.CollectionView',
    'Backbone.CompositeView',
    'pickup_in_store_store_selector_item_detail.tpl',
    'Backbone'
], function (TransactionLineViewsOptionsSelectedView, TransactionLineViewsPriceView, ProductLineSkuView, BackboneCollectionView, BackboneCompositeView, transaction_line_views_cell_navigable_tpl, Backbone) {
    'use strict';
    //@class PickupInStore.StoreSelector.ItemDetail.View @extend Backbone.View
    return Backbone.View.extend({
        // @property {Function} template
        template: transaction_line_views_cell_navigable_tpl    // @method initialize
                                                     // @param {PickupInStore.StoreSelector.ItemDetail.View.InitializeParameters} options
,
        initialize: function (options) {
            this.options = options;
            this.application = options.application;
            this.model = options.model;
            BackboneCompositeView.add(this);
        }    // @property {ChildViews} childViews
,
        childViews: {
            'Item.Price': function () {
                return new TransactionLineViewsPriceView({ model: this.model });
            },
            'Item.Sku': function () {
                return new ProductLineSkuView({ model: this.model });
            }
        }    //@method getContext
             //@return {PickupInStore.StoreSelector.ItemDetail.View.Context}
,
        getContext: function () {
            var item = this.model.get('item');
            //@class PickupInStore.StoreSelector.ItemDetail.View.Context
            return {
                //@property {String} itemName
                itemName: item.get('_name')    // @property {ImageContainer} thumbnail
,
                thumbnail: this.model.getThumbnail()
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module PickupInStore
define('PickupInStore.StoreSelector.List.View', [
    'pickup_in_store_store_selector_list.tpl',
    'StoreLocator.Search.View',
    'StoreLocator.Collection',
    'PickupInStore.StoreSelector.List.Row.View',
    'PickupInStore.StoreSelector.ItemDetail.View',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'Profile.Model',
    'Backbone',
    'GlobalViews.Message.View',
    'underscore'
], function (pickup_in_store_store_selector_list_tpl, StoreLocatorSearchView, StoreLocatorCollection, PickupInStoreStoreSelectorListRowView, PickupInStoreStoreSelectorItemDetailView, BackboneCompositeView, BackboneCollectionView, ProfileModel, Backbone, GlobalViewsMessageView, _) {
    'use strict';
    // @class PickupInStore.StoreSelector.List.View @extends Backbone.View
    return Backbone.View.extend({
        // @property {Function} template
        template: pickup_in_store_store_selector_list_tpl    // @property {Object} events
,
        events: { 'click [data-action="refine-search"]': 'refineSearch' }    // @method initialize
                                                                     // @param {PickupInStore.StoreSelector.List.View.InitializeParameters} options
,
        initialize: function initialize(options) {
            this.store_collection = options.store_collection;
            this.model = options.model;
            this.application = options.application;
            this.source = options.source;
            this.reference_map = options.reference_map;
            BackboneCompositeView.add(this);
            this.store_collection.on('reset', this.render, this);
        }    // @property {ChildViews} childViews
,
        childViews: {
            'StoresList.Rows': function () {
                return new BackboneCollectionView({
                    collection: this.stores,
                    viewsPerRow: 1,
                    childView: PickupInStoreStoreSelectorListRowView,
                    childViewOptions: {
                        product: this.model,
                        application: this.application,
                        source: this.source
                    }
                });
            },
            'GlobalMessageStoresStockUnavailable': function () {
                return new GlobalViewsMessageView({
                    message: _.translate('We\'re sorry, it looks like the stores nearby that offer pickup are out of stock today.'),
                    type: 'warning',
                    closable: false
                });
            },
            'GlobalMessageStoresUnavailable': function () {
                return new GlobalViewsMessageView({
                    message: _.translate('We\'re sorry, it looks like there are no stores nearby that offer pickup.'),
                    type: 'warning',
                    closable: false
                });
            },
            'Line.Item.Information': function () {
                if (this.source && this.source === 'cart') {
                    return new PickupInStoreStoreSelectorItemDetailView({
                        model: this.model,
                        application: this.application
                    });
                }
            }
        }    // @method refineSearch
,
        refineSearch: function refineSearch(e) {
            e.preventDefault();
            this.reference_map.myposition = null;
            this.store_collection.reset();
        }    // @method render
,
        render: function render() {
            var self = this;
            this.item = this.model.getItem();
            this.stock_information_per_location = this.item.get('_quantityavailableforstorepickup_detail');
            this.stores = _.compact(_.map(this.stock_information_per_location, function (location) {
                var store_information = self.store_collection.get(location.internalid);
                return store_information && store_information.set(location);
            }));
            // sort stores by stock and distance
            this.stores.sort(function (store, other_store) {
                if (store.get('qtyavailableforstorepickup') === 0 && other_store.get('qtyavailableforstorepickup') > 0) {
                    return 1;
                } else if (store.get('qtyavailableforstorepickup') > 0 && other_store.get('qtyavailableforstorepickup') === 0) {
                    return -1;
                }
                return store.get('distance') - other_store.get('distance');
            });
            this.stock_pickup = false;
            _.each(this.stores, function (stores) {
                if (stores.get('qtyavailableforstorepickup') > 0) {
                    self.stock_pickup = true;
                    return;
                }
            });
            if (this.stores.length || this.store_collection.length) {
                this._render();
            } else {
                this.$el.empty();
            }
        }    // @method getContext @return {PickupInStore.StoreSelector.List.View.Context}
,
        getContext: function getContext() {
            return {
                //@property {Object} stores
                stores: this.stores,
                storesLength: this.stores.length,
                isOneStore: this.stores.length === 1    //@property {Boolean} isEmptyStores
,
                isEmptyStores: this.stores.length === 0    //@property {Object} stockPickup
,
                stockPickup: this.stock_pickup,
                model: this.model,
                maxHeight: window.innerHeight / 2 - 60    //@property {Object} myPosition
,
                myPosition: this.reference_map.myposition && this.reference_map.myposition.address ? this.reference_map.myposition.address : ''
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module PickupInStore
define('PickupInStore.StoreSelector.View', [
    'pickup_in_store_store_selector.tpl',
    'StoreLocator.Search.View',
    'PickupInStore.StoreSelector.List.View',
    'StoreLocator.Collection',
    'Backbone',
    'Backbone.CompositeView',
    'Profile.Model',
    'Utils'
], function (pickup_in_store_store_selector_tpl, StoreLocatorSearchView, PickupInStoreStoreSelectorListView, StoreLocatorCollection, Backbone, BackboneCompositeView, ProfileModel, Utils) {
    'use strict';
    // @class PickupInStore.StoreSelector.View @extends Backbone.View
    return Backbone.View.extend({
        // @property {Function} template
        template: pickup_in_store_store_selector_tpl    //@property {String} title
,
        title: Utils.translate('Select Store')    // @method initialize
                                           // @param {PickupInStore.StoreSelector.View.InitializeParameters} options
,
        initialize: function initialize(options) {
            Backbone.View.prototype.initialize.apply(this, arguments);
            BackboneCompositeView.add(this);
            this.model = options.model;
            this.application = options.application;
            this.item = this.model.getItem();
            this.item_pickup_in_store_locations = this.item.get('_quantityavailableforstorepickup_detail');
            this.source = options.source;
            this.reference_map = this.options.reference_map;
            this.store_collection = new StoreLocatorCollection();
        }    // @property {method} focusFirstInput
,
        focusFirstInput: function focusFirstInput() {
            return !this.store_collection.length;
        }    // @property {ChildViews} childViews
,
        childViews: {
            'StoreSearch': function () {
                return new StoreLocatorSearchView({
                    collection: this.store_collection,
                    application: this.application,
                    reference_map: this.reference_map,
                    profileModel: ProfileModel.getInstance(),
                    alwaysVisible: !Utils.isPhoneDevice(),
                    useGeolocation: window.location.protocol === 'https:'
                });
            },
            'StoreList': function () {
                return new PickupInStoreStoreSelectorListView({
                    store_collection: this.store_collection,
                    application: this.application,
                    reference_map: this.reference_map,
                    profileModel: ProfileModel.getInstance(),
                    model: this.model,
                    source: this.source
                });
            }
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module StoreLocatorReferenceMapsImplementation
define('ReferenceMap.Configuration', [], function () {
    'use strict';
    var configuration = {
        //@method mapOptions
        //@returns {Object} with default center location, zoom, mapType and mapTypeControl
        mapOptions: function () {
        }    //@method mapOptions
             //@returns {Object} with Store icon, position icon and autocomplete input
,
        iconOptions: function () {
        }    //@method zoomInDetails
             //@return {Number} zoom to be applied in Store.Locator.Details.View
,
        zoomInDetails: function () {
        }    //@method title
             //@retrun {String} to be applied in Main and Header
,
        title: function () {
        }    //@method isEnabled
             //@return {Boolean} define if application is enabled or disabled
,
        isEnabled: function () {
        }    //@method getUrl
             //@return {String} url to be loaded
,
        getUrl: function () {
        }    //@method getApiKey
             //@return {String} map provider api key
,
        getApiKey: function () {
        }    //@method getExtraData
             //@return {Array} with {Object} _internalid, name, servicehours
,
        getExtraData: function () {
        }    //@method getRadius
             //@return {Number} radius used in search
,
        getRadius: function () {
        }    //@method openPopupOnMouseOver define if popup appears when scroll on the list
             //@return {Boolean}
,
        openPopupOnMouseOver: function () {
        }    //@method showLocalizationMap
             //@return {Boolean} map appears when search in mobile
,
        showLocalizationMap: function () {
        }    //@method showAllStoresRecordsPerPage
             //@return {Number} total of records per page in StoreLocator.List.View.All
,
        showAllStoresRecordsPerPage: function () {
        }
    };
    return configuration;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module StoreLocatorReferenceMapsImplementation
// @class ReferenceMap 
// This class implemented a facade that is used to separate application and map engine and provide an easy way to implement any maps engine. 
// For changing current maps engine re-implement the operations below.
define('ReferenceMap', [
    'ReferenceMap.Configuration',
    'underscore',
    'Backbone',
    'jQuery',
    'Utils'
], function (ReferenceMapConfiguration, _, Backbone, jQuery) {
    'use strict';
    var ReferenceMap = function ReferenceMap() {
        this.configuration = ReferenceMapConfiguration;
        //Stores instance of the map created in showMap method
        this.map = null;
        //Handles markers created in showPoint() method
        this.points = [];
        //{Object} containing latitude, longitude and address
        this.myposition = {};
    };
    //@method load
    //@return Promise object which observes maps library loading
    ReferenceMap.prototype.load = function load() {
    };
    //@method isInitialized
    //@return {Boolean} If true, library has been initialized. Otherwise false.
    ReferenceMap.prototype.isInitialize = function isInitialized() {
    };
    //@method showMap has the responsability of showing the map in a container and set an instance of map in this.map
    //@param {Object} element. HTML element that will be used for rendering the map
    //@return {Void}
    ReferenceMap.prototype.showMap = function showMap() {
    };
    //@method centerMapToDefault
    ReferenceMap.prototype.centerMapToDefault = function centerMapToDefault() {
    };
    //@method showPoint creates a point for showing in the map
    //@return {Object} point
    ReferenceMap.prototype.showPoint = function showPoint() {
    };
    //@method removePoint removed a point from the map
    //@param {Object} point to remove
    //@return {Void}
    ReferenceMap.prototype.removePoint = function removePoint() {
    };
    //@method showAutoCompleteInput shows an initialize the automcomplete feature
    //@param {Object} input html input
    //@return {Object} autocomplete object
    ReferenceMap.prototype.showAutoCompleteInput = function showAutoCompleteInput() {
    };
    //@method autoCompleteChange executed when the autoComplete input value changes and sets {Object} this.myposition with latitude, longitude and address
    ReferenceMap.prototype.autoCompleteChange = function autoCompleteChange() {
    };
    //@method showMyPosition show current position in the map
    //@param {Object} position
    ReferenceMap.prototype.showPosition = function showPosition() {
    };
    //@method showPointList iterates on a list of Store.Locator.Model objects and shows the points in the map.
    ReferenceMap.prototype.showPointList = function showPointList(list, map) {
        var self = this;
        list.each(function (point) {
            self.points.push(self.showPoint(point, map));
        });
    };
    //@method showPointWithoutInfoWindow shows the point the map without rendering the Location details tooltip
    //@param {StoreLocator.Model}
    ReferenceMap.prototype.showPointWithoutInfoWindow = function showPointWithoutInfoWindow() {
    };
    //@method getInfoWindow current instance of the view which shows the Location details tooltip
    //@return {Object}
    ReferenceMap.prototype.getInfoWindow = function getInfoWindow() {
    };
    //@method getTooltip returns an instance of StoreLocator.Tooltip.View
    //@param {StoreLocator.Model} model
    //@param {Integer} index
    //@return {StoreLocator.Tooltip.View}
    ReferenceMap.prototype.getTooltip = function getTooltip() {
    };
    //@method showInfoWindow renders StoreLocator.Tooltip.View into getInfoWindow for showing the information in the map
    //@param {Object} marker
    //@param {StoreLocator.Model} model
    //@param {Integer} index
    ReferenceMap.prototype.showInfoWindow = function showInfoWindow() {
    };
    //@method showInfoWindowOnClick obtain the point of a collection and passing parameters to showInfoWindow
    //@param {Object} point
    ReferenceMap.prototype.showInfoWindowOnClick = function showInfoWindowOnClick() {
    };
    //@method clearPointList remove all points from map and this.points
    ReferenceMap.prototype.clearPointList = function clearPointList() {
        var self = this;
        _.each(this.points, function (point) {
            self.removePoint(point);
        });
        this.points = [];
    };
    //@method fitBounds centers and zooms the map for making all the points fit.
    ReferenceMap.prototype.fitBounds = function fitBounds() {
    };
    //@method getCityGeoCode retrieves an address from latitude and longitude and saves the result in this.myposition.address
    ReferenceMap.prototype.getCityGeoCode = function getCityGeoCode() {
    };
    //@method zoomToPoint centers the map in one specific point
    //@param {Object} point
    ReferenceMap.prototype.zoomToPoint = function zoomToPoint() {
    };
    //@method getDirectionsUrl 
    //@param {Object} source
    //@param {Object} destination
    //@returns {String}
    ReferenceMap.prototype.getDirectionsUrl = function getDirectionsUrl(source, destination) {
        source;
        destination;
    };
    //@method getCurrentPositionGeolocation @return {jQuery.Deferred}
    ReferenceMap.prototype.getCurrentPositionGeolocation = function getCurrentPositionGeolocation() {
        var promise = jQuery.Deferred(), self = this;
        navigator.geolocation.getCurrentPosition(function (position) {
            self.setPosition({
                latitude: position.coords.latitude,
                longitude: position.coords.longitude,
                address: ''
            });
            promise.resolveWith(self, [self.myposition]);
        }, function () {
            promise.rejectWith(self, arguments);
        });
        return promise;
    };
    ReferenceMap.prototype.setPosition = function (position) {
        this.myposition = position ? position : { refineSearch: true };
        this.trigger('change:position', this.myposition);
    };
    ReferenceMap.prototype.getPosition = function () {
        return this.myposition || {};
    };
    _.extend(ReferenceMap.prototype, Backbone.Events);
    return ReferenceMap;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module PickupInStore
define('PickupInStore.View', [
    'pickup_in_store.tpl',
    'PickupInStore.StoreSelector.View',
    'Location.VenueDetails.View',
    'LiveOrder.Model',
    'Profile.Model',
    'ReferenceMap',
    'Location',
    'Backbone.CompositeView',
    'Backbone',
    'underscore',
    'jQuery'
], function (pickup_in_store_tpl, PickupInStoreStoreSelectorView, LocationVenueDetailsView, LiveOrderModel, ProfileModel, ReferenceMap, Location, BackboneCompositeView, Backbone, _, jQuery) {
    'use strict';
    // @class PickupInStore.View @extends Backbone.View
    return Backbone.View.extend({
        // @property {Function} template
        template: pickup_in_store_tpl    // @property {Object} events
,
        events: {
            'change [data-action="selectShip"]': 'selectShip',
            'change [data-action="selectPickup"]': 'selectPickup',
            'click [data-action="selectPickupLink"]': 'selectPickup',
            'click [data-action="changeStore"]': 'changeStore'
        }    // @method initialize
,
        initialize: function initialize(options) {
            BackboneCompositeView.add(this);
            this.model = options.model;
            this.application = options.application;
            this.source = options.source;
            this.profile_model = ProfileModel.getInstance();
            this.reference_map = new ReferenceMap();
            this.model.on('change:location', this.render, this);
            this.model.on('change:location', this.dismissSelectStore, this);
            this.model.on('change:fulfillmentChoice', this.render, this);
            this.model.get('location').on('change', this.render, this);
            this.model.get('options').on('change', this.render, this);
            var location_id = this.model.get('location').get('internalid') || jQuery.cookie('myStore');
            if (location_id) {
                Location.fetchLocations(location_id).done(function () {
                    options.model.set('location', Location.get(location_id));
                });
            }
        }    // @method render Override default. We'll render only when the item is fulfillable
             // (meaning it is not downloadable, gift certificate or service)
             // @return {function} _render | {Backbone.View} this Returning either the usual render function or this view.
,
        render: function render() {
            if (this.model.getItem().get('_isfulfillable')) {
                return this._render();
            }
            return this;
        }    // @property {ChildViews} childViews
,
        childViews: {
            'PickupInStore.StoreLocationInfo': function () {
                var self = this;
                if (this.model.get('location')) {
                    return new LocationVenueDetailsView({
                        model: this.model.get('location'),
                        application: self.application,
                        showAddress: true
                    });
                }
            }
        }    // @method selectShip Set up the choosen fulfillment choice to 'ship'
,
        selectShip: function selectShip(e) {
            e.preventDefault();
            this.model.set('fulfillmentChoice', 'ship');
            // if the source is the Cart, then the Live Order must be updated
            if (this.source && this.source === 'cart') {
                LiveOrderModel.getInstance().updateLine(this.model);
            }
        }    // @method selectShip Set up the choosen fulfillment choice to 'pickup'
,
        selectPickup: function selectPickup(e) {
            e.preventDefault();
            if (this.getLocationStock() > 0) {
                this.model.set('fulfillmentChoice', 'pickup');
                // if the source is the Cart, then the Live Order must be updated
                if (this.source && this.source === 'cart') {
                    LiveOrderModel.getInstance().updateLine(this.model);
                }
            } else {
                this.changeStore(e);
            }
        }    // @method changeStore
,
        changeStore: function changeStore(e) {
            e.preventDefault();
            var self = this, view = new PickupInStoreStoreSelectorView({
                    model: this.model,
                    application: this.application,
                    reference_map: this.reference_map,
                    source: this.source
                });
            if (_.isPhoneDevice()) {
                this.application.getLayout().showInPush(view);
            } else {
                view.showInModal({ className: 'pickup-in-store-select-store-modal' });
                view.on('modal-close', function () {
                    if (!self.model.get('location').get('internalid')) {
                        self.render();
                    }
                });
            }
        }    // @method dismissSelectStore
,
        dismissSelectStore: function dismissSelectStore() {
            if (_.isPhoneDevice()) {
                this.application.getLayout().closePush();
            } else {
                this.application.getLayout().closeModal();
            }
        }    // @method getLocationStock
,
        getLocationStock: function getLocationStock() {
            var location = this.model.get('location'), stock_information = this.model.getStockInfo(), location_stock = location ? _.findWhere(stock_information.stockPerLocation, { internalid: parseInt(location.get('internalid'), 10) }) : null;
            return location_stock ? location_stock.qtyavailableforstorepickup : 0;
        }    // @method getContext
,
        getContext: function getContext() {
            var location = this.model.get('location'), item = this.model.getItem(), stock_information = this.model.getStockInfo(), location_stock = this.getLocationStock(), is_available_for_ship = item.get('_isBackorderable') || item.get('_isInStock'), internal_id = this.source && this.source === 'cart' ? this.model.get('internalid') : item.get('internalid');
            return {
                //@property {Boolean} isAvailableForShip
                isAvailableForShip: is_available_for_ship    //@property {Boolean} isAvailableForPickup
,
                isAvailableForPickup: stock_information.isAvailableForPickup,
                getDirectionsUrl: location && !location.isNew() ? this.reference_map.getDirectionsUrl(this.profile_model.get('storeLocator_last_search'), location.get('location')) : ''    //@property {Boolean} showDividerLines
,
                showDividerLines: this.options.source !== 'cart'    //@property {Boolean} isShipSelected
,
                isShipSelected: this.model.get('fulfillmentChoice') !== 'pickup'    //@property {Boolean} isPickupSelected
,
                isPickupSelected: this.model.get('fulfillmentChoice') === 'pickup'    //@property {Object} stockInfo
,
                stockInfo: stock_information    //@property {Boolean} showQuantityAvailable
,
                showQuantityAvailable: stock_information.showQuantityAvailable && !_.isUndefined(stock_information.stock)    //@property {Boolean} isAvailableForPickupOnly
,
                isAvailableForPickupOnly: stock_information.isAvailableForPickup && !is_available_for_ship    //@property {Boolean} isAvailableForShipOnly
,
                isAvailableForShipOnly: !stock_information.isAvailableForPickup && is_available_for_ship    //@property {Boolean} isAvailable
,
                isAvailable: stock_information.isAvailableForPickup || is_available_for_ship    //@property {Boolean} isLocationSelected
,
                isLocationSelected: location && !location.isNew()    //@property {Boolean} locationHasStock
,
                locationHasStock: location_stock > 0    //@property {Object} locationStock
,
                locationStock: location_stock    //@property {Boolean} locationShowNextPickupDay
,
                locationShowNextPickupDay: location && !!location.get('nextpickupcutofftime')    //@property {Object} location
,
                location: location    //@property {LiveOrder.Model} model
,
                model: this.model,
                showCutoffTime: !!location.get('nextpickupday')    //@property {Boolean} nextPickupDayIsToday
,
                nextPickupDayIsToday: location.get('nextpickupday') === 'today'    //@property {Boolean} nextPickupDayIsTomorrow
,
                nextPickupDayIsTomorrow: location.get('nextpickupday') === 'tomorrow'    //@property {Boolean} nextPickupDayIsSunday
,
                nextPickupDayIsSunday: location.get('nextpickupday') === 'sunday'    //@property {Boolean} nextPickupDayIsMonday
,
                nextPickupDayIsMonday: location.get('nextpickupday') === 'monday'    //@property {Boolean} nextPickupDayIsTuesday
,
                nextPickupDayIsTuesday: location.get('nextpickupday') === 'tuesday'    //@property {Boolean} nextPickupDayIsWednesday
,
                nextPickupDayIsWednesday: location.get('nextpickupday') === 'wednesday'    //@property {Boolean} nextPickupDayIsThursday
,
                nextPickupDayIsThursday: location.get('nextpickupday') === 'thursday'    //@property {Boolean} nextPickupDayIsFriday
,
                nextPickupDayIsFriday: location.get('nextpickupday') === 'friday'    //@property {Boolean} nextPickupDayIsSaturday
,
                nextPickupDayIsSaturday: location.get('nextpickupday') === 'saturday'    //@property {String} itemInternalId
,
                itemInternalId: internal_id
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module PickupInStore
define('PickupInStore.FulfillmentOptions.View', [
    'pickup_in_store_fulfillment_options.tpl',
    'Backbone.CompositeView',
    'Backbone'
], function (pickup_in_store_fulfillment_options_tpl, BackboneCompositeView, Backbone) {
    'use strict';
    //@class PickupInStore.FulfillmentOptions.View @extend Backbone.View
    return Backbone.View.extend({
        // @property {Function} template
        template: pickup_in_store_fulfillment_options_tpl    // @method initialize
,
        initialize: function initialize(options) {
            BackboneCompositeView.add(this);
            this.model = options.model;
        }    // @method getContext
,
        getContext: function getContext() {
            this.item = this.model;
            var stock_information = this.model.getStockInfo(), is_available_for_ship = this.item.get('_isBackorderable') || this.item.get('_isInStock');
            return {
                //@property {Boolean} isAvailableForShip
                isAvailableForShip: is_available_for_ship    //@property {Boolean} isAvailableForPickup
,
                isAvailableForPickup: stock_information.isAvailableForPickup
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module PickupInStore
define('PickupInStore.AddToCart.Button', [
    'Cart.AddToCart.Button.View',
    'SC.Configuration'
], function (CartAddToCartButtonView, Configuration) {
    'use strict';
    if (Configuration.get('siteSettings.isPickupInStoreEnabled')) {
        var original_add_to_cart_fn = CartAddToCartButtonView.prototype.addToCart;
        CartAddToCartButtonView.prototype.addToCart = function () {
            if (!this.model.getItem().get('_isstorepickupallowed') && this.model.get('fulfillmentChoice') === 'pickup') {
                this.model.set('fulfillmentChoice', 'ship');
            }
            return original_add_to_cart_fn.apply(this, arguments);
        };
    }
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module PickupInStore
define('PickupInStore', [
    'Location',
    'ProductDetails.Full.View',
    'Cart.Lines.View',
    'Cart.Lines.Free.View',
    'Facets.ItemCell.View',
    'PickupInStore.View',
    'PickupInStore.FulfillmentOptions.View',
    'ProductLine.Common.Url',
    'ProductLine.Stock.View',
    'SC.Configuration',
    'underscore',
    'jQuery',
    'jquery.cookie',
    'PickupInStore.AddToCart.Button'
], function (Location, ProductDetailsFullView, CartLinesView, CartLinesFreeView, FacetsItemCellView, PickupInStoreView, PickupInStoreFulfillmentOptionsView, ProductLineCommonUrl, ProductLineStockView, Configuration, _, jQuery) {
    'use strict';
    //@class ProductDetailToQuote @extend ApplicationModule
    return {
        //@method mountToApp
        //@param {ApplicationSkeleton} application
        //@return {Void}
        mountToApp: function mountToApp(application) {
            if (!Configuration.get('siteSettings.isPickupInStoreEnabled')) {
                return;
            }
            ProductLineCommonUrl.attributesReflectedInURL.push('location');
            ProductLineCommonUrl.attributesReflectedInURL.push('fulfillmentChoice');
            // Set the extra children of the ProductDetailsFullView
            // We show the pickup in store view only if the item is purchasable.
            // If it is not, we show the Out of Stock message.
            ProductDetailsFullView.addChildViews({
                'Product.Stock.Info': function wrapperFunction(options) {
                    return function () {
                        if (options.model.getItem().get('ispurchasable')) {
                            return new PickupInStoreView({
                                model: options.model,
                                application: application
                            });
                        } else {
                            return new ProductLineStockView({ model: options.model });
                        }
                    };
                }
            });
            //Set the extra children of the CartLinesView
            CartLinesView.addChildViews({
                'Product.Stock.Info': function wrapperFunction(options) {
                    return function () {
                        return new PickupInStoreView({
                            model: options.model,
                            application: application,
                            source: 'cart'
                        });
                    };
                }
            });
            //Set the extra children of the CartLinesView
            CartLinesFreeView.addChildViews({
                'Product.Stock.Info': function wrapperFunction(options) {
                    return function () {
                        return new PickupInStoreView({
                            model: options.model,
                            application: application,
                            source: 'cart'
                        });
                    };
                }
            });
            //Set the extra children of the FacetsItemCellView
            FacetsItemCellView.addChildViews({
                'ItemViews.Stock': function wrapperFunction(options) {
                    return function () {
                        if (options.model.get('ispurchasable') && options.model.get('_isfulfillable')) {
                            return new PickupInStoreFulfillmentOptionsView({
                                model: options.model,
                                application: application
                            });
                        } else {
                            return new ProductLineStockView({ model: options.model });
                        }
                    };
                }
            });
            application.getLayout().on('beforeAppendView', function (view) {
                if (view instanceof ProductDetailsFullView) {
                    var location_id = view.model.get('location').get('internalid') || jQuery.cookie('myStore');
                    if (location_id) {
                        Location.fetchLocations(location_id).done(function () {
                            view.model.set('location', Location.get(location_id));
                        });
                    }
                }
            });
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('OrderWizard.Model', [
    'Backbone',
    'Singleton'
], function (Backbone, Singleton) {
    'use strict';
    var OrderWizardModel = Backbone.Model.extend({}, Singleton);
    return OrderWizardModel;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Checkout
define('Checkout.Component', [
    'SC.VisualComponent',
    'SC.Configuration',
    'OrderWizard.Model',
    'jQuery',
    'underscore'
], function (SCVisualComponent, SCConfiguration, OrderWizardModel, jQuery, _) {
    'use strict';
    var is_wizard_router_ready = jQuery.Deferred(), order_wizard_model = OrderWizardModel.getInstance()    // @function format formats An entity data grouping both commons attributes (SCIS and SCA) and non-commons. The last goes into the 'extras' key
                                          // @private
                                          // @param {Object} entity Data object to format
                                          // @param {Array<String>} commonAttrs Array with a string of all the common attributes that are at the first level of the returned formatted object
                                          // @return {Object} A Formatted object structured with all the unique properties inside the extra object
, format = function format(entity, commonAttrs) {
            var formatted = { extras: {} };
            _.keys(entity).forEach(function (attr) {
                if (_.contains(commonAttrs, attr)) {
                    formatted[attr] = entity[attr];
                } else {
                    formatted.extras[attr] = entity[attr];
                }
            });
            return formatted;
        };
    return function CheckoutComponentGenerator(application) {
        // @class Checkout.Component This is the concrete front-end Checkout implementation of SuiteCommerce Advanced / SuiteCommerce Standard.
        // See @?class Base.Component
        // @extends Base.Component
        // @public @extlayer
        var api_methods = {
            application: application,
            componentName: 'Checkout',
            DEFAULT_VIEW: 'Wizard.View',
            WIZARD_VIEW: 'Wizard.View',
            _WIZARD_VIEW_ID: 'wizard',
            _isViewFromComponent: function _isViewFromComponent(view) {
                var view_identifier = this._getViewIdentifier(view), view_prototype_id = view && this._getViewIdentifier(view.prototype);
                return view && (view_identifier === this._WIZARD_VIEW_ID || view_prototype_id === this._WIZARD_VIEW_ID);
            },
            _getViewIdentifier: function _getViewIdentifier(view) {
                return view && view.attributes && view.attributes.id;
            },
            _setOrderWizardRouter: function _setOrderWizardRouter(order_wizard_router) {
                this.order_wizard_router = order_wizard_router;
                this.order_wizard_router && is_wizard_router_ready.resolve();
            },
            _normalizeStepUrl: function _normalizeStepUrl(inner_step_url) {
                return inner_step_url.replace(/\?.*/, '');
            },
            _normalizeModule: function _normalizeModule(module) {
                var options = module.module[1], module_id = options.module_id, module_index = options.module_index;
                options.module_id && delete options.module_id;
                options.module_index && delete options.module_index;
                return {
                    step_url: module.step_url,
                    module: {
                        classname: _.isString(module.module[0]) ? module.module[0] : undefined,
                        id: module_id,
                        index: module_index,
                        options: options
                    }
                };
            },
            _normalizeModuleInstance: function _normalizeModuleInstance(inner_module_instance, index) {
                return {
                    id: inner_module_instance.module_id,
                    is_active: !!inner_module_instance.isActive(),
                    is_ready: !!inner_module_instance.isReady,
                    index: index
                };
            },
            _normalizeStep: function _normalizeStep(inner_step) {
                var step = inner_step ? {
                    name: inner_step.getName(),
                    url: inner_step.url,
                    show_step: !!inner_step.showStep(),
                    state: inner_step.state,
                    step_group_name: inner_step.stepGroup.name,
                    modules: _.map(inner_step.moduleInstances, this._normalizeModuleInstance)
                } : undefined;
                return step;
            },
            _normalizeStepGroup: function _normalizeStepGroup(inner_step_group) {
                var self = this, step_group = _.deepCopy({
                        index: inner_step_group.index,
                        name: inner_step_group.name,
                        url: inner_step_group.url,
                        show_group: inner_step_group.showStepGroup(),
                        state: inner_step_group.state
                    }), commonStepGroupAttrs = [
                        'index',
                        'name',
                        'url',
                        'show_group',
                        'state',
                        'steps'
                    ];
                step_group.steps = _.map(inner_step_group.steps, function (step, index) {
                    return self._normalizeStep(step, index);
                });
                return format(step_group, commonStepGroupAttrs);
            }    // @method getCurrentStep Returns the current checkout's step info
                 // @public @extlayer
                 // @return {Deferred<CheckoutStep>} Return a Deferred that is resolved in case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            getCurrentStep: function getCurrentStep() {
                var self = this, deferred = jQuery.Deferred();
                try {
                    var current_step = self.order_wizard_router.getCurrentStep();
                    deferred.resolve(self._normalizeStep(current_step));
                } catch (error) {
                    deferred.reject(error);
                }
                return deferred;
            },
            setCurrentStep: function setCurrentStep(data) {
                var self = this, deferred = jQuery.Deferred();
                try {
                    if (!_.isObject(data) || !data.step_url) {
                        this._reportError('INVALID_PARAM', 'Invalid parameter. Must specify a step_url');
                    }
                    var stepsOrder = self.order_wizard_router.stepsOrder, steps = self.order_wizard_router.steps, current_step_url = self.order_wizard_router.currentStep, current_step_index = _.indexOf(stepsOrder, current_step_url), target_step_index = _.indexOf(stepsOrder, data.step_url);
                    if (_.isEmpty(current_step_url)) {
                        this._reportError('INVALID_STATE', 'Invalid state. There is no current step yet');
                    }
                    if (target_step_index < 0) {
                        this._reportError('INVALID_PARAM', 'Invalid parameter. step_url must a valid step url');
                    }
                    self.cancelableTrigger('beforeSetCurrentStep', data.step_url).done(function () {
                        var promise = jQuery.Deferred().resolve(), step_url, step;
                        function queue_submits(step) {
                            promise = promise.pipe(function () {
                                return step._submit();
                            });
                        }
                        function queue_previous(step) {
                            promise = promise.pipe(function () {
                                return step._previousStep();
                            });
                        }
                        if (current_step_index < target_step_index) {
                            for (var i = current_step_index; i < target_step_index; i++) {
                                step_url = stepsOrder[i];
                                step = steps[step_url];
                                if (!step.showStep()) {
                                    continue;
                                }
                                queue_submits(step);
                            }
                        } else if (current_step_index > target_step_index) {
                            for (var j = current_step_index; j > target_step_index; j--) {
                                step_url = stepsOrder[j];
                                step = steps[step_url];
                                if (!step.showStep()) {
                                    continue;
                                }
                                queue_previous(step);
                            }
                        }
                        promise.done(function () {
                            self.order_wizard_router.navigate(data.step_url, { trigger: false });
                            self.order_wizard_router._runStep();
                            deferred.resolve(data);
                        }).fail(function (result) {
                            self.order_wizard_router.navigate(result.step_url, { trigger: false });
                            self.order_wizard_router._runStep();
                            deferred.reject(result);
                        });
                    }).fail(deferred.reject);
                } catch (error) {
                    deferred.reject(error);
                }
                return deferred;
            }    // @method getStepGroupsInfo Returns the step groups of the checkout flow
                 // @public @extlayer
                 // @return {Deferred<Array<CheckoutStepGroup>>} Return a Deferred that is resolved in case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            getStepGroupsInfo: function getStepGroupsInfo() {
                var self = this, deferred = jQuery.Deferred();
                try {
                    var steps = self.order_wizard_router.stepGroups;
                    deferred.resolve(_.map(steps, function (step) {
                        return self._normalizeStepGroup(step);
                    }));
                } catch (error) {
                    deferred.reject(error);
                }
                return deferred;
            }    // @method getStepsInfo Returns the steps of the checkout flow
                 // @public @extlayer
                 // @return {Deferred<Array<CheckoutStep>>} Return a Deferred that is resolved in case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            getStepsInfo: function getStepsInfo() {
                var self = this, deferred = jQuery.Deferred();
                try {
                    var steps = self.order_wizard_router.steps, steps_order = self.order_wizard_router.stepsOrder;
                    deferred.resolve(_.map(steps_order, function (step_url) {
                        var step = steps[step_url];
                        return self._normalizeStep(step);
                    }));
                } catch (error) {
                    deferred.reject(error);
                }
                return deferred;
            }    // @method getCheckoutFlow Return the name of the configured checkout flow
                 // @public @extlayer
                 // @return {String}
,
            getCheckoutFlow: function getCheckoutFlow() {
                var deferred = jQuery.Deferred();
                try {
                    var checkoutStepsMap = _.invert(this.application.getConfig('checkoutStepsMap')), checkoutStepsName = this.application.getConfig('checkoutStepsName');
                    deferred.resolve(checkoutStepsMap[checkoutStepsName] || checkoutStepsName);
                } catch (error) {
                    deferred.reject(error);
                }
                return deferred;
            },
            _getStep: function _getStep(step_url) {
                if (!step_url) {
                    this._reportError('INVALID_PARAM', 'Invalid parameter. Must specify a step_url');
                }
                var step = this.order_wizard_router.steps[step_url];
                if (!step) {
                    this._reportError('INVALID_PARAM', 'Invalid parameter. No step group found for ' + step_url);
                }
                return step;
            }    // @method addModuleToStep Adds a new module to a step
                 // @public @extlayer
                 // @param {AddModuleData} data
                 // @return {Deferred} Return a Deferred that is resolved in case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            addModuleToStep: function addModuleToStep(data) {
                var self = this, deferred = jQuery.Deferred();
                try {
                    if (!_.isObject(data) || !_.isObject(data.module) || !_.isNumber(data.module.index) || !_.isString(data.module.classname) || !_.isString(data.module.id)) {
                        self._reportError('INVALID_PARAM', 'Invalid parameter. It must be a valid object');
                    }
                    var step = self._getStep(data.step_url);
                    var module = data.module;
                    module.options = module.options || {};
                    module.options.module_id = module.id;
                    module.options.module_index = module.index;
                    step.addModule([
                        module.classname,
                        module.options
                    ]).done(function () {
                        var current_view = self.application.getLayout().getCurrentView();
                        current_view && current_view.render();
                        deferred.resolve();
                    }).fail(deferred.reject);
                } catch (error) {
                    deferred.reject(error);
                }
                return deferred;
            }    // @method removeModuleFromStep Removes a module from a step
                 // @public @extlayer
                 // @param {RemoveModuleData} data
                 // @return {Deferred} Return a Deferred that is resolved in case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            removeModuleFromStep: function removeModuleFromStep(data) {
                var self = this, deferred = jQuery.Deferred();
                try {
                    if (!_.isObject(data) || !_.isString(data.module_id)) {
                        this._reportError('INVALID_PARAM', 'Invalid parameter. It must be a valid object');
                    }
                    var step = this._getStep(data.step_url);
                    var module = _.findWhere(step.moduleInstances, { module_id: data.module_id }), module_index = _.indexOf(step.moduleInstances, module);
                    self.cancelableTrigger('beforeRemoveModuleFromStep', data).done(function () {
                        step.moduleInstances.splice(module_index, 1);
                        module.destroy();
                        var current_view = self.application.getLayout().getCurrentView();
                        current_view && current_view.render();
                        self.cancelableTrigger('afterRemoveModuleFromStep', data);
                        deferred.resolve();
                    }).fail(deferred.reject);
                } catch (error) {
                    deferred.reject(error);
                }
                return deferred;
            }    // @method addStepsGroup Adds a new steps group
                 // @public @extlayer
                 // @param {AddStepGroupData} data
                 // @return {Deferred<CheckoutStepGroup>} Return a Deferred that is resolved in case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            addStepsGroup: function addStepsGroup(data) {
                var self = this, deferred = jQuery.Deferred();
                try {
                    if (!_.isObject(data) || !_.isObject(data.group) || !_.isString(data.group.name) || !_.isString(data.group.url) || !_.isNumber(data.group.index)) {
                        self._reportError('INVALID_PARAM', 'Invalid parameter. It must be a valid object');
                    }
                    var stepGroups = self.order_wizard_router.stepGroups;
                    if (stepGroups[data.group.name]) {
                        self._reportError('INVALID_PARAM', 'Invalid parameter. Already exists a step group: ' + data.group.name);
                    }
                    data.group.steps = [{ url: data.group.url }];
                    self.order_wizard_router._compileStepGroup(data.group, data.group.index).then(function (step_group) {
                        var current_view = self.application.getLayout().getCurrentView();
                        current_view && current_view.render();
                        deferred.resolve(self._normalizeStepGroup(step_group));
                    }, deferred.reject);
                } catch (error) {
                    deferred.reject(error);
                }
                return deferred;
            }    // @method removeStepsGroup Removes a steps group
                 // @public @extlayer
                 // @param {RemoveStepGroupData} data
                 // @return {Deferred} Return a Deferred that is resolved in case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            removeStepsGroup: function removeStepsGroup(data) {
                var self = this, deferred = jQuery.Deferred();
                try {
                    if (!_.isObject(data) || !_.isString(data.group_name)) {
                        this._reportError('INVALID_PARAM', 'Invalid parameter. It must be a valid object');
                    }
                    var steps_groups = self.order_wizard_router.stepGroups, steps_group = steps_groups[data.group_name];
                    if (!steps_group) {
                        self._reportError('INVALID_PARAM', 'Invalid parameter. Does not exists a step group: ' + data.group_name);
                    }
                    if (steps_group.steps.length) {
                        self._reportError('INVALID_PARAM', 'Invalid parameter. The step group (' + data.group_name + ') cannot be removed because it has steps');
                    }
                    self.cancelableTrigger('beforeRemoveStepsGroup', data).done(function () {
                        delete steps_groups[data.group_name];
                        var groups = _.values(steps_groups);
                        _.each(groups, function (group, group_index) {
                            group.index = group_index;
                        });
                        self.order_wizard_router.stepGroups = _.indexBy(groups, 'name');
                        var current_view = self.application.getLayout().getCurrentView();
                        current_view && current_view.render();
                        self.cancelableTrigger('afterRemoveStepsGroup', data);
                        deferred.resolve();
                    }).fail(deferred.reject);
                } catch (error) {
                    deferred.reject(error);
                }
                return deferred;
            }    // @method addStep Adds a new step to a step_group
                 // @public @extlayer
                 // @param {AddStepData} data
                 // @return {Deferred<CheckoutStep>} Return a Deferred that is resolved in case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            addStep: function addStep(data) {
                var self = this, deferred = jQuery.Deferred();
                try {
                    if (!_.isObject(data) || !_.isObject(data.step) || !_.isString(data.step.name) || !_.isString(data.step.group_name) || !_.isString(data.step.url) || !_.isFunction(data.step.isActive)) {
                        self._reportError('INVALID_PARAM', 'Invalid parameter. It must be a valid object');
                    }
                    var steps = self.order_wizard_router.steps, stepGroups = self.order_wizard_router.stepGroups;
                    if (steps[data.step.url]) {
                        self._reportError('INVALID_PARAM', 'Invalid parameter. Already exists a step: ' + data.step.url);
                    }
                    var step_group = stepGroups[data.step.group_name];
                    if (!step_group) {
                        self._reportError('INVALID_PARAM', 'Invalid parameter. Does not exists a step group: ' + data.step.group_name);
                    }
                    data.step.step_index = data.step.index;
                    delete data.step.index;
                    delete data.step.group_name;
                    self.order_wizard_router._compileStep(data.step, step_group).then(function (new_step) {
                        var current_view = self.application.getLayout().getCurrentView();
                        current_view && current_view.render();
                        deferred.resolve(self._normalizeStep(new_step));
                    }, deferred.reject);
                } catch (error) {
                    deferred.reject(error);
                }
                return deferred;
            }    // @method removeStep Removes a step from a step_group
                 // @public @extlayer
                 // @param {String} step_url
                 // @return {Deferred} Return a Deferred that is resolved in case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            removeStep: function removeStep(data) {
                var self = this, deferred = jQuery.Deferred();
                try {
                    if (!_.isObject(data) || !_.isString(data.step_url)) {
                        this._reportError('INVALID_PARAM', 'Invalid parameter. It must be a valid object');
                    }
                    var steps = self.order_wizard_router.steps, step = steps[data.step_url];
                    if (!step) {
                        self._reportError('INVALID_PARAM', 'Invalid parameter. Does not exists a step for the url: ' + data.step_url);
                    }
                    self.cancelableTrigger('beforeRemoveStep', data).done(function () {
                        self.order_wizard_router.stepsOrder = _.reject(self.order_wizard_router.stepsOrder, function (step_url) {
                            return step_url === data.step_url;
                        });
                        step.stepGroup.steps = _.reject(step.stepGroup.steps, function (step_group_step) {
                            return step_group_step === step;
                        });
                        delete steps[data.step_url];
                        self.order_wizard_router.route(data.step_url, jQuery.noop);
                        self.order_wizard_router.route(data.step_url + '?:options', jQuery.noop);
                        var current_view = self.application.getLayout().getCurrentView();
                        current_view && current_view.render();
                        self.cancelableTrigger('afterRemoveStep', data);
                        deferred.resolve();
                    }).fail(deferred.reject);
                } catch (error) {
                    deferred.reject(error);
                }
                return deferred;
            }
        };
        //Wrap public methods to load the checkout wizard before its execution
        _.each(api_methods, function (method, name) {
            if (name.indexOf('_') !== 0 && _.isFunction(method)) {
                api_methods[name] = _.wrap(method, function (fn) {
                    var self = this, args = _.toArray(arguments).slice(1);
                    return is_wizard_router_ready.then(function () {
                        try {
                            return fn.apply(self, args);
                        } catch (error) {
                            return jQuery.Deferred().reject(error);
                        }
                    });
                });
            }
        });
        //@class Checkout.Component @extend Base.Component
        var checkout_component = SCVisualComponent.extend(api_methods);
        var innerToOuterMap = [
            {
                inner: 'before:OrderWizardStep.addModule',
                outer: 'beforeAddModuleToStep',
                normalize: checkout_component._normalizeModule
            },
            {
                inner: 'after:OrderWizardStep.addModule',
                outer: 'afterAddModuleToStep',
                normalize: checkout_component._normalizeModule
            },
            {
                inner: 'before:OrderWizardStep.submit',
                outer: 'beforeSetCurrentStep',
                normalize: checkout_component._normalizeStepUrl
            },
            {
                inner: 'before:OrderWizardStep.previousStep',
                outer: 'beforeSetCurrentStep',
                normalize: checkout_component._normalizeStepUrl
            },
            {
                inner: 'before:OrderWizardRouter.runStep',
                outer: 'beforeSetCurrentStep',
                normalize: checkout_component._normalizeStepUrl
            },
            {
                inner: 'after:OrderWizardRouter.runStep',
                outer: 'afterSetCurrentStep',
                normalize: checkout_component._normalizeStepUrl
            },
            {
                inner: 'before:OrderWizardRouter.compileStep',
                outer: 'beforeAddStep',
                normalize: null
            },
            {
                inner: 'after:OrderWizardRouter.compileStep',
                outer: 'afterAddStep',
                normalize: null
            },
            {
                inner: 'before:OrderWizardRouter.compileStepGroup',
                outer: 'beforeAddStepsGroup',
                normalize: null
            },
            {
                inner: 'after:OrderWizardRouter.compileStepGroup',
                outer: 'afterAddStepsGroup',
                normalize: null
            }
        ];
        checkout_component._suscribeToInnerEvents(innerToOuterMap, order_wizard_model);
        return checkout_component;
    };
});    // jsdoc description for data:
       // @class RemoveStepGroupData
       // @property {String} group_name
       // @class AddStepData
       // @property {String} name
       // @property {String} url
       // @property {Function} isActive
       // @property {String} group_name
       // @property {Number} index
       // @class AddStepGroupData
       // @property {String} name
       // @property {String} url
       // @property {Number} index
       // @class AddModuleData
       // @property {String} step_url
       // @property {ModuleData} module
       // @class ModuleData
       // @property {String} id
       // @property {String} classname
       // @property {ModuleOptions} options
       // @class RemoveModuleData
       // @property {String} step_url
       // @property {String} module_id
       // @class CheckoutStepGroup
       // @property {Number} index
       // @property {String} name
       // @property {String} url
       // @property {Boolean} show_group
       // @property {String} state
       // @property {Array<CheckoutStep>} steps
       // @class CheckoutStep
       // @property {String} url It is the step identifier
       // @property {String} name
       // @property {Boolean} show_step
       // @property {String} state
       // @property {String} step_group_name
       // @property {Array<CheckoutStepModule>} modules
       // @class CheckoutStepModule
       // @property {String} id
       // @property {Boolean} is_active
       // @property {Boolean} is_ready
       // @property {Number} index

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// Profile.js
// -----------------
// Defines the Profile module (Collection, Views, Router)
// As the profile is instanciated in the application (without definining a model)
// the validation is configured here in the mountToApp
define('Checkout.Profile', [
    'Profile.Model',
    'jQuery',
    'Checkout.Component'
], function (ProfileModel, jQuery, CheckoutComponent) {
    'use strict';
    return {
        mountToApp: function (application) {
            var profile_model = ProfileModel.getInstance();
            profile_model.set(SC.ENVIRONMENT.PROFILE);
            if (SC.ENVIRONMENT.ADDRESS) {
                profile_model.get('addresses').reset(SC.ENVIRONMENT.ADDRESS);
                delete SC.ENVIRONMENT.ADDRESS;
            } else {
                profile_model.get('addresses').reset([]);
            }
            if (SC.ENVIRONMENT.CREDITCARD) {
                profile_model.get('creditcards').reset(SC.ENVIRONMENT.CREDITCARD);
                delete SC.ENVIRONMENT.CREDITCARD;
            } else {
                profile_model.get('creditcards').reset([]);
            }
            application.getUser = function () {
                var profile_promise = jQuery.Deferred();
                ProfileModel.getPromise().done(function () {
                    profile_promise.resolve(ProfileModel.getInstance());
                }).fail(function () {
                    profile_promise.reject.apply(this, arguments);
                });
                return profile_promise;
            };
            return CheckoutComponent(application);
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Item
define('Item', [
    'SC.Configuration',
    'underscore'
], function (Configuration, _) {
    'use strict';
    //@class Item @extends ApplicationModule
    return {
        //@method mountToApp Initialize the item options configuration related with option colors
        //@return {Void}
        mountToApp: function (application) {
            //Make of itemOptions color property a object with the color name as
            //the property and the color value as the value of the property.
            var item_options_with_color = _.filter(Configuration.get('ItemOptions.optionsConfiguration', []), function (item_option_config) {
                    return !!item_option_config.colors;
                }), clean_setting = function (item_option, setting_key) {
                    if (item_option && item_option[setting_key] === '') {
                        delete item_option[setting_key];
                        return true;
                    }
                    return false;
                };
            _.each(item_options_with_color || [], function (item_option) {
                item_option.colors = application.getLayout().getColorPalette(item_option.colors);
            });
            //Clean empty settings. These values are optional, when you in the NetSuite interface do not specify nothing
            //they come empty, so for those cases we deleted them so when the Item.Model getPossibleOptions method is executed
            //the default values are NOT overwritten with empty.
            _.each(Configuration.get('ItemOptions.optionsConfiguration', []), function (item_option_configuration) {
                clean_setting(item_option_configuration, 'colors');
                clean_setting(item_option_configuration, 'label');
                clean_setting(item_option_configuration, 'urlParameterName');
                clean_setting(item_option_configuration, 'index');
            });
        }
    };
});













/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module ProductViews
define('ProductViews', [
    'SC.Configuration',
    'product_views_option_color.tpl',
    'product_views_option_dropdown.tpl',
    'product_views_option_radio.tpl',
    'product_views_option_text.tpl',
    'product_views_option_textarea.tpl',
    'product_views_option_email.tpl',
    'product_views_option_phone.tpl',
    'product_views_option_url.tpl',
    'product_views_option_float.tpl',
    'product_views_option_integer.tpl',
    'product_views_option_percent.tpl',
    'product_views_option_currency.tpl',
    'product_views_option_password.tpl',
    'product_views_option_timeofday.tpl',
    'product_views_option_datetimetz.tpl',
    'product_views_option_tile.tpl',
    'product_views_option_checkbox.tpl',
    'product_views_option_date.tpl',
    'product_views_option_facets_color.tpl',
    'product_views_option_facets_tile.tpl',
    'underscore',
    'Utils'
], function (Configuration, product_views_option_color_tpl, product_views_option_dropdown_tpl, product_views_option_radio_tpl, product_views_option_text_tpl, product_views_option_textarea_tpl, product_views_option_email_tpl, product_views_option_phone_tpl, product_views_option_url_tpl, product_views_option_float_tpl, product_views_option_integer_tpl, product_views_option_percent_tpl, product_views_option_currency_tpl, product_views_option_password_tpl, product_views_option_timeofday_tpl, product_views_option_datetimetz_tpl, product_views_option_tile_tpl, product_views_option_checkbox_tpl, product_views_option_date_tpl, product_views_option_facets_color_tpl, product_views_option_facets_tile_tpl, _, Utils) {
    'use strict';
    //@class ProductViews @extends ApplicationModule
    return {
        //@method mountToApp Initialize the item options configuration related with product view templates
        //@return {Void}
        mountToApp: function mountToApp() {
            var product_view_options_selector = {
                    'product_views_option_color.tpl': product_views_option_color_tpl,
                    'product_views_option_dropdown.tpl': product_views_option_dropdown_tpl,
                    'product_views_option_radio.tpl': product_views_option_radio_tpl,
                    'product_views_option_text.tpl': product_views_option_text_tpl,
                    'product_views_option_textarea.tpl': product_views_option_textarea_tpl,
                    'product_views_option_email.tpl': product_views_option_email_tpl,
                    'product_views_option_phone.tpl': product_views_option_phone_tpl,
                    'product_views_option_url.tpl': product_views_option_url_tpl,
                    'product_views_option_float.tpl': product_views_option_float_tpl,
                    'product_views_option_integer.tpl': product_views_option_integer_tpl,
                    'product_views_option_percent.tpl': product_views_option_percent_tpl,
                    'product_views_option_currency.tpl': product_views_option_currency_tpl,
                    'product_views_option_password.tpl': product_views_option_password_tpl,
                    'product_views_option_timeofday.tpl': product_views_option_timeofday_tpl,
                    'product_views_option_datetimetz.tpl': product_views_option_datetimetz_tpl,
                    'product_views_option_tile.tpl': product_views_option_tile_tpl,
                    'product_views_option_checkbox.tpl': product_views_option_checkbox_tpl,
                    'product_views_option_date.tpl': product_views_option_date_tpl
                }, product_view_option_facet = {
                    'product_views_option_facets_color.tpl': product_views_option_facets_color_tpl,
                    'product_views_option_facets_tile.tpl': product_views_option_facets_tile_tpl
                }, item_options = Configuration.get('ItemOptions.optionsConfiguration', []), configuration_default_selector_templates = Configuration.get('ItemOptions.defaultTemplates.selectorByType', []), default_selector_templates = {}, default_template_selector = false, configuration_default_facet_templates = Configuration.get('ItemOptions.defaultTemplates.facetCellByType', []), default_facet_templates = {}, default_template_facet = false;
            _.each(item_options, function (item_option) {
                if (item_option.templateFacetCell && product_view_option_facet[item_option.templateFacetCell]) {
                    item_option.templates = item_option.templates || {};
                    item_option.templates.facetCell = product_view_option_facet[item_option.templateFacetCell];
                }
                if (item_option.templateSelector && product_view_options_selector[item_option.templateSelector]) {
                    item_option.templates = item_option.templates || {};
                    item_option.templates.selector = product_view_options_selector[item_option.templateSelector];
                }
            });
            _.each(configuration_default_selector_templates, function (default_selector_template) {
                if (product_view_options_selector[default_selector_template.template]) {
                    default_selector_templates[default_selector_template.type] = product_view_options_selector[default_selector_template.template];
                    default_template_selector = true;
                }
            });
            if (default_template_selector) {
                Utils.setPathFromObject(Configuration, 'ItemOptions.defaultTemplates.selectorByType', default_selector_templates);
            }
            _.each(configuration_default_facet_templates, function (default_facet_template) {
                if (product_view_option_facet[default_facet_template.template]) {
                    default_facet_templates[default_facet_template.type] = product_view_option_facet[default_facet_template.template];
                    default_template_facet = true;
                }
            });
            if (default_template_facet) {
                Utils.setPathFromObject(Configuration, 'ItemOptions.defaultTemplates.facetCellByType', default_facet_templates);
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Transaction.Line.Views
define('Transaction.Line.Views', [
    'SC.Configuration',
    'transaction_line_views_selected_option.tpl',
    'transaction_line_views_selected_option_color.tpl',
    'underscore',
    'Utils'
], function (Configuration, transaction_line_views_selected_option_tpl, transaction_line_views_selected_option_color_tpl, _, Utils) {
    'use strict';
    //@class Transaction.Line.Views @extends ApplicationModule
    return {
        //@method mountToApp Initialize the item options configuration related with transaction lines
        //@return {Void}
        mountToApp: function () {
            var transaction_line_view_options_selected = {
                    'transaction_line_views_selected_option.tpl': transaction_line_views_selected_option_tpl,
                    'transaction_line_views_selected_option_color.tpl': transaction_line_views_selected_option_color_tpl
                }, item_options = Configuration.get('ItemOptions.optionsConfiguration', []), configuration_default_selected_templates = Configuration.get('ItemOptions.defaultTemplates.selectedByType', []), default_selected_templates = {}, default_template_selected = false;
            _.each(item_options, function (item_option) {
                if (item_option.templateSelected && transaction_line_view_options_selected[item_option.templateSelected]) {
                    item_option.templates = item_option.templates || {};
                    item_option.templates.selected = transaction_line_view_options_selected[item_option.templateSelected];
                }
            });
            _.each(configuration_default_selected_templates, function (default_selected_template) {
                if (transaction_line_view_options_selected[default_selected_template.template]) {
                    default_selected_templates[default_selected_template.type] = transaction_line_view_options_selected[default_selected_template.template];
                    default_template_selected = true;
                }
            });
            if (default_template_selected) {
                Utils.setPathFromObject(Configuration, 'ItemOptions.defaultTemplates.selectedByType', default_selected_templates);
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Cart
define('Cart.Router', [
    'Cart.Detailed.View',
    'LiveOrder.Model',
    'Utils',
    'jQuery',
    'Backbone'
], function (CartDetailedView, LiveOrderModel, Utils, jQuery, Backbone) {
    'use strict';
    // @class Cart.Router responsible to know render the cart when the user navigates to the cart url @extends Backbone.Router
    return Backbone.Router.extend({
        routes: {
            'cart': 'showCart',
            'cart?*options': 'showCart'
        },
        initialize: function (application) {
            this.application = application;
        }    // @method showCart handles the /cart path by showing the cart view.
,
        showCart: function (options) {
            var self = this, cart = LiveOrderModel.getInstance(), cart_promise = LiveOrderModel.loadCart(), view = new CartDetailedView({
                    model: cart,
                    application: self.application,
                    urlOptions: Utils.parseUrlOptions(options || '')
                });
            cart_promise.done(function () {
                view.showContent();
            });
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Cart
define('ICart.Component', [
    'SC.VisualComponent',
    'Application',
    'underscore'
], function (SCVisualComponent, Application, _) {
    'use strict';
    var ERROR_IDENTIFIERS = SCVisualComponent.ERROR_IDENTIFIERS, format = function format(entity, commonAttrs) {
            var formatted = { extras: {} };
            _.keys(entity).forEach(function (attr) {
                if (_.contains(commonAttrs, attr)) {
                    formatted[attr] = entity[attr];
                } else {
                    formatted.extras[attr] = entity[attr];
                }
            });
            return formatted;
        }    // @class ICart.Component An abstract base class for front-end Cart component. Provides methods for manipulating cart's lines,
             // summary, estimates, promotions, submit. It also expose cancellable events that will be triggered before and after lines,
             // estimates, promotions, etc change.
             // @extends SC.BaseComponent
             // @public @extlayer
, icart_component = _.extend({}, SCVisualComponent, {
            componentName: 'Cart'    // @method addLine Adds a new line into the cart
                      // @public @extlayer
                      // @param {Line} data
                      // @return {Deferred<String>} Return a Deferred that is resolved into the added line id, String, in the case the operation was done successfully.
                      // or the promise is rejected with an error message.
,
            addLine: function addLine(data) {
                //jshint unused:false
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method addLines Adds new lines into the cart
                 // @public @extlayer
                 // @param {Array<Line>} data
                 // @return {Deferred<Array<String>>} Return a Deferred that is resolved into the added lines ids, String, in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            addLines: function addLines(data) {
                //jshint unused:false
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method getLines returns the lines of the cart
                 // @public @extlayer
                 // @return {Deferred<Array<Line>>} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            getLines: function getLines() {
                throw ERROR_IDENTIFIERS.notImplemented;
            }    //@method removeLine Removes a line from the cart
                 //@public @extlayer
                 //@param {String} line_id
                 //@return {Deferred} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            removeLine: function removeLine(data) {
                //jshint unused:false
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method updateLine Updates a line into the cart
                 // @public @extlayer
                 // @param {Line} data
                 // @return {Deferred} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            updateLine: function updateLine(data) {
                //jshint unused:false
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method getSummary Returns the summary of the cart
                 // @public @extlayer
                 // @return {Deferred<Summary>} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            getSummary: function getSummary() {
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method submit Submits the order
                 // @public @extlayer
                 // @return {Deferred<ConfirmationSubmit>} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            submit: function submit() {
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method addPayment Adds a payment method
                 // @public @extlayer
                 // @param {PaymentMethod} data
                 // @return {Deferred} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            addPayment: function addPayment(data) {
                //jshint unused:false
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method getPaymentMethods returns the payment methods added to the order
                 // @public @extlayer
                 // @return {Deferred<Array<PaymentMethod>>} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            getPaymentMethods: function getPaymentMethods() {
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method addPromotion Adds a promotion
                 // @public @extlayer
                 // @param {Promotion} data
                 // @return {Deferred} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            addPromotion: function addPromotion(data) {
                //jshint unused:false
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method removePromotion Removes a promotion
                 // @public @extlayer
                 // @return {Deferred} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            removePromotion: function removePromotion(data) {
                //jshint unused:false
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method getPromotions returns the promotions' codes added to the cart
                 // @public @extlayer
                 // @return {Deferred<Array<Promotion>>} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            getPromotions: function getPromotions() {
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method estimateShipping Returns the estimated shipping costs
                 // @param {Address} data
                 // @public @extlayer
                 // @return {Deferred} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            estimateShipping: function estimateShipping(data) {
                //jshint unused:false
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method removeShipping Removes the shipping method
                 // @public @extlayer
                 // @return {Deferred} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            removeShipping: function removeShipping() {
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method getShipAddress Returns the ship address of the order
                 // @public @extlayer
                 // @return {Deferred<Address>} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            getShipAddress: function getShipAddress() {
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method getBillAddress Returns the bill address of the order
                 // @public @extlayer
                 // @return {Deferred<Address>} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            getBillAddress: function getBillAddress() {
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method setShipAddress Sets the ship address
                 // @param {String} address_id
                 // @public @extlayer
                 // @return {Deferred} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            setShipAddress: function setShipAddress(data) {
                //jshint unused:false
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method setBillAddress Sets the bill address
                 // @param {String} address_id
                 // @public @extlayer
                 // @return {Deferred} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            setBillAddress: function setBillAddress(data) {
                //jshint unused:false
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method getShipMethods Returns the ship methods of the order
                 // @public @extlayer
                 // @return {Deferred<Array<ShipMethod>>} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            getShipMethods: function getShipMethods() {
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method getShipMethod Returns the ship method of the order
                 // @public @extlayer
                 // @return {Deferred<ShipMethod>} Return a Deferred that is resolved in the case the operation was done successfully.
                 // or the promise is rejected with an error message.
,
            getShipMethod: function getShipMethod() {
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method voidLine Voids a line. Implemented only for SCIS
                 // @public @extlayer
,
            voidLine: function voidLine() {
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method unvoidLine Unvoids a line. Implemented only for SCIS
                 // @public @extlayer
,
            unvoidLine: function unvoidLine() {
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method updateCustomer Updates a customer data. Implemented only for SCIS
                 // @public @extlayer
,
            updateCustomer: function updateCustomer() {
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // @method clearEstimateShipping
,
            clearEstimateShipping: function clearEstimateShipping() {
                throw ERROR_IDENTIFIERS.notImplemented;
            }    // updating tell us if the line is going to be used for updateLine
,
            _validateLine: function _validateLine(data, updating) {
                //jshint unused:false
                if (!data || !_.isObject(data.line)) {
                    return this._reportError('INVALID_PARAM', 'Invalid parameter. It must be a valid object and must contain a line object');
                }    //TODO call _reportError (code, description) when an invalid line is passed
            },
            _validateLines: function _validateLines(data) {
                if (!data || !_.isArray(data.lines)) {
                    return this._reportError('INVALID_PARAM', 'Invalid parameter. It must be a valid object and must contain a lines array');
                }
                var self = this;
                _.map(data.lines, function (line) {
                    self._validateLine({ line: line });
                });
            },
            _validateLineId: function _validateLineId(data) {
                if (!data || !_.isString(data.line_id)) {
                    return this._reportError('INVALID_PARAM', 'Invalid parameter. It must be a valid object and must contain a line_id string');
                }
            }    // @method _normalizeLines formats each line grouping both commons attributes (SCIS and SCA) and non-commons.
                 // The last into a extras named object.
                 // @private
                 // @param {Array<Line>} lines
,
            _normalizeLines: function _normalizeLines(src_lines) {
                var lines = _.deepCopy(src_lines);
                return _.map(lines, this._normalizeLine);
            }    // @method _normalizeLine formats the line grouping both commons attributes (SCIS and SCA) and non-commons.
                 // The last into a extras named object.
                 // @private
                 // @param {Line} line
,
            _normalizeLine: function _normalizeLine(src_line) {
                var line = _.deepCopy(src_line), commonLineAttrs = [
                        'internalid',
                        'item',
                        'quantity',
                        'amount',
                        'rate',
                        'tax_amount',
                        'tax_code',
                        'itemtype',
                        'options'
                    ], commonItemAttrs = [
                        'internalid',
                        'itemid',
                        'displayname',
                        'isinactive',
                        'itemtype',
                        'minimumquantity'
                    ];
                var formatted_line = format(line, commonLineAttrs);
                line.item.itemtype = line.item.itemtype || line.item.type;
                formatted_line.item = format(line.item, commonItemAttrs);
                return formatted_line;
            },
            _normalizeAddLineBefore: function _normalizeAddLineBefore(line) {
                return { line: this._normalizeLine(line) };
            },
            _normalizeAddLineAfter: function _normalizeAddLineAfter(new_line, line) {
                return {
                    result: new_line,
                    line: this._normalizeLine(line)
                };
            },
            _normalizeUpdateLineBefore: function _normalizeUpdateLineBefore(line) {
                return { line: this._normalizeLine(line) };
            },
            _normalizeUpdateLineAfter: function _normalizeUpdateLineAfter(line) {
                return { line: this._normalizeLine(line) };
            },
            _normalizeRemoveLineBefore: function _normalizeUpdateLineBefore(line) {
                return { line_id: this._normalizeLine(line).internalid };
            },
            _normalizeRemoveLineAfter: function _normalizeUpdateLineBefore(line) {
                return { line_id: this._normalizeLine(line).internalid };
            },
            _normalizeSummary: function _normalizeSummary(inner_summary) {
                var summary = _.deepCopy(inner_summary), commonSummaryAttrs = [
                        'total',
                        'taxtotal',
                        'tax2total',
                        'discounttotal',
                        'subtotal',
                        'shippingcost',
                        'handlingcost',
                        'giftcertapplied',
                        'estimatedshipping'
                    ];
                return format(summary, commonSummaryAttrs);
            },
            _normalizeAddress: function _normalizeAddress(inner_address) {
                var address = _.deepCopy(inner_address), commonAddressAttrs = [
                        'internalid',
                        'zip',
                        'country',
                        'addr1',
                        'addr2',
                        'addr3',
                        'city',
                        'company',
                        'defaultbilling',
                        'defaultshipping',
                        'fullname',
                        'isresidential',
                        'isvalid',
                        'phone',
                        'state'
                    ];
                return format(address, commonAddressAttrs);
            },
            _normalizeEstimateBefore: function _normalizeEstimateBefore(address) {
                return { address: this._normalizeAddress(address) };
            },
            _normalizeEstimateAfter: function _normalizeEstimateAfter(order) {
                var address = _.find(order.addresses, function (address) {
                    return address && address.internalid && address.internalid === order.shipaddress;
                });
                return {
                    result: this._normalizeSummary(order.summary),
                    address: this._normalizeAddress(address)
                };
            },
            _normalizeClearEstimateShippingBefore: function _normalizeClearEstimateShippingBefore() {
                return {};
            },
            _normalizeClearEstimateShippingAfter: function _normalizeClearEstimateShippingAfter(order) {
                return this._normalizeEstimateAfter(order);
            },
            _normalizePromocode: function _normalizePromocode(promocode) {
                var promotion = _.deepCopy(promocode), commonPromotionAttrs = [
                        'internalid',
                        'type',
                        'name',
                        'rate',
                        'code',
                        'errormsg',
                        'isvalid'
                    ];
                return format(promotion, commonPromotionAttrs);
            },
            _normalizeShipMethod: function _normalizeShipMethod(inner_ship_method) {
                var ship_method = _.deepCopy(inner_ship_method), commonShipMethodAttrs = [
                        'internalid',
                        'name',
                        'rate',
                        'rate_formatted',
                        'shipcarrier'
                    ];
                return format(ship_method, commonShipMethodAttrs);
            },
            _normalizeConfirmation: function _normalizeConfirmation(inner_confirmation) {
                var confirmation = _.deepCopy(inner_confirmation), commonConfirmationAttrs = [
                        'internalid',
                        'confirmationnumber',
                        'lines',
                        'paymentmethods',
                        'promocodes',
                        'reasoncode',
                        'statuscode',
                        'summary',
                        'tranid'
                    ];
                confirmation.lines = this._normalizeLines(confirmation.lines || []);
                confirmation.paymentmethods = _.map(confirmation.paymentmethods || [], this._normalizePaymentMethod);
                confirmation.promocodes = _.map(confirmation.promocodes || [], this._normalizePromocode);
                confirmation.summary = this._normalizeSummary(confirmation.summary);
                return { confirmation: format(confirmation, commonConfirmationAttrs) };
            },
            _normalizePaymentMethod: function _normalizePaymentMethod(inner_payment_method) {
                if (_.isUndefined(inner_payment_method)) {
                    return {};
                }
                var payment_method = _.deepCopy(inner_payment_method);
                var commonPaymentMethodAttrs = [
                        'internalid',
                        'type',
                        'creditcard',
                        'key',
                        'thankyouurl',
                        'errorurl',
                        'giftcertificate'
                    ], commonCreditCardAttrs = [
                        'ccnumber',
                        'ccname',
                        'ccexpiredate',
                        'expmonth',
                        'expyear',
                        'ccsecuritycode',
                        'paymentmethod'
                    ], commonCreditCardPaymentAttrs = [
                        'internalid',
                        'name',
                        'creditcard',
                        'ispaypal',
                        'key'
                    ], commonGiftCertificateAttrs = [
                        'internalid',
                        'name',
                        'creditcard',
                        'ispaypal',
                        'key'
                    ];
                var formatted_payment_method = format(payment_method, commonPaymentMethodAttrs);
                if (payment_method.creditcard) {
                    formatted_payment_method.creditcard = format(payment_method.creditcard, commonCreditCardAttrs);
                    if (payment_method.creditcard.paymentmethod) {
                        formatted_payment_method.creditcard.paymentmethod = format(payment_method.creditcard.paymentmethod, commonCreditCardPaymentAttrs);
                    }
                }
                if (payment_method.giftcertificate) {
                    formatted_payment_method.giftcertificate = format(payment_method.giftcertificate, commonGiftCertificateAttrs);
                }
                return { payment_method: formatted_payment_method };
            }
        });
    return icart_component;
});    // jsdoc description for data:
       // @class ConfirmationSubmit
       // @property {String} internalid
       // @property {String} confirmationnumber
       // @property {Array<Line>} lines
       // @property {Array<PaymentMethod>} paymentmethods
       // @property {Array<Promotion>} promocodes
       // @property {String} reasoncode
       // @property {String} statuscode
       // @property {Summary} summary
       // @property {String} tranid
       // @class ShipMethod
       // @property {String} internalid
       // @property {String} name
       // @property {Number} rate
       // @property {String} rate_formatted
       // @property {String} shipcarrier
       // @class Address
       // @property {String} internalid
       // @property {String} zip
       // @property {String} country
       // @property {String} addr1
       // @property {String} addr2
       // @property {String} addr3
       // @property {String} city
       // @property {String} company
       // @property {Boolean} defaultbilling
       // @property {Boolean} defaultshipping
       // @property {String} fullname
       // @property {Boolean} isresidential
       // @property {Boolean} isvalid
       // @property {String} phone
       // @property {String} state
       // @class PaymentMethod
       // @property {String} internalid
       // @property {String} type [creditcard, invoice, paypal, giftcertificate, external_checkout]
       // @property {CreditCard} creditcard Required only if it is a creditcard
       // @property {String} key
       // @property {String} thankyouurl
       // @property {String} errorurl
       // @property {GiftCertificate} giftcertificate Required only if it is a giftcertificate
       // @class CreditCard
       // @property {String} ccnumber
       // @property {String} ccname
       // @property {String} ccexpiredate
       // @property {String} expmonth
       // @property {String} expyear
       // @property {String} ccsecuritycode
       // @property {InnerPaymentMethod} paymentmethod
       // @class InnerPaymentMethod
       // @property {String} internalid
       // @property {String} name
       // @property {Boolean} creditcard
       // @property {Boolean} ispaypal
       // @property {String} key
       // @class GiftCertificate
       // @property {String} code
       // @class Promotion
       // @property {String} internalid
       // @property {String} type
       // @property {String} name
       // @property {String} rate
       // @property {String} code
       // @property {String} errormsg
       // @property {Boolean} isvalid
       // @class Line
       // @property {String} internalid
       // @property {Number} quantity
       // @property {Number} amount
       // @property {Number} rate
       // @property {Number} tax_amount
       // @property {String} tax_code
       // @property {String} itemtype
       // @property {Line.Extras} extras
       // @property {Line.Item} item
       // @property {Array<Line.Option>} options
       // @class Line.Extras
       // @property {String} shipaddress SCA specific
       // @property {String} shipmethod SCA specific
       // @property {Number} tax_rate SCA specific
       // @property {String} rate_formatted SCA specific
       // @property {Number} discount SCA specific
       // @property {number} total SCA specific
       // @property {String} amount_formatted SCA specific
       // @property {String} tax_amount_formatted SCA specific
       // @property {String} discount_formatted SCA specific
       // @property {String} total_formatted SCA specific
       // @property {String} description SCIS specific
       // @property {String} giftcertfrom SCIS specific
       // @property {String} giftcertmessage SCIS specific
       // @property {Number} giftcertnumber SCIS specific
       // @property {String} giftcertrecipientemail SCIS specific
       // @property {String} giftcertrecipientname SCIS specific
       // @property {String} taxrate1 SCIS specific
       // @property {String} taxrate2 SCIS specific
       // @property {String} grossamt SCIS specific
       // @property {String} tax1amt SCIS specific
       // @property {String} custreferralcode SCIS specific
       // @property {Boolean} excludefromraterequest SCIS specific
       // @property {String} custcol_ns_pos_voidqty SCIS specific
       // @property {Number} voidPercentage SCIS specific
       // @property {Number} returnedQuantity SCIS specific
       // @property {Boolean} isUnvalidatedReturn SCIS specific
       // @property {Boolean} order SCIS specific
       // @property {String} note SCIS specific
       // @class Line.Option
       // @property {String} cartOptionId
       // @property {internalid:String} value
       // @class Line.Item
       // @property {Number} internalid
       // @property {String} itemid
       // @property {String} displayname
       // @property {Boolean} isinactive
       // @property {String} itemtype
       // @property {Number} minimumquantity
       // @property {Line.Item.Extras} extras
       // @class Line.Item.Extras
       // @property {Boolean} isinstock SCA specific
       // @property {Boolean} isonline SCA specific
       // @property {Object} matrixchilditems_detail SCA specific
       // @property {Boolean} ispurchasable SCA specific
       // @property {String} stockdescription SCA specific
       // @property {Boolean} isfulfillable SCA specific
       // @property {Boolean} isbackorderable SCA specific
       // @property {Boolean} showoutofstockmessage SCA specific
       // @property {String} outofstockmessage SCA specific
       // @property {String} storedisplayname2 SCA specific
       // @property {Number} pricelevel1 SCA specific
       // @property {String} pricelevel1_formatted SCA specific
       // @property {String} urlcomponent SCA specific
       // @property {Object} itemimages_detail SCA specific
       // @property {Object} onlinecustomerprice_detail SCA specific
       // @property {Object} itemoptions_detail SCA specific
       // @property {String} type SCIS specific
       // @property {String} baseprice SCIS specific
       // @property {String} matrix_parent SCIS specific
       // @property {String} upccode SCIS specific
       // @property {String} additional_upcs SCIS specific
       // @property {Boolean} isdonationitem SCIS specific
       // @property {Boolean} custitem_ns_pos_physical_item SCIS specific
       // @class Summary
       // @property {Number} total
       // @property {Number} taxtotal
       // @property {Number} tax2total
       // @property {Number} discounttotal
       // @property {Number} subtotal
       // @property {Number} shippingcost
       // @property {Number} handlingcost
       // @property {Number} giftcertapplied
       // @property {Number} estimatedshipping SCA specific
       // @property {Summary.Extras} extras
       // @class Summary.Extras
       // @property {String} discounttotal_formatted SCA specific
       // @property {String} taxonshipping_formatted SCA specific
       // @property {String} taxondiscount_formatted SCA specific
       // @property {Number} itemcount SCA specific
       // @property {String} taxonhandling_formatted SCA specific
       // @property {Number} discountedsubtotal SCA specific
       // @property {String} discountedsubtotal_formatted SCA specific
       // @property {Number} taxondiscount SCA specific
       // @property {String} handlingcost_formatted SCA specific
       // @property {Number} taxonshipping SCA specific
       // @property {String} taxtotal_formatted SCA specific
       // @property {String} totalcombinedtaxes_formatted SCA specific
       // @property {Number} totalcombinedtaxes SCA specific
       // @property {String} giftcertapplied_formatted SCA specific
       // @property {String} shippingcost_formatted SCA specific
       // @property {Number} discountrate SCA specific
       // @property {Number} taxonhandling SCA specific
       // @property {String} tax2total_formatted SCA specific
       // @property {String} discountrate_formatted SCA specific
       // @property {String} estimatedshipping_formatted SCA specific
       // @property {String} total_formatted SCA specific
       // @property {String} subtotal_formatted SCA specific
       // @property {String} shippingtax1rate SCIS specific
       // @property {Boolean} shippingcostoverridden SCIS specific
       // @property {Number} amountdue SCIS specific
       // @property {String} tranid SCIS specific
       // @property {Date} createddate SCIS specific
       // @property {String} couponcode SCIS specific
       // @property {Date} createdfrom SCIS specific
       // @property {Number} changedue SCIS specific

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Cart
define('Cart.Component', [
    'ICart.Component',
    'LiveOrder.Model',
    'LiveOrder.Line.Model',
    'Transaction.Paymentmethod.Model',
    'Utils',
    'Backbone',
    'jQuery',
    'underscore'
], function (ICartComponent, LiveOrderModel, LiveOrderLineModel, TransactionPaymentmethodModel, Utils, Backbone, jQuery, _) {
    'use strict';
    var live_order_model = LiveOrderModel.getInstance();
    return function CartComponentGenerator(application) {
        // @class Cart.Component This is the concrete front-end Cart implementation of SuiteCommerce Advanced / SuiteCommerce Standard.
        // See @?class ICart.Component
        // @extends ICart.Component
        // @public @extlayer
        var api_methods = {
            application: application    // @method _isViewFromComponent Indicate if the passed-in the View is a PDP of the current component
                           // @private
                           // @param {Backbone.View} view Any view of the system
                           // @return {Boolean} True in case the passed in View is a PDP of the current Component, false otherwise
,
            _isViewFromComponent: function _isViewFromComponent(view) {
                var view_identifier = this._getViewIdentifier(view), view_prototype_id = view && this._getViewIdentifier(view.prototype);
                return view && (view_identifier === this.CART_VIEW || view_identifier === this.CART_MINI_VIEW || view_prototype_id === this.CART_VIEW || view_prototype_id === this.CART_MINI_VIEW);
            }    // @method _getViewIdentifier Given a view that belongs to the current component, returns the "type"/"kind" of view.
                 // This is used to determine what view among all the view of the current component is being shown
                 // @private
                 // @param {Backbone.View} view
                 // @return {String}
,
            _getViewIdentifier: function _getViewIdentifier(view) {
                return view && view.attributes && view.attributes.id;
            },
            DEFAULT_VIEW: 'Cart.Detailed.View',
            CART_VIEW: 'Cart.Detailed.View',
            CART_MINI_VIEW: 'Header.MiniCart.View',
            estimateShipping: function estimateShipping(data) {
                try {
                    if (!data || !data.address || !_.isObject(data.address)) {
                        return this._reportError('INVALID_PARAM', 'Invalid parameter "address". It must be a valid string');
                    }
                    var self = this;
                    return live_order_model.cancelableTrigger('before:LiveOrder.estimateShipping', data.address).then(function () {
                        var address = data.address, address_internalid = address.zip + '-' + address.country + '-null';
                        live_order_model.get('addresses').push({
                            internalid: address_internalid,
                            zip: address.zip,
                            country: address.country
                        });
                        live_order_model.set('shipaddress', address_internalid);
                        return live_order_model.save().pipe(function (result) {
                            live_order_model.cancelableTrigger('after:LiveOrder.estimateShipping', result);
                            return self._normalizeEstimateAfter(result);
                        }).fail(function (error) {
                            return error;
                        });
                    });
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            },
            clearEstimateShipping: function clearEstimateShipping() {
                try {
                    var self = this;
                    return live_order_model.cancelableTrigger('before:LiveOrder.clearEstimateShipping').then(function () {
                        return live_order_model.save({
                            shipmethod: null,
                            shipaddress: null
                        }).pipe(function (result) {
                            live_order_model.cancelableTrigger('after:LiveOrder.clearEstimateShipping', result);
                            return self._normalizeEstimateAfter(result);
                        }).fail(function (error) {
                            return error;
                        });
                    });
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            },
            getShipMethods: function getShipMethods() {
                try {
                    var shipmethods = live_order_model.get('shipmethods').toJSON();
                    return jQuery.Deferred().resolve(_.map(shipmethods, this._normalizeShipMethod));
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            },
            getShipMethod: function getShipMethod() {
                try {
                    var shipmethod_id = live_order_model.get('shipmethod'), shipmethods = live_order_model.get('shipmethods').toJSON();
                    var shipmethod = _.find(shipmethods, function (shipmethod) {
                        return shipmethod && shipmethod.internalid && shipmethod.internalid === shipmethod_id;
                    });
                    return jQuery.Deferred().resolve(this._normalizeShipMethod(shipmethod));
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            },
            _setAddress: function _setAddress(data) {
                var self = this, deferred = jQuery.Deferred();
                this.serialize = this.serialize || jQuery.Deferred().resolve();
                this.serialize = this.serialize.pipe(function () {
                    var my_promise = jQuery.Deferred();
                    try {
                        if (!Utils.isCheckoutDomain()) {
                            self._reportError('UNSECURE_SESSION', 'Unsecure session: Must be under a secure domain or logged in');
                        }
                        if (!_.isObject(data) || !_.isString(data.address_type)) {
                            self._reportError('INVALID_PARAM', 'Invalid parameter "address_type". It must be a valid string');
                        }
                        if (data.address_id && !_.isString(data.address_id)) {
                            self._reportError('INVALID_PARAM', 'Invalid parameter "address_id". It must be either a valid string or null');
                        }
                        live_order_model.setAddress(data.address_type, data.address_id, null, true).done(deferred.resolve).fail(deferred.reject).always(my_promise.resolve);
                    } catch (error) {
                        deferred.reject(error);
                        my_promise.resolve();
                    }
                    return my_promise;
                });
                return deferred;
            },
            setShipAddress: function setShipAddress(data) {
                data.address_type = 'shipaddress';
                return this._setAddress(data);
            },
            setBillAddress: function setBillAddress(data) {
                data.address_type = 'billaddress';
                return this._setAddress(data);
            },
            getShipAddress: function getShipAddress() {
                try {
                    var shipaddress = live_order_model.get('shipaddress'), addresses = live_order_model.get('addresses').toJSON();
                    var address = _.find(addresses, function (address) {
                        return address && address.internalid && address.internalid === shipaddress;
                    });
                    return jQuery.Deferred().resolve(this._normalizeAddress(address));
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            },
            getBillAddress: function getBillAddress() {
                try {
                    var billaddress = live_order_model.get('billaddress'), addresses = live_order_model.get('addresses').toJSON();
                    var address = _.find(addresses, function (address) {
                        return address && address.internalid && address.internalid === billaddress;
                    });
                    return jQuery.Deferred().resolve(this._normalizeAddress(address));
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            },
            addLine: function addLine(data) {
                try {
                    this._validateLine(data);
                    var self = this, deferred = jQuery.Deferred();
                    this.serialize = this.serialize || jQuery.Deferred().resolve();
                    this.serialize = this.serialize.pipe(function () {
                        var my_promise = jQuery.Deferred();
                        try {
                            var line = self._createInnerLine(data.line);
                            live_order_model.addLine(line).done(function (result) {
                                deferred.resolve(result.latest_addition);
                            }).fail(function (error) {
                                deferred.reject(error);
                            }).always(my_promise.resolve);
                        } catch (error) {
                            deferred.reject(error);
                            my_promise.resolve();
                        }
                        return my_promise;
                    });
                    return deferred;
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            },
            addLines: function addLines(data) {
                try {
                    this._validateLines(data);
                    var self = this, deferred = jQuery.Deferred();
                    this.serialize = this.serialize || jQuery.Deferred().resolve();
                    this.serialize = this.serialize.pipe(function () {
                        var my_promise = jQuery.Deferred();
                        try {
                            var lines = _.map(data.lines, self._createInnerLine), old_lines_ids = _.pluck(live_order_model.get('lines').toJSON(), 'internalid');
                            live_order_model.addLines(lines).done(function (result) {
                                var current_lines_ids = _.pluck(result.lines, 'internalid');
                                result = _.difference(current_lines_ids, old_lines_ids);
                                result = _.isEmpty(result) ? current_lines_ids : result;
                                deferred.resolve(result);
                            }).fail(function (error) {
                                deferred.reject(error);
                            }).always(my_promise.resolve);
                        } catch (error) {
                            deferred.reject(error);
                            my_promise.resolve();
                        }
                        return my_promise;
                    });
                    return deferred;
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            },
            getLines: function getLines() {
                var deferred = jQuery.Deferred();
                try {
                    var lines = this._normalizeLines(live_order_model.get('lines') || []);
                    return deferred.resolve(lines);
                } catch (error) {
                    return deferred.reject(error);
                }
            },
            removeLine: function removeLine(data) {
                try {
                    this._validateLineId(data);
                    var self = this, deferred = jQuery.Deferred();
                    this.serialize = this.serialize || jQuery.Deferred().resolve();
                    this.serialize = this.serialize.pipe(function () {
                        var my_promise = jQuery.Deferred();
                        try {
                            var line = self._findLine(data.line_id);
                            live_order_model.removeLine(line).done(function () {
                                deferred.resolve();
                            }).fail(function (error) {
                                deferred.reject(error);
                            }).always(my_promise.resolve);
                        } catch (error) {
                            deferred.reject(error);
                            my_promise.resolve();
                        }
                        return my_promise;
                    });
                    return deferred;
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            },
            updateLine: function updateLine(data) {
                try {
                    this._validateLine(data, true);
                    var self = this, deferred = jQuery.Deferred();
                    this.serialize = this.serialize || jQuery.Deferred().resolve();
                    this.serialize = this.serialize.pipe(function () {
                        var my_promise = jQuery.Deferred();
                        try {
                            var line = self._findLine(data.line.internalid);
                            //Merge line with data.line
                            self._mergeLine(line, data.line);
                            live_order_model.updateLine(line).done(function () {
                                deferred.resolve();
                            }).fail(function (error) {
                                deferred.reject(error);
                            }).always(my_promise.resolve);
                        } catch (error) {
                            deferred.reject(error);
                            my_promise.resolve();
                        }
                        return my_promise;
                    });
                    return deferred;
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            },
            getSummary: function getSummary() {
                try {
                    var summary = live_order_model.get('summary');
                    summary = this._normalizeSummary(summary);
                    return jQuery.Deferred().resolve(summary);
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            },
            submit: function submit() {
                var self = this, deferred = jQuery.Deferred();
                this.serialize = this.serialize || jQuery.Deferred().resolve();
                this.serialize = this.serialize.pipe(function () {
                    var my_promise = jQuery.Deferred();
                    try {
                        if (!Utils.isCheckoutDomain()) {
                            self._reportError('UNSECURE_SESSION', 'Unsecure session: Must be under a secure domain or logged in');
                        }
                        live_order_model.submit().done(function (order) {
                            deferred.resolve(self._normalizeConfirmation(order.confirmation));
                        }).fail(deferred.reject).always(my_promise.resolve);
                    } catch (error) {
                        deferred.reject(error);
                        my_promise.resolve();
                    }
                    return my_promise;
                });
                return deferred;
            },
            addPayment: function addPayment(data) {
                var self = this, deferred = jQuery.Deferred();
                this.serialize = this.serialize || jQuery.Deferred().resolve();
                this.serialize = this.serialize.pipe(function () {
                    var my_promise = jQuery.Deferred();
                    try {
                        if (!Utils.isCheckoutDomain()) {
                            self._reportError('UNSECURE_SESSION', 'Unsecure session: Must be under a secure domain or logged in');
                        }
                        if (!data || !_.isObject(data.payment_method)) {
                            self._reportError('INVALID_PARAM', 'Invalid parameter "payment_method". It must be a valid object');
                        }
                        var payment_method = self._createInnerPayment(data.payment_method);
                        live_order_model.addPayment(payment_method, true).done(function (result) {
                            deferred.resolve(result);
                        }).fail(deferred.reject).always(my_promise.resolve);
                    } catch (error) {
                        deferred.reject(error);
                        my_promise.resolve();
                    }
                    return my_promise;
                });
                return deferred;
            },
            getPaymentMethods: function getPaymentMethods() {
                try {
                    var self = this, payment_methods = live_order_model.get('paymentmethods').toJSON();
                    return jQuery.Deferred().resolve(_.map(payment_methods, function (payment) {
                        return self._normalizePaymentMethod(payment).payment_method;
                    }));
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            },
            addPromotion: function addPromotion(data) {
                try {
                    if (!data || !_.isString(data.promocode)) {
                        this._reportError('INVALID_PARAM', 'Invalid parameter "promocode". It must be a valid string');
                    }
                    var self = this;
                    return live_order_model.addPromotion(data.promocode).pipe(function (promocode) {
                        return { promotion: self._normalizePromocode(promocode) };
                    });
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            },
            removePromotion: function removePromotion(data) {
                try {
                    if (!data || !_.isString(data.promocode_internalid)) {
                        this._reportError('INVALID_PARAM', 'Invalid parameter "promocode_internalid". It must be a valid string');
                    }
                    return live_order_model.removePromotion(data.promocode_internalid);
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            },
            getPromotions: function getPromotions() {
                try {
                    var promocodes = live_order_model.get('promocodes');
                    promocodes = _.map(promocodes, this._normalizePromocode);
                    return jQuery.Deferred().resolve(promocodes);
                } catch (error) {
                    return jQuery.Deferred().reject(error);
                }
            },
            _createInnerPayment: function _createInnerPayment(payment_method) {
                var inner_payment = new TransactionPaymentmethodModel(payment_method);
                return inner_payment;
            },
            _findLine: function _findLine(internal_id) {
                var line = live_order_model.get('lines').find(function (cart_line) {
                    return cart_line.get('internalid') === internal_id;
                });
                !line && this._reportError('INVALID ID', 'Line ' + internal_id + ' not found');
                return line;
            },
            _mergeLine: function _mergeLine(inner_line, line) {
                var self = this;
                _.each(line, function (value, index) {
                    if (index === 'extras') {
                        self._mergeLine(inner_line, value);
                    } else if (_.contains(inner_line.keys(), index)) {
                        if (inner_line.get(index) instanceof Backbone.Model) {
                            self._mergeLine(inner_line.get(index), value);
                        } else if (inner_line.get(index) instanceof Backbone.Collection) {
                            inner_line.set(index, new Backbone.Collection(value));
                        } else {
                            inner_line.set(index, value);
                        }
                    }
                });
            },
            _createInnerLine: function _createInnerLine(line) {
                return LiveOrderLineModel.createFromOuterLine(line);
            }
        };
        //Wrap public methods to load the cart before its execution
        _.each(api_methods, function (api_method, name) {
            if (name.indexOf('_') !== 0 && _.isFunction(api_method)) {
                api_methods[name] = _.wrap(api_method, function (fn) {
                    var self = this, args = _.toArray(arguments).slice(1);
                    return LiveOrderModel.loadCart().pipe(function () {
                        try {
                            return fn.apply(self, args);
                        } catch (error) {
                            return jQuery.Deferred().reject(error);
                        }
                    });
                });
            }
        });
        //@class Cart.Component @extend ICart.Component
        var cart_component = ICartComponent.extend(api_methods);
        var innerToOuterMap = [
            // @class ICart.Component
            // @event beforeUpdateLine Cancelable event triggered before a cart's line is updated @public @extlayer
            {
                inner: 'before:LiveOrder.updateLine',
                outer: 'beforeUpdateLine',
                normalize: cart_component._normalizeUpdateLineBefore
            }    // @event afterUpdateLine Triggered after a cart's line is updated @public @extlayer
,
            {
                inner: 'after:LiveOrder.updateLine',
                outer: 'afterUpdateLine',
                normalize: cart_component._normalizeUpdateLineAfter
            }    // @event beforeRemoveLine Cancelable event triggered before a cart's line is removed @public @extlayer
,
            {
                inner: 'before:LiveOrder.removeLine',
                outer: 'beforeRemoveLine',
                normalize: cart_component._normalizeRemoveLineBefore
            }    // @event afterRemoveLine Triggered after a cart's line is removed @public @extlayer
,
            {
                inner: 'after:LiveOrder.removeLine',
                outer: 'afterRemoveLine',
                normalize: cart_component._normalizeRemoveLineAfter
            }    // @event beforeEstimateShipping Cancelable event triggered before doing an estimate shipping in the cart @public @extlayer
,
            {
                inner: 'before:LiveOrder.estimateShipping',
                outer: 'beforeEstimateShipping',
                normalize: cart_component._normalizeEstimateBefore
            }    // @event afterEstimateShipping Triggered after an estimate shipping is done in the cart @public @extlayer
,
            {
                inner: 'after:LiveOrder.estimateShipping',
                outer: 'afterEstimateShipping',
                normalize: cart_component._normalizeEstimateAfter
            }    // @event beforeClearEstimateShipping Cancelable event triggered before clearing an estimate shipping in the cart @public @extlayer
,
            {
                inner: 'before:LiveOrder.clearEstimateShipping',
                outer: 'beforeClearEstimateShipping',
                normalize: cart_component._normalizeClearEstimateShippingBefore
            }    // @event afterClearEstimateShipping Triggered after an estimate shipping is cleared in the cart @public @extlayer
,
            {
                inner: 'after:LiveOrder.clearEstimateShipping',
                outer: 'afterClearEstimateShipping',
                normalize: cart_component._normalizeClearEstimateShippingAfter
            }    // @event beforeAddPromotion Triggered before a promotion is added to the cart @public @extlayer
,
            {
                inner: 'before:LiveOrder.addPromotion',
                outer: 'beforeAddPromotion',
                normalize: cart_component._normalizePromocode
            }    // @event afterAddPromotion Triggered after a promotion is added to the cart @public @extlayer
,
            {
                inner: 'after:LiveOrder.addPromotion',
                outer: 'afterAddPromotion',
                normalize: cart_component._normalizePromocode
            }    // @event beforeRemovePromotion Triggered before a promocode is removed from the cart @public @extlayer
,
            {
                inner: 'before:LiveOrder.removePromotion',
                outer: 'beforeRemovePromotion',
                normalize: cart_component._normalizePromocode
            }    // @event afterRemovePromotion Triggered after a promocode is removed from the cart @public @extlayer
,
            {
                inner: 'after:LiveOrder.removePromotion',
                outer: 'afterRemovePromotion',
                normalize: cart_component._normalizePromocode
            }    // @event beforeAddPayment Triggered before a payment method is added to the order @public @extlayer
,
            {
                inner: 'before:LiveOrder.addPayment',
                outer: 'beforeAddPayment',
                normalize: cart_component._normalizePaymentMethod
            }    // @event afterAddPayment Triggered after a payment method is added to the order @public @extlayer
,
            {
                inner: 'after:LiveOrder.addPayment',
                outer: 'afterAddPayment',
                normalize: cart_component._normalizePaymentMethod
            }    // @event beforeSubmit Triggered before the order is submited @public @extlayer
,
            {
                inner: 'before:LiveOrder.submit',
                outer: 'beforeSubmit',
                normalize: null
            }    // @event afterSubmit Triggered after the order is submited @public @extlayer
,
            {
                inner: 'after:LiveOrder.submit',
                outer: 'afterSubmit',
                normalize: cart_component._normalizeConfirmation
            }
        ];
        cart_component._suscribeToInnerEvents(innerToOuterMap, live_order_model);
        live_order_model.cancelableOn('before:LiveOrder.setAddress', function (address) {
            var outer_events = {
                    shipaddress: 'beforeSetShipAddress',
                    billaddress: 'beforeSetBillAddress'
                }, outer_event = outer_events[address.type];
            return cart_component.cancelableTrigger(outer_event, address.id);
        });
        live_order_model.cancelableOn('after:LiveOrder.setAddress', function (address) {
            var outer_events = {
                    shipaddress: 'afterSetShipAddress',
                    billaddress: 'afterSetBillAddress'
                }, outer_event = outer_events[address.type];
            return cart_component.cancelableTrigger(outer_event, address.id);
        });
        live_order_model.cancelableOn('before:LiveOrder.addLines', function (lines) {
            var lines_deferred = _.map(lines, function (line) {
                var args = cart_component._normalizeAddLineBefore(line);
                // @event beforeAddLine Cancelable event triggered before adding a new cart's line @public @extlayer
                return cart_component.cancelableTrigger('beforeAddLine', args);
            });
            return jQuery.when.apply(jQuery, lines_deferred);
        });
        live_order_model.cancelableOn('after:LiveOrder.addLines', function (old_lines, current_lines) {
            var old_lines_ids = cart_component._normalizeLines(old_lines), current_lines_ids = cart_component._normalizeLines(current_lines), new_lines = _.difference(current_lines_ids, old_lines_ids);
            new_lines = _.isEmpty(new_lines) ? current_lines_ids : new_lines;
            var lines_deferred = _.map(new_lines, function (line) {
                var args = cart_component._normalizeAddLineAfter(line.internalid, line);
                // @event afterAddLine Triggered after a new line is added in the cart @public @extlayer
                return cart_component.cancelableTrigger('afterAddLine', args);
            });
            return jQuery.when.apply(jQuery, lines_deferred);
        });
        // @class Cart.Component
        return cart_component;
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Cart
define('Cart', [
    'LiveOrder.Model',
    'Cart.Router',
    'SC.Configuration',
    'Cart.Confirmation.Helpers',
    'Cart.Component',
    'jQuery'
], function (LiveOrderModel, CartRouter, Configuration, CartConfirmationHelpers, CartComponent, jQuery) {
    'use strict';
    /*
		@class Cart

		Defines the Cart module

		mountToApp() handles some environment issues

		@extends ApplicationModule
	*/
    return {
        mountToApp: function mountToApp(application) {
            this.cart_model = LiveOrderModel.getInstance();
            // Check if cart was bootstrapped
            if (!SC.ENVIRONMENT.CART_BOOTSTRAPED) {
                // Load the cart information
                LiveOrderModel.loadCart();
            } else if (SC.ENVIRONMENT.CART) {
                this.cart_model.set(SC.ENVIRONMENT.CART);
                this.cart_model.cartLoad = this.cart_model.cartLoad || jQuery.Deferred();
                this.cart_model.isLoading = false;
                this.cart_model.cartLoad.resolveWith(SC.ENVIRONMENT.CART);
            }
            var self = this;
            //IMPORTANT: This api/method is preserve ONLY for Bronto Integration. IT IS NOT A PUBLIC API!
            application.getCart = function getCart() {
                console.warn('Using application.getCart is deprecated!');
                var cart_promise = jQuery.Deferred();
                LiveOrderModel.loadCart().done(function () {
                    cart_promise.resolve(self.cart_model);
                }).fail(function () {
                    cart_promise.reject.apply(this, arguments);
                });
                return cart_promise;
            };
            application.getLayout().goToCart = function () {
                return CartConfirmationHelpers._goToCart(this.application.getCart());
            };
            application.getLayout().showMiniCart = function () {
                return CartConfirmationHelpers._showMiniCart(this.application.getCart(), null, this.application);
            };
            application.getLayout().showCartConfirmationModal = function () {
                return CartConfirmationHelpers._showCartConfirmationModal(this.application.getCart(), null, this.application);
            };
            // Initializes the router
            if (Configuration.get('modulesConfig.Cart.startRouter', true)) {
                new CartRouter(application);
            }
            return CartComponent(application);
        }
    };
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Account
define('Account.Login.Model', [
    'Backbone',
    'underscore',
    'Utils'
], function (Backbone, _, Utils) {
    'use strict';
    //@class Account.Login.Model
    // Sends user input data to the login service
    // validating email and password before they are sent
    // [Backbone.validation](https://github.com/thedersen/backbone.validation)
    // @extend Backbone.Model
    return Backbone.Model.extend({
        //@property {String} urlRoot
        urlRoot: function () {
            return Utils.getAbsoluteUrl('services/Account.Login.Service.ss') + '?n=' + SC.ENVIRONMENT.siteSettings.siteid;
        }    //@property validation. Backbone.Validation attribute used for validating the form before submit.
,
        validation: {
            email: {
                required: true,
                pattern: 'email',
                msg: _('Valid Email is required').translate()
            },
            password: {
                required: true,
                msg: _('Please enter a valid password').translate()
            }
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module LoginRegister
define('LoginRegister.Login.View', [
    'login_register_login.tpl',
    'SC.Configuration',
    'Tracker',
    'Session',
    'Account.Login.Model',
    'LoginRegister.Utils',
    'Profile.Model',
    'LiveOrder.Model',
    'Backbone',
    'Backbone.FormView',
    'Backbone.CompositeView',
    'GlobalViews.Message.View',
    'underscore',
    'Utils'
], function (login_tpl, Configuration, Tracker, Session, AccountLoginModel, LoginRegisterUtils, ProfileModel, LiveOrderModel, Backbone, BackboneFormView, BackboneCompositeView, GlobalViewsMessageView, _) {
    'use strict';
    // @class LoginRegister.Login.View Implements the login experience UI @extend Backbone.View
    return Backbone.View.extend({
        template: login_tpl,
        attributes: { 'id': 'login' },
        events: {
            'submit form': 'saveForm',
            'click [data-action="register-now"]': 'skipLoginCloseModal',
            'click [data-action="forgot-password"]': 'forgotPasswordHandler'
        },
        bindings: {
            '[name="email"]': 'email',
            '[name="password"]': 'password'
        },
        initialize: function (options) {
            this.application = options.application;
            this.parentView = options.parentView;
            this.model = new AccountLoginModel();
            this.timedout = options.timedout;
            // on save we redirect the user out of the login page as we know there hasn't been an error
            this.model.on('save', _.bind(this.redirect, this));
            BackboneCompositeView.add(this);
            BackboneFormView.add(this);
        }    // @method forgotPasswordHandler handles the 'forgot-password' redirection
,
        forgotPasswordHandler: function () {
            LoginRegisterUtils.skipLoginCloseModal();
            Backbone.history.navigate('#forgot-password', { trigger: true });
        },
        childViews: {
            'GlobalMessageSessionTimeout': function () {
                return new GlobalViewsMessageView({
                    message: _.translate('Your session has timed out. Please log in again.'),
                    type: 'error',
                    closable: false
                });
            }
        }    // @method skipLoginCloseModal
,
        skipLoginCloseModal: LoginRegisterUtils.skipLoginCloseModal,
        render: function () {
            Backbone.View.prototype.render.apply(this, arguments);
            if (this.$containerModal && this.application.getConfig('checkoutApp.skipLogin')) {
                this.$('[data-action="forgot-password"]').attr('data-toggle', 'show-in-modal');
            }
        }    // @method trackEvent tracks the 'sing-in' event using the global Tracker instance @param {Function} callback
,
        trackEvent: function (callback) {
            Tracker.getInstance().trackEvent({
                category: 'sign-in',
                action: 'click',
                value: 1,
                callback: callback
            });
        }    // @method redirect Redirects the user after successful login taking into account redirect parameters (origin and origin_hash).
             // @param {Object} response The HTTP response data object, response of the login service.
,
        redirect: function (context, response) {
            var url_options = _.parseUrlOptions(window.location.search), touchpoints = response.touchpoints, isPasswordReset = url_options.passwdret, self = this;
            // Track Login Event
            this.trackEvent(function () {
                if (!isPasswordReset && (url_options.is === 'checkout' || url_options.origin === 'checkout')) {
                    self.refreshApplication(response);
                } else {
                    // if we know from which touchpoint the user is coming from
                    if (url_options.origin && touchpoints[url_options.origin]) {
                        // we save the URL to that touchpoint
                        var url = touchpoints[url_options.origin];
                        // if there is an specific hash
                        if (url_options.origin_hash) {
                            // we add it to the URL as a fragment
                            url = _.addParamsToUrl(url, { fragment: url_options.origin_hash });
                        }
                        window.location.href = url;
                    } else {
                        //We've got to disable passwordProtectedSite feature if customer registration is disabled.
                        if (Configuration.getRegistrationType() !== 'disabled' && SC.ENVIRONMENT.siteSettings.siteloginrequired === 'T') {
                            window.location.href = touchpoints.home;
                        } else {
                            // otherwise we need to take it to the customer center
                            window.location.href = touchpoints.customercenter;
                        }
                    }
                }
            });
        }    // @method refreshApplication login and checkout are unified in the same ssp so after user logs in we want to refresh the UI without having to refresh the entire
             // Remember that the new user can be associated to other language/currency so we must refresh all the application.
             // The easy and safer way would be refreshing the page.
             // @param {LoginRegister.LoginResponseData} the JSON object containing the login service response data
,
        refreshApplication: function (response) {
            var current_language = Session.get('language.locale'), application = this.application;
            // @class LoginRegister.LoginResponseData
            // @property language {locale:String} language
            if (response.language && response.language.locale && current_language !== response.language.locale) {
                window.location.href = response.touchpoints.checkout;
            } else {
                var profile_model = ProfileModel.getInstance();
                // @property {String} user serialized JSON user information
                response.user && profile_model.set(response.user);
                // @property {String} cart serialized JSON cart information
                response.cart && LiveOrderModel.getInstance().set(response.cart);
                // @property {String} address serialized JSON addresses information
                response.address && profile_model.get('addresses').reset(response.address);
                // @property {String} credit-card serialized JSON creditcards information
                response.creditcard && profile_model.get('creditcards').reset(response.creditcard);
                // @property {core:String} currency
                response.currency && response.currency.code && Session.set('currency', response.currency);
                // @property {Object} touchpoints
                response.touchpoints && (application.Configuration.siteSettings.touchpoints = response.touchpoints);
                application.Configuration.currentTouchpoint = 'checkout';
                Backbone.history.navigate('', { trigger: true });
            }    // @class LoginRegister.Login.View
        }    //@method getContext @return {LoginRegister.Login.View.Context}
,
        getContext: function () {
            var url_options = _.parseUrlOptions(window.location.search);
            //@class LoginRegister.Login.View.Context
            return {
                // @property {Boolean} isRedirect
                isRedirect: !!(url_options.is !== 'checkout' && url_options.origin !== 'checkout')    // @property {Boolean} hasAutoFocus
,
                hasAutoFocus: url_options.is !== 'register' && _.isDesktopDevice()    // @property {Boolean} isUserSessionTimedOut
,
                isUserSessionTimedOut: url_options.timedout === 'T' || this.timedout,
                isSkipLogin: !!(this.$containerModal && this.application.getConfig('checkoutApp.skipLogin'))
            };
        }    // @class LoginRegister.Login.View
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Account
define('Account.RegisterAsGuest.Model', [
    'Backbone',
    'Utils'
], function (Backbone, Utils) {
    'use strict';
    //@class Account.RegisterAsGuest.Model
    //Register the User as Guest
    //@extend Backbone.Model
    return Backbone.Model.extend({
        //@property {String} urlRoot
        urlRoot: Utils.getAbsoluteUrl('services/Account.RegisterAsGuest.Service.ss')    //@property {Object} validation. Backbone.Validation attribute used for validating the form before submit.
,
        validation: {
            firstname: {
                required: true,
                msg: Utils.translate('First Name is required')
            }    // This code is commented temporarily, because of the inconsistence between Checkout and My Account regarding the require data from profile information (Checkout can miss last name)
,
            lastname: {
                required: true,
                msg: Utils.translate('Last Name is required')
            },
            email: {
                required: true,
                pattern: 'email',
                msg: Utils.translate('Valid Email is required')
            }
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module LoginRegister
define('LoginRegister.CheckoutAsGuest.View', [
    'login_register_checkout_as_guest.tpl',
    'Account.RegisterAsGuest.Model',
    'Tracker',
    'Profile.Model',
    'LiveOrder.Model',
    'Backbone.FormView',
    'SC.Configuration',
    'Backbone',
    'underscore'
], function (checkout_as_guest_tpl, AccountRegisterAsGuestModel, Tracker, ProfileModel, LiveOrderModel, BackboneFormView, Configuration, Backbone, _) {
    'use strict';
    // @class LoginRegister.CheckoutAsGuest.View Implements the checkout-as-guest UI bu showing a checkout-as-guest button
    // that when clicked it will first register the current user as guest and then shows the checkout wizard @extend Backbone.View
    return Backbone.View.extend({
        template: checkout_as_guest_tpl,
        attributes: {
            'id': 'checkout-as-guest',
            'class': 'view checkout-as-guest'
        },
        events: { 'submit form': 'saveForm' },
        bindings: {
            '[name="firstname"]': 'firstname',
            '[name="lastname"]': 'lastname',
            '[name="email"]': 'email'
        },
        initialize: function (options) {
            this.application = options.application;
            this.parentView = options.parentView;
            this.hideRegister = options.hideRegister;
            //@property {Account.RegisterAsGuest.Model} model 
            this.model = new AccountRegisterAsGuestModel();
            // on save we redirect the user out of the registration page
            // as we know there hasn't been an error
            this.model.on('save', _.bind(this.redirect, this));
            BackboneFormView.add(this);
        }    // @method trackEvent responsible of notifying the Tracker that the guest-checkout operation was made
,
        trackEvent: function (callback) {
            Tracker.getInstance().trackEvent({
                category: 'guest-checkout',
                action: 'click',
                value: 1,
                callback: callback
            });
        }    // @method redirect after the checkout-as-guest operation was successfully made this method is in 
             // responsible of navigating to the checkout wizard page. Remember that both login and checkout touchpoints belongs to the same
             // checkout.ssp so we don't need to reload the page. 
,
        redirect: function (context, response) {
            var application = this.application, profile_model = ProfileModel.getInstance();
            this.$('[type="submit"]').attr('disabled', true);
            response.user && profile_model.set(response.user);
            response.cart && LiveOrderModel.getInstance().set(response.cart);
            response.address && profile_model.get('addresses').reset(response.address);
            response.creditcard && profile_model.get('creditcards').reset(response.creditcard);
            // Track Guest Checkout Event
            this.trackEvent(function () {
                // First we track the event of login in as guest, and after that we change the current touch-point form register to checkout
                // this is necessary to the navigation helper and some routers to work properly
                application.Configuration.currentTouchpoint = 'checkout';
                Backbone.history.navigate('', { trigger: true });
            });
        }    //@method getContext @return {LoginRegister.CheckoutAsGuest.View.Context}
,
        getContext: function () {
            var url_options = _.parseUrlOptions(window.location.search);
            //@class LoginRegister.CheckoutAsGuest.View.Context
            return {
                // @property {Boolean} isRedirect
                isRedirect: !!(url_options.is !== 'checkout' && url_options.origin !== 'checkout')    // @property {Boolean} hideRegister
,
                hideRegister: this.hideRegister,
                showGuestFirstandLastname: Configuration.get('forms.loginAsGuest.showName')    // @property {Boolean} showEmail
,
                showGuestEmail: Configuration.get('forms.loginAsGuest.showEmail')    // @property {Boolean} expandGuestUserEnabled
,
                expandGuestUserEnabled: Configuration.get('forms.loginAsGuest.showName') || Configuration.get('forms.loginAsGuest.showEmail')    // @property {String} buttonCheckoutAsGuestText
,
                buttonCheckoutAsGuestText: Configuration.get('forms.loginAsGuest.buttonCheckoutAsGuestText')
            };
        }
    });
});


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Header
define('Header.Simplified.View', [
    'Header.Logo.View',
    'header_simplified.tpl',
    'Backbone',
    'Backbone.CompositeView'
], function (HeaderLogoView, header_simplified_tpl, Backbone, BackboneCompositeView) {
    'use strict';
    // @class Header.Simplified.View @extends Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: header_simplified_tpl    //@method initialize
,
        initialize: function () {
            BackboneCompositeView.add(this);
        }    //@property {Object} childViews
,
        childViews: {
            'Header.Logo': function () {
                return new HeaderLogoView(this.options);
            }
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Footer
define('Footer.Simplified.View', [
    'SC.Configuration',
    'GlobalViews.BackToTop.View',
    'footer_simplified.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'jQuery'
], function (Configuration, GlobalViewsBackToTopView, footer_simplified_tpl, Backbone, BackboneCompositeView, jQuery) {
    'use strict';
    // @class Footer.Simplified.View @extends Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: footer_simplified_tpl    //@method initialize
,
        initialize: function (options) {
            this.application = options.application;
            BackboneCompositeView.add(this);
            this.application.getLayout().on('afterAppendView', function () {
                // after appended to DOM, we add the footer height as the content bottom padding, so the footer doesn't go on top of the content
                var footer_height = this.$el.find('#site-footer').height();
                if (footer_height) {
                    this.$el.find('#content').css('padding-bottom', footer_height);
                }
                // Please note that this solution is taken from this view relative 'Footer.View', and its way to solve sticky footer behavior.
                // Also see the comments there as they apply to here as well.
                setTimeout(function () {
                    var headerMargin = parseInt(jQuery('#site-header').css('marginBottom')), contentHeight = jQuery(window).innerHeight() - jQuery('#site-header')[0].offsetHeight - headerMargin - jQuery('#site-footer')[0].offsetHeight;
                    jQuery('#main-container').css('min-height', contentHeight);
                }, 10);
            });
        }    //@property {Object} childViews
,
        childViews: {
            'Global.BackToTop': function () {
                return new GlobalViewsBackToTopView();
            }
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@method LoginRegister
define('LoginRegister.View', [
    'login_register.tpl',
    'GlobalViews.Message.View',
    'Profile.Model',
    'LoginRegister.Login.View',
    'LoginRegister.Register.View',
    'LoginRegister.CheckoutAsGuest.View',
    'Backbone.CompositeView',
    'SC.Configuration',
    'Header.Simplified.View',
    'Footer.Simplified.View',
    'notifications.tpl',
    'Backbone',
    'underscore',
    'Utils'
], function (login_register_tpl, GlobalViewsMessageView, ProfileModel, LoginView, RegisterView, CheckoutAsGuestView, BackboneCompositeView, Configuration, HeaderSimplifiedView, FooterSimplifiedView, notifications_tpl, Backbone, _, Utils) {
    'use strict';
    // @class LoginRegister.View This class shows both the Login form and the Register at the same time. @extends Backbone.View
    return Backbone.View.extend({
        template: login_register_tpl,
        attributes: { 'id': 'login-register' },
        title: _('Log in | Register').translate(),
        events: {
            // login error message could contain link to registration page
            'click .alert-error a': 'handleErrorLink'
        },
        initialize: function (options) {
            var application = options.application, parameters = Utils.parseUrlOptions(location.search), is_checking_out = parameters && parameters.is === 'checkout' || parameters && parameters.origin === 'checkout' || false, profile_model = ProfileModel.getInstance();
            this.child_view_options = {
                application: application,
                parentView: this,
                timedout: options.timedout
            };
            this.pageTitle = _('Log in').translate();
            this.enableLogin = Configuration.getRegistrationType() !== 'disabled';
            this.enableRegister = Configuration.getRegistrationType() === 'optional' || Configuration.getRegistrationType() === 'required';
            // we only show the CheckoutAsGuest button in 'checkout' touchpoint. Never in login/register touchpoints.
            this.enableCheckoutAsGuest = is_checking_out && profile_model.get('isLoggedIn') === 'F' && (Configuration.getRegistrationType() === 'optional' || Configuration.getRegistrationType() === 'disabled');
            if (!notifications_tpl) {
                if (SC.ENVIRONMENT.email_verification_error) {
                    this.message = {
                        text: _('The validation process has failed. Please login into your account and click on the validation link again.').translate(),
                        type: 'error'
                    };
                    delete SC.ENVIRONMENT.email_verification_error;
                } else if (SC.ENVIRONMENT.password_reset_invalid_error) {
                    this.message = {
                        text: _('Your reset password link is invalid. Request a new one using the Forgot Password link.').translate(),
                        type: 'error'
                    };
                    delete SC.ENVIRONMENT.password_reset_invalid_error;
                } else if (SC.ENVIRONMENT.password_reset_expired_error) {
                    this.message = {
                        text: _('Your reset password link has expired. Request a new one using the Forgot Password link.').translate(),
                        type: 'error'
                    };
                    delete SC.ENVIRONMENT.password_reset_expired_error;
                } else if (SC.ENVIRONMENT.reset_password_confirmation_email) {
                    this.message = {
                        text: _('Please check your email and get instructions on how to reset your password.').translate(),
                        type: 'success'
                    };
                    delete SC.ENVIRONMENT.reset_password_confirmation_email;
                } else if (SC.ENVIRONMENT.updated_password_confirmation) {
                    this.message = {
                        text: _('Your password has been reset.').translate(),
                        type: 'success'
                    };
                    delete SC.ENVIRONMENT.updated_password_confirmation;
                }
            }
            BackboneCompositeView.add(this);
        }    // @method handleErrorLink workaround to native netsuite error links. In particular if error contains a link to the register touch-point we want to show the registration form without navigate.
             // @return {Void}
,
        handleErrorLink: function (e) {
            // if the link contains the register touch-point
            if (~e.target.href.indexOf(Configuration.get('siteSettings.touchpoints.register'))) {
                e.preventDefault();
                this.showRegistrationForm();
                this.childViewInstances.Login.hideError();
            }
        }    //@method disableButtons
             //@param {Boolean} state
             //@return {LoginRegsiter.View} Current instance of the view
,
        disableButtons: function (state) {
            this.getChildViewInstance('Login').$('a, input, button').prop('disabled', state);
            if (this.getChildViewInstance('CheckoutAsGuest')) {
                this.getChildViewInstance('CheckoutAsGuest').$('a, input, button').prop('disabled', state);
            }
            this.getChildViewInstance('Register').$('a, input, button').prop('disabled', state);
            return this;
        }    // @method showRegistrationForm  make sure the registration form is in the front
,
        showRegistrationForm: function () {
            // show the form
            this.$('[data-view="Register"]').addClass('in');
            // hide the container of the link to show it
            this.$('[data-view="CheckoutAsGuest"]').removeClass('in');
        },
        getHeaderView: function () {
            //We've got to disable passwordProtectedSite feature if customer registration is disabled.
            if (Configuration.getRegistrationType() !== 'disabled' && SC.ENVIRONMENT.siteSettings.siteloginrequired === 'T') {
                return HeaderSimplifiedView;
            }
        },
        getFooterView: function () {
            //We've got to disable passwordProtectedSite feature if customer registration is disabled.
            if (Configuration.getRegistrationType() !== 'disabled' && SC.ENVIRONMENT.siteSettings.siteloginrequired === 'T') {
                return FooterSimplifiedView;
            }
        },
        childViews: {
            'Login': function () {
                return new LoginView(this.child_view_options);
            },
            'CheckoutAsGuest': function () {
                return new CheckoutAsGuestView(_.extend({ hideRegister: !this.enableRegister }, this.child_view_options));
            },
            'Register': function () {
                return new RegisterView(this.child_view_options);
            },
            'Messages': function () {
                if (this.message) {
                    return new GlobalViewsMessageView({
                        message: this.message.text,
                        type: this.message.type || 'error',
                        closable: true
                    });
                }
            }
        }    //@method getContext
             //@return {LoginRegister.View.Context}
,
        getContext: function () {
            //@class LoginRegister.View.Context
            return {
                //@property {Boolean} showRegister
                showRegister: this.enableRegister,
                showCheckoutAsGuest: this.enableCheckoutAsGuest,
                showLogin: this.enableLogin,
                showRegisterOrGuest: this.enableRegister || this.enableCheckoutAsGuest
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Account
define('Account.ForgotPassword.Model', [
    'Backbone',
    'underscore',
    'Utils'
], function (Backbone, _, Utils) {
    'use strict';
    //@class Account.ForgotPassword.Model
    // Sends user input data to the forgot password service
    // validating email before is sent
    // [Backbone.validation](https://github.com/thedersen/backbone.validation)
    // @extend Backbone.Model
    return Backbone.Model.extend({
        //@property {String} urlRoot
        urlRoot: Utils.getAbsoluteUrl('services/Account.ForgotPassword.Service.ss')    //@property validation. Backbone.Validation attribute used for validating the form before submit.
,
        validation: {
            email: {
                required: true,
                pattern: 'email',
                msg: _('Valid Email is required').translate()
            }
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module LoginRegister
define('LoginRegister.ForgotPassword.View', [
    'login_register_forgot_password.tpl',
    'SC.Configuration',
    'LoginRegister.Utils',
    'Account.ForgotPassword.Model',
    'GlobalViews.Message.View',
    'Backbone.FormView',
    'Header.Simplified.View',
    'Footer.Simplified.View',
    'Backbone',
    'underscore',
    'Utils'
], function (forgot_password_tpl, Configuration, LoginRegisterUtils, AccountForgotPasswordModel, GlobalViewsMessageView, BackboneFormView, HeaderSimplifiedView, FooterSimplifiedView, Backbone, _) {
    'use strict';
    //@class LoginRegister.ForgotPassword.View Implements the forgot-password UI @extemd Backbone.View
    return Backbone.View.extend({
        template: forgot_password_tpl,
        attributes: { 'id': 'forgot-password' },
        title: _('Reset Password').translate(),
        events: {
            'submit form': 'saveForm',
            'click [data-action="sign-in-now"]': 'signInNowClick'
        },
        bindings: { '[name="email"]': 'email' },
        initialize: function () {
            // @property {Account.ForgotPassword.Model} model
            this.model = new AccountForgotPasswordModel();
            this.model.on('save', _.bind(this.showSuccess, this));
            BackboneFormView.add(this);
        },
        getHeaderView: function () {
            //We've got to disable passwordProtectedSite feature if customer registration is disabled.
            if (Configuration.getRegistrationType() !== 'disabled' && SC.ENVIRONMENT.siteSettings.siteloginrequired === 'T') {
                return HeaderSimplifiedView;
            }
        },
        getFooterView: function () {
            //We've got to disable passwordProtectedSite feature if customer registration is disabled.
            if (Configuration.getRegistrationType() !== 'disabled' && SC.ENVIRONMENT.siteSettings.siteloginrequired === 'T') {
                return FooterSimplifiedView;
            }
        },
        render: function () {
            Backbone.View.prototype.render.apply(this, arguments);
            if (this.$containerModal && this.options.application.getConfig('checkoutApp.skipLogin')) {
                this.$('header, h3').remove();
                this.$('[data-action="sign-in-now"]').attr({
                    'data-toggle': 'show-in-modal',
                    'href': 'login'
                });
            }
        }    // @method showSuccess
,
        showSuccess: function () {
            SC.ENVIRONMENT.reset_password_confirmation_email = true;
            Backbone.history.navigate('login-register', { trigger: true });
        }    // @method signInNowClick
,
        signInNowClick: LoginRegisterUtils.skipLoginCloseModal,
        saveForm: function () {
            // we don't want to close the modal, if any, on saveForm
            if (this.$containerModal && this.options.application.getConfig('checkoutApp.skipLogin')) {
                this.inModal = false;
            }
            return Backbone.View.prototype.saveForm.apply(this, arguments).done(function () {
                this.inModal = true;
            });
        }    //@method getcContext @return LoginRegister.ForgotPassword.View.Context
,
        getContext: function () {
            //@class LoginRegister.ForgotPassword.View.Context
            return {};
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Account
define('Account.ResetPassword.Model', [
    'Backbone',
    'underscore',
    'Utils'
], function (Backbone, _, Utils) {
    'use strict';
    //@class Account.ResetPassword.Model
    // Sends user input data to the reset password service
    // validating passwords before they are sent
    // [Backbone.validation](https://github.com/thedersen/backbone.validation)
    //@extend Backbone.Model
    return Backbone.Model.extend({
        //@property {String} urlRoot
        urlRoot: Utils.getAbsoluteUrl('services/Account.ResetPassword.Service.ss')    //@property {Object} validation. Backbone.Validation attribute used for validating the form before submit.
,
        validation: {
            confirm_password: [
                {
                    required: true,
                    msg: _('Confirm password is required').translate()
                },
                {
                    equalTo: 'password',
                    msg: _('New Password and Confirm Password do not match').translate()
                }
            ],
            password: {
                required: true,
                msg: _('New  password is required').translate()
            }
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module LoginRegister
define('LoginRegister.ResetPassword.View', [
    'login_register_reset_password.tpl',
    'SC.Configuration',
    'Account.ResetPassword.Model',
    'GlobalViews.Message.View',
    'Backbone.FormView',
    'Header.Simplified.View',
    'Backbone',
    'underscore',
    'Utils'
], function (reset_password_tpl, Configuration, AccountResetPasswordModel, GlobalViewsMessageView, BackboneFormView, HeaderSimplifiedView, Backbone, _) {
    'use strict';
    // @class LoginRegister.ResetPassword.View implements the reset-password experience UI @extend Backbone.View
    return Backbone.View.extend({
        template: reset_password_tpl,
        attributes: { 'id': 'reset-password' },
        title: _('Reset Password').translate(),
        events: { 'submit form': 'saveForm' },
        bindings: {
            '[name="password"]': 'password',
            '[name="confirm_password"]': 'confirm_password'
        },
        initialize: function () {
            this.model = new AccountResetPasswordModel();
            this.model.set('params', { 'cb': _.parseUrlOptions(location.search).cb });
            this.model.on('save', _.bind(this.showSuccess, this));
            BackboneFormView.add(this);
        }    // @method showSuccess
,
        showSuccess: function () {
            SC.ENVIRONMENT.updated_password_confirmation = true;
            Backbone.history.navigate('login-register', { trigger: true });
        },
        getHeaderView: function () {
            //We've got to disable passwordProtectedSite feature if customer registration is disabled.
            if (Configuration.getRegistrationType() !== 'disabled' && SC.ENVIRONMENT.siteSettings.siteloginrequired === 'T') {
                return HeaderSimplifiedView;
            }
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module LoginRegister
define('LoginRegister.Router', [
    'LoginRegister.Login.View',
    'LoginRegister.Register.View',
    'LoginRegister.CheckoutAsGuest.View',
    'LoginRegister.View',
    'LoginRegister.ForgotPassword.View',
    'LoginRegister.ResetPassword.View',
    'Profile.Model',
    'Backbone',
    'underscore'
], function (LoginView, RegisterView, CheckoutAsGuestView, LoginRegisterView, ForgotPasswordView, ResetPasswordView, ProfileModel, Backbone, _) {
    'use strict';
    // @class LoginRegister.Router Handles views and routers of Login/Register Page. Includes Register Guest, Forgot Password and Reset password.
    // Initializes the different views depending on the requested path.  @extend Backbone.Router
    return Backbone.Router.extend({
        routes: {
            'login-register': 'loginRegister',
            'forgot-password': 'forgotPassword',
            'reset-password': 'resetPassword',
            'register': 'register',
            'login': 'login'
        },
        initialize: function (application) {
            // application is a required parameter for all views
            // we save the parameter to pass it later
            this.application = application;
            this.profileModel = ProfileModel.getInstance();
        }    // @method loginRegister dispatch the 'login-register' URL for showing the login and register forms.
,
        loginRegister: function () {
            if (this.profileModel.get('isLoggedIn') === 'T' && this.profileModel.get('isGuest') === 'F') {
                Backbone.history.navigate('', { trigger: true });
            } else {
                var view = new LoginRegisterView({
                    application: this.application,
                    timedout: _.getParameterByName(window.location.href, 'timeout') === 'T'
                });
                view.showContent();
            }
        }    // @method register dispatch the 'register form - only' URL
,
        register: function () {
            if (this.profileModel.get('isLoggedIn') === 'T' && this.profileModel.get('isGuest') === 'F') {
                Backbone.history.navigate('', { trigger: true });
            } else {
                var view = new RegisterView({ application: this.application });
                view.title = _('Register').translate();
                view.showContent();
            }
        }    // @method login dispatch the 'login form - only' URL
,
        login: function () {
            if (this.profileModel.get('isLoggedIn') === 'T' && this.profileModel.get('isGuest') === 'F') {
                Backbone.history.navigate('', { trigger: true });
            } else {
                var view = new LoginView({ application: this.application });
                view.title = _('Log in').translate();
                view.showContent();
            }
        }    // @method forgotPassword dispatch the 'forgot password' URL
,
        forgotPassword: function () {
            var view = new ForgotPasswordView({ application: this.application });
            view.showContent();
        }    // @method resetPassword dispatch the 'forgot password' URL
,
        resetPassword: function () {
            var view = new ResetPasswordView({ application: this.application });
            view.showContent();
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module LoginRegister
// Handles views and routers of Login/Register Page. Includes Register Guest, Forgot Passowrd and Reset password
define('LoginRegister', ['LoginRegister.Router'], function (Router) {
    'use strict';
    //@class LoginRegisterModule @extend ApplicationModule
    return {
        mountToApp: function (application) {
            if (application.getConfig('modulesConfig.LoginRegister.startRouter')) {
                return new Router(application);
            }
        }
    };
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CreditCard
define('CreditCard.List.View', [
    'creditcard_list.tpl',
    'Backbone.CollectionView',
    'Backbone.CompositeView',
    'CreditCard.View',
    'SC.Configuration',
    'GlobalViews.Confirmation.View',
    'Backbone',
    'underscore',
    'LiveOrder.Model',
    'jQuery',
    'Utils'
], function (creditcard_list_tpl, BackboneCollectionView, BackboneCompositeView, CreditCardView, Configuration, GlobalViewsConfirmationView, Backbone, _, LiveOrderModel, jQuery) {
    'use strict';
    // @class CreditCard.List.View @extends Backbone.View
    return Backbone.View.extend({
        template: creditcard_list_tpl,
        title: _('Credit Cards').translate(),
        page_header: _('Credit Cards').translate(),
        attributes: { 'class': 'CreditCardListView' },
        events: { 'click [data-action="remove"]': 'removeCreditCard' },
        initialize: function () {
            BackboneCompositeView.add(this);
            var self = this;
            this.collection.on('reset sync add remove change', function () {
                self.collection.sort();
            });
        },
        childViews: {
            'CreditCards.Collection': function () {
                return new BackboneCollectionView({
                    collection: this.collection,
                    childView: CreditCardView,
                    childViewOptions: {
                        showActions: true,
                        showDefaults: Configuration.get('currentTouchpoint') === 'customercenter'
                    },
                    viewsPerRow: Configuration.get('itemsPerRow', 2)
                });
            }
        }    //@method getSelectedMenu
,
        getSelectedMenu: function () {
            return 'creditcards';
        }    //@method getBreadcrumbPages
,
        getBreadcrumbPages: function () {
            return {
                text: _('Credit Cards').translate(),
                href: '/creditcards'
            };
        }    //@method removeCreditCard dispatch the remove event
,
        removeCreditCard: function (e) {
            e.preventDefault();
            var deleteConfirmationView = new GlobalViewsConfirmationView({
                callBack: this._removeCreditCardFromCollection,
                callBackParameters: {
                    context: this,
                    creditcardId: jQuery(e.target).data('id')
                },
                title: _('Remove Credit Card').translate(),
                body: _('Are you sure you want to remove this Credit Card?').translate(),
                autohide: true
            });
            return this.options.application.getLayout().showInModal(deleteConfirmationView);
        },
        _removeCreditCardFromCollection: function (options) {
            options.context.collection.get(options.creditcardId).destroy({ wait: true });
        }    //@method getContext @return {CreditCard.List.View.Context}
,
        getContext: function () {
            //@class CreditCard.List.View.Context
            return {
                //@property {String} pageHeader
                pageHeader: this.page_header,
                showBackToAccount: Configuration.get('siteSettings.sitetype') === 'STANDARD'
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CreditCard
define('CreditCard.Router', [
    'CreditCard.Edit.View',
    'CreditCard.List.View',
    'CreditCard.Model',
    'Profile.Model',
    'Backbone'
], function (CreditCardEditView, CreditCardListView, Model, ProfileModel, Backbone) {
    'use strict';
    // @class CreditCard.Router Router for handling credit cards (CRUD) @extends Backbone.Router
    return Backbone.Router.extend({
        routes: {
            'creditcards': 'creditCards',
            'creditcards/new': 'newCreditCard',
            'creditcards/:id': 'creditCardDetailed'
        },
        initialize: function (application) {
            this.application = application;
            this.profileModel = ProfileModel.getInstance();
        }    // @method creditCards dispatch the 'creditcards list' route
,
        creditCards: function () {
            if (this.profileModel.get('isLoggedIn') !== 'T') {
                return this.application.getLayout().notFound();
            }
            var collection = this.profileModel.get('creditcards');
            if (collection.length) {
                var view = new CreditCardListView({
                    application: this.application,
                    collection: collection
                });
                collection.once('reset destroy change add', function () {
                    // Only render this view again if it is the 'creditcards', otherwise it will render it but it will not change the url hash
                    if (Backbone.history.fragment === 'creditcards') {
                        this.creditCards();
                    }
                }, this);
                view.showContent();
            } else {
                Backbone.history.navigate('#creditcards/new', { trigger: true });
            }
        }    // @method creditCardDetailed Dispatch the 'view credit card details' route @param {String} id
,
        creditCardDetailed: function (id) {
            if (this.profileModel.get('isLoggedIn') !== 'T') {
                return this.application.getLayout().notFound();
            }
            var collection = this.profileModel.get('creditcards'), model = collection.get(id), view = new CreditCardEditView({
                    application: this.application,
                    isCreditCardCollectionEmpty: collection.length === 0,
                    model: model
                });
            model.on('reset destroy change add', function () {
                if (view.inModal && view.$containerModal) {
                    view.$containerModal.modal('hide');
                    view.destroy();
                } else {
                    Backbone.history.navigate('#creditcards', { trigger: true });
                }
            }, view);
            view.showContent();
        }    // @method newCreditCard Dispatch the 'add new credit card' route
,
        newCreditCard: function () {
            if (this.profileModel.get('isLoggedIn') !== 'T') {
                return this.application.getLayout().notFound();
            }
            var collection = this.profileModel.get('creditcards'), view = new CreditCardEditView({
                    application: this.application,
                    isCreditCardCollectionEmpty: collection.length === 0,
                    model: new Model()
                });
            collection.on('add', function () {
                if (view.inModal) {
                    view.$containerModal && view.$containerModal.modal('hide');
                    view.destroy();
                } else {
                    Backbone.history.navigate('#creditcards', { trigger: true });
                }
            }, view);
            view.model.on('change', function (model) {
                collection.add(model, { merge: true });
            }, this);
            view.showContent();
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CreditCard
// Defines the CreditCard  module
define('CreditCard', [
    'CreditCard.Router',
    'underscore',
    'Utils'
], function (Router, _) {
    'use strict';
    // @class CreditCart @extends ApplicationModule
    return {
        MenuItems: {
            parent: 'settings',
            id: 'creditcards',
            name: _('Credit Cards').translate(),
            url: 'creditcards',
            index: 4
        },
        mountToApp: function (application) {
            return new Router(application);
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Content
define('Content.DataModels', [
    'Singleton',
    'Backbone',
    'underscore',
    'jQuery',
    'Utils',
    'AjaxRequestsKiller',
    'Backbone.CachedModel',
    'Backbone.CachedCollection'
], function (Singleton, Backbone, _, jQuery, Utils, AjaxRequestsKiller) {
    'use strict';
    var Pages = {};
    // @class Pages.Model Represents the definition of a page. Interact with the Content Delivery Service
    // BEWARE: If you change the URL Root of your "Content Delivery Service" SSP Application
    // you need to update the urlRoot of this model @extends Backbone.CachedModel
    Pages.Model = Backbone.CachedModel.extend({ urlRoot: Utils.getAbsoluteUrl('../cds/services/page.ss') });
    // @class Pages.Collection Singleton containing a reference of all pages already loaded
    // Interact with the Content Delivery Service. BEWARE: If you change the URL Root of your "Content Delivery Service" SSP Application
    // you need to update the urlRoot of this model @extends Backbone.CachedCollection
    Pages.Collection = Backbone.CachedCollection.extend({
        url: Utils.getAbsoluteUrl('../cds/services/page.ss')    //@property {Class<Pages.Model>} model
,
        model: Pages.Model
    }, Singleton);
    var Urls = {};
    // @class Urls.Model Represents a single url and the page definition they point to @extends Backbone.Model
    Urls.Model = Backbone.Model.extend({ urlRoot: Utils.getAbsoluteUrl('../cds/services/url.ss') });
    // @class Urls.Collection Implements the url matching logic @extends Backbone.Collection
    Urls.Collection = Backbone.Collection.extend({
        url: Utils.getAbsoluteUrl('../cds/services/url.ss')    //@property {Class<Urls.Model>} model
,
        model: Urls.Model,
        initialize: function () {
            this.regExpGraphRoot = new Urls.Model({ childs: [] });
            this.regExpGraphHelper = [];
            this.landingPages = [];
            this.exactMatchHash = {};
            this.on('reset', this.reseter);
        }    // @method reseter
             // Every-time this collection is reseted, this function generates a couple of helper structures:
             // * URLs.Collection.landingPages: Array of all url pointing to a landing page
             // * URLs.Collection.exactMatchHash: Hash table of all url that does not have in it
             // * URLs.Collection.regExpGraphRoot: Graph were URLs are farther from the root when they are more specific.
,
        reseter: function () {
            this.regExpGraphRoot = new Urls.Model({ childs: [] });
            this.regExpGraphHelper = [];
            this.landingPages = [];
            this.exactMatchHash = {};
            var self = this;
            // Iterates all urls
            this.each(function (model) {
                // If the URL is * and its and its not a Landing page, it will be set as Urls.Collection.defaultModel
                if (model.get('query') === '*' && model.get('type') !== '1') {
                    if (!Urls.Collection.defaultModel) {
                        Urls.Collection.defaultModel = model;
                    }
                }    // If the url contains * and its and its not a Landing page,
                     // It gets translated to a regular expression and injected into the this.regExpGraphRoot
                     // By comparing one another with other regular expressions (this.insertInGraph)
                else if (~model.get('query').indexOf('*') && model.get('type') !== '1') {
                    // Creates the Regular Expression to match urls against
                    var regular_expresion = new RegExp('^' + _.map(model.get('query').split('*'), function (token) {
                        return token.replace(/\//gi, '\\/').replace(/\?/gi, '\\?');
                    }).join('(.*?)') + '$');
                    // Sets the proper attributes
                    model.set({
                        regexp: regular_expresion,
                        childs: []
                    });
                    // Now we insert it in the graph
                    self.insertInGraph(model, self.regExpGraphRoot);
                    /// We will just check if the new node is parent of a previously added node
                    _.each(self.regExpGraphHelper, function (currentNode) {
                        if (!_.contains(model.get('childs'), currentNode) && model.get('regexp').test(currentNode.get('query'))) {
                            model.get('childs').push(currentNode);
                        }
                    });
                    self.regExpGraphHelper.push(model);
                }    // Other way its an exact match then we add it to this.exactMatchHash
                else {
                    self.exactMatchHash[model.get('query')] = model;
                    // if it's a landing page we should add it to the collection of URL we will be adding to the router
                    if (model.get('type') === '1') {
                        self.landingPages.push(model);
                    }
                }
            });
        }    // @method insertInGraph Given a node it tries to injected into the graph
             // @param {Urls.Model} node @param {Urls.Model} root
,
        insertInGraph: function (node, root) {
            var isParent = true, self = this;
            // walks all child nodes
            _.each(root.get('childs'), function (branch) {
                if (branch.get('query') !== node.get('query')) {
                    // is it covered by a more broad expression?
                    if (branch.get('regexp').test(node.get('query'))) {
                        isParent = false;
                        self.insertInGraph(node, branch);
                    }    // Is it broader than then current branch
                    else if (node.get('regexp').test(branch.get('query'))) {
                        node.get('childs').push(branch);
                        root.set('childs', _.without(root.get('childs'), branch));
                    }
                }
            });
            // the node is not a child nor a parent is a brother
            if (isParent && !~_.indexOf(root.get('childs'), node)) {
                root.get('childs').push(node);
            }
        }    // @method findUrl For the passed in URL looks for the most appropriate Erl model to return
             // @param {String} URL @return {String|false}
,
        findUrl: function (url) {
            // Here we do a table hash lookup (Super fast!)
            var exact_match = this.exactMatchHash[url];
            if (exact_match) {
                return exact_match;
            } else {
                // lets do a lookup in our regexp graph
                this.candidates = {};
                // Here we will store URL_ID : Number of edges
                this.walkRegExpGraph(url, this.regExpGraphRoot, 1);
                var result = _.max(_.pairs(this.candidates), function (candidate) {
                    return candidate[1];
                });
                return result && typeof result === 'object' ? this.get(result[0]) : false;
            }
        }    // @method walkRegExpGraph Recursive function used by the findUrl to traverse the url graph
             // @param {String} url @param {Urls.Model} branch @param {Number} deep
,
        walkRegExpGraph: function (url, branch, deepth) {
            var self = this;
            // Walks all the childs of the current branch
            _.each(branch.get('childs'), function (new_branch) {
                if (new_branch.get('regexp').test(url)) {
                    // if the current child (which is also a branch) passes the test it will go down the line
                    // and it adds 1 edge to the candidates object
                    self.candidates[new_branch.cid] = self.candidates[new_branch.cid] ? self.candidates[new_branch.cid] + deepth : deepth;
                    self.walkRegExpGraph(url, new_branch, deepth + 1);
                }
            });
        }
    }, Singleton);
    // This is a private variable that will holds all the requests we have made, tho it's public you should try to avoid using it, and call Content.load instead
    var currentRequests = [];
    // loadPage:
    // This Function takes care of loading the content for the passed URL.
    // if a done function is passed it will be called whenever we have content,
    // if no content is provided for the current URL,
    // the done function will be called right away with false as a parameter
    function loadPage(url, donefn) {
        /*jshint validthis:true*/
        donefn = donefn || jQuery.noop;
        if (url) {
            // Looks in the array of registered urls
            var foundUrl = Urls.Collection.getInstance().findUrl(url);
            // The URL is registered in the collection
            if (foundUrl) {
                // Gets the page for the URL
                var page_id = foundUrl.get('pageid'), page = Pages.Collection.getInstance().get(page_id);
                if (page) {
                    donefn(page);
                }    // We don't have it need to be fetched
                else {
                    // Fetches the page
                    new Pages.Model({
                        internalid: page_id,
                        id: page_id
                    }).fetch({
                        data: {
                            cache: this.application.getConfig('cache.contentPageCdn'),
                            ttl: this.application.getConfig('cache.contentPageTtl')
                        },
                        killerId: AjaxRequestsKiller.getKillerId(),
                        reset: true
                    }).done(function (loaded_page) {
                        Pages.Collection.getInstance().add(loaded_page);
                        page = Pages.Collection.getInstance().get(page_id);
                        donefn(page);
                    });
                }
            }    // No URL is found
            else {
                donefn(false);
            }
        }    // No URL is passed
        else {
            donefn(false);
        }
    }
    return {
        Urls: Urls,
        Pages: Pages,
        currentRequests: currentRequests,
        loadPage: loadPage
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Content
define('Content.EnhancedViews', [
    'Content.DataModels',
    'underscore',
    'jQuery',
    'Backbone.View',
    'Backbone.View.render',
    'Backbone.View.Plugins'
], function (DataModels, _, jQuery) {
    'use strict';
    // @class Content.EnhancedViews Provides functions that based in a view, sets the title,
    // meta tags and inject html content in the dom
    var EnhancedViews = { previousPlaceholders: [] };
    _.extend(EnhancedViews, {
        // @method overrideViewSettings Updates attributes of the view with the info coming in the page model passed in
        // @param {Backbone.View} view @param {Pages.Model} page
        overrideViewSettings: function (view, page) {
            view.contentZones = view.contentZones || [];
            if (page) {
                // All info comming off the page has presedence to whats already defined in the view
                view.title = page.get('title') || view.getTitle();
                view.page_header = page.get('pageheader') || view.page_header;
                view.description = page.get('description') || view.description;
                view.metaDescription = page.get('metadescription') || view.getMetaDescription();
                view.metaKeywords = page.get('metakeywords') || view.getMetaKeywords();
                view.template = page.get('template') || view.template;
                view.addToHead = page.get('metaextra') || view.getAddToHead() || '';
                // Everything but the banners, who are merged with other that the view may have,
                view.contentZones = _.union(view.contentZones, page.get('pagecontent'));
            }
            // If you have a default page (this is a page that is pointed by the * url)
            // it will be always merged
            var default_url = DataModels.Urls.Collection.defaultModel, default_page = default_url && DataModels.Pages.Collection.getInstance().get(default_url.get('pageid'));
            if (default_page) {
                view.contentZones = _.union(view.contentZones, default_page.get('pagecontent'));
            }
            return view;
        },
        initalizeHead: function () {
            return jQuery('head').not(':has(title)').append('<title/>').end().not(':has(link[rel="canonical"])').append('<link rel="canonical"/>').end().not(':has(meta[name="keywords"])').append('<meta name="keywords"/>').end().not(':has(meta[name="description"])').append('<meta name="description"/>').end();
        },
        enhanceHead: function (view) {
            var title = view.getTitle();
            if (title) {
                document.title = title;
            }
            // Sets the text of the title element if we are in the server
            // we only do it on the server side due to an issue modifying
            // the title tag on IE :(
            if (SC.ENVIRONMENT.jsEnvironment === 'server') {
                this.$head.find('title').text(title);
            }
            return this.enhanceMetaTags(view).enhanceCanonicalLinks(view);
        }    // @method enhanceMetaTags Enhance the document's head by adding given view metadata.
             // We enclose the added metatags between two special tags so we can delete them when the url changes. We do this like this because
             // we cannot add any strange parameter to added metatags to reference them. @param {Backbone.View} view
,
        enhanceMetaTags: function (view) {
            this.$head.find('meta[name="description"]').attr('content', view.metaDescription || view.getMetaDescription() || '').end()    // and keywords meta tags
.find('meta[name="keywords"]').attr('content', view.metaKeywords || view.getMetaKeywords() || '').end()    // then we append the tags specific to this view
                                                                                                           // excluding any extra descriptions and keywords meta tags
.append(view.getMetaTags().not('[name="description"]').not('[name="keywords"]'));
            // remove head's elements that are between enhanceMetaTagsStart and enhanceMetaTagsEnd
            var remove_element = false;
            //flag used to determine when remove elements.
            jQuery('head').children().each(function () {
                var $element = jQuery(this), element_id = $element.attr('id');
                if (element_id === 'enhanceMetaTagsStart') {
                    remove_element = true;
                }
                if (remove_element) {
                    $element.remove();
                }
                if (remove_element && element_id === 'enhanceMetaTagsEnd') {
                    remove_element = false;
                }
            });
            var addToHead = view.getAddToHead();
            //add meta extra elements between enhanceMetaTagsStart and enhanceMetaTagsEnd
            if (addToHead) {
                jQuery('<script id="enhanceMetaTagsStart"></script>' + addToHead + '<script id="enhanceMetaTagsEnd"></script>').appendTo(this.$head);
            }
            return this;
        }    //@method enhanceCanonicalLinks @param {Backbone.View} view
,
        enhanceCanonicalLinks: function (view) {
            this.$head.find('link[rel="canonical"]').attr('href', view.getCanonical()).end()    // we remove any existing next/prev tags every time
                                                                                                // a page is rendered in case the previous view was paginated
.find('link[rel="next"], link[rel="prev"]').remove();
            // if the current page is paginated
            // set prev/next link rel
            this.setLinkRel('prev', view.getRelPrev());
            this.setLinkRel('next', view.getRelNext());
            return this;
        },
        setLinkRel: function (rel, link) {
            link && jQuery('<link />', {
                rel: rel,
                href: link
            }).appendTo(this.$head);
        }    // EnhancedViews.enhancePage:
             // enhance the DOM based on the attributes of the view
,
        enhancePage: function (view, Layout) {
            this.$head = this.$head || this.initalizeHead();
            // changes the page head based on the view attributes
            this.enhanceHead(view);
            // empties the place holders DOMs element
            EnhancedViews.clearPlaceholders();
            // walks the content zones and injects them in the site
            _.each(view.contentZones || [], function (content_zone) {
                // its in the layout
                if (view.$(content_zone.target).length === 0) {
                    // it's empty
                    if (jQuery(content_zone.target + ':empty').length === 0) {
                        return;
                    }
                }
                Layout.trigger('renderEnhancedPageContent', view, content_zone);
            });
        },
        renderHTMLContent: function (view, content_zone) {
            var target = content_zone.target, layout = view.options.application.getLayout();
            // If the target is inside the view
            if (view.$(target).length) {
                view.$(target).html(content_zone.content);
                EnhancedViews.previousPlaceholders.push(content_zone.target);
                layout.trigger('afterAppendView', view);
            } else {
                // Otherwise, if the target is on the layout
                // we have to make sure it's empty
                layout.$(target).filter(':empty').each(function (index, element) {
                    jQuery(element).html(content_zone.content);
                    EnhancedViews.previousPlaceholders.push(content_zone.target);
                });
                layout.trigger('afterAppendView', layout);
            }
        }    // EnhancedViews.clearPlaceholders:
             // This clears all content that was previously added to the Layout,
             // this method is called by the EnhancedViews.enhancePage
             // for every new page
,
        clearPlaceholders: function () {
            _.each(EnhancedViews.previousPlaceholders, function (previous_placeholder) {
                jQuery(previous_placeholder).empty();
            });
            EnhancedViews.previousPlaceholders = [];
        }
    });
    return EnhancedViews;
});


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Content
define('Content.LandingPages.View', [
    'Content.DataModels',
    'Content.EnhancedViews',
    'SC.Configuration',
    'landing_page.tpl',
    'landing_page_my_account.tpl',
    'Backbone',
    'underscore'
], function (DataModels, EnhancedViews, Configuration, landing_page_tpl, landing_page_my_account_tpl, Backbone) {
    'use strict';
    // Categories is an optional dependency
    var Categories = false;
    try {
        Categories = require('Categories');
    } catch (e) {
    }
    // @class Content.LandingPages.View
    // Uses the Content.DataModels to connect to the servers. Tho' most of the content is driven by the content service
    // we need a view to extend upon @extend Backbone.View
    return Backbone.View.extend({
        template: Configuration.get('currentTouchpoint') === 'customercenter' ? landing_page_my_account_tpl : landing_page_tpl,
        title: '',
        page_header: '',
        attributes: {
            'id': 'landing-page',
            'class': 'landing-page'
        },
        events: {},
        initialize: function () {
            this.url = Backbone.history && Backbone.history.fragment;
        }    // @method showContent Override default showContent method to show page header
,
        showContent: function (page) {
            this.page_header = page.get('pageheader');
            this.page = page;
            this.options.layout.showContent(this);
        }    // @method getBreadcrumbPages It will try to figure the breadcrumb out of the url
,
        getBreadcrumbPages: function () {
            var breadcrumb = [];
            breadcrumb.push({
                href: this.url,
                text: this.page_header
            });
            return breadcrumb;
        }    // @method getContext @returns {Content.LandingPages.View.Context}
,
        getContext: function () {
            // @class Content.LandingPages.View.Context
            return {
                // @property {Boolean} pageHeaderAndNotInModal
                pageHeaderAndNotInModal: this.page_header && !this.inModal,
                pageHeader: this.page_header,
                pageAndPageContent: this.page && this.page.get('content')    // @property {String} pageContent
,
                pageContent: this.page.get('content')
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Content
define('Content.LandingPages.Router', [
    'Content.DataModels',
    'Content.EnhancedViews',
    'Content.LandingPages.View',
    'Backbone'
], function (DataModels, EnhancedViews, View, Backbone) {
    'use strict';
    // @class Content.LandingPages.Router
    // The Landing pages Module uses the Content.DataModels to connect to the servers,
    // That's why there is only a view and a router here @extends Backbone.Router
    return Backbone.Router.extend({
        // @property {Object} routes Are created dynamically based on the URLs in the content.mountToApp
        routes: {},
        initialize: function (application) {
            this.application = application;
        }    // @method displayLandingPage uses the DataModels.loadPage to load the data and create the model
,
        displayLandingPage: function (option) {
            var self = this, page_url = option ? unescape(Backbone.history.fragment).replace('?' + option, '') : Backbone.history.fragment, view = new View({
                    application: this.application,
                    layout: this.application.getLayout()
                });
            DataModels.loadPage('/' + page_url, function (page) {
                if (page) {
                    EnhancedViews.overrideViewSettings(view, page);
                    view.showContent(page);
                } else {
                    self.application.getLayout().notFound();
                }
            });
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Content
// Integration to the Content Delivery Service Bundle
define('Content', [
    'Content.DataModels',
    'Content.EnhancedViews',
    'Content.LandingPages.Router',
    'Content.LandingPages.View',
    'SC.Configuration',
    'Tracker',
    'underscore',
    'jQuery',
    'Backbone',
    'Utils'
], function (DataModels, EnhancedViews, LandingPagesRouter, LandingPagesView, Configuration, Tracker, _, jQuery, Backbone) {
    'use strict';
    // @class Content Overrides ```Layout:showContent``` and ```Layout:showInModal``` so it first fetch
    // content if any and then show views enhanced with content if any. It also listen for any change in the url hash
    // and fetch for content if any correspond to the new url. It also handles content of type 'merchandising'
    // and instantiate the LandingPages router @extends ApplicationModule
    return {
        mountToApp: function (Application) {
            if (!Configuration.get('cms.useCMS')) {
                // Loads the URLs of the different pages in the content service,
                // this needs to happened before the application starts, so some routes are registered
                if (SC.ENVIRONMENT.CONTENT) {
                    DataModels.Urls.Collection.getInstance().reset(SC.ENVIRONMENT.CONTENT);
                    delete SC.ENVIRONMENT.CONTENT;
                    if (SC.ENVIRONMENT.DEFAULT_PAGE) {
                        DataModels.Pages.Collection.getInstance().reset(SC.ENVIRONMENT.DEFAULT_PAGE);
                        delete SC.ENVIRONMENT.DEFAULT_PAGE;
                    }
                }
                DataModels.Application = Application;
                var Layout = Application.getLayout(), show_content_wrapper = function (fn, view) {
                        var promise = jQuery.Deferred();
                        var args = arguments;
                        // Check the URL and loads the page definition if needed
                        DataModels.loadPage('/' + Backbone.history.fragment, function (page) {
                            // override the title and page header of the view with the page returned
                            EnhancedViews.overrideViewSettings(view, page);
                            view.enhancedPage = true;
                            Tracker.getInstance().trackPageview('/' + Backbone.history.fragment);
                            // Calls the original function with all the parameters (slice to exclude fn)
                            fn.apply(Layout, Array.prototype.slice.call(args, 1)).done(function () {
                                // once the original function is done this reads the attributes of the view and
                                // sets title, metas and adds banners
                                EnhancedViews.enhancePage(view, Layout);
                                //only after enhancing the view we resolve the promise
                                promise.resolveWith(this, arguments);
                            });
                        });
                        return promise;
                    };
                // Wraps the layout.showContent and Layout.showInModal methods
                // This make sure that every time you try to show content in the
                // application the page will be enhanced by setting title, header, meta tags and banners
                Layout.showContent = _.wrap(Layout.showContent, show_content_wrapper);
                Layout.showInModal = _.wrap(Layout.showInModal, show_content_wrapper);
                Layout.on('renderEnhancedPageContent', function (view, content_zone) {
                    if (content_zone.contenttype === 'html') {
                        EnhancedViews.renderHTMLContent(view, content_zone);
                    } else if (content_zone.contenttype === 'merchandising') {
                        EnhancedViews.previousPlaceholders.push(content_zone.target);
                    }
                });
                Application.on('afterModulesLoaded', function () {
                    var query = '';
                    _.each(DataModels.Urls.Collection.getInstance().landingPages, function (landing_page) {
                        query = landing_page.get('query')[0] === '/' ? landing_page.get('query').substring(1) : landing_page.get('query');
                        LandingPagesRouter.prototype.routes[query + '?*options'] = 'displayLandingPage';
                        LandingPagesRouter.prototype.routes[query] = 'displayLandingPage';
                    });
                    return new LandingPagesRouter(Application);
                });
                Application.on('afterStart', function () {
                    // Every time the URL changes we call the DataModels.loadPage,
                    // so if we need to load content from the server, the request starts as soon as possible,
                    // Probably while other Ajax request are being made
                    Backbone.history && Backbone.history.on('all', function () {
                        DataModels.loadPage('/' + Backbone.history.fragment);
                    });
                    // After the application Starts we will do the same, since the URL have not changed yet
                    Backbone.history && DataModels.loadPage('/' + Backbone.history.fragment);
                });
            }
        }
    };
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Address
define('Address.List.View', [
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'SC.Configuration',
    'Address.Details.View',
    'GlobalViews.Confirmation.View',
    'address_list.tpl',
    'backbone_collection_view_cell.tpl',
    'backbone_collection_view_row.tpl',
    'Backbone',
    'underscore',
    'jQuery',
    'Utils'
], function (BackboneCompositeView, BackboneCollectionView, Configuration, AddressDetailsView, GlobalViewsConfirmationView, address_list_tpl, backbone_collection_view_cell_tpl, backbone_collection_view_row_tpl, Backbone, _, jQuery) {
    'use strict';
    //@class Address.List.View List profile's addresses @extend Backbone.View
    return Backbone.View.extend({
        template: address_list_tpl,
        page_header: _('Address Book').translate(),
        title: _('Address Book').translate(),
        attributes: { 'class': 'AddressListView' },
        events: { 'click [data-action="remove"]': 'removeAddress' },
        initialize: function () {
            BackboneCompositeView.add(this);
            var self = this;
            this.collection.on('reset sync add remove change destroy', function () {
                self.collection.sort();
                self.render();
            });
        },
        childViews: {
            'Addresses.Collection': function () {
                return new BackboneCollectionView({
                    childView: AddressDetailsView,
                    collection: this.collection,
                    viewsPerRow: Configuration.get('itemsPerRow', 2),
                    cellTemplate: backbone_collection_view_cell_tpl,
                    rowTemplate: backbone_collection_view_row_tpl
                });
            }
        }    //@method getSelectedMenu
,
        getSelectedMenu: function () {
            return 'addressbook';
        }    //@method getBreadcrumbPages
,
        getBreadcrumbPages: function () {
            return {
                text: this.title,
                href: '/addressbook'
            };
        }    // remove address
,
        removeAddress: function (e) {
            e.preventDefault();
            var deleteConfirmationView = new GlobalViewsConfirmationView({
                callBack: this.removeAddressModel,
                callBackParameters: {
                    context: this,
                    addressId: jQuery(e.target).data('id')
                },
                title: _('Remove Address').translate(),
                body: _('Are you sure you want to delete this address?').translate(),
                autohide: true
            });
            this.options.application.getLayout().showInModal(deleteConfirmationView);
        },
        removeAddressModel: function (options) {
            options.context.collection.get(options.addressId).destroy({ wait: true });
        }    //@method getContext @return {Address.List.View.Context}
,
        getContext: function () {
            //@class Address.List.View.Context
            return {
                //@property {String} pageHeader
                pageHeader: this.page_header,
                isAddressCollectionLengthGreaterThan0: this.collection.length > 0    //@property {Boolean} showBackToAccount
,
                showBackToAccount: Configuration.get('siteSettings.sitetype') === 'STANDARD'
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Address
define('Address.Router', [
    'Address.Edit.View',
    'Address.List.View',
    'Address.Model',
    'Profile.Model',
    'Backbone'
], function (AddressEditView, AddressListView, Model, ProfileModel, Backbone) {
    'use strict';
    //@class Address.Router @extend Backbone.Router
    return Backbone.Router.extend({
        routes: {
            'addressbook': 'addressBook',
            'addressbook/new': 'newAddress',
            'addressbook/:id': 'addressDetailed'
        },
        initialize: function (application) {
            this.application = application;
            this.profileModel = ProfileModel.getInstance();
        }    // list profile's addresses
,
        addressBook: function () {
            if (this.profileModel.get('isLoggedIn') !== 'T') {
                return this.application.getLayout().notFound();
            }
            var collection = this.profileModel.get('addresses');
            if (collection.length) {
                var view = new AddressListView({
                    application: this.application,
                    collection: collection
                });
                collection.off(null, null, this);
                collection.on('reset destroy change add', function () {
                    var currentView = this.application.getLayout().currentView;
                    if (currentView instanceof AddressListView || currentView instanceof AddressEditView) {
                        this.addressBook();
                    }
                }, this);
                view.showContent();
            } else {
                Backbone.history.navigate('#addressbook/new', { trigger: true });
            }
        }    // view address's details
,
        addressDetailed: function (id) {
            if (this.profileModel.get('isLoggedIn') !== 'T') {
                return this.application.getLayout().notFound();
            }
            var collection = this.profileModel.get('addresses'), model = collection.get(id), view = new AddressEditView({
                    application: this.application,
                    collection: collection,
                    model: model
                });
            view.model.on('reset destroy add', function () {
                if (view.inModal && view.$containerModal) {
                    view.$containerModal.modal('hide');
                    view.destroy();
                } else {
                    Backbone.history.navigate('#addressbook', { trigger: true });
                }
            }, view);
            view.showContent();
        }    // add new address
,
        newAddress: function () {
            if (this.profileModel.get('isLoggedIn') !== 'T') {
                return this.application.getLayout().notFound();
            }
            var collection = this.profileModel.get('addresses'), view = new AddressEditView({
                    application: this.application,
                    collection: collection,
                    model: new Model()
                });
            collection.on('add', function () {
                if (view.inModal && view.$containerModal) {
                    view.$containerModal.modal('hide');
                    view.destroy();
                } else {
                    Backbone.history.navigate('#addressbook', { trigger: true });
                }
            }, view);
            view.model.on('change', function (model) {
                collection.add(model);
            }, this);
            view.showContent();
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// Address.js
// -----------------
// Defines the Address  module (Model, Collection, Views, Router)
define('Address', [
    'Address.Router',
    'underscore',
    'Utils'
], function (Router, _) {
    'use strict';
    return {
        MenuItems: {
            parent: 'settings',
            id: 'addressbook',
            name: _('Address Book').translate(),
            url: 'addressbook',
            index: 3
        },
        mountToApp: function (application) {
            // Initializes the router
            return new Router(application);
        }
    };
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Wizard
define('Wizard.Step', [
    'Backbone',
    'underscore',
    'jQuery',
    'wizard_step.tpl',
    'GlobalViews.Message.View',
    'PluginContainer',
    'Backbone.CompositeView',
    'Utils'
], function (Backbone, _, jQuery, wizard_step_tpl, GlobalViewsMessageView, PluginContainer, BackboneCompositeView) {
    'use strict';
    // @class Wizard.Step Step View, Renders all the components of the Step @extends {Backbone.View}
    return Backbone.View.extend({
        template: wizard_step_tpl    // @property {String} continueButtonLabel default label for the "continue" button, this is overridden in the configuration file
,
        continueButtonLabel: _('Continue').translate()    // @property {Boolean} hideBackButton by default the back button is shown, this is overridden in the configuration file
,
        hideBackButton: false    // @property {String} bottomMessage
,
        bottomMessage: null    // @property {String} bottomMessageClass
,
        bottomMessageClass: ''    // @property {Array<Wizard.Module>} modules Will be extended with the modules to be instantiated
,
        modules: []    // @method getContinueButtonLabel @returns {String}
,
        getContinueButtonLabel: function () {
            var current_step = this.wizard.getCurrentStep(), label = this.continueButtonLabel;
            if (current_step) {
                if (this.changedContinueButtonLabel) {
                    label = _.isFunction(this.changedContinueButtonLabel) ? this.changedContinueButtonLabel() : this.changedContinueButtonLabel;
                } else if (this.continueButtonLabel) {
                    label = _.isFunction(this.continueButtonLabel) ? this.continueButtonLabel() : this.continueButtonLabel;
                }
            }
            return label;
        },
        afterModuleInstanceCreated: new PluginContainer()    // @method initialize initializes some variables and Instantiates all the modules
,
        initialize: function (options) {
            this.wizard = options.wizard;
            this.stepGroup = options.stepGroup;
            this.step_url = options.step_url;
            this.moduleInstances = [];
            BackboneCompositeView.add(this);
            // This is used to know when to execute the events
            this.renderPromise = jQuery.Deferred().resolve();
            var self = this;
            _.each(this.modules, function (ModuleClass) {
                self.addModule(ModuleClass);
            });
        },
        addModule: function addModule(ModuleClass) {
            var self = this, module_options = {};
            if (_.isArray(ModuleClass)) {
                module_options = ModuleClass[1] || {};
                ModuleClass = ModuleClass[0];
            }
            if (typeof ModuleClass === 'undefined') {
                return;
            } else if (typeof ModuleClass === 'string') {
                ModuleClass = require(ModuleClass);
            }
            var module_index = module_options.module_index;
            var module_instance = new ModuleClass(_.extend({
                wizard: self.wizard,
                step: self,
                stepGroup: self.stepGroup
            }, module_options));
            // add listeners to some events available to the modules
            module_instance.on({
                ready: function (is_ready) {
                    self.moduleReady(this, is_ready);
                },
                navbar_toggle: function (toggle) {
                    self.moduleNavbarToggle(this, toggle);
                },
                change_enable_continue: function (enable, options) {
                    var selected_options = _.extend({ onlyContinue: false }, options);
                    enable ? self.enableNavButtons(selected_options) : self.disableNavButtons(selected_options);
                },
                change_visible_back: function (visible) {
                    self.changeVisibleNavButtons({
                        backBtn: true,
                        visible: visible
                    });
                },
                update_step_name: function () {
                    self.$('[data-type="wizard-step-name-container"]').text(self.getName());
                },
                change_label_continue: function (label) {
                    self.changeLabelContinue(label);
                },
                error: function (error) {
                    self.moduleError(this, error);
                }
            });
            // attach wizard events to error handling
            _.each(module_instance.errors, function (errorId) {
                self.wizard.handledErrors.push(errorId);
                self.wizard.on(errorId, function (error) {
                    module_instance.manageError(error);
                });
            });
            if (module_instance.modules) {
                _.each(module_instance.modules, function (submodule) {
                    _.each(submodule.instance.errors, function (errorId) {
                        self.wizard.handledErrors.push(errorId);
                        self.wizard.on(errorId, function (error) {
                            submodule.instance.manageError(error);
                        });
                    });
                });
            }
            self.afterModuleInstanceCreated.executeAll(module_instance);
            // ModuleClass is expected to be a View
            module_index = _.isNumber(module_index) ? module_index : self.moduleInstances.length;
            self.moduleInstances.splice(module_index, 0, module_instance);
        }    // @method removeReadyFromModules When a step gets in the pass it is requested to set all its module instances
             // to false, so if the step get to be present again (back and forward) dot get skipped
,
        removeReadyFromModules: function () {
            _.each(this.moduleInstances, function (module_instance) {
                module_instance.isReady = false;
            });
        }    // @method moduleReady when a module is ready triggers this
             // if all the modules in the step are ready, and the advance conditions are met, the step submits itself
,
        moduleReady: function (module, ready) {
            var self = this;
            // submit the step if changed the state of isReady and step is in the present.
            if (module.isReady !== ready) {
                module.isReady = ready;
                if (self.stepAdvance() && self.state === 'present') {
                    this.renderPromise.done(function () {
                        self.submit();
                    });
                }
            }
        }    // @method moduleError @param {Wizard.Module} module @param {Wizard.Module.Error} error
,
        moduleError: function (module, error) {
            // if the error doesn't come from a module, and this step is being shown, display the error
            if (!module && this.state !== 'future') {
                this.error = error;
                if (this === this.wizard.getCurrentStep()) {
                    this.showError();
                }
            }
        }    // @method hasErrors  @return {Boolean}
,
        hasErrors: function () {
            return this.error || _.some(this.moduleInstances, function (module) {
                return module.error;
            });
        }    // @method  showError
,
        showError: function () {
            if (this.error) {
                var global_view_message = new GlobalViewsMessageView({
                    message: this.wizard.processErrorMessage(this.error.errorMessage),
                    type: 'error',
                    closable: true
                });
                this.$('[data-type="alert-placeholder-step"]').html(global_view_message.render().$el.html());
                jQuery('body').animate({ scrollTop: jQuery('body .global-views-message-error:first').offset().top }, 600);
                this.error = null;
            }
        }    // @method stepAdvance auxiliary function to determine if we have to advance to the next step.
,
        stepAdvance: function () {
            return this.areAllModulesReady() && this.isStepReady();
        }    // @method areAllModulesReady  @return {Boolean}
,
        areAllModulesReady: function () {
            var ready_state_array = _(this.moduleInstances).chain().pluck('isReady').uniq().value(), url_options = _.parseUrlOptions(Backbone.history.location.hash);
            return !url_options.force && ready_state_array.length === 1 && ready_state_array[0] === true;
        }    // @method isStepReady method to be overwritten to put custom logic to determine if a step is ready to be skipped @return {Boolean}
,
        isStepReady: function () {
            return false;
        }    // @method moduleNavbarToggle when a module doesn't need the navigation bar triggers this
             // if no modules in the step needs it, the step hide the navigation buttons
             // @param {Wizard.Module} module @param {Boolean} toggle
,
        moduleNavbarToggle: function (module, toggle) {
            var self = this;
            this.renderPromise.done(function () {
                module.navigationToggle = toggle;
                var toggle_state_array = _(self.moduleInstances).chain().pluck('navigationToggle').uniq().value();
                if (toggle_state_array.length === 1 && toggle_state_array[0] === false) {
                    self.$('.step-navigation-buttons').hide();
                } else {
                    self.$('.step-navigation-buttons').show();
                }
            });
        }    // @method tellModules communicate the status of the step to it's modules (past, present, future) @param {String} what
,
        tellModules: function (what) {
            _.each(this.moduleInstances, function (module_instance) {
                _.isFunction(module_instance[what]) && module_instance[what]();
                module_instance.state = what;
            });
        }    // @method past
             // Will be called ever time a step is going to be rendered and this step is previous in the step order
,
        past: function () {
            this.validate();
        }    // @method present
             // Will be called ever time a step is going to be rendered and this is the step
,
        present: jQuery.noop,
        future: function () {
            // cleanup future errors
            this.error = null;
            _.each(this.moduleInstances, function (module_instance) {
                module_instance.error = null;
            });
        }    // @method render overrides the render function to not only render itself
             // but also call the render function of its modules
,
        render: function () {
            var self = this;
            this.removeReadyFromModules();
            this.renderPromise = jQuery.Deferred();
            this.currentModelState = JSON.stringify(this.wizard.model);
            // Renders itself
            this._render();
            var content_element = this.$('#wizard-step-content');
            // Empties the modules container
            content_element.empty();
            var containers = [];
            // Then Renders the all the modules and append them into the container
            _.each(this.moduleInstances, function (module_instance) {
                module_instance.attributes = module_instance.attributes || {};
                module_instance.attributes['data-root-component-id'] = self.attributes['data-root-component-id'];
                module_instance.isReady = false;
                module_instance.render();
                var content = content_element, container = module_instance.options.container;
                if (container) {
                    var added = false;
                    if (!containers[container]) {
                        containers[container] = true;
                        added = true;
                    }
                    var content_temp = self.$(container);
                    if (content_temp.length) {
                        if (added) {
                            content_temp.empty();
                        }
                        content = content_temp;
                    }
                }
                content.append(module_instance.$el);
            });
            this.wizard.application.getLayout().once('afterAppendView', function () {
                self.renderPromise.resolve();
            });
            this.showError();
            return this;
        },
        _previousStep: function _previousStep(e) {
            // Disables the navigation Buttons
            e && this.disableNavButtons();
            // Calls the submit method of the modules and collects errors they may have
            var promises = [];
            _.each(this.moduleInstances, function (module_instance) {
                promises.push(module_instance.cancel());
            });
            var self = this;
            return jQuery.when.apply(jQuery, promises).then(// Success Callback
            jQuery.noop, function (error) {
                if (error) {
                    self.wizard.manageError(error, self);
                    e && self.enableNavButtons();
                }
            });
        }    // @method previousStep Goes to the previous step. Calls the cancel of each module
             // and asks the wizard to go to the previous step
,
        previousStep: function previousStep(e) {
            var self = this;
            return this._previousStep(e).done(function () {
                self.wizard.goToPreviousStep();
            });
        }    // @method submitErrorHandler @param {Wizard.Module.Error} error
,
        submitErrorHandler: function (error) {
            this.enableNavButtons();
            this.wizard.manageError(error, this);
            _.each(this.moduleInstances, function (module_instance) {
                module_instance.enableInterface();
            });
        },
        _submit: function _submit(e) {
            // Disables the navigation Buttons
            e && this.disableNavButtons();
            // Calls the submit method of the modules and collects errors they may have
            var promises = [];
            _.each(this.moduleInstances, function (module_instance) {
                if (module_instance.isActive()) {
                    promises.push(module_instance.submit(e));
                    module_instance.disableInterface();
                }
            });
            var self = this;
            return jQuery.when.apply(jQuery, promises).then(// Success Callback
            function () {
                //NOTE: Here the order between then and always have changed, because when certain module wanted to disable nav buttons this always re-enable them!
                //Validate this change!
                return self.save().always(function () {
                    self.enableNavButtons();
                }).fail(function (error) {
                    self.submitErrorHandler(error);
                });
            }    // Error Callback
, function (error) {
                self.submitErrorHandler(error);
                return error;
            });
        }    // @method submit Calls the submit method of each module. Calls our save function
             // and asks the wizard to go to the next step
,
        submit: function (e) {
            var self = this;
            return this._submit(e).done(function () {
                self.wizard.goToNextStep();
            });
        }    //@method showStep Each time a next step is going to be rendered, it is asked if the step should be shown or not. In this way an entire step can be skipped
             //@returns {Boolean}
,
        showStep: function () {
            return this.isActive() && _.some(_.filter(this.moduleInstances, function (module_to_filter) {
                return !module_to_filter.options.exclude_on_skip_step;
            }), function (module_instance) {
                return module_instance.isActive();
            });
        }    // @method isActive @returns {Boolean}
,
        isActive: function () {
            return true;
        }    // @method changeLabelContinue Change the label of the 'continue' button.
             // @param {String} label
,
        changeLabelContinue: function (label) {
            var new_label = label || (_.isFunction(this.continueButtonLabel) ? this.continueButtonLabel() : this.continueButtonLabel);
            this._executeAfterRender(function () {
                this.wizard.application.getLayout().$('[data-action="submit-step"]').html(new_label);
            }, this);
            this.changedContinueButtonLabel = new_label;
        }    // @method _save If there is a model calls the save function of it.
             // other ways it returns a resolved promise, to return something standard
             // @returns {jQuery.Deferred}
,
        _save: function () {
            if (this.wizard.model && this.currentModelState !== JSON.stringify(this.wizard.model)) {
                return this.wizard.model.save().fail(function (jqXhr) {
                    jqXhr.preventDefault = true;
                });
            } else {
                return jQuery.Deferred().resolveWith(this);
            }
        }    // @method save The overridable save() method. Internally calls _.save()
             // @returns {jQuery.Deferred}
,
        save: function () {
            return this._save();
        }    // @method validate calls validation on all modules and call the error manager
,
        validate: function () {
            var promises = [];
            _.each(this.moduleInstances, function (module_instance) {
                promises.push(module_instance.isValid());
            });
            var self = this;
            jQuery.when.apply(jQuery, promises).fail(// Error Callback
            function (error) {
                self.wizard.manageError(error, self);
            });
        }    // @method disableNavButtons Disables the navigation buttons
             // @param {onlyContinue:Booelan} options
,
        disableNavButtons: function (options) {
            this._executeAfterRender(function () {
                var selector = '[data-action="edit-module"], [data-type="edit-module"], ';
                if (!options || !options.onlyContinue) {
                    selector += '[data-action="previous-step"], ';
                }
                selector += ' [data-action="submit-step"]';
                this.wizard.application.getLayout().$(selector).attr('disabled', true);
            }, this);
        }    // @method changeVisibleNavButtons Show or hide the specified navigation button @param {continueBtn: Boolean, backBtn: Boolean, visible: Boolean} options
,
        changeVisibleNavButtons: function (options) {
            this._executeAfterRender(function () {
                var selector = '';
                if (options.continueBtn) {
                    selector = (selector ? ', ' : '') + '[data-action="edit-module"]';
                }
                if (options.backBtn) {
                    selector += (selector ? ', ' : '') + '[data-action="previous-step"]';
                }
                this.wizard.application.getLayout().$(selector).css('display', options.visible ? 'block' : 'none');
            }, this);
        }    // @method enableNavButtons
             // @param {onlyContinue: Boolean, notDisableTouchs: Boolean, notDisableBreads: Boolean} options
,
        enableNavButtons: function (options) {
            this._executeAfterRender(function () {
                var selector = '[data-action="edit-module"], ';
                if (!options || !options.onlyContinue) {
                    selector += '[data-action="previous-step"], ';
                }
                if (!options || !options.notDisableTouchs) {
                    selector += '[data-touchpoint], ';
                }
                if (!options || !options.notDisableBreads) {
                    selector += '.breadcrumb a, .wizard-step-link a, ';
                }
                selector += ' [data-action="submit-step"]';
                this.wizard.application.getLayout().$(selector).attr('disabled', false);
            }, this);
        }    // @method _executeAfterRender @param {Function} fn @param {Any} ctx
,
        _executeAfterRender: function (fn, ctx) {
            if (this.renderPromise.state() !== 'resolved') {
                this.renderPromise.done(_.bind(fn, ctx));
            } else {
                _.bind(fn, ctx)();
            }
        }    // @method getName @return {String}
,
        getName: function () {
            return this.name;
        }    // @method getContext @return {Wizard.Step.Context}
,
        getContext: function () {
            // @class Wizard.Step.Context
            return {
                // @property {Boolean} showTitle
                showTitle: !!this.getName()    // @property {String} title
,
                title: this.getName()    // @property {Boolean} showContinueButton
,
                showContinueButton: !this.hideContinueButton,
                continueButtonLabel: this.getContinueButtonLabel() || ''    // @property {Boolean} showSecondContinueButtonOnPhone
,
                showSecondContinueButtonOnPhone: !!this.hideSecondContinueButtonOnPhone,
                showBackButton: !(this.hideBackButton || this.wizard.isCurrentStepFirst())    // @property {Boolean} showBottomMessage
,
                showBottomMessage: !!this.bottomMessage,
                bottomMessage: this.bottomMessage || ''    // @property {String} bottomMessageClass
,
                bottomMessageClass: this.bottomMessageClass || ''
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('CustomFields', [
    'Wizard.Step',
    'Backbone',
    'underscore',
    'jQuery'
], function (WizardStep, Backbone, _, jQuery) {
    'use strict';
    // jshint validthis: true
    return {
        mountToApp: function () {
            //update in the model the changed custom field
            function updateOption(event) {
                var options = _.clone(this.model.get('options'));
                var optionName = event.target.name;
                //support checkbox type of backend
                if (event.target.type === 'checkbox') {
                    if (this.model.__customFieldsMetadata[optionName].type === 'checkbox') {
                        options[optionName] = event.target.checked ? 'T' : '';
                    } else {
                        options[optionName] = event.target.checked ? event.target.value : '';
                    }
                } else {
                    options[optionName] = jQuery(event.target).val();
                }
                this.model.set('options', options);
            }
            WizardStep.prototype.afterModuleInstanceCreated.install({
                name: 'custom-fields-wizard-step-module-instance-created',
                execute: function (moduleInstance) {
                    //Add the model of the wizard to the context of all the modules to support transaction body fields
                    var originalGetContextFunction = moduleInstance.getContext;
                    moduleInstance.getContext = function () {
                        var context = originalGetContextFunction.apply(moduleInstance, arguments);
                        if (!context.model) {
                            context.model = moduleInstance.model;
                        }
                        moduleInstance.events = moduleInstance.events || {};
                        _.each(context.model.get('options'), function (optionValue, optionKey) {
                            moduleInstance.events['change [name="' + optionKey + '"]'] = updateOption;
                        });
                        return context;
                    };
                }
            });
        }
    };
});


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Wizard
define('Wizard.StepNavigation.View', [
    'wizard_step_navigation.tpl',
    'Backbone',
    'underscore'
], function (wizard_step_navigation_tpl, Backbone, _) {
    'use strict';
    //@class Wizard.StepNavigation.View @extends Backbone.View
    return Backbone.View.extend({
        template: wizard_step_navigation_tpl    //@method getContext @return {Wizard.StepNavigation.View.Context}
,
        getContext: function () {
            var step_groups = [], errors_to_display = [], counter = 0;
            _(this.options.wizard.stepGroups).each(function (step_group) {
                if (step_group.showStepGroup()) {
                    //@class Wizard.StepNavigation.View.StepGroupData
                    var step_group_data = {
                            //@property {String} name
                            name: '. ' + step_group.name,
                            listItemClass: ''    //@property {String} linkUrl
,
                            linkUrl: ''    //@property {Number} counter
,
                            counter: 0
                        }, listItemClass = '', step_group_errors = step_group.getErrors();
                    if (step_group.state === 'present') {
                        listItemClass += ' wizard-step-navigation-active';
                    } else if (step_group.state === 'future') {
                        listItemClass += ' wizard-step-navigation-disabled';
                    }
                    if (step_group_errors && step_group_errors.length) {
                        listItemClass += ' wizard-step-navigation-error';
                    }
                    step_group_data.listItemClass = listItemClass;
                    step_group_data.linkUrl = step_group.state === 'future' ? Backbone.history.fragment : step_group.getURL() + '?force=true';
                    errors_to_display = _.uniq(_.union(errors_to_display, step_group_errors), function (item) {
                        return item.errorCode;
                    });
                    step_group_data.counter = ++counter;
                    step_groups.push(step_group_data);
                }
            });
            //@class Wizard.StepNavigation.View.Context
            return {
                //@property {Array<Wizard.StepNavigation.View.StepGroupData>} stepGroups
                stepGroups: step_groups    //@property {Array<String>} errors
,
                errors: errors_to_display    //@property {Boolean} showBackButton
,
                showBackButton: !this.options.wizard.isCurrentStepFirst()
            };    //@class Wizard.StepNavigation.View
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Wizard
define('Wizard.View', [
    'wizard.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'Wizard.StepNavigation.View'
], function (wizard_tpl, Backbone, BackboneCompositeView, WizardStepNavigationView) {
    'use strict';
    // @class Wizard.View  Frame component, Renders the steps @extends Backbone.View
    return Backbone.View.extend({
        template: wizard_tpl,
        attributes: {
            'id': 'wizard',
            'data-root-component-id': 'Wizard.View'
        },
        events: {
            'click [data-action="previous-step"]': 'previousStep',
            'click [data-action="submit-step"]': 'submit'
        },
        childViews: {
            'Wizard.StepNavigation': function () {
                return new WizardStepNavigationView({ wizard: this.wizard });
            }
        },
        initialize: function (options) {
            this.wizard = options.wizard;
            this.currentStep = options.currentStep;
            BackboneCompositeView.add(this);
        },
        render: function () {
            this.title = this.currentStep.getName();
            // Renders itself
            this._render();
            // Then Renders the current Step
            this.currentStep.attributes = this.currentStep.attributes || {};
            this.currentStep.attributes['data-root-component-id'] = this.attributes['data-root-component-id'];
            this.currentStep.render();
            // Then adds the step in the #wizard-content element of self
            this.$('#wizard-content').empty().append(this.currentStep.$el);
        }    // @method showError handle error messages on each step so we disable the global ErrorManagment
,
        showError: function (message) {
            this.wizard.manageError(message);
        }    // @method previousStep
,
        previousStep: function (e) {
            this.wizard.getCurrentStep().previousStep(e);
        }    // @method getHeaderView
,
        getHeaderView: function () {
            return this.wizard.getCurrentStep() && this.wizard.getCurrentStep().headerView;
        }    // @method getHeaderViewOptions
,
        getHeaderViewOptions: function () {
            return this.wizard.getCurrentStep() && this.wizard.getCurrentStep().headerViewOptions && this.wizard.getCurrentStep().headerViewOptions();
        }    // @method getFooterView
,
        getFooterView: function () {
            return this.wizard.getCurrentStep() && this.wizard.getCurrentStep().footerView;
        }    // @method getFooterViewOptions
,
        getFooterViewOptions: function () {
            return this.wizard.getCurrentStep() && this.wizard.getCurrentStep().footerViewOptions && this.wizard.getCurrentStep().footerViewOptions();
        },
        getPageDescription: function () {
            return 'checkout - ' + (Backbone.history.fragment || '').split('?')[0];    //remove parameters - we don't want a variable value for site-page
        }    //@method submit
,
        submit: function (e) {
            this.wizard.getCurrentStep().submit(e);
        }    // @method getContext @return {Wizard.View.Context}
,
        getContext: function () {
            // @class Wizard.View.Context
            return {
                // @property {Boolean} showBreadcrumb
                showBreadcrumb: !this.wizard.getCurrentStep().hideBreadcrumb
            };    // @class Wizard.View
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Wizard
define('Wizard.StepGroup', ['underscore'], function (_) {
    'use strict';
    //@class Wizard.StepGroup
    function StepGroup(name, url) {
        //@property {String} name
        this.name = name;
        //Don't use this property, use getURL instead
        this.url = '/' + url;
        //@property {Array<Wizard.Step>} steps Collection of steps
        this.steps = [];
        //@method hasErrors
        //@return {Boolean}
        this.hasErrors = function () {
            return _.some(this.steps, function (step) {
                return step.hasErrors();
            });
        };
        //@method getURL
        //@return {String}
        this.getURL = function () {
            var first_active_step = _.find(this.steps, function (step) {
                return step.showStep();
            });
            return first_active_step ? first_active_step.url : '';
        };
        //@method getErrors
        //@return {Array<Wizard.Error>}
        this.getErrors = function () {
            var errors = [];
            _.each(this.steps, function (step) {
                _.each(step.moduleInstances, function (module_instance) {
                    /* if (_.isArray(module_instance.error))
					{
						//This case happens when the module is a proxy that group all its submodule errors
						_.each(module_instance.error, function (an_error)
						{
							errors.push(an_error);
						});
					}
					else*/
                    if (_.isObject(module_instance.error)) {
                        errors.push(module_instance.error);
                    } else if (_.isString(module_instance.error)) {
                        errors.push({
                            errorCode: 'ERR_WS_UNHANDLED_ERROR',
                            errorMessage: module_instance.error
                        });
                    }
                });
            });
            return errors;
        };
        //@method showStepGroup
        //@return {Boolean}
        this.showStepGroup = function () {
            return _.some(this.steps, function (step) {
                return step.showStep();
            });
        };
    }
    return StepGroup;
});    //@class Wizard.Error
       //@property {String} errorCode
       //@property {String} errorMessage

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Wizard
define('Wizard.Router', [
    'Wizard.View',
    'Wizard.Step',
    'Wizard.StepGroup',
    'Profile.Model',
    'Backbone',
    'underscore',
    'jQuery',
    'Utils'
], function (View, Step, StepGroup, ProfileModel, Backbone, _, jQuery) {
    'use strict';
    // @class Wizard.Router Main component of the wizard, controls routes, the step flow, and to show each
    // step. In general, when something is referred as 'the wizard' is probably an instance of this class. @extend Backbone.Router
    return Backbone.Router.extend({
        //@property {Wizard.Step} step
        step: Step    //@property {Wizard.View} view
,
        view: View    //@property {Wizard.StepGoupd} StepGroup
,
        stepGroup: StepGroup    // @method initialize Initializes internals and loads configuration
                     // @param {ApplicationSkeleton} application @param {Object} options
,
        initialize: function (application, options) {
            // @property {ApplicationSkeleton} application
            this.application = application;
            // @property {Object<String,Wizard.Step>} steps dictionary of step instances by name
            this.steps = {};
            // @property {Array<String>} stepsOrder Array of step URLs
            this.stepsOrder = [];
            // @property {String} currentStep URL of the current Step
            this.currentStep = '';
            // @property {Object<String,Wizard.StepGroup>} stepGroups Dictionary of step group instances by its URLs
            this.stepGroups = {};
            // @property {Array} handledErrors
            this.handledErrors = [];
            this.options = options;
            if (options && options.model) {
                this.model = options.model;
            }
            if (options && options.steps) {
                this.compileConfiguration(options.steps);
            }
            // remove duplicates from the handledErrors array
            this.handledErrors = _.uniq(this.handledErrors);
        }    /*
		@method compileConfiguration
		Instantiates all the Steps and StepGroups based on the configuration.
		The Expected configuration is as follows:

			[
				{
					name: "Step Group"
				,	steps: [
						{
							name: "Step"
						,	url: "step-url"
						,	modules: [
								'Module.Name'
							]
						}
					]
				}
			]

		@param {Array} step_groups  This is an Array of Step Groups (Name and Steps), where Steps is an Array of Steps (Name, URL, Modules),
		where Modules is an Array of Strings that will be required(). In general this object is exactly the same as defined in the application's Configuration.js file
		*/,
        compileConfiguration: function (step_groups) {
            var self = this;
            // Iterates all the steps
            _.each(step_groups, function (step_group, index) {
                if (step_group.steps) {
                    // Instantiates the StepGroup
                    self._compileStepGroup(step_group, index).done(function (step_group_instance) {
                        // Iterates the step of the step group
                        _.each(step_group.steps, function (step) {
                            self._compileStep(step, step_group_instance);
                        });
                    });
                }
            });
        },
        _compileStep: function _compileStep(step, step_group_instance) {
            var deferred = jQuery.Deferred();
            try {
                var self = this;
                self.promise = self.promise || jQuery.Deferred().resolve();
                self.promise = self.promise.then(function () {
                    try {
                        var step_index = _.isNumber(step.step_index) ? step.step_index : self.stepsOrder.length;
                        delete step.step_index;
                        // Extends the base class with your configuration
                        var StepClass = self.step.extend(step);
                        // Initializes it
                        self.steps[step.url] = new StepClass({
                            wizard: self,
                            stepGroup: step_group_instance,
                            step_url: step.url
                        });
                        // add the step to the step-group
                        step_group_instance.steps.push(self.steps[step.url]);
                        // sets it in an ordered group
                        self.stepsOrder.splice(step_index, 0, step.url);
                        // Routes it
                        self.route(step.url, 'runStep');
                        self.route(step.url + '?:options', 'runStep');
                        deferred.resolve(self.steps[step.url]);
                    } catch (error) {
                        deferred.reject(error);
                    }
                }, function (error) {
                    deferred.reject(error);
                    return jQuery.Deferred().resolve();
                });
            } catch (error) {
                deferred.reject(error);
            }
            return deferred;
        },
        _compileStepGroup: function _compileStepGroup(step_group, index) {
            var deferred = jQuery.Deferred();
            try {
                var self = this, step_group_instance = new self.stepGroup(step_group.name, step_group.steps[0].url);
                var groups = _.values(self.stepGroups);
                groups.splice(index, 0, step_group_instance);
                _.each(groups, function (group, group_index) {
                    group.index = group_index;
                });
                self.stepGroups = _.indexBy(groups, 'name');
                deferred.resolve(step_group_instance);
            } catch (error) {
                deferred.reject(error);
            }
            return deferred;
        }    // @method getCurrentStep @return {Wizard.Step} the current step object
,
        getCurrentStep: function () {
            return this.steps[this.currentStep];
        }    // @method goToNextStep finds the next steps and navigates to it
,
        goToNextStep: function () {
            var next_step_url = this.getNextStepUrl(), url_options = _.parseUrlOptions(Backbone.history.location.hash);
            if (next_step_url) {
                this.navigate(url_options.force ? _.addParamsToUrl(next_step_url, { force: true }) : next_step_url, { trigger: false });
                this._runStep();
            }
        }    // @method getNextStepUrl @param {Number} index @return {String}
,
        getNextStepUrl: function (index) {
            index = index || _.indexOf(this.stepsOrder, this.currentStep);
            if (~index && index + 1 < this.stepsOrder.length) {
                if (this.steps[this.stepsOrder[index + 1]].showStep(this)) {
                    return this.stepsOrder[index + 1];
                }
                return this.getNextStepUrl(index + 1);
            }
        }    // @method getActiveStepsGroups @return {Array<Wizard.StepGroup>}
,
        getActiveStepsGroups: function () {
            return _(this.stepGroups).filter(function (step_group) {
                return step_group.showStepGroup();
            });
        }    // @method getFirstStepUrl @return {String}
,
        getFirstStepUrl: function () {
            var active_steps = this.getActiveStepsGroups();
            return active_steps[0] && active_steps[0].getURL();
        }    // @method goToPreviousStep finds the previous steps and navigates to it
,
        goToPreviousStep: function () {
            var previous_step_url = _.addParamsToUrl(this.getPreviousStepUrl(), { force: true });
            if (previous_step_url) {
                this.navigate(previous_step_url, { trigger: false });
                this._runStep();
            }
        }    // @method getPreviousStepUrl
             // @param {Number} index
             // @return {String}
,
        getPreviousStepUrl: function (index) {
            if (_.isUndefined(index)) {
                index = _.indexOf(this.stepsOrder, this.currentStep);
            }
            if (index > 0) {
                if (this.steps[this.stepsOrder[index - 1]].showStep(this)) {
                    return this.stepsOrder[index - 1];
                }
                return this.getPreviousStepUrl(index - 1);
            } else {
                var base_step = this.stepsOrder[0];
                if (this.steps[base_step].showStep(this)) {
                    return base_step;
                }
            }
        }    // @method getStepPosition Returns the distance of the current step from the start and to the end
             // If you are in the 2nd step of a 5 steps wizard it will return:
             // { fromBegining: 1, toLast: 3 }
             //@param {String} URL
             //@return {fromBegining:Number,toLast:Number}
,
        getStepPosition: function (url) {
            var index = _.indexOf(this.stepsOrder, url || this.currentStep), fromBegining = 0, toLast = 0, keys = _.keys(this.steps);
            for (var i = 0; i < keys.length; i++) {
                if (i < index && this.steps[keys[i]].showStep()) {
                    fromBegining++;
                } else if (i > index && this.steps[keys[i]].showStep()) {
                    toLast++;
                }
            }
            return {
                fromBegining: fromBegining,
                toLast: toLast
            };
        }    // @method isCurrentStepFirst
             // @return {Boolean}
,
        isCurrentStepFirst: function () {
            var current_step_index = _.indexOf(this.stepsOrder, this.currentStep);
            if (current_step_index > 0) {
                do {
                    if (this.steps[this.stepsOrder[--current_step_index]].showStep()) {
                        return false;
                    }
                } while (current_step_index);
            }
            return true;
        },
        _runStep: function _runStep() {
            this.runStep.apply(this, arguments);
        }    // @method runStep Executes the current step: Calls the status methods of the steps (past, present, future).
             // And renders the Frame view.
,
        runStep: function () {
            var url = Backbone.history.fragment, self = this;
            // We allow URLs to have options but they are still identified by the original string,
            // so we need to take them out if present
            url = url.split('?')[0];
            if (this.steps[url]) {
                var profile_model = ProfileModel.getInstance();
                if (this.application.getConfig('checkoutApp.skipLogin') && this.application.getConfig('siteSettings.registration.registrationoptional') === 'T' && profile_model.get('isRecognized') === 'F' || profile_model.get('isLoggedIn') === 'T') {
                    // We keep a reference to the current step URL here
                    this.currentStep = url;
                    // Iterates all the steps and calls the status methods
                    var method_to_call = 'past', current_group;
                    _.each(this.stepsOrder, function (step) {
                        if (step === url) {
                            self.steps[step].present();
                            self.steps[step].state = 'present';
                            self.steps[step].stepGroup.state = 'present';
                            self.steps[step].tellModules('present');
                            method_to_call = 'future';
                            current_group = self.steps[step].stepGroup;
                        } else {
                            self.steps[step].tellModules(method_to_call);
                            self.steps[step][method_to_call]();
                            self.steps[step].state = method_to_call;
                            // if the step is contained in the current_group we don't change the group state
                            if (self.steps[step].stepGroup !== current_group) {
                                self.steps[step].stepGroup.state = method_to_call;
                            }
                        }
                    });
                    // Creates an instance of the frame view and pass the current step
                    var view = new this.view({
                        model: this.model,
                        wizard: this,
                        currentStep: this.steps[url],
                        application: this.application
                    });
                    view.showContent();
                } else {
                    Backbone.history.navigate('login-register', { trigger: true });
                }
            }
        }    // @method processErrorMessage Fix errors message that contains anchors HTML to correctly point to URLs
             // that are not handle by the navigation helper
             // @param {String} error_message
             // @return {String}
,
        processErrorMessage: function (error_message) {
            var $error = jQuery('<div>').append(error_message);
            $error.find('a').attr('data-navigation', 'ignore-click');
            return $error.html();
        }    // @method manageError central hub for managing errors, the errors should be in the format:
             // ```{errorCode:'ERR_WS_SOME_ERROR', errorMessage:'Some message'}```.
             // The method also receives the step in case that the error is not handled by any module
,
        manageError: function (error, step) {
            if (_.isObject(error) && error.responseText) {
                error = JSON.parse(error.responseText);
            } else if (_.isString(error) || _.isNumber(error)) {
                error = {
                    errorCode: 'ERR_WS_UNHANDLED_ERROR',
                    errorMessage: error
                };
            } else if (!_.isObject(error)) {
                error = {
                    errorCode: 'ERR_WS_UNHANDLED_ERROR',
                    errorMessage: _('An error has occurred').translate()
                };
            }
            if (~_.indexOf(this.handledErrors, error.errorCode)) {
                this.trigger(error.errorCode, error);
            } else {
                // if the error is not handled but we receive a step we delegate the error to it
                if (step) {
                    step.moduleError(null, error);
                } else {
                    // if no one is listening for this error, we show the message on the current step
                    this.getCurrentStep().error = error;
                    this.getCurrentStep().showError();
                }
            }
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module OrderWizard
define('OrderWizard.Step', [
    'Wizard.Step',
    'order_wizard_step.tpl',
    'underscore',
    'Profile.Model',
    'Header.Simplified.View',
    'Footer.Simplified.View',
    'GlobalViews.Message.View',
    'jQuery',
    'SC.Configuration'
], function (WizardStep, order_wizard_step_tpl, _, ProfileModel, HeaderSimplifiedView, FooterSimplifiedView, GlobalViewsMessageView, jQuery, Configuration) {
    'use strict';
    //@class OrderWizard.Step Step View, Renders all the components of the Step @extends Wizard.Step
    return WizardStep.extend({
        //@property {Function} headerView
        headerView: !Configuration.get('useStandardHeaderFooter') ? HeaderSimplifiedView : false    //@property {Function} footerView
,
        footerView: !Configuration.get('useStandardHeaderFooter') ? FooterSimplifiedView : false    //@property {Function} template
,
        template: order_wizard_step_tpl    //@method stepAdvance
,
        stepAdvance: function () {
            if (this.areAllModulesReady()) {
                return this.isStepReady() || this.wizard.isPaypalComplete();
            }
            return false;
        }    //@method initialize
,
        initialize: function () {
            WizardStep.prototype.initialize.apply(this, arguments);
        },
        addModule: function addModule(module) {
            var self = this, args = arguments, order_wizard = this.wizard.orderWizardModel, event_data = {
                    step_group_name: self.stepGroup.name,
                    step_url: self.step_url,
                    module: _.isArray(module) ? module : [
                        module,
                        {}
                    ]
                };
            if (_.isFunction(event_data.module[0])) {
                event_data.module[1] = event_data.module[1] || {};
                event_data.module[1].module_id = event_data.module[0].prototype.template && event_data.module[0].prototype.template.Name;
            }
            return order_wizard.cancelableTrigger('before:OrderWizardStep.addModule', event_data).done(function () {
                WizardStep.prototype.addModule.apply(self, args);
                order_wizard.cancelableTrigger('after:OrderWizardStep.addModule', event_data);
            });
        },
        submit: function submit() {
            var self = this, args = arguments, order_wizard = this.wizard.orderWizardModel, next_step_url = this.wizard.getNextStepUrl();
            return order_wizard.cancelableTrigger('before:OrderWizardStep.submit', next_step_url).then(function () {
                return WizardStep.prototype.submit.apply(self, args);
            });
        },
        _submit: function _submit() {
            var self = this, args = arguments;
            return WizardStep.prototype._submit.apply(self, args).then(jQuery.noop, function fail(error) {
                return {
                    error: error,
                    step_url: self.step_url
                };
            });
        },
        previousStep: function previousStep() {
            var self = this, args = arguments, order_wizard = this.wizard.orderWizardModel, prev_step_url = this.wizard.getPreviousStepUrl();
            return order_wizard.cancelableTrigger('before:OrderWizardStep.previousStep', prev_step_url).then(function () {
                return WizardStep.prototype.previousStep.apply(self, args);
            });
        },
        _previousStep: function _previousStep() {
            var self = this, args = arguments;
            return WizardStep.prototype._previousStep.apply(self, args).then(jQuery.noop, function fail(error) {
                return {
                    error: error,
                    step_url: self.step_url
                };
            });
        }    //@method render
,
        render: function () {
            var layout = this.wizard.application.getLayout();
            this.profileModel = ProfileModel.getInstance();
            WizardStep.prototype.render.apply(this, arguments);
            if (this.wizard.isCurrentStepFirst() && // only in the first step
                this.profileModel.get('isLoggedIn') === 'F' && // only if the user doesn't already have a session
                this.wizard.application.getConfig('checkoutApp.skipLogin')) {
                var message = _('Checking out as a Guest. If you have an account, please <a href="login" data-toggle="show-in-modal" data-id="skip-login-modal">login</a> and enjoy a faster checkout experience.').translate(), global_view_message = new GlobalViewsMessageView({
                        message: message,
                        type: 'info',
                        closable: true
                    });
                this.$('[data-action="skip-login-message"]').empty().append(global_view_message.render().$el.html());
            }
            // Also trigger the afterRender event so the site search module can load the typeahead.
            layout.trigger('afterRender');
        }    //@method getContext @returns OrderWizard.Step.Context
,
        getContext: function () {
            //@class OrderWizard.Step.Context
            return {
                //@property {Boolean} showTitle
                showTitle: !!this.getName()    //@property {String} title
,
                title: this.getName()    //@property {Boolean} showContinueButton
,
                showContinueButton: !this.hideContinueButton,
                continueButtonLabel: this.getContinueButtonLabel() || ''    //@property {Boolean} showSecondContinueButtonOnPhone
,
                showSecondContinueButtonOnPhone: !!this.hideSecondContinueButtonOnPhone,
                showBackButton: !(this.hideBackButton || this.wizard.isCurrentStepFirst())    //@property {Boolean} showBottomMessage
,
                showBottomMessage: !!this.bottomMessage,
                bottomMessage: _.isFunction(this.bottomMessage) ? this.bottomMessage() : this.bottomMessage || ''    //@property {String} bottomMessageClass
,
                bottomMessageClass: _.isFunction(this.bottomMessageClass) ? this.bottomMessageClass() : this.bottomMessageClass || ''
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard.Module.PaymentMethod.ThreeDSecure
define('OrderWizard.Module.PaymentMethod.ThreeDSecure', [
    'Wizard.Module',
    'Transaction.Model',
    'order_wizard_paymentmethod_threedsecure_module.tpl',
    'underscore'
], function (WizardModule, TransactionModel, order_wizard_paymentmethod_threedsecure_module_tpl, _) {
    'use strict';
    return WizardModule.extend({
        //@property {Function} template
        template: order_wizard_paymentmethod_threedsecure_module_tpl    // @property {String} title
,
        title: _('Credit Card Authentication').translate()    // @method initialize
                                                       // @param {Object} options
,
        initialize: function (options) {
            this.application = options.application;
            this.deferred = options.deferred;
            WizardModule.prototype.initialize.apply(this, arguments);
        }    // @method render
             // @return {Backbone.View} result
,
        render: function () {
            var result = WizardModule.prototype.render.apply(this, arguments);
            return result;
        }    // @method showInModal
             // @param {Object} options
             // @return {jQuery.Deferred}
,
        showInModal: function (options) {
            var self = this;
            this.render();
            var promise = this.application.getLayout().showInModal(this, _.extend({
                keyboard: false,
                backdrop: 'static'
            }, options));
            promise.done(function () {
                self.listenForCallback();
            });
            this.on('modal-close', function () {
                this.model.fetch().done(function () {
                    self.model.set('internalid', 'cart');
                    self.wizard.getCurrentStep().enableNavButtons();
                });
            });
            return promise;
        }    // @method process3DSecure. Called from ssp 3D Secure file (threedsecure.ssp)
             // @param {Json} confirmation Order submit answer.
,
        process3DSecure: function (order_info) {
            if (order_info.confirmation && order_info.confirmation.confirmationnumber) {
                this.error = null;
                this.model.set(order_info);
                this.success();
            } else {
                this.fail();
                if (order_info && order_info.confirmation && order_info.confirmation.errorMessage) {
                    this.error = order_info.confirmation.errorMessage;
                    this.wizard.manageError(order_info.confirmation);
                    this.model.set('3dsecure_error', order_info.confirmation);
                    this.showInModal();
                }
            }
        }    // @method listenForCallback. Turns callback widely available, emptying it after use.
,
        listenForCallback: function () {
            var self = this;
            window.process3DSecure = function (data) {
                self.process3DSecure(data);
                window.process3DSecure = function () {
                };
            };
        }    // @method fail Called if confirmation coming from 3D Secure ssp file fails.
             // @return {jQuery.Deferred} Rejected promise.
,
        fail: function () {
            return this.deferred.reject();
        }    // @method success Called if confirmation coming from 3D Secure ssp file succeeded.
             // @return {jQuery.Deferred} Resolved promise.
,
        success: function () {
            this.$containerModal.modal('hide');
            return this.deferred.resolve();
        }    // @method getContext
             // @return {OrderWizard.Module.PaymentMethod.ThreeDSecure.Context}
,
        getContext: function () {
            return {
                threeDSecureError: this.model.get('3dsecure_error'),
                iframe: this.model.get('confirmation').get('paymentauthorization').servicehtml
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizard
define('OrderWizard.Router', [
    'Wizard.Router',
    'Session',
    'OrderWizard.Step',
    'LiveOrder.Model',
    'Profile.Model',
    'OrderWizard.Module.PaymentMethod.ThreeDSecure',
    'OrderWizard.Model',
    'underscore',
    'Backbone',
    'jQuery',
    'Utils'
], function (WizardRouter, Session, OrderWizardStep, LiveOrderModel, ProfileModel, OrderWizardThreeDSecure, OrderWizardModel, _, Backbone, jQuery) {
    'use strict';
    //@class OrderWizard.Router @extends Wizard.Router
    return WizardRouter.extend({
        //@property {OrderWizard.Step} step
        step: OrderWizardStep    //@method initialize
,
        initialize: function () {
            this.orderWizardModel = OrderWizardModel.getInstance();
            WizardRouter.prototype.initialize.apply(this, arguments);
            this.profileModel = ProfileModel.getInstance();
            var payment_methods = this.model.get('paymentmethods'), payment_method_credit_card = payment_methods.findWhere({ type: 'creditcard' }), credit_card = payment_method_credit_card && payment_method_credit_card.get('creditcard');
            // remove temporal credit card.
            if (credit_card && credit_card.internalid === '-temporal-') {
                payment_methods.remove(payment_method_credit_card);
            }
            if (this.application.getConfig('startCheckoutWizard') && !~_.indexOf(this.stepsOrder, '')) {
                this.route('', 'startWizard');
                this.route('?:options', 'startWizard');
            }
        }    //@method startWizard
,
        startWizard: function () {
            this.navigate(this.getFirstStepUrl(), {
                trigger: true,
                replace: true
            });
        },
        _compileStep: function _compileStep(step, step_group_instance) {
            var self = this, args = arguments, event_data = {
                    name: step.name,
                    url: step.url,
                    index: step.step_index,
                    group_name: step_group_instance.name
                };
            return this.orderWizardModel.cancelableTrigger('before:OrderWizardRouter.compileStep', event_data).then(function () {
                return WizardRouter.prototype._compileStep.apply(self, args).done(function () {
                    self.orderWizardModel.cancelableTrigger('after:OrderWizardRouter.compileStep', event_data);
                });
            });
        },
        _compileStepGroup: function _compileStepGroup(step_group, index) {
            var self = this, args = arguments, event_data = {
                    name: step_group.name,
                    url: step_group.steps[0].url,
                    index: index
                };
            return this.orderWizardModel.cancelableTrigger('before:OrderWizardRouter.compileStepGroup', event_data).then(function () {
                return WizardRouter.prototype._compileStepGroup.apply(self, args).done(function () {
                    self.orderWizardModel.cancelableTrigger('after:OrderWizardRouter.compileStepGroup', event_data);
                });
            });
        }    //@method hidePayment
,
        hidePayment: function () {
            return this.application.getConfig('siteSettings.checkout.hidepaymentpagewhennobalance') === 'T' && this.model.get('summary').total === 0;
        }    //@method isPaypal
,
        isPaypal: function () {
            var selected_paymentmethod = this.model.get('paymentmethods').findWhere({ primary: true });
            return selected_paymentmethod && selected_paymentmethod.get('type') === 'paypal';
        }    //@method isPaypalComplete
,
        isPaypalComplete: function () {
            var selected_paymentmethod = this.model.get('paymentmethods').findWhere({ primary: true });
            return selected_paymentmethod && selected_paymentmethod.get('type') === 'paypal' && selected_paymentmethod.get('complete');
        }    //@method isExternalCheckout
,
        isExternalCheckout: function () {
            var selected_paymentmethod = this.model.get('paymentmethods').findWhere({ primary: true });
            return selected_paymentmethod && !!~selected_paymentmethod.get('type').indexOf('external_checkout');
        },
        isMultiShipTo: function () {
            return this.model.get('ismultishipto');
        },
        isAutoPopulateEnabled: function () {
            var is_guest = this.profileModel.get('isGuest') === 'T';
            return this.application.getConfig('autoPopulateNameAndEmail') && (is_guest && this.application.getConfig('forms.loginAsGuest.showName') || !is_guest);
        }    //@method runStep
,
        runStep: function runStep(options) {
            var self = this, url = options ? Backbone.history.fragment.replace('?' + options, '') : Backbone.history.fragment;
            this.orderWizardModel.cancelableTrigger('before:OrderWizardRouter.runStep', url).done(function () {
                self._runStep(options);
            });
        },
        _runStep: function _runStep(options) {
            // Computes the position of the user in the flow
            var url = options ? Backbone.history.fragment.replace('?' + options, '') : Backbone.history.fragment, position = this.getStepPosition(url), content = '', page_header = '', last_order_id = _.parseUrlOptions(options).last_order_id;
            if (last_order_id && !this.model.get('confirmation').get('internalid')) {
                if (this.profileModel.get('isGuest') !== 'T') {
                    //checkout just finnished and user refreshed the doc.
                    page_header = _('Your Order has been placed').translate();
                    content = _('If you want to review your last order you can go to <a href="#" data-touchpoint="$(0)" data-hashtag="#/ordershistory/view/salesorder/$(1)">Your Account</a>. ').translate('customercenter', last_order_id) + _('Or you can continue Shopping on our <a href="/" data-touchpoint="home">Home Page</a>. ').translate();
                } else {
                    page_header = _('Your Shopping Cart is empty').translate();
                    content = _('Continue Shopping on our <a href="/" data-touchpoint="home">Home Page</a>. ').translate();
                }
                var layout = this.application.getLayout();
                return layout.internalError && layout.internalError(content, page_header, _('Checkout').translate());
            }
            // if you have already placed the order you can not be in any other step than the last
            if (this.model && this.model.get('confirmation') && (this.model.get('confirmation').get('confirmationnumber') || this.model.get('confirmation').get('tranid')) && position.toLast !== 0) {
                window.location = Session.get('touchpoints.home');
                return;
            }
            WizardRouter.prototype.runStep.apply(this, arguments);
            this.orderWizardModel.cancelableTrigger('after:OrderWizardRouter.runStep', url);
        }    // @method start3DSecure Start the process of 3D Secure CC payments.
             // @param {jQuery.Deferred} promise An error (ERR_WS_REQ_PAYMENT_AUTHORIZATION) is expected on 'done', and triggers the view display.
             // @returns {jQuery.Deferred}
,
        start3DSecure: function (promise) {
            var self = this, wrapper_deferred = new jQuery.Deferred();
            promise.done(function () {
                var confirmation = self.model.get('confirmation'), statuscode = confirmation.get('statuscode'), success = false;
                if (statuscode) {
                    if (statuscode === 'success') {
                        wrapper_deferred.resolveWith(this);
                        success = true;
                    } else if (statuscode === 'error') {
                        // Order is not success since payment authorization is required
                        if (confirmation.get('reasoncode') && confirmation.get('reasoncode') === 'ERR_WS_REQ_PAYMENT_AUTHORIZATION') {
                            if (confirmation.get('paymentauthorization')) {
                                var view = new OrderWizardThreeDSecure({
                                    layout: self.application.getLayout(),
                                    application: self.application,
                                    wizard: self,
                                    deferred: wrapper_deferred
                                });
                                view.showInModal();
                                success = true;
                            }
                        }
                    }
                }
                if (!success) {
                    wrapper_deferred.rejectWith(this);
                }
            }).fail(function () {
                wrapper_deferred.rejectWith(this);
            });
            return wrapper_deferred.promise();
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module OrderWizzard
define('OrderWizard', [
    'OrderWizard.Router',
    'LiveOrder.Model',
    'Profile.Model'
], function (OrderWizardRouter, LiveOrderModel, ProfileModel) {
    'use strict';
    return {
        mountToApp: function (application) {
            var order_wizard_router = new OrderWizardRouter(application, {
                model: LiveOrderModel.getInstance(),
                profile: ProfileModel.getInstance(),
                steps: application.getConfig('checkoutSteps')
            });
            var checkout_component = application.getComponent('Checkout');
            checkout_component._setOrderWizardRouter(order_wizard_router);
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// Categories.Utils.js
// -------------
// Utility Class for Categories
define('Categories.Utils', [
    'SC.Configuration',
    'underscore'
], function (Configuration, _) {
    'use strict';
    return {
        getAdditionalFields: function getAdditionalFields(source, config_path) {
            var additionalFields = {}, fields = Configuration.get(config_path, []);
            _.each(fields, function (field) {
                additionalFields[field] = source[field];
            });
            return additionalFields;
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// Categories.js
// -------------
// Utility Class to handle the Categories tree
define('Categories', [
    'Categories.Utils',
    'SC.Configuration',
    'underscore'
], function (CategoriesUtils, Configuration, _) {
    'use strict';
    return {
        topLevelCategories: [],
        makeNavigationTab: function (categories) {
            var result = [], self = this;
            _.each(categories, function (category) {
                var href = category.fullurl, tab = {
                        'href': href,
                        'text': category.name,
                        'data': {
                            hashtag: '#' + href,
                            touchpoint: 'home'
                        },
                        'class': 'header-menu-level' + category.level + '-anchor',
                        'data-type': 'commercecategory'
                    };
                tab.additionalFields = CategoriesUtils.getAdditionalFields(category, 'categories.menu.fields');
                if (category.categories) {
                    tab.categories = self.makeNavigationTab(category.categories);
                }
                result.push(tab);
            });
            return result;
        },
        addToNavigationTabs: function (categories) {
            if (Configuration.get('categories.addToNavigationTabs')) {
                var self = this, navigationData = Configuration.get('navigationData'), index = -1;
                // delete previews categories on the menu
                var lastIndex = navigationData.length;
                while (lastIndex--) {
                    if (navigationData[lastIndex]['data-type'] === 'commercecategory') {
                        navigationData.splice(lastIndex, 1);
                    }
                }
                for (var i = 0; i < navigationData.length; i++) {
                    if (navigationData[i].placeholder === 'Categories') {
                        index = i;
                        break;
                    }
                }
                if (index !== -1) {
                    var tabs = self.makeNavigationTab(categories);
                    // navigationData.splice(index, 1);
                    _.each(tabs, function (tab, position) {
                        navigationData.splice(index + position, 0, tab);
                    });
                }
                this.application.trigger('Configuration.navigationData');
            }
        },
        getTopLevelCategoriesUrlComponent: function () {
            return this.topLevelCategories;
        },
        mountToApp: function (application) {
            if (Configuration.get('categories')) {
                var self = this, categories = SC.CATEGORIES;
                //delete SC.CATEGORIES.categories;
                this.application = application;
                _.each(categories, function (category) {
                    self.topLevelCategories.push(category.fullurl);
                });
                this.addToNavigationTabs(categories);
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// ExternalPayment.js
// -------------------
define('ExternalPayment', [
    'ErrorManagement.InternalError.View',
    'underscore',
    'Utils'
], function (InternalErrorView, _) {
    'use strict';
    return {
        //@method mountToApp
        //@param {Object} application
        mountToApp: function (application) {
            if (SC.ENVIRONMENT.EXTERNALPAYMENT && SC.ENVIRONMENT.EXTERNALPAYMENT.parameters) {
                var params = SC.ENVIRONMENT.EXTERNALPAYMENT && SC.ENVIRONMENT.EXTERNALPAYMENT.parameters, external_fragment;
                if (!params.errorCode) {
                    switch (params.externalPayment) {
                    case 'DONE':
                        external_fragment = '#' + SC.CONFIGURATION.externalPayment[params.recordType.toUpperCase()].doneFragment;
                        break;
                    case 'FAIL':
                        external_fragment = '#' + SC.CONFIGURATION.externalPayment[params.recordType.toUpperCase()].failFragment;
                        break;
                    }
                    if (external_fragment) {
                        delete params.errorCode;
                        external_fragment = _.addParamsToUrl(external_fragment, params);
                        window.location.hash = external_fragment;
                    }
                } else if (params.errorCode) {
                    var self = this;
                    application.getLayout().once('afterAppendView', function () {
                        var view = new InternalErrorView({
                            application: application,
                            message: self.getErrorMessage(params.errorCode),
                            pageHeader: _('External Payment Error').translate(),
                            title: _('External Payment Error').translate()
                        });
                        view.showContent();
                    });
                }
            }
        }    //@method getErrorMessage
             //@param {String} error_code
,
        getErrorMessage: function (error_code) {
            var message;
            switch (error_code) {
            case 'externalPaymentValidationStatusFail':
                message = _('Invalid payment event.').translate();
                break;
            case 'externalPaymentRequestInvalidParameters':
                message = _('Invalid parameters.').translate();
                break;
            case 'externalPaymentMissingImplementation':
                message = _('Invalid external payment method implementation.').translate();
                break;
            case 'externalPaymentRecordValidationStatusFail':
                message = _('Invalid record status.').translate();
                break;
            default:
                message = _('Invalid error code.');
            }
            return message;
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module NavigationHelper
// NavigationHelper intersect all clicks on a elements and computes what to do, if navigate using backbone or navigate away
// support data-touchpoint for indicating a target touchpoint by name and data-keep-options for keeping current url options in the link.
define('NavigationHelper', [
    'Session',
    'PluginContainer',
    'underscore',
    'jQuery',
    'Utils'
], function (Session, PluginContainer, _, jQuery, Utils) {
    'use strict';
    // @class NavigationHelper uses different PluginContainer, each for handling different types of user events globally.
    // itself is a Plugin container where specific tasks (like handling data-touchpoint links or open links in new modals are implemented by specific plugins)
    // Basically each registered plugin will have the opportunity of performing some operation over the link's href attribute
    // @extends ApplicationModule
    var NavigationHelper = {
        mountToApp: function (application) {
            // @module ApplicationSkeleton @class ApplicationSkeleton.Layout
            var Layout = application.getLayout();
            _.extend(Layout, {
                //@method isTargetBlank Indicate if the target link of the event e is blank or not. IMPORTANT: This functions does NOT take into a account the button press
                //@param {jQuery.Event} e jQuery event
                //@returns {Boolean} result
                isTargetBlank: function (e) {
                    return e.ctrlKey || e.metaKey || jQuery(e.currentTarget).attr('target') === '_blank';
                }    //@method getUrl Returns the target URL of the clicked object from the navigation context
                     //@param {NavigationContext} context
                     //@return {String}
,
                getUrl: function (context) {
                    if (Utils.oldIE()) {
                        return context.target_data.href;
                    }
                    return context.target_href;
                }    //@method setUrl Set the URL to the jQuery element taking into account backward compatibility con old IE browsers
                     //@param {jQuery} $element
                     //@param {String} url
                     //@return {Void}
,
                setUrl: function ($element, url) {
                    $element.attr('href', url);
                    if (Utils.oldIE()) {
                        $element.data('href', url);
                    }
                }    //@method generateNavigationContext Generate the navigation context object
                     //@param {jQuery.Event} e jQuery event param
                     //@return {NavigationContext}
,
                generateNavigationContext: function (e) {
                    var $target = jQuery(e.currentTarget), touchpoints = Session.get('touchpoints'), target_data = $target.data(), target_touchpoint = (touchpoints ? touchpoints[target_data.touchpoint] : '') || '', hashtag = target_data.hashtag, target_href = $target.attr('href'), clean_hashtag = hashtag && hashtag.replace('#', '');
                    //@class NavigationContext
                    return {
                        //@property {Object} target_data An object where each property is one of the data attributes of the target element
                        target_data: target_data    //@property {String} target_href
,
                        target_href: target_href    //@property {String} target_touchpoint
,
                        target_touchpoint: target_touchpoint    //@property {String} original_touchpoint
,
                        original_touchpoint: target_data.touchpoint,
                        hashtag: hashtag    //@property {String} url
,
                        url: ''    //@property {String} clean_hashtag
,
                        clean_hashtag: clean_hashtag    //@property {jQuery} $target
,
                        $target: $target
                    };    //@class NavigationHelper
                }    /////////////////////////////////
                     //		PLUGINS DEFINITION
                     /////////////////////////////////
                     // @property {PluginContainer} touchStart plugin container that handles the global touch start event
,
                touchStart: new PluginContainer()    // @property {PluginContainer} touchMove plugin container that handles the global touch move event
,
                touchMove: new PluginContainer()    // @property {PluginContainer} mouseDown plugin container that handles the global mouseDown event
,
                mouseDown: new PluginContainer()    // @property {PluginContainer} click plugin container that handles the global click event
,
                click: new PluginContainer()    // @property {PluginContainer} touchEnd plugin container that handles the global touchEnd event
,
                touchEnd: new PluginContainer()    // @property {PluginContainer} mouseUp plugin container that handles the global mouseUp event
,
                mouseUp: new PluginContainer()    // @method executeTouchStart execute all touchStart plugins
                                         //@param {jQuery.Event} e
,
                executeTouchStart: function (e) {
                    this.touchStart.executeAll(e);
                }    // @method executeTouchStart execute all touchMove plugins
                     //@param {jQuery.Event} e
,
                executeTouchMove: function (e) {
                    this.touchMove.executeAll(e);
                }    // @method executeTouchStart execute all mouseUp plugins
                     //@param {jQuery.Event} e
,
                executeMouseUp: function (e) {
                    this.mouseUp.executeAll(e);
                }    // @method executeTouchStart execute all touchEnd plugins
                     //@param {jQuery.Event} e
,
                executeTouchEnd: function (e) {
                    this.touchEnd.executeAll(e);
                }    // @method executeTouchStart execute all mouseDown plugins
                     //@param {jQuery.Event} e
,
                executeMouseDown: function (e) {
                    this.mouseDown.executeAll(e);
                }    // @method executeTouchStart execute all click plugins
                     //@param {jQuery.Event} e
,
                executeClick: function (e) {
                    this.click.executeAll(e);
                }
            });
            // Adds event listeners to the layout
            _.extend(Layout.events, {
                // touchpoints, this needs to be before the other click event, so they are computed early
                'touchstart a:not([data-navigation="ignore-click"])': 'executeTouchStart',
                'mousedown a:not([data-navigation="ignore-click"])': 'executeMouseDown',
                'click a:not([data-navigation="ignore-click"])': 'executeClick',
                'mouseup a:not([data-navigation="ignore-click"])': 'executeMouseUp',
                'touchend a:not([data-navigation="ignore-click"])': 'executeTouchEnd',
                'touchmove a:not([data-navigation="ignore-click"])': 'executeTouchMove'
            });
            //Default Navigation Plugins
            Layout.touchMove.install({
                name: 'detectTouchMovement',
                priority: 10,
                execute: function (e) {
                    if (jQuery(e.currentTarget).data('touchpoint')) {
                        Layout.isTouchMoveEvent = true;
                    }
                    return e;
                }
            });
        }
    };
    return NavigationHelper;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module NavigationHelper
define('NavigationHelper.Plugins.Standard', [
    'underscore',
    'Backbone',
    'UrlHelper',
    'Utils'
], function (_, Backbone) {
    'use strict';
    // @class NavigationHelper.Plugins.Standard Contains the standard navigation helper behavior. @extends ApplicationModule
    var standardPlugins = {
        //@method isNOTURLHashtagPart Determines if the passed in string URL is intended to be used as a hashtag.
        //IMPORTANT: This function also evaluate Backbone.history.options.pushState.
        //@param {String} url
        //@return {Boolean}
        isNOTURLHashtagPart: function (url) {
            return Backbone.history.options.pushState || url === '#' || url.indexOf('http://') === 0 || url.indexOf('https://') === 0 || url.indexOf('mailto:') === 0 || url.indexOf('tel:') === 0;
        }    //@method correctURL Intercepts mousedown events on all anchors with no data-touchpoint attribute and fix its href attribute to work when opening a link
             //@param {ApplicationSkeleton.Layout} layout General application layout
             //@param {jQuery.Event} e jQuery event
             //@return {jQuery.Event} e
,
        correctURL: function (layout, e) {
            var context = layout.generateNavigationContext(e), window_obj = _.getWindow(), href = layout.getUrl(context) || '#';
            if (!context.target_data.touchpoint && !standardPlugins.isNOTURLHashtagPart(href)) {
                if (context.target_data.toggle === 'show-in-modal' || context.target_data.toggle === 'show-in-pusher') {
                    context.$target.data('original-href', href);
                    href = window_obj.location.href;
                } else if (window_obj.location.hash) {
                    href = window_obj.location.href.replace(/#.*$/, '#' + href);
                } else if (window_obj.location.href.lastIndexOf('#') === window_obj.location.href.length - 1) {
                    href = window_obj.location.href + href;
                } else {
                    href = window_obj.location.href + '#' + href;
                }
                layout.setUrl(context.$target, href);
            }
            return e;
        }    //@method clickNavigation Handle standard click navigation for the cases were the target is NOT a modal
             //@param {ApplicationSkeleton.Layout} layout General application layout
             //@param {jQuery.Event} e jQuery event
             //@return {jQuery.Event} e
,
        clickNavigation: function (layout, e) {
            e.preventDefault();
            // Grabs info from the event element
            var context = layout.generateNavigationContext(e), href = layout.getUrl(context) || '', target_is_blank = layout.isTargetBlank(e) || e.button === 1, target_is_modal_or_pusher = context.target_data.toggle === 'show-in-modal' || context.target_data.toggle === 'show-in-pusher' && _.isPhoneDevice(), is_disabled = context.$target.attr('disabled'), is_dropdown = context.target_data.toggle === 'dropdown', is_external;
            if (is_disabled) {
                e.stopPropagation();
                return e;
            }
            if (context.target_data.originalHref && !target_is_blank) {
                href = context.target_data.originalHref;
            }
            // Pusher fix
            layout.$el.removeClass('sc-pushing');
            if (href === '#' || href === '' || is_dropdown) {
                return e;
            }
            // The navigation is within the same browser window
            if (!target_is_blank) {
                // There is a modal open
                if (layout.$containerModal) {
                    layout.$containerModal.modal('hide');
                }
                //Wants to open this link in a modal or pusher
                if (!target_is_modal_or_pusher) {
                    is_external = ~href.indexOf('http:') || ~href.indexOf('https:') || ~href.indexOf('mailto:') || ~href.indexOf('tel:');
                    if (is_external) {
                        _.getWindow().document.location.href = href;
                    } else {
                        Backbone.history.navigate(href, { trigger: true });
                    }
                }
            } else {
                _.getWindow().open(href, _.uniqueId('window'));
            }
            return e;
        }    //@method mountToApp
             //@param {ApplicationSkeleton} application
,
        mountToApp: function (application) {
            var layout = application.getLayout();
            //Install Standard Navigation Plugins
            layout.mouseDown.install({
                name: 'mouseDownFixHref',
                priority: 10,
                execute: function (e) {
                    return standardPlugins.correctURL(layout, e);
                }
            });
            layout.touchStart.install({
                name: 'touchStartFixHref',
                priority: 10,
                execute: function (e) {
                    return standardPlugins.correctURL(layout, e);
                }
            });
            layout.click.install({
                name: 'standardNavigation',
                priority: 20,
                execute: function (e) {
                    return standardPlugins.clickNavigation(layout, e);
                }
            });
        }
    };
    return standardPlugins;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module NavigationHelper
define('NavigationHelper.Plugins.DataTouchPoint', [
    'Tracker',
    'Session',
    'underscore',
    'Backbone',
    'Utils',
    'UrlHelper'
], function (Tracker, Session, _, Backbone, Utils) {
    'use strict';
    // @class NavigationHelper.Plugins.DataTouchPoint Contains the plugins that implement the touchpoints link behavior.
    // This is a link like ```<a data-touchpoint="home" data-hashtag="search">Shop</a>``` will always navigate to Shopping search page, no matter where it is defined.
    // @extends ApplicationModule
    var dataTouchPointPlugins = {
        //@method getLocaleHost @returns the host for the language specified
        //@param {String} locale locale to look for
        //@return {String} locale host
        getLocaleHost: function (locale) {
            var available_hosts = SC.ENVIRONMENT.availableHosts, target_host;
            if (available_hosts && available_hosts.length) {
                for (var i = 0; i < available_hosts.length; i++) {
                    var host = available_hosts[i], lang = _(host.languages).findWhere({ locale: locale });
                    if (lang && lang.host) {
                        target_host = lang.host;
                        break;
                    }
                }
            }
            return target_host;
        }    //@method preserveLanguage Given a URL, if not secure (not my account nor checkout), replace the host based on the current language
             //@param {NavigationContext} context
             //@return {NavigationContext}
,
        preserveLanguage: function (context) {
            var url = context.url;
            if (Utils.isShoppingDomain()) {
                var locale_host = dataTouchPointPlugins.getLocaleHost(SC.ENVIRONMENT.currentLanguage.locale);
                if (locale_host) {
                    url = url.replace(/(http:\/\/)([^\/?#]*)([^>]*)/gi, function (all, protocol, host, rest) {
                        return protocol + locale_host + rest;
                    });
                }
                if (/\?$/.test(url)) {
                    url = url.substring(0, url.length - 1);
                }
                context.url = url;
            } else {
                var current_language = SC.ENVIRONMENT.currentLanguage;
                if (current_language) {
                    context.target_data.parameters = context.target_data.parameters ? context.target_data.parameters + '&lang=' + current_language.locale : 'lang=' + current_language.locale;
                }
            }
            return context;
        }    //@method addParametersToTouchpoint Add data- parameters specified in the target element into the final target touchpoint
             //@param {NavigationContext} context
             //@return {NavigationContext}
,
        addParametersToUrl: function (context) {
            if (context.target_data.parameters) {
                context.url += (~context.url.indexOf('?') ? '&' : '?') + context.target_data.parameters;
            }
            return context;
        }    //@method addHashtagToTouchPoint Adds any hashtag from the context into the final target touchpoint
             //@param {NavigationContext} context
             //@return {NavigationContext}
,
        addHashtagToTouchPoint: function (context) {
            if (SC.ENVIRONMENT.siteSettings.sitetype === 'ADVANCED' && context.hashtag && context.hashtag !== '#' && context.hashtag !== '#/') {
                context.target_touchpoint += (~context.target_touchpoint.indexOf('?') ? '&' : '?') + 'fragment=' + context.clean_hashtag;
            }
            return context;
        }    //@method generateUrl Based on an already processed context it generate the final URL
             //@param {NavigationContext} context
             //@param {ApplicationSkeleton} application
             //@param {ApplicationSkeleton.Layout} layout
             //@return {NavigationContext}
,
        generateUrl: function (context, application, layout) {
            if (context.original_touchpoint === application.getConfig('currentTouchpoint')) {
                var prefix = '#';
                if (Backbone.history.options && Backbone.history.options.pushState) {
                    prefix = context.clean_hashtag.indexOf('/') === 0 ? '' : '/';
                }
                context.url = context.clean_hashtag ? prefix + context.clean_hashtag : layout.getUrl(context);
            } else {
                if (context.clean_hashtag && context.clean_hashtag.indexOf('http') !== -1) {
                    context.url = _.addParamsToUrl(context.clean_hashtag, _.parseUrlOptions(context.target_touchpoint));
                } else {
                    context.url = _.fixUrl(context.target_touchpoint);
                    // We need to make this url absolute in order for this to navigate
                    // instead of being triggered as a hash
                    if (context.url && !(~context.url.indexOf('http:') || ~context.url.indexOf('https:'))) {
                        context.url = location.protocol + '//' + location.host + context.url;
                    }
                }
            }
            return context;
        }    //@method addCrosDomainParams Add extra cross domain parameters into the final URL
             //@param {NavigationContext} context
             //@return {NavigationContext} context
,
        addCrosDomainParams: function (context) {
            // Cross Domain Cookie Tracking:
            // Trackers like Google Analytics require us to send special parameters in the URL
            // to keep tracking the user as one entity even when moving to a different domain
            if (Tracker.getInstance().addCrossDomainParameters) {
                context.url = Tracker.getInstance().addCrossDomainParameters(context.url);
            }
            return context;
        }    //@method getTargetUrl Apply the entire process of generating the final URL and return it
             //@param {NavigationContext} context
             //@param {ApplicationSkeleton} application
             //@param {ApplicationSkeleton.Layout} layout
             //@return {String}
,
        getTargetUrl: function (context, application, layout) {
            context = dataTouchPointPlugins.addHashtagToTouchPoint(context);
            context = dataTouchPointPlugins.generateUrl(context, application, layout);
            context = dataTouchPointPlugins.preserveLanguage(context);
            context = dataTouchPointPlugins.addParametersToUrl(context);
            context = dataTouchPointPlugins.addCrosDomainParams(context);
            return context.url;
        }    //@method correctURL Public plugin to fix data-touchpoint URLs
             //@param {ApplicationSkeleton.Layout} layout
             //@param {ApplicationSkeleton} application
             //@param {jQuery.Event} e
             //@return {jQuery.Event} e
,
        correctURL: function (layout, application, e) {
            var context = layout.generateNavigationContext(e);
            if (context.target_data.touchpoint) {
                layout.isTouchMoveEvent = false;
                if (e.type === 'touchstart') {
                    e.stopPropagation();
                }
                // 2 = middle click, 3 = right click
                if (e.which === 2 || e.which === 3) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                var new_url = dataTouchPointPlugins.getTargetUrl(context, application, layout);
                layout.setUrl(context.$target, new_url);
            }
            return e;
        }    //@method setHashtag Detects if you are trying to access a different hashtag within the same touchpoint
             //@param {ApplicationSkeleton.Layout} layout
             //@param {ApplicationSkeleton} application
             //@param {jQuery.Event} e
             //@return {jQuery.Event} e
,
        setHashtag: function (layout, application, e) {
            var context = layout.generateNavigationContext(e), target_is_blank = layout.isTargetBlank(e) || e.button && e.button !== 0;
            if (context.target_data.touchpoint) {
                if (!target_is_blank && context.target_data.hashtag && application.getConfig('currentTouchpoint') && application.getConfig('currentTouchpoint') === context.target_data.touchpoint) {
                    var new_url = context.target_data.hashtag;
                    // Removes the hastag if it's there remove it
                    new_url = new_url[0] === '#' ? new_url.substring(1) : new_url;
                    // if it does not has a slash add it
                    new_url = new_url[0] === '/' ? new_url : '/' + new_url;
                    // we just set the hastag as a relative href and the app should take care of itself
                    layout.setUrl(context.$target, new_url);
                }
                if (e.type === 'touchend' && !layout.isTouchMoveEvent) {
                    e.stopPropagation();
                    e.preventDefault();
                    context.$target.trigger('click');
                }
            }
            return e;
        }    //@method mountToApp Mount to Application
,
        mountToApp: function (application) {
            var layout = application.getLayout();
            //INSTALL DEFAULT NAVIGATION PLUGINS
            layout.mouseDown.install({
                name: 'mouseDownFixHrefDataTouchPoint',
                priority: 10,
                execute: function (e) {
                    return dataTouchPointPlugins.correctURL(layout, application, e);
                }
            });
            layout.touchStart.install({
                name: 'touchStartFixHrefDataTouchPoint',
                priority: 10,
                execute: function (e) {
                    return dataTouchPointPlugins.correctURL(layout, application, e);
                }
            });
            layout.mouseUp.install({
                name: 'correctHashtagsDataTouch',
                priority: 10,
                execute: function (e) {
                    return dataTouchPointPlugins.setHashtag(layout, application, e);
                }
            });
            layout.touchEnd.install({
                name: 'correctHashtagsDataTouch',
                priority: 10,
                execute: function (e) {
                    return dataTouchPointPlugins.setHashtag(layout, application, e);
                }
            });
        }
    };
    return dataTouchPointPlugins;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module NavigationHelper
define('NavigationHelper.Plugins.Modals', [
    'underscore',
    'jQuery',
    'Backbone',
    'UrlHelper',
    'Utils'
], function (_, jQuery, Backbone) {
    'use strict';
    // @class NavigationHelper.Plugins.Modals Contains the plugins that implement the show in modal for links behavior.
    // This means a link with the attribute data-toggle="show-in-modal" will be opened in a modal. Supports both internal and external URLs.
    // @extends ApplicationModule
    var modalsPlugin = {
        // @method showInternalLinkInModal for links that has the data-toggle="show-in-modal" we will open them in a modal,
        // we do this by overriding the showContent function of the layout
        // and by disabling the overrideViewSettings of the Content.EnhancedViews package
        // Then we just navigate to that URL to call the router and execute the logic as normal
        // layout_overlay prevents the user from calling the overridden showContent by clicking another element
        // @param {jQuery.Event} e
        // @param {String} href
        // @param {jQuery} $target
        // @param {ApplicationSkeleton.Layout} layout
        // @return {Void}
        showInternalLinkInModal: function (e, href, $target, layout) {
            var current_fragment = Backbone.history.fragment || '/', original_view;
            layout.isShowContentRewritten = true;
            layout.originalShowContent = layout._showContent;
            if (modalsPlugin.ContentEnhancedViews) {
                modalsPlugin.originalOverrideViewSettings = modalsPlugin.ContentEnhancedViews.overrideViewSettings;
            }
            var layout_overlay = jQuery('<div class="layout-overlay"></div>');
            layout.$el.append(layout_overlay);
            layout.showContent = function (view) {
                return layout.cancelableTriggerUnsafe('beforeAppendView', view).then(_.bind(_showContent, this, view)).fail(function () {
                    layout_overlay.remove();
                    modalsPlugin.undoNavigationHelperFunctionRewrite(layout);
                });
            };
            // Here we override the showContent function
            var _showContent = function _showContent(view) {
                layout_overlay.remove();
                var promise = jQuery.Deferred();
                // If you ever try to set a view that is not the original one
                // this code will catch it an do an undo
                if (!original_view) {
                    original_view = view;
                } else if (original_view !== view) {
                    promise = layout.originalShowContent.apply(layout, arguments);
                    original_view && original_view.$containerModal && original_view.$containerModal.modal('hide');
                    return promise;
                }
                if (view && _.isFunction(view.showInModal)) {
                    // Then we just call the show in modal of the same view that we were passed in.
                    promise = view.showInModal({
                        className: $target.data('modal-class-name'),
                        silence: true
                    });
                    // once this model closes we undo the override of the function
                    view.$containerModal.on('hide.bs.modal', function () {
                        modalsPlugin.undoNavigationHelperFunctionRewrite(layout);
                    });
                } else {
                    modalsPlugin.undoNavigationHelperFunctionRewrite(layout);
                    Backbone.history.navigate(href, {
                        trigger: false,
                        replace: true
                    });
                }
                return promise;
            };
            // Here we navigate to the url and we then change the url to what it was originaly set in page that opened the modal
            Backbone.history.navigate(href, {
                trigger: true,
                replace: true
            });
            Backbone.history.navigate(current_fragment, {
                trigger: false,
                replace: true
            });
        }    //@method undoNavigationHelperFunctionRewrite Helper method to undo the override performed by showInternalLinkInModal
             //@param {ApplicationSkeleton.Layout} layout
             //@return {Void}
,
        undoNavigationHelperFunctionRewrite: function (layout) {
            if (layout.isShowContentRewritten) {
                layout.showContent = layout.originalShowContent;
                if (modalsPlugin.ContentEnhancedViews) {
                    modalsPlugin.ContentEnhancedViews.overrideViewSettings = modalsPlugin.originalOverrideViewSettings;
                }
                layout.isShowContentRewritten = false;
            }
        }    //@method showExternalLinkInModal Opens an external page in a modal, by rendering an iframe in it
             //@param {String} href
             //@param {NavigationContext} context
             //@param {ApplicationSkeleton} application
             //@return {Void}
,
        showExternalLinkInModal: function (href, context, application) {
            var view = new Backbone.View({ application: application });
            view.template = function () {
                return '<iframe src="' + href + '"></iframe>';
            };
            view.page_header = context.$target.data('page-header') || '';
            application.getLayout().cancelableTriggerUnsafe('beforeAppendView', view).then(function () {
                view.showInModal({ className: (context.$target.data('modal-class-name') || '') + ' iframe-modal' });
            });
        }    //@method clickNavigation Handle standard click navigation for the cases were the target DO IS not a modal
             //@param {ApplicationSkeleton.Layout} layout General application layout
             //@param {jQuery.Event} e jQuery event
             //@param {ApplicationSkeleton} application
             //@return {jQuery.Event} e
,
        clickNavigation: function (layout, e, application) {
            // Grabs info from the event element
            var context = layout.generateNavigationContext(e), href = layout.getUrl(context) || '', target_is_blank = layout.isTargetBlank(e) || e.button === 1, target_is_modal = context.target_data.toggle === 'show-in-modal', is_disabled = context.$target.attr('disabled'), is_dropdown = context.target_data.toggle === 'dropdown', is_external;
            if (is_disabled) {
                e.stopPropagation();
                return e;
            }
            if (context.target_data.originalHref && !target_is_blank) {
                href = context.target_data.originalHref;
            }
            if (href === '#' || href === '' || is_dropdown) {
                return e;
            }
            // The navigation is within the same browser window
            if (!target_is_blank) {
                // if there is a modal open
                if (layout.$containerModal) {
                    layout.$containerModal.modal('hide');
                }
                // Wants to open this link in a modal
                if (target_is_modal) {
                    is_external = ~href.indexOf('http:') || ~href.indexOf('https:') || ~href.indexOf('mailto:') || ~href.indexOf('tel:');
                    if (is_external) {
                        modalsPlugin.showExternalLinkInModal(href, context, application);
                    } else {
                        modalsPlugin.showInternalLinkInModal(e, href, context.$target, layout);
                    }
                }
            }
            return e;
        }    //@property {Boolean} ContentEnhancedViews
,
        ContentEnhancedViews: false    //@method mountToApp
                 //@param {ApplicationSkeleton} application
,
        mountToApp: function (application) {
            var layout = application.getLayout();
            // there is a soft dependency with Content.EnhancedViews
            // we only want it to disable the function that sets the title of the page,
            // we don't want to do that pages that open in modals
            try {
                modalsPlugin.ContentEnhancedViews = require('Content.EnhancedViews');
            } catch (e) {
            }
            //Install Modal Navigation Plugins
            layout.click.install({
                name: 'modalNavigation',
                priority: 10,
                execute: function (e) {
                    return modalsPlugin.clickNavigation(layout, e, application);
                }
            });
        }
    };
    return modalsPlugin;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module NavigationHelper
define('NavigationHelper.Plugins.Pushers', [
    'underscore',
    'jQuery',
    'Backbone',
    'UrlHelper',
    'Utils'
], function (_, jQuery, Backbone) {
    'use strict';
    // @class NavigationHelper.Plugins.Pushers Contains the plugins that implement the show in pusher for links behavior.
    // This means a link with the attribute data-toggle="show-in-pusher" will be opened in a pusher. Supports both internal and external URLs.
    // @extends ApplicationModule
    var pushersPlugin = {
        // @method showInternalLinkInModal for links that has the data-toggle="show-in-modal" we will open them in a modal,
        // we do this by overriding the showContent function of the layout
        // and by disabling the overrideViewSettings of the Content.EnhancedViews package
        // Then we just navigate to that URL to call the router and execute the logic as normal
        // layout_overlay prevents the user from calling the overridden showContent by clicking another element
        // @param {jQuery.Event} e
        // @param {String} href
        // @param {jQuery} $target
        // @param {ApplicationSkeleton.Layout} layout
        // @return {Void}
        showInternalLinkInPusher: function (e, href, $target, layout) {
            var current_fragment = Backbone.history.fragment || '/';
            layout.isShowContentRewritten = true;
            layout.originalShowContent = layout.showContent;
            if (pushersPlugin.ContentEnhancedViews) {
                pushersPlugin.originalOverrideViewSettings = pushersPlugin.ContentEnhancedViews.overrideViewSettings;
            }
            // Here we override the showContent function
            layout.showContent = function (view) {
                var promise = jQuery.Deferred();
                if (view && _.isFunction(view.showInPush)) {
                    // Then we just call the show in modal of the same view that we were passed in.
                    promise = view.showInPush({ className: $target.data('pusher-class-name') });
                    // once this model closes we undo the override of the function
                    layout.$pusher_container.on('beforeClose', function () {
                        pushersPlugin.undoNavigationHelperFunctionRewrite(layout);
                    });
                } else {
                    pushersPlugin.undoNavigationHelperFunctionRewrite(layout);
                    Backbone.history.navigate(href, {
                        trigger: false,
                        replace: true
                    });
                }
                promise.done(function () {
                    Backbone.history.navigate(current_fragment, {
                        trigger: false,
                        replace: true
                    });
                });
                return promise;
            };
            // Here we navigate to the url and we then change the url to what it was originaly set in page that opened the modal
            Backbone.history.navigate(href, {
                trigger: true,
                replace: true
            });
        }    //@method undoNavigationHelperFunctionRewrite Helper method to undo the override performed by showInternalLinkInModal
             //@param {ApplicationSkeleton.Layout} layout
             //@return {Void}
,
        undoNavigationHelperFunctionRewrite: function (layout) {
            if (layout.isShowContentRewritten) {
                layout.showContent = layout.originalShowContent;
                if (pushersPlugin.ContentEnhancedViews) {
                    pushersPlugin.ContentEnhancedViews.overrideViewSettings = pushersPlugin.originalOverrideViewSettings;
                }
                layout.isShowContentRewritten = false;
            }
        }    //@method showExternalLinkInModal Opens an external page in a modal, by rendering an iframe in it
             //@param {String} href
             //@param {NavigationContext} context
             //@param {ApplicationSkeleton} application
             //@return {Void}
,
        showExternalLinkInPusher: function (href, context, application) {
            var view = new Backbone.View({ application: application });
            view.template = function () {
                return '<iframe src="' + href + '"></iframe>';
            };
            view.page_header = context.$target.data('page-header') || '';
            view.showInPush({ className: (context.$target.data('pusher-class-name') || '') + ' iframe-pusher' });
        }    //@method clickNavigation Handle standard click navigation for the cases were the target DO IS not a modal
             //@param {ApplicationSkeleton.Layout} layout General application layout
             //@param {jQuery.Event} e jQuery event
             //@param {ApplicationSkeleton} application
             //@return {jQuery.Event} e
,
        clickNavigation: function (layout, e, application) {
            if (!_.isPhoneDevice()) {
                return e;
            }
            // Grabs info from the event element
            var context = layout.generateNavigationContext(e), href = layout.getUrl(context) || '', target_is_blank = layout.isTargetBlank(e) || e.button === 1, target_is_pusher = context.target_data.toggle === 'show-in-pusher', is_disabled = context.$target.attr('disabled'), is_dropdown = context.target_data.toggle === 'dropdown', is_external;
            if (is_disabled) {
                e.stopPropagation();
                return e;
            }
            if (context.target_data.originalHref && !target_is_blank) {
                href = context.target_data.originalHref;
            }
            if (href === '#' || href === '' || is_dropdown) {
                return e;
            }
            // The navigation is within the same browser window
            if (!target_is_blank) {
                // if there is a modal open
                if (layout.$containerModal) {
                    layout.$containerModal.modal('hide');
                }
                // Wants to open this link in a modal
                if (target_is_pusher) {
                    is_external = ~href.indexOf('http:') || ~href.indexOf('https:') || ~href.indexOf('mailto:') || ~href.indexOf('tel:');
                    if (is_external) {
                        pushersPlugin.showExternalLinkInPusher(href, context, application);
                    } else {
                        pushersPlugin.showInternalLinkInPusher(e, href, context.$target, layout);
                    }
                }
            }
            return e;
        }    //@property {Boolean} ContentEnhancedViews
,
        ContentEnhancedViews: false    //@method mountToApp
                 //@param {ApplicationSkeleton} application
,
        mountToApp: function (application) {
            var layout = application.getLayout();
            // there is a soft dependency with Content.EnhancedViews
            // we only want it to disable the function that sets the title of the page,
            // we don't want to do that pages that open in modals
            try {
                pushersPlugin.ContentEnhancedViews = require('Content.EnhancedViews');
            } catch (e) {
            }
            //Install Modal Navigation Plugins
            layout.click.install({
                name: 'pusherNavigation',
                priority: 25,
                execute: function (e) {
                    return pushersPlugin.clickNavigation(layout, e, application);
                }
            });
        }
    };
    return pushersPlugin;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Facets
// @class Facets.Translator
// Holds the mapping of a url compoment with an api call,
// is able to translate and to return different configurations of himself with diferent options
define('Facets.Translator', [
    'underscore',
    'jQuery',
    'SC.Configuration',
    'Utils',
    'UrlHelper'
], function (_, jQuery, Configuration) {
    'use strict';
    // This is just for internal use only, DO NOT EDIT IT HERE!!
    // the same options should be somewhere in the configuration file
    var default_config = {
        fallbackUrl: 'search',
        defaultShow: null,
        defaultOrder: null,
        defaultDisplay: null,
        facets: [],
        facetDelimiters: {
            betweenFacetNameAndValue: '/',
            betweenDifferentFacets: '/',
            betweenDifferentFacetsValues: ',',
            betweenRangeFacetsValues: 'to',
            betweenFacetsAndOptions: '?',
            betweenOptionNameAndValue: '=',
            betweenDifferentOptions: '&'
        }
    };
    //@constructor @param {Array}facets @param {Object} options @param {Object} configuration
    function FacetsTranslator(facets, options, configuration, category) {
        // Enforces new
        if (!(this instanceof FacetsTranslator)) {
            return new FacetsTranslator(facets, options, configuration, category);
        }
        // Facets go Here
        this.facets = [];
        // Other options like page, view, etc. goes here
        this.options = {};
        // This is an object that must contain a fallbackUrl and a lists of facet configurations
        this.configuration = configuration || default_config;
        // Get the facets that are in the sitesettings but not in the config.
        // These facets will get a default config (max, behavior, etc.) - Facets.Translator
        // Include facet aliases to be conisdered as a possible route
        var facets_data = Configuration.get('siteSettings.facetfield'), facets_to_include = [];
        _.each(facets_data, function (facet) {
            if (facet.facetfieldid !== 'commercecategory') {
                facets_to_include.push(facet.facetfieldid);
                // If the facet has an urlcomponent defined, then add it to the possible values list.
                facet.urlcomponent && facets_to_include.push(facet.urlcomponent);
                // Finally, include URL Component Aliases...
                _.each(facet.urlcomponentaliases, function (facet_alias) {
                    facets_to_include.push(facet_alias.urlcomponent);
                });
            }
        });
        facets_to_include = _.union(facets_to_include, _.pluck(Configuration.get('facets'), 'id'));
        facets_to_include = _.uniq(facets_to_include);
        this.facetsToInclude = facets_to_include;
        this.isCategoryPage = !!category;
        if (_.isBoolean(category) && category) {
            var index = facets.length, facetsToInclude = this.facetsToInclude.slice(0);
            facetsToInclude.push(this.configuration.facetDelimiters.betweenFacetsAndOptions);
            _.each(facetsToInclude, function (facetname) {
                var i = facets.indexOf(facetname);
                if (i !== -1 && i < index) {
                    index = i;
                }
            });
            var categoryUrl = facets.substring(0, index);
            facets = facets.substring(index);
            if (categoryUrl[0] !== '/') {
                categoryUrl = '/' + categoryUrl;
            }
            if (categoryUrl[categoryUrl.length - 1] === '/') {
                categoryUrl = categoryUrl.substring(0, categoryUrl.length - 1);
            }
            this.categoryUrl = categoryUrl;
        } else if (_.isString(category)) {
            this.categoryUrl = category;
        }
        // We cast on top of the passed in parameters.
        if (facets && options) {
            this.facets = facets;
            this.options = options;
        } else if (_.isString(facets)) {
            // It's a url
            this.parseUrl(facets);
        } else if (facets) {
            // It's an API option object
            this.parseOptions(facets);
        }
    }
    _.extend(FacetsTranslator.prototype, {
        //@property {Object}defaultFacetConfig
        defaultFacetConfig: {
            behavior: 'single',
            max: 5
        }    // @method getFacetsToInclude
,
        getFacetsToInclude: function getFacetsToInclude() {
            return this.facetsToInclude;
        }    // @method parseUrl Url strings get translated into the differnts part of the object, facets and options
             // @param {String} url
,
        parseUrl: function parseUrl(url) {
            // We remove a posible 1st / (slash)
            url = url[0] === '/' ? url.substr(1) : url;
            // given an url with options we split them into 2 strings (options and facets)
            var facets_n_options = url.split(this.configuration.facetDelimiters.betweenFacetsAndOptions), facets = facets_n_options[0] && facets_n_options[0] !== this.configuration.fallbackUrl ? facets_n_options[0] : '', options = facets_n_options[1] || '';
            // We treat category as the 1st unnamed facet filter, so if you are using categories
            // we will try to take that out by comparing the url with the category tree
            if (this.isCategoryPage) {
                facets = facets.replace(this.categoryUrl, '');
                // We remove a posible 1st / (slash) (again, it me be re added by taking the category out)
                facets = facets[0] === '/' ? facets.substr(1) : facets;
            }
            // The facet part of the url gets splitted and computed by pairs
            var facet_tokens = facets.split(new RegExp('[\\' + this.configuration.facetDelimiters.betweenDifferentFacets + '\\' + this.configuration.facetDelimiters.betweenFacetNameAndValue + ']+', 'ig'));
            while (facet_tokens.length > 0) {
                var facet_name = facet_tokens.shift(), facet_value = facet_tokens.shift();
                if (!this.facetIsParameter(facet_name)) {
                    this.parseUrlFacet(facet_name, facet_value);
                }
            }
            // The same for the options part of the url
            var options_tokens = options.split(new RegExp('[\\' + this.configuration.facetDelimiters.betweenOptionNameAndValue + '\\' + this.configuration.facetDelimiters.betweenDifferentOptions + ']+', 'ig')), tmp_options = {};
            while (options_tokens.length > 0) {
                var option_name = options_tokens.shift(), option_value = options_tokens.shift(), option_is_facet = _.contains(this.facetsToInclude, option_name);
                if (option_is_facet && this.facetIsParameter(option_name)) {
                    this.parseUrlFacet(option_name, option_value);
                }
                tmp_options[option_name] = option_value;
            }
            this.parseUrlOptions(tmp_options);
        }    // @method facetIsParameter
             // Given a facet name, returns true if the facet needs to be interpreted as an url parameter, false otherwise.
             // @param {String} facet_name
,
        facetIsParameter: function facetIsParameter(facet_name) {
            var facet_config = this.getFacetConfig(facet_name);
            return _.isUndefined(facet_config.isParameter) ? this.configuration.facetsAsUrlParameters : facet_config.isParameter;
        }    /*
		@method sanitizeValue
		Translates values that came from the url into JS data types that this objects know of
		Examples for different types:

		range/10to100 gets translated to {from: '10', to: '100'}
		range/100 gets translated to {from: '0', to: '100'}
		multi/1,2,3 gets translated to ['1', '2', '3']
		*/,
        sanitizeValue: function sanitizeValue(value, behavior) {
            var parsed_value;
            switch (behavior) {
            case 'range':
                // we return an object like {from: string, to: string }
                if (_.isString(value)) {
                    if (value.indexOf(this.configuration.facetDelimiters.betweenRangeFacetsValues) !== -1) {
                        var tokens = value.split(this.configuration.facetDelimiters.betweenRangeFacetsValues);
                        parsed_value = {
                            from: tokens[0],
                            to: tokens[1]
                        };
                    } else {
                        parsed_value = {
                            from: '0',
                            to: value
                        };
                    }
                } else {
                    parsed_value = value;
                }
                break;
            case 'multi':
                // we always return an array for a multi value
                if (value.indexOf(this.configuration.facetDelimiters.betweenDifferentFacetsValues) !== -1) {
                    parsed_value = value.split(this.configuration.facetDelimiters.betweenDifferentFacetsValues);
                } else {
                    parsed_value = [value];
                }
                break;
            default:
                parsed_value = value;
            }
            return parsed_value;
        }    // @method getUrlFacetValue
             // Returns the value of an active facet by the facet URL component
             // @param {String} facet_url
,
        getUrlFacetValue: function getUrlFacetValue(facet_url) {
            return (_.find(this.facets, function (facet) {
                return facet.url === facet_url;
            }) || {}).value;
        }    // @method getFacetValue:
             // Returns the value of an active facet by the facet id
             // @param {String} facet_id
,
        getFacetValue: function getFacetValue(facet_id) {
            return (_.find(this.facets, function (facet) {
                return facet.id === facet_id;
            }) || {}).value;
        }    // @method getAllFacets
             // @returns {Array} a copy of the internal array of facets containing values and configuration
,
        getAllFacets: function getAllFacets() {
            return this.facets.slice(0);
        }    // @param getOptionValue
             // Returns the value of an active options or it's default value
,
        getOptionValue: function getOptionValue(option_id) {
            return this.options[option_id] || null;
        }    // @param parseUrlFacet
             // for a given name value, it gets the config, sanitize the value and stores it all in the internal facets array
             // @param {String} @param {String} value
,
        parseUrlFacet: function parseUrlFacet(name, value) {
            // Gets the config for the current facet
            var config = this.getFacetConfig(name, 'id'), facets_values;
            if (config.id === 'commercecategoryname' || config.id === 'category' || !name) {
                return;
            }
            facets_values = value && value.split(this.configuration.facetDelimiters.betweenDifferentFacetsValues);
            facets_values = _.map(facets_values, function (val) {
                if (val === decodeURIComponent(val)) {
                    val = encodeURIComponent(val);
                }
                return val;
            });
            this.facets.push({
                config: config,
                id: config.id,
                url: config.id,
                value: this.sanitizeValue(facets_values.join(this.configuration.facetDelimiters.betweenDifferentFacetsValues), config.behavior),
                isParameter: config.isParameter
            });
        }    // @method parseFacet:
             // Same as parseUrlFacet but from id
             // @param facet_id @param value
,
        parseFacet: function parseFacet(facet_id, value) {
            // Gets the config for the current facet
            var config = this.getFacetConfig(facet_id, 'id');
            this.facets.push({
                config: config,
                id: config.id,
                url: config.id,
                value: this.sanitizeValue(value, config.behavior),
                isParameter: config.isParameter
            });
        }    // @method parseUrlOptions:
             // Sets options from the options argument or sets default values
             // @param {Object} options
,
        parseUrlOptions: function parseUrlOptions(options) {
            this.options.show = options.show || this.configuration.defaultShow;
            this.options.order = options.order || this.configuration.defaultOrder;
            this.options.page = parseInt(options.page, 10) || 1;
            this.options.display = options.display || this.configuration.defaultDisplay;
            this.options.keywords = options.keywords ? decodeURIComponent(options.keywords) : this.configuration.defaultKeywords;
        }    // facet@method getFacetConfig
             // Gets the configuration for a given facet by id,
             // @param {String}name @param {String}by
,
        getFacetConfig: function getFacetConfig(name) {
            var result = _.find(this.configuration.facets, function (facet) {
                return facet.id === name;
            });
            result = result || _.find(this.configuration.facets, function (facet) {
                return facet.url === name;
            });
            return result || _.extend({
                id: name,
                name: name,
                url: name,
                isParameter: undefined
            }, this.defaultFacetConfig);
        }    // @method getUrl
             // Gets the url for current state of the object
,
        getUrl: function getUrl() {
            var url = this.categoryUrl || '', self = this;
            // Prepares seo limits
            var facets_seo_limits = {};
            if (SC.ENVIRONMENT.jsEnvironment === 'server') {
                facets_seo_limits = {
                    numberOfFacetsGroups: this.configuration.facetsSeoLimits && this.configuration.facetsSeoLimits.numberOfFacetsGroups || false,
                    numberOfFacetsValues: this.configuration.facetsSeoLimits && this.configuration.facetsSeoLimits.numberOfFacetsValues || false,
                    options: this.configuration.facetsSeoLimits && this.configuration.facetsSeoLimits.options || false
                };
            }
            // If there are too many facets selected
            if (facets_seo_limits.numberOfFacetsGroups && this.facets.length > facets_seo_limits.numberOfFacetsGroups) {
                return '#';
            }
            // Encodes the other Facets
            var sorted_facets = _.sortBy(this.facets, 'url'), facets_as_options = [];
            for (var i = 0; i < sorted_facets.length; i++) {
                var facet = sorted_facets[i];
                // Category should be already added
                if (facet.id === 'commercecategoryname' || facet.id === 'category') {
                    break;
                }
                var name = facet.url || facet.id, value = '';
                switch (facet.config.behavior) {
                case 'range':
                    facet.value = typeof facet.value === 'object' ? facet.value : {
                        from: 0,
                        to: facet.value
                    };
                    value = facet.value.from + self.configuration.facetDelimiters.betweenRangeFacetsValues + facet.value.to;
                    break;
                case 'multi':
                    value = facet.value.sort().join(self.configuration.facetDelimiters.betweenDifferentFacetsValues);
                    if (facets_seo_limits.numberOfFacetsValues && facet.value.length > facets_seo_limits.numberOfFacetsValues) {
                        return '#';
                    }
                    break;
                default:
                    value = facet.value;
                }
                if (self.facetIsParameter(name)) {
                    facets_as_options.push({
                        facetName: name,
                        facetValue: value
                    });
                } else {
                    // Do not add a facet separator at the begining of an url
                    if (url !== '') {
                        url += self.configuration.facetDelimiters.betweenDifferentFacets;
                    }
                    url += name + self.configuration.facetDelimiters.betweenFacetNameAndValue + value;
                }
            }
            url = url !== '' ? url : '/' + this.configuration.fallbackUrl;
            // Encodes the Options
            var tmp_options = {}, separator = this.configuration.facetDelimiters.betweenOptionNameAndValue;
            if (this.options.order && this.options.order !== this.configuration.defaultOrder) {
                tmp_options.order = 'order' + separator + this.options.order;
            }
            if (this.options.page && parseInt(this.options.page, 10) !== 1) {
                tmp_options.page = 'page' + separator + encodeURIComponent(this.options.page);
            }
            if (this.options.show && parseInt(this.options.show, 10) !== this.configuration.defaultShow) {
                tmp_options.show = 'show' + separator + encodeURIComponent(this.options.show);
            }
            if (this.options.display && this.options.display !== this.configuration.defaultDisplay) {
                tmp_options.display = 'display' + separator + encodeURIComponent(this.options.display);
            }
            if (this.options.keywords && this.options.keywords !== this.configuration.defaultKeywords) {
                tmp_options.keywords = 'keywords' + separator + encodeURIComponent(this.options.keywords);
            }
            for (i = 0; i < facets_as_options.length; i++) {
                var facet_option_obj = facets_as_options[i];
                tmp_options[facet_option_obj.facetName] = facet_option_obj.facetName + separator + facet_option_obj.facetValue;
            }
            var tmp_options_keys = _.keys(tmp_options), tmp_options_vals = _.values(tmp_options);
            // If there are options that should not be indexed also return #
            if (facets_seo_limits.options && _.difference(tmp_options_keys, facets_seo_limits.options).length) {
                return '#';
            }
            url += tmp_options_vals.length ? this.configuration.facetDelimiters.betweenFacetsAndOptions + tmp_options_vals.join(this.configuration.facetDelimiters.betweenDifferentOptions) : '';
            if (url && url[0] !== this.configuration.facetDelimiters.betweenDifferentFacets) {
                url = this.configuration.facetDelimiters.betweenDifferentFacets + url;
            }
            return _(url).fixUrl();
        }    // @method getCategoryUrl Returns the current category url
,
        getCategoryUrl: function getCategoryUrl() {
            return this.categoryUrl;
        }    // @method getApiParams
             // Gets the api parameters representing the current status of the object
,
        getApiParams: function getApiParams() {
            var params = {};
            _.each(this.facets, function (facet) {
                switch (facet.config.behavior) {
                case 'range':
                    var value = typeof facet.value === 'object' ? facet.value : {
                        from: 0,
                        to: facet.value
                    };
                    params[facet.id + '.from'] = value.from;
                    params[facet.id + '.to'] = value.to;
                    break;
                case 'multi':
                    params[facet.id] = facet.value.sort().join(',');
                    // this coma is part of the api call so it should not be removed
                    break;
                default:
                    params[facet.id] = facet.value;
                }
            });
            params.sort = this.options.order;
            params.limit = this.options.show;
            params.offset = this.options.show * this.options.page - this.options.show;
            params.q = this.options.keywords;
            if (this.isCategoryPage) {
                params.commercecategoryurl = this.categoryUrl;
                params.sort = params.sort.replace('relevance', 'commercecategory');
            }
            return params;
        }    // @method cloneForFacetId
             // retruns a deep copy of this object with a new value for one facet,
             // if in a name value that is the same as what's in, it will take it out
,
        cloneForFacetId: function cloneForFacetId(facet_id, facet_value) {
            // Using jQuery here because it offers deep cloning
            var facets = _.toArray(jQuery.extend(true, {}, this.facets)), options = jQuery.extend(true, {}, this.options), current_facet = _.find(facets, function (facet) {
                    return facet.id === facet_id;
                });
            if (current_facet) {
                if (current_facet.config.behavior === 'multi') {
                    if (_.indexOf(current_facet.value, facet_value) === -1) {
                        current_facet.value.push(facet_value);
                    } else {
                        current_facet.value = _.without(current_facet.value, facet_value);
                    }
                    if (current_facet.value.length === 0) {
                        facets = _.without(facets, current_facet);
                    }
                } else {
                    if (!_.isEqual(current_facet.value, facet_value)) {
                        current_facet.value = facet_value;
                    } else {
                        facets = _.without(facets, current_facet);
                    }
                }
            }
            options.page = 1;
            var translator = new FacetsTranslator(facets, options, this.configuration, this.categoryUrl);
            if (!current_facet) {
                translator.parseFacet(facet_id, facet_value);
            }
            return translator;
        }    // @method cloneWithoutFacetId
             // retruns a deep copy of this object without a facet,
,
        cloneWithoutFacetId: function cloneWithoutFacetId(facet_id) {
            var facets = _.toArray(jQuery.extend(true, {}, this.facets)), options = jQuery.extend(true, {}, this.options);
            facets = _.without(facets, _.find(facets, function (facet) {
                return facet.id === facet_id;
            }));
            return new FacetsTranslator(facets, options, this.configuration, this.categoryUrl);
        }    // @method cloneWithoutFacets
             // Clones the translator removeing all the facets, leaving only options
,
        cloneWithoutFacets: function cloneWithoutFacets() {
            // Creates a new translator with the same params as this;
            var translator = new FacetsTranslator(this.facets.slice(), this.options, this.configuration, this.categoryUrl);
            _.each(translator.getAllFacets(), function (facet) {
                // Categories are not facets, so lets not remove those
                if (facet.id !== 'commercecategoryname' && facet.id !== 'category') {
                    translator = translator.cloneWithoutFacetId(facet.id);
                }
            });
            return translator;
        }    //@method cloneForOption
,
        cloneForOption: function cloneForOption(option_id, option_value) {
            var facets = _.toArray(jQuery.extend(true, {}, this.facets)), options = jQuery.extend(true, {}, this.options);
            options[option_id] = option_value;
            return new FacetsTranslator(facets, options, this.configuration, this.categoryUrl);
        }    // @method cloneForOptions
             // same as cloneForFacetId but for options instead of facets
,
        cloneForOptions: function cloneForOptions(object) {
            var facets = _.toArray(jQuery.extend(true, {}, this.facets)), options = jQuery.extend(true, {}, this.options, object);
            return new FacetsTranslator(facets, options, this.configuration, this.categoryUrl);
        }    // @method cloneWithoutOption
             // same as cloneWithoutFacetId but for options instead of facets
,
        cloneWithoutOption: function cloneWithoutOption(option_id) {
            var facets = _.toArray(jQuery.extend(true, {}, this.facets)), options = jQuery.extend(true, {}, this.options);
            delete options[option_id];
            return new FacetsTranslator(facets, options, this.configuration, this.categoryUrl);
        }    // @method resetAll
             // Returns a blank instance of itself
,
        resetAll: function resetAll() {
            return new FacetsTranslator([], {}, this.configuration, false);
        }    // @method setLabelsFromFacets
             // This let the translator known about labels the api proportions
             // Tho this make the translator a bit less API agnostic
             // this step is totaly optional and it should work regardless of this step
,
        setLabelsFromFacets: function setLabelsFromFacets(facets_labels) {
            this.facetsLabels = facets_labels;
        }    // @method getLabelForValue
             // If facets labels have been setted it will try to look for the label for the
             // [id, value] combination and return it's label, otherways it will return the value
,
        getLabelForValue: function getLabelForValue(id, value) {
            var facet = _.filter(this.facetsLabels || [], function (facet_label) {
                return facet_label.id === id || facet_label.url === id;
            });
            if (facet.length) {
                var label = _.where(facet[0].values || [], { name: value });
                // if the value could not be found by name, look for url
                if (!label.length) {
                    label = _.where(facet[0].values || [], { url: value });
                }
                if (label.length && label[0].label) {
                    return label[0].label;
                }
            }
            return value;
        }
    });
    return FacetsTranslator;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Facets
// @class Facets.Helper
// Helps you with the creation of translators
define('Facets.Helper', ['Facets.Translator'], function (Translator) {
    'use strict';
    return {
        settings_stack: []    // @method parseUrl Returns a Facet.Translator for the passed url and configuration @static
,
        parseUrl: function (fullurl, configuration, isCategoryPage) {
            return new Translator(fullurl, null, configuration, isCategoryPage);
        }    // @method setCurrent @param {Object} settings @static
,
        setCurrent: function (settings) {
            this.settings_stack.push(settings);
        }    // @method getCurrent @returns {Object} @static
,
        getCurrent: function () {
            return this.settings_stack[this.settings_stack.length - 1];
        }    // @method getPrevious @returns {Object} @static
,
        getPrevious: function () {
            return this.settings_stack[this.settings_stack.length - 2];
        }
    };
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Facets
define('Facets.FacetedNavigationItem.View', [
    'SC.Configuration',
    'facets_faceted_navigation_item.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'underscore',
    'jQuery',
    'Bootstrap.Slider'
], function (Configuration, facets_faceted_navigation_item_tpl, Backbone, BackboneCompositeView, BackboneCollectionView, _, jQuery) {
    'use strict';
    // @class Facets.FacetedNavigationItem.View @extends Backbone.View
    return Backbone.View.extend({
        template: facets_faceted_navigation_item_tpl,
        events: {
            'click [data-action="see-more"]': 'toggleSeeMoreLess',
            'slide div[data-toggle="slider"]': 'updateRangeValues',
            'stop div[data-toggle="slider"]': 'updateRangeSelection'
        },
        initialize: function () {
            this.facetId = this.model.get('url') || this.model.get('id');
            this.facet_config = this.options.translator.getFacetConfig(this.facetId);
            //this values is configured in the Configuration File (SCA.Shopping.Configuration)
            if (this.facet_config.template) {
                this.template = this.facet_config.template;
            }
            this.on('afterViewRender', this.renderFacets, this);
        }    //@method renderFacets
,
        renderFacets: function () {
            this.sliders = this.$('[data-toggle="slider"]').slider();
            this.$('[data-collapsed="true"]').hide();
        },
        destroy: function () {
            if (this.sliders.data('slider')) {
                this.sliders.data('slider').stopListen();
            }
            Backbone.View.prototype.destroy.apply(this, arguments);
        },
        toggleSeeMoreLess: function (event) {
            var target = jQuery(event.currentTarget), target_see_more = target.find('[data-type="see-more"]'), target_see_less = target.find('[data-type="see-less"]'), target_was_expanded = !!target.data('collapsed');
            if (target_was_expanded) {
                target_see_more.show();
                target_see_less.hide();
            } else {
                target_see_more.hide();
                target_see_less.show();
            }
            target.data('collapsed', !target_was_expanded);
        }    // @method updateRangeValues
             // Talks to the Bootstrap.Slider.js
             // Displays the numbers under the slider while you are slider
,
        updateRangeValues: function (e, slider) {
            var parser = this.options.translator.getFacetConfig(this.facetId).parser, start = _.isFunction(parser) ? parser(slider.values.low, true) : slider.values.low, end = _.isFunction(parser) ? parser(slider.values.high, false) : slider.values.high;
            this.$el.find('span[data-range-indicator="start"]').html(start).end().find('span[data-range-indicator="end"]').html(end);
        }    // @method updateRangeSelection
             // Talks to the Bootstrap.Slider.js
             // Once the user releases the Slider controller this takes care of
             // generating a new url and of navigating to it
,
        updateRangeSelection: function (e, slider) {
            var translator = this.options.translator, slider_values = slider.values, facet_values = translator.getFacetValue(this.facetId)    // available values for that facet
, values = _.map(this.model.get('values'), function (item) {
                    return parseFloat(item.url);
                });
            // if the low selected value equals the minimum available value
            // and the high selected value equals the maximum available value
            if (_.min(values) === slider_values.low && _.max(values) === slider_values.high) {
                // then we remove the facet from the selection
                Backbone.history.navigate(translator.cloneWithoutFacetId(this.facetId).getUrl(), { trigger: true });
            }    // else, if there are not values selected OR
                 // the selected from value is different than the slider low value OR
                 // the selected to value is different than the slider high value
            else if (!facet_values || parseFloat(facet_values.from) !== slider_values.low || parseFloat(facet_values.to) !== slider_values.high) {
                // then we navigate to that page
                Backbone.history.navigate(translator.cloneForFacetId(this.facetId, {
                    from: slider_values.low.toFixed(2),
                    to: slider_values.high.toFixed(2)
                }).getUrl(), { trigger: true });
            }
        }    // @method getContext @return {Facets.FacetedNavigationItem.View.Context}
,
        getContext: function () {
            var facet_id = this.facetId, translator = this.options.translator, facet_config = this.facet_config, values = [], range_min = 0, range_max = 0, range_from = 0, range_from_label = '', range_to = 0, range_to_label = '', range_values = [], max_items, display_values, extra_values = [], show_facet, show_remove_link, selected_values = this.options.translator.getFacetValue(facet_id) || [];
            selected_values = _.isArray(selected_values) ? selected_values : [selected_values];
            show_remove_link = !!selected_values.length;
            // Prepears the values for display
            var original_values = _.isArray(this.model.get('values')) ? this.model.get('values') : [this.model.get('values')];
            if (facet_config.behavior !== 'range') {
                _.each(original_values, function (value) {
                    if (value.url !== '') {
                        value.isActive = _.contains(selected_values, value.url);
                        value.link = translator.cloneForFacetId(facet_id, value.url).getUrl();
                        value.displayName = value.label || decodeURIComponent(value.url) || _('(none)').translate();
                        value.color = '';
                        value.isColorTile = false;
                        value.image = {};
                        value.isImageTile = false;
                        if (facet_config.colors) {
                            value.color = facet_config.colors[value.label] || facet_config.colors.defaultColor;
                            if (_.isObject(value.color)) {
                                value.image = value.color;
                                value.color = '';
                                value.isImageTile = true;
                            } else {
                                value.isColorTile = true;
                            }
                        }
                        values.push(value);
                    }
                });
                max_items = facet_config.max || values.length;
                display_values = _.first(values, max_items);
                _(display_values).each(function (value) {
                    value.isLightColor = _.contains(Configuration.get('layout.lightColors', []), value.label);
                });
                extra_values = _.rest(values, max_items);
                show_facet = !!values.length;
            } else
                //if (facet_config.behavior === 'range')
                {
                    range_values = _.map(original_values, function (item) {
                        return parseFloat(item.url);
                    });
                    range_min = _.min(range_values);
                    range_max = _.max(range_values);
                    show_facet = range_max > range_min;
                    show_remove_link = this.model.get('max') !== range_max || this.model.get('min') !== range_min;
                    var translator_value = translator.getFacetValue(facet_id) || {
                        from: range_min,
                        to: range_max
                    };
                    range_from = translator_value.from;
                    range_to = translator_value.to;
                    range_to_label = _.isFunction(facet_config.parser) ? facet_config.parser(range_to, false) : range_to;
                    range_from_label = _.isFunction(facet_config.parser) ? facet_config.parser(range_from, false) : range_from;
                }
            // @class Facets.FacetedNavigationItem.View.Context
            var context = {
                //@property {String} htmlId
                htmlId: _.uniqueId('facetList_')    //@property {String} facetId
,
                facetId: facet_id    //@property {Boolean} showFacet
,
                showFacet: show_facet    //@property {Boolean} showHeading
,
                showHeading: _.isBoolean(facet_config.showHeading) ? facet_config.showHeading : true    //@property {Boolean} isUncollapsible
,
                isUncollapsible: !!facet_config.uncollapsible,
                isCollapsed: !this.facet_config.uncollapsible && this.facet_config.collapsed,
                isMultiSelect: facet_config.behavior === 'multi'    //@property {Boolean} showRemoveLink
,
                showRemoveLink: show_remove_link    //@property {String} removeLink
,
                removeLink: translator.cloneWithoutFacetId(facet_id).getUrl()    //@property {String} facetDisplayName
,
                facetDisplayName: facet_config.name || facet_id    //@property {Array<Object>} values
,
                values: values    //@property {Array<Object>} displayValues
,
                displayValues: display_values    //@property {Array<Object>} extraValues
,
                extraValues: extra_values    //@property {Boolean} showExtraValues
,
                showExtraValues: !!extra_values.length,
                isRange: facet_config.behavior === 'range'    //@property {Array<Number>} rangeValues
,
                rangeValues: range_values    //@property {Number} rangeMin
,
                rangeMin: range_min    //@property {Number} rangeMax
,
                rangeMax: range_max    //@property {Number} rangeFrom
,
                rangeFrom: range_from    //@property {String} rangeFromLabel
,
                rangeFromLabel: range_from_label    //@property {Number} rangeTo
,
                rangeTo: range_to    //@property {String} rangeToLabel
,
                rangeToLabel: range_to_label
            };
            // @class Facets.FacetedNavigationItem.View
            return context;
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Facets
define('Facets.FacetedNavigation.View', [
    'Facets.Helper',
    'Facets.FacetedNavigationItem.View',
    'Profile.Model',
    'facets_faceted_navigation.tpl',
    'SC.Configuration',
    'Backbone',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'underscore'
], function (FacetsHelper, FacetsFacetedNavigationItemView, ProfileModel, facets_faceted_navigation_tpl, Configuration, Backbone, BackboneCompositeView, BackboneCollectionView, _) {
    'use strict';
    // @class Facets.FacetedNavigation.View @extends Backbone.View
    return Backbone.View.extend({
        template: facets_faceted_navigation_tpl,
        initialize: function (options) {
            BackboneCompositeView.add(this);
            this.categoryItemId = options.categoryItemId;
            this.clearAllFacetsLink = options.clearAllFacetsLink;
            this.hasCategories = options.hasCategories;
            this.hasItems = options.hasItems;
            this.hasFacets = options.hasFacets;
            this.hasCategoriesAndFacets = options.hasCategoriesAndFacets;
            this.appliedFacets = options.appliedFacets;
            this.hasFacetsOrAppliedFacets = options.hasFacetsOrAppliedFacets;
            this.keywords = options.keywords;
            this.totalProducts = options.totalProducts;
        },
        childViews: {
            'Facets.FacetedNavigationItems': function () {
                var translator = this.options.translator, ordered_facets = this.options.facets && this.options.facets.sort(function (a, b) {
                        // Default Priority is 0
                        return (translator.getFacetConfig(b.url || b.id).priority || 0) - (translator.getFacetConfig(a.url || a.id).priority || 0);
                    });
                //if prices aren't to be shown we take out price related facet
                var hidden_facet_names = Configuration.get('loginToSeePrices.hiddenFacetNames', []);
                if (ProfileModel.getInstance().hidePrices()) {
                    ordered_facets = _.reject(ordered_facets, function (item) {
                        return _.indexOf(hidden_facet_names, item.id) >= 0;
                    });
                }
                return new BackboneCollectionView({
                    childView: FacetsFacetedNavigationItemView,
                    viewsPerRow: 1,
                    collection: new Backbone.Collection(ordered_facets),
                    childViewOptions: { translator: translator }
                });
            }
        }    // @method getContext
             // @returns {Facets.FacetedNavigation.View.Context}
,
        getContext: function () {
            // @class Facets.FacetedNavigation.View.Context
            return {
                // @property {Number} totalProducts
                totalProducts: this.totalProducts,
                isTotalProductsOne: this.totalProducts === 1    // @property {String} keywords
,
                keywords: this.keywords,
                categoryItemId: this.categoryItemId,
                clearAllFacetsLink: this.clearAllFacetsLink,
                hasCategories: this.hasCategories,
                hasItems: this.hasItems,
                hasFacets: this.hasFacets,
                hasCategoriesAndFacets: this.hasCategoriesAndFacets,
                appliedFacets: this.appliedFacets,
                hasAppliedFacets: this.appliedFacets && this.appliedFacets.length > 0    // @property {Array} hasFacetsOrAppliedFacets
,
                hasFacetsOrAppliedFacets: this.hasFacetsOrAppliedFacets
            };    // @class Facets.FacetedNavigation.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Facets
define('Facets.FacetsDisplay.View', [
    'Backbone.CollectionView',
    'facets_facets_display.tpl',
    'Backbone',
    'underscore'
], function (BackboneCollectionView, facets_facets_display_tpl, Backbone, _) {
    'use strict';
    // @class Facets.FacetsDisplay.View @extends Backbone.View
    return Backbone.View.extend({
        template: facets_facets_display_tpl    // @method getContext @return {Facets.FacetsDisplay.View.Context}
,
        getContext: function () {
            var facets = this.options.facets, translator = this.options.translator;
            _.each(facets, function (facet) {
                facet.value = _.isArray(facet.value) ? facet.value : [facet.value];
            });
            var facet_values = [];
            _.each(facets, function (facet) {
                _.each(facet.value, function (value) {
                    var value_data = {
                        facetValueIsObject: _.isObject(value),
                        from: _.isObject(value) ? _.formatCurrency(value.from) : '',
                        to: _.isObject(value) ? _.formatCurrency(value.to) : '',
                        valueLabel: translator.getLabelForValue(facet.id, value),
                        facetValueUrl: translator.cloneForFacetId(facet.id, value).getUrl(),
                        facetValue: facet.value
                    };
                    facet_values.push(value_data);
                });
            });
            // @class Facets.FacetsDisplay.View.Context
            return {
                // @property {Boolean} hasFacets
                hasFacets: facets.length > 0    // @property {String} clearAllFacetsLink
,
                clearAllFacetsLink: translator.cloneWithoutFacets().getUrl()    // @property {Array} values
,
                values: facet_values
            };    // @class Facets.FacetsDisplay.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Facets
define('Facets.ItemListDisplaySelector.View', [
    'facets_item_list_display_selector.tpl',
    'Backbone',
    'underscore'
], function (facets_item_list_display_selector_tpl, Backbone, _) {
    'use strict';
    // @class Facets.ItemListDisplaySelector.View @extends Backbone.View
    return Backbone.View.extend({
        template: facets_item_list_display_selector_tpl    // @method getContext @returns {Facets.ItemListDisplaySelector.View.Context}
,
        getContext: function () {
            var option_items = this.options.options, translator = this.options.translator, processed_option_items = [];
            _.each(option_items, function (option_item) {
                var processed_option_item = {
                    configOptionUrl: translator.cloneForOption('display', option_item.id).getUrl(),
                    isActive: translator.getOptionValue('display') === option_item.id,
                    isGrid: option_item.id === 'grid',
                    name: option_item.name,
                    icon: option_item.icon
                };
                processed_option_items.push(processed_option_item);
            });
            // @class Facets.ItemListDisplaySelector.View.Context
            return {
                // @property {String} configClasses				
                configClasses: this.options.configClasses,
                options: processed_option_items
            };    // @class Facets.ItemListDisplaySelector.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Facets
define('Facets.ItemListSortSelector.View', [
    'facets_item_list_sort_selector.tpl',
    'Profile.Model',
    'Backbone',
    'underscore'
], function (facets_item_list_sort_selector_tpl, ProfileModel, Backbone, _) {
    'use strict';
    // @class Facets.ItemListSortSelector.View @extends Backbone.View
    return Backbone.View.extend({
        // @property {function} template
        template: facets_item_list_sort_selector_tpl    // @method getContext @returns {Facets.ItemListSortSelector.View.Context}
,
        getContext: function () {
            var option_items = this.options.options, translator = this.options.translator, processed_option_items = [];
            //if price display is disabled, left aside the filters about price
            if (ProfileModel.getInstance().hidePrices()) {
                option_items = _.filter(option_items, function (item) {
                    return item.id.search('price') === -1;
                });
            }
            _.each(option_items, function (option_item) {
                var processed_option_item = {
                    configOptionUrl: translator.cloneForOptions({
                        order: option_item.id,
                        page: 1
                    }).getUrl(),
                    isSelected: translator.getOptionValue('order') === option_item.id ? 'selected' : '',
                    name: option_item.name,
                    className: option_item.id.replace(':', '-')
                };
                processed_option_items.push(processed_option_item);
            });
            // @class Facets.ItemListSortSelector.View.Context
            return {
                // @property {Array<Object>} options
                options: processed_option_items
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Facets
define('Facets.ItemListShowSelector.View', [
    'facets_item_list_show_selector.tpl',
    'Backbone',
    'underscore'
], function (facets_item_list_show_selector_tpl, Backbone, _) {
    'use strict';
    // @class Facets.ItemListShowSelector.View @extends Backbone.View
    return Backbone.View.extend({
        template: facets_item_list_show_selector_tpl    // @method getContext @returns {Facets.ItemListShowSelector.View.Context}
,
        getContext: function () {
            var option_items = this.options.options, translator = this.options.translator, processed_option_items = [];
            _.each(option_items, function (option_item) {
                var processed_option_item = {
                    configOptionUrl: translator.cloneForOptions({
                        show: option_item.items,
                        page: 1
                    }).getUrl(),
                    isSelected: parseInt(translator.getOptionValue('show'), 10) === option_item.items,
                    name: _(option_item.name).translate(option_item.items),
                    className: option_item.items
                };
                processed_option_items.push(processed_option_item);
            });
            // @class Facets.ItemListShowSelector.View.Context
            return {
                // @property {Array} options
                options: processed_option_items
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Facets
define('Facets.Empty.View', [
    'SC.Configuration',
    'facets_empty.tpl',
    'Utils',
    'Backbone'
], function (Configuration, facets_empty_tpl, Utils, Backbone) {
    'use strict';
    // @class Facets.Empty.View @extends Backbone.View
    return Backbone.View.extend({
        template: facets_empty_tpl    // @method getContext @returns {Facets.Empty.View.Context}
,
        getContext: function () {
            //@class Facets.Empty.View.Context
            return {
                // @property {String} keywords
                keywords: this.options.keywords
            };    //@classFacets.Empty.View.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('Facets.Browse.CategoryHeading.View', [
    'Categories.Utils',
    'Backbone',
    'facets_browse_category_heading.tpl'
], function (CategoriesUtils, Backbone, facetsBrowseCategoryHeadingTpl) {
    'use strict';
    return Backbone.View.extend({
        template: facetsBrowseCategoryHeadingTpl,
        getContext: function () {
            var additionalFields = CategoriesUtils.getAdditionalFields(this.model.attributes, 'categories.category.fields');
            return {
                // @property {String} name
                name: this.model.get('name')    // @property {String} banner
,
                banner: this.model.get('pagebannerurl')    // @property {String} description
,
                description: this.model.get('description')    // @property {String} pageheading
,
                pageheading: this.model.get('pageheading') || this.model.get('name')    // @property {Boolean} hasBanner
,
                hasBanner: !!this.model.get('pagebannerurl')    // @property {Object} additionalFields
,
                additionalFields: additionalFields
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Facets
define('Facets.CategoryCell.View', [
    'Categories.Utils',
    'facets_category_cell.tpl',
    'Backbone'
], function (CategoriesUtils, facets_category_cell_tpl, Backbone) {
    'use strict';
    // @class Facets.CategoryCell.View @extends Backbone.View
    return Backbone.View.extend({
        template: facets_category_cell_tpl    // @method getContext @return Facets.CategoryCell.View.Context
,
        getContext: function () {
            var additionalFields = CategoriesUtils.getAdditionalFields(this.model.attributes, 'categories.subCategories.fields');
            return {
                // @property {String} label
                name: this.model.get('name')    // @property {String} name
,
                url: this.model.get('fullurl')    // @property {String} image
,
                image: this.model.get('thumbnailurl')    // @property {Boolean} hasImage
,
                hasImage: !!this.model.get('thumbnailurl')    // @property {Object} additionalFields
,
                additionalFields: additionalFields
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Facets
define('Facets.FacetedNavigationItemCategory.View', [
    'Categories.Utils',
    'SC.Configuration',
    'facets_faceted_navigation_item_category.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'underscore'
], function (CategoriesUtils, Configuration, facets_faceted_navigation_item_category_tpl, Backbone, BackboneCompositeView, _) {
    'use strict';
    // @class Facets.FacetedNavigationItemCategory.View @extends Backbone.View
    return Backbone.View.extend({
        template: facets_faceted_navigation_item_category_tpl,
        events: { 'click [data-action="see-more"]': 'toggleSeeMoreLess' },
        initialize: function () {
            this.categories = this.model && (this.model.get('siblings') || this.model.get('categories')) || [];
            this.categoryUrl = this.options.categoryUrl;
            this.on('afterViewRender', this.renderCategories, this);
        }    //@method renderCategories
,
        renderCategories: function () {
            this.$('[data-collapsed="true"]').hide();
        },
        toggleSeeMoreLess: function (event) {
            var target = this.$(event.currentTarget), target_see_more = target.find('[data-type="see-more"]'), target_see_less = target.find('[data-type="see-less"]'), target_was_expanded = !!target.data('collapsed');
            if (target_was_expanded) {
                target_see_more.show();
                target_see_less.hide();
            } else {
                target_see_more.hide();
                target_see_less.show();
            }
            target.data('collapsed', !target_was_expanded);
        }    // @method getContext @return {Facets.FacetedNavigationItemCategory.View.Context}
,
        getContext: function () {
            var showFacet = this.categories.length, values = [], self = this, showMax = Configuration.get('categories.sideMenu.showMax'), uncollapsible = Configuration.get('categories.sideMenu.uncollapsible'), collapsed = Configuration.get('categories.sideMenu.collapsed');
            _.each(this.categories, function (category) {
                values.push({
                    displayName: category.name,
                    label: category.name,
                    link: category.fullurl,
                    isActive: category.fullurl === self.categoryUrl,
                    additionalFields: CategoriesUtils.getAdditionalFields(category, 'categories.sideMenu.additionalFields')
                });
            });
            var max = showMax || values.length, displayValues = _.first(values, max), extraValues = _.rest(values, max);
            var breadcrumb = this.model && (this.model.get('breadcrumb') || []), parentName = '';
            if (breadcrumb && breadcrumb.length) {
                var index = breadcrumb.length > 1 ? breadcrumb.length - 2 : breadcrumb.length - 1;
                parentName = breadcrumb[index].name;
            }
            // @class Facets.FacetedNavigationItemCategory.View.Context
            return {
                //@property {String} htmlId
                htmlId: _.uniqueId('commercecategory_')    // @property {String} facetId
,
                facetId: 'commercecategory'    // @property {Boolean} showFacet
,
                showFacet: !!showFacet    //@property {Array<Object>} values
,
                values: values    // @property {Array<Object>} displayValues
,
                displayValues: displayValues    //@property {Array<Object>} extraValues
,
                extraValues: extraValues    //@property {Boolean} showExtraValues
,
                showExtraValues: !!extraValues.length,
                isUncollapsible: !!uncollapsible    //@property {Boolean} isCollapsed
,
                isCollapsed: !uncollapsible && collapsed    //@property {String} parentName
,
                parentName: parentName    // @class Facets.FacetedNavigationItemCategory.View
            };
        }
    });
});




/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Facets
define('Facets.Browse.View', [
    'SC.Configuration',
    'LiveOrder.Model',
    'Facets.Helper',
    'Categories',
    'Categories.Utils',
    'Facets.FacetedNavigation.View',
    'Facets.FacetedNavigationItem.View',
    'Facets.FacetsDisplay.View',
    'Facets.ItemListDisplaySelector.View',
    'Facets.ItemListSortSelector.View',
    'Facets.ItemListShowSelector.View',
    'Facets.ItemCell.View',
    'Facets.Empty.View',
    'Facets.Browse.CategoryHeading.View',
    'Facets.CategoryCell.View',
    'Facets.FacetedNavigationItemCategory.View',
    'Facets.Helper',
    'GlobalViews.Pagination.View',
    'Tracker',
    'facets_facet_browse.tpl',
    'facets_items_collection.tpl',
    'facets_items_collection_view_cell.tpl',
    'facets_items_collection_view_row.tpl',
    'Backbone',
    'Backbone.CollectionView',
    'Backbone.CompositeView',
    'underscore',
    'jQuery',
    'Utils',
    'Bootstrap.Slider'
], function (Configuration, LiveOrderModel, Helper, Categories, CategoriesUtils, FacetsFacetedNavigationView, FacetsFacetedNavigationItemView, FacetsFacetsDisplayView, FacetsItemListDisplaySelectorView, FacetsItemListSortSelectorView, FacetsItemListShowSelectorView, FacetsItemCellView, FacetsEmptyView, FacetsBrowseCategoryHeadingView, FacetsCategoryCellView, FacetsFacetedNavigationItemCategoryView, FacetsHelper, GlobalViewsPaginationView, Tracker, facets_facet_browse_tpl, facets_items_collection_tpl, facets_items_collection_view_cell_tpl, facets_items_collection_view_row_tpl, Backbone, BackboneCollectionView, BackboneCompositeView, _, jQuery, Utils) {
    'use strict';
    // statuses stores the statuses of the collapsible facets
    var statuses = window.statuses = {}    // collapsable_elements stores the statuses of the collapsible elements. This store elements collapsable that are not facets
              /*
		each object should be of the form
		{
			selector: '' //id of the element that will collapsed/expanded
		,	collapsed: true/false
		}
		*/, collapsable_elements = window.collapsable_elements = {};
    //@class Facets.Browse.View View that handles the item list @extends Backbone.View
    return Backbone.View.extend({
        template: facets_facet_browse_tpl,
        description: _('This is a description').translate(),
        attributes: {
            'id': 'facet-browse',
            'class': 'view facet-browse',
            'data-root-component-id': 'Facets.Browse.View'
        },
        events: {
            'click [data-toggle="facet-navigation"]': 'toggleFacetNavigation',
            'click [data-action="toggle-filters"]': 'toggleFilters',
            'click [data-view="Facets.FacetsDisplay"] a': '_gotoFacets',
            'click [data-view="Facets.FacetedNavigation"] a': '_gotoFacets',
            'click [data-view="GlobalViews.Pagination"] a': '_gotoPage',
            'click [data-view="Facets.ItemListDisplaySelector"] a': '_gotoDisplay',
            'change [data-view="Facets.ItemListShowSelector"] select': '_gotoShow',
            'change [data-view="Facets.ItemListSortSelector"] select': '_gotoOrder'
        },
        initialize: function (options) {
            BackboneCompositeView.add(this);
            this.statuses = statuses;
            this.collapsable_elements = collapsable_elements;
            this.translator = this.setOptionsTranslator(options.translator);
            this.application = options.application;
            this.itemsDisplayOptions = Utils.deepCopy(options.application.getConfig('itemsDisplayOptions'));
            this.resultsPerPage = Utils.deepCopy(options.application.getConfig('resultsPerPage'));
            this.sortOptions = Utils.deepCopy(options.application.getConfig('sortOptions'));
            _.each(this.resultsPerPage, function (perPage) {
                perPage.id = String(perPage.items);
            });
            this.cart = LiveOrderModel.getInstance();
            this.collapsable_elements['facet-header'] = this.collapsable_elements['facet-header'] || {
                selector: 'this.collapsable_elements["facet-header"]',
                collapsed: false
            };
        }    // @method getPagination Return the info of the current options in the PLP
             // @return {Object}
,
        getPagination: function getPagination() {
            return {
                currentPage: this.translator.getOptionValue('page'),
                pageCount: this.totalPages,
                itemCount: this.model.get('total'),
                pageSize: parseInt(this.translator.getOptionValue('show'), 10),
                sorting: this.translator.getOptionValue('order'),
                display: this.translator.getOptionValue('display'),
                filters: this._getFacetsTranslator(this.translator),
                searchText: this.translator.getOptionValue('keywords')
            };
        },
        _setEvent: function _setEvent(options) {
            this.setEvent(options.eventName, options.value).fail(function () {
                if (options.event.currentTarget.nodeName === 'SELECT') {
                    options.event.currentTarget.value = options.valueOriginal;
                }
                options.event.stopPropagation();
                options.event.preventDefault();
            });
        },
        _getFacetsTranslator: function (translator) {
            var facets = {}, allFacets = translator.getAllFacets();
            _.each(allFacets, function (facet) {
                facets[facet.url] = facet.value;
            });
            return facets;
        },
        _gotoFacets: function _gotoFacet(e) {
            var url = e.currentTarget.href, translator = FacetsHelper.parseUrl(url, this.translator.configuration, !!this.model.get('category'));
            this._setEvent({
                event: e,
                eventName: 'Filters',
                value: this._getFacetsTranslator(translator)
            });
        },
        _gotoDisplay: function gotoDisplay(e) {
            var default_value = _.find(this.itemsDisplayOptions, function (result) {
                    return result.isDefault;
                }).id, display = Utils.getParameterByName(e.currentTarget.href, 'display') || default_value;
            this._setEvent({
                event: e,
                eventName: 'Display',
                value: display
            });
        },
        _gotoShow: function gotoShow(e) {
            var original = this.translator.getUrl(), default_value = _.find(this.resultsPerPage, function (result) {
                    return result.isDefault;
                }).id, show = parseInt(Utils.getParameterByName(e.currentTarget.value, 'show'), 10) || default_value;
            this._setEvent({
                event: e,
                eventName: 'PageSize',
                value: show,
                valueOriginal: original
            });
        },
        _gotoOrder: function gotoOrder(e) {
            var original = this.translator.getUrl(), default_value = _.find(this.sortOptions, function (result) {
                    return result.isDefault;
                }).id, order = Utils.getParameterByName(e.currentTarget.value, 'order') || default_value;
            this._setEvent({
                event: e,
                eventName: 'Sorting',
                value: order,
                valueOriginal: original
            });
        },
        _gotoPage: function gotoPage(e) {
            var order = parseInt(Utils.getParameterByName(e.currentTarget.href, 'page'), 10) || 1;
            this._setEvent({
                event: e,
                eventName: 'CurrentPage',
                value: order
            });
        },
        setEvent: function setEvent(event_name, value) {
            var self = this, pagination = this.getPagination();
            pagination['set' + event_name] = value;
            return this.model.cancelableTrigger('before:FacetModel.set' + event_name, pagination).done(function () {
                Backbone.history.once('route', function () {
                    var pagination = self.getPagination();
                    pagination[event_name.charAt(0).toLowerCase() + event_name.slice(1)] = value;
                    self.model.cancelableTrigger('after:FacetModel.set' + event_name, pagination);
                });
            });
        }    //@method toggleFilters
,
        toggleFilters: function (e) {
            e.preventDefault();
            var current_target = jQuery(e.currentTarget);
            this.collapsable_elements['facet-header'].collapsed = !this.collapsable_elements['facet-header'].collapsed;
            current_target.find('.filter-icon').toggleClass('icon-chevron-up');
            current_target.parents('[data-type="accordion"]').toggleClass('well').toggleClass('facet-header-white-well').find('[data-type="accordion-body"]').stop().slideToggle();
        }    //@method getPath
,
        getPath: function () {
            var base_url = window.location.protocol + '//' + window.location.hostname;
            if (this.model.get('category')) {
                var category_canonical = this.model.get('category').get('canonical') || this.model.get('category').get('fullurl');
                return (category_canonical.indexOf('/') === 0 ? base_url : '') + category_canonical;
            } else {
                var canonical = base_url + '/' + Backbone.history.fragment, index_of_query = canonical.indexOf('?');
                // !~ means: indexOf == -1
                return !~index_of_query ? canonical : canonical.substring(0, index_of_query);
            }
        }    //@method getCanonical
,
        getCanonical: function () {
            var canonical_url = this.getPath(), current_page = this.translator.getOptionValue('page');
            if (current_page > 1) {
                canonical_url += '?page=' + current_page;
            }
            return canonical_url;
        }    //@method getRelPrev
,
        getRelPrev: function () {
            var previous_page_url = this.getPath(), current_page = this.translator.getOptionValue('page');
            if (current_page > 1) {
                if (current_page === 2) {
                    return previous_page_url;
                }
                if (current_page > 2) {
                    return previous_page_url += '?page=' + (current_page - 1);
                }
            }
            return null;
        }    //@method getRelNext
,
        getRelNext: function () {
            var next_page_url = this.getPath(), current_page = this.translator.getOptionValue('page');
            if (current_page < this.totalPages) {
                return next_page_url += '?page=' + (current_page + 1);
            }
            return null;
        }    //@method formatFacetTitle: accepts a facet object and returns a string formatted to be displayed on the document's title according with user facet configuration property titleToken
             //@param {Object} facet @returns {String}
,
        formatFacetTitle: function (facet) {
            var defaults = {
                range: '$(2): $(0) to $(1)',
                multi: '$(1): $(0)',
                single: '$(1): $(0)'
            };
            if (!facet.config.titleToken) {
                facet.config.titleToken = defaults[facet.config.behavior] || defaults.single;
            }
            if (_.isFunction(facet.config.titleToken)) {
                return facet.config.titleToken(facet);
            } else if (facet.config.behavior === 'range') {
                return _(facet.config.titleToken).translate(facet.value.to, facet.value.from, facet.config.name);
            } else if (facet.config.behavior === 'multi') {
                var buffer = [];
                _.each(facet.value, function (val) {
                    buffer.push(val);
                });
                return _(facet.config.titleToken).translate(buffer.join(', '), facet.config.name);
            } else {
                var value = this.translator.getLabelForValue(facet.config.id, facet.value);
                return _(facet.config.titleToken).translate(value, facet.config.name);
            }
        }    // @method getTitle overrides Backbone.Views.getTitle
,
        getTitle: function () {
            if (this.title) {
                return this.title;
            }
            var facets = this.options.translator.facets, category = this.model.get('category'), title = category ? category.get('pagetitle') || _.pluck(this.getBreadcrumbPages(), 'text').join(' > ') : this.title;
            if (facets && facets.length) {
                var buffer = [], facet = null;
                for (var i = 0; i < facets.length; i++) {
                    facet = facets[i];
                    buffer.push(this.formatFacetTitle(facet));
                    if (i < facets.length - 1) {
                        buffer.push(facet.config.titleSeparator || ', ');
                    }
                }
                title = title ? title + ' - ' : '';
                title = this.application.getConfig('searchTitlePrefix', '') + buffer.join('') + this.application.getConfig('searchTitleSuffix', '');
            } else if (this.translator.getOptionValue('keywords')) {
                title = _('Search results for "$(0)"').translate(this.translator.getOptionValue('keywords'));
            } else {
                title = title || this.application.getConfig('defaultSearchTitle', '');
            }
            // Update the meta tag 'twitter:title'
            this.setMetaTwitterTitle(title);
            return title;
        }    // @method getMetaDescription Get view's SEO attributes @return {String}
,
        getMetaDescription: function () {
            var category = this.model.get('category');
            return category && category.get('metadescription') || this.metaDescription;
        }    // @method getMetaKeywords @return {String}
,
        getMetaKeywords: function () {
            var category = this.model.get('category');
            return category && category.get('metakeywords') || this.metaKeywords;
        },
        getAddToHead: function () {
            var category = this.model.get('category');
            return category && category.get('addtohead') || this.addToHead;
        }    // @method setMetaTwitterTitle @param {Strnig}title
,
        setMetaTwitterTitle: function (title) {
            var seo_twitter_title = jQuery('meta[name="twitter:title"]');
            seo_twitter_title && seo_twitter_title.attr('content', title);
        }    //@method setOptionsTranslator Set up the default option for displaying the facets.
             //If we are in a small device, we've got to omit the 'grid' display option,
             //for it is not showing in this kind of devices. We must change it for 'table'
             //@param {Facets.Translator} translator
             //@return {Facets.Translator}
,
        setOptionsTranslator: function (translator) {
            if (translator.options.display === 'grid' && _.isPhoneDevice()) {
                translator.options.display = 'table';
            }
            return translator;
        }    // @method showContent overrides Backbone.View.showContent to works with the title to find the proper wording and calls the layout.showContent
,
        showContent: function () {
            // If its a free text search it will work with the title
            var self = this, keywords = this.translator.getOptionValue('keywords'), resultCount = this.model.get('total');
            if (keywords) {
                keywords = decodeURIComponent(keywords);
                if (resultCount > 0) {
                    this.subtitle = resultCount > 1 ? _('Results for "$(0)"').translate(keywords) : _('Result for "$(0)"').translate(keywords);
                } else {
                    this.subtitle = _('We couldn\'t find any items that match "$(0)"').translate(keywords);
                }
            }
            this.totalPages = Math.ceil(resultCount / this.translator.getOptionValue('show'));
            this.application.getLayout().showContent(this).done(function () {
                if (jQuery.fn.scPush) {
                    self.$el.find('[data-action="pushable"]').scPush({ target: 'tablet' });
                }
                Tracker.getInstance().trackEvent({
                    category: 'SearchItem-end',
                    action: 'render',
                    value: 1
                });
            });
        },
        render: function () {
            var list_type = 'Facets';
            if (this.model.get('category')) {
                list_type = 'Category';
            } else if (this.translator.getOptionValue('keywords')) {
                list_type = 'Search';
            }
            Tracker.getInstance().trackProductList(this.model.get('items'), list_type);
            this._render();
        }    // @method getBreadcrumbPages
             // It will generate an array suitable to pass it to the breadcrumb macro
             // It looks in the category facet value
             // @return {Array<Object>}
,
        getBreadcrumbPages: function () {
            var breadcrumb = [];
            if (this.model.get('category')) {
                var list = this.model.get('category').get('breadcrumb'), self = this;
                _.each(list, function (bread) {
                    breadcrumb.push({
                        'text': bread.name,
                        'href': bread.fullurl,
                        'additionalFields': CategoriesUtils.getAdditionalFields(self.model.get('category').attributes, 'categories.breadcrumb.fields')
                    });
                });
                return breadcrumb;
            } else if (this.translator.getOptionValue('keywords')) {
                breadcrumb.push({
                    href: '#',
                    text: _('Search Results').translate()
                });
            } else {
                breadcrumb.push({
                    href: '#',
                    text: _('Shop').translate()
                });
            }
            return breadcrumb;
        }    // @method toggleFacetNavigation Hides/Shows the facet navigation area
,
        toggleFacetNavigation: function () {
            this.$el.toggleClass('narrow-by');
            this.toggleNavigationListener(this.$el.hasClass('narrow-by'));
        }    // @method toggleNavigationListener
             // adds/removes event listeners to the HTML to hide the facet navigation area
             // @param {Boolean} isOn
,
        toggleNavigationListener: function (isOn) {
            var self = this, touch_started = null;
            // turn listeners on
            if (isOn) {
                jQuery('html')    // we save the time when the touchstart happened
.on('touchstart.narrow-by', function () {
                    touch_started = new Date().getTime();
                })    // code for touchend and mousdown is the same
.on('touchend.narrow-by mousedown.narrow-by', function (e) {
                    // if there wasn't a touch event, or the time difference between
                    // touch start and touch end is less that 200 miliseconds
                    // (this is to allow scrolling without closing the facet navigation area)
                    if (!touch_started || new Date().getTime() - touch_started < 200) {
                        var $target = jQuery(e.target);
                        // if we are not touching the narrow by button or the facet navigation area
                        if (!$target.closest('[data-toggle="facet-navigation"]').length && !$target.closest('#faceted-navigation').length) {
                            // we hide the navigation
                            self.toggleFacetNavigation();
                        }
                    }
                });
            } else {
                jQuery('html')    // if the navigation area is hidden, we remove the event listeners from the HTML
.off('mousedown.narrow-by touchstart.narrow-by touchend.narrow-by');
            }
        },
        contextData: {
            'itemList': function () {
                return Utils.deepCopy(this.model.get('items'));
            },
            'category': function () {
                return Utils.deepCopy(this.model.get('category'));
            }
        },
        childViews: {
            'Facets.FacetedNavigation': function (options) {
                var exclude = _.map((options.excludeFacets || '').split(','), function (facet_id_to_exclude) {
                        return jQuery.trim(facet_id_to_exclude);
                    }), has_categories = !!(this.category && this.category.categories), has_items = this.model.get('items').length, has_facets = has_items && this.model.get('facets').length, applied_facets = this.translator.cloneWithoutFacetId('category').facets, has_applied_facets = applied_facets.length;
                return new FacetsFacetedNavigationView({
                    categoryItemId: this.category && this.category.itemid,
                    clearAllFacetsLink: this.translator.cloneWithoutFacets().getUrl(),
                    hasCategories: has_categories,
                    hasItems: has_items    // facets box is removed if don't find items
,
                    hasFacets: has_facets,
                    hasCategoriesAndFacets: has_categories && has_facets    // Categories are not a real facet, so lets remove those
,
                    appliedFacets: applied_facets,
                    hasFacetsOrAppliedFacets: has_facets || has_applied_facets    //,	translatorUrl: this.translator.getUrl()
,
                    translator: this.translator,
                    facets: _.filter(this.model.get('facets'), function (facet) {
                        return !_.contains(exclude, facet.id);
                    }),
                    totalProducts: this.model.get('total'),
                    keywords: this.translator.getOptionValue('keywords')
                });
            },
            'Facets.FacetsDisplay': function () {
                var facets = this.translator.cloneWithoutFacetId('category').getAllFacets().sort(function (a, b) {
                    return b.config.priority - a.config.priority;
                });
                return new FacetsFacetsDisplayView({
                    facets: facets,
                    translator: this.translator
                });
            },
            'Facets.ItemListDisplaySelector': function () {
                return new FacetsItemListDisplaySelectorView({
                    configClasses: 'pull-right',
                    options: this.itemsDisplayOptions,
                    translator: this.translator
                });
            },
            'Facets.ItemListSortSelector': function () {
                return new FacetsItemListSortSelectorView({
                    options: this.sortOptions,
                    translator: this.translator
                });
            }    //Show 'XX products per page' View
,
            'Facets.ItemListShowSelector': function () {
                return new FacetsItemListShowSelectorView({
                    options: this.resultsPerPage,
                    translator: this.translator
                });
            }    //Extra Facet filter View
,
            'Facets.FacetedNavigation.Item': function (options) {
                var facet_config = this.translator.getFacetConfig(options.facetId), contructor_options = {
                        model: new Backbone.Model(_.findWhere(this.model.get('facets'), { id: options.facetId })),
                        translator: this.translator
                    };
                if (facet_config.template) {
                    contructor_options.template = facet_config.template;
                }
                return new FacetsFacetedNavigationItemView(contructor_options);
            },
            'Facets.Items': function () {
                var self = this, display_option = _.find(this.itemsDisplayOptions, function (option) {
                        return option.id === self.options.translator.getOptionValue('display');
                    });
                return new BackboneCollectionView({
                    childTemplate: display_option.template,
                    childView: FacetsItemCellView,
                    childViewOptions: { application: this.application },
                    viewsPerRow: parseInt(display_option.columns, 10),
                    collection: this.model.get('items'),
                    cellTemplate: facets_items_collection_view_cell_tpl,
                    rowTemplate: facets_items_collection_view_row_tpl,
                    template: facets_items_collection_tpl,
                    context: { keywords: this.translator.getOptionValue('keywords') }
                });
            },
            'Facets.Items.Empty': function () {
                return new FacetsEmptyView({ keywords: this.translator.getOptionValue('keywords') });
            },
            'GlobalViews.Pagination': function () {
                var translator = this.translator;
                return new GlobalViewsPaginationView(_.extend({
                    currentPage: translator.getOptionValue('page'),
                    totalPages: this.totalPages,
                    pager: function (page) {
                        return translator.cloneForOption('page', page).getUrl();
                    }
                }, Configuration.defaultPaginationSettings));
            },
            'Facets.Browse.CategoryHeading': function () {
                return new FacetsBrowseCategoryHeadingView({
                    model: this.model.get('category'),
                    showDescription: this.translator.cloneWithoutFacetId('category').getAllFacets().length === 0
                });
            },
            'Facets.CategoryCells': function () {
                return new BackboneCollectionView({
                    childView: FacetsCategoryCellView,
                    collection: this.model.get('category') ? this.model.get('category').get('categories') : []
                });
            },
            'Facets.CategorySidebar': function () {
                return new FacetsFacetedNavigationItemCategoryView({
                    model: this.model.get('category'),
                    categoryUrl: this.translator.getCategoryUrl()
                });
            }
        }    //@method getContext @returns {Facets.Browse.View.Context}
,
        getContext: function () {
            var hasSelectedFacets = this.translator.cloneWithoutFacetId('category').getAllFacets().length, hasSubcategories = this.model.get('category') ? this.model.get('category').get('categories').length : false, hasItems = this.model.get('items') && this.model.get('items').length > 0;
            // @class Facets.Browse.View.Context
            return {
                // @property {Number} total
                total: this.model.get('total')    // @property {Boolean} isTotalProductsOne
,
                isTotalProductsOne: this.model.get('total') === 1    // @property {String} title
,
                title: this.getTitle()    // @property {Boolean} hasItemsAndFacets
,
                hasItemsAndFacets: !!(hasItems && this.model.get('facets').length)    // @property {Boolean} collapseHeader
,
                collapseHeader: !!this.collapsable_elements['facet-header'].collapsed    // @property {String} keywords
,
                keywords: this.translator.getOptionValue('keywords')    // @property {Boolean} showResults
,
                showResults: _.isNull(this.translator.getOptionValue('keywords')) ? true : this.model.get('total') > 0    // @property {Boolean} isEmptyList
,
                isEmptyList: this.model.get('total') <= 0    // @property {Boolean} isCategory
,
                isCategory: !!this.model.get('category')    // @property {Boolean} showItems
,
                showItems: hasItems || !hasItems && hasSelectedFacets || !(!hasItems && !hasSelectedFacets && hasSubcategories)
            };    // @class Facets.Browse.View
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module SocialSharing
// Provides standalone social sharing icons
define('SocialSharing', [
    'SC.Configuration',
    'PluginContainer',
    'Facets.Browse.View',
    'jQuery',
    'underscore',
    'Utils'
], function (Configuration, PluginContainer, BrowseView, jQuery, _, Utils) {
    'use strict';
    // @class SocialSharing Responsible of showing social sharing widgets in a page. It consists on plugin
    // containers and each plugin takes care of implementing a particular social network. There are two plugin
    // containers one for hooking into afterAppendView and other for afterAppendToDom
    // @extends ApplicationModule
    var SocialSharing = {
        // @method getPopupOptionsStringFromObject
        // {translates: "this", to: ""} to translates=this,to=
        getPopupOptionsStringFromObject: function (popup_options) {
            var popup_options_string = '';
            _.each(popup_options, function (value, name) {
                popup_options_string += ',' + name + '=' + value;
            });
            // the substring is to get rid of the leading coma
            return popup_options_string.substring(1);
        }    // @method setMetaTagsByConfiguration
,
        setMetaTagsByConfiguration: function (self, meta_tag_configuration) {
            _.each(meta_tag_configuration, function (fn, name) {
                var content = fn(self);
                jQuery('<meta />', {
                    name: name,
                    content: content || ''
                }).appendTo(jQuery('head'));
            });
        }    // @method setLinTagsByConfiguration
,
        setLinkTagsByConfiguration: function (self, link_tag_configuration) {
            _.each(link_tag_configuration, function (fn, rel) {
                var href = fn(self);
                if (href) {
                    jQuery('<link />', {
                        rel: rel,
                        href: href
                    }).appendTo(jQuery('head'));
                }
            });
        }    // @method clearMetaTagsByConfiguration
,
        clearMetaTagsByConfiguration: function (meta_tag_configuration) {
            var meta_tag;
            _.each(meta_tag_configuration, function (fn, name) {
                meta_tag = jQuery('meta[name="' + name + '"]');
                meta_tag && meta_tag.remove();
            });
        }    // @method clearLinkTagsByConfiguration
,
        clearLinkTagsByConfiguration: function (self, link_tag_configuration) {
            var link_tag;
            _.each(link_tag_configuration, function (fn, rel) {
                if (fn(self)) {
                    link_tag = jQuery('link[rel="' + rel + '"]');
                    link_tag && link_tag.remove();
                }
            });
        }    // @method setMetaTags Based on the meta tags config
,
        setMetaTags: function () {
            var self = this, application = this.getApplication(), current_view = application.getLayout().currentView, meta_tag_mapping_og = Configuration.metaTagMappingOg, meta_tag_mapping_twitter_product_card = Configuration.metaTagMappingTwitterProductCard, meta_tag_mapping_twitter_gallery_card = Configuration.metaTagMappingTwitterGalleryCard, link_tag_google_plus_authorship = Configuration.linkTagGooglePlusAuthorship;
            // Clear meta tags if required
            this.clearMetaTagsByConfiguration(meta_tag_mapping_og);
            this.clearMetaTagsByConfiguration(meta_tag_mapping_twitter_product_card);
            this.clearMetaTagsByConfiguration(meta_tag_mapping_twitter_gallery_card);
            if (current_view instanceof BrowseView) {
                // Set meta tags for BrowseView
                this.setMetaTagsByConfiguration(self, meta_tag_mapping_twitter_gallery_card);
            }
            // In all pages clear/set Google Plus authorship
            this.clearLinkTagsByConfiguration(self, link_tag_google_plus_authorship);
            this.setLinkTagsByConfiguration(self, link_tag_google_plus_authorship);
        }    // @property {PluginContainer} afterAppendView
,
        afterAppendView: new PluginContainer()    // @property {PluginContainer} afterAppendToDom
,
        afterAppendToDom: new PluginContainer(),
        mountToApp: function (application) {
            var self = this, layout = application.getLayout();
            _.extend(layout, {
                getPopupOptionsStringFromObject: this.getPopupOptionsStringFromObject,
                setMetaTags: this.setMetaTags,
                clearLinkTagsByConfiguration: this.clearLinkTagsByConfiguration,
                clearMetaTagsByConfiguration: this.clearMetaTagsByConfiguration,
                setLinkTagsByConfiguration: this.setLinkTagsByConfiguration,
                setMetaTagsByConfiguration: this.setMetaTagsByConfiguration
            });
            layout.on('afterAppendView', function () {
                this.$el.find('[data-type="social-share-icons"]').empty();
                this.setMetaTags();
                if (!Utils.isPageGenerator()) {
                    self.afterAppendView.executeAll(application);
                }
            });
            layout.on('afterAppendToDom', function () {
                if (!Utils.isPageGenerator()) {
                    self.afterAppendToDom.executeAll(application);
                }
            });
        }
    };
    return SocialSharing;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module SocialSharing
define('SocialSharing.Plugins.Facebook', [
    'SC.Configuration',
    'SocialSharing',
    'UrlHelper',
    'Utils',
    'jQuery',
    'underscore'
], function (Configuration, SocialSharing, UrlHelper, Utils, jQuery, _) {
    'use strict';
    // @class SocialSharing.Facebook @extends ApplicationModule
    var facebookPlugin = {
        shareInFacebookEventListener: function () {
            var url = window.location.href, popup_options_string = this.getPopupOptionsStringFromObject(Configuration.get('facebook.popupOptions')), target_url = 'https://www.facebook.com/dialog/share?display=popup&app_id=' + Configuration.get('facebook.appId') + '&href=' + encodeURIComponent(url) + '&redirect_uri=' + encodeURIComponent(_.addParamsToUrl(url, { closeFBPopup: 1 }));
            window.open(target_url, _.uniqueId('window'), popup_options_string);
        },
        mountToApp: function (application) {
            //This will close the popup window after the redirect occurs (after the user shares).
            UrlHelper.addTokenListener('closeFBPopup', function () {
                window.close();
            });
            if (Configuration.get('facebook.enable')) {
                var layout = application.getLayout();
                // This are mostly related to the dom, or to events, so we add them in the layout
                _.extend(layout.events, { 'click [data-action="share-in-facebook"]': this.shareInFacebookEventListener });
                // @class SocialSharing.Facebook.Plugin this plugin is installed in both
                // SocialSharing.afterAppendView and SocialSharing.afterAppendToDom @extends Plugin
                var plugin = {
                    name: 'facebookPlugin',
                    priority: 10,
                    execute: function (application) {
                        var layout = application.getLayout();
                        if (!jQuery('[data-type="like-in-facebook"]').size()) {
                            layout.$el.find('[data-type="social-share-icons"]').append('<a href="#" class="social-sharing-flyout-content-social-facebook" data-action="share-in-facebook"><i class="social-sharing-flyout-content-social-facebook-icon"></i> <span>Share</span></a>');
                        }
                    }
                };
                SocialSharing.afterAppendView.install(plugin);
                SocialSharing.afterAppendToDom.install(plugin);
            }
        }
    };
    return facebookPlugin;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module SocialSharing
define('SocialSharing.Plugins.Twitter', [
    'SC.Configuration',
    'SocialSharing',
    'underscore'
], function (Configuration, SocialSharing, _) {
    /*jshint validthis:true*/
    'use strict';
    // @class SocialSharing.Twitter @extends ApplicationModule
    var twitterPlugin = {
        // @method shareInTwitter
        // opens a new window to share the page in Twitter
        // based on some configuration options
        // @param {String}url @param {String}description @param {String}via @param {Object}popup_options
        shareInTwitter: function (url, description, via, popup_options) {
            var popup_options_string = this.getPopupOptionsStringFromObject(popup_options || Configuration.get('twitter.popupOptions')), target_url = 'https://twitter.com/intent/tweet?original_referer=' + encodeURIComponent(url) + '&source=tweetbutton&text=' + encodeURIComponent(description) + '&url=' + encodeURIComponent(url) + '&via=' + encodeURIComponent(via);
            window.open(target_url, _.uniqueId('window'), popup_options_string);
        }    // @method shareInTwitterEventListener
             // calls shareInTwitter method passing the configuration options
,
        shareInTwitterEventListener: function (e) {
            e.preventDefault();
            var metaTagMappingOg = Configuration.get('metaTagMappingOg'), url = metaTagMappingOg['og:url'](this), title = metaTagMappingOg['og:title'](this), via = Configuration.get('twitter.via') ? Configuration.get('twitter.via').replace('@', '') : '';
            this.shareInTwitter(url, title, via);
        },
        mountToApp: function (application) {
            if (Configuration.get('twitter.enable')) {
                var layout = application.getLayout();
                // This are mostly related to the dom, or to events, so we add them in the layout
                _.extend(layout, { shareInTwitter: this.shareInTwitter });
                // extend Layout and add event listeners
                _.extend(layout.events, { 'click [data-action="share-in-twitter"]': this.shareInTwitterEventListener });
                // @class SocialSharing.Twitter.Plugin @extends Plugin
                SocialSharing.afterAppendView.install({
                    name: 'twitterPlugin',
                    priority: 10,
                    execute: function (application) {
                        var layout = application.getLayout();
                        layout.$el.find('[data-type="social-share-icons"]').append('<a href="#" class="social-sharing-flyout-content-social-twitter" data-action="share-in-twitter"><i class="social-sharing-flyout-content-social-twitter-icon"></i> <span>Tweet</span></a>');
                    }
                });
            }
        }
    };
    return twitterPlugin;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module SocialSharing
define('SocialSharing.Plugins.GooglePlus', [
    'SC.Configuration',
    'SocialSharing',
    'underscore'
], function (Configuration, SocialSharing, _) {
    'use strict';
    //@class SocialSharing.GooglePlus @extends ApplicationModule
    var googleplusPlugin = {
        // @method shareInGooglePlus opens a new window to share the page in Google+ based on some configuration options
        shareInGooglePlus: function (url, popup_options) {
            var popup_options_string = this.getPopupOptionsStringFromObject(popup_options || Configuration.get('googlePlus.popupOptions')), target_url = 'https://plus.google.com/share?url=' + encodeURIComponent(url);
            window.open(target_url, _.uniqueId('window'), popup_options_string);
        }    // @method shareInGooglePlusEventListener
             // calls shareInGooglePlus method passing the configuration options
,
        shareInGooglePlusEventListener: function (e) {
            e.preventDefault();
            var metaTagMappingOg = Configuration.get('metaTagMappingOg'), url = metaTagMappingOg['og:url'](this);
            this.shareInGooglePlus(url);
        },
        mountToApp: function (application) {
            if (Configuration.get('googlePlus.enable')) {
                var layout = application.getLayout();
                // This are mostly related to the dom, or to events, so we add them in the layout
                _.extend(layout, { shareInGooglePlus: this.shareInGooglePlus });
                // extend Layout and add event listeners
                _.extend(layout.events, { 'click [data-action="share-in-google-plus"]': this.shareInGooglePlusEventListener });
                //@class SocialSharing.GooglePlus.Plugin @extends Plugin
                SocialSharing.afterAppendView.install({
                    name: 'googleplusPlugin',
                    priority: 10,
                    execute: function (application) {
                        var layout = application.getLayout();
                        layout.$el.find('[data-type="social-share-icons"]').append('<a href="#" class="social-sharing-flyout-content-social-google" data-action="share-in-google-plus"><i class="social-sharing-flyout-content-social-google-icon"></i> <span>Google +</span></a>');
                    }
                });
            }
        }
    };
    return googleplusPlugin;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module SocialSharing
define('SocialSharing.Plugins.Pinterest', [
    'SC.Configuration',
    'SocialSharing',
    'jQuery',
    'underscore'
], function (Configuration, SocialSharing, jQuery, _) {
    'use strict';
    //@class SocialSharing.Pinterest @extends ApplicationModule
    var pinterestPlugin = {
        // @method shareInPinterest
        // opens a new window to share the page in Pinterest
        // based on some configuration options
        shareInPinterest: function (url, image, description, popup_options) {
            var popup_options_string = this.getPopupOptionsStringFromObject(popup_options || Configuration.get('pinterest.popupOptions')), target_url = 'http://pinterest.com/pin/create/button/?url=' + encodeURIComponent(url) + '&media=' + encodeURIComponent(image) + '&description=' + encodeURIComponent(description);
            window.open(target_url, _.uniqueId('window'), popup_options_string);
        }    // @method shareInPinterestEventListener
             // calls shareInPinterest method passing the configuration options
,
        shareInPinterestEventListener: function (e) {
            e.preventDefault();
            var metaTagMappingOg = Configuration.get('metaTagMappingOg'), url = metaTagMappingOg['og:url'](this), image = metaTagMappingOg['og:image'](this), title = metaTagMappingOg['og:title'](this);
            this.shareInPinterest(url, image, title);
        },
        mountToApp: function (application) {
            if (Configuration.get('pinterest.enableButton')) {
                var layout = application.getLayout();
                // This are mostly related to the dom, or to events, so we add them in the layout
                _.extend(layout, { shareInPinterest: this.shareInPinterest });
                // extend Layout and add event listeners
                _.extend(layout.events, { 'click [data-action="share-in-pinterest"]': this.shareInPinterestEventListener });
                //@class SocialSharing.Pinterest.Plugin @extends Plugin
                SocialSharing.afterAppendView.install({
                    name: 'pinterestPlugin',
                    priority: 10,
                    execute: function (application) {
                        var layout = application.getLayout();
                        layout.$el.find('[data-type="social-share-icons"]').append('<a href="#" class="social-sharing-flyout-content-social-pinterest" data-action="share-in-pinterest"><i class="social-sharing-flyout-content-social-pinterest-icon"></i> <span>Pinit</span></a>');
                    }
                });
            }
        }
    };
    return pinterestPlugin;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module SocialSharing
define('SocialSharing.Plugins.Pinterest.Hover', [
    'SC.Configuration',
    'SocialSharing',
    'Backbone.View',
    'jQuery',
    'underscore'
], function (Configuration, SocialSharing, BackboneView, jQuery, _) {
    'use strict';
    //@class SocialSharing.Pinterest.Hover @extends ApplicationModule
    var pinterestPluginHover = {
        // @method shareInPinterest
        // opens a new window to share the page in Pinterest
        // based on some configuration options
        shareInPinterest: function (url, image, description, popup_options) {
            var popup_options_string = this.getPopupOptionsStringFromObject(popup_options || Configuration.get('pinterest.popupOptions')), target_url = 'http://pinterest.com/pin/create/button/?url=' + encodeURIComponent(url) + '&media=' + encodeURIComponent(image) + '&description=' + encodeURIComponent(description);
            window.open(target_url, _.uniqueId('window'), popup_options_string);
        }    // @method shareInPinterestHoverEventListener
             // calls shareInPinterestHoverEventListener method passing the configuration options
,
        shareInPinterestHoverEventListener: function (e) {
            e.preventDefault();
            var image_size = Configuration.get('pinterest.imageSize'), metaTagMappingOg = Configuration.get('metaTagMappingOg'), url = metaTagMappingOg['og:url'](this), image = jQuery('a.bx-pager-link.active').find('img').attr('src') || jQuery('a.bx-pager-link').eq(0).find('img').attr('src')    // selected image
, title = metaTagMappingOg['og:title'](this);
            if (!image) {
                image = jQuery('.product-details-image-gallery-detailed-image').find('img').attr('src');
            }
            image = this.getApplication().resizeImage(image.split('?')[0], image_size);
            this.shareInPinterest(url, image, title);
        },
        mountToApp: function (application) {
            if (Configuration.get('pinterest.enableHover')) {
                var layout = application.getLayout();
                // This are mostly related to the dom, or to events, so we add them in the layout
                _.extend(layout, { shareInPinterest: this.shareInPinterest });
                // extend Layout and add event listeners
                _.extend(layout.events, { 'click [data-action="share-in-pinterest-hover"]': this.shareInPinterestHoverEventListener });
                //@class SocialSharing.Pinterest.Plugin @extends Plugin
                BackboneView.postRender.install({
                    name: 'pinterestPluginHover',
                    priority: 10,
                    execute: function ($el) {
                        if (!$el.find('[data-action="share-in-pinterest-hover"]').length) {
                            $el.find('[data-type="social-share-icons-hover"]').append('<a href="#" class="social-sharing-flyout-content-social-pinterest" data-action="share-in-pinterest-hover"><i class="social-sharing-flyout-content-social-pinterest-icon"></i> Pinit</a>');
                        }
                    }
                });
            }
        }
    };
    return pinterestPluginHover;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/* global addthis:true */
// @module SocialSharing
define('SocialSharing.Plugins.AddThis', [
    'SC.Configuration',
    'SocialSharing',
    'jQuery',
    'underscore'
], function (Configuration, SocialSharing, jQuery, _) {
    'use strict';
    // @class SocialSharing.AddThis @extends ApplicationModule
    var addthisPlugin = {
        // @method refreshAddThisElements
        // re-writes the DOM of the AddThis elements
        refreshAddThisElements: function () {
            if (typeof addthis === 'undefined' || !jQuery('[data-type="share-in-add-this"]').size()) {
                return;
            }
            var metaTagMappingOg = Configuration.get('metaTagMappingOg'), innerHTML = '';
            _.each(Configuration.get('addThis.servicesToShow'), function (name, code) {
                innerHTML += '<a class="addthis_button_' + code + '">' + name + '</a>';
            });
            var share_options = {
                url: metaTagMappingOg['og:url'](this),
                title: metaTagMappingOg['og:title'](this),
                description: metaTagMappingOg['og:description'](this)
            };
            jQuery('[data-type="share-in-add-this"]').each(function () {
                if (this) {
                    var $this = jQuery(this);
                    $this.html(innerHTML).addClass(Configuration.get('addThis.toolboxClass'));
                    addthis.toolbox(this, Configuration.get('addThis.options'), share_options);
                }
            });
        },
        mountToApp: function (application) {
            if (Configuration.get('addThis.enable')) {
                var layout = application.getLayout();
                // This are mostly related to the dom, or to events, so we add them in the layout
                _.extend(layout, {
                    refreshAddThisElements: this.refreshAddThisElements,
                    addthis_script_loaded: false
                });
                // @class SocialSharing.AddThis.Plugin @extends ApplicationModule
                var plugin = {
                    name: 'addthisPlugin',
                    priority: 10,
                    execute: function (application) {
                        var layout = application.getLayout();
                        if (!jQuery('[data-type="share-in-add-this"]').size()) {
                            layout.$el.find('[data-type="social-share-icons"]').append('<div href="#" class="add-this-btn" data-type="share-in-add-this"></div>');
                        }
                        if (jQuery('[data-type="share-in-add-this"]').size()) {
                            if (!layout.addthis_script_loaded) {
                                layout.addthis_script_loaded = true;
                                var addthis_script_url = ('https:' === document.location.protocol ? 'https://' : 'http://') + 's7.addthis.com/js/300/addthis_widget.js#domready=1';
                                // avoid on SEO and start addthis library
                                SC.ENVIRONMENT.jsEnvironment === 'browser' && jQuery.getScript(addthis_script_url, function () {
                                    layout.refreshAddThisElements();
                                });
                            } else {
                                // Then addthis plugins are called
                                layout.refreshAddThisElements();
                            }
                        }
                    }
                };
                SocialSharing.afterAppendView.install(plugin);
                SocialSharing.afterAppendToDom.install(plugin);
            }
        }
    };
    return addthisPlugin;
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module RequestQuoteAccessPoints
define('RequestQuoteAccessPoints.HeaderLink.View', [
    'requestquote_accesspoints_headerlink.tpl',
    'Backbone'
], function (requestquote_accesspoints_headerlink_tpl, Backbone) {
    'use strict';
    //@class RequestQuoteAccessPoints.HeaderLink.View @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: requestquote_accesspoints_headerlink_tpl    //@method getContext
                                                    //@return {RequestQuoteAccessPoints.HeaderLink.View.Context}
,
        getContext: function () {
            //@class RequestQuoteAccessPoints.HeaderLink.View.Context
            return {
                //@property {Boolean} hasClass
                hasClass: !!this.options.className,
                className: this.options.className
            };    //@class RequestQuoteAccessPoints.HeaderLink.View
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module RequestQuoteAccessPoints
define('RequestQuoteAccessPoints', [
    'RequestQuoteAccessPoints.HeaderLink.View',
    'Header.View',
    'Header.Menu.View'
], function (RequestQuoteWizardHeaderLinkView, HeaderView, HeaderMenuView) {
    'use strict';
    //@class RequestQuoteAccessPoints @extend ApplicationModule
    return {
        //@method mountToApp
        //@param {ApplicationSkeleton} application
        //@return {Void}
        mountToApp: function () {
            //Set the request a quote link on the Desktop header
            HeaderView.addChildViews && HeaderView.addChildViews({
                'RequestQuoteWizardHeaderLink': function wrapperFunction() {
                    return function () {
                        return new RequestQuoteWizardHeaderLinkView({});
                    };
                }
            });
            //Set the request a quote link on the Tablet and Mobile header
            HeaderMenuView.addChildViews && HeaderMenuView.addChildViews({
                'RequestQuoteWizardHeaderLink': function wrapperFunction() {
                    return function () {
                        return new RequestQuoteWizardHeaderLinkView({ className: ' ' });
                    };
                }
            });
            return void 0;
        }
    };
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module QuickOrderAccessPoints
define('QuickOrderAccessPoints.HeaderLink.View', [
    'Backbone',
    'underscore',
    'SC.Configuration',
    'quickorder_accesspoints_headerlink.tpl'
], function (Backbone, _, Configuration, quickorder_accesspoints_headerlink_tpl) {
    'use strict';
    //@class QuickOrderAccessPoints.HeaderLink.View @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: quickorder_accesspoints_headerlink_tpl    //@method getContext
                                                  //@return {QuickOrderAccessPoints.HeaderLink.View.Context}
,
        getContext: function () {
            //@class QuickOrderAccessPoints.HeaderLink.View.Context
            return {
                //@property {Boolean} hasClass
                hasClass: !!this.options.className,
                className: this.options.className,
                cartTouchPoint: _.getPathFromObject(Configuration, 'modulesConfig.Cart.startRouter', false) ? Configuration.currentTouchpoint : 'viewcart'
            };    //@class QuickOrderAccessPoints.HeaderLink.View
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module QuickOrderAccessPoints
define('QuickOrderAccessPoints', [
    'QuickOrderAccessPoints.HeaderLink.View',
    'Header.View',
    'Header.Menu.View'
], function (QuickOrderHeaderLinkView, HeaderView, HeaderMenuView) {
    'use strict';
    //@class QuickOrderAccessPoints @extend ApplicationModule
    return {
        //@method mountToApp
        //@param {ApplicationSkeleton} application
        //@return {Void}
        mountToApp: function () {
            //Set the request a quote link on the Desktop header
            HeaderView.addChildViews && HeaderView.addChildViews({
                'QuickOrderHeaderLink': function wrapperFunction() {
                    return function () {
                        return new QuickOrderHeaderLinkView({});
                    };
                }
            });
            //Set the request a quote link on the Tablet and Mobile header
            HeaderMenuView.addChildViews && HeaderMenuView.addChildViews({
                'QuickOrderHeaderLink': function wrapperFunction() {
                    return function () {
                        return new QuickOrderHeaderLinkView({ className: ' ' });
                    };
                }
            });
            return void 0;
        }
    };
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module RequestQuoteWizard
define('RequestQuoteWizard.View', [
    'Wizard.View',
    'Wizard.StepNavigation.View',
    'requestquote_wizard_layout.tpl',
    'underscore',
    'Utils'
], function (WizardView, WizardStepNavigationView, requestquote_wizard_layout_tpl, _) {
    'use strict';
    // @class RequestQuoteWizard.View @extends Wizard.View
    return WizardView.extend({
        //@property {Function} template
        template: requestquote_wizard_layout_tpl    //@property {String} page_header
,
        page_header: _('Request a Quote').translate()    //@property {String} bodyClass This property indicate the class used on the body to remove the My Account side menu
,
        bodyClass: 'force-hide-side-nav'    // @method getBreadcrumbPages
                                 // @return {BreadcrumbPage}
,
        getBreadcrumbPages: function () {
            return {
                href: '/request-a-quote',
                text: _('Request a Quote').translate()
            };
        }    //@property {ChildViews} childViews
,
        childViews: {
            'Wizard.StepNavigation': function () {
                return new WizardStepNavigationView({ wizard: this.wizard });
            }
        }    // @method getContext
             // @return {RequestQuoteWizard.View.Context}
,
        getContext: function () {
            // @class RequestQuoteWizard.View.Context
            return {
                // @property {String} pageHeader
                pageHeader: this.page_header
            };    // @class RequestQuoteWizard.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module RequestQuoteWizard
define('RequestQuoteWizard.Step', [
    'Wizard.Step',
    'SC.Configuration',
    'requestquote_wizard_step.tpl'
], function (WizardStep, Configuration, requestquote_wizard_step_tpl) {
    'use strict';
    //@class RequestQuoteWizard.Step Step View, Renders all the components of the Step @extend Wizard.Step
    return WizardStep.extend({
        //@property {Function} template
        template: requestquote_wizard_step_tpl    //@method render
,
        render: function () {
            var layout = this.wizard.application.getLayout();
            WizardStep.prototype.render.apply(this, arguments);
            // Also trigger the afterRender event so the site search module can load the typeahead.
            layout.trigger('afterRender');
        }    //@method getContext
             //@return {RequestQuoteWizard.Step.Context}
,
        getContext: function () {
            //@class RequestQuoteWizard.Step.Context
            return {
                //@property {String} currentStepGroupName
                currentStepGroupName: this.wizard.steps[this.wizard.currentStep].options.stepGroup.name,
                continueButtonLabel: this.continueButtonLabel,
                showNavButtons: !!(!this.hideBackButton || !this.hideContinueButton)    //@property {Boolean} showBackButton
,
                showBackButton: !this.hideBackButton || !this.wizard.isCurrentStepFirst()    //@property {Boolean} showContinueButton
,
                showContinueButton: !this.hideContinueButton,
                showBottomMessage: !!this.bottomMessage,
                bottomMessage: this.bottomMessage
            };    //@class RequestQuoteWizard.Step
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module RequestQuoteWizard
define('RequestQuoteWizard.Permission.Error.View', [
    'SC.Configuration',
    'requestquote_wizard_permission_error.tpl',
    'Backbone',
    'underscore'
], function (Configuration, requestquote_wizard_permission_error_tpl, Backbone, _) {
    'use strict';
    //@class RequestQuoteWizard.Permission.Error.View @extend Backbone.View
    return Backbone.View.extend({
        // @property {Function} template
        template: requestquote_wizard_permission_error_tpl    // @property {String} page_header
,
        page_header: _('Request a Quote').translate()    // @property {String} title
,
        title: _('Request a Quote').translate()    //@property {String} bodyClass This property indicate the class used on the body to remove the My Account side menu
,
        bodyClass: 'force-hide-side-nav'    //@method getContext
                                 //@return {RequestQuoteWizard.Permission.Error.View.Context}
,
        getContext: function () {
            //@class RequestQuoteWizard.Permission.Error.View.Context
            return {
                // @property {String} pageHeader
                pageHeader: this.page_header,
                salesrepPhone: Configuration.get('quote.defaultPhone')    // @property {Boolean} showSalesRepInformation Email
,
                salesrepEmail: Configuration.get('quote.defaultEmail')
            };    //@class RequestQuoteWizard.Permission.Error.View
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module RequestQuoteWizard
define('RequestQuoteWizard.Router', [
    'Wizard.Router',
    'RequestQuoteWizard.View',
    'RequestQuoteWizard.Step',
    'RequestQuoteWizard.Permission.Error.View',
    'AjaxRequestsKiller',
    'Backbone',
    'underscore',
    'Utils'
], function (WizardRouter, RequestQuoteWizardView, RequestQuoteWizardStep, RequestQuoteWizardPermissionErrorView, AjaxRequestsKiller, Backbone, _) {
    'use strict';
    // @class RequestQuoteWizard.Router @extends Wizard.Router
    return WizardRouter.extend({
        //@property {RequestQuoteWizardStep.Step} step
        step: RequestQuoteWizardStep    //@property {RequestQuoteWizardStep.View} view
,
        view: RequestQuoteWizardView    //@method runStep override default runstep method to validate that a quote id has been specified in the URL and the corresponding quote is already loaded
                                  //@param {String} str_options Current Options in the url
                                  //@return {Void}
,
        runStep: function (str_options) {
            // Computes the position of the user in the flow
            var position = this.getStepPosition(Backbone.history.fragment)    //this.getStepPosition(url)
, content = '', page_header = '', layout = this.application.getLayout(), options = _.parseUrlOptions(str_options), self = this, quoteid = str_options && ~str_options.indexOf('quoteid=');
            if (SC.ENVIRONMENT.permissions.transactions.tranEstimate < 2) {
                var error_view = new RequestQuoteWizardPermissionErrorView({ application: this.application });
                error_view.showContent();
            } else if (quoteid) {
                //wizard just finished and user refreshed the page
                page_header = _('Your Quote Request has been Placed').translate();
                content += _('You can review your quote request at <a href="/quotes/$(0)">Your Account</a> ').translate(options.quoteid) + _('or continue Shopping on our <a data-touchpoint="home" data-hashtag="#/" href="/">Home Page</a>.').translate();
                layout.internalError && layout.internalError(content, page_header, _('My Account').translate());
            } else if (position.fromBegining === 0) {
                self.model.clear();
                //this is done because many OrderWizard Modules dont check if the summary is set
                self.model.set('summary', {}, { silent: true });
                self.model.set('internalid', 'null');
                self.model.fetch({ killerId: AjaxRequestsKiller.getKillerId() }).then(function () {
                    self.model.trigger('init');
                    WizardRouter.prototype.runStep.apply(self);
                });
            } else {
                WizardRouter.prototype.runStep.apply(self, arguments);
            }
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module RequestQuoteWizard
define('RequestQuoteWizard.Module.Header', [
    'Wizard.Module',
    'requestquote_wizard_module_header.tpl'
], function (WizardModule, requestquote_wizard_module_header_tpl) {
    'use strict';
    //@class WizardModule.Module.Header @extend Wizard.Module
    return WizardModule.extend({
        // @property {Function} template
        template: requestquote_wizard_module_header_tpl    //@method initialize Override default initialize to attach on model lines change event to re-render
                                                 //@return {Void}
,
        initialize: function () {
            WizardModule.prototype.initialize.apply(this, arguments);
            this.wizard.model.get('lines').on('add remove change', this.render, this);
        }    //@method getContext
             //@return {RequestQuoteWizard.Module.Header.Context}
,
        getContext: function () {
            //@class RequestQuoteWizard.Module.Header.Context
            return {
                //property {RequestQuoteWizard.Module.Header} model
                model: this.wizard.model,
                hasItem: !!this.wizard.model.get('lines').length,
                productsLength: this.getItemsLength()    // @property {Boolean} hasOneItem
,
                hasOneItem: this.getItemsLength() === 1
            };    //@class RequestQuoteWizard.Module.Header
        }    //@method getItemsLength Returns the number of items in the entire model, that is the sum of all lines quantities
             //@return {Number}
,
        getItemsLength: function () {
            return this.wizard.model.get('lines').reduce(function (accum, line) {
                accum += line.get('quantity');
                return accum;
            }, 0);
        }    //@method destroy Override default implementation to detach form wizard's model events
             //@return {Void}
,
        destroy: function () {
            this.wizard.model.get('lines').off('add remove', this.render);
            WizardModule.prototype.destroy.apply(this, arguments);
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module RequestQuoteWizard
define('RequestQuoteWizard.Module.Message', [
    'SC.Configuration',
    'Wizard.Module',
    'requestquote_wizard_module_message.tpl',
    'underscore',
    'Utils'
], function (Configuration, WizardModule, requestquote_wizard_module_message_tpl, _) {
    'use strict';
    //@class WizardModule.Module.Message @extend Wizard.Message
    return WizardModule.extend({
        // @property {Function} template
        template: requestquote_wizard_module_message_tpl    //@method getContext
                                                  //@return {RequestQuoteWizard.Module.Message.Context}
,
        getContext: function () {
            //@class RequestQuoteWizard.Module.Message.Context
            return {
                // @property {String} pageHeader
                pageHeader: _('Request a Quote').translate()    // @property {String} message
,
                message: this.options.message || this.wizard.getCurrentStep().bottomMessage
            };    //@class RequestQuoteWizard.Module.Message
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module QuickAdd
define('QuickAdd.Model', [
    'SC.Configuration',
    'Transaction.Line.Model',
    'underscore'
], function (Configuration, TransactionLineModel, _) {
    'use strict';
    // @class QuickAdd.Model @extends Transaction.Line.Model
    var QuickAddModel = TransactionLineModel.extend({
        // @method initialize
        // @return {Void}
        initialize: function () {
            TransactionLineModel.prototype.initialize.apply(this, arguments);
            // @property {QuickAdd.Model.Initialization.Options} options
            this.options = {};
        }    //@method setOptions
             //@param {QuickAdd.Model.Initialization.Options} options
             //@return {QuickAdd.Model} Returns itself
,
        setOptions: function (options) {
            this.options = options || this.options;
            return this;
        }    //@method clone Override default clone method to pass the set options to the cloned model
             //@return {QuickAdd.Model}
,
        clone: function () {
            var result = new QuickAddModel(this.toJSON());
            result.setOptions(this.options);
            return result;
        }    //@property {Object} validation Specify the validation rules for the quantity and quickaddSearch attributes
,
        validation: {
            quickaddSearch: {
                fn: function (val) {
                    var product = this.get('selectedProduct'), item = product && product.get('item');
                    if (!(product && (product.getSku() === val || item.get('_name') === val))) {
                        return _('Begin typing SKU to select an item').translate();
                    }
                }
            },
            quantity: {
                fn: function (val) {
                    if (!val) {
                        return _('Enter quantity').translate();
                    }
                    var product = this.get('selectedProduct'), selectedItem = product && product.getItem();
                    if (selectedItem) {
                        var already_set_quantity = _.isFunction(this.options.getItemQuantitySet) ? this.options.getItemQuantitySet(selectedItem.id) : 0;
                        if (already_set_quantity + this.get('quantity') < selectedItem.get('_minimumQuantity', true)) {
                            return _('The minimum quantity for this item is $(0).').translate(selectedItem.get('_minimumQuantity', true));
                        } else if (this.options.validateMaxQty && !!selectedItem.get('_maximumQuantity') && already_set_quantity + this.get('quantity') > selectedItem.get('_maximumQuantity', true)) {
                            return _('The maximum quantity for this item is $(0).').translate(selectedItem.get('_maximumQuantity', true));
                        }
                    }
                }
            }
        }
    });
    return QuickAddModel;
});    //@class QuickAdd.Model.Initialization.Options
       //@property {Function<Number,Number>} getItemQuantitySet Function that given an item id returns how many item already are present in the cart-like.
       //This work to decouple this component of any other concrete implementation.
       //IMPORTANT: If the passed in item id is not in the cart-like this function must return 0 (the number zero).

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module QuickAdd
define('QuickAdd.Item.View', [
    'ItemsSearcher.Item.View',
    'underscore'
], function (ItemsSearcherItemView, _) {
    'use strict';
    //@class QuickAdd.Item.View @extend ItemsSearcher.Item.View
    return ItemsSearcherItemView.extend({
        //@method getContext
        //@return {QuickAdd.Item.View.Context}
        getContext: function getContext() {
            //@class QuickAdd.Item.View.Context @extend ItemsSearcher.Item.View.Context
            return _.extend(ItemsSearcherItemView.prototype.getContext.apply(this, arguments), this.options.areResults ? {
                //@property {ImageContainer} thumbnail
                thumbnail: this.model.getThumbnail()
            } : {});
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module QuickAdd
define('QuickAdd.ItemsSearcher.Plugins', [
    'Item.Model',
    'Product.Model',
    'Product.Collection',
    'underscore'
], function (ItemModel, ProductModel, ProductCollection, _) {
    'use strict';
    //@class QuickAdd.ItemsSearcher.Plugins
    return {
        //@property {QuickAdd.ItemsSearcher.Pluguns.flatItemsMatrixResult} flatItemsMatrixResult
        //@class QuickAdd.ItemsSearcher.Pluguns.flatItemsMatrixResult @extend Plugin
        flatItemsMatrixResult: {
            name: 'flatItemsMatrixResult',
            priotity: 10    //@method execute
                  //@param {ItemsSearcher.Collection} collection
                  //@param {ItemsSearcher.View.Options} configuration
                  //@return {ItemsSearcher.Collection}
,
            execute: function (collection, configuration) {
                //Current item that is begin processed
                var products = []    //Variable that contains the new product created from all parent matrix items to generated one items per child
                          //We do this to flat the list of items in the collection
, new_product, item_options, internalid_counter = 1;
                collection.each(function (item) {
                    if (item.get('isinstock') || (item.get('isbackorderable') || configuration.showBackorderables)) {
                        if (item.get('_matrixChilds') && item.get('_matrixChilds').length) {
                            item_options = item.get('options').where({ isMatrixDimension: true });
                            item.get('_matrixChilds').each(function (child_item) {
                                new_product = new ProductModel({ item: new ItemModel(_.extend({}, item.attributes)) });
                                _.each(item_options, function (option) {
                                    var selected_child_item_option_label = child_item.get(option.get('itemOptionId')), selected_option_value_object = _.findWhere(option.get('values'), { label: selected_child_item_option_label });
                                    new_product.setOption(option.get('cartOptionId'), selected_option_value_object.internalid);
                                });
                                //Give than the behavior to extract thumbnail images is based on the current selected item (thought for lines)
                                //we provide all children with the image object
                                new_product.getItem().set('itemimages_detail', item.get('itemimages_detail'));
                                new_product.set('isfulfillable', item.get('isfulfillable'));
                                new_product.set('internalid', internalid_counter++);
                                products.push(new_product);
                            });
                        } else {
                            products.push(new ProductModel({
                                item: item,
                                internalid: internalid_counter++
                            }));
                        }
                    }
                });
                products = _.filter(products, function (product) {
                    var query_on_sku = (product.getSku() ? product.getSku().toUpperCase() : '').indexOf(configuration.query.toUpperCase()) >= 0, query_on_name = (product.get('item').get('_name') ? product.get('item').get('_name').toUpperCase() : '').indexOf(configuration.query.toUpperCase()) >= 0, item_not_gift_certificate = product.get('item').get('itemtype') !== 'GiftCert';
                    return item_not_gift_certificate && (query_on_name || query_on_sku);
                });
                return new ProductCollection(_.first(products, configuration.limit));
            }
        }    //@class QuickAdd.ItemsSearcher.Plugins
    };
});


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module QuickAdd
define('QuickAdd.View', [
    'SC.Configuration',
    'ItemsSearcher.View',
    'QuickAdd.Model',
    'QuickAdd.Item.View',
    'Backbone.FormView',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'Transaction.Line.Views.Options.Selected.View',
    'ProductViews.Price.View',
    'ProductLine.Stock.View',
    'QuickAdd.ItemsSearcher.Plugins',
    'Transaction.Line.Model',
    'ProductLine.Sku.View',
    'quick_add.tpl',
    'quick_add_item.tpl',
    'Backbone',
    'underscore',
    'Utils'
], function (Configuration, ItemsSearcherView, QuickAddModel, QuickAddItemView, BackboneFormView, BackboneCompositeView, BackboneCollectionView, TransactionLineViewsOptionsSelectedView, ProductViewsPriceView, ProductLineStockView, QuickAddItemsSearcherPlugins, TransactionLineModel, ProductLineSkuView, quick_add_tpl, quick_add_item_tpl, Backbone, _) {
    'use strict';
    // @class QuickAdd.View @extends Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: quick_add_tpl    //@property {Object} events
,
        events: {
            'click [data-type="quick-add-reset"]': 'resetHandle',
            'submit form': 'saveForm',
            'click [data-action="plus"]': 'addQuantity',
            'click [data-action="minus"]': 'subQuantity',
            'change [data-type="quantity-input"]': 'setQuantity',
            'click [data-type="quantity-input"]': 'selectAll',
            'keypress [name="quantity"]': 'submitOnEnter',
            'keydown [name="quantity"]': 'onKeyDown'
        }    //@method initialize Override default initialization method to configure inner itemsSearcher component
             //@param {QuickAdd.View.Initialize.Options?} options
             //@return {Void}
,
        initialize: function () {
            this.itemsSearcherComponent = new ItemsSearcherView({
                placeholderLabel: _('Enter SKU or Item Name').translate(),
                showBackorderables: this.options.showBackorderable,
                minLength: Configuration.get('typeahead.minLength', 3),
                maxLength: Configuration.get('searchPrefs.maxLength', 0),
                limit: Configuration.get('typeahead.maxResults', 10),
                sort: Configuration.get('typeahead.sort', 'relevance:desc'),
                highlight: Configuration.get('typeahead.highlight', true),
                componentId: 'quickaddSearch',
                componentName: 'quickaddSearch',
                showMenuOnClick: true,
                showSeeAll: false,
                collectionOptions: { searcherAPIConfiguration: 'searchApiMasterOptions.itemsSearcher' },
                itemView: QuickAddItemView,
                itemViewOptions: {
                    template: quick_add_item_tpl,
                    childViews: {
                        'Item.Options': function (options) {
                            return function () {
                                return new TransactionLineViewsOptionsSelectedView({ model: options.model });
                            };
                        },
                        'Item.Price': function (options) {
                            return function () {
                                return new ProductViewsPriceView({ model: options.model });
                            };
                        },
                        'Item.Stock': function (options) {
                            return function () {
                                return new ProductLineStockView({ model: options.model });
                            };
                        },
                        'Item.Sku': function (options) {
                            return function () {
                                return new ProductLineSkuView({ model: options.model });
                            };
                        }
                    }
                },
                getItemDisplayName: function (item, query) {
                    return item ? item.getSku() : query;
                }
            });
            this.itemsSearcherComponent.postItemsSuggestionObtained.install(QuickAddItemsSearcherPlugins.flatItemsMatrixResult);
            this.model = new QuickAddModel();
            this.model.setOptions({
                getItemQuantitySet: this.options.getItemQuantitySet,
                validateMaxQty: this.options.validateMaxQty
            });
            this.itemsSearcherComponent.on('itemSelected', this.onItemSelected, this);
            this.itemsSearcherComponent.on('keyUp', this.showReset, this);
            this.itemsSearcherComponent.on('keyDown', this.cleanSearchOnEnter, this);
            var original_save_form = this.saveForm;
            BackboneCompositeView.add(this);
            BackboneFormView.add(this);
            this.saveForm = original_save_form;
        }    //@method saveForm Handle the current form validation and triggers the event selectedLien
             //@param {jQueryEvent} e
             //@return {Void}
,
        saveForm: function (e) {
            e.preventDefault();
            Backbone.Validation.bind(this);
            this.model.set(this.$('form').serializeObject());
            var product = this.model.get('selectedProduct');
            if (this.model.isValid(true) && product) {
                product.set('quantity', parseInt(this.model.get('quantity'), 10));
                var selected_line = new TransactionLineModel(product.toJSON());
                selected_line.set('internalid', _.uniqueId('item_line'));
                selected_line.set('item', product.getItem().clone());
                selected_line.set('options', product.get('options').clone());
                //if the item is a matrix we add the parent so when saving the item in a product list (request a quote case)
                //we have the parent
                if (product.get('item').get('_matrixChilds').length) {
                    selected_line.get('item').set('_matrixParent', product.get('item'));
                }
                selected_line.unset('selectedProduct');
                selected_line.unset('quickaddSearch');
                //@event {QuickAdd.View.SelectedLine.Properties} selectedLine
                this.trigger('selectedLine'    //@class QuickAdd.View.SelectedLine.Properties
, {
                    //@property {Transaction.Line.Model} selectedLine
                    selectedLine: selected_line
                });
                //@class QuickAdd.View
                this.$('[name="quantity"]').val('');
                this.$('[name="quantity"]').attr({ 'min': 1 });
                this.$('[data-type="quick-add-reset"]').hide();
                this.itemsSearcherComponent.cleanSearch();
                this.itemsSearcherComponent.setFocus();
            }
        }    //@method setQuantity Update by removing 1 to the current quantity of the current line
             //@param {jQuery.Event} e
             //@return {Void}
,
        setQuantity: function (e) {
            if (this.model.get('selectedProduct')) {
                var str_quantity = this.$(e.target).val(), quantity = parseInt(str_quantity, 10), minimum_quantity = this.model.get('selectedProduct').get('item').get('_minimumQuantity', true), maximum_quantity = this.model.get('selectedProduct').get('item').get('_maximumQuantity', true), quantity_already_set = 0;
                if (_.isFunction(this.options.getItemQuantitySet)) {
                    quantity_already_set = this.options.getItemQuantitySet(this.model.get('selectedProduct').getItemId()) || 0;
                }
                if (!_.isNaN(quantity) && _.isNumber(quantity)) {
                    if (quantity_already_set + quantity < minimum_quantity) {
                        if (!maximum_quantity || !!maximum_quantity && quantity + quantity_already_set < maximum_quantity) {
                            this.$('[data-type="quantity-input"]').val(minimum_quantity);
                        }
                    }
                }
            }
        }    // @method addQuantity Increase the product's Quantity by 1
             // @param {jQuery.Event} e
             // @return {Void}
,
        addQuantity: function (e) {
            e.preventDefault();
            var $element = this.$(e.target), quantity_input = $element.parent().find('input'), old_value = quantity_input.val(), max_quantity = this.model.get('selectedProduct').get('item').get('_maximumQuantity', true), new_val = parseFloat(old_value) + 1;
            new_val = !!max_quantity && new_val > max_quantity ? max_quantity : new_val;
            quantity_input.val(new_val);
            quantity_input.change();
        }    // @method subQuantity Decreases the product's Quantity by 1
             // @param {jQuery.Event} e
             // @return {Void}
,
        subQuantity: function (e) {
            e.preventDefault();
            var $element = this.$(e.target), quantity_input = $element.parent().find('input'), old_value = quantity_input.val(), new_val = parseFloat(old_value) - 1;
            new_val = Math.max(this.model.get('selectedProduct').get('item').get('_minimumQuantity', true), new_val);
            quantity_input.val(new_val);
            quantity_input.change();
        }    //@method showReset Handle when to show or hide the reset button
             //@param {ItemsSearcher.View.KeyDown.Properties} event_properties
             //@return {Void}
,
        showReset: function (event_properties) {
            if (event_properties.currentQuery) {
                this.$('[data-type="quick-add-reset"]').show();
            } else {
                this.$('[data-type="quick-add-reset"]').hide();
            }
        }    //@method cleanSearchOnEnter Cleans the current search status
             //@param {ItemsSearcher.View.KeyDown.Properties} event_properties
             //@return {Void}
,
        cleanSearchOnEnter: function (event_properties) {
            if (event_properties.eventObject.keyCode === 27) {
                this.$('[data-type="quick-add-reset"]').hide();
                this.itemsSearcherComponent.cleanSearch();
            }
        }    //@method onKeyDown Prevent letter e & other characters in "type=number" and allow arrows
             //@param {jQueryEvent} e
             //@return {Void}
,
        onKeyDown: function (e) {
            var key_code = e.which ? e.which : event.keyCode;
            if (key_code > 31 && (key_code < 48 || key_code > 57) && !(key_code >= 37 || key_code <= 40)) {
                e.preventDefault();
            }
        }    // @method submitOnEnter Submit the form when user presses enter in the quantity input text
             // @param {jQuery.Event} e
             //@return {Void}
,
        submitOnEnter: function (e) {
            if (e.keyCode === 13) {
                this.itemsSearcherComponent.setFocus();
            }
        }    //@method resetHandle Handle the reset action by hiding it and cleaning the current search status
             //@return {Void}
,
        resetHandle: function () {
            this.$('[data-type="quick-add-reset"]').hide();
            this.itemsSearcherComponent.cleanSearch();
            this.$('[name="quantity"]').val('');
        }    //@method selectAll on focus select all input value
             //@return {Void}
,
        selectAll: function () {
            this.$('[name="quantity"]').select();
        }    //@method onItemSelected Handle the selection of an item of the type-ahead result
             //@param {ItemsSearcher.View.itemSelected.Properties} result
             //@return {Void}
,
        onItemSelected: function (result) {
            //As the item searcher has been thought to work with items the property is called selectedItem, but we changed in the installed
            //plugin to use Products
            var product = result.selectedItem, item;
            if (product) {
                item = product.getItem();
                this.model.set('quickaddSearch', item.get('_name'));
                this.model.set('selectedProduct', product);
                this.setDefaultQuantity(item.get('_minimumQuantity', true), item.get('internalid'));
                this.$('[name="quantity"]').focus();
                this.selectAll();
                var minimum_quantity = item.get('_minimumQuantity', true);
                if (minimum_quantity > 1) {
                    this.$('[data-type="minimum-quantity"]').html(_('Minimum of $(0) required').translate(minimum_quantity));
                }
                this.$('[data-validation-error="block"]').remove();
            } else {
                this.model.unset('selectedProduct');
                this.$('[data-type="minimum-quantity"]').empty();
            }
        }    //@method setDefaultQuantity Set the default quantity based on the minimum quantity for the selected item and
             //also validate the other items into the "cart" or cart-like
             //@param {Number} minimum_quantity
             //@param {Number} item_id
             //@return {Void}
,
        setDefaultQuantity: function (minimum_quantity, item_id) {
            var current_quantity = parseInt(this.$('[name="quantity"]').val(), 10);
            this.$('[name="quantity"]').select();
            if (_.isFunction(this.options.getItemQuantitySet)) {
                minimum_quantity -= this.options.getItemQuantitySet(item_id) || 0;
            }
            minimum_quantity = minimum_quantity <= 0 ? 1 : minimum_quantity;
            if (!_.isNumber(current_quantity) || _.isNaN(current_quantity) || current_quantity < minimum_quantity) {
                this.model.set('quantity', minimum_quantity);
                this.$('[name="quantity"]').val(minimum_quantity);
                this.$('[name="quantity"]').attr('min', minimum_quantity);
            }
        }    //@property {ChildViews} childViews
,
        childViews: {
            'ItemsSearcher': function () {
                return this.itemsSearcherComponent;
            }
        }    //@method getContext
             //@return {QuickAdd.View.Context}
,
        getContext: function () {
            //@class QuickAdd.View.Context
            return {
                // @property {String} itemTitle
                itemTitle: this.options.itemTitle || _('Which item(s) would you like to add?').translate()    // @property {String} quantityTitle
,
                quantityTitle: this.options.quantityTitle || _('Quantity').translate()
            };    //@class QuickAdd.View
        }
    });
});    //@class QuickAdd.View.Initialize.Options
       //@property {String?} itemTitle Allows to specify the title used for the items sub-component
       //@property {String?} quantityTitle Allows to specify the title used for the quantity input
       //@property {Function<Number,Number>} getItemQuantitySet Function that given an item id returns how many item already are present in the cart-like.
       //This work to decouple this component of any other concrete implementation.
       //IMPORTANT: If the passed in item id is not in the cart-like this function must return 0 (the number zero).


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module RequestQuoteWizard
define('RequestQuoteWizard.Module.QuickAdd', [
    'Wizard.Module',
    'Backbone.CompositeView',
    'QuickAdd.View',
    'requestquote_wizard_module_quickadd.tpl',
    'jQuery',
    'underscore',
    'Utils'
], function (WizardModule, BackboneCompositeView, QuickAddView, requestquote_wizard_module_quickadd_tpl, jQuery, _) {
    'use strict';
    //@class RequestQuoteWizard.Module.QuickAdd @extend Wizard.Module
    return WizardModule.extend({
        // @property {Function} template
        template: requestquote_wizard_module_quickadd_tpl    //@property {errorCode: String, errorMessage:String} selectItemErrorMessage Specification of the error when no item is selected
,
        selectItemErrorMessage: {
            errorCode: 'ERR_RQW_SELECT_AN_ITEM',
            errorMessage: _('Please select at least one item').translate()
        }    //@property {Array<String>} errors
,
        errors: ['ERR_RQW_SELECT_AN_ITEM']    //@method initialize Override default method to make this module composite
                                      //@return {Void}
,
        initialize: function () {
            WizardModule.prototype.initialize.apply(this, arguments);
            BackboneCompositeView.add(this);
        }    //@method getItemQuantitySet Auxiliary method used to provide the amount of already added items into the transaction to the quick add component
             //@param {Number} item_id
             //@return {Number}
,
        getItemQuantitySet: function (item_id) {
            var selected_line = this.wizard.model.get('lines').find(function (line) {
                return line.get('item').id === item_id;
            });
            return selected_line ? parseInt(selected_line.get('quantity'), 10) : 0;
        }    //@method addNewLine
             //@param {QuickAdd.View.SelectedLine.Properties} options
             //@return {Void}
,
        addNewLine: function (options) {
            var selected_line = this.wizard.model.get('lines').find(function (line) {
                    //as line save child item it does not matter use getItemId or get('item')
                    return line.get('item').id === options.selectedLine.get('item').id;
                }), price;
            if (!selected_line) {
                price = options.selectedLine.getPrice();
                options.selectedLine.set('rate', price.price);
                options.selectedLine.set('rate_formatted', price.price_formatted);
                this.wizard.model.get('lines').add(options.selectedLine, { at: 0 });
            } else {
                this.setLineIndex(selected_line, 0, this.wizard.model.get('lines'));
                selected_line.set('quantity', selected_line.get('quantity') + options.selectedLine.get('quantity'));
            }
        }    //@method setLineIndex Sets a line in a particular position
             //@param {Transaction.Line.Model} selected_line
             //@param {Number} new_position
             //@param {Transaction.Line.Collection} collection
             //@return {Void}
,
        setLineIndex: function (selected_line, new_position, collection) {
            var old_index = _.indexOf(collection.models, selected_line);
            new_position = new_position || 0;
            collection.models.splice(old_index, 1);
            collection.models.splice(new_position, 0, selected_line);
        }    //@property {ChildViews} childViews
,
        childViews: {
            'QuickAddView': function () {
                this.quickAddViewComponent = new QuickAddView({
                    getItemQuantitySet: _.bind(this.getItemQuantitySet, this),
                    showBackorderable: true
                });
                this.quickAddViewComponent.on('selectedLine', this.addNewLine, this);
                return this.quickAddViewComponent;
            }
        }    //@method isValid Check if there is at least one item selected
             //@return {jQuery.Deferred}
,
        isValid: function () {
            return this.wizard.model.get('lines').length ? jQuery.Deferred().resolve() : jQuery.Deferred().reject(this.selectItemErrorMessage);
        }    //@method getContext
             //@return {RequestQuoteWizard.Module.QuickAdd.Context}
,
        getContext: function () {
            //@class RequestQuoteWizard.Module.QuickAdd.Context
            return {
                // @property {String} pageHeader
                pageHeader: this.page_header
            };    //@class RequestQuoteWizard.Module.QuickAdd
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module RequestQuoteWizard
define('RequestQuoteWizard.Module.Comments', [
    'Wizard.Module',
    'requestquote_wizard_module_comments.tpl',
    'underscore',
    'jQuery',
    'Utils'
], function (WizardModule, requestquote_wizard_module_comments_tpl, _, jQuery) {
    'use strict';
    //@class RequestQuoteWizard.Module.Comments @extend Wizard.Module
    return WizardModule.extend({
        // @property {Function} template
        template: requestquote_wizard_module_comments_tpl    //@property {Object} events
,
        events: { 'keyup [data-action="validate-textarea-length"]': 'validateTextareaLength' }    //@method getMaxLength Auxiliary method to return the max allowed character length
                                                                                          //@return {Number}
,
        getMaxLength: function () {
            return _.isNumber(this.options.maxLength) ? this.options.maxLength : 999;
        }    //@method validateTextareaLength Auxiliary function to control the max length on the text are on IE8
             //It doesnt return anything as it will set the new string when the value exceed the max allowed
             //@return {Void}
,
        validateTextareaLength: function () {
            var text = this.$('[data-action="validate-textarea-length"]').val(), limit = this.getMaxLength();
            if (text.length > limit) {
                this.$('[data-action="validate-textarea-length"]').val(text.substr(0, limit));
            }
        }    // @method submit Set the memo of the current transaction
             // @returns {jQuery.Deferred}
,
        submit: function () {
            this.wizard.model.set('memo', this.$('[data-type="memo-input"]').val());
            return jQuery.Deferred().resolve();
        }    //@method getContext
             //@return {RequestQuoteWizard.Module.Comments.Context}
,
        getContext: function () {
            //@class RequestQuoteWizard.Module.Comments.Context
            return {
                //@property {Boolean} showTitle
                showTitle: !!(!this.options.hide_title && this.getTitle())    //@property {String} title
,
                title: this.getTitle()    //@property {String} memo
,
                memo: this.wizard.model.get('memo')    //@property {Boolean} isReadOnly
,
                isReadOnly: !!this.options.is_read_only,
                hideContent: this.options.is_read_only && !this.wizard.model.get('memo')    //@property {Number} maxLength
,
                maxLength: this.getMaxLength()
            };    //@class RequestQuoteWizard.Module.Comments
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Transaction.Line.Views
define('Transaction.Line.Views.Cell.Actionable.Expanded.View', [
    'Transaction.Line.Views.Price.View',
    'ProductLine.Stock.View',
    'ProductLine.Sku.View',
    'Transaction.Line.Views.Options.Selected.View',
    'ProductLine.StockDescription.View',
    'Backbone.CollectionView',
    'Backbone.CompositeView',
    'transaction_line_views_cell_actionable_expanded.tpl',
    'Backbone',
    'underscore'
], function (TransactionLineViewsPriceView, ProductLineStockView, ProductLineSkuView, TransactionLineViewsOptionsSelectedView, ProductLineStockDescriptionView, BackboneCollectionView, BackboneCompositeView, transaction_line_views_cell_actionable_expanded_tpl, Backbone, _) {
    'use strict';
    //@class Transaction.Line.Views.Cell.Actionable.Expanded.View @extend Backbone.View
    return Backbone.View.extend({
        template: transaction_line_views_cell_actionable_expanded_tpl,
        initialize: function (options) {
            this.options = options;
            this.application = options.application;
            this.model = options.model;
            BackboneCompositeView.add(this);
        },
        childViews: {
            'Item.Price': function () {
                return new TransactionLineViewsPriceView({ model: this.model });
            },
            'Item.SelectedOptions': function () {
                return new TransactionLineViewsOptionsSelectedView({ model: this.model });
            },
            'Item.Summary.View': function () {
                return new this.options.SummaryView(_.extend({
                    model: this.model,
                    application: this.application
                }, this.options.summaryOptions || {}));
            },
            'Item.Actions.View': function () {
                return new this.options.ActionsView(_.extend({
                    model: this.model,
                    application: this.application
                }, this.options.actionsOptions || {}));
            },
            'ItemViews.Stock.View': function () {
                return new ProductLineStockView({ model: this.model.get('item') });
            },
            'Item.Sku': function () {
                return new ProductLineSkuView({ model: this.model });
            },
            'StockDescription': function () {
                return new ProductLineStockDescriptionView({ model: this.model.get('item') });
            }
        }    //@method getContext
             //@return {Transaction.Line.Views.Cell.Actionable.Expanded.View.Context}
,
        getContext: function () {
            var item = this.model.get('item');
            //@class Transaction.Line.Views.Cell.Actionable.Expanded.View.Context
            return {
                //@property {Transaction.Line.Model} model
                model: this.model,
                lineId: this.model.get('internalid')    //@property {Item.Model} item
,
                item: item    //@property {String} itemId
,
                itemId: item.get('internalid')    //@property {String} linkAttributes
,
                linkAttributes: this.model.getFullLink()    // @property {ImageContainer} thumbnail
,
                thumbnail: this.model.getThumbnail()    //@property {Boolean} isNavigable
,
                isNavigable: !!this.options.navigable && !!item.get('_isPurchasable')    //@property {Boolean} showCustomAlert
,
                showCustomAlert: !!item.get('_cartCustomAlert')    //@property {String} customAlertType
,
                customAlertType: item.get('_cartCustomAlertType') || 'info'    //@property {Boolean} showActionsView
,
                showActionsView: !!this.options.ActionsView,
                showSummaryView: !!this.options.SummaryView,
                showAlert: !_.isUndefined(this.options.showAlert) ? !!this.options.showAlert : true    //@property {Boolean} showGeneralClass
,
                showGeneralClass: !!this.options.generalClass,
                generalClass: this.options.generalClass
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module RequestQuoteWizard
define('RequestQuoteWizard.Module.Items.Line.Actions.View', [
    'requestquote_wizard_module_items_line_actions.tpl',
    'Backbone'
], function (requestquote_wizard_module_items_line_actions_tpl, Backbone) {
    'use strict';
    //@class RequestQuoteWizard.Module.Items.Line.Actions.View @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: requestquote_wizard_module_items_line_actions_tpl    //@property {Object} events
,
        events: { 'click [data-action="remove"]': 'removeItem' }    //@method removeItem Removed the current item from the list of items
                                                            //@return {Void}
,
        removeItem: function () {
            this.options.model.collection.remove(this.options.model);
        }    //@method getContext
             //@return {RequestQuoteWizard.Module.Items.Line.Actions.View.Context}
,
        getContext: function () {
            //@class RequestQuoteWizard.Module.Items.Line.Actions.View.Context
            return {};    //@class RequestQuoteWizard.Module.Items.Line.Actions.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module RequestQuoteWizard
define('RequestQuoteWizard.Module.Items.Line.Quantity.View', [
    'requestquote_wizard_module_items_line_quantity.tpl',
    'Backbone',
    'Backbone.CompositeView',
    'underscore'
], function (requestquote_wizard_module_items_line_quantity_tpl, Backbone, BackboneCompositeView, _) {
    'use strict';
    //@class RequestQuoteWizard.Module.Items.Line.Quantity.View @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: requestquote_wizard_module_items_line_quantity_tpl    //@property {Object} events
,
        events: {
            'click [data-action="plus"]': 'addQuantity',
            'click [data-action="minus"]': 'subQuantity',
            'change [data-type="quantity-input"]': 'changeQuantity',
            'keypress [data-type="quantity-input"]': 'submitOnEnter'
        }    // @method initialize
             //@return {Void}
,
        initialize: function () {
            //Make this view is a composite view
            BackboneCompositeView.add(this);
        }    //@method prevent redirect to the account overview on Submit the form when user presses enter in the quantity input text
             //@param {jQuery.Event} e
             //@return {Void}
,
        submitOnEnter: function (e) {
            if (e.keyCode === 13) {
                e.preventDefault(e);
            }
        }    //@method addQuantity Add 1 the current to quantity-input field
             //@param {jQuery.Event} e
             //@return {Void}
,
        addQuantity: function (e) {
            e.preventDefault();
            var newQuantity = parseInt(this.$('[data-type="quantity-input"]').val(), 10) + 1;
            this.$('[data-type="quantity-input"]').val(newQuantity);
            this.setQuantity();
        }    //@method subQuantity Subtracts 1 from quantity-input field
             //@param {jQuery.Event} e
             //@return {Void}
,
        subQuantity: function (e) {
            e.preventDefault();
            var newQuantity = parseInt(this.$('[data-type="quantity-input"]').val(), 10) - 1;
            if (newQuantity) {
                this.$('[data-type="quantity-input"]').val(newQuantity);
                this.setQuantity();
            }
        }    //@method changeQuantity Debounce callings to setQuantity function to prevent losing focus
             //@param {jQuery.Event} e
             //@return {Void}
,
        changeQuantity: _.debounce(function () {
            this.setQuantity();
        }, 500)    //@method setQuantity Updates the model quantity and the input field.
                   //@return {Void}
,
        setQuantity: function () {
            var str_quantity = this.$('[data-type="quantity-input"]').val(), line_pricing, quantity = parseInt(str_quantity, 10);
            if (!_.isNaN(quantity) && _.isNumber(quantity)) {
                quantity < this.model.get('item').get('_minimumQuantity', true) && (quantity = this.model.get('item').get('_minimumQuantity', true), this.$('[data-type="quantity-input"]').val(quantity));
                //In order to properly render prices for items with quantity pricing
                //1) we set the quantity silent which avoids the re-render of the entire list of item
                this.model.set('quantity', quantity, { silent: true });
                //2) with obtain the new pricing with the quantity set
                line_pricing = this.model.getPrice();
                //3) We set the new rate_formatted which will trigger a change and so a re-render
                this.model.set('rate_formatted', line_pricing.price_formatted);
                //Please notice that the same is being done in the cart confirmation
                //add attr disabled!!
                quantity > 1 ? this.$('[data-action="minus"]').removeAttr('disabled') : this.$('[data-action="minus"]').attr('disabled', true);
            } else {
                this.render();
            }
        }    //@method getContext
             //@return {RequestQuoteWizard.Module.Items.Line.Quantity.View.Context}
,
        getContext: function () {
            var minimum_quantity = this.model.get('item').get('_minimumQuantity', true);
            //@class RequestQuoteWizard.Module.Items.Line.Quantity.View.Context
            return {
                //@property {Transaction.Line.Model} model
                model: this.model,
                lineId: this.model.get('internalid')    //@property {Boolean} isMinusButtonDisabled
,
                isMinusButtonDisabled: this.model.get('quantity') <= minimum_quantity || this.model.get('quantity') === 1    //@property {Boolean} showMinimumQuantity
,
                showMinimumQuantity: minimum_quantity > 1    //@property {Integer} minimumQuantity
,
                minimumQuantity: minimum_quantity
            };    //@class RequestQuoteWizard.Module.Items.Line.Quantity.View
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module RequestQuoteWizard
define('RequestQuoteWizard.Module.Items', [
    'Wizard.Module',
    'Backbone.CollectionView',
    'Backbone.CompositeView',
    'Transaction.Line.Views.Cell.Actionable.Expanded.View',
    'RequestQuoteWizard.Module.Items.Line.Actions.View',
    'RequestQuoteWizard.Module.Items.Line.Quantity.View',
    'requestquote_wizard_module_items.tpl'
], function (WizardModule, BackboneCollectionView, BackboneCompositeView, TransactionLineViewsCellActionableExpandedView, RequestQuoteWizardModuleItemsLineActionsView, RequestQuoteWizardModuleItemsLineQuantityView, requestquote_wizard_module_items_tpl) {
    'use strict';
    //@class RequestQuoteWizard.Module.Items @extend Wizard.Module
    return WizardModule.extend({
        // @property {Function} template
        template: requestquote_wizard_module_items_tpl    //@method initialize
                                                //@return {Void}
,
        initialize: function () {
            WizardModule.prototype.initialize.apply(this, arguments);
            BackboneCompositeView.add(this);
            this.wizard.model.get('lines').on('add remove change', this.render, this);
        }    //@property {Object} childViews
,
        childViews: {
            'Items.Collection': function (options) {
                return new BackboneCollectionView({
                    collection: this.model.get('lines'),
                    viewsPerRow: 1,
                    childView: TransactionLineViewsCellActionableExpandedView,
                    childViewOptions: {
                        navigable: true,
                        application: this.wizard.application,
                        SummaryView: RequestQuoteWizardModuleItemsLineQuantityView,
                        ActionsView: RequestQuoteWizardModuleItemsLineActionsView,
                        showAlert: false,
                        generalClass: options.generalClass || 'requestquote-wizard-module-items-item'
                    }
                });
            }
        }    //@method getContext
             //@return {RequestQuoteWizard.Module.Items.Context}
,
        getContext: function () {
            //@class RequestQuoteWizard.Module.Items.Context
            return {
                //@property {Boolean} showTitle
                showTitle: !!(!this.options.hide_title && this.getTitle())    //@property {String} title
,
                title: this.getTitle()    //@property {Boolean} showHeaders
,
                showHeaders: !this.options.hideHeaders,
                hasItems: !!this.wizard.model.get('lines').length
            };    //@class RequestQuoteWizard.Model.Items
        }    //@method destroy Override default implementation to detach form wizard's model events
             //@return {Void}
,
        destroy: function () {
            this.wizard.model.get('lines').off('add remove', this.render);
            WizardModule.prototype.destroy.apply(this, arguments);
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module RequestQuoteWizard
define('RequestQuoteWizard.Module.Confirmation', [
    'Wizard.Module',
    'requestquote_wizard_module_confirmation.tpl',
    'SC.Configuration',
    'Utils',
    'Backbone'
], function (WizardModule, requestquote_wizard_module_confirmation_tpl, Configuration, Utils, Backbone) {
    'use strict';
    // @class RequestQuoteWizard.Module.Confirmation @extends Wizard.Module
    return WizardModule.extend({
        // @property {Function} template
        template: requestquote_wizard_module_confirmation_tpl    //@method present Override default implementation so when the modules is being rendered we set the salesorderid parameter into the url
                                                       //@return {Void}
,
        present: function () {
            var confirmation = this.model.get('confirmation') || {}    // store current order id in the hash so it is available even when the checkout process ends.
, newHash = Utils.addParamsToUrl(Backbone.history.fragment, { quoteid: confirmation.internalid });
            Backbone.history.navigate(newHash, { trigger: false });
        }    // @method getContext
             // @return {RequestQuoteWizard.Module.Confirmation.Context}
,
        getContext: function () {
            //@class RequestQuoteWizard.Module.Confirmation.Context
            return {
                //property {Model.Model} model
                model: this.model,
                quoteId: this.model.get('confirmation').internalid,
                quoteTranId: this.model.get('confirmation').tranid,
                contactBusinessDaysMessage: Configuration.get('quote.contactBusinessDaysMessage', '')    // @property {String} disclaimer
,
                disclaimer: Configuration.get('quote.disclaimer', '')    // @property {String} confirmationMessage
,
                confirmationMessage: this.options.message || this.wizard.getCurrentStep().confirmationMessage
            };    // @class QuoteToSalesOrderWizard.Module.Confirmation
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module RequestQuoteWizard
define('RequestQuoteWizard.Configuration', [
    'OrderWizard.Module.CartItems',
    'OrderWizard.Module.ShowShipments',
    'RequestQuoteWizard.Module.Header',
    'RequestQuoteWizard.Module.Message',
    'RequestQuoteWizard.Module.QuickAdd',
    'RequestQuoteWizard.Module.Comments',
    'RequestQuoteWizard.Module.Items',
    'OrderWizard.Module.Address.Shipping',
    'OrderWizard.Module.Title',
    'RequestQuoteWizard.Module.Confirmation',
    'SC.Configuration',
    'underscore',
    'Utils'
], function (OrderWizardModuleCartItems, OrderWizardModuleShowShipments, RequestQuoteWizardModuleHeader, RequestQuoteWizardModuleMessage, RequestQuoteWizardModuleQuickAdd, RequestQuoteWizardModuleComments, RequestQuoteWizardModuleItems, OrderWizardModuleAddressShipping, OrderWizardModuleTitle, RequestQuoteWizardModuleConfirmation, Configuration, _) {
    'use strict';
    //@class RequestQuoteWizard.Configuration Defines the configuration for the Request Quote Wizard module
    return {
        steps: [{
                name: '',
                steps: [
                    {
                        url: 'request-a-quote',
                        name: _('Request a Quote').translate(),
                        hideBackButton: true,
                        hideContinueButton: false,
                        bottomMessage: Configuration.get('quote.requestAQuoteWizardBottomMessage'),
                        continueButtonLabel: _('Submit Quote Request').translate(),
                        modules: [
                            RequestQuoteWizardModuleHeader,
                            RequestQuoteWizardModuleMessage,
                            [
                                OrderWizardModuleTitle,
                                { title: _('Add Items').translate() }
                            ],
                            RequestQuoteWizardModuleQuickAdd,
                            RequestQuoteWizardModuleItems,
                            [
                                OrderWizardModuleTitle,
                                { title: _('Choose a Shipping Address').translate() }
                            ],
                            OrderWizardModuleAddressShipping,
                            [
                                OrderWizardModuleTitle,
                                { title: _('Comments').translate() }
                            ],
                            RequestQuoteWizardModuleComments
                        ],
                        save: function () {
                            _.first(this.moduleInstances).trigger('change_label_continue', _('Processing...').translate());
                            var self = this, submit_opreation = this.wizard.model.submit();
                            submit_opreation.always(function () {
                                _.first(self.moduleInstances).trigger('change_label_continue', _('Submit Quote Request').translate());
                            });
                            return submit_opreation;
                        }
                    },
                    {
                        url: 'request-a-quote-confirmation',
                        name: _('Request a Quote').translate(),
                        hideBackButton: true,
                        hideContinueButton: true,
                        confirmationMessage: _('A sales representative will contact you in <strong>XX business days</strong>.').translate(),
                        modules: [
                            RequestQuoteWizardModuleConfirmation,
                            [
                                OrderWizardModuleShowShipments,
                                {
                                    hide_edit_cart_button: true,
                                    hide_edit_address_button: true,
                                    hideShippingMethod: true
                                }
                            ],
                            [
                                RequestQuoteWizardModuleComments,
                                {
                                    is_read_only: true,
                                    title: _('Comments').translate(),
                                    hide_title: false
                                }
                            ]
                        ]
                    }
                ]
            }]
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Quote
define('Quote.Model', [
    'Transaction.Model',
    'underscore'
], function (TransactionModel, _) {
    'use strict';
    //@class Quote.Model @extends Transaction.Model
    return TransactionModel.extend({
        //@property {String} urlRoot
        urlRoot: 'services/Quote.Service.ss?recordtype=estimate',
        initialize: function () {
            TransactionModel.prototype.initialize.apply(this, arguments);
            //metadata of the attribute options(custom fields)
            if (SC.ENVIRONMENT.customFieldsMetadata && SC.ENVIRONMENT.customFieldsMetadata.estimate) {
                this.__customFieldsMetadata = SC.ENVIRONMENT.customFieldsMetadata.estimate;
            }
        }    //@method submit Method invoked when the user a new quote want to be created
             // @return {jQuery.Deferred}
,
        submit: function () {
            var self = this;
            return this._submit.apply(this, arguments).fail(function (jqXhr) {
                jqXhr.preventDefault = true;
            }).done(function () {
                self.trigger('submit');
            });
        }    //@method save Override default save method to validate that independently of the current wizard steps configuration
             //the default quote values are preserve
             //@return {jQuery.XHR|Boolean} jqXHR if validation is successful and false
,
        save: function () {
            var billing_address = parseInt(this.get('billaddress'), 10), shipping_address = parseInt(this.get('shipaddress'), 10);
            //We don't know if the shipping address module is for sure present, so we add here an extra validation
            //to just save a valid shipping address and not an id that was auto-generated in the back-end
            if (!_.isNumber(shipping_address) || _.isNaN(shipping_address)) {
                this.unset('shipaddress');
            }
            //We don't know if the billing address module is for sure present, so we add here an extra validation
            //to just save a valid billing address and not an id that was auto-generated in the back-end
            if (!_.isNumber(billing_address) || _.isNaN(billing_address)) {
                this.unset('billaddress');
            }
            //Fix terms payment method object name
            //This happens because in some cases the back-end returns a payment method already initialized
            //that can be terms depending on the current user.
            //Our Transaction.Model returns the invoice in an object with the property 'paymentterms'
            //but at the time to set the payment method it expect an object with a property 'terms'
            if (this.get('paymentmethods').length) {
                var term_paymentMethod = this.get('paymentmethods').find(function (payment_method) {
                    return !!payment_method.get('paymentterms');
                });
                if (term_paymentMethod) {
                    term_paymentMethod.set('terms', term_paymentMethod.get('paymentterms'));
                    term_paymentMethod.unset('paymentterms');
                }
            }
            return TransactionModel.prototype.save.apply(this, arguments);
        }    // @method getNonShippableLines Returns the order's line that are NON Shippable
             // @returns {Array<Transaction.Line.Model>}
,
        getNonShippableLines: function () {
            return this.get('lines').filter(function (line) {
                return !line.get('item').get('_isfulfillable');
            });
        }    //@method getIfThereAreDeliverableItems Determines if at least one item is shippable
             //@return {Boolean}
,
        getIfThereAreDeliverableItems: function getIfThereAreDeliverableItems() {
            return this.get('lines').length - this.getNonShippableLines().length - this.getPickupInStoreLines().length > 0;
        }    // @method getShippableLines
             // @returns {Array<Transaction.Line.Model>} the order's line that are shippable without taking into account if their have or not set a shipaddress
,
        getShippableLines: function getShippableLines() {
            return this.get('lines').filter(function (line) {
                return line.get('item').get('_isfulfillable') && line.get('fulfillmentChoice') !== 'pickup';
            });
        },
        getPickupInStoreLines: function getPickupInStoreLines() {
            var lines = [];
            this.get('lines').each(function (line) {
                if (line.get('fulfillmentChoice') === 'pickup') {
                    lines.push(line);
                }
            });
            return lines;
        }    //@method shippingAddressIsRequired This method is used by the OrderWizard.Module.Address.Shipping to determine if its must be rendered or not.
             // @return {Boolean}
,
        shippingAddressIsRequired: function () {
            return true;    // return this.get('lines').length ?
                            // 	this.getNonShippableLines().length !== this.get('lines').length :
                            // 	true;
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module RequestQuoteWizard
define('RequestQuoteWizard', [
    'RequestQuoteWizard.Router',
    'RequestQuoteWizard.Configuration',
    'Quote.Model',
    'ProductList.Model',
    'Transaction.Line.Model',
    'ProductList.Item.Model',
    'Profile.Model',
    'Utils',
    'Backbone',
    'underscore',
    'jQuery'
], function (RequestQuoteWizardRouter, RequestQuoteWizardConfiguration, QuoteModel, ProductListModel, TransactionLineModel, ProductListItemModel, ProfileModel, Utils, Backbone, _, jQuery) {
    'use strict';
    //@class RequestQuoteWizard @extend ApplicationModule
    return {
        //@method mountToApp
        //@param {ApplicationSkeleton} application
        //@return {RequestQuoteWizard.Router} Returns a new instance of the RequestQuoteWizard.Router router
        mountToApp: function (application) {
            application.Configuration.requestQuoteWizard = RequestQuoteWizardConfiguration;
            this.application = application;
            var config = {
                steps: application.getConfig('requestQuoteWizard.steps', []),
                model: new QuoteModel(),
                profile: ProfileModel.getInstance()
            };
            if (SC.ENVIRONMENT.PRODUCTLIST_ENABLED) {
                this.setupPersistence(application, config.model);
            }
            return new RequestQuoteWizardRouter(application, config);
        }    //@method setupPersistence
             //Please note that we prevent the request if ProductList isn't enabled
             //@param {ApplicationSkeleton} application
             //@param {Backbone.Model} model
             //@return {Void}
,
        setupPersistence: function (application, model) {
            var self = this;
            this.pl_internalid = null;
            this.pl_json = null;
            model.on('init', function () {
                application.ProductListModule.Utils.getRequestAQuoteProductList().done(function (json) {
                    self.pl_json = json;
                    self.pl_internalid = json.internalid;
                    var products = new ProductListModel(json).get('items').models;
                    //Turn the events momentarily off
                    model.get('lines').off('add', self.addLines, self);
                    model.get('lines').off('change', self.changeQuantity, self);
                    model.get('lines').off('remove', self.doRemoveItemFromList, self);
                    model.off('submit', self.doRemoveList, self);
                    _.each(products, function (product, i) {
                        var selected_line = TransactionLineModel.createFromProduct(product);
                        selected_line.set('internalid', _.uniqueId('item_line'));
                        selected_line.set('pl_item_internalid', product.get('internalid'));
                        model.get('lines').add(selected_line, { silent: i < products.length - 1 });
                    });
                    //Turn the events on again
                    model.get('lines').on('change', self.changeQuantity, self);
                    model.get('lines').on('add', self.addLines, self);
                    model.get('lines').on('remove', self.doRemoveItemFromList, self);
                    model.on('submit', self.doRemoveList, self);
                });
            });
        }    //@method addLines
             //@param {Transaction.Line.Model} product
             //@return {Void}
,
        addLines: function (product) {
            var self = this;
            if (!this.pl_internalid) {
                var pl_model = new ProductListModel(this.pl_json);
                pl_model.save().done(function (pl_json) {
                    self.pl_json = pl_json;
                    self.pl_internalid = pl_json.internalid;
                    self.doAddItemToList(product);
                });
            } else {
                this.doAddItemToList(product);
            }
        }    //@method doAddItemToList
             //@param {Transaction.Line.Model} product
             //@return {Void}
,
        doAddItemToList: function (product) {
            var product_list_line = ProductListItemModel.createFromProduct(product);
            if (product.get('item').get('_matrixParent').id) {
                //As the quote is a line, it will only save the child item, but product list saves the parent item
                //so we override the item with the parent one
                product_list_line.set('item', product.get('item').get('_matrixParent'), { silent: true });
            }
            product_list_line.set('productList', { id: this.pl_internalid });
            product_list_line.save(null, {
                //Note this is lack of validation is require to not validate the JSON returned from the services as it will lack the Model/Collection structure required
                //to run the validation. for example the list of options will be an array and not a collection as the event handle that parse them didn't run yet
                validate: false
            }).done(function (obj) {
                product.set('pl_item_internalid', obj.internalid, { silent: true });
            });
        }    //@method changeQuantity Debounced due to concurrent updates of item quantities
             //@param {Transaction.Line.Model} line
             //@return {Void}
,
        changeQuantity: function (line) {
            this.toggleDisableSubmitButton(true);
            var product_list_item = {
                    description: '',
                    options: line.get('options').toJSON()    // this.getItemOptions(line.get('options'))
,
                    quantity: line.get('quantity'),
                    productList: { id: this.pl_internalid },
                    item: { internalid: line.get('item').get('internalid') },
                    internalid: line.get('pl_item_internalid')
                }, product_list_item_model = new ProductListItemModel(product_list_item);
            var modelInCollection = this.storeLinesToUpdateCollection.get(product_list_item_model.get('internalid'));
            modelInCollection ? modelInCollection.set('quantity', line.get('quantity')) : this.storeLinesToUpdateCollection.add(product_list_item_model);
            this.updateItemModels();
        }    //@method storeLinesToUpdateCollection
             //@return {Backbone.Collection}
,
        storeLinesToUpdateCollection: new Backbone.Collection()    //@method updateItemModels Debouncing the update quantity models
                                     //@return {Void}
,
        updateItemModels: _.debounce(function () {
            var self = this;
            var updateLinesPromises = this.storeLinesToUpdateCollection.map(function (model) {
                return model.save();
            });
            this.storeLinesToUpdateCollection.reset();
            jQuery.when.apply(jQuery, updateLinesPromises).always(function () {
                self.toggleDisableSubmitButton(false);
            });
        }, 1000)    //@method toggleDisableSubmitButton Disable/enable the Submit Quote Request buttons
                    //@param {Boolean} status
                    //@return {Void}
,
        toggleDisableSubmitButton: function (status) {
            this.application.getLayout().$('[data-action="submit-step"]').attr('disabled', status);
        }    //@method doRemoveList
             //@return {Void}
,
        doRemoveList: function () {
            if (this.pl_json) {
                var pl_model = new ProductListModel(this.pl_json);
                pl_model.destroy();
                this.pl_json = null;
                this.pl_internalid = null;
            }
        }    //@method doRemoveItemFromList
             //@param {Transaction.Line.Model} product
             //@return {Void}
,
        doRemoveItemFromList: function (product) {
            var product_list_item = {
                    productList: { id: this.pl_internalid },
                    item: { internalid: product.get('item').get('internalid') },
                    internalid: product.get('pl_item_internalid')
                }, product_list_item_model = new ProductListItemModel(product_list_item);
            product_list_item_model.destroy();
        }    // 	//@method getItemOptions
             // 	//@param {Array<Object>} item_options
             // 	//@return {Object}
             // ,   getItemOptions: function (item_options)
             // 	{
             // 		var result = {};
             // 		_.each(item_options, function (value, name)
             // 		{
             // 			result[value.id || name] = { value: value.value, displayvalue: value.displayvalue };
             // 		});
             // 		return result;
             // 	}
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module GoogleUniversalAnalytics
(function (win, name) {
    'use strict';
    // [Google Universal Analytics](https://developers.google.com/analytics/devguides/collection/analyticsjs/)
    // We customized the tracking default start script so it doesn't loads analytics.js
    // (Tracking Start)[https://developers.google.com/analytics/devguides/collection/analyticsjs/#quickstart]
    win.GoogleAnalyticsObject = name;
    win[name] = win[name] || function () {
        (win[name].q = win[name].q || []).push(arguments);
    };
    win[name].l = 1 * new Date();
    //@class GoogleUniversalAnalytics @extends ApplicationModule
    // ------------------
    // Loads google analytics script and extends application with methods:
    // * trackPageview
    // * trackEvent
    // * trackTransaction
    // Also wraps layout's showInModal
    define('GoogleUniversalAnalytics', [
        'Tracker',
        'underscore',
        'jQuery',
        'Backbone',
        'Utils',
        'SC.Configuration'
    ], function (Tracker, _, jQuery, Backbone, Utils, Configuration) {
        var GoogleUniversalAnalytics = {
            //@method doCallback Indicates if this module do a callback after some particular events
            //@return {Boolean}
            doCallback: function () {
                return !win[name].q;
            }    //@method trackPageview
                 //@param {String} url
                 //@return {GoogleUniversalAnalytics}
,
            trackPageview: function (url) {
                if (_.isString(url)) {
                    // [Page Tracking](https://developers.google.com/analytics/devguides/collection/analyticsjs/pages#overriding)
                    win[name]('send', 'pageview', url);
                }
                return this;
            }    //@method trackEvent
                 //@param {TrackEvent} event
                 //@return {GoogleUniversalAnalytics}
,
            trackEvent: function (event) {
                if (event && event.category && event.action) {
                    // [Event Tracking](https://developers.google.com/analytics/devguides/collection/analyticsjs/events#implementation)
                    win[name]('send', 'event', event.category, event.action, event.label, parseFloat(event.value) || 0, {
                        'hitCallback': event.callback,
                        'page': event.page || '/' + Backbone.history.fragment
                    });
                }
                return this;
            }    //@method addItem
                 //@param {Object<String:id,String:name>} item
                 //@return {GoogleUniversalAnalytics}
,
            addItem: function (item) {
                if (item && item.id && item.name) {
                    // [Adding Items](https://developers.google.com/analytics/devguides/collection/analyticsjs/ecommerce#addItem)
                    win[name]('ecommerce:addItem', item);
                }
                return this;
            }    //@method addTrans
                 //@param {Object} transaction
                 //@return {GoogleUniversalAnalytics}
,
            addTrans: function (transaction) {
                if (transaction && transaction.id) {
                    // [Adding a Transaction](https://developers.google.com/analytics/devguides/collection/analyticsjs/ecommerce#addTrans)
                    win[name]('ecommerce:addTransaction', transaction);
                }
                return this;
            }    //@method trackTrans
                 //@return {GoogleUniversalAnalytics}
,
            trackTrans: function () {
                // [Sending Data](https://developers.google.com/analytics/devguides/collection/analyticsjs/ecommerce#sendingData)
                win[name]('ecommerce:send');
                return this;
            }    //@method trackTransaction
                 // Based on the created SalesOrder we trigger each of the analytics
                 // ecommerce methods passing the required information
                 // [Ecommerce Tracking](https://developers.google.com/analytics/devguides/collection/analyticsjs/ecommerce)
                 //@param {Tracker.Transaction.Model} @extends Backbone.Model transaction
                 //@return {GoogleUniversalAnalytics|Void}
,
            trackTransaction: function (transaction) {
                var transaction_id = transaction.get('confirmationNumber');
                GoogleUniversalAnalytics.addTrans({
                    id: transaction_id,
                    revenue: transaction.get('subTotal'),
                    shipping: transaction.get('shippingCost') + transaction.get('handlingCost'),
                    tax: transaction.get('taxTotal'),
                    currency: SC.ENVIRONMENT.currentCurrency && SC.ENVIRONMENT.currentCurrency.code || '',
                    page: '/' + Backbone.history.fragment
                });
                transaction.get('products').each(function (product) {
                    GoogleUniversalAnalytics.addItem({
                        id: transaction_id,
                        affiliation: Configuration.get('siteSettings.displayname'),
                        sku: product.get('sku'),
                        name: product.get('name'),
                        category: product.get('category') || '',
                        price: product.get('rate'),
                        quantity: product.get('quantity')
                    });
                });
                return GoogleUniversalAnalytics.trackTrans();
            }    //@method setAccount
                 //@param {SC.Configuration} config
                 //@return {Void}
,
            setAccount: function (config) {
                if (!config) {
                    return this;
                }
                var domainName = Utils.isCheckoutDomain() ? config.domainNameSecure : config.domainName;
                if (_.isString(config.propertyID) && _.isString(domainName)) {
                    this.propertyID = config.propertyID;
                    this.domainName = domainName;
                    // [Multiple Trackers on The Same Domain](https://developers.google.com/analytics/devguides/collection/analyticsjs/domains#multitrackers)
                    // https://support.google.com/analytics/answer/1034342?hl=en
                    win[name]('create', this.propertyID, {
                        'cookieDomain': this.domainName,
                        'allowLinker': true
                    });
                }
                return this;
            }    //@method addCrossDomainParameters
                 // [Decorating HTML Links](https://developers.google.com/analytics/devguides/collection/analyticsjs/cross-domain#decoratelinks)
                 //@param {string} url
                 //@return {String} url
,
            addCrossDomainParameters: function (url) {
                // We only need to add the parameters if the URL we are trying to go
                // is not a sub domain of the tracking domain
                if (_.isString(url) && !~url.indexOf(this.domainName)) {
                    win[name](function (tracker) {
                        win.linker = win.linker || new win.gaplugins.Linker(tracker);
                        var track_url = win.linker.decorate(url);
                        // This validation is due to Tracking Blockers overriding the default analytics methods
                        if (typeof track_url === 'string') {
                            url = track_url;
                        }
                    });
                }
                return url;
            }    //@method loadScript
                 //@return {jQuery.Promise|Void}
,
            loadScript: function () {
                return SC.ENVIRONMENT.jsEnvironment === 'browser' && jQuery.getScript('//www.google-analytics.com/analytics.js');
            }    //@method mountToApp
                 //@param {ApplicationSkeleton} application
                 //@return {Void}
,
            mountToApp: function (application) {
                var tracking = application.getConfig('tracking.googleUniversalAnalytics');
                // if track page view needs to be tracked
                if (tracking && tracking.propertyID) {
                    // we get the account and domain name from the configuration file
                    GoogleUniversalAnalytics.setAccount(tracking);
                    Tracker.getInstance().trackers.push(GoogleUniversalAnalytics);
                    // the analytics script is only loaded if we are on a browser
                    application.getLayout().once('afterAppendView', jQuery.proxy(GoogleUniversalAnalytics, 'loadScript'));
                    // [Load the eCommerce Plugin](https://developers.google.com/analytics/devguides/collection/analyticsjs/ecommerce#loadit)
                    win[name]('require', 'ecommerce', 'ecommerce.js');
                }
            }
        };
        return GoogleUniversalAnalytics;
    });
}(window, 'ga'));
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module GoogleAdWords
// Adds GoogleAdWords tracking pixel on the checkout confirmation page.
define('GoogleAdWords', [
    'Tracker',
    'jQuery'
], function (Tracker, jQuery) {
    'use strict';
    // @lass GoogleAdWords Adds GoogleAdWords tracking pixel on the checkout confirmation page. @extends ApplicationModule
    var GoogleAdWords = {
        // @method setAccount Saves the configuration to be later used on the track transaction. @param {Object} config
        setAccount: function (config) {
            this.config = config;
            return this;
        }    // @method trackTransaction Appends the tracking pixel to the dom, so the request is done.
,
        trackTransaction: function (order) {
            var config = GoogleAdWords.config, value = order.get('total');
            jQuery('<img/>', { src: '//www.googleadservices.com/pagead/conversion/' + config.id + '/?value=' + value + '&label=' + config.label + '&guid=ON&script=0' }).appendTo(GoogleAdWords.application.getLayout().currentView.$el);
            return this;
        },
        mountToApp: function (application) {
            GoogleAdWords.application = application;
            var tracking = application.getConfig('tracking.googleAdWordsConversion');
            // Required tracking attributes to generate the pixel url
            if (tracking && tracking.id && tracking.label) {
                GoogleAdWords.setAccount(tracking);
                Tracker.getInstance().trackers.push(GoogleAdWords);
            }
        }
    };
    return GoogleAdWords;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module GoogleTagManager.NavigationHelper.Plugins.Standard
//It handle the mouseDown event only on the items link of the follow list: Search/Category, Recently viewed items and related/correlated items
define('GoogleTagManager.NavigationHelper.Plugins.Standard', [
    'Tracker',
    'jQuery',
    'Backbone'
], function (Tracker, jQuery, Backbone) {
    'use strict';
    // @class GoogleTagManager.NavigationHelper.Plugins.Standard Contains the standard navigation helper behavior. @extends ApplicationModule
    var trackerPlugins = {
        //@method mouseDownNavigation Handle standard mouseDown event
        //@param {ApplicationSkeleton.Layout} layout General application layout
        //@param {jQuery.Event} e jQuery event
        //@return {jQuery.Event} e
        mouseDownNavigation: function (layout, e) {
            var $item = jQuery(e.currentTarget).closest('[itemprop="itemListElement"]');
            if ($item.length) {
                var category = $item.data('track-productlist-category');
                if (category) {
                    var item = {
                        category: category,
                        position: $item.data('track-productlist-position'),
                        list: $item.data('track-productlist-list'),
                        sku: $item.data('sku'),
                        itemId: $item.data('item-id'),
                        name: $item.find('[itemprop="name"]').text()
                    };
                    Tracker.getInstance().trackProductClick(new Backbone.Model(item));
                }
            }
            return e;
        }
    };
    return trackerPlugins;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module GoogleTagManager
//@class GoogleTagManager @extends ApplicationModule Loads Google Tag Manager scripts
define('GoogleTagManager', [
    'Tracker',
    'GoogleTagManager.NavigationHelper.Plugins.Standard',
    'underscore',
    'jQuery',
    'Backbone',
    'SC.Configuration'
], function (Tracker, GoogleTagManagerNavigationHelper, _, jQuery, Backbone, Configuration) {
    'use strict';
    var win = window, GoogleTagManager = {
            //@method doCallback Indicates if this module do a callback after some particular events
            //@return {Boolean}
            //ie: when you do a log-in, we need to track that event before we navigate to the new page, otherwise the track of the event could be aborted
            //We have a special case in which this doesn't work, for exampmle, if a browser extension blocks the Analytics tracking but not GTM, the log-in callback is never excecuted
            doCallback: function () {
                return !!win.google_tag_manager;
            }    //@method trackPageview
                 //@param {String} url
                 //@return {GoogleTagManager}
,
            trackPageview: function (url) {
                if (_.isString(url)) {
                    var eventName = 'pageView', eventData = {
                            'event': eventName,
                            'data': { 'page': url }
                        };
                    //Triggers a Backbone.Event so others can subscribe to this event and add/replace data before is send it to Google Tag Manager
                    Tracker.trigger(eventName, eventData, url);
                    this.pushData(eventData);
                }
                return this;
            }    //@method trackEvent Track this actions: guest-checkout, sign-in, create-account, Reorder, add-to-cart, place-order
                 //@param {TrackEvent} event
                 //@return {GoogleTagManager}
,
            trackEvent: function (event) {
                if (event && event.category && event.action) {
                    var eventName = 'action', eventData = {
                            'event': eventName,
                            'data': {
                                'category': event.category,
                                'action': event.action,
                                'label': event.label,
                                'value': parseFloat(event.value) || 0,
                                'page': event.page || '/' + Backbone.history.fragment
                            },
                            'eventCallback': event.callback
                        };
                    //Triggers a Backbone.Event so others can subscribe to this event and add/replace data before is send it to Google Tag Manager
                    Tracker.trigger(eventName, eventData, event);
                    this.pushData(eventData);
                }
                return this;
            }    //@method trackGenericEvent
                 //@return {GoogleTagManager}
,
            trackGenericEvent: function () {
                var eventName = 'genericEvent', eventData = {
                        'event': eventName,
                        'data': {}
                    };
                //Triggers a Backbone.Event so others can subscribe to this event and add/replace data before is send it to Google Tag Manager
                Tracker.trigger(eventName, eventData, arguments);
                this.pushData(eventData);
                return this;
            }    //@method trackAddToCart
                 //@param {Transaction.Line.Model} line
                 //@return {GoogleTagManager}
,
            trackAddToCart: function (line) {
                if (line) {
                    var eventName = 'addToCart', eventData = {
                            'event': eventName,
                            'data': {}
                        };
                    //Triggers a Backbone.Event so others can subscribe to this event and add/replace data before is send it to Google Tag Manager
                    Tracker.trigger(eventName, eventData, line);
                    this.pushData(eventData);
                }
                return this;
            }    //@method trackTransaction
                 // https://support.google.com/tagmanager/answer/6106097?hl=en
                 //@param {Tracker.Transaction.Model} @extends Backbone.Model transaction
                 //@class Tracker.Transaction.Model
                 //@property {String} confirmationNumber
                 //@property {Number} subTotal
                 //@property {Number} total
                 //@property {Number} taxTotal
                 //@property {Number} shippingCost
                 //@property {Number} handlingCost
                 //@property {Array<{Tracker.Transaction.Items.Model}>} products
                 //@class Tracker.Transaction.Line.Model
                 //@property {String} sku
                 //@property {String} name
                 //@property {String} category
                 //@property {Number} rate
                 //@property {Number} quantity
                 //@property {String} variant
                 //@class Tracker.Transaction.Model
                 //@class GoogleTagManager
                 //@return {GoogleTagManager}
,
            trackTransaction: function (transaction) {
                var eventName = 'transaction', eventData = {
                        'event': eventName,
                        'data': {
                            'transactionId': transaction.get('confirmationNumber'),
                            'transactionAffiliation': Configuration.get('siteSettings.displayname'),
                            'transactionSubTotal': transaction.get('subTotal'),
                            'transactionTotal': transaction.get('total'),
                            'transactionTax': transaction.get('taxTotal'),
                            'transactionShipping': transaction.get('shippingCost') + transaction.get('handlingCost'),
                            'transactionCurrency': SC.ENVIRONMENT.currentCurrency && SC.ENVIRONMENT.currentCurrency.code || 'USD',
                            'transactionProducts': []
                        }
                    };
                transaction.get('products').each(function (product) {
                    eventData.data.transactionProducts.push({
                        'sku': product.get('sku'),
                        'name': product.get('name'),
                        'category': product.get('category') || '',
                        'price': product.get('rate'),
                        'quantity': product.get('quantity'),
                        'variant': product.get('options')
                    });
                });
                //Triggers a Backbone.Event so others can subscribe to this event and add/replace data before is send it to Google Tag Manager
                Tracker.trigger(eventName, eventData, transaction);
                this.pushData(eventData);
                return this;
            }    //@method trackProductList
                 //@param {Backbone.Collection} items
                 //@param {String} listName
                 //@return {GoogleTagManager}
,
            trackProductList: function (items, listName) {
                var self = this, eventName = 'productList', eventData = {
                        'event': eventName,
                        'data': {
                            'currencyCode': SC.ENVIRONMENT.currentCurrency && SC.ENVIRONMENT.currentCurrency.code || 'USD',
                            'items': [],
                            'page': this.getCategory(),
                            'list': listName
                        }
                    };
                _.each(items.models, function (item, index) {
                    //We set this properties in the item so we can print them on the html, to later be read them by the trackProductClick event
                    item.set('track_productlist_position', index + 1);
                    item.set('track_productlist_category', self.getCategory());
                    item.set('track_productlist_list', listName);
                    eventData.data.items.push({
                        'name': item.get('_name'),
                        'sku': item.get('_sku', true),
                        'price': item.get('_price') && item.get('_price').toFixed(2) || 0,
                        'list': item.get('track_productlist_list'),
                        'position': item.get('track_productlist_position'),
                        'category': item.get('track_productlist_category')
                    });
                });
                //Triggers a Backbone.Event so others can subscribe to this event and add/replace data before is send it to Google Tag Manager
                Tracker.trigger(eventName, eventData, items);
                this.pushData(eventData);
                return this;
            }    //@method trackProductClick
                 //@param {Object} item
                 //@return {GoogleTagManager}
,
            trackProductClick: function (item) {
                var eventName = 'productClick', eventData = {
                        'event': eventName,
                        'data': {
                            'category': item.get('category'),
                            'position': item.get('position'),
                            'list': item.get('list'),
                            'sku': item.get('sku', true),
                            'name': item.get('name'),
                            'page': this.getCategory(),
                            'label': item.get('name')
                        }
                    };
                //We set this item in this Tracker to later be read it by the trackProductView event
                this.item = item;
                //Triggers a Backbone.Event so others can subscribe to this event and add/replace data before is send it to Google Tag Manager
                Tracker.trigger(eventName, eventData, item);
                this.pushData(eventData);
                return this;
            }    //@method trackProductView
                 //@param {Product.Model} product
                 //@return {GoogleTagManager}
,
            trackProductView: function (product) {
                var item = product.getItem();
                if (this.item && this.item.get('itemId') === item.get('_id')) {
                    item.set('category', this.item.get('category'), { silent: true });
                    item.set('list', this.item.get('list'), { silent: true });
                }
                var eventName = 'productView', selected_options = product.get('options').filter(function (option) {
                        return option.get('value') && option.get('value').label;
                    }), price = product.getPrice(), eventData = {
                        'event': eventName,
                        'data': {
                            'sku': product.getSku(),
                            'name': item.get('_name'),
                            'variant': _.map(selected_options, function (option) {
                                return option.get('value').label;
                            }).join(', '),
                            'price': (price.price ? price.price : 0).toFixed(2),
                            'category': item.get('category') || ''    // as we do not support categories this is just the url
,
                            'list': item.get('list') || '',
                            'page': this.getCategory()
                        }
                    };
                this.item = null;
                //Triggers a Backbone.Event so others can subscribe to this event and add/replace data before is send it to Google Tag Manager
                Tracker.trigger(eventName, eventData, item);
                this.pushData(eventData);
                return this;
            }    //@method pushData Clean all the values of the dataLayer before we send the new ones
                 //@param {Object} data
,
            pushData: function (data) {
                //We need to push this dummy empty object to 'clean' the dataLayer, because all the data pushed is appended in another object that is sent to gtm
                // http://www.simoahava.com/gtm-tips/remember-to-flush-unused-data-layer-variables/
                win[this.configuration.dataLayerName].push({
                    'event': undefined,
                    'data': undefined,
                    'eventCallback': undefined
                });
                win[this.configuration.dataLayerName].push(data);
            }    //@method getCategory
                 //@return {String}
,
            getCategory: function () {
                var options = _.parseUrlOptions(Backbone.history.fragment), page = options.page || '';
                return '/' + Backbone.history.fragment.split('?')[0] + (page ? '?page=' + page : '');
            }    //@method loadScript
                 //@return {jQuery.Promise|Void}
,
            loadScript: function () {
                return !SC.isPageGenerator() && jQuery.getScript('//www.googletagmanager.com/gtm.js?id=' + this.configuration.id + '&l=' + this.configuration.dataLayerName);
            }    //@method mountToApp
                 //@param {ApplicationSkeleton} application
                 //@return {Void}
,
            mountToApp: function (application) {
                this.configuration = Configuration.get('tracking.googleTagManager');
                if (this.configuration && this.configuration.id) {
                    var layout = application.getLayout();
                    //Install Standard Navigation Plugins
                    layout.mouseDown.install({
                        name: 'googleTagManagerStandardNavigation',
                        priority: 20,
                        execute: function (e) {
                            return GoogleTagManagerNavigationHelper.mouseDownNavigation(layout, e);
                        }
                    });
                    this.configuration.dataLayerName = this.configuration.dataLayerName || 'dataLayer';
                    // (Tracking Start)[https://developers.google.com/tag-manager/quickstart]
                    win[this.configuration.dataLayerName] = win[this.configuration.dataLayerName] || [];
                    win[this.configuration.dataLayerName].push({
                        'gtm.start': new Date().getTime(),
                        'event': 'gtm.js'
                    });
                    Tracker.getInstance().trackers.push(GoogleTagManager);
                    // the analytics script is only loaded if we are on a browser
                    application.getLayout().once('afterAppendView', jQuery.proxy(GoogleTagManager, 'loadScript'));
                }
            }
        };
    return GoogleTagManager;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Merchandising
define('Merchandising.Item.Collection', [
    'Item.Collection',
    'Session',
    'underscore',
    'Profile.Model',
    'Utils'
], function (ItemCollection, Session, _, ProfileModel) {
    'use strict';
    // @class Merchandising.ItemCollection Item collection used for the merchandising zone
    // we declare a new version of the ItemCollection
    // to make sure the urlRoot doesn't get overridden
    // @extends Item.Collection
    return ItemCollection.extend({
        url: function () {
            var profile = ProfileModel.getInstance();
            return _.addParamsToUrl(profile.getSearchApiUrl(), _.extend({}, this.searchApiMasterOptions, Session.getSearchApiParams()), profile.isAvoidingDoubleRedirect());
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Merchandising
// @class Merchandising.Rule.Collection
// Object that contains both model and collection of Merchandising Rules
// Each MerchandisingRule.Model is a Merchandising Rule record on the backend
define('Merchandising.Rule', [
    'Singleton',
    'Backbone',
    'Backbone.CachedCollection'
], function (Singleton, Backbone, BackboneCachedCollection) {
    'use strict';
    var MerchandisingRule = {};
    // Standard Backbone.Model, we call extend in case
    // we want to override some methods
    MerchandisingRule.Model = Backbone.Model.extend({});
    // @class MerchandisingRule.Collection Handles the merchandising rules, it is a Singleton as
    // there is only one set of the rules @extends Backbone.CachedCollection
    // @extends Backbone.CachedCollection
    MerchandisingRule.Collection = BackboneCachedCollection.extend({
        url: '/dls/services/merchandising.ss'    // @class MerchandisingRule.Collection.Model @extends Backbone.Model
,
        model: MerchandisingRule.Model
    }, Singleton);
    return MerchandisingRule;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Merchandising
define('Merchandising.Context', ['underscore'], function (_) {
    'use strict';
    // @class Merchandising.Context This class defines a generic facade that allows to handle the association between a View and its handler
    // @method MerchandisingContext Instance method that given a view associate to it an instance of the Merchandising.Context class
    // @constructor
    // @param {Function} view
    // @return {Merchandising.Context?}
    var MerchandisingContext = function MerchandisingContext(view) {
        if (view.MerchandisingContext) {
            return view.MerchandisingContext;
        }
        this.view = view;
        view.MerchandisingContext = this;
    };
    _.extend(MerchandisingContext, {
        // @property {Array<Merchandising.Context.Handler>} handlers List of registered handlers @static
        handlers: []    // @method registerHandlers Pushes a new handler for a specific view to the handler list
              // @static
              // @param {Function} view_constructor View that will be associated with a particular handler
              // @param {Merchandising.Context.Handler} methods Object that will be used to handle the specified view constructor
              // @return {Merchandising.Context}
,
        registerHandlers: function (view_constructor, methods) {
            if (view_constructor) {
                // if there was already a handler for that view
                // we remove it from the list, and extend the new
                // handler with any events that the previous one had
                var new_handler = _.extend(MerchandisingContext.removeHandler(view_constructor), methods);
                new_handler.viewConstructor = view_constructor;
                // then we add it first on the list
                MerchandisingContext.handlers.unshift(new_handler);
            }
            return MerchandisingContext;
        }    // @method removeHandler based on the constructor passed as a parameter, removes any handler that matches the constructor from the handlers list.
             // @static
             // @param {Function} view_constructor
             // @returns {Merchandising.Context.Handler} the removed handler
,
        removeHandler: function (view_constructor) {
            var removed = {};
            MerchandisingContext.handlers = _.reject(MerchandisingContext.handlers, function (handler) {
                if (handler.viewConstructor === view_constructor) {
                    removed = handler;
                    return true;
                }
            });
            return removed;
        }    // @method getHandlerForView @static
             // @returns {Merchandising.Context.Handler} A handler for the passed in view
,
        getHandlerForView: function (view) {
            return _.find(MerchandisingContext.handlers, function (handler) {
                return view instanceof handler.viewConstructor;
            });
        }    // @method escapeValue @static
             // @param {String} value
             // @return {String}
,
        escapeValue: function (value) {
            return value ? value.toString().replace(/\s/g, '-') : '';
        }    // @method callHandler calls 'callback_key' from the handler for that view passing all of the arguments
             // @static @param {String} callback_key @param {Object} context @param {Array} parameters
,
        callHandler: function (callback_key, context, parameters) {
            var handler = MerchandisingContext.getHandlerForView(context.view);
            return handler && _.isFunction(handler[callback_key]) && handler[callback_key].apply(context, parameters);
        }    // @method appendFilterValue @static
             // @param {Object} filters
             // @param {String} key
             // @param {to:String,from:String} value
,
        appendFilterValue: function (filters, key, value) {
            if (_.isObject(value) && 'to' in value && 'from' in value) {
                delete filters[key];
                filters[key + '.to'] = value.to;
                filters[key + '.from'] = value.from;
            } else {
                if (_.isUndefined(filters[key])) {
                    filters[key] = '';
                }
                var comma = '';
                if (filters[key]) {
                    comma = ',';
                }
                filters[key] += comma + value;
            }
        }
    });
    _.extend(MerchandisingContext.prototype, {
        // @method callHandler
        // @param {String} callback_key function name to invoke. Possible values are: getIdItemsToExclude or getFilters
        // @return {Any}
        callHandler: function (callback_key) {
            return MerchandisingContext.callHandler(callback_key, this, _.toArray(arguments).slice(1));
        }    // @method getFilters
             // @param {Object} filters
             // @param {Boolean} isWithin
,
        getFilters: function (filters, isWithin) {
            var parsed_filters = this.callHandler('getFilters', filters, isWithin);
            if (!parsed_filters) {
                parsed_filters = {};
                _.each(filters, function (values, key) {
                    values = _.without(values, '$current');
                    if (values.length) {
                        _.each(values, function (value) {
                            MerchandisingContext.appendFilterValue(parsed_filters, key, value);
                        });
                    }
                });
            }
            return parsed_filters;
        }    // @method getIdItemsToExclude
,
        getIdItemsToExclude: function () {
            return this.callHandler('getIdItemsToExclude') || [];
        }
    });
    return MerchandisingContext;
});



/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Merchandising
define('Merchandising.View', [
    'merchandising_zone.tpl',
    'merchandising_zone_cell_template.tpl',
    'merchandising_zone_row_template.tpl',
    'SC.Configuration',
    'Backbone',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'ItemRelations.RelatedItem.View',
    'underscore',
    'Utils',
    'jQuery.bxSlider'
], function (merchandising_zone_tpl, merchandising_zone_cell_template_tpl, merchandising_zone_row_template_tpl, Configuration, Backbone, BackboneCompositeView, BackboneCollectionView, ItemRelationsRelatedItemView, _) {
    'use strict';
    // @class Merchandising.View Responsible for rendering the list of item requested by a merchandizing
    // rule @extend Backbone.View
    return Backbone.View.extend({
        template: merchandising_zone_tpl    // @method initialize Creates a new instance of the current view
                                  // @param {MerchandisingRule.Model} options.model
                                  // @param {Merchandising.ItemCollection} options.items
,
        initialize: function (options) {
            this.model = options.model;
            this.items = options.items;
            Backbone.View.prototype.initialize.apply(this, arguments);
            BackboneCompositeView.add(this);
            var self = this;
            this.on('afterMerchandAppendToDOM', _.bind(this.initSlider, self));
        },
        childViews: {
            'Zone.Items': function () {
                var itemsCollectionView = new BackboneCollectionView({
                    childView: ItemRelationsRelatedItemView,
                    viewsPerRow: Infinity,
                    cellTemplate: merchandising_zone_cell_template_tpl,
                    rowTemplate: merchandising_zone_row_template_tpl,
                    collection: _.first(this.items.models, this.model.get('show'))
                });
                return itemsCollectionView;
            }
        }    // @method initSlider
,
        initSlider: function () {
            var element = this.$el.find('[data-type="carousel-items"]');
            this.$slider = _.initBxSlider(element, Configuration.bxSliderDefaults);
        }    // @method getContext @returns {Content.LandingPages.View.Context}
,
        getContext: function () {
            // @class Content.LandingPages.View.Context
            return {
                // @property {String} zoneTitle
                zoneTitle: this.model.get('title')    // @property {Boolean} isZoneDescription
,
                isZoneDescription: !!this.model.get('description')    // @property {Stirng} zoneDescription
,
                zoneDescription: this.model.get('description')
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Merchandising
define('Merchandising.Zone', [
    'Merchandising.Item.Collection',
    'Merchandising.Rule',
    'Merchandising.Context',
    'Merchandising.View',
    'LiveOrder.Model',
    'underscore',
    'jQuery'
], function (MerchandisingItemCollection, MerchandisingRule, MerchandisingContext, MerchandisingView, LiveOrderModel, _, jQuery) {
    'use strict';
    // @class Merchandising.Zone
    // we declare a new version of the ItemCollection
    // to make sure the urlRoot doesn't get overridden
    // @constructor @param {HTMLElement|jQuery} element @param {Object} options
    var MerchandisingZone = function MerchandisingZone(element, options) {
        var application = options && options.application, layout = application && application.getLayout && application.getLayout();
        if (!element || !layout) {
            return;
        }
        this.$element = jQuery(element).empty();
        // we try to get the model based on option.id (if passed) or the elements data id
        this.model = MerchandisingRule.Collection.getInstance().get(options.id || this.$element.data('id'));
        if (this.model && this.$element.length && !this.$element.hasClass(this.loadingClassNames)) {
            this.options = options;
            this.application = application;
            this.items = new MerchandisingItemCollection();
            this.context = new MerchandisingContext(layout.modalCurrentView || layout.currentView || layout);
            this.initialize();
        }
    };
    _.extend(MerchandisingZone.prototype, {
        // @method initialize
        // @return {Void}
        initialize: function () {
            this.addLoadingClass();
            // the listeners MUST be added before the fetch ocurrs
            this.addListeners();
            // fetch the items
            this.items.fetch({
                cache: true,
                data: this.getApiParams()
            });
        }    // @method addListeners install the listeners
             // @return {Void}
,
        addListeners: function () {
            var proxy = jQuery.proxy;
            this.items.on({
                sync: proxy(this.excludeItems, this),
                excluded: proxy(this.appendItems, this),
                appended: proxy(this.removeLoadingClass, this),
                error: proxy(this.handleRequestError, this)
            });
        }    // @method getApiParams precondition: this.model and this.options must be defined
             // @return {Object}
,
        getApiParams: function () {
            var filters = this.parseApiFilterOptions(), sorting = this.parseApiSortingOptions();
            if (sorting.length) {
                filters.sort = sorting.join(',');
            }
            // # Response
            // parameters to be passed to the item's fetch query
            return _.extend({
                limit: this.getLimit(),
                fieldset: this.model.get('fieldset')
            }, filters);
        }    // @method parseApiFilterOptions @return {Object}
,
        parseApiFilterOptions: function () {
            var filters = {};
            // parses the merchandising rule filters into the filters obj
            _.each(this.model.get('filter'), function (rule_filter) {
                filters[rule_filter.field_id] = rule_filter.field_value;
            });
            return this.context.getFilters(filters, this.model.get('within'));
        }    // @method parseApiSortingOptions turn sorting obj into a string for the query @return {Array}
,
        parseApiSortingOptions: function () {
            return _.map(this.model.get('sort'), function (value) {
                return value.field_id + ':' + value.dir;
            });
        }    // @method getLimit if there are items to get excluded from the collection.
             // We need to ask for more items from the api because the filtering gets done after the request.
             // @return {Number}
,
        getLimit: function () {
            var model = this.model, limit = model.get('show'), exclude = model.get('exclude');
            if (exclude.length) {
                if (_.contains(exclude, '$cart')) {
                    limit += LiveOrderModel.getInstance().get('lines').length;
                }
                if (_.contains(exclude, '$current')) {
                    limit += this.context.getIdItemsToExclude().length;
                }
            }
            return limit <= 100 ? limit : 100;
        }    // @method excludeItems
,
        excludeItems: function () {
            var self = this;
            _.each(this.model.get('exclude'), function (filter) {
                self.applyFilterToItems(filter);
            });
            this.items.trigger('excluded');
            return this;
        }    // @method applyFilterToItems narrows down the collection if excludes set up on the merchandising rule
             // @param {String} filter the type of item filtering, currently supported values are: ```'@cart'``` and ```'@current'```
,
        applyFilterToItems: function (filter) {
            var items = this.items;
            switch (filter) {
            case '$cart':
                var item = null;
                LiveOrderModel.getInstance().get('lines').each(function (line) {
                    item = line.get('item');
                    items.remove(items.get(item.get('_matrixParent').get('_id') || item.get('_id')));
                });
                break;
            case '$current':
                _.each(this.context.getIdItemsToExclude(), function (id) {
                    items.remove(items.get(id));
                });
                break;
            }
            return this;
        }    // @method appendItems
,
        appendItems: function () {
            var items = this.items;
            if (items.length) {
                if (this.model.get('template')) {
                    // we try to get the 'template' from the merchandising rule
                    var amd_optimize_trick_for_require = require;
                    MerchandisingView.prototype.template = amd_optimize_trick_for_require(this.model.get('template'));
                }
                var view = new MerchandisingView({
                    model: this.model,
                    items: items,
                    application: this.application
                });
                view.render();
                this.$element.append(view.$el);
                view.trigger('afterMerchandAppendToDOM');
            }
            items.trigger('appended');
            // notify the layout that the content might have changed
            this.options && this.options.application && this.options.application.getLayout().trigger('afterRender');
            return this;
        }    // @property {String} loadingClassNames
,
        loadingClassNames: 'loading loading-merchandising-zone'    // @method addLoadingClass
,
        addLoadingClass: function () {
            this.$element.addClass(this.loadingClassNames);
        }    // @method removeLoadingClass
,
        removeLoadingClass: function () {
            this.$element.removeClass(this.loadingClassNames);
        }    // @method handleRequestError
,
        handleRequestError: function () {
            this.removeLoadingClass();
            console.error('Merchandising Zone - Request Error', arguments);
        }
    });
    return MerchandisingZone;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module Merchandising 
#Merchandizing jQuery plugin
Implements a jQuery plugin 'merchandisingZone' to handle the Merchandising Zone's intialization. Usage example:

	jQuery('my-custom-selector').merchandisingZone(options) 

options MUST include the application its running id of the Zone to be rendered is optional IF it is on the element's data-id
*/
define('Merchandising.jQueryPlugin', [
    'Merchandising.Zone',
    'jQuery'
], function (MerchandisingZone, jQuery) {
    'use strict';
    // [jQuery.fn](http://learn.jquery.com/plugins/basic-plugin-creation/)
    jQuery.fn.merchandisingZone = function (options) {
        return this.each(function () {
            new MerchandisingZone(this, options);
        });
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Merchandising
// Module to handle MerchandisingZones (ex: Featured Items section)
define('Merchandising', [
    'Merchandising.Item.Collection',
    'Merchandising.Rule',
    'Merchandising.jQueryPlugin',
    'underscore'
], function (MerchandisingItemCollection, Rule, jQueryPlugin, _) {
    'use strict';
    return {
        reRenderMerchandizing: function reRenderMerchandizing(application, view) {
            view.$('[data-type="merchandising-zone"]').merchandisingZone({ application: application });
        }    // @class Merchandising It will listen onAfterAppendView to see if there is a new placeholder on
             // which to attach a merchandising @extends ApplicationModule
,
        mountToApp: function (application) {
            if (SC.ENVIRONMENT.MERCHANDISING) {
                // we need to turn it into an array
                var definitions = _.map(SC.ENVIRONMENT.MERCHANDISING, function (value, key) {
                    value.internalid = key;
                    return value;
                });
                Rule.Collection.getInstance().reset(definitions);
                delete SC.ENVIRONMENT.MERCHANDISING;
            }
            // we add the default options to be added when fetching the items
            // this includes language and shoper's currency
            MerchandisingItemCollection.prototype.searchApiMasterOptions = application.getConfig('searchApiMasterOptions.merchandisingZone');
            var current_selected_view, self = this;
            // afterAppendView is triggered whenever a view or modal is appended
            application.getLayout().on('afterAppendView', function (view) {
                if (!current_selected_view) {
                    current_selected_view = view;
                } else {
                    current_selected_view.off('afterViewRender', self.reRenderMerchandizing);
                    current_selected_view.off('afterCompositeViewRender', self.reRenderMerchandizing);
                    current_selected_view = view;
                }
                current_selected_view.on(view.childViews ? 'afterCompositeViewRender' : 'afterViewRender', _.bind(self.reRenderMerchandizing, self, application));
                self.reRenderMerchandizing(application, current_selected_view);
            })    // content service triggers this event when rendering a new enhanced page
.on('renderEnhancedPageContent', function (view, content_zone) {
                // if the type of the content zone is merchandising
                if (content_zone.contenttype === 'merchandising') {
                    var target = content_zone.target, $view_target = view.$(target), merchandising_zone_options = {
                            application: application,
                            id: content_zone.content
                        };
                    // if the target is in the current view
                    // we add the merchandising zone there
                    if ($view_target.length) {
                        $view_target.merchandisingZone(merchandising_zone_options);
                    } else {
                        // else, we search for the target in the layout
                        this.$(target).filter(':empty').merchandisingZone(merchandising_zone_options);
                    }
                }
            });
            // @module ApplicationSkeleton @class ApplicationSkeleton @method getMerchandisingRules @return {MerchandisingRule.Collection}
            application.getMerchandisingRules = function getMerchandisingRules() {
                return Rule.Collection.getInstance();
            };
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module CheckoutSkipLogin
Checkout Skip Login mode. The Checkout Skip Login is a feature that is disabled by default and can be enabled by setting
property checkoutApp.skipLogin to true in backend.configuration.js file.

Basically for implementing skip login what we are doing is overriding the ```save()``` method of the following models:
```LiveOrderModel```, ```AddressModel```, ```CreditCardModel``` and	```ProfileModel```.

The objective is to first call register-guest service and only then call the real save() so the operation is made
with a guest session.
*/
define('CheckoutSkipLogin', [
    'Account.RegisterAsGuest.Model',
    'LiveOrder.Model',
    'Address.Model',
    'CreditCard.Model',
    'Profile.Model',
    'jQuery',
    'underscore',
    'Utils'
], function (AccountRegisterAsGuestModel, LiveOrderModel, AddressModel, CreditCardModel, ProfileModel, jQuery, _, Utils) {
    'use strict';
    var promise_guest = null;
    return {
        mountToApp: function (application) {
            // do nothing if the mode is disabled
            if (!application.getConfig('checkout.skipLogin')) {
                return;
            }
            //this function is called only if skip login mode is enabled
            var registerUserAsGuest = function registerUserAsGuest() {
                var promise = jQuery.Deferred(), profile_model = ProfileModel.getInstance();
                if (profile_model.get('isGuest') === 'F' && profile_model.get('isLoggedIn') === 'F') {
                    var checkout_step = application.getLayout().currentView.currentStep;
                    if (checkout_step) {
                        checkout_step.disableNavButtons();
                    }
                    new AccountRegisterAsGuestModel().save().done(function (data) {
                        var skip_login_dont_update_profile = profile_model.get('skipLoginDontUpdateProfile'), current_view = application.getLayout().currentView;
                        if (skip_login_dont_update_profile && data.user) {
                            _.each(skip_login_dont_update_profile, function (attr) {
                                delete data.user[attr];
                            });
                        }
                        if (data.user) {
                            profile_model.set(data.user);
                        }
                        current_view.wizard.options.profile = profile_model;
                        if (data.touchpoints) {
                            application.Configuration.siteSettings.touchpoints = data.touchpoints;
                        }
                        promise.resolve();
                        if (checkout_step) {
                            checkout_step.enableNavButtons();
                        }
                        current_view.$('[data-action="skip-login-message"]').remove();
                    });
                } else {
                    promise.resolve();
                }
                return promise;
            };
            // add 'this.application' to models that doesn't have it.
            AddressModel.prototype.application = application;
            CreditCardModel.prototype.application = application;
            ProfileModel.prototype.application = application;
            // wrap save() method to LiveOrderModel, AddressModel and CreditCardModel
            var wrapperCheckoutSkipLogin = function wrapperCheckoutSkipLogin(superFn) {
                var self = this, super_arguments = Array.prototype.slice.apply(arguments, [
                        1,
                        arguments.length
                    ]), promise = jQuery.Deferred();
                if (!promise_guest) {
                    promise_guest = registerUserAsGuest();
                }
                promise_guest.done(function () {
                    var result = superFn.apply(self, super_arguments);
                    if (result) {
                        result.done(function () {
                            promise.resolve.apply(result, arguments);
                        }).fail(function () {
                            promise.reject.apply(result, arguments);
                        });
                    } else {
                        // Notify future promises that a front end validation took place and no promise is returned
                        promise.frontEndValidationError = true;
                        promise.reject.apply(result, super_arguments);
                    }
                });
                _(promise).extend({
                    error: function () {
                        return this;
                    },
                    success: function () {
                        return this;
                    }
                });
                return promise;
            };
            // Site Builder cart is in Checkout :/ don't wrap if in shopping
            if (Utils.isInCheckout()) {
                LiveOrderModel.prototype.save = _.wrap(LiveOrderModel.prototype.save, wrapperCheckoutSkipLogin);
            }
            AddressModel.prototype.save = _.wrap(AddressModel.prototype.save, wrapperCheckoutSkipLogin);
            CreditCardModel.prototype.save = _.wrap(CreditCardModel.prototype.save, wrapperCheckoutSkipLogin);
            ProfileModel.prototype.save = _.wrap(ProfileModel.prototype.save, wrapperCheckoutSkipLogin);
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module ImageNotAvailable
// --------------------
// Simple Module that will make sure that
// if an image files to load it will load an alternative image in it
define('ImageNotAvailable', [
    'jQuery',
    'Utils'
], function (jQuery, Utils) {
    'use strict';
    //@class ImageNotAvailable @extends ApplicationModule
    return {
        //@method mountToApp
        //@param {ApplicationSkeleton} application
        //@return {Void}
        mountToApp: function (application) {
            // Every time a new view is rendered
            application.getLayout().on('afterAppendView', function (view) {
                // it will look at the img and bind the error event to it
                view.$('img').on('error', function () {
                    // and haven't tried to changed it before, so we don't enter an infinite loop
                    if (!this.errorCounter) {
                        var $this = jQuery(this), src = application.resizeImage(Utils.getThemeAbsoluteUrlOfNonManagedResources('img/no_image_available.jpeg', application.getConfig('imageNotAvailable')), Utils.getViewportWidth() < 768 ? 'thumbnail' : 'zoom');
                        $this    // it will set the src of the img to the default image not available. You can set logic based on size or a class for displaying different urls if you need
.attr('src', src)    // ImageLoader compatibility
.attr('data-image-status', 'done');
                        $this.parent('[data-zoom]').length && $this.parent('[data-zoom]').zoom();
                        this.errorCounter = true;
                    }
                });
            });
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module BrontoIntegration
define('BrontoIntegration', [
    'SC.Configuration',
    'jQuery'
], function (Configuration, jQuery) {
    'use strict';
    /*
    @class BrontoIntegration

    Loads Bronto Adapter script once on afterAppendView if it runs on the browser and the Bronto instanceId is set in the Configuration
    
    loadScript() appends the Bronto adapter script based on the configuration (instance id and adapter url). data-bronto-integrations attribute is set to the instance id
    mountToApp() runs only on the browser and if the Bronto account id is set, attaches the loadScript to once afterAppendView
    */
    return {
        //@property {String} instanceId
        instanceId: ''    //@property {String} adapterUrl
,
        adapterUrl: ''    //@method loadScript @return {Void}
,
        loadScript: function () {
            jQuery('body').append(jQuery('<script src="' + this.adapterUrl + '" data-bronto-integrations="' + this.instanceId + '"></script>'));
        }    //@method mountToApp @return {Void}
,
        mountToApp: function (application) {
            if (SC.ENVIRONMENT.jsEnvironment === 'browser') {
                var bronto_config = Configuration.bronto;
                if (bronto_config && bronto_config.accountId) {
                    this.instanceId = bronto_config.accountId;
                    this.adapterUrl = bronto_config.adapterUrl;
                    application.getLayout().once('afterAppendView', jQuery.proxy(this, 'loadScript'));
                }
            }
        }
    };
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CMSadapter
define('CMSadapter.Landing.View', [
    'cms_landing_page.tpl',
    'Backbone'
], function (cms_landing_page_tpl, Backbone) {
    'use strict';
    // @class CMSadapter.Landing.View @extends Backbone.View
    return Backbone.View.extend({
        template: cms_landing_page_tpl,
        title: '',
        page_header: '',
        attributes: {
            'id': 'cms-landing-page',
            'class': 'cms-landing-page'
        },
        initialize: function initialize(options) {
            Backbone.View.prototype.initialize.apply(this, arguments);
            this.model = options.model;
        },
        getBreadcrumbPages: function getBreadcrumbPages() {
            var url = this.model.get('url'), path = url[0] === '/' ? url : '/' + url;
            return [{
                    href: path,
                    text: this.model.get('page_title')
                }];
        }    // @method getContext
             // @returns {CMSadapter.Landing.View.Context}
,
        getContext: function getContext() {
            // @class CMSadapter.Landing.View.Context
            return {
                // @property {Boolean} inModal
                inModal: this.inModal,
                title: this.title,
                pageHeader: this.page_header,
                model: this.model
            };    // @class CMSadapter.Landing.View
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CMSadapter
define('CMSadapter.Page.Model', ['Backbone'], function (Backbone) {
    'use strict';
    // @class CMSadapter.Page.Model Model for handling CMS landing and enhanced pages @extends Backbone.Model
    return Backbone.Model.extend({});
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CMSadapter
define('CMSadapter.Page.Collection', [
    'CMSadapter.Page.Model',
    'Backbone'
], function (CMSadapterPageModel, Backbone) {
    'use strict';
    // @class CMSadapter.Page.Collection @extends Backbone.Collection
    return Backbone.Collection.extend({ model: CMSadapterPageModel });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CMSadapter
define('CMSadapter.Page.Router', [
    'CMSadapter.Landing.View',
    'CMSadapter.Page.Collection',
    'Backbone'
], function (CMSadapterLandingView, CMSadapterPageCollection, Backbone) {
    'use strict';
    // @class CMSadapter.Page.Router @extends Backbone.Router
    return Backbone.Router.extend({
        routes: {},
        initialize: function initialize(application, collection) {
            this.application = application;
            this.allPages = collection;
            this.landingPages = new CMSadapterPageCollection(collection.filter(function (page) {
                return page.get('type') === 1;
            }) || []);
            var self = this;
            this.landingPages.each(function (landing_page) {
                self.route(landing_page.get('url') + '?*options', 'displayLandingPage');
                self.route(landing_page.get('url'), 'displayLandingPage');
            });
        }    // @method displayLandingPage uses the DataModels.loadPage to load the data and create the model
,
        displayLandingPage: function displayLandingPage(options) {
            var page = this.getPageForFragment();
            var view = new CMSadapterLandingView({
                application: this.application,
                model: page,
                options: options
            });
            view.showContent();
            Backbone.Events.trigger('adapter:page:changed');
        }    // @method getPageForFragment
             // A handcrafted method for getting the page model given a url.
,
        getPageForFragment: function getPageForFragment(fragment, allPages) {
            fragment = fragment || Backbone.history.fragment || '/';
            fragment = fragment.split('?')[0];
            //remove options
            var collection = allPages ? this.allPages : this.landingPages;
            return collection.find(function (page) {
                return page.get('url') === fragment;
            });
        },
        addLandingRoute: function addLandingRoute(page, originalUrl) {
            var originalPage = this.getPageForFragment(originalUrl || page.url);
            if (originalPage) {
                this.landingPages.remove(originalPage);
            }
            this.route(page.url, 'displayLandingPage');
            this.landingPages.add(page);
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*

@module CMSadapter
@class CMSadapterImpl.Enhanced the class that  the enhanced pages of CMS
*/
define('CMSadapter.Impl.Enhanced', [
    'Tracker',
    'underscore',
    'Backbone',
    'jQuery'
], function (Tracker, _, Backbone, jQuery) {
    'use strict';
    function AdapterEnhanced(application, router) {
        this.application = application;
        this.router = router;
        var self = this, layout = application.getLayout(), show_content_wrapper = function (fn, view) {
                var promise = jQuery.Deferred();
                var args = arguments;
                var page = router && router.getPageForFragment(Backbone.history.fragment, true);
                view.enhancedPage = true;
                Tracker.getInstance().trackPageview('/' + Backbone.history.fragment);
                // Calls the original function with all the parameters (slice to exclude fn)
                fn.apply(layout, Array.prototype.slice.call(args, 1)).done(function () {
                    // once the original function is done this reads the attributes of the view and
                    // sets title, metas and adds banners
                    self.enhancePage(view, layout, page);
                    //only after enhancing the view we resolve the promise
                    promise.resolveWith(this, arguments);
                });
                return promise;
            };
        // Wraps the layout.showContent and Layout.showInModal methods
        // This make sure that every time you try to show content in the
        // application the page will be enhanced by setting title, header, meta tags and banners
        layout.showContent = _.wrap(layout.showContent, show_content_wrapper);
        layout.showInModal = _.wrap(layout.showInModal, show_content_wrapper);
    }
    _.extend(AdapterEnhanced.prototype, {
        enhancePage: function (view, layout, page) {
            var $head = jQuery('head');
            // first, initialize head tags if they are not present
            $head.not(':has(title)').append('<title/>').end().not(':has(link[rel="canonical"])').append('<link rel="canonical"/>').end().not(':has(meta[name="keywords"])').append('<meta name="keywords"/>').end().not(':has(meta[name="description"])').append('<meta name="description"/>').end();
            view.title = page && page.get('page_title') || view.getTitle();
            view.metaDescription = page && page.get('meta_description') || view.getMetaDescription();
            view.metaKeywords = page && page.get('meta_keywords') || view.getMetaKeywords();
            // set title in DOM
            var title = view.getTitle();
            if (title) {
                document.title = title;
            }
            // Sets the text of the title element if we are in the server
            // we only do it on the server side due to an issue modifying
            // the title tag on IE :(
            if (SC.ENVIRONMENT.jsEnvironment === 'server') {
                $head.find('title').text(title);
            }
            // meta keywords and meta description. We aren't adding the tags but reusing existing ones
            $head.find('meta[name="description"]').attr('content', view.metaDescription || view.getMetaDescription()).end().find('meta[name="keywords"]').attr('content', view.metaKeywords || view.getMetaKeywords()).end().append(view.getMetaTags().not('[name="description"]').not('[name="keywords"]'));
            $head.find('link[rel="canonical"]').attr('href', view.getCanonical()).end()    // we remove any existing next/prev tags every time
                                                                                           // a page is rendered in case the previous view was paginated
.find('link[rel="next"], link[rel="prev"]').remove();
            // if the current page is paginated
            // set prev/next link rel
            this.setLinkRel('prev', view.getRelPrev(), $head);
            this.setLinkRel('next', view.getRelNext(), $head);
            // addition to head. Heads up! Each element added is stored and when the view is destroyed we remove these
            // elements from the DOM. If not the head will be polluted each time the user navigates.
            var additionToHead = page && page.get('addition_to_head') || view.getAddToHead();
            view.enhancedNodes = [];
            if (additionToHead && jQuery.trim(additionToHead + '')) {
                var $additionToHead = jQuery(additionToHead);
                $additionToHead.each(function () {
                    var $node = jQuery(this);
                    $head.append($node);
                    view.enhancedNodes.push($node);
                });
            }
            view.destroy = _.wrap(view.destroy, function (fn) {
                var args = Array.prototype.slice.call(arguments, 1);
                fn.apply(this, args);
                _.each(this.enhancedNodes, function ($node) {
                    $node.remove();
                });
            });
        },
        setLinkRel: function (rel, link, $head) {
            link && jQuery('<link />', {
                rel: rel,
                href: link
            }).appendTo($head);
        }
    });
    return AdapterEnhanced;
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module CustomContentType
define('CustomContentType.Container.View', [
    'custom_content_type_container.tpl',
    'Backbone'
], function (custom_content_type_container_tpl, Backbone) {
    'use strict';
    //@class CustomContentType.Container.View @extends Backbone.View
    //inherits the basic render and destroy methods from Backbone.View
    return Backbone.View.extend({
        template: custom_content_type_container_tpl,
        initialize: function initialize(options) {
            this.addChildViewInstances({
                'CCT-View': {
                    'CCT-View': {
                        childViewInstance: options.innerCustomContentType,
                        childViewIsExternal: true
                    }
                }
            });
        }    // @method getContext
             // @return {CustomContentType.Container.View.Context}
,
        getContext: function getContext() {
            // @class CustomContentType.Container.View.Context
            return {
                //@property {String} instanceId
                instanceId: this.options.instanceId,
                classes: this.options.classes
            };    // @class CustomContentType.Container.View
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CMSadapter
define('CMSadapter.Component', [
    'CustomContentType.Container.View',
    'SC.BaseComponent',
    'Utils',
    'underscore',
    'jQuery'
], function (CustomContentTypeContainerView, SCBaseComponent, Utils, _, jQuery) {
    'use strict';
    var placeholder_views = {};
    var view_ccts_to_rerender = {};
    return function CMSadapterComponentGenerator(application) {
        // @class CMSComponent Allows the user to interact with CMS related concepts like enhanced content, landing pages, commerce categories,
        // custom content types, etc.
        // @extends SC.BaseComponent
        return SCBaseComponent.extend({
            componentName: 'CMS',
            application: application    //@property {CMSadapter.Component.CustomContentTypeStore} _customContentTypes Custom content type store
                           //@private
,
            _customContentTypes: {}    //@property {CMSadapter.Component.CustomerContentTypeInstance.Store} _customContentTypesInstances Custom content type instances store
                  //@private
,
            _customContentTypesInstances: {}    //@method _createError Internal error to centralize the generation of errors
                  //@param {String} error_code Code of the error (Capitalized word)
                  //@param {String} error_message Details error message
                  //@return {CMSadapter.Component.Error}
,
            _createError: function _createError(error_code, error_message) {
                //@class CMSadapter.Component.Error
                return {
                    //@property {String} code
                    title: error_code    //@property {String} message
,
                    message: error_message
                };    //@class CMSadapterComponent
            }    //@method _installContent Internal method to handle the installation of a CCT (call the install method)
                 //@private
                 //@param {CustomContentType.Base.View} cct A CCT instance
                 //@param {Object} cct_settings Any object to be sent to the cct instance
                 //@return {jQuery.Deferred}
,
            _installContent: function _installContent(cct, cct_settings, context_data) {
                var self = this;
                return jQuery.when(cct.install(cct_settings, context_data)).then(function () {
                    return jQuery.Deferred().resolve();
                }, function (e) {
                    var message = e && _.isFunction(e.toString) && e.toString() || _('Unknown error installing CCT. CCT Instance Id: $(0)').translate(cct.instanceId);
                    return jQuery.Deferred().reject(self._createError('ERR_INSTALLING_CCT', message));
                });
            }    //@method _updateSettings Internal method to handle the update of the CCT settings (call the update method)
                 //@private
                 //@param {CustomContentType.Base.View} cct A CCT instance
                 //@param {Object} cct_settings Any object to be sent to the cct instance
                 //@return {jQuery.Deferred}
,
            _updateSettings: function _updateSettings(cct, cct_settings) {
                var self = this;
                return jQuery.when(cct.update(cct_settings)).then(function () {
                    return jQuery.Deferred().resolve();
                }, function (e) {
                    var message = e && _.isFunction(e.toString) && e.toString() || _('Unknown error updating CCT. CCT Instance Id: $(0)').translate(cct.instanceId);
                    return jQuery.Deferred().reject(self._createError('ERR_UPDATING_CCT', message));
                });
            }    //@method _addViewCctsToRerender Internal method for associating views being rendered with their corresponding CCTs.
                 //We use the template name as the dictionary key.
                 //@private
                 //@param {Backbone.View} a view instance
                 //@param {Object} cctGenerator object with the necessary information for creating a CCT.
                 //@return {Void}
,
            _addViewCctsToRerender: function _addViewCctsToRerender(view, cctGenerator) {
                if (view.template && view.template.Name) {
                    if (_.isUndefined(view_ccts_to_rerender[view.template.Name])) {
                        view_ccts_to_rerender[view.template.Name] = [];
                    }
                    view_ccts_to_rerender[view.template.Name].push(cctGenerator);
                }
            }    // @method getPlaceholderViews returns an object with the association between selectors and their views.
                 // @return {PlaceholderViews}
,
            placeholderViews: function placeholderViews() {
                return placeholder_views;
            }    // @method clears the placeholder_views
                 // @return {Void}
,
            resetPlaceholderViews: function resetPlaceholderViews() {
                placeholder_views = {};
            }    //@method registerCustomContentType Register a new CCT for the running application
                 //@public
                 //@param {CustomContentType.Base.View} cct Custom Content Type View constructor
                 //@return {Void}
,
            registerCustomContentType: function registerCustomContentType(cct) {
                this._customContentTypes[cct.id.toLowerCase()] = cct;
            }    //@method addContents Add multiple CCTs.
                 // If the CCT was already added, then it just will attach the previous CCT view instance again
                 // (that means that new settings or render_settings will be ignored)
                 // Otherwise it will create a new CCT and add it to the current view
                 //@public
                 //@param {Array<CustomContentType.Base.View>}  ccts
                 //@return {jQuery.Deferred}
,
            addContents: function addContents(ccts) {
                var self = this, old_instances = _.keys(this._customContentTypesInstances), async_operations = [];
                view_ccts_to_rerender = {};
                ccts = self._sortCCTs(ccts);
                //Clear all current ccts (detach from DOM) AND those that were taking or will take part of a repetitive context will be removed
                _.each(_.keys(this._customContentTypesInstances), function (old_instance_id) {
                    var selector = self._customContentTypesInstances[old_instance_id].length && self._customContentTypesInstances[old_instance_id][0].selector, views = selector && self.getPlaceholderViews(selector), old_instance = self._customContentTypesInstances[old_instance_id];
                    if (old_instance && old_instance.length > 1 || views && views.length > 1) {
                        self.removeContent(old_instance_id, true);
                        old_instances.splice(_.indexOf(old_instances, old_instance_id), 1);
                    } else {
                        self.removeContent(old_instance_id, false);
                    }
                });
                //Calculate what ccts needs to be preserved and what ccts are new
                _.each(ccts, function (cct) {
                    if (_.indexOf(old_instances, cct.instance_id) >= 0) {
                        //re add into the parent view
                        _.each(self._customContentTypesInstances[cct.instance_id], function (cct_container) {
                            var generator = {}, container_name = cct_container.selector['data-cms-area'];
                            generator[container_name] = {};
                            generator[container_name][cct.instance_id] = {
                                childViewIndex: 1000 + parseInt(cct.render_settings.position, 10),
                                childViewConstructor: null,
                                childViewInstance: cct_container.container,
                                childViewSelector: cct_container.selector,
                                childViewIsExternal: true
                            };
                            var parent_view_instance = cct_container.container.parentView;
                            parent_view_instance.addChildViewInstances(generator, true);
                            self._addViewCctsToRerender(parent_view_instance, generator);
                        });
                        old_instances.splice(_.indexOf(old_instances, cct.instance_id), 1);
                    } else {
                        //add new children view
                        async_operations.push(self.addContent(cct.id, cct.instance_id, cct.selector, cct.settings, cct.render_settings));
                    }
                });
                //Remove old instances
                _.each(old_instances, function (old_instance_id) {
                    async_operations.push(self.removeContent(old_instance_id, true));
                });
                return jQuery.when.apply(jQuery, async_operations);
            }    //@method addContent Adds a new CCT into the specified placeholder
                 //@public
                 //@param {String} cct_id Id of the CCT constructor. This value must have been registered previously
                 //@param {String} cct_instance_id. Unique identifier of the new CCT
                 //@param {Selector} cct_selector Where the cct should be inserted
                 //@param {Object} cct_settings Any setting that will be sent to the new cct instance
                 //@param {CMSadapter.Component.addContent.RenderSettings} render_settings Setting on how the rendering should be done
                 //@return {jQuery.Deferred}
,
            addContent: function addContent(cct_id, cct_instance_id, cct_selector, cct_settings, render_settings) {
                var self = this, selector = this.getPlaceholder(cct_selector), container = selector ? this.getPlaceholderViews(self.selectorToString(selector)) : null, async_operations = [];
                cct_id = cct_id.toLowerCase();
                if (!selector || !container.views || !container.views.length || !self._customContentTypes[cct_id]) {
                    return jQuery.Deferred().resolve();
                } else if (self._customContentTypesInstances[cct_instance_id] && self._customContentTypesInstances[cct_instance_id].length) {
                    return jQuery.Deferred().reject(self._createError('ERR_INVALID_INSTANCE_ID', _('There is already a CCT with the Instance Id $(0). Unable to add CCT: Id: $(1). CCT Instance Id: $(2). Placeholder: $(3)').translate(cct_instance_id, cct_id, cct_instance_id, self.selectorToString(cct_selector))));
                } else {
                    if (!self._customContentTypesInstances[cct_instance_id]) {
                        self._customContentTypesInstances[cct_instance_id] = [];
                    }
                    _.each(container.views, function (parent_view_instance) {
                        var cct_constructor = self._customContentTypes[cct_id].view, cct_constructor_options = self._customContentTypes[cct_id].options || {}, cct_instance = new cct_constructor(_.extend(cct_constructor_options, {
                                id: cct_id,
                                instanceId: cct_instance_id
                            })), cct_container_instance = new CustomContentTypeContainerView({
                                innerCustomContentType: cct_instance,
                                instanceId: cct_instance_id,
                                classes: render_settings.classes
                            });
                        var context_data = parent_view_instance.getContextData(cct_instance.getContextDataRequest());
                        if (cct_instance.validateContextDataRequest(context_data)) {
                            self._customContentTypesInstances[cct_instance_id].push(//@class CMSadapter.Component.CustomerContentTypeInstance.Container
                            {
                                //@property {CustomContentType.Base.View} cct Instance of the inner CCT
                                cct: cct_instance    //@property {Backbone.View} parent SCA View that will contain the new CCT
                                                //,	parent: parent_view_instance
                                                //@property {CustomContentType.Container.View} cct_container_instance Instance of the View that contains/wrap the CCT instance
,
                                container: cct_container_instance    //@property {String} selector Where the new CCT will be injected
,
                                selector: container.selector,
                                render_settings: render_settings
                            });
                            // @class CMSadapterComponent
                            async_operations.push(self._installContent(cct_instance, cct_settings, context_data));
                            var generator = {}, container_name = container.selector['data-cms-area'];
                            generator[container_name] = {};
                            generator[container_name][cct_instance_id] = {
                                childViewIndex: 1000 + parseInt(render_settings.position, 10),
                                childViewConstructor: null,
                                childViewInstance: cct_container_instance,
                                childViewSelector: container.selector,
                                childViewIsExternal: true
                            };
                            cct_container_instance.parentView = parent_view_instance;
                            cct_container_instance.hasParent = true;
                            parent_view_instance.addChildViewInstances(generator, true);
                            self._addViewCctsToRerender(parent_view_instance, generator);
                        } else {
                            async_operations.push(jQuery.Deferred().reject(self._createError('ERR_CONTEXTNOTFOUND_CCT', _('Context for CCT not found. CCT Instance Id: $(0)').translate(cct_instance_id))));
                        }
                    });
                    return jQuery.when.apply(jQuery, async_operations);
                }
            }    //@method updateContent Updates a CCT settings and its render settings
                 //@public
                 //@param {String} cct_id Id of the CCT constructor. This value must have been registered previously
                 //@param {String} cct_instance_id. Unique identifier of the new CCT
                 //@param {Selector} cct_selector Where the cct should be inserted
                 //@param {Object} cct_settings Any setting that will be sent to the new cct instance
                 //@param {CMSadapter.Component.addContent.RenderSettings} render_settings Setting on how the rendering should be done
                 //@return {jQuery.Deferred}
,
            updateContent: function updateContent(cct_instance_id, cct_selector, cct_settings, render_settings) {
                var self = this, cct_views_container = self._customContentTypesInstances[cct_instance_id], selector = self.getPlaceholder(cct_selector), async_operations = [];
                if (cct_views_container) {
                    var first_cct_container = cct_views_container[0];
                    if (!_.isEqual(first_cct_container.selector, cct_selector)) {
                        if (!selector) {
                            return jQuery.Deferred().reject(self._createError('ERR_INVALID_SELECTOR', _('Invalid selector. The current view does not contains the specified selector: $(0)').translate(self.selectorToString(cct_selector))));
                        } else {
                            var cct_id = first_cct_container.cct.id;
                            self.removeContent(cct_instance_id, true);
                            return self.addContent(cct_id, cct_instance_id, cct_selector, cct_settings, render_settings);
                        }
                    } else {
                        _.each(cct_views_container, function (cct_container) {
                            var cct_container_instance = cct_container.container, parent_view_instance = cct_container_instance.parentView;
                            async_operations.push(self._updateSettings(cct_container.cct, cct_settings));
                            if (!_.isEqual(first_cct_container.render_settings, render_settings)) {
                                var generator = {}, container_name = cct_container.selector['data-cms-area'];
                                generator[container_name] = {};
                                generator[container_name][cct_instance_id] = {
                                    childViewIndex: 1000 + parseInt(render_settings.position, 10),
                                    childViewConstructor: null,
                                    childViewInstance: cct_container_instance,
                                    childViewSelector: cct_container.selector,
                                    childViewIsExternal: true
                                };
                                parent_view_instance.updateChildViewInstances(generator, true);
                                cct_container.render_settings = render_settings;
                            } else {
                                cct_container.cct.render();
                            }
                        });
                        return jQuery.when.apply(jQuery, async_operations);
                    }
                }
                return jQuery.Deferred().reject(self._createError('ERR_INVALID_INSTANCE_ID', _('Invalid content type instance id: $(0)').translate(cct_instance_id)));
            }    //@method _sortCCTs Internal method to sort a list of cct to be rendered
                 //@param {Array<CustomContentType.Base.View>} ccts List of ccts to be sorted
                 //@private
                 //@return {Array<CustomContentType.Base.View>}
,
            _sortCCTs: function _sortCCTs(ccts) {
                var self = this;
                // sort first by placeholder and then by position
                ccts.sort(function (cct_a, cct_b) {
                    var cct_a_selector = self.getPlaceholder(cct_a.selector), cct_b_selector = self.getPlaceholder(cct_b.selector);
                    var cct_a_key = cct_a_selector ? self.selectorToString(cct_a_selector) : '', cct_b_key = cct_b_selector ? self.selectorToString(cct_b_selector) : '';
                    if (cct_a_key === cct_b_key) {
                        return parseInt(cct_a.render_settings.position, 10) - parseInt(cct_b.render_settings.position, 10);
                    } else {
                        return cct_a_key < cct_b_key ? 1 : 0;
                    }
                });
                return ccts;
            }    //@method removeContent Removes a CCT from its location
                 //@public
                 //@param {String} cct_instance_id Unique CCT identifier
                 //@param {Boolean} skip_destroy_call Indicate if should destroy the instance or not
                 //@return {jQuery.Deferred}
,
            removeContent: function removeContent(cct_instance_id, destroy_call) {
                var cct_views_generator = this._customContentTypesInstances[cct_instance_id], async_operations = [];
                if (cct_views_generator) {
                    _.each(cct_views_generator, function (cct_generator) {
                        async_operations.push(cct_generator.container.parentView.removeChildViewInstance(cct_generator.selector['data-cms-area'], cct_generator.cct.instanceId, destroy_call));
                    });
                    if (destroy_call) {
                        delete this._customContentTypesInstances[cct_instance_id];
                    }
                    return jQuery.when.apply(jQuery, async_operations);
                }
                return jQuery.Deferred().reject(this._createError('ERR_INVALID_INSTANCE_ID', _('The specified instance id is not registered. Instance Id: $(0)').translate(cct_instance_id)));
            },
            getContentIds: function getContentIds() {
                return _.keys(this._customContentTypes);
            }    // @method selectorToString returns the string key for a json selector
                 // @param {Selector} placeholder
                 // @return {String} the string key for a json selector
,
            selectorToString: function selectorToString(placeholder) {
                var str = '';
                _.each(placeholder, function (value, key) {
                    str += '[' + key + '="' + value + '"]';
                });
                return str;
            }    // @method getPlaceholder Determines if a selector already exist by comparing its JSON representation
                 // @param {Selector} placeholder
                 // @return {Selector} if it exist the same combination of selectors as a placeholder or undefined
,
            getPlaceholder: function getPlaceholder(placeholder) {
                var selector_data = _.find(placeholder_views, function (obj) {
                    return _.isEqual(placeholder, obj.selector);
                });
                if (selector_data) {
                    return selector_data.selector;
                } else {
                    return selector_data;
                }
            }    // @method registerViewForPlaceholder Receives all the placeholders that appear on a view and registers each one of them
                 // @param {Array<Selector>} placeholders
                 // @param {Backbone.View} view a backbone view
                 // @return {Void}
,
            registerViewForPlaceholder: function registerViewForPlaceholder(placeholders, view) {
                var self = this;
                _.each(placeholders, function (selector) {
                    var existent_selector = self.getPlaceholder(selector);
                    if (existent_selector) {
                        var key_existent = self.selectorToString(existent_selector);
                        if (_.indexOf(placeholder_views[key_existent].views, view) < 0) {
                            placeholder_views[key_existent].views.push(view);
                        }
                    } else {
                        var key = self.selectorToString(selector);
                        placeholder_views[key] = {
                            selector: selector,
                            views: [view]
                        };
                    }
                });
            }    // @method unregisterViewForPlaceholder removes a view from all the placeholders associations
                 // @param {Backbone.View} a view
                 // @return {Void}
,
            unregisterViewForPlaceholders: function unregisterViewForPlaceholders(view) {
                _.each(placeholder_views, function (placeholder, key, selector_views_context) {
                    selector_views_context[key].views = _.without(placeholder.views, view);
                });
            }    // @method getPlaceholderViews Retrieves all the views where a placeholder appears
                 // @param {string} The placeholder key
                 // @return {PlaceholderViews} An object with the Selector obj and the array of views
,
            getPlaceholderViews: function getPlaceholderViews(placeholder) {
                return placeholder_views[placeholder] || null;
            }    // @method getViewCctsToRerender Retrieves all the CCTs associated with a given view.
                 // @param {Object} The view containing the CCTs.
                 // @return {Array<Object>} An array containing CCTs related information and CCT-view instances to be re-rendered.
,
            getViewCctsToRerender: function getViewCctsToRerender(view) {
                if (view.template && view.template.Name) {
                    var cct_generators = view_ccts_to_rerender[view.template.Name];
                    return _.isUndefined(cct_generators) ? [] : cct_generators;
                }
                return [];
            }
        });
    };
});    //@class Selector an obj with the form { data-cms-attr1: "placeholder1", data-cms-attr2: "placeholder2" }
       //@class PlaceholderViews an obj with the form { "selector_key": selector: {Selector}, views: Array<Backbone.View>}
       //@class CMSadapter.Component.CustomContentTypeStore
       //A dictionary by custom content type id of all CCTs register for the running application
       //@extend Dictionary<String, CustomContentType.Base.View>
       //@class CMSadapter.Component.CustomerContentTypeInstance.Store
       //A dictionary to store the generated CCT instances
       //@extend Dictionary<String, CMSadapter.Component.CustomerContentTypeInstance.Container>
       //@class CMSadapter.Component.addContent.RenderSettings
       //@property {Number} position Indicate where the CCT should be inserted

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/* global CMS: false */
// @module CMSadapter
define('CMSadapter', [
    'Backbone',
    'CMSadapter.Page.Router',
    'CMSadapter.Page.Collection',
    'CMSadapter.Impl.Enhanced',
    'CMSadapter.Component',
    'SC.Configuration',
    'jQuery'
], function (Backbone, CMSadapterPagePageRouter, CMSadapterPagePageCollection, CMSadapterImplEnhanced, CMSadapterComponent, Configuration, jQuery) {
    'use strict';
    // @class CMSadapter responsible of starting both the adapter implementation and cms landing pages router.
    // Assumes cms.js is already loaded
    // @extend ApplicationModule
    return {
        mountAdapter: function (application) {
            if (Configuration.get('cms.useCMS')) {
                Backbone.Events.trigger('cmsadapter:ready');
                application.registerComponent(CMSadapterComponent(application));
                var router = this.initPageRouter(application), self = this;
                // instantiate and expose it:
                if (typeof CMS === 'undefined' || !CMS.on) {
                    Backbone.Events.on('cms:load', function () {
                        self.initAdapter(application, router);
                    });
                } else {
                    this.initAdapter(application, router);
                }
                this.adapterEnhanced = new CMSadapterImplEnhanced(application, router);
                this.installBackboneViewPlugins(application);
            }
            return this.postMountAdapter(application);
        }    // @method initAdapter
             // Heads up! CMS global variable should be already available since we start the
             // shopping application after cms.js is loaded, see SC.Shopping.Starter.js
,
        initAdapter: function initAdapter(application, landingRouter) {
            if (typeof CMS === 'undefined') {
                return;
            }
            this.initAdapterImpls(application, CMS, landingRouter);
        }    // @method initPageRouter instantiate the landing pages router using bootstrapped data.
,
        initPageRouter: function initPageRouter(application) {
            if (!SC.ENVIRONMENT.CMS || !SC.ENVIRONMENT.CMS.pages) {
                return;
            }
            var collection = new CMSadapterPagePageCollection(SC.ENVIRONMENT.CMS.pages.pages || []);
            return new CMSadapterPagePageRouter(application, collection);
        },
        installBackboneViewPlugins: jQuery.noop,
        initAdapterImpls: jQuery.noop,
        postMountAdapter: jQuery.noop
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module CMSadapter
@class CMSadapter.Impl.Core the class that has the core integration using the CMS API.
*/
define('CMSadapter.Impl.Core', [
    'underscore',
    'Backbone',
    'jQuery'
], function (_, Backbone, jQuery) {
    'use strict';
    var AdapterCore = function (application, CMS) {
        this.CMS = CMS;
        this.application = application;
        this.listenForCMS();
        this.init();
    };
    AdapterCore.prototype.init = jQuery.noop;
    AdapterCore.prototype.listenForCMS = jQuery.noop;
    AdapterCore.prototype.getSetupOptions = jQuery.noop;
    AdapterCore.prototype.getCmsContext = function getCmsContext() {
        var url = Backbone.history.fragment.split('?')[0], path = url[0] === '/' ? url : '/' + url;
        var context = {
            path: path,
            site_id: this.application.getConfig('siteSettings.siteid'),
            page_type: this.application.getLayout().currentView ? this.application.getLayout().currentView.el.id : ''
        };
        return context;
    };
    return AdapterCore;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/* global CMS: false */
/*

@module CMSadapter
@class CMSadapter.Impl.Core.v2 the class that has the core integration using the CMS API v2.
*/
define('CMSadapter.Impl.Core.v2', [
    'CMSadapter.Impl.Core',
    'SC.Configuration'
], function (CMSadapterImplCore, Configuration) {
    'use strict';
    var CMSadapterImplCore2 = function (application, CMS) {
        CMSadapterImplCore.call(this, application, CMS);
    };
    CMSadapterImplCore2.prototype = Object.create(CMSadapterImplCore.prototype);
    CMSadapterImplCore2.prototype.init = function init() {
        var self = this;
        this.application.getLayout().on('afterAppendView', function () {
            self.CMS.trigger('adapter:page:changed');
        });
        this.CMS.trigger('adapter:ready');
    };
    CMSadapterImplCore2.prototype.listenForCMS = function listenForCMS() {
        // CMS listeners - CMS tells us to do something, could fire anytime.
        var self = this;
        self.CMS.on('adapter:get:setup', function () {
            var setup = self.getSetupOptions();
            // Config values the adapter can give the cms on startup. Currently nothing is used (cms ignores values).
            CMS.trigger('adapter:got:setup', setup);
        });
        self.CMS.on('adapter:get:context', function () {
            var context = self.getCmsContext();
            self.CMS.trigger('adapter:got:context', context);
        });
    };
    CMSadapterImplCore2.prototype.getSetupOptions = function getSetupOptions() {
        return {
            esc_to_login_disabled: Configuration.get('cms.escToLoginDisabled', false),
            features: [
                'landingPages',
                'categories'
            ]
        };
    };
    return CMSadapterImplCore2;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*

@module CMSadapter

@class CMSadapter.Impl.Landing
*/
define('CMSadapter.Impl.Landing', [
    'underscore',
    'Backbone',
    'jQuery'
], function (_, Backbone, jQuery) {
    'use strict';
    function AdapterLanding(application, CMS, pageRouter) {
        this.CMS = CMS;
        this.application = application;
        this.pageRouter = pageRouter;
        if (pageRouter) {
            this.listenForCMS();
        }
    }
    AdapterLanding.prototype.listenForCMS = jQuery.noop;
    // landing pages handlers
    // @method realoadLandingPages called when user clicks on 'manage pages mode' in admin.
    // Remember that might be unpublished landing pages and so in the admin navigation to these ones must work even if they aren't real landing pages.
    AdapterLanding.prototype.realoadLandingPages = function (data) {
        var self = this;
        _.each(data.pages, function (page) {
            if (page.type === 1) {
                self.pageRouter.addLandingRoute(page);
            }
        });
    };
    // @method addLandingPages NOTE: Add a new page(s) to your collection, also passes a bool value (trigger) that should be used to auto-navigate to the new page.
    AdapterLanding.prototype.addLandingPages = function (data) {
        this.pageRouter.addLandingRoute(data.page);
        if (data.trigger) {
            Backbone.history.navigate(data.page.url, { trigger: true });
        } else {
            this.CMS.trigger('adapter:page:changed');
        }
    };
    //@method navigateLandingPage handler called when the user navigates inside the admin. NOTE: Provides url so that the page can be reloaded or navigated to (Backbone History, etc).
    AdapterLanding.prototype.navigateLandingPage = function (data) {
        Backbone.history.navigate(data.url, { trigger: true });
    };
    AdapterLanding.prototype.updateLandingPage = function (data)
        // Update an existing page with title, header, meta, etc.
        {
            if (data.saving) {
                if (data.page.type === 1) {
                    //update the router internally with possible new urls (virtual - they are not published but for the admin navigation to work correctly)
                    this.pageRouter.addLandingRoute(data.page, data.original_url);
                }
                if (data.trigger) {
                    // Heads up!
                    // Edit Live Site > Landing Pages > "Page not found" error for new published landing page
                    // navigate wont refresh the page if you are in the same url but it will change the url of the browser
                    // loadUrl will navigate to the url but won't change the url of the browser, that's why we use both
                    Backbone.history.navigate(data.page.url, { trigger: false });
                    Backbone.history.loadUrl(data.page.url);
                } else {
                    this.CMS.trigger('adapter:page:changed');
                }
            }
        };
    return AdapterLanding;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*

@module CMSadapter

@class CMSadapter.Impl.Landing.v2
*/
define('CMSadapter.Impl.Landing.v2', ['CMSadapter.Impl.Landing'], function (CMSadapterImplLanding) {
    'use strict';
    var CMSadapterImplLanding2 = function (application, CMS, pageRouter) {
        CMSadapterImplLanding.call(this, application, CMS, pageRouter);
    };
    CMSadapterImplLanding2.prototype = Object.create(CMSadapterImplLanding.prototype);
    CMSadapterImplLanding2.prototype.listenForCMS = function listenForCMS() {
        // CMS listeners - CMS tells us to do something, could fire anytime.
        var self = this;
        self.CMS.on('adapter:landing:pages:reload', function (data, callback) {
            callback(self.realoadLandingPages(data));
        });
        self.CMS.on('adapter:landing:pages:add', function (data, callback) {
            callback(self.addLandingPages(data));
        });
        self.CMS.on('adapter:landing:page:navigate', function (data, callback) {
            // triggered when user selects a landing page in the 'manage pages mode' in cms administrator
            callback(self.navigateLandingPage(data));
        });
        self.CMS.on('adapter:landing:page:update', function (data, callback) {
            // triggered when user clicks the 'edit' button of a landing page in the 'manage pages mode' in cms administrator
            callback(self.updateLandingPage(data));
        });
    };
    return CMSadapterImplLanding2;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Facets
define('Facets.Model', [
    'Backbone.CachedModel',
    'Item.Collection',
    'Session',
    'Profile.Model',
    'SC.Configuration',
    'underscore',
    'Utils'
], function (BackboneCachedModel, ItemCollection, Session, ProfileModel, Configuration, _) {
    'use strict';
    var original_fetch = BackboneCachedModel.prototype.fetch;
    // @class Facets.Model @extends Backbone.CachedModel
    // Connects to the search api to get all the items and the facets
    // A Model Contains a Collection of items and the list of facet groups with its values
    return BackboneCachedModel.extend({
        options: {},
        searchApiMasterOptions: Configuration.get('searchApiMasterOptions.Facets', {}),
        url: function () {
            var profile = ProfileModel.getInstance(), url = _.addParamsToUrl(profile.getSearchApiUrl(), _.extend(Configuration.get('matrixchilditems.enabled') && Configuration.get('matrixchilditems.fieldset') ? { matrixchilditems_fieldset: Configuration.get('matrixchilditems.fieldset') } : {}, this.searchApiMasterOptions, Session.getSearchApiParams()), profile.isAvoidingDoubleRedirect());
            return url;
        },
        initialize: function (options) {
            if (options && options.searchApiMasterOptions) {
                this.searchApiMasterOptions = options.searchApiMasterOptions;
            }
            // Listen to the change event of the items and converts it to an ItemCollection
            this.on('change:items', function (model, items) {
                if (!(items instanceof ItemCollection)) {
                    // NOTE: Compact is used to filter null values from response
                    model.set('items', new ItemCollection(_.compact(items)));
                }
            });
        }    // @method fetch overrides fetch so we make sure that the cache is set to true, so we wrap it
,
        fetch: function (options) {
            options = _.extend(options || {}, this.options);
            options.cache = true;
            return original_fetch.apply(this, arguments);
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Categories
define('Categories.Model', [
    'Backbone.CachedModel',
    'underscore',
    'Utils'
], function (BackboneCachedModel, _, Utils) {
    'use strict';
    var original_fetch = BackboneCachedModel.prototype.fetch;
    // @class Categories.Model @extends Backbone.CachedModel
    // Connects to the search api to get all the items and the facets
    // A Model Contains a Collection of items and the list of facet groups with its values
    return BackboneCachedModel.extend({
        url: Utils.getAbsoluteUrl('services/Categories.Service.ss'),
        options: {},
        initialize: function () {
        }    // @method fetch overrides fetch so we make sure that the cache is set to true, so we wrap it
,
        fetch: function (options) {
            options = _.extend(options || {}, this.options);
            options.cache = true;
            return original_fetch.apply(this, arguments);
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Facets
define('Facets.Router', [
    'Facets.Browse.View',
    'Facets.Helper',
    'Facets.Model',
    'Categories',
    'Categories.Model',
    'AjaxRequestsKiller',
    'Profile.Model',
    'underscore',
    'Backbone',
    'jQuery',
    'SC.Configuration'
], function (BrowseView, Helper, Model, Categories, CategoriesModel, AjaxRequestsKiller, ProfileModel, _, Backbone, jQuery, Configuration) {
    'use strict';
    // @class Facets.Router Mixes the Translator, Model and View @extends Backbone.Router
    return Backbone.Router.extend({
        initialize: function (application) {
            this.application = application;
            this.translatorConfig = application.translatorConfig;
        },
        addUrl: function (urls, functionToCall) {
            if (urls.length) {
                urls = _.map(urls, function (url) {
                    return url.replace(/^\//, '');
                });
                var rootRegex = '^\\b(' + urls.join('|') + ')\\b$', regex = '^\\b(' + urls.join('|') + ')\\b[\\' + Configuration.get('facetDelimiters.betweenFacetNameAndValue') + '\\?].*$';
                this.route(new RegExp(rootRegex), functionToCall);
                this.route(new RegExp(regex), functionToCall);
            }
        }    //@method getFacetsAliasesMapping @param {Array<Object>} corrections
,
        getFacetsAliasesMapping: function (corrections) {
            var facets_aliases_mapping = {};
            _.each(corrections, function (correction) {
                facets_aliases_mapping[correction.usedAlias] = {
                    url: correction.url,
                    type: correction.type ? correction.type : ''
                };
            });
            return facets_aliases_mapping;
        },
        unaliasUrlHelper: function (facet_tokens, facets_aliases_mapping, separator_between_facets, separator_between_facet_name_and_value) {
            var translated_facets = '';
            while (facet_tokens.length > 0) {
                var facet_name = facet_tokens.shift(), facet_value = facet_tokens.shift();
                if (_.isUndefined(facet_name) || _.isUndefined(facet_value)) {
                    continue;
                }
                var facet_name_correction = facets_aliases_mapping[facet_name], facet_value_correction = facets_aliases_mapping[facet_value]    // Just double check if unalias is correct... not undefined and unalias type matches with the url component being analyzed!
, facet_name_correction_url = facet_name_correction && facet_name_correction.type.toUpperCase() === 'FACET' ? facet_name_correction.url : null, facet_value_correction_url = facet_value_correction && facet_value_correction.type.toUpperCase() === 'FACET_VALUE' ? facet_value_correction.url : null;
                if (facet_name_correction_url && facet_value_correction_url) {
                    translated_facets += facet_name_correction_url + separator_between_facet_name_and_value + facet_value_correction_url;
                } else if (facet_name_correction_url && !facet_value_correction_url) {
                    translated_facets += facet_name_correction_url + separator_between_facet_name_and_value + facet_value;
                } else if (!facet_name_correction_url && facet_value_correction_url) {
                    translated_facets += facet_name + separator_between_facet_name_and_value + facet_value_correction_url;
                } else {
                    translated_facets += facet_name + separator_between_facet_name_and_value + facet_value;
                }
                if (facet_tokens.length > 0) {
                    translated_facets += separator_between_facets;
                }
            }
            return translated_facets;
        }    //@method unaliasUrl @param {String} aliased_url @param {Array<Object>} corrections
,
        unaliasUrl: function (aliased_url, corrections) {
            if (aliased_url.indexOf('http://') === 0 || aliased_url.indexOf('https://') === 0) {
                throw new Error('URL must be relative');
            }
            aliased_url = aliased_url[0] === '/' ? aliased_url.substr(1) : aliased_url;
            var facet_delimiters = this.translatorConfig.facetDelimiters, facets_n_options = aliased_url.split(facet_delimiters.betweenFacetsAndOptions), facets = facets_n_options[0] && facets_n_options[0] !== this.translatorConfig.fallbackUrl ? facets_n_options[0] : '', options = facets_n_options[1] || '', facet_tokens = facets.split(new RegExp('[\\' + facet_delimiters.betweenDifferentFacets + '\\' + facet_delimiters.betweenFacetNameAndValue + ']+', 'ig')), facets_aliases_mapping = this.getFacetsAliasesMapping(corrections), unaliased_url = this.unaliasUrlHelper(facet_tokens, facets_aliases_mapping, facet_delimiters.betweenDifferentFacets, facet_delimiters.betweenFacetNameAndValue);
            if (options) {
                var option_tokens = [];
                options.replace(new RegExp('([^' + facet_delimiters.betweenFacetsAndOptions + facet_delimiters.betweenOptionNameAndValue + facet_delimiters.betweenDifferentOptions + ']+)(' + facet_delimiters.betweenOptionNameAndValue + '([^' + facet_delimiters.betweenDifferentOptions + ']*))?', 'ig'), function ($0, $1, $2, $3) {
                    option_tokens.push($1);
                    option_tokens.push($3);
                });
                var unaliased_options = this.unaliasUrlHelper(option_tokens, facets_aliases_mapping, facet_delimiters.betweenDifferentOptions, facet_delimiters.betweenOptionNameAndValue);
                unaliased_url = unaliased_url !== '' ? unaliased_url : this.translatorConfig.fallbackUrl;
                unaliased_url += facet_delimiters.betweenFacetsAndOptions + unaliased_options;
            }
            return unaliased_url;
        },
        showPage: function (isCategoryPage) {
            var self = this, facetModel = new Model(), fullurl = Backbone.history.fragment, models = [facetModel], translator = Helper.parseUrl(fullurl, this.translatorConfig, isCategoryPage);
            facetModel.options = {
                data: translator.getApiParams(),
                killerId: AjaxRequestsKiller.getKillerId(),
                pageGeneratorPreload: true
            };
            //if prices aren't to be shown we take out price related facet
            //and clean up the url
            if (ProfileModel.getInstance().hidePrices()) {
                translator = translator.cloneWithoutFacetId('onlinecustomerprice');
                Backbone.history.navigate(translator.getUrl());
            }
            if (isCategoryPage) {
                var categoryModel = new CategoriesModel();
                categoryModel.options = {
                    data: { 'fullurl': translator.getCategoryUrl() },
                    killerId: AjaxRequestsKiller.getKillerId()
                };
                facetModel.set('category', categoryModel);
                models.push(categoryModel);
            }
            jQuery.when.apply(null, _.invoke(models, 'fetch', {})).then(function (facetResponse) {
                facetResponse = isCategoryPage ? facetResponse[0] : facetResponse;
                if (facetResponse.corrections && facetResponse.corrections.length > 0) {
                    var unaliased_url = self.unaliasUrl(fullurl, facetResponse.corrections);
                    if (SC.ENVIRONMENT.jsEnvironment === 'server') {
                        nsglobal.statusCode = 301;
                        nsglobal.location = '/' + unaliased_url;
                    } else {
                        Backbone.history.navigate('#' + unaliased_url, { trigger: true });
                    }
                } else {
                    var view = new BrowseView({
                        translator: translator,
                        translatorConfig: self.translatorConfig,
                        application: self.application,
                        model: facetModel
                    });
                    translator.setLabelsFromFacets(facetModel.get('facets') || []);
                    view.showContent();
                }
            });
        }    // @method categoryLoading This handles all the routes of the category list
,
        categoryLoading: function () {
            this.showPage(true);
        }    // @method facetLoading This handles all the routes of the item list
,
        facetLoading: function () {
            this.showPage();
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module Categories
define('Categories.Collection', [
    'Backbone',
    'underscore',
    'Utils',
    'SC.Configuration'
], function (Backbone, _, Utils, Configuration) {
    'use strict';
    // @class Categories.Collection @extends Backbone.Collection
    return Backbone.Collection.extend({
        url: function () {
            var url = _.addParamsToUrl(Utils.getAbsoluteUrl('services/Categories.Service.ss'), { 'menuLevel': Configuration.get('categories.menuLevel') });
            return url;
        },
        initialize: function () {
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*

@module CMSadapter

@class CMSadapter.Impl.Categories the class that do the actual integration job using the CMS API. Usage:

	var adapter = new CMSadapterImpl(application, CMS);
	adapter.init();

This will start the cms adapter, for example listening to the ESC key to be pressed to load the CMS
administrator and collaborating with with it to accomplish use cases (mostly landing pages).

In addition the PageRouter must be initialized to implement the full pages experience.

*/
define('CMSadapter.Impl.Categories', [
    'Facets.Model',
    'Facets.Helper',
    'Facets.Browse.View',
    'Facets.Router',
    'Categories',
    'Categories.Model',
    'Categories.Collection',
    'SC.Configuration',
    'AjaxRequestsKiller',
    'jQuery',
    'underscore',
    'Backbone'
], function (FacetsModel, FacetsHelper, FacetsBrowseView, FacetsRouter, Categories, CategoriesModel, CategoriesCollection, Configuration, AjaxRequestsKiller, jQuery, _, Backbone) {
    'use strict';
    function AdapterCategories(application, CMS) {
        this.CMS = CMS;
        this.application = application;
        this.listenForCMS();
    }
    AdapterCategories.prototype.listenForCMS = jQuery.noop;
    AdapterCategories.prototype._convertToCategory = function _convertToCategory(categoryData) {
        //TODO: manage overrides
        return {
            'name': categoryData.name,
            'description': categoryData.description,
            'pagetitle': categoryData.page_title,
            'pageheading': categoryData.page_header,
            'pagebanner': '',
            'addtohead': categoryData.add_to_head,
            'metakeywords': categoryData.meta_keywords,
            'metadescription': categoryData.meta_description,
            'categories': [],
            'breadcrumb': [{
                    'name': categoryData.name,
                    'fullurl': ''
                }]
        };    /*
		//TODO: manage add sub category

		var category = this.category ? this.category : { 'breadcrumb': [{ 'name': '', 'fullurl': '' }] };

		category.name = categoryData.overrides && categoryData.overrides.name ? categoryData.overrides.name : categoryData.name;
		category.description = categoryData.overrides && categoryData.overrides.description ? categoryData.overrides.description : categoryData.description;
		category.pagetitle = categoryData.overrides && categoryData.overrides.page_title ? categoryData.overrides.page_title : categoryData.page_title;
		category.pageheading = categoryData.overrides && categoryData.overrides.page_header ? categoryData.overrides.page_header : categoryData.page_header;
		category.addtohead = categoryData.overrides && categoryData.overrides.add_to_head ? categoryData.overrides.add_to_head : categoryData.add_to_head;
		category.metakeywords = categoryData.overrides && categoryData.overrides.meta_keywords ? categoryData.overrides.meta_keywords : categoryData.meta_keywords;
		category.metadescription = categoryData.overrides && categoryData.overrides.meta_description ? categoryData.overrides.meta_description : categoryData.meta_description;

		category.breadcrumb[category.breadcrumb.length - 1].name = category.name;

		return category;

		*/
    };
    AdapterCategories.prototype.showCategory = function (categoryData, functionToCallback) {
        var self = this;
        var translatorConfig = this.application.translatorConfig;
        var fullurl = categoryData.urls && categoryData.urls.length && categoryData.urls[0] === 'temp_cms_new_category_url' ? '' : Backbone.history.fragment;
        var translator = FacetsHelper.parseUrl(fullurl, translatorConfig, true);
        var categoryModel = new CategoriesModel(this._convertToCategory(categoryData));
        var facetsModel = new FacetsModel({
            'items': [],
            'facets': [],
            'total': 0
        });
        facetsModel.set('category', categoryModel);
        facetsModel.fetch({
            data: translator.getApiParams(),
            killerId: AjaxRequestsKiller.getKillerId()
        }).done(function () {
            var view = new FacetsBrowseView({
                translator: translator,
                translatorConfig: translatorConfig,
                application: self.application,
                model: facetsModel
            });
            translator.setLabelsFromFacets(facetsModel.get('facets') || []);
            view.showContent();
            functionToCallback();
        });
    };
    AdapterCategories.prototype.updateCategory = function (data, application, functionToCallback) {
        if (data.saving) {
            var collection = new CategoriesCollection();
            collection.fetch().done(function (menu) {
                Categories.addToNavigationTabs(menu);
                // IF is a root category AND (it was just created OR the fragment url have changed) THEN we add the url to the router
                if (!data.category.parents.length && (!data.category.last_modified || data.original_url !== data.category.urls[0])) {
                    var router = new FacetsRouter(application);
                    router.addUrl(data.category.urls, 'categoryLoading');
                }
                functionToCallback();
            });
        } else {
            // To show the changes before saving it, we need to show the category data that sends the CMS admin
            this.showCategory(data.category, functionToCallback);
        }
    };
    AdapterCategories.prototype.removeCategory = function (functionToCallback) {
        var collection = new CategoriesCollection();
        collection.fetch().done(function (menu) {
            Categories.addToNavigationTabs(menu);
            Backbone.history.navigate('/', { trigger: true });
            functionToCallback();
        });
    };
    AdapterCategories.prototype.navigate = function (data, functionToCallback) {
        var categoryModel = new CategoriesModel();
        categoryModel.options = {
            data: { 'fullurl': data.url[0] !== '/' ? '/' + data.url : data.url },
            killerId: AjaxRequestsKiller.getKillerId()
        };
        var self = this;
        categoryModel.fetch({}).done(function (cat) {
            self.category = cat;
            Backbone.history.navigate(data.url, { trigger: false });
            Backbone.history.loadUrl(data.url);
            functionToCallback();
        });
    };
    AdapterCategories.prototype.getItems = function (filters, functionToCallback) {
        var model = new FacetsModel({ searchApiMasterOptions: Configuration.get('searchApiMasterOptions.CmsAdapterSearch') });
        model.fetch({
            data: _.extend(filters, {}),
            killerId: AjaxRequestsKiller.getKillerId()
        }).done(function () {
            var items = [];
            model.get('items').each(function (item) {
                items.push({
                    name: item.get('_name'),
                    internal_id: item.get('internalid'),
                    unique_identifier: '' + item.get('internalid'),
                    price: item.get('_price_formatted'),
                    image_url: item.get('_thumbnail').url
                });
            });
            functionToCallback(items);
        });
    };
    return AdapterCategories;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module CMSadapter

@class CMSadapter.Impl.Categories.v2
*/
define('CMSadapter.Impl.Categories.v2', ['CMSadapter.Impl.Categories'], function (CMSadapterImplCategories) {
    'use strict';
    var CMSadapterImplCategories2 = function (application, CMS) {
        CMSadapterImplCategories.call(this, application, CMS);
    };
    CMSadapterImplCategories2.prototype = Object.create(CMSadapterImplCategories.prototype);
    CMSadapterImplCategories2.prototype.listenForCMS = function listenForCMS() {
        // CMS listeners - CMS tells us to do something, could fire anytime.
        var self = this;
        // Categories
        self.CMS.on('adapter:category:add', function (data, callback) {
            self.showCategory(data.category, callback);
        });
        self.CMS.on('adapter:category:item:update', function (data, callback) {
            callback();
        });
        self.CMS.on('adapter:category:update', function (data, callback) {
            self.updateCategory(data, self.application, callback);
        });
        self.CMS.on('adapter:category:hierarchy:change', function (data, callback) {
            callback();
        });
        self.CMS.on('adapter:category:remove', function (data, callback) {
            self.removeCategory(callback);
        });
        self.CMS.on('adapter:category:reload', function (data, callback) {
            callback();
        });
        self.CMS.on('adapter:category:navigate', function (data, callback) {
            self.navigate(data, callback);
        });
        self.CMS.on('adapter:get:items', function (filters) {
            self.getItems(filters, function (items) {
                self.CMS.trigger('adapter:got:items', items);
            });
        });
    };
    return CMSadapterImplCategories2;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*

@module CMSadapter

@class CMSadapter.Impl.Merchandising
*/
define('CMSadapter.Impl.Merchandising', [
    'underscore',
    'Backbone',
    'jQuery'
], function (_, Backbone, jQuery) {
    'use strict';
    function AdapterMerchandising(application, CMS) {
        this.CMS = CMS;
        this.application = application;
        this.listenForCMS();
    }
    AdapterMerchandising.prototype.listenForCMS = jQuery.noop;
    return AdapterMerchandising;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*

@module CMSadapter

@class CMSadapter.Impl.Merchandising.v2
*/
define('CMSadapter.Impl.Merchandising.v2', [
    'CMSadapter.Impl.Merchandising',
    'underscore'
], function (CMSadapterImplMerchandising, _) {
    'use strict';
    var CMSadapterImplMerchandising2 = function (application, CMS) {
        CMSadapterImplMerchandising.call(this, application, CMS);
    };
    CMSadapterImplMerchandising2.prototype = Object.create(CMSadapterImplMerchandising.prototype);
    CMSadapterImplMerchandising2.prototype.listenForCMS = function listenForCMS() {
        // CMS listeners - CMS tells us to do something, could fire anytime.
        var self = this;
        self.CMS.on('adapter:get:cart:items', function () {
            var cart = self.application.getComponent('Cart'), linesId = [];
            if (cart) {
                cart.getLines().then(function (lines) {
                    _.each(lines, function (line) {
                        if (line.item && line.item.internalid) {
                            linesId.push(line.item.internalid);
                        }
                    });
                    self.CMS.trigger('adapter:got:cart:items', linesId);
                });
            } else {
                self.CMS.trigger('adapter:got:cart:items', linesId);
            }
        });
        self.CMS.on('adapter:get:current:item', function () {
            var pdp = self.application.getComponent('PDP'), linesId = [];
            if (pdp) {
                var product = pdp.getItemInfo();
                if (product && product.item && product.item.internalid) {
                    linesId.push(product.item.internalid);
                }
            }
            self.CMS.trigger('adapter:got:current:item', linesId);
        });
    };
    return CMSadapterImplMerchandising2;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CMSadapter
// @class CMSadapter.v2
define('CMSadapter.v2', [
    'CMSadapter',
    'CMSadapter.Impl.Core.v2',
    'CMSadapter.Impl.Landing.v2',
    'CMSadapter.Impl.Categories.v2',
    'CMSadapter.Impl.Merchandising.v2',
    'underscore'
], function (CMSadapter, CMSadapterImplCore2, CMSadapterImplLanding2, CMSadapterImplCategories2, CMSadapterImplMerchandising2, _) {
    'use strict';
    // @class CMSadapter2 responsible of starting both the adapter implementation and cms landing pages router.
    // Assumes cms.js is already loaded
    // @extend ApplicationModule
    return _.extend({}, CMSadapter, {
        initAdapterImpls: function initAdapterImpls(application, cmsObject, landingRouter) {
            this.adapterCore = new CMSadapterImplCore2(application, cmsObject);
            this.adapterLanding = new CMSadapterImplLanding2(application, cmsObject, landingRouter);
            this.adapterCategories = new CMSadapterImplCategories2(application, cmsObject);
            this.adapterMerchandising = new CMSadapterImplMerchandising2(application, cmsObject);
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module CMSadapter
@class CMSadapter.Impl.Core.v3 the class that has the core integration using the CMS API.
*/
define('CMSadapter.Impl.Core.v3', [
    'CMSadapter.Impl.Core',
    'SC.Configuration'
], function (CMSadapterImplCore, Configuration) {
    'use strict';
    var CMSadapterImplCore3 = function (application, CMS) {
        CMSadapterImplCore.call(this, application, CMS);
    };
    CMSadapterImplCore3.prototype = Object.create(CMSadapterImplCore.prototype);
    CMSadapterImplCore3.prototype.init = function init() {
        var self = this;
        this.application.getLayout().on('afterAppendView', function () {
            self.CMS.trigger('app:page:changed');
        });
        self.CMS.trigger('app:ready');
    };
    CMSadapterImplCore3.prototype.listenForCMS = function listenForCMS() {
        // CMS listeners - CMS tells us to do something, could fire anytime.
        var self = this;
        self.CMS.on('config:get', function (promise) {
            promise.resolve(self.getSetupOptions());
        });
        self.CMS.on('context:get', function (promise) {
            var context = self.getCmsContext();
            promise.resolve(context);
        });
    };
    CMSadapterImplCore3.prototype.getSetupOptions = function getSetupOptions() {
        return {
            dontSpamConfigGet: true,
            esc_to_login_disabled: Configuration.get('cms.escToLoginDisabled', false),
            features: [
                'landingPages',
                'categories',
                'customContentTypes'
            ],
            app_content_override: [
                'html',
                'image',
                'text',
                'merchzone'
            ]
        };
    };
    return CMSadapterImplCore3;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module CMSadapter

@class CMSadapter.Impl.Landing.v3
*/
define('CMSadapter.Impl.Landing.v3', ['CMSadapter.Impl.Landing'], function (CMSadapterImplLanding) {
    'use strict';
    var CMSadapterImplLanding3 = function (application, CMS, pageRouter) {
        CMSadapterImplLanding.call(this, application, CMS, pageRouter);
    };
    CMSadapterImplLanding3.prototype = Object.create(CMSadapterImplLanding.prototype);
    CMSadapterImplLanding3.prototype.listenForCMS = function listenForCMS() {
        // CMS listeners - CMS tells us to do something, could fire anytime.
        var self = this;
        self.CMS.on('landing-pages:reload', function (promise, data) {
            self.realoadLandingPages(data);
            promise.resolve();
        });
        self.CMS.on('landing-pages:add', function (promise, data) {
            self.addLandingPages(data);
            promise.resolve();
        });
        self.CMS.on('landing-pages:navigate', function (promise, data) {
            // triggered when user selects a landing page in the 'manage pages mode' in cms administrator
            self.navigateLandingPage(data);
            promise.resolve();
        });
        self.CMS.on('landing-pages:update', function (promise, data) {
            // triggered when user clicks the 'edit' button of a landing page in the 'manage pages mode' in cms administrator
            self.updateLandingPage(data);
            promise.resolve();
        });
        self.CMS.on('landing-pages:remove', function (promise) {
            promise.resolve();
        });
    };
    return CMSadapterImplLanding3;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module CMSadapter

@class CMSadapter.Impl.Categories.v3
*/
define('CMSadapter.Impl.Categories.v3', ['CMSadapter.Impl.Categories'], function (CMSadapterImplCategories) {
    'use strict';
    var CMSadapterImplCategories3 = function (application, CMS) {
        CMSadapterImplCategories.call(this, application, CMS);
    };
    CMSadapterImplCategories3.prototype = Object.create(CMSadapterImplCategories.prototype);
    CMSadapterImplCategories3.prototype.listenForCMS = function listenForCMS() {
        // CMS listeners - CMS tells us to do something, could fire anytime.
        var self = this;
        // Categories
        self.CMS.on('categories:add', function (promise, data) {
            self.showCategory(data.category, promise);
        });
        self.CMS.on('categories:item:update', function (promise) {
            promise.resolve();
        });
        self.CMS.on('categories:update', function (promise, data) {
            self.updateCategory(data, self.application, function () {
                promise.resolve();
            });
        });
        self.CMS.on('categories:hierarchy:change', function (promise) {
            promise.resolve();
        });
        self.CMS.on('categories:remove', function (promise) {
            self.removeCategory(function () {
                promise.resolve();
            });
        });
        self.CMS.on('categories:reload', function (promise) {
            promise.resolve();
        });
        self.CMS.on('categories:navigate', function (promise, data) {
            self.navigate(data, function () {
                promise.resolve();
            });
        });
        self.CMS.on('items:search', function (promise, filters) {
            self.getItems(filters, function (items) {
                promise.resolve(items);
            });
        });
    };
    return CMSadapterImplCategories3;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module CMSadapter
@class CMSadapterImpl.CustomContentType the class that has the core integration using the CMS API.
*/
define('CMSadapter.Impl.CustomContentType', ['underscore'], function (_) {
    'use strict';
    function AdapterCustomContentType(application, CMS) {
        this.CMS = CMS;
        this.application = application;
        this.CMSadapterComponent = application.getComponent('CMS');
        this.listenForCMS();
    }
    _.extend(AdapterCustomContentType.prototype, {
        listenForCMS: function listenForCMS() {
            // CMS listeners - CMS tells us to do something, could fire anytime.
            var self = this;
            self.CMS.on('page:content:set', function (promise, ccts) {
                //cct_id, cct_instance_id, cct_selector, cct_settings, render_settings
                self.CMSadapterComponent.addContents(_.map(ccts, function (cct) {
                    return {
                        id: cct.type,
                        instance_id: cct.instance_id,
                        selector: { 'data-cms-area': cct.context.area },
                        settings: cct.settings,
                        render_settings: {
                            position: cct.context.sequence,
                            classes: cct.classes
                        }
                    };
                })).then(promise.resolve, promise.reject);
            });
            self.CMS.on('content:types:get', function (promise) {
                var content_types = _.map(self.CMSadapterComponent.getContentIds(), function (cct_id) {
                    return { type: cct_id };
                });
                promise.resolve(content_types);
            });
            self.CMS.on('content:add', function (promise, cct) {
                self.CMSadapterComponent.addContent(cct.type, cct.instance_id, { 'data-cms-area': cct.context.area }, cct.settings, {
                    position: cct.context.sequence,
                    classes: cct.classes
                }).then(promise.resolve, promise.reject);
            });
            self.CMS.on('content:update', function (promise, cct) {
                self.CMSadapterComponent.updateContent(cct.instance_id, { 'data-cms-area': cct.context.area }, cct.settings, {
                    position: cct.context.sequence,
                    classes: cct.classes
                }).then(promise.resolve, promise.reject);
            });
            self.CMS.on('content:remove', function (promise, cct) {
                self.CMSadapterComponent.removeContent(cct.instance_id, true).then(promise.resolve, promise.reject);
            });
        }
    });
    return AdapterCustomContentType;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('Url', ['underscore'], function (_) {
    'use strict';
    var parametersRegex = /([^;]*)(;(.*))*/, queryRegex = /([^?]*)(\?(.*))*/, netLocRegex = /^\/\/([^\/]*)(.*)/, squemaNameRegex = /^([a-zA-Z+\-.]+):(.+)/, fragmentRegex = /([^#]*)(#(.*))*/;
    function parse(url, outputObject) {
        function parseFragment() {
            var match = url.match(fragmentRegex);
            if (match) {
                outputObject.fragment = match[3];
                url = match[1];
            }
        }
        function parseSchema() {
            var match = url.match(squemaNameRegex);
            if (match) {
                outputObject.schema = match[1];
                url = match[2];
            }
        }
        function parseNetLoc() {
            var match = url.match(netLocRegex);
            if (match) {
                outputObject.netLoc = match[1];
                url = match[2];
            }
        }
        function parseQuery() {
            var match = url.match(queryRegex);
            if (match) {
                outputObject.query = match[3];
                url = match[1];
            }
        }
        function parseParameters() {
            var match = url.match(parametersRegex);
            if (match) {
                outputObject.parameters = match[3];
                url = match[1];
            }
        }
        function parsePath() {
            outputObject.path = url;
            url = '';
        }
        outputObject = outputObject || {};
        if (url) {
            //order needs to be preserved
            parseFragment();
            parseSchema();
            parseNetLoc();
            parseQuery();
            parseParameters();
            parsePath();
        }
        return outputObject;
    }
    /**
     * REFERENCES
     * https://tools.ietf.org/html/rfc1808
     * @class
     */
    function Url() {
        //@property {String} schema
        this.schema = null;
        //@property {String} netLoc
        this.netLoc = null;
        //@property {String} path
        this.path = null;
        //@property {String} parameters
        this.parameters = null;
        //@property {String} fragment
        this.fragment = null;
        //@property {String} query
        this.query = null;
    }
    Url.prototype = {
        toString: function () {
            var url = '';
            if (this.schema) {
                url += this.schema + ':';
            }
            if (this.netLoc) {
                url += '//' + this.netLoc;
            }
            if (this.path) {
                url += this.path;
            }
            if (this.parameters) {
                url += ';' + this.parameters;
            }
            if (this.query) {
                url += '?' + this.query;
            }
            if (this.fragment) {
                url += '#' + this.fragment;
            }
            return url;
        }    /**
         * Parse a string into the current Url object
         * @param {String} strUrl
         * @returns {Url} Reference to the Url object that the method bellows to
         */,
        parse: function (strUrl) {
            this.strUrl = strUrl;
            parse(strUrl, this);
            return this;
        }    /**
         * Get a copy of the current Url object
         * @returns {Url}
         */,
        clone: function () {
            var url = new Url();
            return _.extend(url, this);
        }    /**
         * @method resolve
         * Resolve the absolute URL for the current URL taking the base URL as argument
         * The algorithm is fallowing the steps described in https://tools.ietf.org/html/rfc1808 (Resolving Relative URLs)
         * @param {String} baseUrl
         * @returns {URL}
         */,
        resolve: function (baseUrl) {
            baseUrl = baseUrl instanceof Url ? baseUrl : new Url().parse(baseUrl);
            var relative = this, absoluteUrl = relative.clone();
            //step 1
            if (!baseUrl.strUrl) {
                return relative;
            }
            //step 2 - a
            if (!relative.strUrl) {
                return baseUrl;
            }
            //step 2 - b
            if (relative.schema) {
                return relative;
            }    //step 2 - c
            else {
                absoluteUrl.schema = baseUrl.schema;
            }
            //step 3
            if (!relative.netLoc) {
                absoluteUrl.netLoc = baseUrl.netLoc;
                //step 4
                if (relative.path.indexOf('/') !== 0) {
                    //step 5
                    if (!relative.path) {
                        absoluteUrl.path = baseUrl.path;
                        //step 5 - a
                        if (!relative.parameters) {
                            absoluteUrl.parameters = baseUrl.parameters;
                            if (!relative.query) {
                                absoluteUrl.query = baseUrl.query;
                            }
                        }
                    } else {
                        //step 6
                        var basePath = baseUrl.path.substr(0, baseUrl.path.lastIndexOf('/'));
                        absoluteUrl.path = basePath + '/' + relative.path;
                        //step 6 - a,b
                        absoluteUrl.path = absoluteUrl.path.replace(/(\/\.\/)|(\/\.$)/g, '/');
                        //step 6 - c
                        var tmpPath = '';
                        while (tmpPath !== absoluteUrl.path) {
                            tmpPath = absoluteUrl.path;
                            absoluteUrl.path = absoluteUrl.path.replace(/\/*[^.\/]+\/\.\.\//, '/');
                        }
                        //step 6 - d
                        absoluteUrl.path = absoluteUrl.path.replace(/\/*[^.\/]+\/\.\.$/, '/');
                    }
                }
            }
            return absoluteUrl;
        }
    };
    return Url;
});
/*! sass.js - v0.10.8 (eb28f5f) - built 2018-01-21
  providing libsass 3.4.8 (a1f13edf)
  via emscripten 1.37.0 ()
 */
(function (root, factory) {
    'use strict';
    if (typeof define === 'function' && define.amd) {
        define('sass', [], factory);
    } else if (typeof exports === 'object') {
        module.exports = factory();
    } else {
        root.Sass = factory();
    }
}(this, function () {
    /*global document*/
    // identify the path sass.js is located at in case we're loaded by a simple
    // <script src="path/to/sass.js"></script>
    // this path can be used to identify the location of
    // * sass.worker.js from sass.js
    // * libsass.js.mem from sass.sync.js
    // see https://github.com/medialize/sass.js/pull/32#issuecomment-103142214
    // see https://github.com/medialize/sass.js/issues/33
    var SASSJS_RELATIVE_PATH = function () {
        'use strict';
        // in Node things are rather simple
        if (typeof __dirname !== 'undefined') {
            return __dirname;
        }
        // we can only run this test in the browser,
        // so make sure we actually have a DOM to work with.
        if (typeof document === 'undefined' || !document.getElementsByTagName) {
            return null;
        }
        // http://www.2ality.com/2014/05/current-script.html
        var currentScript = document.currentScript || function () {
            var scripts = document.getElementsByTagName('script');
            return scripts[scripts.length - 1];
        }();
        var path = currentScript && currentScript.src;
        if (!path) {
            return null;
        }
        // [worker] make sure we're not running in some concatenated thing
        if (path.slice(-8) === '/sass.js') {
            return path.slice(0, -8);
        }
        // [sync] make sure we're not running in some concatenated thing
        if (path.slice(-13) === '/sass.sync.js') {
            return path.slice(0, -13);
        }
        return null;
    }() || '.';
    /*global Worker, SASSJS_RELATIVE_PATH*/
    'use strict';
    var noop = function () {
    };
    var slice = [].slice;
    // defined upon first Sass.initialize() call
    var globalWorkerUrl;
    function Sass(workerUrl) {
        if (!workerUrl && !globalWorkerUrl) {
            /*jshint laxbreak:true */
            throw new Error('Sass needs to be initialized with the URL of sass.worker.js - ' + 'either via Sass.setWorkerUrl(url) or by new Sass(url)');    /*jshint laxbreak:false */
        }
        if (!globalWorkerUrl) {
            globalWorkerUrl = workerUrl;
        }
        // bind all functions
        // we're doing this because we used to have a single hard-wired instance that allowed
        // [].map(Sass.removeFile) and we need to maintain that for now (at least until 1.0.0)
        for (var key in this) {
            if (typeof this[key] === 'function') {
                this[key] = this[key].bind(this);
            }
        }
        this._callbacks = {};
        this._worker = new Worker(workerUrl || globalWorkerUrl);
        this._worker.addEventListener('message', this._handleWorkerMessage, false);
    }
    // allow setting the workerUrl before the first Sass instance is initialized,
    // where registering the global workerUrl would've happened automatically
    Sass.setWorkerUrl = function (workerUrl) {
        globalWorkerUrl = workerUrl;
    };
    Sass.style = {
        nested: 0,
        expanded: 1,
        compact: 2,
        compressed: 3
    };
    Sass.comments = {
        'none': 0,
        'default': 1
    };
    Sass.prototype = {
        style: Sass.style,
        comments: Sass.comments,
        destroy: function () {
            this._worker && this._worker.terminate();
            this._worker = null;
            this._callbacks = {};
            this._importer = null;
        },
        _handleWorkerMessage: function (event) {
            if (event.data.command) {
                this[event.data.command](event.data.args);
            }
            this._callbacks[event.data.id] && this._callbacks[event.data.id](event.data.result);
            delete this._callbacks[event.data.id];
        },
        _dispatch: function (options, callback) {
            if (!this._worker) {
                throw new Error('Sass worker has been terminated');
            }
            options.id = 'cb' + Date.now() + Math.random();
            this._callbacks[options.id] = callback;
            this._worker.postMessage(options);
        },
        _importerInit: function (args) {
            // importer API done callback pushing results
            // back to the worker
            var done = function done(result) {
                this._worker.postMessage({
                    command: '_importerFinish',
                    args: [result]
                });
            }.bind(this);
            try {
                this._importer(args[0], done);
            } catch (e) {
                done({ error: e.message });
                throw e;
            }
        },
        importer: function (importerCallback, callback) {
            if (typeof importerCallback !== 'function' && importerCallback !== null) {
                throw new Error('importer callback must either be a function or null');
            }
            // callback is executed in the main EventLoop
            this._importer = importerCallback;
            // tell worker to activate importer callback
            this._worker.postMessage({
                command: 'importer',
                args: [Boolean(importerCallback)]
            });
            callback && callback();
        }
    };
    var commands = 'writeFile readFile listFiles removeFile clearFiles lazyFiles preloadFiles options compile compileFile';
    commands.split(' ').forEach(function (command) {
        Sass.prototype[command] = function () {
            var callback = slice.call(arguments, -1)[0];
            var args = slice.call(arguments, 0, -1);
            if (typeof callback !== 'function') {
                args.push(callback);
                callback = noop;
            }
            this._dispatch({
                command: command,
                args: args
            }, callback);
        };
    });
    // automatically set the workerUrl in case we're loaded by a simple
    // <script src="path/to/sass.js"></script>
    // see https://github.com/medialize/sass.js/pull/32#issuecomment-103142214
    Sass.setWorkerUrl(SASSJS_RELATIVE_PATH + '/sass.worker.js');
    return Sass;
}));
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module CMSadapter
@class CMSadapterImpl.CustomContentType the class that has the core integration using the CMS API.
*/
define('CMSadapter.Impl.ThemeCustomizerPreview', [
    'CMSadapter.Component',
    'Utils',
    'Url',
    'jQuery',
    'underscore',
    'sass'
], function (CMSadapterComponent, Utils, Url, jQuery, _, Sass) {
    'use strict';
    var EDITABLE_REGEX = /\/\*\s+<<\s+var:([^\s]+)\s+\*\/\s+([^\/]+)\s+\/\*\s+>>\s+\*\//gi, ESCAPED_INTERPOLATION_REGEX = /\\#{/gi, VARIABLE_REGEX = /\$[A-Za-z0-9_-]*|([_a-zA-Z][A-Za-z0-9_-]*)\s*\(/g, FUNCTION_WHITELIST = [
            'rgb',
            'rgba',
            'red',
            'green',
            'blue',
            'mix',
            'hsl',
            'hsla',
            'hue',
            'saturation',
            'lightness',
            'adjust-hue',
            'lighten',
            'darken',
            'saturate',
            'desaturate',
            'grayscale',
            'complement',
            'invert',
            'alpha',
            'rgba',
            'opacify',
            'transparentize',
            'adjust-color',
            'scale-color',
            'change-color',
            'ie-hex-str',
            'unquote',
            'quote',
            'str-length',
            'str-insert',
            'str-index',
            'str-slice',
            'to-upper-case',
            'to-lower-case',
            'percentage',
            'round',
            'ceil',
            'floor',
            'abs',
            'min',
            'max',
            'random',
            'length',
            'nth',
            'set-nth',
            'join',
            'append',
            'zip',
            'index',
            'list-separator',
            'is-bracketed',
            'map-get',
            'map-merge',
            'map-remove',
            'map-keys',
            'map-values',
            'map-has-key',
            'keywords',
            'selector-nest',
            'selector-append',
            'selector-extend',
            'selector-replace',
            'selector-unify',
            'is-superselector',
            'simple-selectors',
            'selector-parse',
            'feature-exists',
            'variable-exists',
            'global-variable-exists',
            'function-exists',
            'mixin-exists',
            'content-exists',
            'inspect',
            'type-of',
            'unit',
            'unit-less',
            'comprable',
            'call',
            'get-function',
            'if',
            'unique-id',
            'fade_in',
            'expression',
            'calc'
        ], URL_REGEX = /url\(([^)]+)(\))/g, METADATA_REGEX = /\/\* values \*\/[\s]*\/\*(([^*]|\*(?!\/))*)\*\/[\s]*\/\* groups \*\/[\s]*\/\*(([^*]|\*(?!\/))*)\*\/([\s]*\/\* warnings \*\/[\s]*\/\*(([^*]|\*(?!\/))*)\*\/)?/;
    function CMSadapterImplThemeCustomizerPreview(application, CMS) {
        this.applicationName = application.name;
        Sass.setWorkerUrl(Utils.getAbsoluteUrl('javascript/sass.worker.js'));
        this.CMS = CMS;
        this.sassCompiler = null;
        this.previewCSS = '';
        this.originalPreviewCSS = '';
        this.originalChangedVariables = {};
        //Ordered list, if element A depends of B, A will appear first
        this.completeSetOfVariablesInOrder = [];
        this.toProcess = null;
        this.isCompiling = false;
        //URL of the css with the metadata
        this.stylesheetHref = '';
        //variables used to synchronize CSS reloading
        this.reloadCSSRequestId = null;
        this.listenForCMS();
    }
    _.extend(CMSadapterImplThemeCustomizerPreview.prototype, {
        listenForCMS: function listenForCMS() {
            var self = this;
            if (SC.ENVIRONMENT.isExtended) {
                this.CMS.on('theme:config:get', function (promise) {
                    self.loadPreviewEnvironment(promise);
                });
                this.CMS.on('theme:styles:overrideCss', function (promise, changedVariables) {
                    if (_.size(changedVariables) > 0) {
                        self.toProcess = {
                            promise: promise,
                            changedVariables: changedVariables
                        };
                        self.previewChangedVariables();
                    } else {
                        //Restore theme defaults
                        self.restoreThemeDefaults(promise);
                    }
                });
                this.CMS.on('theme:styles:save', function (promise, changedVariables) {
                    self.saveThemeStyles(promise, changedVariables);
                });
                this.CMS.on('theme:styles:revertCss', function (promise) {
                    //cancel button click
                    self.themeRevertCss(promise);
                });
            }
        }    /**
		 * By calling this method the sass.js compiler is going to be loaded as well as
		 * the css+metadata for the current application(shopping, my account, checkout)
		 * This method should be triggered when SMT admin is opened
		 **/,
        loadPreviewEnvironment: function loadPreviewEnvironment(promise) {
            //Prevent to get the css url when edition is canceled
            !this.stylesheetHref && this.setStylesheetHref();
            var self = this, loadedCSS, variablesCalculatedValuePromise = jQuery.ajax({
                    url: self.stylesheetHref,
                    dataType: 'text'
                }).then(function (css) {
                    loadedCSS = css;
                    var variablesMetadata = self.extractVariablesMetadata(css);
                    self.completeSetOfVariablesInOrder = self.identifyNonCompilableVariables(self.getDependenciesInOrder(variablesMetadata.values));
                    return variablesMetadata;
                }), themeDataPromise = jQuery.ajax(SC.ENVIRONMENT.embEndpointUrl).then(function (themeData) {
                    self.saveEndpoint = themeData.saveEndpoint;
                    self.compileEndpoint = themeData.compileEndpoint;
                    return themeData;
                });
            jQuery.when(variablesCalculatedValuePromise, themeDataPromise).then(function (variablesMetadata, themeData) {
                var areEditableVariables = _.findWhere(self.completeSetOfVariablesInOrder, { editable: true });
                if (areEditableVariables) {
                    self.applyLoadedCSS(loadedCSS, themeData.editedSettings).then(function (calculatedVariablesValue) {
                        //Used if theme edition is canceled
                        self.originalPreviewCSS = self.previewCSS;
                        self.originalChangedVariables = themeData.editedSettings;
                        //Remove defaults css from the dom, all stylesheets in the header are going to be removed
                        self.removeDefaultStyles();
                        var themeSettings = {
                            skins: themeData.skins,
                            formData: {
                                values: variablesMetadata.values,
                                structure: variablesMetadata.groups,
                                warnings: variablesMetadata.warnings
                            },
                            editedSettings: themeData.editedSettings,
                            currentSettings: calculatedVariablesValue
                        };
                        promise.resolve(themeSettings);
                    });
                } else {
                    //if there are not editable variables, the theme is not editable
                    promise.resolve({});
                }
            }).fail(function (error) {
                promise.reject({ errors: 'Error loading or processing metadata. Details: ' + JSON.stringify(error) });
            });
        },
        themeRevertCss: function themeRevertCss(promise) {
            this.discardReload();
            this.applyLoadedCSS(this.originalPreviewCSS, this.originalChangedVariables).then(promise.resolve).fail(function (error) {
                promise.reject({ errors: 'Error reverting the changes. Details: ' + JSON.stringify(error) });
            });
        },
        previewChangedVariables: function previewChangedVariables() {
            if (this.toProcess !== null && !this.isCompiling) {
                this.isCompiling = true;
                var self = this, promise = this.toProcess.promise, changedVariables = this.toProcess.changedVariables;
                this.toProcess = null;
                this.getVariablesCalculatedValue(changedVariables, true).then(function (variablesComputedValue) {
                    if (self.toProcess === null) {
                        var newCSS = self.replaceVariablesValueOnPreviewCSS(variablesComputedValue);
                        self.applyPreviewCSS(newCSS);
                        promise.resolve(self.getEditableVariablesOnly(variablesComputedValue));
                        self.themeStylesReloadValues(changedVariables);
                    }
                }).fail(function (error) {
                    if (self.toProcess === null) {
                        promise.reject({ errors: 'Error previewing. Details: ' + JSON.stringify(error) });
                    }
                }).always(function () {
                    self.isCompiling = false;
                    self.previewChangedVariables();
                });
            }
        },
        saveThemeStyles: function saveThemeStyles(promise, changedVariables) {
            var self = this, callbacks = {
                    then: function (variablesValue) {
                        promise.resolve(variablesValue);
                        //Used if theme edition is canceled
                        self.originalPreviewCSS = self.previewCSS;
                        self.originalChangedVariables = changedVariables;
                    },
                    fail: function (error) {
                        promise.reject({ errors: 'Error saving the theme. Details: ' + JSON.stringify(error) });
                    }
                };
            self.reloadCSS(changedVariables, true, callbacks);
        },
        restoreThemeDefaults: function restoreThemeDefaults(promise) {
            var self = this, callbacks = {
                    then: function (variablesValue) {
                        promise.resolve(variablesValue);
                    },
                    fail: function (error) {
                        promise.reject({ errors: 'Error restoring theme defaults. Details:' + JSON.stringify(error) });
                    }
                };
            self.reloadCSS({}, false, callbacks);
        },
        reloadCSS: function reloadCSS(changedVariables, save, callbacks) {
            var self = this, endPoint = save ? this.saveEndpoint : this.compileEndpoint;
            //Build endpoint url
            endPoint.data.skin = JSON.stringify(changedVariables);
            endPoint.data.app = this.applicationName.toLowerCase();
            //discard reloadCSS or planned reloadCSS
            self.discardReload();
            var reloadCSSRequestId = self.reloadCSSRequestId;
            function doIfIsLastReloadExec(fn) {
                reloadCSSRequestId === self.reloadCSSRequestId && fn();
            }
            var promise = jQuery.ajax(endPoint).then(function (response) {
                if (response.header && response.header.status.code !== 'SUCCESS') {
                    if (callbacks && callbacks.fail) {
                        doIfIsLastReloadExec(function () {
                            callbacks.fail(response);
                        });
                    }
                } else {
                    doIfIsLastReloadExec(function () {
                        self.applyLoadedCSS(response.css, changedVariables).then(function (variablesValue) {
                            if (callbacks && callbacks.then) {
                                callbacks.then(variablesValue);
                            }
                        });
                    });
                }
            });
            if (callbacks) {
                callbacks.fail && promise.fail(function (error) {
                    doIfIsLastReloadExec(function () {
                        callbacks.fail(error);
                    });
                });
                callbacks.always && promise.always(function (result) {
                    doIfIsLastReloadExec(function () {
                        callbacks.always(result);
                    });
                });
            }
        },
        themeStylesReloadValues: function themeStylesReloadValues(changedVariables) {
            var self = this;
            //discard reloadCSS or planned reloadCSS
            this.discardReload();
            self.reloadCSSRequestId = setTimeout(function () {
                var callbacks = {
                    then: function (variablesValue) {
                        self.CMS.trigger('theme:styles:reloadValues', {
                            errors: null,
                            values: variablesValue
                        });
                    },
                    fail: function (error) {
                        self.CMS.trigger('theme:styles:reloadValues', { errors: 'Error reloading values from server. Details: ' + JSON.stringify(error) });
                    }
                };
                self.reloadCSS(changedVariables, false, callbacks);
            }, 5000);
        },
        fixRelativeURLs: function fixRelativeURLs(css, baseURL) {
            var output = css.replace(URL_REGEX, function (matched, relative) {
                //remove spaces, single and double quotes
                relative = relative.trim();
                if (relative[0] === '\'' || relative[0] === '"') {
                    relative = relative.substr(1, relative.length - 2);
                }
                return 'url(' + new Url().parse(relative).resolve(baseURL).toString() + ')';
            });
            return output;
        },
        getEditableVariablesOnly: function getEditableVariablesOnly(variablesCalculatedValue) {
            //Filter the variables to return only the editable ones
            var editableVariables = {};
            _.each(this.completeSetOfVariablesInOrder, function (variable) {
                if (variable.editable && variablesCalculatedValue[variable.name] !== undefined) {
                    editableVariables[variable.name] = variablesCalculatedValue[variable.name];
                }
            });
            return editableVariables;
        },
        applyPreviewCSS: function applyPreviewCSS(css) {
            var tagId = 'nsCSSWithMetadata', styleTag = document.getElementById(tagId);
            if (!styleTag) {
                styleTag = window.document.createElement('style');
                styleTag.id = tagId;
                window.document.body.appendChild(styleTag);
            }
            styleTag.innerHTML = css;
        },
        applyLoadedCSS: function applyLoadedCSS(css, changedVariables) {
            var self = this;
            this.previewCSS = this.fixRelativeURLs(css, this.stylesheetHref);
            this.applyPreviewCSS(this.previewCSS);
            var variablesValuesFromCSS = this.extractVariablesValuesFromCSS(this.previewCSS);
            this.setVariablesDefaultValue(variablesValuesFromCSS);
            return this.getVariablesCalculatedValue(changedVariables).then(function (calculatedVariablesValue) {
                return self.getEditableVariablesOnly(calculatedVariablesValue);
            });
        },
        extractVariablesMetadata: function extractVariablesMetadata(css) {
            var variablesMetadata = {}, matches = css.match(METADATA_REGEX);
            variablesMetadata.values = JSON.parse(this.unescapeNumberSign(matches[1])).values;
            variablesMetadata.groups = JSON.parse(matches[3]).groups;
            variablesMetadata.warnings = matches[5];
            return variablesMetadata;
        },
        getAffectedVariables: function getAffectedVariables(editedVariables) {
            var affectedVariables = [], derivedVars = {};
            function addToDerivedVars(derivedVar) {
                derivedVars[derivedVar.name] = true;
            }
            for (var i = this.completeSetOfVariablesInOrder.length - 1; i >= 0; i--) {
                var variableName = this.completeSetOfVariablesInOrder[i].name;
                //Avoid to add duplicated variables in "affectedVariables" array
                if (editedVariables[variableName] !== undefined || derivedVars[variableName] !== undefined) {
                    affectedVariables.push(this.completeSetOfVariablesInOrder[i]);
                    _.each(this.completeSetOfVariablesInOrder[i].derived, addToDerivedVars);
                }
            }
            return affectedVariables.reverse();
        },
        buildDummySass: function buildDummySass(affectedVariables, editedVariables) {
            var self = this, wrapFunction = '@function quotes-verbatim($value) {\n' + '  @if (type-of($value) == "string") {\n' + '    // SASS doesn\'t have str-is-quoted, and quoted and unquoted strings compare\n' + '    // equal. I noticed that list expressions give away whether a string is quoted,\n' + '    // though, so here\'s how we can return a string with explicit quotes.\n' + '    $list-expr: "#{inspect(($value, ""))}";\n' + '    @return str-slice($list-expr, 0, str-length($list-expr) - 4);\n' + '  }\n' + '  @else {\n' + '    @return $value;\n' + '  }\n' + '}\n' + '  \n' + '@function wrap($name, $value) {\n' + '  @if (outputstyle() != "COMPRESSED") {\n' + '    @if ($value) {\n' + '      @return unquote("/* << var:" + $name + " */ " + quotes-verbatim($value) + " /* >> */");\n' + '    }\n' + '    @return null;\n' + '  }\n' + '  @return $value;\n' + '};', variablesDeclaration = '', dummyClassBody = '';
            for (var i = affectedVariables.length - 1; i >= 0; i--) {
                var variableName = affectedVariables[i].name, variableValue;
                if (editedVariables[variableName] !== undefined) {
                    variableValue = editedVariables[variableName];
                } else {
                    if (affectedVariables[i].nonCompilable) {
                        //use the value in the css
                        variableValue = affectedVariables[i].defaultValue;
                    } else {
                        variableValue = affectedVariables[i].expr;
                    }
                }
                if (variableValue !== undefined) {
                    variablesDeclaration += self.buildSASSVariableDeclaration(variableName, variableValue);
                    dummyClassBody += self.buildSASSVariableUsageStatement(variableName);
                }
            }
            return wrapFunction + variablesDeclaration + '\n' + '.dummyClass {\n' + dummyClassBody + '\n}';
        },
        buildDummyCSS: function buildDummyCSS(sassStr) {
            var self = this, promise = jQuery.Deferred(), retried = false;
            function compilerHandler(compilerOutput) {
                if (compilerOutput.status === 0) {
                    promise.resolve(compilerOutput.text);
                } else {
                    if (!retried) {
                        retried = true;
                        self.getSassCompiler(true).compile(sassStr, compilerHandler);
                    } else {
                        promise.reject(compilerOutput.message ? compilerOutput.message : 'Unexpected error compiling front-end SASS variables');
                    }
                }
            }
            self.getSassCompiler().compile(sassStr, compilerHandler);
            return promise;
        },
        extractVariablesValuesFromCSS: function extractVariablesValuesFromCSS(css) {
            var result, variables = {};
            while ((result = EDITABLE_REGEX.exec(css)) !== null) {
                var name = result[1];
                variables[name] = result[2];
            }
            return variables;
        }    /**
		 * @method replaceVariablesValueOnPreviewCSS
		 * @param {variableName: String} editedVariables
		 * @returns {string} copy the the attribute "previewCSS" with the supplied values changed
		 */,
        replaceVariablesValueOnPreviewCSS: function replaceVariablesValueOnPreviewCSS(editedVariables) {
            var output = this.previewCSS.replace(EDITABLE_REGEX, function (matched, name) {
                var editedValue = editedVariables[name] !== undefined;
                if (!editedValue) {
                    return matched;
                } else {
                    return '/* << var:' + name + ' */ ' + editedVariables[name] + ' /* >> */';
                }
            });
            return output;
        }    /**
		 *	@method getVariablesCalculatedValue For each variable in the metadata compute his value using the supplied changes"
		 *	@param changedVariables {Object} Map with all edited variables
		 *	@return Promise The promise is resolved with an object with each variables and his calculated value
		 * */,
        getVariablesCalculatedValue: function getVariablesCalculatedValue(changedVariables, affectedsOnly) {
            var self = this, affectedVariables = affectedsOnly ? this.getAffectedVariables(changedVariables) : this.completeSetOfVariablesInOrder, sass = this.buildDummySass(affectedVariables, changedVariables || {});
            return this.buildDummyCSS(sass).then(function (css) {
                return self.extractVariablesValuesFromCSS(css);
            });
        }    /**
		 * @method getDependenciesInOrder The method should be called only once, when the environment is initialised
		 * @param Array<Object> siblings SASS variables metadata
		 * @return Array<Object> Ordered list, if element A depends of B, A will appear first
		 * */,
        getDependenciesInOrder: function getDependenciesInOrder(siblings) {
            function find(startIndex, array, elementName) {
                for (var i = startIndex; i < array.length; i++) {
                    if (array[i].name === elementName) {
                        return i;
                    }
                }
                return -1;    //not found
            }
            function mergeBranches(branch1, branch2) {
                var branch1Index = 0, branch2Index = 0, mergeResult = [], mergedElements = {};
                while (branch1Index < branch1.length || branch2Index < branch2.length) {
                    if (branch1Index < branch1.length) {
                        var searchedElementIndex = find(branch2Index, branch2, branch1[branch1Index].name);
                        if (searchedElementIndex >= 0) {
                            while (branch2Index <= searchedElementIndex) {
                                if (!mergedElements[branch2[branch2Index].name]) {
                                    mergeResult.push(branch2[branch2Index]);
                                    mergedElements[branch2[branch2Index].name] = true;
                                }
                                branch2Index++;
                            }
                        } else {
                            if (!mergedElements[orderedDependencies[branch1Index].name]) {
                                mergeResult.push(orderedDependencies[branch1Index]);
                                mergedElements[orderedDependencies[branch1Index].name] = true;
                            }
                        }
                        branch1Index++;
                    } else {
                        //add all elements in  branch2 that were not included yet
                        mergeResult = mergeResult.concat(branch2.slice(branch2Index));
                        branch2Index = branch2.length;
                    }
                }
                return mergeResult;
            }
            var self = this, orderedDependencies = [];
            _.each(siblings, function (sibling) {
                if (sibling.derived && sibling.derived.length) {
                    var branchOrderedDependencies = self.getDependenciesInOrder(sibling.derived);
                    if (orderedDependencies.length) {
                        //merge two sets of ordered dependencies
                        orderedDependencies = mergeBranches(orderedDependencies, branchOrderedDependencies);
                    } else {
                        orderedDependencies = branchOrderedDependencies;
                    }
                }
            });
            return mergeBranches(orderedDependencies, siblings);
        },
        buildSASSVariableDeclaration: function buildSASSVariableDeclaration(name, value) {
            return name + ':' + value + ';';
        },
        buildSASSVariableUsageStatement: function buildSASSVariableUsageStatement(name) {
            var cssPropertyName = name.substring(1);
            return '\t' + cssPropertyName + ': wrap(\'' + name + '\', ' + name + ');';
        },
        getSassCompiler: function getSassCompiler(cleanUp) {
            if (!this.sassCompiler) {
                this.sassCompiler = new Sass();
            } else {
                if (cleanUp) {
                    this.sassCompiler.destroy();
                    this.sassCompiler = new Sass();
                }
            }
            return this.sassCompiler;
        },
        identifyNonCompilableVariables: function identifyNonCompilableVariables(variables) {
            var availableVariables = {};
            function setAsNotCompilable(variable) {
                variable.nonCompilable = true;
                _.each(variable.derived, function (derived) {
                    setAsNotCompilable(derived);
                });
            }
            function findInFunctionsWhiteList(func) {
                return _.find(FUNCTION_WHITELIST, function (validFunc) {
                    return validFunc === func;
                });
            }
            for (var i = variables.length - 1; i >= 0; i--) {
                var variable = variables[i];
                //if has not been labeled as not compilable yet, check the expression
                if (!variable.nonCompilable) {
                    //parse expression to extract variables and functions
                    var parsed = variable.expr.match(VARIABLE_REGEX);
                    if (parsed) {
                        for (var j = 0; j < parsed.length; j++) {
                            var member = parsed[j];
                            if (member[0] !== '$') {
                                //if is a function must exist in the white list
                                member = member.substring(0, member.indexOf('('));
                                var isValidFunc = findInFunctionsWhiteList(member);
                                if (!isValidFunc) {
                                    setAsNotCompilable(variable);
                                }
                            } else {
                                //if is a variable must exist in "availableVariables"
                                if (!availableVariables[member]) {
                                    setAsNotCompilable(variable);
                                }
                            }
                        }
                    }
                    if (!variable.nonCompilable) {
                        //set the variable as existing and compilable
                        availableVariables[variables[i].name] = true;
                    }
                }
            }
            return variables;
        },
        unescapeNumberSign: function unscapeChardInVariablesExpression(str) {
            return str.replace(ESCAPED_INTERPOLATION_REGEX, '#{');
        },
        setVariablesDefaultValue: function setVariablesDefaultValue(variablesDefaultValue) {
            _.each(this.completeSetOfVariablesInOrder, function (variable) {
                variable.defaultValue = variablesDefaultValue[variable.name];
            });
        },
        setStylesheetHref: function setStylesheetHref() {
            var stylesheets = jQuery('link[rel="stylesheet"]', window.document.head)    //Build the path to the css with the metadata
                                                                          //Get a non IE url
, stylesheetHref = _.find(stylesheets.get(), function (linkDomElement) {
                    if (!linkDomElement.href.match(/((_\d+){2}\.css(\?.*)*)$/)) {
                        return true;
                    }
                });
            //Get the url of the production css without the extension
            stylesheetHref = stylesheetHref.href.match(/(.*)(\.css(\?.*)*)$/)[1];
            this.stylesheetHref = stylesheetHref.substring(0, stylesheetHref.lastIndexOf('/') + 1) + 'smt_' + stylesheetHref.substring(stylesheetHref.lastIndexOf('/') + 1) + '.css?t=' + new Date().getTime();
        },
        removeDefaultStyles: function removeDefaultStyles() {
            var stylesheets = jQuery('link[rel="stylesheet"]', window.document.head);
            stylesheets.remove();
        },
        discardReload: function discardReload() {
            //discard reloadCSS or planned reloadCSS
            clearTimeout(this.reloadCSSRequestId);
            this.reloadCSSRequestId = _.uniqueId('id_');
        }
    });
    return CMSadapterImplThemeCustomizerPreview;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
@module CMSadapter

@class CMSadapter.Impl.Merchandising.v3
*/
define('CMSadapter.Impl.Merchandising.v3', [
    'CMSadapter.Impl.Merchandising',
    'underscore'
], function (CMSadapterImplMerchandising, _) {
    'use strict';
    var CMSadapterImplMerchandising3 = function (application, CMS) {
        CMSadapterImplMerchandising.call(this, application, CMS);
    };
    CMSadapterImplMerchandising3.prototype = Object.create(CMSadapterImplMerchandising.prototype);
    CMSadapterImplMerchandising3.prototype.listenForCMS = function listenForCMS() {
        // CMS listeners - CMS tells us to do something, could fire anytime.
        var self = this;
        self.CMS.on('cart:items:get', function (promise) {
            var cart = self.application.getComponent('Cart'), linesId = [];
            if (cart) {
                cart.getLines().then(function (lines) {
                    _.each(lines, function (line) {
                        if (line.item && line.item.internalid) {
                            linesId.push(line.item.internalid);
                        }
                    });
                    promise.resolve(linesId);
                });
            } else {
                promise.resolve();
            }
        });
        self.CMS.on('page:items:get', function (promise) {
            var pdp = self.application.getComponent('PDP'), linesId = [];
            if (pdp) {
                var product = pdp.getItemInfo();
                if (product && product.item && product.item.internalid) {
                    linesId.push(product.item.internalid);
                }
            }
            promise.resolve(linesId);
        });
    };
    return CMSadapterImplMerchandising3;
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
	@module CMSadapter
	@class CMSadapter.Plugin.RecollectCMSSelectors

	Loads the recollectCMSSelectors plugin that iterates through all the tags that contains data-cms in the
	template string.
*/
define('CMSadapter.Plugin.RecollectCMSSelectors', ['underscore'], function (_) {
    'use strict';
    return function CMSadapterPluginRecollectCMSSelectorsGenerator(application) {
        return {
            name: 'recollectCMSSelectors',
            priority: 20,
            execute: function (tmpl_str, view) {
                var component = application.getComponent('CMS');
                var unregister = function () {
                    component.unregisterViewForPlaceholders(view);
                };
                view.off('destroy', unregister).on('destroy', unregister);
                var regex = /<[^>]*(data-cms-area)=\"([^"\s]+)\"[^>]*>/g, match = regex.exec(tmpl_str), selectors_on_ui = [], selector, isEqual = function (obj) {
                        return _.isEqual(obj, selector);
                    };
                component.unregisterViewForPlaceholders(view);
                while (match !== null) {
                    selector = { 'data-cms-area': match[2] };
                    if (!_.find(selectors_on_ui, isEqual)) {
                        selectors_on_ui.push(selector);
                    } else {
                        console.warn('Repeated selector ' + component.selectorToString(selector) + ' in template ' + view.template.Name);
                    }
                    match = regex.exec(tmpl_str);
                }
                if (selectors_on_ui.length > 0) {
                    component.registerViewForPlaceholder(selectors_on_ui, view);
                }
                return tmpl_str;
            }
        };
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
/*
	@module CMSadapter
	@class CMSadapter.Plugin.PostRender

	Loads the cmsPostRender plugin responsible of re-rendering CCTs when views are being updated.
*/
define('CMSadapter.Plugin.PostRender', ['underscore'], function (_) {
    'use strict';
    return function CMSadapterPluginPostRender(application) {
        return {
            name: 'cmsPostRender',
            priority: 10,
            execute: function (tmpl_str, view) {
                var cms_component = application.getComponent('CMS');
                var cct_generators = cms_component.getViewCctsToRerender(view);
                _.each(cct_generators, function (cct_generator) {
                    view.addChildViewInstances(cct_generator, false);
                });
            }
        };
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CMSadapter
// @class CMSadapter.v3
define('CMSadapter.v3', [
    'Backbone',
    'CMSadapter',
    'CMSadapter.Impl.Core.v3',
    'CMSadapter.Impl.Landing.v3',
    'CMSadapter.Impl.Categories.v3',
    'CMSadapter.Impl.CustomContentType',
    'CMSadapter.Impl.ThemeCustomizerPreview',
    'CMSadapter.Impl.Merchandising.v3',
    'CMSadapter.Plugin.RecollectCMSSelectors',
    'CMSadapter.Plugin.PostRender',
    'underscore'
], function (Backbone, CMSadapter, CMSadapterImplCore3, CMSadapterImplLanding3, CMSadapterImplCategories3, CMSadapterImplCustomContentType, CMSadapterImplThemeCustomizerPreview, CMSadapterImplMerchandising3, CMSadapterPluginRecollectCMSSelectors, CMSadapterPluginPostRender, _) {
    'use strict';
    // @class CMSadapter responsible of starting both the adapter implementation and cms landing pages router.
    // Assumes cms.js is already loaded
    // @extend ApplicationModule
    return _.extend({}, CMSadapter, {
        installBackboneViewPlugins: function installBackboneViewPlugins(application) {
            Backbone.View.postCompile.install(CMSadapterPluginRecollectCMSSelectors(application));
            Backbone.View.postCompile.install(CMSadapterPluginPostRender(application));
        },
        initAdapterImpls: function initAdapterImpls(application, cmsObject, landingRouter) {
            this.adapterLanding = new CMSadapterImplLanding3(application, cmsObject, landingRouter);
            this.adapterCategories = new CMSadapterImplCategories3(application, cmsObject);
            this.adapterCustomContentTypes = new CMSadapterImplCustomContentType(application, cmsObject);
            this.adapterThemeCustomizerPreview = new CMSadapterImplThemeCustomizerPreview(application, cmsObject);
            this.adapterMerchandising = new CMSadapterImplMerchandising3(application, cmsObject);
            //CMSadapterImplCore3 must be the last on been created, constructor triggers the "app:ready" event
            this.adapterCore = new CMSadapterImplCore3(application, cmsObject);
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module CMSadapterInstaller
define('CMSadapterInstaller', [
    'CMSadapter',
    'CMSadapter.v2',
    'CMSadapter.v3',
    'SC.Configuration'
], function (CMSadapter, CMSadapter2, CMSadapter3, Configuration) {
    'use strict';
    // @class CMSadapterInstaller responsible of initializing the CMSAdapter depending on the configured CMS version.
    return {
        mountToApp: function (application) {
            var cms_adapter_version = Configuration.get('cms.adapterVersion'), cms_adapter = null;
            switch (cms_adapter_version) {
            case '2':
                cms_adapter = CMSadapter2;
                break;
            case '3':
                cms_adapter = CMSadapter3;
                break;
            }
            if (cms_adapter) {
                return cms_adapter.mountAdapter(application);
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Sensors
define('Sensors.DataExtractor', [
    'Profile.Model',
    'Session',
    'Backbone',
    'jQuery',
    'underscore',
    'Utils'
], function (ProfileModel, Session, Backbone, jQuery, _, Utils) {
    'use strict';
    // @class DataExtractorDefaults This object represent the default named extractors that provides
    // the default information like site, cart, bundle, etc.
    return {
        // @property {Object} site information about the site @public
        site: {
            // @class DataExtractor these objects are responsible of returning a subset of the information to 
            // be send to the sensors. For example the default 'bundle' DataExtractor property is responsible of 
            // publishing information about the bundle like version and name. 
            // @property {Boolean} once if true it will be published only on the first application startup rendering but not on indirect navigation (navigation inside the SPA)
            once: false    // @method extract must return a promise that resolves into an object with name:values . This object
                     // is what then is mized into the published results. 
                     // @public @param application @return {jQuery.Deferred}
,
            extract: function (application) {
                var site_data = {
                        sitePage: '',
                        siteUrl: '',
                        siteFragment: ''
                    }, layout = application.getLayout(), site_data_promise = jQuery.Deferred(), view_id = layout.getCurrentView() && layout.getCurrentView().getPageDescription();
                if (view_id) {
                    site_data.sitePage = view_id;
                }
                site_data.siteUrl = window.location.href;
                site_data.siteFragment = Backbone.history.fragment;
                return site_data_promise.resolve(site_data);
            }
        }    // @class DataExtractorDefaults 
             // @property {DataExtractor} cart
,
        cart: {
            once: false,
            extract: function (application) {
                var cart_data = { cartLines: '' }, cart_data_promise = jQuery.Deferred();
                application.getCart().done(function (cart) {
                    cart_data.cartLines = cart.get('lines').length + '';
                    cart_data_promise.resolve(cart_data);
                }).fail(function () {
                    cart_data_promise.resolve(cart_data);
                });
                return cart_data_promise;
            }
        }    // @property {DataExtractor} bundle
,
        bundle: {
            once: true,
            extract: function () {
                var bundle_data_promise = jQuery.Deferred(), bundle_metadata = {}, release_metadata = SC.ENVIRONMENT.RELEASE_METADATA || {};
                bundle_metadata.bundleId = release_metadata.bundle_id || '';
                bundle_metadata.bundleName = release_metadata.name || '';
                bundle_metadata.bundleVersion = release_metadata.version || '';
                bundle_metadata.buildNo = release_metadata.buildno || '';
                bundle_metadata.dateLabel = release_metadata.datelabel || '';
                bundle_metadata.baseLabel = release_metadata.baselabel || '';
                return bundle_data_promise.resolve(bundle_metadata);
            }
        }    // @property {DataExtractor} customer
,
        customer: {
            once: false,
            extract: function () {
                var profile_model = ProfileModel.getInstance(), isGuest = profile_model.get('isGuest') === 'T', isLoggedIn = !isGuest && profile_model.get('isLoggedIn') === 'T', isRecognized = !isGuest && profile_model.get('isRecognized') === 'T', isReturning = !isGuest && isLoggedIn, isNew = !isGuest && !isRecognized && !isLoggedIn, customer_data = {};
                customer_data.customerSessionStatus = isNew ? 'New' : isReturning ? 'Returning' : isGuest ? 'Guest' : isRecognized ? 'Recognized' : '';
                var regex = new RegExp('[; ]NLVisitorId=([^\\s;]*)');
                var sMatch = (' ' + document.cookie).match(regex);
                customer_data.visitorId = sMatch ? unescape(sMatch[1]) : '';
                return jQuery.Deferred().resolve(customer_data);
            }
        }    // @property {DataExtractor} shopper
,
        shopper: {
            once: false,
            extract: function () {
                var shopper_data = {
                        shopperInternalId: '',
                        currencyCode: ''
                    }, profile_instance = ProfileModel.getInstance();
                var shopper_id = profile_instance.get('internalid');
                if (shopper_id && shopper_id !== '0') {
                    shopper_data.shopperInternalId = shopper_id;
                }
                shopper_data.currencyCode = Session.get('currency.code') || '';
                return jQuery.Deferred().resolve(shopper_data);
            }
        }    // @property {DataExtractor} device
,
        device: {
            once: false,
            extract: function () {
                return jQuery.Deferred().resolve({ device: Utils.getDeviceType() });
            }
        }    // @property {DataExtractor} error_status
,
        error_status: {
            once: false,
            extract: function (application) {
                var current_view = application.getLayout().getCurrentView(), errorData = current_view.isErrorView && (current_view.getPageDescription() || 'error');
                return jQuery.Deferred().resolve({ errorStatus: errorData });
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module Sensors
define('Sensors', [
    'Sensors.DataExtractor',
    'SC.Configuration',
    'jQuery',
    'underscore',
    'Backbone'
], function (SensorsDataExtractor, Configuration, jQuery, _, Backbone) {
    'use strict';
    //@class Sensors @extend ApplicationModule
    var sensors_module = {
        // @property {Object} nlrum
        nlrum: null    // @property {Sensors.DataExtractor}
,
        dataExtractor: SensorsDataExtractor    // @method loadScript it will nlrum.js and then call sendData(true) @return {Void}
,
        loadScript: function () {
            var self = this;
            window.NLRUM = window.NLRUM || {};
            window.NLRUM.bSendBeacon = 0;
            window.NLRUM.bResourceTimingDataCollection = 1;
            jQuery.getScript('/nlrum/nlRUM.js').done(function () {
                if (!window.NLRUM.addSCData) {
                    console.log('NLRUM has not defined addSCData');
                    return;
                }
                self.nlrum = window.NLRUM;
                self.sendData(true);
            }).fail(function () {
                console.log('nlRUM.js failed to load');
            });
        }    // @method getMetadata @param firstLoad is true for the first application view (direct navigation type)
             // @return {jQuery.Deferred} resolved with the data to be send.
,
        getMetadata: function (isFirstLoad) {
            var data = {}, data_promises = [], metadata_promise = jQuery.Deferred(), self = this;
            _.each(this.dataExtractor, function (extractor) {
                // include on first load or if it needs to be sent everytime (not once)
                if (extractor.extract && (isFirstLoad || !extractor.once)) {
                    data_promises.push(extractor.extract(self.application));
                }
            });
            jQuery.when.apply(jQuery, data_promises).done(function () {
                _.each(arguments, function (argument) {
                    if (argument) {
                        _.extend(data, argument);
                    }
                });
                metadata_promise.resolve(data);
            });
            return metadata_promise;
        }    // @method sendData @public @param isFirstLoad is true for the first application view (direct navigation type)
             // @return {jQuery.Deferred} resolved with the data to be send.
,
        sendData: function (isFirstLoad) {
            var promise = jQuery.Deferred();
            if (this.nlrum && this.nlrum.addSCData) {
                var self = this;
                this.getMetadata(isFirstLoad).done(function (data) {
                    data.linkType = isFirstLoad ? 'direct' : 'indirect';
                    self.nlrum.addSCData(data);
                    // @event nlrum:sendData each time data is posted to the nlrum service, listeners will be
                    // notified. The data is passed as handler first parameter. @public
                    self.trigger('nlrum:sendData', data, self);
                    promise.resolve(data);
                });
            }
            return promise;
        }    // @method mountToApp @param application @return {Void}
,
        mountToApp: function (application) {
            // don't execute in Page Generator
            if (!(SC.ENVIRONMENT.jsEnvironment === 'browser' && SC.ENVIRONMENT.SENSORS_ENABLED)) {
                return;
            }
            this.application = application;
            var self = this;
            application.getLayout().on('afterAppendView', function (view) {
                self.handleAfterAppendView(application, view);
                if (!self.nlrum)
                    // first load
                    {
                        self.loadScript();
                    }
                else {
                    self.sendData(false);
                }
            });
            self.registerNavigationEvents(application);
            if (self.debug) {
                self.on('nlrum:sendData', _.bind(self.debugLog, self));
            }
        }    //NAVIGATION TIMING
             //@methOd registerNavigationEvents will reset @?property userNavigateEventLastTime
,
        registerNavigationEvents: function (application) {
            var self = this;
            // Here we are registering to navigation events which we generalize as 'when the url fragment change'.
            // We are register to this change using several approaches to mark the t0 - history change, navigationhelper click, dom click
            //browser history just changed.
            Backbone.history.on('all', _.bind(this.handleNavigationEventStart, this));
            // navigationhelper way: user just clicked a navigation link! pdp matrix options won't work without this
            application.getLayout().mouseDown && application.getLayout().mouseDown.install({
                execute: function () {
                    self.handleNavigationEventStart();
                }
            });
            application.getLayout().on('afterAppendView', function (view) {
                view && view.$el.on('mousedown', function () {
                    self.handleNavigationEventStart();
                });    // view.$el.unbind() is called automatically
            });
        },
        handleNavigationEventStart: function () {
            this.userNavigateEventLastTime = new Date().getTime();
            window.NLRUM && window.NLRUM.markIndirectStart && window.NLRUM.markIndirectStart();
            this.handleAfterAppendViewCounter = 0;
        }    // @property userNavigateEventLastTime
,
        userNavigateEventLastTime: new Date().getTime(),
        handleAfterAppendViewCounter: 0,
        handleAfterAppendView: function () {
            var showContentTime = new Date().getTime() - this.userNavigateEventLastTime;
            var extractor = {
                once: false,
                value: { showContentTime: showContentTime },
                extract: function () {
                    return jQuery.Deferred().resolve(this.value);
                }
            };
            this.dataExtractor.showContentTime = extractor;
            this.handleAfterAppendViewCounter++;
            if (this.handleAfterAppendViewCounter > 1) {
                // this means that this afterAppendView was not triggered by a registered mechanism. This is an issue and it happens in PDP - add-to-cart button.
                // What we are doing in this case is not tracking the time because is wrong.
                delete this.dataExtractor.showContentTime;
            }
        }    // the following is just for debugging purposes when developing, on the browser console
             // IMPORTANT: disable or comment in production
,
        debug: false,
        debugRows: [
            'siteFragment',
            'sitePage',
            'showContentTime',
            'errorStatus'
        ],
        debugLog: function (data) {
            data = _.isArray(data) ? data : [data];
            var self = this, filteredData = _.map(data, function (entry) {
                    return _.pick.apply(_, [entry].concat(self.debugRows));
                });
            console.table(filteredData);
        }
    };
    _.extend(sensors_module, Backbone.Events);
    return sensors_module;
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module StoreLocator
define('StoreLocator.Tooltip.View', [
    'ReferenceMap',
    'store_locator_tooltip.tpl',
    'underscore',
    'Backbone.CollectionView',
    'Backbone'
], function (ReferenceMap, store_locator_tooltip_tpl, _, BackboneCollectionView, Backbone) {
    'use strict';
    return Backbone.View.extend({
        template: store_locator_tooltip_tpl    //@method initialize
                                     //@param {Object} options
,
        initialize: function initialize(options) {
            this.application = options.application;
            this.index = options.index;
        }    //@method getContext
             //@return StoreLocator.Tooltip.View.Context
,
        getContext: function getContext() {
            return {
                model: this.model,
                storeName: this.model.get('name'),
                showStoreDistance: !!this.model.get('distance'),
                distanceUnit: this.model.get('distanceunit'),
                storeDistance: this.model.get('distance'),
                showStoreAddress: !!this.model.get('address1'),
                storeAddress: this.model.get('address1'),
                storeId: this.model.get('internalid'),
                index: this.index
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module StoreLocatorReferenceMapsImplementation
define('ReferenceMap.Promise.Handler', [], function () {
    'use strict';
    var instance = null;
    function ReferenceMapPromiseHandler() {
        if (instance !== null) {
            throw new Error('Cannot instantiate more than one ReferenceMapPromiseHandler, use ReferenceMapPromiseHandler.getInstance()');
        }
        this.initialize();
    }
    ReferenceMapPromiseHandler.prototype = {
        initialize: function () {
            this.promise = null;
        },
        setPromise: function (promise) {
            this.promise = promise;
        },
        getPromise: function () {
            return this.promise;
        }
    };
    ReferenceMapPromiseHandler.getInstance = function () {
        if (instance === null) {
            instance = new ReferenceMapPromiseHandler();
        }
        return instance;
    };
    return ReferenceMapPromiseHandler.getInstance();
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// GoogleMap.js
//@module StoreLocatorReferenceMapImplementation @class GoogleMap
define('GoogleMap', [
    'Backbone',
    'jQuery',
    'underscore',
    'ReferenceMap',
    'StoreLocator.Tooltip.View',
    'ReferenceMap.Promise.Handler'
], function (Backbone, jQuery, _, ReferenceMap, StoreLocatorTooltip, PromiseHandler) {
    'use strict';
    ReferenceMap.prototype.isInitialized = function isInitialized() {
        return typeof google === 'object' && typeof google.maps === 'object';
    };
    ReferenceMap.prototype.load = function load() {
        var url = this.configuration.getUrl(), handler = PromiseHandler;
        if (!handler.getPromise() && !this.isInitialized()) {
            var promise = jQuery.getScript(url).done(function () {
                ReferenceMap.prototype.initialized = true;
            });
            this.load_promise = promise;
            handler.setPromise(promise);
        }
        return handler.getPromise();
    };
    ReferenceMap.prototype.showMap = function showMap(container) {
        var map_configuration = this.configuration.mapOptions(), map_options = {
                center: new google.maps.LatLng(map_configuration.centerPosition.latitude, map_configuration.centerPosition.longitude),
                zoom: map_configuration.zoom,
                mapTypeControl: map_configuration.mapTypeControl,
                streetViewControl: map_configuration.streetViewControl,
                mapTypeId: google.maps.MapTypeId[map_configuration.mapTypeId],
                disableDefaultUI: true
            };
        var map = new google.maps.Map(container, map_options);
        var self = this;
        google.maps.event.addListener(map, 'tilt_changed', _.bind(function () {
            google.maps.event.trigger(map, 'resize');
            if (!!this.points.length) {
                this.fitBounds(map);
            } else if (this.detail_point) {
                this.fitBounds(map);
                map.setCenter(map.getCenter());
                map.setZoom(this.configuration.zoomInDetails());
            } else {
                this.centerMapToDefault(map);
            }
        }, this));
        this.map = map;
        return map;
    };
    ReferenceMap.prototype.centerMapToDefault = function centerMapToDefault(map) {
        map = this.map || map;
        if (!map) {
            return;
        }
        map.myPositionMarker && map.myPositionMarker.setMap(null);
        var map_options = this.configuration.mapOptions();
        map.setZoom(map_options.zoom);
        map.setCenter(new google.maps.LatLng(parseInt(map_options.centerPosition.latitude, 10), parseInt(map_options.centerPosition.longitude, 10)));
    };
    ReferenceMap.prototype.getInfoWindow = function getInfoWindow() {
        if (!this.infowindow) {
            this.infowindow = new google.maps.InfoWindow();
        }
        return this.infowindow;
    };
    ReferenceMap.prototype.getTooltip = function getTooltip(model, index) {
        if (!this.tooltip) {
            this.tooltip = new StoreLocatorTooltip({
                model: model,
                index: index
            });
        } else {
            this.tooltip.index = index;
            this.tooltip.model = model;
        }
        return this.tooltip;
    };
    ReferenceMap.prototype.showPoint = function showPoint(point, map) {
        map = map || this.map;
        if (!map) {
            return;
        }
        var location = point.get('location'), marker = new google.maps.Marker({
                store_id: point.get('internalid'),
                icon: this.configuration.iconOptions('stores'),
                map: map
            });
        marker.setPosition(new google.maps.LatLng(location.latitude, location.longitude));
        marker.setVisible(true);
        marker.addListener('click', _.bind(function () {
            this.showInfoWindowOnClick(marker, map);
        }, this));
        return marker;
    };
    ReferenceMap.prototype.showPointWithoutInfoWindow = function showPointWithoutInfoWindow(point, map) {
        map = map || this.map;
        if (!map) {
            return;
        }
        var location = point.get('location'), marker = new google.maps.Marker({
                store_id: point.get('internalid'),
                icon: this.configuration.iconOptions('stores'),
                map: map
            });
        marker.setPosition(new google.maps.LatLng(location.latitude, location.longitude));
        marker.setVisible(true);
        this.detail_point = marker;
        return marker;
    };
    ReferenceMap.prototype.showInfoWindowOnClick = function showInfoWindowOnClick(marker, map) {
        var point = this.collection.find({ 'id': marker.store_id }), index = this.collection.indexOf(point) + 1;
        this.showInfoWindow(marker, point, index, map);
    };
    ReferenceMap.prototype.showInfoWindow = function showInfoWindow(marker, model, index, map) {
        map = map || this.map;
        if (!map) {
            return;
        }
        var tooltip = this.getTooltip(model, index), info_window = this.getInfoWindow();
        info_window.setContent(tooltip.template(tooltip.getContext()));
        info_window.open(map, marker);
    };
    ReferenceMap.prototype.showMyPosition = function showMyPosition(position, map) {
        position = position || this.myposition;
        map = map || this.map;
        if (!position || !map) {
            return;
        }
        if (map.myPositionMarker) {
            map.myPositionMarker.setMap(null);
        }
        map.myPositionMarker = new google.maps.Marker({
            icon: this.configuration.iconOptions('position'),
            map: map
        });
        position.location = position.location || new google.maps.LatLng(position.latitude, position.longitude);
        map.myPositionMarker.setPosition(position.location);
        map.myPositionMarker.setVisible(true);
        if (position.viewport) {
            map.fitBounds(position.viewport);
        } else {
            var map_options = this.configuration.mapOptions();
            map.setCenter(position.location);
            map.setZoom(map_options.zoom);
        }
        return map.myPositionMarker;
    };
    ReferenceMap.prototype.removePoint = function removePoint(point) {
        point.setMap(null);
    };
    ReferenceMap.prototype.showAutoCompleteInput = function showAutoCompleteInput(input) {
        var self = this;
        if (input) {
            this.autocomplete = new google.maps.places.SearchBox(input);
            google.maps.event.addListener(this.autocomplete, 'places_changed', function () {
                self.autocompleteChange();
                self.trigger('change:places', self.autocomplete.getPlaces());
            });
        }
        return this.autocomplete;
    };
    ReferenceMap.prototype.autocompleteChange = function autocompleteChange() {
        var place = this.autocomplete && this.autocomplete.getPlaces() && this.autocomplete.getPlaces()[0];
        if (!place || _.size(place) === 0) {
            console.warn('Autocomplete returned place contains no geometry');
            return;
        }
        if (!place.geometry) {
            console.warn('Autocomplete returned place contains no geometry');
            return;
        }
        //set autocomplete coordinates
        if (place.geometry.location) {
            this.setPosition({
                latitude: place.geometry.location.lat(),
                longitude: place.geometry.location.lng(),
                address: place.formatted_address,
                viewport: place.geometry.viewport,
                location: place.geometry.location
            });
        }
    };
    ReferenceMap.prototype.fitBounds = function fitBounds(map) {
        map = map || this.map;
        if (!map) {
            return;
        }
        var bounds = new google.maps.LatLngBounds();
        _.each(this.points, function (point) {
            var location = point.getPosition();
            bounds.extend(new google.maps.LatLng(location.lat(), location.lng()));
        });
        if (!_.isUndefined(this.myposition.latitude) && !_.isUndefined(this.myposition.longitude)) {
            bounds.extend(new google.maps.LatLng(this.myposition.latitude, this.myposition.longitude));
        }
        if (!!this.detail_point) {
            bounds.extend(new google.maps.LatLng(this.detail_point.position.lat(), this.detail_point.position.lng()));
        }
        map.fitBounds(bounds);
    };
    ReferenceMap.prototype.getCityGeoCode = function getCityGeoCode() {
        var promise = jQuery.Deferred(), geoCoder = new google.maps.Geocoder(), position = this.myposition, latlng = {
                lat: parseFloat(position.latitude),
                lng: parseFloat(position.longitude)
            }, self = this;
        geoCoder.geocode({ location: latlng }, function (results, status) {
            if (status === google.maps.GeocoderStatus.OK) {
                var city = _(results).find(function (result) {
                    return !_.indexOf(result.types, 'locality');
                });
                if (city) {
                    self.myposition.address = city.formatted_address;
                } else {
                    self.myposition.address = results[0].formatted_address;
                }
                self.trigger('change:position', self.myposition);
                promise.resolve();
            } else {
                promise.always();
                console.warn('Geocoder failed due to: ' + status);
            }
        });
        return promise;
    };
    ReferenceMap.prototype.zoomToPoint = function zoomToPoint(marker, map) {
        map = map || this.map;
        if (!map) {
            return;
        }
        map.setZoom(this.configuration.zoomInDetails());
        map.panTo(marker.position);
    };
    ReferenceMap.prototype.getDirectionsUrl = function getDirectionsUrl(source, destination) {
        var source_parameter = source ? source.latitude + ',' + source.longitude : 'Current+Location', destination_parameter = (destination && destination.latitude) + ',' + (destination && destination.longitude);
        return 'https://maps.google.com?saddr=' + source_parameter + '&daddr=' + destination_parameter;
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module StoreLocatorGoogleMapsImplementation
// Specific configuration redefinition for Google Maps implementation
define('GoogleMap.Configuration', [
    'ReferenceMap.Configuration',
    'SC.Configuration',
    'underscore',
    'Utils'
], function (ReferenceMapConfiguration, Configuration, _) {
    'use strict';
    ReferenceMapConfiguration.mapOptions = function mapOptions() {
        return Configuration.get('storeLocator.mapOptions');
    };
    ReferenceMapConfiguration.iconOptions = function iconOptions(attr) {
        if (attr) {
            return Configuration.get('storeLocator.icons')[attr];
        } else {
            return Configuration.get('storeLocator.icons');
        }
    };
    ReferenceMapConfiguration.zoomInDetails = function zoomInDetails() {
        return Configuration.get('storeLocator.zoomInDetails');
    };
    ReferenceMapConfiguration.title = function title() {
        return Configuration.get('storeLocator.title');
    };
    ReferenceMapConfiguration.isEnabled = function isEnabled() {
        return Configuration.get('storeLocator.isEnabled');
    };
    ReferenceMapConfiguration.getUrl = function getUrl() {
        return 'https://maps.googleapis.com/maps/api/js?v=3.21&key=' + Configuration.get('storeLocator.apiKey') + '&signed_in=false&libraries=places';
    };
    ReferenceMapConfiguration.getApiKey = function getApiKey() {
        return Configuration.get('storeLocator.apiKey');
    };
    ReferenceMapConfiguration.getExtraData = function getExtraData() {
        return Configuration.get('storeLocator.additionalStoresData');
    };
    ReferenceMapConfiguration.getRadius = function getRadius() {
        return Configuration.get('storeLocator.radius');
    };
    ReferenceMapConfiguration.openPopupOnMouseOver = function openPopupOnMouseOver() {
        return Configuration.get('storeLocator.openPopupOnMouseOver');
    };
    ReferenceMapConfiguration.showLocalizationMap = function showLocalizationMap() {
        return Configuration.get('storeLocator.showLocalizationMap');
    };
    ReferenceMapConfiguration.showAllStoresRecordsPerPage = function showAllStoresRecordsPerPage() {
        return Configuration.get('storeLocator.showAllStoresRecordsPerPage');
    };
    return ReferenceMapConfiguration;
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module StoreLocatorAccessPoints
define('StoreLocatorAccessPoints.HeaderLink.View', [
    'ReferenceMap.Configuration',
    'storelocator_accesspoints_headerlink.tpl',
    'Backbone',
    'SC.Configuration'
], function (ReferenceConfiguration, storelocator_accesspoints_headerlink_tpl, Backbone, Configuration) {
    'use strict';
    //@class StoreLocatorAccessPoints.HeaderLink.View @extend Backbone.View
    return Backbone.View.extend({
        //@property {Function} template
        template: storelocator_accesspoints_headerlink_tpl    //@method getContext
                                                    //@return {StoreLocatorAccessPoints.HeaderLink.View.Context}
,
        getContext: function () {
            //@class StoreLocatorAccessPoints.HeaderLink.View.Context
            return {
                //@Property {String} title
                title: ReferenceConfiguration.title()    //@property {Boolean} hasClass
,
                hasClass: !!this.options.className,
                className: this.options.className,
                touchpoint: Configuration.get('siteSettings.isHttpsSupported') ? 'home' : 'storelocator'
            };    //@class StoreLocatorAccessPoints.HeaderLink.View
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
// @module StoreLocatorAccessPoints
define('StoreLocatorAccessPoints', [
    'ReferenceMap.Configuration',
    'StoreLocatorAccessPoints.HeaderLink.View',
    'Header.View',
    'Header.Menu.View'
], function (ReferenceConfiguration, StoreLocatorWizardHeaderLinkView, HeaderView, HeaderMenuView) {
    'use strict';
    //@class StoreLocatorAccessPoints @extend ApplicationModule
    return {
        //@method mountToApp
        //@param {ApplicationSkeleton} application
        //@return {Void}
        mountToApp: function () {
            if (!ReferenceConfiguration.isEnabled()) {
                return;
            }
            HeaderView.addChildViews && HeaderView.addChildViews({
                'StoreLocatorHeaderLink': function wrapperFunction() {
                    return function () {
                        return new StoreLocatorWizardHeaderLinkView({});
                    };
                }
            });
            HeaderMenuView.addChildViews && HeaderMenuView.addChildViews({
                'StoreLocatorHeaderLink': function wrapperFunction() {
                    return function () {
                        return new StoreLocatorWizardHeaderLinkView({ className: ' ' });
                    };
                }
            });
        }
    };
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module StoreLocator
define('StoreLocator.Map.View', [
    'underscore',
    'Backbone',
    'store_locator_map.tpl'
], function (_, Backbone, store_locator_map_tpl) {
    'use strict';
    return Backbone.View.extend({
        template: store_locator_map_tpl    //@method initialize 
,
        initialize: function initialize(options) {
            this.application = options.application;
            this.reference_map = options.reference_map;
            //location model (optional)
            this.model = options.model;
            this.collection = options.collection;
        },
        destroy: function destroy() {
            if (this.collection) {
                this.collection.off('sync, reset', this.updateMap, this);
            } else if (this.model) {
                this.model.off('change', this.updateMapDetails, this);
            }
            this.reference_map.off('change:position', this.updateMap, this);
            return this._destroy();
        }    //@method updateMap
             //@return {Void}
,
        updateMap: function updateMap() {
            this.reference_map.clearPointList(this.map);
            var position = this.reference_map.getPosition();
            if (position && _.size(position) && !position.refineSearch) {
                this.reference_map.showMyPosition(position, this.map);
            } else {
                this.reference_map.centerMapToDefault(this.map);
            }
            if (this.collection.length) {
                this.reference_map.showPointList(this.collection, this.map);
                this.reference_map.fitBounds(this.map);
            }
        }    //@method updateMapDetails
             //@return {Void}
,
        updateMapDetails: function updateMapDetails() {
            this.reference_map.showPointWithoutInfoWindow(this.model, this.map);
        }    //@method render
,
        render: function render() {
            if (this.reference_map) {
                this._render();
                var self = this;
                this.reference_map.load().done(function () {
                    self.mapInit();
                });
            }
        }    //@method mapInit
,
        mapInit: function mapInit() {
            this.map = this.reference_map.showMap(this.$('[data-type="map"]').get(0));
            if (this.model) {
                this.model.on('change', this.updateMapDetails, this);
                this.updateMapDetails();
            } else if (this.collection) {
                this.collection.on('sync, reset', this.updateMap, this);
                this.updateMap();
            }
            this.reference_map.on('change:position', this.updateMap, this);
        }
    });
});


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module StoreLocator
define('StoreLocator.List.View', [
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'store_locator_list.tpl',
    'Backbone',
    'underscore',
    'SC.Configuration'
], function storeLocatorList(BackboneCompositeView, BackboneCollectionView, store_locator_list_tpl, Backbone, _, Configuration) {
    'use strict';
    // @class StoreLocator.List.View @extend Backbone.View
    return Backbone.View.extend({
        template: store_locator_list_tpl,
        events: { 'mouseover li': 'openMapInfoWindow' }    //@method initialize
,
        initialize: function initialize(options) {
            this.reference_map = options.reference_map;
            this.index = options.index + 1;
            this.events = this.events || {};
            BackboneCompositeView.add(this);
        }    //@method openMapInfoWindow
             //@return {void}
,
        openMapInfoWindow: function openMapInfoWindow() {
            if (this.reference_map.configuration.openPopupOnMouseOver() && !_.isPhoneDevice() && !_.isTabletDevice()) {
                var marker = _.findWhere(this.reference_map.points, { store_id: this.model.get('internalid') });
                this.reference_map.showInfoWindow(marker, this.model, this.index);
            }
        }    //@method getContext @returns StoreLocator.List.View.Context
,
        getContext: function getContext() {
            //@Class StoreLocator.List.View.Context
            return {
                //@property {{String}} storeName
                storeName: this.model.get('name')    //@property {{String}} storeDistance
,
                storeDistance: this.model.get('distance')    //@property {{String}} distanceUnit
,
                distanceUnit: this.model.get('distanceunit')    //@property {{String}} storeAddress
,
                storeAddress: this.model.get('address1')    //@property {{String}} storeId
,
                storeId: this.model.get('internalid')    //@property {{Number}} index
,
                index: this.index,
                model: this.model,
                touchpoint: Configuration.get('siteSettings.isHttpsSupported') ? 'home' : 'storelocator'
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module StoreLocator
define('StoreLocator.Results.View', [
    'store_locator_results.tpl',
    'StoreLocator.List.View',
    'StoreLocator.Map.View',
    'AjaxRequestsKiller',
    'SC.Configuration',
    'underscore',
    'Backbone',
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'jQuery',
    'jQuery.scPush'
], function (store_locator_results_tpl, StoreLocatorListView, StoreLocatorMapView, AjaxRequestsKiller, Configuration, _, Backbone, BackboneCompositeView, BackboneCollectionView, jQuery) {
    'use strict';
    return Backbone.View.extend({
        template: store_locator_results_tpl,
        events: {
            'click [data-action="show-map"]': 'toggleView',
            'click [data-action="show-list"]': 'toggleView',
            'click [data-action="sc-pusher-dismiss"]': 'refineSearch'
        }    //@method initialize
             //@param {Object} options
,
        initialize: function initialize(options) {
            this.application = options.application;
            this.reference_map = options.reference_map;
            this.collection = options.collection;
            this.isDevice = !!_.isPhoneDevice() || _.isTabletDevice();
            BackboneCompositeView.add(this);
            this.collection.on('reset', this.render, this);
            this.collection.on('reset', this.showPush, this);
        }    //@method refineSearch
             //@param {Object} e
,
        refineSearch: function refineSearch(e) {
            e.preventDefault();
            this.collection.reset();
            //this.profileModel.unset('storeLocator_last_search');
            this.reference_map.setPosition(null);
        },
        showPush: function showPush() {
            this.render();
            if (this.isDevice) {
                if (this.collection.length) {
                    this.$el.trigger('open');
                } else {
                    this.$el.trigger('close');
                }
            }
        }    //@method render
,
        render: function render() {
            if (this.collection.length) {
                this._render();
                if (this.isDevice) {
                    this.$el.scPush();
                    this.toggleView();
                }
            } else {
                this.$el.empty();
            }
        }    //@method toggleView
             //@param {Object} e
,
        toggleView: function toggleView(e) {
            var $list_view = this.$('[data-type="list-view"]'), $map_view = this.$('[data-type="map-view"]'), $target = e && this.$(e.target);
            if ($target && $target.data('action') === 'show-map') {
                $list_view.hide();
                $map_view.show();
                this.$('[data-action="show-list"]').removeClass('active');
                this.$('[data-action="show-map"]').addClass('active');
                this.mapViewInstance.render();
                var $map = this.mapViewInstance.$('[data-type="map"]');
                $map.css('height', jQuery(window).innerHeight() - $map.position().top);
            } else {
                $map_view.hide();
                $list_view.show();
                this.$('[data-action="show-map"]').removeClass('active');
                this.$('[data-action="show-list"]').addClass('active');
            }
        }    //@property {Object} childViews
,
        childViews: {
            'LocatorList': function () {
                return new BackboneCollectionView({
                    collection: this.collection,
                    childView: StoreLocatorListView,
                    childViewOptions: {
                        reference_map: this.reference_map,
                        isDevice: this.isDevice
                    }
                });
            },
            'ResultStoreLocatorMap': function () {
                this.mapViewInstance = new StoreLocatorMapView({
                    collection: this.collection,
                    application: this.application,
                    reference_map: this.reference_map
                });
                return this.mapViewInstance;
            }
        }    //@method getContext
             //@return StoreLocator.Location.View.Context
,
        getContext: function getContext() {
            var position = this.reference_map.getPosition();
            //@Class StoreLocator.Location.View.Context
            return {
                //@property {Boolean} myposition
                myposition: position && position.address ? position.address : ''    //@property {Number} totalStores
,
                totalStores: this.collection.length,
                showLocalizationMap: this.isDevice && this.reference_map.configuration.showLocalizationMap()    //@property {Boolean} showMap
,
                showMap: this.isDevice,
                touchpoint: Configuration.get('siteSettings.isHttpsSupported') ? 'home' : 'storelocator'
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module StoreLocator
define('StoreLocator.Main.View', [
    'Profile.Model',
    'StoreLocator.Map.View',
    'StoreLocator.Search.View',
    'StoreLocator.Results.View',
    'SC.Configuration',
    'store_locator_main.tpl',
    'underscore',
    'Backbone.CompositeView',
    'Backbone'
], function (ProfileModel, StoreLocatorMapView, StoreLocatorSearchView, StoreLocatorResultsView, Configuration, store_locator_main_tpl, _, BackboneCompositeView, Backbone) {
    'use strict';
    return Backbone.View.extend({
        template: store_locator_main_tpl,
        events: { 'click [data-action="refine-search"]': 'refineSearch' }    //@method initialize
                                                                     //@param options
,
        initialize: function initialize(options) {
            this.application = options.application;
            this.reference_map = options.reference_map;
            this.reference_map.collection = this.collection;
            this.profileModel = ProfileModel.getInstance();
            this.title = this.reference_map.configuration.title();
            BackboneCompositeView.add(this);
        }    //@method destory
,
        destroy: function destroy() {
            //clear profile model
            if (Backbone.history.getFragment().split('/')[1] !== 'details') {
                this.profileModel.unset('storeLocator_last_search');
            }
            this._destroy();
        }    //@property {Object} childViews
,
        childViews: {
            'StoreLocatorMap': function () {
                return new StoreLocatorMapView({
                    collection: this.collection,
                    application: this.application,
                    reference_map: this.reference_map
                });
            },
            'StoreLocatorResults': function () {
                return new StoreLocatorResultsView({
                    collection: this.collection,
                    application: this.application,
                    reference_map: this.reference_map,
                    profileModel: this.profileModel
                });
            },
            'StoreLocatorSearch': function () {
                return new StoreLocatorSearchView({
                    collection: this.collection,
                    application: this.application,
                    reference_map: this.reference_map,
                    profileModel: this.profileModel,
                    useGeolocation: window.location.protocol === 'https:'
                });
            }
        }    //@method getContext
             //@returns StoreLocator.Main.View.Context
,
        getContext: function getContext() {
            //@class StoreLocator.Main.View.Context
            return {
                //@property {String} title
                title: this.reference_map.configuration.title,
                touchpoint: Configuration.get('siteSettings.isHttpsSupported') ? 'home' : 'storelocator'
            };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module StoreLocator
define('StoreLocator.Details.View', [
    'StoreLocator.Map.View',
    'Location.VenueDetails.View',
    'ReferenceMap',
    'store_locator_details.tpl',
    'underscore',
    'Backbone.CompositeView',
    'Backbone',
    'Profile.Model'
], function (StoreLocatorMapView, LocationVenueDetailsView, ReferenceMap, store_locator_details_tpl, _, BackboneCompositeView, Backbone, ProfileModel) {
    'use strict';
    return Backbone.View.extend({
        template: store_locator_details_tpl    //@method initialize
                                     //@params {Object} options
,
        initialize: function initialize(options) {
            this.reference_map = options.reference_map;
            this.model = options.model;
            this.reference_map.model = this.model;
            this.application = options.application;
            this.profile_model = ProfileModel.getInstance();
            //@property {String} title
            this.title = this.reference_map.configuration.title();
            BackboneCompositeView.add(this);
        }    //@property {Object} childViews
,
        childViews: {
            'LocatorMap': function () {
                return new StoreLocatorMapView({
                    application: this.application,
                    reference_map: this.reference_map,
                    model: this.model
                });
            },
            'StoreLocationInfo': function () {
                return new LocationVenueDetailsView({
                    application: this.application,
                    model: this.model,
                    showAddress: true
                });
            }
        }    //@method getContext @returns StoreLocator.Details.View.Context
,
        getContext: function getContext() {
            var last_navigation = this.profile_model.get('storeLocator_last_search'), direction_url = this.reference_map.getDirectionsUrl(last_navigation, this.model.get('location'));
            return {
                title: this.reference_map.configuration.title,
                directionUrl: direction_url,
                redirectUrl: !!last_navigation ? 'stores' : 'stores/all'
            };
        }
    });
});


/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module StoreLocator
define('StoreLocator.List.All.Store.View', [
    'Backbone.CompositeView',
    'Backbone.CollectionView',
    'store_locator_list_all_store.tpl',
    'SC.Configuration',
    'Backbone'
], function (BackboneCompositeView, BackboneCollectionView, store_locator_list_all_store_tpl, Configuration, Backbone) {
    'use strict';
    return Backbone.View.extend({
        template: store_locator_list_all_store_tpl    //@method initialize
                                            //@param {Object} options
,
        initialize: function initialize(options) {
            this.index = options.index;
            BackboneCompositeView.add(this);
        }    //@method getContext
             //@return StoreLocator.ListAll.Store.View.Context
,
        getContext: function getContext() {
            return {
                //@property {String} name
                name: this.model.get('name')    //@property {String} storeId
,
                storeId: this.model.get('internalid')    //@property {String} touchpoint
,
                touchpoint: Configuration.get('siteSettings.isHttpsSupported') ? 'home' : 'storelocator'
            };
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module StoreLocator
define('StoreLocator.List.All.View', [
    'store_locator_list_all.tpl',
    'StoreLocator.List.All.Store.View',
    'GlobalViews.Pagination.View',
    'underscore',
    'Backbone',
    'Backbone.CompositeView',
    'Backbone.CollectionView'
], function (store_locator_list_all_tpl, StoreLocatorListAllStore, GlobalViewsPaginationView, _, Backbone, BackboneCompositeView, BackboneCollectionView) {
    'use strict';
    return Backbone.View.extend({
        template: store_locator_list_all_tpl    //@method initialize
                                      //@param {Object} options
,
        initialize: function initialize(options) {
            this.configuration = options.configuration;
            this.collection = options.collection;
            //@property {String} title
            this.title = this.configuration.title();
            BackboneCompositeView.add(this);
            this.collection.on('reset', this.render, this);
        }    //@property {Object} childViews
,
        childViews: {
            'StoreLocatorListAllStoreView': function () {
                return new BackboneCollectionView({
                    collection: this.collection,
                    childView: StoreLocatorListAllStore
                });
            },
            'GlobalViews.Pagination': function () {
                return new GlobalViewsPaginationView(_.extend({ totalPages: Math.ceil(this.collection.totalRecordsFound / this.configuration.showAllStoresRecordsPerPage()) || 0 }));
            }
        }    //@method getContext
             //@return StoreLocator.List.All.View.Context
,
        getContext: function getContext() {
            return { showList: !!this.collection.length };
        }
    });
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module StoreLocator
define('StoreLocator.Upgrade.View', [
    'store_locator_upgrade.tpl',
    'Backbone'
], function (store_locator_upgrade, Backbone) {
    'use strict';
    return Backbone.View.extend({
        template: store_locator_upgrade    //@method initialize
                                 //@param {Object} options
,
        initialize: function initialize(options) {
            this.application = options.application;
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module StoreLocator
define('StoreLocator.Router', [
    'AjaxRequestsKiller',
    'Backbone',
    'Profile.Model',
    'StoreLocator.Model',
    'StoreLocator.Collection',
    'StoreLocator.Main.View',
    'StoreLocator.Details.View',
    'StoreLocator.List.All.View',
    'StoreLocator.Upgrade.View',
    'SC.Configuration',
    'ReferenceMap',
    'ReferenceMap.Configuration',
    'Utils'
], function (AjaxRequestsKiller, Backbone, ProfileModel, StoreLocatorModel, StoreLocatorCollection, StoreLocatorMainView, StoreLocatorDetaisView, StoreLocatorListAllView, StoreLocatorUpgradeView, Configuration, ReferenceMap, ReferenceConfiguration, Utils) {
    'use strict';
    return Backbone.Router.extend({
        //@method routes
        //@return {Object}
        routes: function routes() {
            if (Utils.oldIE(8)) {
                return {
                    'stores': 'browserUpgrade',
                    'stores/details/:id': 'browserUpgrade',
                    'stores/all': 'browserUpgrade',
                    'stores/all?:options': 'browserUpgrade'
                };
            } else {
                return {
                    'stores': 'storeLocatorStores',
                    'stores/details/:id': 'storeLocatorDetails',
                    'stores/all': 'storeLocatorListAll',
                    'stores/all?:options': 'storeLocatorListAll'
                };
            }
        }    //@method initialize
             //@param {Object} application
,
        initialize: function initialize(application) {
            this.application = application;
        }    //@method storeLocatorStores
,
        storeLocatorStores: function storeLocatorStores() {
            var view = new StoreLocatorMainView({
                application: this.application,
                collection: new StoreLocatorCollection(),
                reference_map: new ReferenceMap()
            });
            view.showContent();
        }    //@method storeLocatorListAll
             //@param {Object} options
,
        storeLocatorListAll: function storeLocatorListAll(options) {
            options = options ? SC.Utils.parseUrlOptions(options) : { page: 1 };
            options.page = options.page || 1;
            var collection = new StoreLocatorCollection(), view = new StoreLocatorListAllView({
                    application: this.application,
                    collection: collection,
                    configuration: ReferenceConfiguration
                });
            collection.update({
                sort: 'namenohierarchy'    //@property {String} page
,
                page: options.page,
                results_per_page: ReferenceConfiguration.showAllStoresRecordsPerPage()    //@property {Number} killerId
,
                killerId: AjaxRequestsKiller.getKillerId()    //@property {Boolean} reset
,
                reset: true,
                locationtype: Configuration.get('storeLocator.defaultTypeLocations')
            });
            view.showContent();
        }    //@method storeLocatorDetails
             //@param {String} id
,
        storeLocatorDetails: function storeLocatorDetails(id) {
            var model = new StoreLocatorModel(), reference_map = new ReferenceMap(), view = new StoreLocatorDetaisView({
                    application: this.application,
                    model: model,
                    reference_map: reference_map
                });
            model.fetch({
                data: {
                    //@property {String} internalid
                    internalid: id
                },
                killerId: AjaxRequestsKiller.getKillerId()
            }).done(function () {
                view.showContent();
            });
        }    //@method browserUpgrade
,
        browserUpgrade: function browserUpgrade() {
            var view = new StoreLocatorUpgradeView({ application: this.application });
            view.showContent();
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module StoreLocator
define('StoreLocator', [
    'ReferenceMap.Configuration',
    'StoreLocator.Router',
    'SC.Configuration',
    'Utils',
    'underscore'
], function (ReferenceConfiguration, Router, Configuration, Utils, _) {
    'use strict';
    return {
        //@method mountToApp
        //@param {Object} application
        mountToApp: function mountToApp(application) {
            var configurationIcons = [
                'storeLocator.icons.stores',
                'storeLocator.icons.position',
                'storeLocator.icons.autocomplete'
            ];
            _.each(configurationIcons, function (property) {
                if (Utils.getPathFromObject(Configuration, property, '')) {
                    Utils.setPathFromObject(Configuration, property, _.getAbsoluteUrlOfNonManagedResources(Utils.getPathFromObject(Configuration, property, '')));
                }
            });
            if (ReferenceConfiguration.isEnabled() && window.location.protocol === 'https:') {
                return new Router(application);
            }
        }
    };
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module CustomContentType
define('CustomContentType.Base.View', [
    'Backbone',
    'underscore',
    'jQuery'
], function (Backbone, _, jQuery) {
    'use strict';
    //@class CustomContentType.Base.View @extends Backbone.View
    //Base CCT class from where all the custom CCT extend from
    //inherits the basic render and destroy methods from Backbone.View
    var CustomContentTypeBaseView = Backbone.View.extend({
        initialize: function initialize(options) {
            this._initialize(options);
        }    // @method install called the first time a CCT is dragged from the admin panel to the application.
             // It indicates when does the CCT instance has finished making all the ajax call that are necessary.
             // Also it initializes the CCT settings.
             // If in a custom CCT is there any ajax calls or other logic, then the CCT has to override this method
             // and return a jQuery.deferred.
             // Any error that cause that the CustomContentType object could not be installed, means that the cct will be
             // removed from the DOM (call the destroy method -to be defined??- ) and it will return a deferred rejected.
             // @param {CustomContentType.Settings} settings the settings of the CCT
             // @return {jQuery.Deferred}
,
        install: function install(settings, context_data) {
            return this._install(settings, context_data);
        }    // @method _instal
             // @param {CustomContentType.Settings} settings the new settings of the CCT
             // @return {Void}
,
        _install: function _install(settings, context_data) {
            this.settings = settings;
            this.contextData = context_data;
            return jQuery.Deferred().resolve();
        }    // @method update used every time the user wants to edit a CCT.
             // To do this, the user will select one, interact with the CMS configuration side panel,
             // CMS will in turn trigger the adapter:cct:update event, and SCA code will call this method to finally
             // update the settings of the CCT.
             // Each specific CCT will have to override this method in order to update the settings,
             // trigger a re-render of the CCT View, and return a deferred resolved or rejected.
             // @param {CustomContentType.Settings} settings the new settings of the CCT
             // @return {jQuery.Deferred}
,
        update: function update(settings) {
            return this._update(settings);
        }    // @method _update
             // @param {CustomContentType.Settings} settings the new settings of the CCT
             // @return {Void}
,
        _update: function _update(settings) {
            this.settings = settings;
            return jQuery.Deferred().resolve();
        },
        destroy: function destroy() {
            this._destroy();
            return jQuery.Deferred().resolve();
        }    // @method getContext
             // @return {CustomContentType.Base.View.Context}
,
        getContext: function getContext() {
            // @class CustomContentType.Base.View.Context
            return {
                //@property {CustomContentType.Settings} settings
                settings: this.settings
            };    // @class CustomContentType.Base.View
        }
    });
    CustomContentTypeBaseView.beforeInitialize.install({
        name: 'customContentTypeBaseViewInit',
        priority: 1,
        execute: function () {
            this.settings = {};
            this.instanceId = this.options.instanceId;
            this.id = this.options.id;
        }
    });
    return CustomContentTypeBaseView;    //@class CustomContentType.Settings This class defines the available settings that a CustomContentType object support.
                                         //It is an obj of the form
                                         // {
                                         //		template: {String} name of the template/path to the module in the file cabinet?
                                         //		html: to be defined, in case of the four core CCT
                                         //		....
                                         // }
});

/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module SC.CCT.Html
define('SC.CCT.Html.View', [
    'CustomContentType.Base.View',
    'sc_cct_html.tpl'
], function (CustomContentTypeBaseView, sc_cct_html_tpl) {
    'use strict';
    //@class SC.CCT.Html.View @extend CustomContentType.Base.View
    return CustomContentTypeBaseView.extend({
        template: sc_cct_html_tpl,
        getContext: function getContext() {
            // @class SC.CCT.Html.View.Context
            return {
                //@property {String} htmlString
                htmlString: this.settings.html_string,
                hasHtmlString: !!this.settings.html_string
            };    // @class SC.CCT.Html.View
        }
    });
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
//@module SC.CCT.Html
define('SC.CCT.Html', ['SC.CCT.Html.View'], function (SCCCTHtmlView) {
    'use strict';
    return {
        mountToApp: function mountToApp(application) {
            var component = application.getComponent('CMS');
            if (!component) {
                return;
            }
            component.registerCustomContentType({
                id: 'CMS',
                view: SCCCTHtmlView
            });
        }
    };
});
define('SC.Checkout.Starter.Dependencies', [
    'Backbone.View.Plugins',
    'jQuery.html',
    'Location',
    'PickupInStore',
    'Checkout.Profile',
    'Item',
    'ProductViews',
    'Transaction.Line.Views',
    'Cart',
    'LoginRegister',
    'CreditCard',
    'Content',
    'Address',
    'CustomFields',
    'OrderWizard',
    'Categories',
    'ExternalPayment',
    'NavigationHelper',
    'NavigationHelper.Plugins.Standard',
    'NavigationHelper.Plugins.DataTouchPoint',
    'NavigationHelper.Plugins.Modals',
    'NavigationHelper.Plugins.Pushers',
    'SocialSharing',
    'SocialSharing.Plugins.Facebook',
    'SocialSharing.Plugins.Twitter',
    'SocialSharing.Plugins.GooglePlus',
    'SocialSharing.Plugins.Pinterest',
    'SocialSharing.Plugins.Pinterest.Hover',
    'SocialSharing.Plugins.AddThis',
    'AjaxRequestsKiller',
    'RequestQuoteAccessPoints',
    'QuickOrderAccessPoints',
    'RequestQuoteWizard',
    'ErrorManagement',
    'GoogleUniversalAnalytics',
    'GoogleAdWords',
    'GoogleTagManager',
    'Merchandising',
    'CheckoutSkipLogin',
    'ImageNotAvailable',
    'BrontoIntegration',
    'CMSadapterInstaller',
    'Sensors',
    'GoogleMap',
    'GoogleMap.Configuration',
    'StoreLocatorAccessPoints',
    'StoreLocator',
    'SC.CCT.Html'
], function (a0, a1, a2, a3, a4, a5, a6, a7, a8, a9, a10, a11, a12, a13, a14, a15, a16, a17, a18, a19, a20, a21, a22, a23, a24, a25, a26, a27, a28, a29, a30, a31, a32, a33, a34, a35, a36, a37, a38, a39, a40, a41, a42, a43, a44, a45, a46, a47) {
    return Array.prototype.slice.call(arguments);
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('SC.Extensions', ['underscore'], function (_) {
    'use strict';
    if (SC && SC.extensionModules) {
        return _.map(SC.extensionModules, function (appModuleName) {
            try {
                return require(appModuleName);
            } catch (error) {
                console.error(error);
            }
        });
    }
    return [];
});
/*
	© 2017 NetSuite Inc.
	User may not copy, modify, distribute, or re-bundle or otherwise make available this code;
	provided, however, if you are an authorized user with a NetSuite account or log-in, you
	may use this code subject to the terms that govern your access and use.
*/
define('SC.Checkout.Starter', [
    'SC.Checkout',
    'underscore',
    'jQuery',
    'Backbone',
    'Utils',
    'SC.Checkout.Starter.Dependencies'    // Auto generated at build time using configuration from distro.json
,
    'SC.Extensions'
], function (application, _, jQuery, Backbone, Utils, entryPointModules, entryPointExtensionsModules) {
    'use strict';
    // At starting time all the modules Array is initialized
    entryPointModules = entryPointModules.concat(entryPointExtensionsModules);
    jQuery(function () {
        application.getConfig().siteSettings = SC.ENVIRONMENT.siteSettings || {};
        if (SC.ENVIRONMENT.CHECKOUT.skipLogin) {
            application.Configuration.checkout = application.Configuration.checkout || {};
            application.Configuration.checkout.skipLogin = SC.ENVIRONMENT.CHECKOUT.skipLogin;
            delete SC.ENVIRONMENT.CHECKOUT.skipLogin;
        }
        application.start(entryPointModules, function () {
            // Checks for errors in the context
            if (SC.ENVIRONMENT.contextError) {
                // Shows the error.
                if (SC.ENVIRONMENT.contextError.errorCode === 'ERR_WS_EXPIRED_LINK') {
                    application.getLayout().expiredLink(SC.ENVIRONMENT.contextError.errorMessage);
                } else {
                    application.getLayout().internalError(SC.ENVIRONMENT.contextError.errorMessage, 'Error ' + SC.ENVIRONMENT.contextError.errorStatusCode + ': ' + SC.ENVIRONMENT.contextError.errorCode);
                }
            } else {
                var fragment = Utils.parseUrlOptions(location.search).fragment;
                if (fragment && !location.hash) {
                    location.hash = decodeURIComponent(fragment);
                }
                Backbone.history.start();
            }
            application.getLayout().appendToDom();
        });
    });
});
require.config({
    'paths': {
        'jQuery': 'jquery-1.11.1.custom',
        'jasmine-ajax': 'mock-ajax',
        'Backbone': 'backbone.custom',
        'Backbone.Validation': 'backbone-validation',
        'jQuery.bxSlider': 'jquery.bxslider.custom',
        'Handlebars': 'handlebars.runtime-v4.0.10',
        'typeahead': 'typeahead.bundle'
    },
    'shim': {
        'jQuery': { 'exports': 'jQuery' },
        'json2': { 'exports': 'JSON' },
        'jquery.zoom': { 'deps': ['jQuery'] },
        'jQuery.bxSlider': { 'deps': ['jQuery'] },
        'bootstrap': { 'deps': ['jQuery'] },
        'bootstrap-datepicker': {
            'deps': [
                'jQuery',
                'bootstrap'
            ]
        },
        'Backbone.Validation': { 'deps': ['Backbone'] },
        'typeahead': { 'deps': ['jQuery'] }
    },
    'map': { 'jquery.cookie': { 'jquery': 'jQuery' } },
    'findNestedDependencies': true,
    'preserveComments': true,
    'preserveFiles': false,
    'baseUrl': '',
    'configFile': null,
    'exclude': [],
    'excludeShallow': [],
    'wrapShim': true
});
var SCCheckoutStarter = require(['SC.Checkout.Starter']);
define('SC.Checkout.Starter.index', ['SC.Checkout.Starter'], function () {
    return;
});
//# sourceMappingURL=checkout.js.map
